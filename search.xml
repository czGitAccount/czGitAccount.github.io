<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>åŸºäºè·³è¡¨å®ç°çš„é”®å€¼å‹å­˜å‚¨å¼•æ“</title>
    <url>/Database/Skiplist-CPP/</url>
    <content><![CDATA[<!-- build time:Tue Jun 22 2021 17:02:33 GMT+0800 (GMT+08:00) --><a id="more"></a><h1>åŸºäºè·³è¡¨å®ç°çš„é”®å€¼å‹å­˜å‚¨å¼•æ“</h1><h2 id="1-é¡¹ç›®è¯´æ˜"><a class="header-anchor" href="#1-é¡¹ç›®è¯´æ˜">Â¶</a>1 é¡¹ç›®è¯´æ˜</h2><p><strong><font color="008F88">Key-Value å­˜å‚¨å¼•æ“</font></strong> ğŸŒ»</p><p>åŸºäº <strong><font color="F88F00">è·³è¡¨</font></strong> å®ç°çš„ KV å­˜å‚¨å¼•æ“ï¼Œä½¿ç”¨ C++ å®ç°ã€‚åœ¨éšæœºè¯»å†™æƒ…å†µä¸‹ï¼Œè¯¥é¡¹ç›®æ¯ç§’å¯å¤„ç†è¯·æ±‚æ•°ï¼ˆQPSï¼‰ï¼š24.39 Wï¼Œæ¯ç§’å¯å¤„ç†è¯»è¯·æ±‚æ•°ï¼š18.41 Wã€‚ï¼ˆé¡¹ç›®ä½œè€…è¯´æ˜ï¼Œä½†ç¬”è€…æµ‹è¯•ä¸ç›¸åŒï¼‰</p><p><strong>æä¾›æ¥å£</strong> ï¼š</p><p>ğŸ”¹ insert_element æ’å…¥æ•°æ®</p><p>ğŸ”¸ delete_element åˆ é™¤æ•°æ®</p><p>ğŸ”¹ search_element æŸ¥è¯¢æ•°æ®</p><p>ğŸ”¸ update_element æ›´æ–°æ•°æ® ï¼ˆç¬”è€…æ·»åŠ ï¼‰</p><p>ğŸ”¹ display_list æ‰“å°è·³è·ƒè¡¨</p><p>ğŸ”¸ dump_file æ•°æ®è½ç›˜</p><p>ğŸ”¹ load_file åŠ è½½æ•°æ®</p><p>ğŸ”¸ size è¿”å›æ•°æ®è§„æ¨¡</p><p>ğŸ”¹ clear æ¸…ç©ºè·³è¡¨ ï¼ˆç¬”è€…æ·»åŠ ï¼‰</p><p><strong>é¡¹ç›®åœ°å€</strong>ï¼š<a href="https://github.com/youngyangyang04/Skiplist-CPP" target="_blank" rel="noopener">Skiplist-CPP: A tiny KV storage based on skiplist written in C++ language</a></p><p><strong>è¡¥å……è¯´æ˜</strong> ï¼šè¯¥é¡¹ç›®ä½œè€…ï¼šç¨‹åºå‘˜ Carlï¼Œå…¬ä¼—å·ï¼šä»£ç éšæƒ³å½•ã€‚ç¬”è€…å¯¹å…¶ä»£ç è¿›è¡Œå­¦ä¹ ï¼Œå¹¶å°è¯•ä¿®æ”¹ã€‚ä¿®æ”¹çš„å†…å®¹è§ä¸‹æ–‡ã€‚</p><hr><h2 id="2-é¡¹ç›®ä»£ç "><a class="header-anchor" href="#2-é¡¹ç›®ä»£ç ">Â¶</a>2 é¡¹ç›®ä»£ç </h2><p>æ‰€æœ‰å®ç°ä»£ç ä½äº <code>skiplist.h</code> å¤´æ–‡ä»¶ä¸­ï¼ŒCPP æ–‡ä»¶ä¸­ include å®ƒå°±å¯ä»¥ä½¿ç”¨ã€‚å†…éƒ¨å…³é”®åœ¨äºå®šä¹‰äº† <code>SkipList</code> ç»“æ„ï¼Œä»¥åŠ <code>Node</code> ç»“æ„ã€‚</p><h3 id="2-1-å¤´æ–‡ä»¶"><a class="header-anchor" href="#2-1-å¤´æ–‡ä»¶">Â¶</a>2.1 å¤´æ–‡ä»¶</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></span><br></pre></td></tr></table></figure><hr><h3 id="2-2-åŸºæœ¬å®šä¹‰"><a class="header-anchor" href="#2-2-åŸºæœ¬å®šä¹‰">Â¶</a>2.2 åŸºæœ¬å®šä¹‰</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> STORE_FILE <span class="meta-string">"store/dumpFile"</span></span></span><br><span class="line"><span class="built_in">std</span>::mutex mtx, mtx1;  </span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">string</span> delimiter = <span class="string">":"</span>;</span><br></pre></td></tr></table></figure><p><strong><font color="FF8888">è¯´æ˜</font></strong> ğŸŒ</p><p>ğŸ”¹ å®å®šä¹‰æ•°æ®è½ç›˜ä½ç½®ï¼Œä»¥åŠåŠ è½½æ•°æ®ä½ç½®ï¼›</p><p>ğŸ”¸ å®šä¹‰äº’æ–¥é‡é”ï¼Œç”¨äºå†™æ“ä½œä¸­çš„ä¸´ç•ŒåŒºï¼›</p><p>ğŸ”¹ å®šä¹‰åˆ†éš”ç¬¦ï¼Œç”¨äºåŠ è½½æ•°æ®æ˜¯è¯†åˆ« <strong>Key</strong> å’Œ <strong>Value</strong> ã€‚</p><hr><h3 id="2-3-Node"><a class="header-anchor" href="#2-3-Node">Â¶</a>2.3 Node</h3><h4 id="2-3-1-Node-å®šä¹‰"><a class="header-anchor" href="#2-3-1-Node-å®šä¹‰">Â¶</a>2.3.1 Node å®šä¹‰</h4><p><code>Node</code> ç»“æ„æ˜¯ <code>SkipList</code> å®ç°çš„åŸºç¡€ã€‚å…¶å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> K, <span class="keyword">typename</span> V&gt; </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span> &#123;</span></span><br><span class="line"><span class="comment">// ~ Node èŠ‚ç‚¹å®šä¹‰</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// æ„é€ å‡½æ•°</span></span><br><span class="line">    Node() &#123;&#125;            </span><br><span class="line">    Node(K k, V v, <span class="keyword">int</span>); </span><br><span class="line">    <span class="comment">// ææ„å‡½æ•°</span></span><br><span class="line">    ~Node();   </span><br><span class="line">    <span class="comment">// é”®å€¼å¯¹æ“ä½œç›¸å…³çš„æˆå‘˜å‡½æ•°</span></span><br><span class="line">    <span class="function">K <span class="title">get_key</span><span class="params">()</span> <span class="keyword">const</span></span>;   <span class="comment">// å– Key</span></span><br><span class="line">    <span class="function">V <span class="title">get_value</span><span class="params">()</span> <span class="keyword">const</span></span>; <span class="comment">// å– value</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set_value</span><span class="params">(V)</span></span>;   <span class="comment">// è®¾å®š value</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å‰å‘æŒ‡é’ˆæ•°ç»„ï¼Œå†…éƒ¨å­˜å‰å‘æŒ‡é’ˆï¼ŒæŒ‡å‘ä¸‹ä¸€ä¸ª Node</span></span><br><span class="line">    Node&lt;K, V&gt; **forward;</span><br><span class="line">    <span class="comment">// èŠ‚ç‚¹å±‚æ•°</span></span><br><span class="line">    <span class="keyword">int</span> node_level;       </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// æ•°æ®æˆå‘˜</span></span><br><span class="line">    K key; </span><br><span class="line">    V value;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong><font color="FF8888">è¯´æ˜</font></strong> ğŸŒ</p><p>ğŸ”¹ ç§æœ‰æ•°æ®æˆå‘˜ <strong>key</strong> ï¼Œ <strong>value</strong> ï¼Œå…¬æœ‰æ•°æ®æˆå‘˜ <strong>forward</strong> ï¼Œ<strong>node_level</strong></p><p>ğŸ”¸ æˆå‘˜å‡½æ•°ï¼šæ„é€ å‡½æ•°ï¼Œææ„å‡½æ•°ï¼Œé”®å€¼å¯¹æ“ä½œå‡½æ•°</p><p><strong><font color="FF8888">æ³¨æ„</font></strong> ğŸ™‹â€â™‚</p><p><strong>forward</strong> æ˜¯ä¸€ä¸ªæŒ‡é’ˆæ•°ç»„ï¼Œå…¶å…ƒç´ æ˜¯æŒ‡å‘ <strong>Node</strong> çš„æŒ‡é’ˆã€‚</p><hr><h4 id="2-3-2-æ„é€ å‡½æ•°å’Œææ„å‡½æ•°"><a class="header-anchor" href="#2-3-2-æ„é€ å‡½æ•°å’Œææ„å‡½æ•°">Â¶</a>2.3.2 æ„é€ å‡½æ•°å’Œææ„å‡½æ•°</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> K, <span class="keyword">typename</span> V&gt; </span><br><span class="line">Node&lt;K, V&gt;::Node(<span class="keyword">const</span> K k, <span class="keyword">const</span> V v, <span class="keyword">int</span> level) &#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;key = k;</span><br><span class="line">    <span class="keyword">this</span>-&gt;value = v;</span><br><span class="line">    <span class="keyword">this</span>-&gt;node_level = level;    </span><br><span class="line">    <span class="comment">// forward å¤§å°ä¸º level + 1</span></span><br><span class="line">    <span class="keyword">this</span>-&gt;forward = <span class="keyword">new</span> Node&lt;K, V&gt;*[level + <span class="number">1</span>]; <span class="comment">// åˆ†é…å†…å­˜</span></span><br><span class="line">    <span class="built_in">memset</span>(<span class="keyword">this</span>-&gt;forward, <span class="number">0</span>, <span class="keyword">sizeof</span>(Node&lt;K, V&gt;*)*(level + <span class="number">1</span>)); <span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> K, <span class="keyword">typename</span> V&gt; </span><br><span class="line">Node&lt;K, V&gt;::~Node() &#123;</span><br><span class="line">    <span class="keyword">delete</span> []forward;  <span class="comment">// é‡Šæ”¾å†…å­˜</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><hr><h4 id="2-3-3-é”®å€¼å¯¹æ“ä½œå‡½æ•°"><a class="header-anchor" href="#2-3-3-é”®å€¼å¯¹æ“ä½œå‡½æ•°">Â¶</a>2.3.3 é”®å€¼å¯¹æ“ä½œå‡½æ•°</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> K, <span class="keyword">typename</span> V&gt; </span><br><span class="line">K Node&lt;K, V&gt;::get_key() <span class="keyword">const</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> key;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> K, <span class="keyword">typename</span> V&gt; </span><br><span class="line">V Node&lt;K, V&gt;::get_value() <span class="keyword">const</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> K, <span class="keyword">typename</span> V&gt; </span><br><span class="line"><span class="keyword">void</span> Node&lt;K, V&gt;::set_value(V value) &#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;value = value;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><hr><h3 id="2-4-SkipList"><a class="header-anchor" href="#2-4-SkipList">Â¶</a>2.4 SkipList</h3><h4 id="2-4-1-SkipList-å®šä¹‰"><a class="header-anchor" href="#2-4-1-SkipList-å®šä¹‰">Â¶</a>2.4.1 SkipList å®šä¹‰</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> K, <span class="keyword">typename</span> V&gt; </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SkipList</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>: </span><br><span class="line">    <span class="comment">// æ„é€ å’Œææ„å‡½æ•°ï¼Œåˆ›å»º Node èŠ‚ç‚¹å‡½æ•°</span></span><br><span class="line">    SkipList(<span class="keyword">int</span>); </span><br><span class="line">    ~SkipList();   </span><br><span class="line">    Node&lt;K, V&gt;* create_node(K, V, int);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¢åˆ æ”¹æŸ¥æ“ä½œå‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">insert_element</span><span class="params">(K, V)</span></span>;   	 <span class="comment">// å¢</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">delete_element</span><span class="params">(K)</span></span>;	    	 <span class="comment">// åˆ </span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">update_element</span><span class="params">(K, V, <span class="keyword">bool</span>)</span></span>;  <span class="comment">// æ”¹</span></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">search_element</span><span class="params">(K)</span></span>;			 <span class="comment">// æŸ¥</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">display_list</span><span class="params">()</span></span>;  <span class="comment">// æ‰“å°è·³è¡¨</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span></span>; 		  <span class="comment">// æ¸…ç©ºè·³è¡¨</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>;			  <span class="comment">// è¿”å›è·³è¡¨èŠ‚ç‚¹æ•°(ä¸åŒ…å«å¤´èŠ‚ç‚¹)</span></span><br><span class="line">       </span><br><span class="line">    <span class="comment">// æ•°æ®è½ç›˜å’Œæ•°æ®åŠ è½½</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dump_file</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">load_file</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è·å¾—éšæœºå±‚é«˜å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_random_level</span><span class="params">()</span></span>; </span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// æ•°æ®åŠ è½½ç›¸å…³å‡½æ•°, ç”¨æ¥åŒºåˆ† key å’Œ value</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">get_key_value_from_string</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span>&amp; str, <span class="built_in">std</span>::<span class="built_in">string</span>* key, <span class="built_in">std</span>::<span class="built_in">string</span>* value)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_valid_string</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span>&amp; str)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:    </span><br><span class="line">    <span class="keyword">int</span> _max_level;  	   <span class="comment">// è·³è¡¨å±‚æ•°ä¸Šé™</span></span><br><span class="line">    <span class="keyword">int</span> _skip_list_level;  <span class="comment">// å½“å‰è·³è¡¨çš„æœ€é«˜å±‚ </span></span><br><span class="line">	<span class="keyword">int</span> _element_count;    <span class="comment">// è·³è¡¨ä¸­èŠ‚ç‚¹æ•°</span></span><br><span class="line">    Node&lt;K, V&gt; *_header;   <span class="comment">// è·³è¡¨ä¸­å¤´èŠ‚ç‚¹æŒ‡é’ˆ</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// file operator</span></span><br><span class="line">    <span class="built_in">std</span>::ofstream _file_writer;</span><br><span class="line">    <span class="built_in">std</span>::ifstream _file_reader; </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong><font color="FF8888">è¯´æ˜</font></strong> ğŸŒ</p><p>ğŸ”¹ ç§æœ‰æ•°æ®æˆå‘˜ <strong>_max_level, _skip_list_level, _element_count, header, _file_writer, file_reader</strong></p><p>ğŸ”¸ æˆå‘˜å‡½æ•°ï¼šæ„é€ å‡½æ•°ï¼Œææ„å‡½æ•°ï¼Œåˆ›å»ºèŠ‚ç‚¹å‡½æ•°ï¼Œå¢åˆ æ”¹æŸ¥æ“ä½œå‡½æ•°ï¼Œæ¸…ç©ºè·³è¡¨ï¼Œæ•°æ®è½ç›˜å’ŒåŠ è½½æ•°æ®åŠå…¶ç›¸å…³å‡½æ•°ï¼Œæ‰“å°è·³è¡¨å‡½æ•°ï¼Œè¿”å›è·³è¡¨èŠ‚ç‚¹æ•°å‡½æ•°ï¼Œè·å¾—éšæœºå±‚é«˜å‡½æ•° ã€‚</p><hr><h4 id="2-4-2-æ„é€ å‡½æ•°ã€ææ„å‡½æ•°ã€èŠ‚ç‚¹æ„é€ å‡½æ•°"><a class="header-anchor" href="#2-4-2-æ„é€ å‡½æ•°ã€ææ„å‡½æ•°ã€èŠ‚ç‚¹æ„é€ å‡½æ•°">Â¶</a>2.4.2 æ„é€ å‡½æ•°ã€ææ„å‡½æ•°ã€èŠ‚ç‚¹æ„é€ å‡½æ•°</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> K, <span class="keyword">typename</span> V&gt; </span><br><span class="line">SkipList&lt;K, V&gt;::SkipList(<span class="keyword">int</span> max_level) &#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;_max_level = max_level;</span><br><span class="line">    <span class="keyword">this</span>-&gt;_skip_list_level = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">this</span>-&gt;_element_count = <span class="number">0</span>;</span><br><span class="line">    K k; V v;</span><br><span class="line">    <span class="keyword">this</span>-&gt;_header = <span class="keyword">new</span> Node&lt;K, V&gt;(k, v, _max_level);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> K, <span class="keyword">typename</span> V&gt; </span><br><span class="line">SkipList&lt;K, V&gt;::~SkipList() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (_file_writer.is_open()) &#123;</span><br><span class="line">        _file_writer.<span class="built_in">close</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (_file_reader.is_open()) &#123;</span><br><span class="line">        _file_reader.<span class="built_in">close</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">delete</span> _header;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> K, <span class="keyword">typename</span> V&gt;</span><br><span class="line">Node&lt;K, V&gt;* SkipList&lt;K, V&gt;::create_node(<span class="keyword">const</span> K k, <span class="keyword">const</span> V v, <span class="keyword">int</span> level) &#123;</span><br><span class="line">    Node&lt;K, V&gt; *n = <span class="keyword">new</span> Node&lt;K, V&gt;(k, v, level);</span><br><span class="line">    <span class="keyword">return</span> n;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h4 id="2-4-3-è·å¾—éšæœºå±‚é«˜å‡½æ•°ä»¥åŠè¿”å›è·³è¡¨å¤§å°å‡½æ•°"><a class="header-anchor" href="#2-4-3-è·å¾—éšæœºå±‚é«˜å‡½æ•°ä»¥åŠè¿”å›è·³è¡¨å¤§å°å‡½æ•°">Â¶</a>2.4.3 è·å¾—éšæœºå±‚é«˜å‡½æ•°ä»¥åŠè¿”å›è·³è¡¨å¤§å°å‡½æ•°</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> K, <span class="keyword">typename</span> V&gt;</span><br><span class="line"><span class="keyword">int</span> SkipList&lt;K, V&gt;::get_random_level()&#123;</span><br><span class="line">    <span class="keyword">int</span> k = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (rand() % <span class="number">2</span>) &#123;</span><br><span class="line">        k++;</span><br><span class="line">    &#125;</span><br><span class="line">    k = (k &lt; _max_level) ? k : _max_level; <span class="comment">// æœ€å¤§ä¸è¶…è¿‡ä¸Šé™</span></span><br><span class="line">    <span class="keyword">return</span> k;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> K, <span class="keyword">typename</span> V&gt; </span><br><span class="line"><span class="keyword">int</span> SkipList&lt;K, V&gt;::<span class="built_in">size</span>() &#123; </span><br><span class="line">    <span class="keyword">return</span> _element_count;  <span class="comment">// ä¼šéšç€èŠ‚ç‚¹çš„æ·»åŠ , åˆ é™¤, æ›´æ–°æ”¹å˜</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><font color="FF8888">æ³¨æ„</font></strong> ğŸ™‹ å±‚é«˜çš„é€‰æ‹©ä¸€èˆ¬æ ¹æ® <strong>å¹‚æ¬¡å®šå¾‹</strong> ï¼ˆpower lawï¼‰ï¼Œè¶Šå¤§çš„æ•°å‡ºç°çš„æ¦‚ç‡è¶Šå° ã€‚</p><hr><h4 id="2-4-4-insert-element"><a class="header-anchor" href="#2-4-4-insert-element">Â¶</a>2.4.4 insert_element()</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> K, <span class="keyword">typename</span> V&gt;</span><br><span class="line"><span class="keyword">int</span> SkipList&lt;K, V&gt;::insert_element(<span class="keyword">const</span> K key, <span class="keyword">const</span> V value) &#123; </span><br><span class="line">    mtx.lock(); <span class="comment">// å†™æ“ä½œï¼ŒåŠ é”</span></span><br><span class="line">    Node&lt;K, V&gt; *current = <span class="keyword">this</span>-&gt;_header; <span class="comment">// ä»å¤´èŠ‚ç‚¹éå†</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// update æ˜¯ä¸€ä¸ªæŒ‡é’ˆæ•°ç»„ï¼Œæ•°ç»„å†…å­˜æ”¾æŒ‡é’ˆï¼ŒæŒ‡å‘ node èŠ‚ç‚¹ï¼Œå…¶ç´¢å¼•ä»£è¡¨å±‚</span></span><br><span class="line">    Node&lt;K, V&gt; *update[_max_level + <span class="number">1</span>];  <span class="comment">// update çš„å¤§å° &gt;= forward</span></span><br><span class="line">    <span class="built_in">memset</span>(update, <span class="number">0</span>, <span class="keyword">sizeof</span>(Node&lt;K, V&gt;*)*(_max_level + <span class="number">1</span>)); <span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»æœ€é«˜å±‚å¼€å§‹éå†</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = _skip_list_level; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="comment">// åªè¦å½“å‰èŠ‚ç‚¹éç©ºï¼Œä¸” key å°äºç›®æ ‡, å°±ä¼šå‘åéå†</span></span><br><span class="line">        <span class="keyword">while</span>(current-&gt;forward[i] != <span class="literal">NULL</span> &amp;&amp; current-&gt;forward[i]-&gt;get_key() &lt; key) &#123;</span><br><span class="line">            current = current-&gt;forward[i];  <span class="comment">// èŠ‚ç‚¹å‘åç§»åŠ¨</span></span><br><span class="line">        &#125;</span><br><span class="line">        update[i] = current;  <span class="comment">// update[i] è®°å½•å½“å‰å±‚æœ€åç¬¦åˆè¦æ±‚çš„èŠ‚ç‚¹</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éå†åˆ° level 0 è¯´æ˜åˆ°è¾¾æœ€åº•å±‚äº†ï¼Œforward[0]æŒ‡å‘çš„å°±æ˜¯è·³è¡¨ä¸‹ä¸€ä¸ªé‚»è¿‘èŠ‚ç‚¹</span></span><br><span class="line">    current = current-&gt;forward[<span class="number">0</span>];  </span><br><span class="line">    <span class="comment">// æ³¨æ„æ­¤æ—¶ current-&gt;get_key() &gt;= key !!!</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. æ’å…¥å…ƒç´ å·²ç»å­˜åœ¨</span></span><br><span class="line">    <span class="keyword">if</span> (current != <span class="literal">NULL</span> &amp;&amp; current-&gt;get_key() == key) &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"key: "</span> &lt;&lt; key &lt;&lt; <span class="string">", exists"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        mtx.unlock();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;  <span class="comment">// æ’å…¥å…ƒç´ å·²ç»å­˜åœ¨ï¼Œè¿”å› -1ï¼Œæ’å…¥å¤±è´¥</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2. å¦‚æœå½“å‰ current ä¸å­˜åœ¨ï¼Œæˆ–è€… current-&gt;get_key &gt; key</span></span><br><span class="line">    <span class="keyword">if</span> (current == <span class="literal">NULL</span> || current-&gt;get_key() != key ) &#123;</span><br><span class="line">        <span class="comment">// éšæœºç”Ÿæˆå±‚çš„é«˜åº¦ï¼Œä¹Ÿå³ forward[] å¤§å°</span></span><br><span class="line">        <span class="keyword">int</span> random_level = get_random_level();</span><br><span class="line">        </span><br><span class="line">		<span class="comment">// å¦‚æœæ–°æ·»åŠ çš„èŠ‚ç‚¹å±‚é«˜å¤§äºå½“å‰è·³è¡¨å±‚é«˜ï¼Œåˆ™éœ€è¦æ›´æ–° update æ•°ç»„</span></span><br><span class="line">        <span class="comment">// å°†åŸæœ¬[_skip_list_level random_level]èŒƒå›´å†…çš„NULLæ”¹ä¸º_header</span></span><br><span class="line">        <span class="keyword">if</span> (random_level &gt; _skip_list_level) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = _skip_list_level + <span class="number">1</span>; i &lt; random_level + <span class="number">1</span>; i++) &#123;</span><br><span class="line">                update[i] = _header;</span><br><span class="line">            &#125;</span><br><span class="line">            _skip_list_level = random_level; <span class="comment">// æœ€åæ›´æ–°è·³è¡¨å±‚é«˜</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// åˆ›å»ºèŠ‚ç‚¹ï¼Œå¹¶è¿›è¡Œæ’å…¥æ“ä½œ</span></span><br><span class="line">        Node&lt;K, V&gt;* inserted_node = create_node(key, value, random_level);</span><br><span class="line">        <span class="comment">// è¯¥æ“ä½œç­‰ä»·äº:</span></span><br><span class="line">        <span class="comment">// new_node-&gt;next = pre_node-&gt;next; </span></span><br><span class="line">        <span class="comment">// pre_node-&gt;next = new_node; åªä¸è¿‡æ˜¯é€å±‚è¿›è¡Œ</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= random_level; i++) &#123;</span><br><span class="line">            inserted_node-&gt;forward[i] = update[i]-&gt;forward[i];</span><br><span class="line">            update[i]-&gt;forward[i] = inserted_node;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Successfully inserted key: "</span> &lt;&lt; key &lt;&lt; <span class="string">", value: "</span> &lt;&lt; value &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        _element_count ++;  <span class="comment">// æ›´æ–°èŠ‚ç‚¹æ•°</span></span><br><span class="line">    &#125;</span><br><span class="line">    mtx.unlock();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;  <span class="comment">// è¿”å› 0ï¼Œæ’å…¥æˆåŠŸ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><font color="FF8888">è¯´æ˜</font></strong> ğŸŒ ï¼šä»£ç è¯¦ç»†è§£é‡Šè§æ³¨é‡Šã€‚</p><p><strong><font color="FF8888">æ³¨æ„</font></strong> ğŸ™‹â€â™‚</p><p>ğŸ”¸ <strong>update</strong> æ•°ç»„å­˜åœ¨äºæ‰€æœ‰ <strong>å†™</strong> æ“ä½œä¸­ï¼Œèµ·è‡³å…³é‡è¦çš„ä½œç”¨ã€‚<strong>update[i]</strong> è®°å½•ç¬¬ <strong>i</strong> å±‚æœ€åç¬¦åˆè¦æ±‚çš„èŠ‚ç‚¹</p><p>ğŸ”¹ æ‰€æœ‰ <strong>å†™</strong> æ“ä½œï¼ˆå¢åˆ æ”¹ï¼‰éƒ½éœ€è¦åˆ¤æ–­ï¼Œ1ï¸âƒ£ å½“å‰ <strong>key</strong> å­˜åœ¨ï¼Œ2ï¸âƒ£ å½“å‰ <strong>key</strong> ä¸å­˜åœ¨ï¼Œè¿™ä¸¤ç§æƒ…å†µã€‚</p><hr><h4 id="2-4-5-delete-element"><a class="header-anchor" href="#2-4-5-delete-element">Â¶</a>2.4.5 delete_element()</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> K, <span class="keyword">typename</span> V&gt; </span><br><span class="line"><span class="keyword">int</span> SkipList&lt;K, V&gt;::delete_element(K key) &#123;</span><br><span class="line">    <span class="comment">// ç¬”è€…ä¿®æ”¹äº†å…¶è¿”å›å€¼ï¼Œå¦‚æœè¿”å› 0 åˆ é™¤æˆåŠŸï¼Œè¿”å› -1 åˆ é™¤å¤±è´¥</span></span><br><span class="line">    <span class="comment">// æ“ä½œåŒ insert_element</span></span><br><span class="line">    mtx.lock();</span><br><span class="line">    Node&lt;K, V&gt; *current = <span class="keyword">this</span>-&gt;_header; </span><br><span class="line">    Node&lt;K, V&gt; *update[_max_level + <span class="number">1</span>];</span><br><span class="line">    <span class="built_in">memset</span>(update, <span class="number">0</span>, <span class="keyword">sizeof</span>(Node&lt;K, V&gt;*)*(_max_level + <span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = _skip_list_level; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="keyword">while</span> (current-&gt;forward[i] !=<span class="literal">NULL</span> &amp;&amp; current-&gt;forward[i]-&gt;get_key() &lt; key) &#123;</span><br><span class="line">            current = current-&gt;forward[i];</span><br><span class="line">        &#125;</span><br><span class="line">        update[i] = current;</span><br><span class="line">    &#125;</span><br><span class="line">    current = current-&gt;forward[<span class="number">0</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1. éç©ºï¼Œä¸” key ä¸ºç›®æ ‡å€¼</span></span><br><span class="line">    <span class="keyword">if</span> (current != <span class="literal">NULL</span> &amp;&amp; current-&gt;get_key() == key) &#123;  </span><br><span class="line">        <span class="comment">// ä»æœ€åº•å±‚å¼€å§‹åˆ é™¤ update-&gt;forward æŒ‡å‘çš„èŠ‚ç‚¹ï¼Œå³ç›®æ ‡èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= _skip_list_level; i++) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœ update[i] å·²ç»ä¸æŒ‡å‘ current è¯´æ˜ i çš„ä¸Šå±‚ä¹Ÿä¸ä¼šæŒ‡å‘ current</span></span><br><span class="line">            <span class="comment">// ä¹Ÿè¯´æ˜äº†è¢«åˆ é™¤èŠ‚ç‚¹å±‚é«˜ i - 1ã€‚ç›´æ¥é€€å‡ºå¾ªç¯å³å¯</span></span><br><span class="line">            <span class="keyword">if</span> (update[i]-&gt;forward[i] != current) </span><br><span class="line">                <span class="keyword">break</span>;                            </span><br><span class="line">            <span class="comment">// åˆ é™¤æ“ä½œï¼Œç­‰ä»·äº node-&gt;next = node-&gt;next-&gt;next</span></span><br><span class="line">            update[i]-&gt;forward[i] = current-&gt;forward[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å› ä¸ºå¯èƒ½åˆ é™¤çš„å…ƒç´ å®ƒçš„å±‚æ•°æ°å¥½æ˜¯å½“å‰è·³è·ƒè¡¨çš„æœ€å¤§å±‚æ•°</span></span><br><span class="line">        <span class="comment">// æ‰€ä»¥æ­¤æ—¶éœ€è¦é‡æ–°ç¡®å®š _skip_list_level,é€šè¿‡å¤´èŠ‚ç‚¹åˆ¤æ–­</span></span><br><span class="line">        <span class="keyword">while</span> (_skip_list_level &gt; <span class="number">0</span> &amp;&amp; _header-&gt;forward[_skip_list_level] == <span class="number">0</span>) &#123;</span><br><span class="line">            _skip_list_level --; </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Successfully deleted key : "</span>&lt;&lt; key &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        _element_count --;</span><br><span class="line">        mtx.unlock();</span><br><span class="line">    	<span class="keyword">return</span> <span class="number">0</span>; <span class="comment">// è¿”å›å€¼ 0 è¯´æ˜æˆåŠŸåˆ é™¤</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2. ç¬”è€…æ·»åŠ äº†æ²¡æœ‰è¯¥é”®æ—¶çš„æƒ…å†µï¼Œæ‰“å°è¾“å‡ºæç¤º</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; key &lt;&lt; <span class="string">" is not exist, please check your input !\n"</span>;</span><br><span class="line">        mtx.unlock();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>; <span class="comment">// è¿”å›å€¼ -1 è¯´æ˜æ²¡æœ‰è¯¥é”®å€¼</span></span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><font color="FF8888">è¯´æ˜</font></strong> ğŸŒ ï¼šä»£ç è¯¦ç»†è§£é‡Šè§æ³¨é‡Šã€‚</p><hr><h4 id="2-4-6-update-element"><a class="header-anchor" href="#2-4-6-update-element">Â¶</a>2.4.6 update_element()</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç¬”è€…æ·»åŠ äº†ä¿®æ”¹å€¼çš„æ“ä½œ</span></span><br><span class="line"><span class="comment">// 1. å¦‚æœå½“å‰é”®å­˜åœ¨ï¼Œæ›´æ–°å€¼</span></span><br><span class="line"><span class="comment">// 2. å¦‚æœå½“å‰é”®ä¸å­˜åœ¨ï¼Œé€šè¿‡ flag æŒ‡ç¤ºæ˜¯å¦åˆ›å»ºè¯¥é”® (é»˜è®¤false)</span></span><br><span class="line"><span class="comment">// 	2.1 flag = true ï¼šåˆ›å»º key value</span></span><br><span class="line"><span class="comment">// 	2.2 flag = false : è¿”å›é”®ä¸å­˜åœ¨</span></span><br><span class="line"><span class="comment">// è¿”å›å€¼ 1 è¡¨ç¤ºæ›´æ–°æˆåŠŸ, è¿”å›å€¼ 0 è¡¨ç¤ºåˆ›å»ºæˆåŠŸ, è¿”å›å€¼ -1 è¡¨ç¤ºæ›´æ–°å¤±è´¥ä¸”åˆ›å»ºå¤±è´¥</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> K, <span class="keyword">typename</span> V&gt;</span><br><span class="line"><span class="keyword">int</span> SkipList&lt;K, V&gt;::update_element(<span class="keyword">const</span> K key, <span class="keyword">const</span> V value, <span class="keyword">bool</span> flag = <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="comment">// åŒ insert,delete æ“ä½œ</span></span><br><span class="line">    mtx1.lock(); <span class="comment">// æ’å…¥æ“ä½œï¼ŒåŠ é”, ä½¿ç”¨ mtx1</span></span><br><span class="line">    Node&lt;K, V&gt; *current = <span class="keyword">this</span>-&gt;_header;</span><br><span class="line">    Node&lt;K, V&gt; *update[_max_level + <span class="number">1</span>];</span><br><span class="line">    <span class="built_in">memset</span>(update, <span class="number">0</span>, <span class="keyword">sizeof</span>(Node&lt;K, V&gt;*)*(_max_level + <span class="number">1</span>));  </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = _skip_list_level; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="keyword">while</span>(current-&gt;forward[i] != <span class="literal">NULL</span> &amp;&amp; current-&gt;forward[i]-&gt;get_key() &lt; key) &#123;</span><br><span class="line">            current = current-&gt;forward[i];  </span><br><span class="line">        &#125;</span><br><span class="line">        update[i] = current; </span><br><span class="line">    &#125;</span><br><span class="line">    current = current-&gt;forward[<span class="number">0</span>];</span><br><span class="line">    <span class="comment">// 1. æ’å…¥å…ƒç´ å·²ç»å­˜åœ¨</span></span><br><span class="line">    <span class="keyword">if</span> (current != <span class="literal">NULL</span> &amp;&amp; current-&gt;get_key() == key) &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"key: "</span> &lt;&lt; key &lt;&lt; <span class="string">", exists"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"old value : "</span> &lt;&lt; current-&gt;get_value() &lt;&lt; <span class="string">" --&gt; "</span>; <span class="comment">// ~ æ‰“å° old value</span></span><br><span class="line">        current-&gt;set_value(value);  <span class="comment">// é‡æ–°è®¾ç½® value, å¹¶æ‰“å°è¾“å‡ºã€‚</span></span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"new value : "</span> &lt;&lt; current-&gt;get_value() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        mtx1.unlock();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;  <span class="comment">// æ’å…¥å…ƒç´ å·²ç»å­˜åœ¨ï¼Œåªæ˜¯ä¿®æ”¹æ“ä½œï¼Œè¿”å› 1 è¯´æ˜æ›´æ–°æˆåŠŸ</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2. å¦‚æœæ’å…¥çš„å…ƒç´ ä¸å­˜åœ¨</span></span><br><span class="line">    <span class="comment">// 	2.1 flag = true,å…è®¸æ›´æ–°åˆ›å»ºæ“ä½œ,åˆ™ä½¿ç”¨ insert_element æ·»åŠ </span></span><br><span class="line">    <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">        SkipList&lt;K, V&gt;::insert_element(key, value);</span><br><span class="line">        mtx1.unlock();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;  <span class="comment">// è¯´æ˜ key ä¸å­˜åœ¨ï¼Œä½†æ˜¯åˆ›å»ºäº†å®ƒ</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 	2.1 flag = false, ä¸å…è®¸æ›´æ–°åˆ›å»ºæ“ä½œ, æ‰“å°æç¤ºä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; key &lt;&lt; <span class="string">" is not exist, please check your input !\n"</span>;</span><br><span class="line">        mtx1.unlock();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>; <span class="comment">// è¡¨ç¤º key ä¸å­˜åœ¨ï¼Œå¹¶ä¸”ä¸è¢«å…è®¸åˆ›å»º</span></span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><font color="FF8888">è¯´æ˜</font></strong> ğŸŒ ï¼šä»£ç è¯¦ç»†è§£é‡Šè§æ³¨é‡Šã€‚</p><p><strong><font color="FF8888">æ³¨æ„</font></strong> ğŸ™‹â€â™‚ ï¼šç¬”è€…æ·»åŠ äº†ä¿®æ”¹å€¼çš„æ“ä½œï¼Œå¹¶æä¾›äº†ä¸¤ç§ç±»å‹çš„æ“ä½œ</p><p>ğŸ”¹ ç¡¬æ›´æ–°ï¼šå¦‚æœé”®ä¸å­˜åœ¨ï¼Œç›´æ¥æ‰“å°æç¤ºä¿¡æ¯ <code>flag = false</code></p><p>ğŸ”¸ è½¯æ›´æ–°ï¼šå¦‚æœé”®ä¸å­˜åœ¨ï¼Œå…è®¸åˆ›å»ºå®ƒ <code>flag = true</code></p><hr><h4 id="2-4-7-search-element"><a class="header-anchor" href="#2-4-7-search-element">Â¶</a>2.4.7 search_element()</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> K, <span class="keyword">typename</span> V&gt; </span><br><span class="line"><span class="keyword">bool</span> SkipList&lt;K, V&gt;::search_element(K key) &#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"search_element..."</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    Node&lt;K, V&gt; *current = _header;</span><br><span class="line">    <span class="comment">// ä»æœ€é«˜å±‚å¼€å§‹éå†ï¼Œæ‰¾åˆ°æœ€åº•å±‚ä¸­æœ€åä¸€ä¸ªæ»¡è¶³å°äºkeyçš„èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = _skip_list_level; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="keyword">while</span> (current-&gt;forward[i] &amp;&amp; current-&gt;forward[i]-&gt;get_key() &lt; key) &#123;</span><br><span class="line">            current = current-&gt;forward[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    current = current-&gt;forward[<span class="number">0</span>]; <span class="comment">// è¯¥æ“ä½œå current-&gt;get_key &gt;= key æˆ–è€… null</span></span><br><span class="line">    <span class="comment">// æ‰¾åˆ°</span></span><br><span class="line">    <span class="keyword">if</span> (current != <span class="literal">NULL</span> &amp;&amp; current-&gt;get_key() == key) &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Found key: "</span> &lt;&lt; key &lt;&lt; <span class="string">", value: "</span> &lt;&lt; current-&gt;get_value() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// æ²¡æ‰¾åˆ°</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Not Found Key: "</span> &lt;&lt; key &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><font color="FF8888">è¯´æ˜</font></strong> ğŸŒ ï¼šä»£ç è¯¦ç»†è§£é‡Šè§æ³¨é‡Šã€‚</p><hr><h4 id="2-4-8-æ‰“å°è·³è¡¨"><a class="header-anchor" href="#2-4-8-æ‰“å°è·³è¡¨">Â¶</a>2.4.8 æ‰“å°è·³è¡¨</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> K, <span class="keyword">typename</span> V&gt; </span><br><span class="line"><span class="keyword">void</span> SkipList&lt;K, V&gt;::display_list() &#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"\n******** Skip List ********"</span>&lt;&lt;<span class="string">"\n"</span>; </span><br><span class="line">    <span class="comment">// é€å±‚æ‰“å°</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= _skip_list_level; i++) &#123;</span><br><span class="line">        Node&lt;K, V&gt; *node = <span class="keyword">this</span>-&gt;_header-&gt;forward[i]; </span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Level "</span> &lt;&lt; i &lt;&lt; <span class="string">": "</span>;</span><br><span class="line">        <span class="keyword">while</span> (node != <span class="literal">NULL</span>) &#123;</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; node-&gt;get_key() &lt;&lt; <span class="string">":"</span> &lt;&lt; node-&gt;get_value() &lt;&lt; <span class="string">";"</span>;</span><br><span class="line">            node = node-&gt;forward[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h4 id="2-4-9-æ•°æ®è½ç›˜ã€æ•°æ®åŠ è½½å‡½æ•°åŠå…¶è¾…åŠ©å‡½æ•°"><a class="header-anchor" href="#2-4-9-æ•°æ®è½ç›˜ã€æ•°æ®åŠ è½½å‡½æ•°åŠå…¶è¾…åŠ©å‡½æ•°">Â¶</a>2.4.9 æ•°æ®è½ç›˜ã€æ•°æ®åŠ è½½å‡½æ•°åŠå…¶è¾…åŠ©å‡½æ•°</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Dump data in memory to file </span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> K, <span class="keyword">typename</span> V&gt; </span><br><span class="line"><span class="keyword">void</span> SkipList&lt;K, V&gt;::dump_file() &#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"dump_file..."</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    _file_writer.<span class="built_in">open</span>(STORE_FILE);  <span class="comment">// æ‰“å¼€æ–‡ä»¶ï¼Œå†™æ“ä½œ</span></span><br><span class="line">    Node&lt;K, V&gt; *node = <span class="keyword">this</span>-&gt;_header-&gt;forward[<span class="number">0</span>]; </span><br><span class="line">    <span class="comment">// åªå†™å…¥é”®å€¼å¯¹ï¼Œæ”¾å¼ƒå±‚ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">while</span> (node != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="comment">// æ–‡ä»¶å†™å…¥ï¼ˆkey value ä»¥ : ä¸ºåˆ†éš”ç¬¦ï¼‰ï¼ŒåŠä¿¡æ¯æ‰“å°</span></span><br><span class="line">        _file_writer &lt;&lt; node-&gt;get_key() &lt;&lt; <span class="string">":"</span> &lt;&lt; node-&gt;get_value() &lt;&lt; <span class="string">"\n"</span>; </span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; node-&gt;get_key() &lt;&lt; <span class="string">":"</span> &lt;&lt; node-&gt;get_value() &lt;&lt; <span class="string">";\n"</span>;   </span><br><span class="line">        node = node-&gt;forward[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    _file_writer.<span class="built_in">flush</span>();</span><br><span class="line">    _file_writer.<span class="built_in">close</span>();</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Load data from disk</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> K, <span class="keyword">typename</span> V&gt; </span><br><span class="line"><span class="keyword">void</span> SkipList&lt;K, V&gt;::load_file() &#123;</span><br><span class="line">    _file_reader.<span class="built_in">open</span>(STORE_FILE);  <span class="comment">// æ‰“å¼€æ–‡ä»¶ï¼Œè¯»æ“ä½œ</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"load_file..."</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> <span class="built_in">line</span>;</span><br><span class="line">    <span class="comment">// key ä¸ value æ˜¯ä¸€ä¸ªæŒ‡å‘ string å¯¹è±¡çš„æŒ‡é’ˆ</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span>* key = <span class="keyword">new</span> <span class="built_in">std</span>::<span class="built_in">string</span>();</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span>* value = <span class="keyword">new</span> <span class="built_in">std</span>::<span class="built_in">string</span>();</span><br><span class="line">    <span class="keyword">while</span> (getline(_file_reader, <span class="built_in">line</span>)) &#123; <span class="comment">// ä¸€è¡Œä¸€è¡Œå†™å…¥</span></span><br><span class="line">        get_key_value_from_string(<span class="built_in">line</span>, key, value);  <span class="comment">// è¾…åŠ©å‡½æ•°</span></span><br><span class="line">        <span class="keyword">if</span> (key-&gt;empty() || value-&gt;empty()) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// é‡æ–°è½½å…¥è¿‡ç¨‹ä½¿ç”¨ insert_element()</span></span><br><span class="line">        <span class="comment">// æ‰€ä»¥å±‚ä¹‹é—´çš„å…³ç³»(å„èŠ‚ç‚¹çš„å±‚é«˜)å¯èƒ½å‘ç”Ÿå˜åŒ–, æ‰€ä»¥ä¸ä¹‹å‰çš„SkipListä¸åŒ</span></span><br><span class="line">        insert_element(*key, *value);  </span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"key:"</span> &lt;&lt; *key &lt;&lt; <span class="string">"value:"</span> &lt;&lt; *value &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    _file_reader.<span class="built_in">close</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾…åŠ©å‡½æ•°</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> K, <span class="keyword">typename</span> V&gt;</span><br><span class="line"><span class="keyword">void</span> SkipList&lt;K, V&gt;::get_key_value_from_string(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span>&amp; str, <span class="built_in">std</span>::<span class="built_in">string</span>* key, <span class="built_in">std</span>::<span class="built_in">string</span>* value) &#123;</span><br><span class="line">    <span class="keyword">if</span>(!is_valid_string(str)) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åˆ†éš”ç¬¦ä¹‹å‰çš„ä¸º key, åˆ†éš”ç¬¦ä¹‹åçš„ä¸º value</span></span><br><span class="line">    *key = str.substr(<span class="number">0</span>, str.<span class="built_in">find</span>(delimiter));  </span><br><span class="line">    *value = str.substr(str.<span class="built_in">find</span>(delimiter) + <span class="number">1</span>, str.length()); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> K, <span class="keyword">typename</span> V&gt;</span><br><span class="line"><span class="keyword">bool</span> SkipList&lt;K, V&gt;::is_valid_string(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span>&amp; str) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (str.empty()) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ²¡æœ‰å‘ç°åˆ†éš”ç¬¦</span></span><br><span class="line">    <span class="keyword">if</span> (str.<span class="built_in">find</span>(delimiter) == <span class="built_in">std</span>::<span class="built_in">string</span>::npos) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><font color="FF8888">è¯´æ˜</font></strong> ğŸŒ ï¼šä»£ç è¯¦ç»†è§£é‡Šè§æ³¨é‡Šã€‚</p><hr><h4 id="2-4-10-clear"><a class="header-anchor" href="#2-4-10-clear">Â¶</a>2.4.10 clear()</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> K, <span class="keyword">typename</span> V&gt; </span><br><span class="line"><span class="keyword">void</span> SkipList&lt;K, V&gt;::<span class="built_in">clear</span>() &#123; </span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"clear ..."</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    Node&lt;K, V&gt; *node = <span class="keyword">this</span>-&gt;_header-&gt;forward[<span class="number">0</span>]; </span><br><span class="line">    <span class="comment">// åˆ é™¤èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">while</span> (node != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        Node&lt;K, V&gt; *temp = node;</span><br><span class="line">        node = node-&gt;forward[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">delete</span> temp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// é‡æ–°åˆå§‹åŒ– _header</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= _max_level; i++) &#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;_header-&gt;forward[i] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>-&gt;_skip_list_level = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">this</span>-&gt;_element_count = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><font color="FF8888">è¯´æ˜</font></strong> ğŸŒ ï¼šä»£ç è¯¦ç»†è§£é‡Šè§æ³¨é‡Šã€‚</p><p><strong><font color="FF8888">æ³¨æ„</font></strong> ğŸ™‹â€â™‚ ï¼šæ¸…ç©ºé™¤äº†å¤´èŠ‚ç‚¹ä»¥å¤–çš„èŠ‚ç‚¹å¹¶ä¸”å¤´èŠ‚ç‚¹ <strong>forward</strong> åˆå§‹åŒ–ï¼›</p><hr><h2 id="3-é¡¹ç›®æµ‹è¯•"><a class="header-anchor" href="#3-é¡¹ç›®æµ‹è¯•">Â¶</a>3 é¡¹ç›®æµ‹è¯•</h2><h3 id="3-1-skiplist-h-æµ‹è¯•"><a class="header-anchor" href="#3-1-skiplist-h-æµ‹è¯•">Â¶</a>3.1 <code>skiplist.h</code> æµ‹è¯•</h3><p>é’ˆå¯¹æ‰€æœ‰æä¾›çš„ API è¿›è¡Œæµ‹è¯•ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"skiplist.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FILE_PATH <span class="meta-string">"./store/dumpFile"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    SkipList&lt;std::string, std::string&gt; skipList(6);</span><br><span class="line">    <span class="comment">// insert æµ‹è¯•</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"--- insert æµ‹è¯• ---"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">	skipList.insert_element(<span class="string">"1"</span>, <span class="string">" one"</span>); </span><br><span class="line">	skipList.insert_element(<span class="string">"2"</span>, <span class="string">" two"</span>); </span><br><span class="line">	skipList.insert_element(<span class="string">"3"</span>, <span class="string">" three"</span>); </span><br><span class="line">	skipList.insert_element(<span class="string">"abc"</span>, <span class="string">" æµ‹è¯•1"</span>); </span><br><span class="line">    skipList.insert_element(<span class="string">"ä¸­æ–‡"</span>, <span class="string">" æµ‹è¯•2"</span>); </span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"skipList size after insert_element(): "</span> &lt;&lt; skipList.<span class="built_in">size</span>() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>; <span class="comment">// 5</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">// search æµ‹è¯•</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"--- search æµ‹è¯• ---"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    skipList.search_element(<span class="string">"3"</span>);</span><br><span class="line">    skipList.search_element(<span class="string">"ä¸­æ–‡"</span>);</span><br><span class="line">    skipList.search_element(<span class="string">"4"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// delete æµ‹è¯•</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"--- delete æµ‹è¯• ---"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    skipList.delete_element(<span class="string">"3"</span>);  <span class="comment">// æˆåŠŸ</span></span><br><span class="line">    skipList.delete_element(<span class="string">"5"</span>);  <span class="comment">// å¤±è´¥</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"skipList size after delete_element(): "</span> &lt;&lt; skipList.<span class="built_in">size</span>() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>; <span class="comment">// 4</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// update æµ‹è¯•</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"--- update æµ‹è¯• ---"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    skipList.update_element(<span class="string">"abc"</span>, <span class="string">" update æµ‹è¯•"</span>);</span><br><span class="line">    skipList.update_element(<span class="string">"5"</span>, <span class="string">" update_false æµ‹è¯•"</span>);</span><br><span class="line">    skipList.update_element(<span class="string">"5"</span>, <span class="string">" update_true æµ‹è¯•"</span>, <span class="literal">true</span>);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"skipList size after update_element(): "</span> &lt;&lt; skipList.<span class="built_in">size</span>() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>; <span class="comment">// 5</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// dump_file æµ‹è¯•</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"--- dump_file æµ‹è¯• ---"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    skipList.dump_file();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// display æµ‹è¯•</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"--- display æµ‹è¯• ---"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    skipList.display_list();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// clear æµ‹è¯•</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"--- clear æµ‹è¯• ---"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    skipList.<span class="built_in">clear</span>();</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"skipList size after clear(): "</span> &lt;&lt; skipList.<span class="built_in">size</span>() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>; <span class="comment">// 0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// load_file æµ‹è¯•</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"--- load_file æµ‹è¯• ---"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    skipList.load_file();</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"skipList size after load_file(): "</span> &lt;&lt; skipList.<span class="built_in">size</span>() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>; <span class="comment">// 4</span></span><br><span class="line">    skipList.display_list();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><font color="FF8888">æµ‹è¯•ç»“æœ</font></strong> â­ï¸</p><p>ğŸ”¹ æ’å…¥æ“ä½œï¼š</p><img src="/Database/Skiplist-CPP/insert_test.png" style="zoom:61%"><p>ğŸ”¸ æŸ¥æ‰¾æ“ä½œï¼š</p><img src="/Database/Skiplist-CPP/search_test.png" style="zoom:61%"><p>ğŸ”¹ æ›´æ–°æ“ä½œï¼š</p><img src="/Database/Skiplist-CPP/update_test.png" style="zoom:61%"><p>ğŸ”¸ åˆ é™¤æ“ä½œï¼š</p><img src="/Database/Skiplist-CPP/delete_test.png" style="zoom:61%"><p>ğŸ”¹ æ•°æ®è½ç›˜æ“ä½œï¼š</p><p><img src="/Database/Skiplist-CPP/dump_test.png" style="zoom:61%"> <img src="/Database/Skiplist-CPP/dumpFile.png" style="zoom:61%"></p><p>ğŸ”¸ æ‰“å°è·³è¡¨æ“ä½œï¼š</p><img src="/Database/Skiplist-CPP/display_test.png" style="zoom:61%"><p>ğŸ”¹ æ¸…ç©ºè·³è¡¨æ“ä½œï¼š</p><img src="/Database/Skiplist-CPP/clear_test.png" style="zoom:61%"><p>ğŸ”¸ æ•°æ®åŠ è½½æ“ä½œï¼š</p><img src="/Database/Skiplist-CPP/load_test.png" style="zoom:61%"><p>ğŸ”¹ åŠ è½½åçš„è·³è¡¨ï¼š</p><img src="/Database/Skiplist-CPP/display_test2.png" style="zoom:61%"><p><strong><font color="FF8888">æ³¨æ„</font></strong> ğŸ™‹â€â™‚ ï¼š</p><p>1ï¸âƒ£ æ•°æ®è½ç›˜åªæ˜¯å­˜å‚¨äº†é”®å€¼å¯¹ï¼›</p><p>2ï¸âƒ£ æ•°æ®åŠ è½½æ˜¯æŒ‰ç…§æ–‡ä»¶ä¸­çš„é”®å€¼å¯¹é‡æ–°è¿›è¡Œ <code>insert</code> æ“ä½œ;</p><p>3ï¸âƒ£ æ•°æ®åŠ è½½åçš„è·³è¡¨èŠ‚ç‚¹æ•°å’Œå†…å®¹ç›¸åŒï¼Œä½†æ˜¯å±‚æ•°å’Œä¹‹é—´çš„å…³ç³»å¯èƒ½å˜åŒ–ã€‚</p><hr><h3 id="3-2-å¢åˆ æ”¹æŸ¥-QPS-æµ‹è¯•"><a class="header-anchor" href="#3-2-å¢åˆ æ”¹æŸ¥-QPS-æµ‹è¯•">Â¶</a>3.2 å¢åˆ æ”¹æŸ¥ QPS æµ‹è¯•</h3><p>å¯¹å¢åˆ æ”¹æŸ¥è¿›è¡Œæµ‹è¯•ã€‚æµ‹è¯•æ–¹æ³•ï¼šè®¾å®šå›ºå®šçš„æ“ä½œæ•°ï¼Œè®¾ç½®å±‚é«˜ä¸º 18ï¼Œé‡‡ç”¨éšæœºæ’å…¥æ•°æ®ï¼Œçœ‹å„ä¸ªæ“ä½œè¿è¡Œæ—¶é—´ã€‚</p><p>å…·ä½“ä»£ç è§ï¼š<code>stress-test/stress_test.cpp</code></p><p><strong><font color="008F88">è¿è¡Œè®¾å¤‡</font></strong> ï¼šé˜¿é‡Œäº‘æœåŠ¡å™¨ ECS å…±äº«å‹ n4 (1æ ¸2G, 1 M å¸¦å®½)</p><p><strong><font color="008F88">è¿è¡Œç»“æœ</font></strong> ï¼š</p><img src="/Database/Skiplist-CPP/qps_test.png" style="zoom:61%"><p><strong><font color="008F88">ç»“æœç»Ÿè®¡</font></strong> ï¼š</p><table><thead><tr><th style="text-align:center">å…·ä½“æ“ä½œ\æ•°æ®è§„æ¨¡</th><th style="text-align:center">10 w</th><th style="text-align:center">50 w</th><th style="text-align:center">100 w</th></tr></thead><tbody><tr><td style="text-align:center">æ’å…¥</td><td style="text-align:center">0.099330 s</td><td style="text-align:center">0.840242 s</td><td style="text-align:center">2.09992 s</td></tr><tr><td style="text-align:center">åˆ é™¤</td><td style="text-align:center">0.084905 s</td><td style="text-align:center">0.777721 s</td><td style="text-align:center">1.97519 s</td></tr><tr><td style="text-align:center">ä¿®æ”¹</td><td style="text-align:center">0.106549 s</td><td style="text-align:center">0.971254 s</td><td style="text-align:center">2.42625 s</td></tr><tr><td style="text-align:center">æŸ¥çœ‹</td><td style="text-align:center">0.089328 s</td><td style="text-align:center">0.862964 s</td><td style="text-align:center">2.15155 s</td></tr></tbody></table><p>ä»¥ 100 w æ•°æ®ç»“æœè®¡ç®— QPS:</p><p>ğŸ”¹ <strong><font color="FF8888">æ’å…¥</font></strong> ï¼š47.62 w ğŸ”¸ <strong><font color="FF8888">åˆ é™¤</font></strong> ï¼š50. 63 w ğŸ”¹ <strong><font color="FF8888">ä¿®æ”¹</font></strong> ï¼š41.22 w ğŸ”¸ <strong><font color="FF8888">æŸ¥çœ‹</font></strong> ï¼š46.48 w</p><p>ğŸ˜² ä¸çŸ¥ä¸ºä»€ä¹ˆï¼Œæ¯”é¡¹ç›® README æ–‡æ¡£ä¸­æµ‹è¯•çš„ç»“æœè¦å¿«ä¸€å€ã€‚</p><!-- rebuild by neat -->]]></content>
      <categories>
        <category>Database</category>
      </categories>
      <tags>
        <tag>Database</tag>
      </tags>
  </entry>
  <entry>
    <title>Redisæ•°æ®ç»“æ„ä¸å¯¹è±¡</title>
    <url>/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/</url>
    <content><![CDATA[<!-- build time:Tue Jun 22 2021 17:02:33 GMT+0800 (GMT+08:00) --><a id="more"></a><h1>Redis æ•°æ®ç»“æ„ä¸å¯¹è±¡</h1><p>ä¸‹æ–‡ä»‹ç»äº† 6 ç§æ•°æ®ç»“æ„ ğŸ±</p><ul><li>ç®€å•åŠ¨æ€å­—ç¬¦ä¸²</li><li>é“¾è¡¨</li><li>å­—å…¸</li><li>è·³è·ƒè¡¨</li><li>æ•´æ•°é›†åˆ</li><li>å‹ç¼©åˆ—è¡¨</li></ul><p>5 ç§å¯¹è±¡ç±»å‹ ğŸ¶</p><ul><li>å­—ç¬¦ä¸²å¯¹è±¡</li><li>åˆ—è¡¨å¯¹è±¡</li><li>å“ˆå¸Œå¯¹è±¡</li><li>é›†åˆå¯¹è±¡</li><li>æœ‰åºé›†åˆå¯¹è±¡</li></ul><hr><h2 id="1-æ•°æ®ç»“æ„"><a class="header-anchor" href="#1-æ•°æ®ç»“æ„">Â¶</a>1 æ•°æ®ç»“æ„</h2><h3 id="1-1-ç®€å•åŠ¨æ€å­—ç¬¦ä¸²"><a class="header-anchor" href="#1-1-ç®€å•åŠ¨æ€å­—ç¬¦ä¸²">Â¶</a>1.1 ç®€å•åŠ¨æ€å­—ç¬¦ä¸²</h3><h4 id="1-1-1-ç»“æ„"><a class="header-anchor" href="#1-1-1-ç»“æ„">Â¶</a>1.1.1 ç»“æ„</h4><p>Redis æ²¡æœ‰ç›´æ¥ä½¿ç”¨ C è¯­è¨€ä¼ ç»Ÿçš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œè€Œæ˜¯è‡ªå·±æ„å»ºäº†ä¸€ç§åä¸º<strong>ç®€å•åŠ¨æ€å­—ç¬¦ä¸²</strong>ï¼ˆsimple dynamic stringï¼Œ<strong>SDS</strong>ï¼‰çš„æŠ½è±¡ç±»å‹ï¼Œå¹¶ä¸” <strong>SDS</strong> ä½œä¸º Redis çš„é»˜è®¤å­—ç¬¦ä¸²è¡¨ç¤ºã€‚</p><p>å…¶ç»“æ„å®šä¹‰å¦‚ä¸‹ï¼š</p><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/SDSç»“æ„.png" style="zoom:61%"><p><strong><font color="FF8888">æ³¨æ„</font></strong>ï¼šğŸ™‹</p><p>ğŸ”¹ <code>buf</code> å±æ€§æ˜¯ä¸€ä¸ª char ç±»å‹çš„æ•°ç»„ï¼Œæ•°ç»„æœ€åä¸€ä¸ªå­—èŠ‚ä¿å­˜äº†ç©ºå­—ç¬¦ <code>\0</code>ï¼›</p><p>ğŸ”¸ <code>len</code> å±æ€§é•¿åº¦å¹¶ä¸åŒ…æ‹¬ <code>buf</code> æœ€åä¸€ä¸ªç©ºå­—ç¬¦ï¼›</p><p>ğŸ”¹ <code>free</code> è¡¨ç¤ºè¯¥ <strong>SDS</strong> ä¸­ <code>buf</code> å‰©ä½™çš„å­—èŠ‚æ•°ï¼›</p><p>ğŸ”¸ <code>buf</code> çš„çœŸå®é•¿åº¦ä¸º <code>len + free + 1</code>ã€‚</p><hr><h4 id="1-1-2-C-å­—ç¬¦ä¸²å’Œ-SDS-ä¹‹é—´çš„åŒºåˆ«"><a class="header-anchor" href="#1-1-2-C-å­—ç¬¦ä¸²å’Œ-SDS-ä¹‹é—´çš„åŒºåˆ«">Â¶</a>1.1.2 C å­—ç¬¦ä¸²å’Œ SDS ä¹‹é—´çš„åŒºåˆ«</h4><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/SDSä¸C_string åŒºåˆ«.png" style="zoom:61%"><p>1ï¸âƒ£ <strong>SDS</strong> å¯ä»¥ç›´æ¥é€šè¿‡ <code>len</code> å­—æ®µæ¥è·å–é•¿åº¦</p><p>2ï¸âƒ£ <strong>SDS</strong> åœ¨è¿›è¡Œæ“ä½œä¹‹å‰ä¼šåˆ¤æ–­ç¼“å†²åŒºå¤§å°</p><p>3ï¸âƒ£ <strong>SDS</strong> ä½¿ç”¨ <strong><font color="F88F00">ç©ºé—´é¢„åˆ†é…</font></strong> å’Œ <strong><font color="F88F00">æƒ°æ€§ç©ºé—´é‡Šæ”¾</font></strong> æ¥å‡å°‘ä¿®æ”¹å­—ç¬¦ä¸²æ—¶å¸¦æ¥çš„å†…å­˜é‡åˆ†é…æ¬¡æ•°</p><p>4ï¸âƒ£ <strong>SDS</strong> çš„ <code>buf</code> å¹¶ä¸æ˜¯ç”¨æ¥ä¿å­˜å­—ç¬¦ï¼Œè€Œæ˜¯ç”¨æ¥ä¿å­˜ä¸€ç³»åˆ—äºŒè¿›åˆ¶æ•°æ®</p><p>5ï¸âƒ£ <strong>SDS</strong> çš„ API æ€»ä¼šå°† <strong>SDS</strong> ä¿å­˜çš„æ•°æ®çš„æœ«å°¾è®¾ç½®ä¸ºç©ºå­—ç¬¦ï¼Œå¹¶ä¸”æ€»ä¼šåœ¨ <code>buf</code> æ•°ç»„åˆ†é…ç©ºé—´å¤šåˆ†é…ä¸€ä¸ªå­—èŠ‚æ¥å®¹çº³è¿™ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥å¯ä»¥è®©ä¿å­˜æ–‡æœ¬æ•°æ®çš„ <strong>SDS</strong> é‡ç”¨ä¸€éƒ¨åˆ† <code>&lt;string.h&gt;</code> åº“å®šä¹‰çš„å‡½æ•°ã€‚</p><p><strong><font color="FF8888">æ³¨æ„</font></strong>ï¼šğŸ™‹â€â™‚</p><p><strong><font color="F88F00">ç©ºé—´é¢„åˆ†é…</font></strong> ç”¨äºä¼˜åŒ– SDS çš„å­—ç¬¦ä¸²å¢é•¿æ“ä½œï¼šå½“ SDS çš„ API å¯¹ä¸€ä¸ª SDS è¿›è¡Œä¿®æ”¹ï¼Œå¹¶ä¸”éœ€è¦å¯¹ SDS è¿›è¡Œç©ºé—´æ‰©å±•çš„æ—¶å€™ï¼Œç¨‹åºä¸ä»…ä¼šä¸º SDS åˆ†é…ä¿®æ”¹æ‰€å¿…é¡»è¦çš„ç©ºé—´ï¼Œè¿˜ä¼šä¸º SDS åˆ†é…é¢å¤–çš„æœªä½¿ç”¨ç©ºé—´ã€‚</p><p>æ ¹æ® SDS çš„é•¿åº¦åˆ†ä¸ºå¦‚ä¸‹ä¸¤ç§ç­–ç•¥ï¼š</p><p>ğŸ”¹ <em>len</em> &lt; 1 <em>MBâ€‹</em>ï¼Œå…±åˆ†é… 2 * <em>len</em> + 1 ç»™ <code>buf</code>ï¼Œæ­¤æ—¶å­—æ®µ <code>len</code> = <em>len</em>ï¼Œ <code>free</code> = <em>len</em></p><p>ğŸ”¸ <em>len</em> $\geq$ 1 <em>MB</em>ï¼Œå…±åˆ†é… <em>len</em> + 1 <em>MB</em> + 1 ç»™ <code>buf</code>ï¼Œæ­¤æ—¶å­—æ®µ <code>len</code> = <em>len</em>ï¼Œ<code>free</code> = 1 <em>MB</em></p><p><strong><font color="F88F00">æƒ°æ€§ç©ºé—´é‡Šæ”¾</font></strong> ç”¨äºä¼˜åŒ– SDS çš„å­—ç¬¦ä¸²ç¼©çŸ­æ“ä½œï¼šå½“ SDS çš„ API éœ€è¦ç¼©çŸ­ SDS ä¿å­˜çš„å­—ç¬¦ä¸²æ—¶ï¼Œç¨‹åºå¹¶ä¸ç«‹å³ä½¿ç”¨å†…å­˜é‡åˆ†é…æ¥å›æ”¶ç¼©çŸ­åå¤šå‡ºæ¥çš„å­—èŠ‚ï¼Œè€Œæ˜¯ä½¿ç”¨ free å±æ€§å°†è¿™äº›å­—èŠ‚çš„æ•°é‡è®°å½•èµ·æ¥ï¼Œå¹¶ç­‰å¾…å°†æ¥ä½¿ç”¨ã€‚</p><p>äºæ­¤åŒæ—¶ï¼ŒSDS ä¹Ÿæä¾›äº†ç›¸åº”çš„ APIï¼Œè®©æˆ‘ä»¬å¯ä»¥åœ¨æœ‰éœ€è¦æ—¶å€™ï¼ŒçœŸæ­£åœ°é‡Šæ”¾ SDS çš„æœªä½¿ç”¨ç©ºé—´ï¼Œæ‰€ä»¥ä¸ç”¨æ‹…å¿ƒæƒ°æ€§ç©ºé—´é‡Šæ”¾ç­–ç•¥ä¼šé€ æˆå†…å­˜æµªè´¹ã€‚</p><hr><h4 id="1-1-3-SDS-API"><a class="header-anchor" href="#1-1-3-SDS-API">Â¶</a>1.1.3 SDS API</h4><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/SDS_API1.png" style="zoom:61%"> <img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/SDS_API2.png" style="zoom:65%"><blockquote><p>ã€ŠRedis è®¾è®¡ä¸å®ç°ã€‹ ç¬¬äºŒç« </p></blockquote><hr><h3 id="1-2-é“¾è¡¨"><a class="header-anchor" href="#1-2-é“¾è¡¨">Â¶</a>1.2 é“¾è¡¨</h3><h4 id="1-2-1-é“¾è¡¨å’Œé“¾è¡¨èŠ‚ç‚¹çš„ç»“æ„ä¸å®ç°"><a class="header-anchor" href="#1-2-1-é“¾è¡¨å’Œé“¾è¡¨èŠ‚ç‚¹çš„ç»“æ„ä¸å®ç°">Â¶</a>1.2.1 é“¾è¡¨å’Œé“¾è¡¨èŠ‚ç‚¹çš„ç»“æ„ä¸å®ç°</h4><p>é“¾è¡¨èŠ‚ç‚¹ç»“æ„å®šä¹‰å¦‚ä¸‹ï¼š</p><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/listNodeç»“æ„.png" style="zoom:50%"><p>å¤šä¸ª <strong>listNode</strong> å¯ä»¥é€šè¿‡ <code>prev</code> å’Œ <code>next</code> æŒ‡é’ˆç»„æˆåŒç«¯é“¾è¡¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/listNodes.png" style="zoom:61%"><p>è™½ç„¶ä»…ä»…ä½¿ç”¨å¤šä¸ª <strong>listNode</strong> ç»“æ„å°±å¯ä»¥ç»„æˆé“¾è¡¨ï¼Œä½†æ˜¯ <code>adlist.h/list</code> æ¥æŒæœ‰é“¾è¡¨ï¼Œæ“ä½œèµ·æ¥ä¼šæ›´æ–¹ä¾¿ï¼š</p><p><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/list.png" alt></p><p><strong>list</strong> ç»“æ„ä¸ºé“¾è¡¨æä¾›äº†è¡¨å¤´æŒ‡é’ˆ <code>head</code>ã€è¡¨å°¾æŒ‡é’ˆ <code>tail</code>ï¼Œä»¥åŠé“¾è¡¨é•¿åº¦è®¡æ•°å™¨ <code>len</code>ï¼Œè€Œ <code>dup</code>ã€<code>free</code> å’Œ <code>match</code>æˆå‘˜åˆ™æ˜¯ç”¨äºå®ç°å¤šæ€é“¾è¡¨æ‰€éœ€çš„ç±»å‹ç‰¹å®šå‡½æ•°ï¼š</p><p>â—»ï¸ <code>dup</code> å‡½æ•°ç”¨äºå¤åˆ¶é“¾è¡¨èŠ‚ç‚¹æ‰€ä¿å­˜çš„å€¼ï¼›</p><p>â—»ï¸ <code>free</code> å‡½æ•°ç”¨äºé‡Šæ”¾é“¾è¡¨èŠ‚ç‚¹æ‰€ä¿å­˜çš„å€¼ï¼›</p><p>â—»ï¸ <code>match</code> å‡½æ•°åˆ™ç”¨äºå¯¹æ¯”é“¾è¡¨èŠ‚ç‚¹æ‰€ä¿å­˜çš„å€¼å’Œå¦ä¸€ä¸ªè¾“å…¥å€¼æ˜¯å¦ç›¸ç­‰ã€‚</p><p><strong>list</strong> ç»“æ„ å’Œ <strong>listNode</strong> ç»“æ„ç»„æˆçš„é“¾è¡¨å¦‚ä¸‹ï¼š</p><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/list_listnode.png" style="zoom:61%"><p><strong><font color="FF8888">æ€»ç»“</font></strong>ï¼šâ­ï¸</p><p>ğŸ”¹ åŒç«¯é“¾è¡¨ï¼Œæ— ç¯ï¼Œé¦–ä½æŒ‡å‘ NULLï¼›</p><p>ğŸ”¸ å­—æ®µï¼š<code>head</code>ï¼Œ<code>tail</code> è®©ç¨‹åºè·å–è¡¨å¤´æˆ–è€…è¡¨å°¾èŠ‚ç‚¹æ—¶é—´å¤æ‚åº¦ä¸º $O(1)$ï¼›</p><p>ğŸ”¹ å­—æ®µï¼š<code>len</code> è®©ç¨‹åºè·å–é“¾è¡¨ä¸­èŠ‚ç‚¹æ•°é‡çš„æ—¶é—´å¤æ‚åº¦ä¸º $O(1)$ï¼›</p><p>ğŸ”¸ å¤šæ€ï¼šé“¾è¡¨èŠ‚ç‚¹ä½¿ç”¨ <strong>void</strong>* æŒ‡é’ˆæ¥ä¿å­˜èŠ‚ç‚¹å€¼ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ <strong>list</strong> ç»“æ„çš„ <code>dup</code>ã€<code>free</code> å’Œ <code>match</code> ä¸ºèŠ‚ç‚¹å€¼è®¾ç½®ç±»å‹ç‰¹å®šå‡½æ•°ï¼Œæ‰€ä»¥é“¾è¡¨å¯ä»¥ç”¨äºä¿å­˜ä¸åŒç±»å‹çš„å€¼ã€‚</p><hr><h4 id="1-2-2-é“¾è¡¨å’Œé“¾è¡¨èŠ‚ç‚¹çš„-API"><a class="header-anchor" href="#1-2-2-é“¾è¡¨å’Œé“¾è¡¨èŠ‚ç‚¹çš„-API">Â¶</a>1.2.2 é“¾è¡¨å’Œé“¾è¡¨èŠ‚ç‚¹çš„ API</h4><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/listAPI1.png" style="zoom:61%"> <img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/listAPI2.png" style="zoom:61%"> <img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/listAPI3.png" style="zoom:61%"><blockquote><p>ã€ŠRedis è®¾è®¡ä¸å®ç°ã€‹ ç¬¬ä¸‰ç« </p></blockquote><hr><h3 id="1-3-å­—å…¸"><a class="header-anchor" href="#1-3-å­—å…¸">Â¶</a>1.3 å­—å…¸</h3><h4 id="1-3-1-å“ˆå¸Œè¡¨"><a class="header-anchor" href="#1-3-1-å“ˆå¸Œè¡¨">Â¶</a>1.3.1 å“ˆå¸Œè¡¨</h4><p>Redis å­—å…¸éœ€è¦ä½¿ç”¨å“ˆå¸Œè¡¨ï¼Œå®ƒç”± <code>dict.h/dictht</code> ç»“æ„å®šä¹‰ï¼š</p><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/dicthtå®šä¹‰.png" style="zoom:61%"><p><strong><font color="FF8888">æ³¨æ„</font></strong>ï¼šğŸ™‹</p><p>ğŸ”¹ <code>table</code> å±æ€§æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ æŒ‡å‘ <code>dict.h/dictEntry</code> ç»“æ„çš„æŒ‡é’ˆï¼Œ<code>dictEntry</code> ç»“æ„ä¿å­˜ç€ä¸€ä¸ªé”®å€¼å¯¹ï¼›</p><p>ğŸ”¸ <code>size</code> å±æ€§è®°å½•äº†å“ˆå¸Œè¡¨å¤§å°ï¼Œä¹Ÿå³ <code>table</code> æ•°ç»„çš„å¤§å°ï¼›</p><p>ğŸ”¹ <code>used</code> å±æ€§è®°å½•äº†å“ˆå¸Œè¡¨ç›®å‰å·²æœ‰èŠ‚ç‚¹çš„æ•°é‡ï¼›</p><p>ğŸ”¸ <code>sizemask</code> å±æ€§çš„å€¼æ€»æ˜¯ç­‰äº size - 1ã€‚</p><p>ä¸‹å›¾å±•ç¤ºä¸€ä¸ªç©ºçš„å“ˆå¸Œè¡¨ï¼š</p><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/dictthtsize_4_NULL.png" style="zoom:61%"><hr><h4 id="1-3-2-å“ˆå¸Œè¡¨èŠ‚ç‚¹"><a class="header-anchor" href="#1-3-2-å“ˆå¸Œè¡¨èŠ‚ç‚¹">Â¶</a>1.3.2 å“ˆå¸Œè¡¨èŠ‚ç‚¹</h4><p>å“ˆå¸Œè¡¨èŠ‚ç‚¹ä½¿ç”¨ <code>dictEntry</code> ç»“æ„è¡¨ç¤ºï¼Œæ¯ä¸ª <code>dictEntry</code> ç»“æ„éƒ½ä¿å­˜ç€ä¸€ä¸ªé”®å€¼å¯¹ï¼Œå…¶å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š</p><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/dictEntryå®šä¹‰.png" style="zoom:61%"><p><strong><font color="FF8888">æ³¨æ„</font></strong>ï¼šğŸ™‹â€â™‚</p><p>ğŸ”¹ <code>key</code> å±æ€§ä¿å­˜ç€é”®å€¼å¯¹ä¸­çš„é”®ï¼›</p><p>ğŸ”¸ <code>v</code> å±æ€§åˆ™ä¿å­˜ç€é”®å€¼å¯¹ä¸­çš„å€¼ï¼Œæ˜¯ä¸€ä¸ªè”åˆä½“ï¼Œå¯ä»¥æ˜¯ <strong>void</strong>*ï¼Œä¹Ÿå¯ä»¥æ˜¯ <strong>uint64_t</strong>ï¼Œæˆ–è€… <strong>int64_t</strong> çš„æ•´æ•°ï¼›</p><p>ğŸ”¹ <code>next</code> å±æ€§æ˜¯ä¸€ä¸ªæŒ‡å‘å¦ä¸€ä¸ªå“ˆå¸Œè¡¨èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆå¯ä»¥å°†å¤šä¸ªå“ˆå¸Œå€¼ç›¸åŒçš„é”®å€¼å¯¹è¿æ¥ï¼Œè§£å†³é”®å†²çªé—®é¢˜ã€‚</p><p>ä¸‹å›¾å±•ç¤ºä¸€ä¸ªç®€å•ä¾‹å­ï¼š</p><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/dict_collision.png" style="zoom:61%"><hr><h4 id="1-3-3-å­—å…¸"><a class="header-anchor" href="#1-3-3-å­—å…¸">Â¶</a>1.3.3 å­—å…¸</h4><p>Redis ä¸­çš„å­—å…¸ç”± <code>dict.h/dict</code> ç»“æ„è¡¨ç¤ºï¼š</p><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/dictå®šä¹‰.png" style="zoom:61%"><p><strong><font color="FF8888">æ³¨æ„</font></strong>ï¼šğŸ™‹</p><p>ğŸ”¹ <code>type</code> å±æ€§æ˜¯æŒ‡å‘ <code>dictType</code> ç»“æ„çš„æŒ‡é’ˆï¼Œæ¯ä¸ª <code>dictType</code> ç»“æ„ä¿å­˜äº†ä¸€ç°‡ç”¨äºæ“ä½œç‰¹å®šç±»å‹é”®å€¼å¯¹çš„å‡½æ•°ï¼ŒRedis ä¼šä¸ºç”¨é€”ä¸åŒå­—å…¸è®¾ç½®ä¸åŒçš„ç±»å‹ç‰¹å®šå‡½æ•°ï¼›</p><p>ğŸ”¸ <code>private</code> å±æ€§åˆ™ä¿å­˜äº†éœ€è¦ä¼ ç»™é‚£äº›ç‰¹å®šå‡½æ•°çš„å¯é€‰å‚æ•°ï¼›</p><p>ä¸Šé¢è¿™ä¸¤ä¸ªå±æ€§æ˜¯é’ˆå¯¹ä¸åŒç±»å‹çš„é”®å€¼å¯¹ï¼Œä¸ºåˆ›å»ºå¤šæ€å­—å…¸è€Œè®¾ç½®çš„ï¼›</p><p>ğŸ”¹ <code>ht</code> å±æ€§æ˜¯ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªé¡¹çš„æ•°ç»„ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸ªé¡¹éƒ½æ˜¯ä¸€ä¸ª <code>dictht</code> å“ˆå¸Œè¡¨ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå­—å…¸åªä½¿ç”¨ <code>ht[0]</code> å“ˆå¸Œè¡¨ï¼Œ<code>ht[1]</code> å“ˆå¸Œè¡¨åªä¼šåœ¨å¯¹ <code>ht[0]</code> å“ˆå¸Œè¡¨è¿›è¡Œ <strong>rehash</strong> æ—¶ä½¿ç”¨ï¼›</p><p>ğŸ”¸ <code>rehashidx</code> å±æ€§è®°å½•<strong>rehash</strong>ç›®å‰çš„è¿›åº¦ï¼Œå…¶å€¼å¯¹åº” <code>dictEntry</code> æ•°ç»„ç´¢å¼•ï¼Œæ²¡æœ‰è¿›è¡Œ<strong>rehash</strong> æ—¶ä¸º -1ã€‚</p><p>æ™®é€šçŠ¶æ€ä¸‹çš„å­—å…¸å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/dict_common_state.png" style="zoom:61%"><hr><h4 id="1-3-4-å“ˆå¸Œç®—æ³•"><a class="header-anchor" href="#1-3-4-å“ˆå¸Œç®—æ³•">Â¶</a>1.3.4 å“ˆå¸Œç®—æ³•</h4><p>éœ€è¦å°†ä¸€ä¸ªé”®å€¼å¯¹æ·»åŠ åˆ°å­—å…¸é‡Œé¢æ—¶ï¼Œç¨‹åºéœ€è¦å…ˆæ ¹æ®é”®å€¼å¯¹çš„é”®è®¡ç®—å‡ºå“ˆå¸Œå€¼å’Œç´¢å¼•å€¼ï¼Œç„¶åå†æ ¹æ®ç´¢å¼•å€¼ï¼Œå°†åŒ…å«é”®å€¼å¯¹çš„å“ˆå¸Œè¡¨èŠ‚ç‚¹æ”¾åˆ°å“ˆå¸Œè¡¨æ•°ç»„çš„æŒ‡å®šç´¢å¼•ä¸Šé¢ã€‚</p><p>Redis è®¡ç®—å“ˆå¸Œå€¼å’Œç´¢å¼•å€¼çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨å­—å…¸è®¾ç½®çš„å“ˆå¸Œå‡½æ•°ï¼Œè®¡ç®—é”® key çš„å“ˆå¸Œå€¼</span></span><br><span class="line">hash = dict-&gt;type-&gt;hashFunction(key);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨å“ˆå¸Œè¡¨çš„ sizemask å±æ€§å’Œå“ˆå¸Œå€¼ï¼Œè®¡ç®—å‡ºç´¢å¼•å€¼</span></span><br><span class="line"><span class="comment">// æ ¹æ®æƒ…å†µä¸åŒï¼Œht[x] å¯ä»¥æ˜¯ ht[0] æˆ–è€… ht[1](åœ¨rehashè¿‡ç¨‹ä¸­)</span></span><br><span class="line">index = hash &amp; dict-&gt;ht[x].sizemask;</span><br></pre></td></tr></table></figure><p>å‡è®¾ç¬¬ä¸€æ­¥è®¡ç®—å‡ºäº† <em>k0</em> çš„å“ˆå¸Œå€¼ä¸º 8ï¼Œé’ˆå¯¹ <code>ht[0].size = 4</code> çš„æƒ…å†µï¼Œ<code>index = 8 &amp; 3 = 0</code>ï¼Œæ‰€ä»¥è¯¥èŠ‚ç‚¹ä¼šè¢«æ”¾åœ¨å¦‚ä¸‹ä½ç½®ï¼š</p><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/dict_add_k0.png" style="zoom:61%"><hr><h4 id="1-3-5-è§£å†³é”®å†²çª"><a class="header-anchor" href="#1-3-5-è§£å†³é”®å†²çª">Â¶</a>1.3.5 è§£å†³é”®å†²çª</h4><p>Redis çš„å“ˆå¸Œè¡¨ä½¿ç”¨é“¾åœ°å€æ³•æ¥è§£å†³é”®å†²çªï¼Œæ¯ä¸ªå“ˆå¸Œè¡¨èŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ª<code>next</code> æŒ‡é’ˆï¼Œå¤šä¸ªå“ˆå¸Œè¡¨èŠ‚ç‚¹å¯ä»¥ç”¨ <code>next</code>æŒ‡é’ˆæ„æˆå•å‘é“¾è¡¨ï¼Œè¢«åˆ†é…åˆ°åŒä¸€ä¸ªç´¢å¼•ä¸Šçš„å¤šä¸ªèŠ‚ç‚¹å¯ä»¥ç”¨è¿™ä¸ªå•å‘é“¾è¡¨è¿æ¥èµ·æ¥ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/dict_collision_list.png" style="zoom:61%"><hr><h4 id="1-3-6-rehash"><a class="header-anchor" href="#1-3-6-rehash">Â¶</a>1.3.6 rehash</h4><p>éšç€æ“ä½œçš„ä¸æ–­æ‰§è¡Œï¼Œå“ˆå¸Œè¡¨ä¿å­˜çš„é”®å€¼ä¼šé€æ¸åœ°å¢å¤šæˆ–è€…å‡å°‘ï¼Œä¸ºäº†è®©å“ˆå¸Œè¡¨åœ°è´Ÿè½½å› å­ç»´æŒåœ¨ä¸€ä¸ªåˆç†çš„èŒƒå›´ä¹‹å†…ï¼Œå½“å“ˆå¸Œè¡¨ä¿å­˜çš„é”®å€¼å¯¹æ•°é‡å¤ªå¤šæˆ–è€…å¤ªå°‘æ—¶ï¼Œç¨‹åºéœ€è¦å¯¹å“ˆå¸Œè¡¨çš„å¤§å°è¿›è¡Œç›¸åº”çš„æ‰©å±•æˆ–æ”¶ç¼©ï¼Œå³ <strong>rehash</strong>æ“ä½œã€‚</p><h5 id="1-3-6-1-æ‰©å±•æ”¶ç¼©æ¡ä»¶"><a class="header-anchor" href="#1-3-6-1-æ‰©å±•æ”¶ç¼©æ¡ä»¶">Â¶</a>1.3.6.1 æ‰©å±•æ”¶ç¼©æ¡ä»¶</h5><p>è´Ÿè½½å› å­çš„è®¡ç®—å…¬å¼ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è´Ÿè½½å› å­ = å“ˆå¸Œè¡¨å·²ä¿å­˜èŠ‚ç‚¹æ•°é‡ / å“ˆå¸Œè¡¨å¤§å°</span></span><br><span class="line">load_factor = ht[<span class="number">0</span>].used / ht[<span class="number">0</span>].<span class="built_in">size</span></span><br></pre></td></tr></table></figure><p>å“ˆå¸Œè¡¨çš„ <strong><font color="008F88">æ‰©å±•</font></strong> çš„æ¡ä»¶ï¼š</p><p>ğŸ”¹ æœåŠ¡å™¨ç›®å‰æ²¡æœ‰æ‰§è¡Œ <code>BGSAVE</code> å‘½ä»¤æˆ–è€… <code>BGREWRITEAOF</code> å‘½ä»¤ï¼Œå¹¶ä¸” <code>load_factor &gt;= 1</code>ï¼›</p><p>ğŸ”¸ æœåŠ¡å™¨æ­£åœ¨è¿›è¡Œ <code>BGSAVE</code> å‘½ä»¤æˆ–è€… <code>BGREWRITEAOF</code> å‘½ä»¤ï¼Œå¹¶ä¸” <code>load_factor &gt;= 5</code>ã€‚</p><p>æ ¹æ® <code>BGSAVE</code> å‘½ä»¤æˆ– <code>BGREWEITEAOF</code> å‘½ä»¤æ˜¯å¦æ‰§è¡Œï¼ŒæœåŠ¡å™¨æ‰§è¡Œæ‰©å±•æ“ä½œæ‰€éœ€çš„è´Ÿè½½å› å­å¹¶ä¸ç›¸åŒï¼Œè¿™æ˜¯å› ä¸ºåœ¨æ‰§è¡Œ <code>BGSAVE</code> å‘½ä»¤æˆ– <code>BGREWRITEAOF</code> å‘½ä»¤çš„è¿‡ç¨‹ä¸­ï¼ŒRedis éœ€è¦åˆ›å»ºå½“å‰æœåŠ¡å™¨è¿›ç¨‹çš„å­è¿›ç¨‹ï¼Œè€Œå¤§å¤šæ•°æ“ä½œç³»ç»Ÿéƒ½é‡‡ç”¨<strong>å†™æ—¶å¤åˆ¶</strong>æŠ€æœ¯æ¥ä¼˜åŒ–å­è¿›ç¨‹çš„ä½¿ç”¨æ•ˆç‡ï¼Œæ‰€ä»¥åœ¨å­è¿›ç¨‹å­˜åœ¨æœŸé—´ï¼ŒæœåŠ¡å™¨ä¼šæé«˜æ‰§è¡Œæ‰©å±•æ“ä½œæ‰€éœ€çš„è´Ÿè½½å› å­ï¼Œä»è€Œå°½å¯èƒ½åœ°é¿å…åœ¨å­è¿›ç¨‹å­˜åœ¨æœŸé—´è¿›è¡Œå“ˆå¸Œè¡¨æ‰©å±•æ“ä½œï¼Œè¿™å¯ä»¥é¿å…ä¸å¿…è¦åœ°å†…å­˜å†™å…¥æ“ä½œï¼Œæœ€å¤§é™åº¦åœ°èŠ‚çº¦å†…å­˜ã€‚</p><p>å“ˆå¸Œè¡¨çš„ <strong><font color="008F88">æ”¶ç¼©</font></strong> çš„æ¡ä»¶ï¼š<code>load_factor &lt; 0.1</code></p><hr><h5 id="1-3-6-2-rehash-æ­¥éª¤"><a class="header-anchor" href="#1-3-6-2-rehash-æ­¥éª¤">Â¶</a>1.3.6.2 rehash æ­¥éª¤</h5><p>Redis å¯¹å­—å…¸åœ°å“ˆå¸Œè¡¨æ‰§è¡Œ <strong>rehash</strong> çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p><p>1ï¸âƒ£ ä¸ºå­—å…¸çš„ <code>ht[1]</code> å“ˆå¸Œè¡¨åˆ†é…ç©ºé—´ï¼Œè¿™ä¸ªå“ˆå¸Œè¡¨çš„ç©ºé—´å¤§å°å–å†³äºè¦æ‰§è¡Œçš„æ“ä½œï¼Œä»¥åŠ <code>ht[0]</code> å½“å‰åŒ…å«çš„é”®å€¼å¯¹æ•°é‡ï¼ˆä¹Ÿå³ <code>ht[0].used</code> å±æ€§çš„å€¼ï¼‰ï¼š</p><p>ğŸ”¹ <strong><font color="008F88">æ‰©å±•æ“ä½œ</font></strong>ï¼Œé‚£ä¹ˆ <code>ht[1]</code> çš„å¤§å°ä¸ºç¬¬ä¸€ä¸ªå¤§äºç­‰äº <code>ht[0].used * 2</code> çš„ $2^n$;</p><p>ğŸ”¸ <strong><font color="008F88">æ”¶ç¼©æ“ä½œ</font></strong>ï¼Œé‚£ä¹ˆ <code>ht[1]</code> çš„å¤§å°ä¸ºç¬¬ä¸€ä¸ªå¤§äºç­‰äº <code>ht[0].used</code> çš„ $2^n$ã€‚</p><p>2ï¸âƒ£ å°†ä¿å­˜åœ¨ <code>ht[0]</code> ä¸­çš„æ‰€æœ‰é”®å€¼å¯¹ <strong>rehash</strong> åˆ° <code>ht[1]</code> ä¸Šé¢ï¼š<strong>rehash</strong> æŒ‡çš„æ˜¯é‡æ–°è®¡ç®—é”®å€¼å¯¹çš„å“ˆå¸Œå€¼å’Œç´¢å¼•å€¼ï¼Œç„¶åå°†é”®å€¼å¯¹æ”¾ç½®åˆ° <code>ht[1]</code> å“ˆå¸Œè¡¨çš„æŒ‡å®šä½ç½®ä¸Šã€‚</p><p>3ï¸âƒ£ å°† <code>ht[0]</code> åŒ…å«çš„æ‰€æœ‰é”®å€¼å¯¹éƒ½è¿ç§»åˆ° <code>ht[1]</code> ä¹‹åï¼ˆ<code>ht[0]</code> å˜ä¸ºç©ºè¡¨ï¼‰ï¼Œé‡Šæ”¾ <code>ht[0]</code>ï¼Œå°† <code>ht[1]</code> è®¾ç½®ä¸º <code>ht[0]</code>ï¼Œå¹¶åœ¨ <code>ht[1]</code> æ–°åˆ›å»ºä¸€ä¸ªç©ºç™½å“ˆå¸Œè¡¨ï¼Œä¸ºä¸‹ä¸€æ¬¡ <strong>rehash</strong> åšå‡†å¤‡ã€‚</p><hr><h5 id="1-3-6-3-æ¸è¿›å¼-rehash"><a class="header-anchor" href="#1-3-6-3-æ¸è¿›å¼-rehash">Â¶</a>1.3.6.3 æ¸è¿›å¼ rehash</h5><p>ä¸Šæ–‡ <strong>rehash</strong> åŠ¨ä½œå¹¶ä¸æ˜¯ä¸€æ¬¡æ€§ã€é›†ä¸­å¼åœ°å®Œæˆåœ°ï¼Œè€Œæ˜¯åˆ†å¤šæ¬¡ã€æ¸è¿›å¼åœ°å®Œæˆåœ°ï¼Œä¸ºäº†é¿å… <strong>rehash</strong> å¯¹æœåŠ¡å™¨æ€§èƒ½é€ æˆå½±å“ã€‚æ¸è¿›å¼ <strong>rehash</strong> çš„ <strong><font color="F88F00">å¥½å¤„</font></strong> åœ¨äºå®ƒé‡‡å–åˆ†è€Œæ²»ä¹‹çš„æ–¹å¼ï¼Œå°† <strong>rehash</strong> é”®å€¼å¯¹æ‰€éœ€çš„è®¡ç®—å·¥ä½œå‡æ‘Šåˆ°å¯¹å­—å…¸çš„æ¯ä¸ªæ·»åŠ ã€åˆ é™¤ã€æŸ¥æ‰¾å’Œæ›´æ–°æ“ä½œä¸Šï¼Œä»è€Œé¿å…äº†é›†ä¸­å¼ <strong>rehash</strong> è€Œå¸¦æ¥çš„åºå¤§è®¡ç®—é‡ã€‚</p><p>ä»¥ä¸‹æ˜¯å“ˆå¸Œè¡¨æ¸è¿›å¼ <strong>rehash</strong> çš„è¯¦ç»†æ­¥éª¤ï¼š</p><p>1ï¸âƒ£ ä¸º <code>ht[1]</code> åˆ†é…ç©ºé—´ï¼Œè®©å­—å…¸åŒæ—¶æŒæœ‰ <code>ht[0]</code> å’Œ <code>ht[1]</code> ä¸¤ä¸ªå“ˆå¸Œè¡¨ã€‚(åˆ†é…ç©ºé—´ç­–ç•¥è§ä¸Š)</p><p>2ï¸âƒ£ åœ¨å­—å…¸ä¸­ç»´æŒä¸€ä¸ªç´¢å¼•è®¡æ•°å™¨å˜é‡ <code>rehashidx</code>ï¼Œå¹¶å°†å®ƒçš„å€¼è®¾ç½®ä¸º 0ï¼Œè¡¨ç¤º <strong>rehash</strong> å·¥ä½œæ­£å¼å¼€å§‹ã€‚</p><p>3ï¸âƒ£ åœ¨ <strong>rehash</strong> è¿›è¡ŒæœŸé—´ï¼Œæ¯æ¬¡å¯¹å­—å…¸æ‰§è¡Œæ·»åŠ ã€åˆ é™¤ã€æŸ¥æ”¹æˆ–è€…æ›´æ–°æ“ä½œæ—¶ï¼Œç¨‹åºé™¤äº†æ‰§è¡ŒæŒ‡å®šçš„æ“ä½œä»¥å¤–ï¼Œè¿˜ä¼šé¡ºå¸¦å°† <code>ht[0]</code> å“ˆå¸Œè¡¨åœ¨ <code>rehashidx</code> ç´¢å¼•ä¸Šçš„æ‰€æœ‰é”®å€¼å¯¹ <strong>rehash</strong> åˆ° <code>ht[1]</code>ï¼Œå½“ <strong>rehash</strong> å·¥ä½œå®Œæˆä¹‹åï¼Œç¨‹åºå°† <code>rehashidx</code> å±æ€§çš„å€¼å¢ä¸€ã€‚</p><p>4ï¸âƒ£ éšç€å­—å…¸æ“ä½œçš„ä¸æ–­æ‰§è¡Œï¼Œæœ€ç»ˆåœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Šï¼Œ<code>ht[0]</code> çš„æ‰€æœ‰é”®å€¼å¯¹éƒ½ä¼šè¢« <strong>rehash</strong> è‡³ <code>ht[1]</code>ï¼Œè¿™æ˜¯ç¨‹åº <code>rehashidx</code> å±æ€§è®¾ç½®ä¸º -1ï¼Œè¡¨ç¤º <strong>rehash</strong> æ“ä½œå·²å®Œæˆã€‚</p><p><strong><font color="FF8888">æ³¨æ„</font></strong>ï¼šğŸ™‹â€â™‚</p><p>ğŸ”¹ å› ä¸ºåœ¨æ¸è¿›å¼ <strong>rehash</strong> çš„è¿‡ç¨‹ä¸­ï¼Œå­—å…¸ä¼šåŒæ—¶ä½¿ç”¨ <code>ht[0]</code> å’Œ <code>ht[1]</code> ä¸¤ä¸ªå“ˆå¸Œè¡¨ï¼Œæ‰€ä»¥åœ¨æ¸è¿›å¼ <strong>rehash</strong> è¿›è¡ŒæœŸé—´ï¼Œå­—å…¸çš„ <strong><font color="F88F00">åˆ æ”¹æŸ¥</font></strong> æ“ä½œä¼šåœ¨ä¸¤ä¸ªå“ˆå¸Œè¡¨ä¸Šè¿›è¡Œï¼ˆ <strong><font color="008F88">å¢</font></strong> æ“ä½œç›´æ¥ä½œç”¨åœ¨ <code>ht[1]</code> ï¼‰ã€‚ä¾‹å¦‚ï¼Œå­—å…¸è¦æŸ¥æ‰¾ä¸€ä¸ªé”®ï¼Œç¨‹åºä¼šç°åœ¨ <code>ht[0]</code> é‡Œé¢è¿›è¡ŒæŸ¥æ‰¾ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œå°±ä¼šç»§ç»­åˆ° <code>ht[1]</code> é‡Œé¢æŸ¥æ‰¾ã€‚</p><p>ğŸ”¸ åœ¨æ¸è¿›å¼ <strong>rehash</strong> æ‰§è¡ŒæœŸé—´ï¼Œæ–°æ·»åŠ åˆ°å­—å…¸çš„é”®å€¼å¯¹ä¸€å¾‹è¢«ä¿å­˜åˆ° <code>ht[1]</code> é‡Œé¢ï¼Œè¿™ä¿è¯äº† <code>ht[0]</code> åŒ…å«çš„é”®å€¼å¯¹æ•°é‡åªå‡ä¸å¢ï¼Œå¹¶éšç€ <strong>rehash</strong> æ“ä½œçš„æ‰§è¡Œæœ€ç»ˆå˜æˆç©ºè¡¨ã€‚</p><hr><h4 id="1-3-7-å­—å…¸-API"><a class="header-anchor" href="#1-3-7-å­—å…¸-API">Â¶</a>1.3.7 å­—å…¸ API</h4><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/dictAPI1.png" style="zoom:61%"> <img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/dictAPI2.png" style="zoom:61%"><blockquote><p>ã€ŠRedis è®¾è®¡ä¸å®ç°ã€‹ ç¬¬å››ç« </p></blockquote><hr><h3 id="1-4-è·³è·ƒè¡¨"><a class="header-anchor" href="#1-4-è·³è·ƒè¡¨">Â¶</a>1.4 è·³è·ƒè¡¨</h3><h4 id="1-4-1-åŸºæœ¬ç»“æ„"><a class="header-anchor" href="#1-4-1-åŸºæœ¬ç»“æ„">Â¶</a>1.4.1 åŸºæœ¬ç»“æ„</h4><p>è·³è·ƒè¡¨ï¼ˆ <strong>skiplist</strong> ï¼‰æ˜¯ä¸€ç§æœ‰åºæ•°æ®ç»“æ„ï¼Œå®ƒé€šè¿‡åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸­ç»´æŒå¤šä¸ªæŒ‡å‘å…¶ä»–èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œä»è€Œè¾¾åˆ°å¿«é€Ÿè®¿é—®èŠ‚ç‚¹çš„ç›®çš„ã€‚è·³è·ƒè¡¨æ”¯æŒå¹³å‡ $O(logN)$ã€æœ€å $O(N)$ æ—¶é—´å¤æ‚åº¦çš„èŠ‚ç‚¹æŸ¥æ‰¾ï¼Œè¿˜å¯ä»¥é€šè¿‡é¡ºåºæ€§æ“ä½œæ¥æ‰¹é‡å¤„ç†èŠ‚ç‚¹ã€‚</p><p>ä¸€ä¸ªè·³è·ƒè¡¨å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/skiplist1.png" style="zoom:61%"><p>1ï¸âƒ£ æœ€å·¦è¾¹æ˜¯ <code>zskiplist</code> ç»“æ„ï¼ŒåŒ…å«ä»¥ä¸‹å±æ€§ï¼š</p><p>ğŸ”¹ <code>header</code>ï¼šæŒ‡å‘è·³è·ƒè¡¨çš„è¡¨å¤´èŠ‚ç‚¹ï¼›</p><p>ğŸ”¸ <code>tail</code>ï¼šæŒ‡å‘è·³è·ƒè¡¨çš„è¡¨å°¾èŠ‚ç‚¹ï¼›</p><p>ğŸ”¹ <code>level</code>ï¼šè®°å½•ç›®å‰è·³è·ƒè¡¨å†…ï¼Œå±‚æ•°æœ€å¤§çš„é‚£ä¸ªèŠ‚ç‚¹çš„å±‚æ•°ï¼ˆè¡¨å¤´èŠ‚ç‚¹çš„å±‚æ•°ä¸è®¡ç®—åœ¨å†…ï¼‰ï¼›</p><p>ğŸ”¸ <code>length</code>ï¼šè®°å½•è·³è·ƒè¡¨çš„é•¿åº¦ï¼Œä¹Ÿå³è·³è·ƒè¡¨ç›®å‰åŒ…å«çš„èŠ‚ç‚¹æ•°é‡ï¼ˆè¡¨å¤´èŠ‚ç‚¹ä¸è®¡ç®—åœ¨å†…ï¼‰ã€‚</p><p><code>zskiplist</code> ç»“æ„å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">zskiplist</span> &#123;</span></span><br><span class="line">    <span class="comment">// è¡¨å¤´èŠ‚ç‚¹å’Œè¡¨å°¾èŠ‚ç‚¹</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">skiplistNode</span> *<span class="title">header</span>, *<span class="title">tail</span>;</span></span><br><span class="line">    <span class="comment">// è¡¨ä¸­èŠ‚ç‚¹çš„æ•°é‡</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> length;</span><br><span class="line">    <span class="comment">// è¡¨ä¸­å±‚æ•°æœ€å¤§çš„èŠ‚ç‚¹çš„å±‚æ•°</span></span><br><span class="line">    <span class="keyword">int</span> level;</span><br><span class="line">&#125; zskiplist;</span><br></pre></td></tr></table></figure><p>2ï¸âƒ£ ä½äº <code>zskiplist</code> ç»“æ„å³ä¾§çš„æ˜¯å››ä¸ª <code>zskiplistNode</code> ç»“æ„ï¼Œè¯¥ç»“æ„åŒ…å«ä»¥ä¸‹å±æ€§ï¼š</p><p>ğŸ”¹ <code>level</code>ï¼šè¡¨ç¤ºå±‚æ•°çš„ç»“æ„ä½“ï¼Œå†…éƒ¨åŒ…å«ä¸¤ä¸ªå±æ€§ï¼šå‰è¿›æŒ‡é’ˆå’Œè·¨åº¦ã€‚å‰è¿›æŒ‡é’ˆç”¨äºæ–¹ä½ä½äºè¡¨å°¾æ–¹å‘çš„å…¶ä»–èŠ‚ç‚¹ï¼Œè€Œè·¨åº¦åˆ™è®°å½•äº†å‰è¿›æŒ‡é’ˆæ‰€æŒ‡å‘èŠ‚ç‚¹å’Œå½“å‰èŠ‚ç‚¹çš„è·ç¦»ï¼›</p><p>ğŸ”¸ <code>backward</code>ï¼šæŒ‡å‘ä½äºå½“å‰èŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåé€€æŒ‡é’ˆåœ¨ç¨‹åºä¸­ä»è¡¨å°¾å‘è¡¨å¤´éå†æ—¶ä½¿ç”¨ï¼›</p><p>ğŸ”¹ <code>score</code>ï¼šå„ä¸ªèŠ‚ç‚¹æ‰€ä¿å­˜çš„åˆ†å€¼ï¼Œåœ¨è·³è·ƒè¡¨ä¸­èŠ‚ç‚¹æŒ‰å„è‡ªæ‰€ä¿å­˜çš„åˆ†å€¼ä»å°åˆ°å¤§æ’åˆ—ï¼›</p><p>ğŸ”¸ <code>obj</code>ï¼šå„ä¸ªèŠ‚ç‚¹ä¸­æ‰€ä¿å­˜çš„æˆå‘˜å¯¹è±¡ã€‚</p><p><code>zskiplistNode</code> ç»“æ„å®šä¹‰å¦‚ä¸‹ï¼š</p><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/zskiplistNodeå®šä¹‰.png" style="zoom:61%"><p><strong><font color="FF8888">æ€»ç»“</font></strong>ï¼šâ­ï¸</p><p>ğŸ”¹ <code>header</code> å’Œ <code>tail</code> æŒ‡é’ˆåˆ†åˆ«æŒ‡å‘è·³è·ƒè¡¨çš„è¡¨å¤´å’Œè¡¨å°¾èŠ‚ç‚¹ï¼Œé€šè¿‡è¿™ä¸¤ä¸ªæŒ‡é’ˆï¼Œç¨‹åºå®šä½è¡¨å¤´èŠ‚ç‚¹å’Œè¡¨å°¾èŠ‚ç‚¹çš„æ—¶é—´å¤æ‚åº¦ä¸º $O(1)$ï¼›</p><p>ğŸ”¸ <code>length</code> å±æ€§æ¥è®°å½•èŠ‚ç‚¹çš„æ•°é‡ï¼Œç¨‹åºå¯ä»¥åœ¨$O(1)$æ—¶é—´å¤æ‚åº¦å†…è¿”å›è·³è·ƒè¡¨çš„é•¿åº¦ï¼›</p><p>ğŸ”¹ <code>level</code> å±æ€§åˆ™ç”¨äºåœ¨ $O(1)$ æ—¶é—´å¤æ‚åº¦å†…è·å–è·³è·ƒè¡¨ä¸­å±‚é«˜æœ€å¤§çš„é‚£ä¸ªèŠ‚ç‚¹çš„å±‚æ•°é‡ ï¼›</p><p>ğŸ”¸ åœ¨åŒä¸€ä¸ªè·³è·ƒè¡¨ä¸­å„ä¸ªèŠ‚ç‚¹ä¿å­˜çš„æˆå‘˜å¯¹è±¡å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œä½†æ˜¯å¤šä¸ªèŠ‚ç‚¹ä¿å­˜çš„åˆ†å€¼ç¡®å®å¯ä»¥ç›¸åŒçš„ï¼šåˆ†å€¼ç›¸åŒçš„èŠ‚ç‚¹å°†æŒ‰ç…§æˆå‘˜å¯¹è±¡åœ¨å­—å…¸åºä¸­çš„å¤§å°æ¥è¿›è¡Œæ’åºï¼Œæˆå‘˜å¯¹è±¡è¾ƒå°çš„èŠ‚ç‚¹ä¼šæ’åœ¨å‰é¢ï¼Œè€Œæˆå‘˜å¯¹è±¡è¾ƒå¤§çš„èŠ‚ç‚¹åˆ™ä¼šæ’åœ¨åé¢ï¼ˆé è¿‘è¡¨å°¾çš„æ–¹å‘ï¼‰ï¼›â€‹</p><p>ğŸ”¹ æ¯ä¸ªèŠ‚ç‚¹åªæœ‰ä¸€ä¸ªåé€€æŒ‡é’ˆï¼Œæ‰€ä»¥æ¯æ¬¡åªèƒ½åé€€è‡³å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡å…¶å®ç°ä»è¡¨å°¾åˆ°è¡¨å¤´çš„éå†ï¼›</p><p>ğŸ”¸ æŒ‡å‘ NULL çš„æ‰€æœ‰å‰è¿›æŒ‡é’ˆçš„è·¨åº¦éƒ½ä¸º 0ï¼Œå› ä¸ºä»–ä»¬æ²¡æœ‰è¿å‘ä»»ä½•èŠ‚ç‚¹ã€‚</p><hr><h4 id="1-4-2-è·³è·ƒè¡¨-API"><a class="header-anchor" href="#1-4-2-è·³è·ƒè¡¨-API">Â¶</a>1.4.2 è·³è·ƒè¡¨ API</h4><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/skiplistAPI.png" style="zoom:70%"><blockquote><p>ã€ŠRedis è®¾è®¡ä¸å®ç°ã€‹ ç¬¬äº”ç« </p></blockquote><hr><h3 id="1-5-æ•´æ•°é›†åˆ"><a class="header-anchor" href="#1-5-æ•´æ•°é›†åˆ">Â¶</a>1. 5 æ•´æ•°é›†åˆ</h3><h4 id="1-5-1-åŸºæœ¬ç»“æ„"><a class="header-anchor" href="#1-5-1-åŸºæœ¬ç»“æ„">Â¶</a>1.5.1 åŸºæœ¬ç»“æ„</h4><p>æ•´æ•°é›†åˆ ï¼ˆ <strong>intset</strong> ï¼‰ æ˜¯ Redis ç”¨äºä¿å­˜æ•´æ•°å€¼çš„é›†åˆæŠ½è±¡æ•°æ®ç»“æ„ï¼Œå®ƒå¯ä»¥ä¿å­˜ç±»å‹ä¸º <strong>int16_t</strong> ã€ <strong>int32_t</strong> æˆ–è€… <strong>int64_t</strong> çš„æ•´æ•°å€¼ï¼Œå¹¶ä¸”ä¿è¯é›†åˆä¸­ä¸ä¼šå‡ºç°é‡å¤å…ƒç´ ã€‚å…¶ç»“æ„å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š</p><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/intsetå®šä¹‰.png" style="zoom:61%"><p><strong><font color="FF8888">æ³¨æ„</font></strong>ï¼šğŸ™‹</p><p>ğŸ”¹ <code>contents</code> æ•°ç»„æ˜¯æ•´æ•°é›†åˆçš„åº•å±‚å®ç°ï¼šæ•´æ•°é›†åˆçš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ <code>contents</code> æ•°ç»„çš„ä¸€ä¸ªæ•°ç»„é¡¹ï¼Œæ¯ä¸ªé¡¹åœ¨æ•°ç»„ä¸­æŒ‰ç…§å€¼çš„å¤§å°ä»å°åˆ°å¤§æœ‰åºåœ°æ’åˆ—ï¼Œå¹¶ä¸”æ•°ç»„ä¸­ä¸åŒ…å«é‡å¤é¡¹ã€‚è™½ç„¶å£°æ˜ä¸º <strong>int8_t</strong> ç±»å‹åœ°æ•°ç»„ï¼Œä½†æ˜¯å®é™…ä¸Š <code>contents</code> æ•°ç»„å¹¶ä¸ä¿å­˜ä»»ä½• <strong>int8_t</strong> ç±»å‹åœ°å€¼ï¼Œ<code>contents</code> æ•°ç»„åœ°çœŸæ­£å–å€¼ç±»å‹å–å†³äº <code>encoding</code> å±æ€§åœ°å€¼ã€‚</p><p>ğŸ”¸ <code>encoding</code> å±æ€§æœ‰ä¸‰ç§ç­–ç•¥ï¼š<strong>INTSET_ENC_INT16</strong> ã€ <strong>INTSET_ENC_INT32</strong> å’Œ <strong>INTSET_ENC_INT64</strong> ï¼›åˆ†åˆ«å¯¹åº”äº†<strong>int16_t</strong> ã€ <strong>int32_t</strong> æˆ–è€… <strong>int64_t</strong> æ•´æ•°å€¼ã€‚</p><p>ğŸ”¹ <code>length</code> å±æ€§è®°å½•äº†æ•´ä¸ªæ•´æ•°é›†åˆåŒ…å«çš„å…ƒç´ æ•°é‡ï¼Œä¹Ÿå³æ˜¯ <code>contents</code> æ•°ç»„çš„é•¿åº¦ã€‚</p><p>ğŸ”¸ æ³¨æ„ <code>contents</code> æ•°ç»„çš„å¤§å° <code>size = sizeof(int16_t or int36_t or int64_t) * length</code></p><p>ä¸€ä¸ªåŒ…å«äº”ä¸ª <strong>int16_t</strong> ç±»å‹æ•´æ•°å€¼çš„æ•´æ•°é›†åˆå¦‚ä¸‹æ‰€ç¤ºï¼š</p><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/intset_int16_5.png" style="zoom:50%"><hr><h4 id="1-5-2-å‡çº§"><a class="header-anchor" href="#1-5-2-å‡çº§">Â¶</a>1.5.2 å‡çº§</h4><p>æ¯å½“å°†ä¸€ä¸ªæ–°å…ƒç´ æ·»åŠ åˆ°æ•´æ•°é›†åˆé‡Œé¢ï¼Œå¹¶ä¸”æ–°å…ƒç´ çš„ç±»å‹æ¯”æ•´æ•°é›†åˆç°æœ‰æ‰€æœ‰å…ƒç´ çš„ç±»å‹éƒ½è¦é•¿æ—¶ï¼Œæ•´æ•°é›†åˆéœ€è¦å…ˆè¿›è¡Œå‡çº§ï¼ˆupgradeï¼‰ï¼Œç„¶åæ‰èƒ½å°†æ–°å…ƒç´ æ·»åŠ åˆ°æ•´æ•°é›†åˆé‡Œé¢ã€‚</p><p><strong><font color="FF8888">æ³¨æ„</font></strong>ï¼šğŸ™‹â€â™‚ æ­¤æ—¶æ·»åŠ çš„æ–°å…ƒç´ å¿…å®šæ˜¯å¤§äºå½“å‰ç±»å‹æœ€å¤§å€¼ï¼Œæˆ–è€…å°äºå½“å‰ç±»å‹æœ€å°å€¼çš„ã€‚ä¹Ÿå³æ˜¯æ·»åŠ çš„æ–°å…ƒç´ å¿…å®šå¤§äºå½“å‰æ•°ç»„å†…æ‰€æœ‰å…ƒç´ å€¼ï¼Œæˆ–è€…å°äºå½“å‰æ•°ç»„å†…æ‰€æœ‰å…ƒç´ å€¼ã€‚</p><p>å‡çº§æ•´æ•°é›†åˆå¹¶æ·»åŠ æ–°å…ƒç´ å…±åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š</p><p>1ï¸âƒ£ æ ¹æ®æ–°å…ƒç´ çš„ç±»å‹ï¼Œæ‰©å±•æ•´æ•°é›†åˆåº•å±‚æ•°ç»„çš„ç©ºé—´å¤§å°ï¼Œå¹¶ä¸ºæ–°å…ƒç´ åˆ†é…ç©ºé—´ã€‚</p><p>2ï¸âƒ£ å°†åº•å±‚æ•°ç»„ç°æœ‰çš„å…ƒç´ éƒ½è½¬åŒ–æˆä¸æ–°å…ƒç´ ç›¸åŒçš„ç±»å‹ï¼Œå¹¶å°†ç±»å‹è½¬åŒ–åçš„å…ƒç´ æ”¾ç½®åˆ°æ­£ç¡®çš„ä½ç½®ä¸Šï¼Œè€Œä¸”åœ¨æ”¾ç½®è¿‡ç¨‹ä¸­ï¼Œéœ€è¦ç»§ç»­ç»´æŒåº•å±‚æ•°ç»„çš„æœ‰åºæ€§è´¨ä¸å˜ã€‚</p><p>ğŸ”¹ å¦‚æœæ·»åŠ çš„å…ƒç´ å¤§äºå½“å‰æ‰€æœ‰å…ƒç´ ï¼Œå°†å½“å‰æ•°ç»„å†…æœ€å¤§çš„å…ƒç´ è½¬åŒ–ç±»å‹å¹¶æ¬ç§»åˆ°æ–°åˆ†é…ç©ºé—´æ­£ç¡®çš„ä½ç½®ï¼ˆæ–° <code>contents</code> æ•°ç»„<strong>å€’æ•°ç¬¬äºŒä¸ª</strong>ç´¢å¼•ä½ç½®ï¼‰ï¼Œå¹¶ä¾æ¬¡ <strong><font color="008F88">ä»åå¾€å‰ï¼ˆå€’åºï¼‰</font></strong> æ‰§è¡Œå…¶ä»–å…ƒç´ çš„æ“ä½œï¼Œæ¬ç§»çš„ä½ç½®ä¾æ¬¡å¾€å‰ä¸€ä¸ªç´¢å¼•ï¼›</p><p>ğŸ”¸ å¦‚æœæ·»åŠ çš„å…ƒç´ å°äºå½“å‰æ‰€æœ‰å…ƒç´ ï¼Œå°†å½“å‰æ•°ç»„å†…æœ€å¤§çš„å…ƒç´ è½¬åŒ–ç±»å‹å¹¶æ¬ç§»åˆ°æ–°åˆ†é…ç©ºé—´æ­£ç¡®çš„ä½ç½®ï¼ˆæ–° <code>contents</code> æ•°ç»„<strong>æœ€åä¸€ä¸ª</strong>ç´¢å¼•ä½ç½®ï¼‰ï¼Œå¹¶ä¾æ¬¡ <strong><font color="008F88">ä»åå¾€å‰ï¼ˆå€’åºï¼‰</font></strong> æ‰§è¡Œå…¶ä»–å…ƒç´ çš„æ“ä½œï¼Œæ¬ç§»çš„ä½ç½®ä¾æ¬¡å¾€å‰ä¸€ä¸ªç´¢å¼•ï¼›</p><p>3ï¸âƒ£ å°†æ–°å…ƒç´ æ·»åŠ åˆ°åº•å±‚æ•°ç»„é‡Œé¢ã€‚</p><p>ğŸ”¹ å¦‚æœæ·»åŠ çš„å…ƒç´ å¤§äºå½“å‰æ‰€æœ‰å…ƒç´ ï¼Œæ–°æ·»åŠ çš„å…ƒç´ æ”¾åœ¨æ–° <code>contents</code> æ•°ç»„<strong>æœ€åä¸€ä¸ª</strong>ç´¢å¼•ä½ç½®å³å¯ï¼›</p><p>ğŸ”¸ å¦‚æœæ·»åŠ çš„å…ƒç´ å°äºå½“å‰æ‰€æœ‰å…ƒç´ ï¼Œæ–°æ·»åŠ çš„å…ƒç´ æ”¾åœ¨æ–° <code>contents</code> æ•°ç»„<strong>ç¬¬ä¸€ä¸ª</strong>ç´¢å¼•ä½ç½®å³å¯ï¼›</p><p>4ï¸âƒ£ æ›´æ–° <code>encoding</code> å’Œ <code>length</code> å±æ€§ä¸ºæ­£ç¡®å€¼ã€‚</p><p><strong><font color="FF8888">å‡çº§çš„å¥½å¤„</font></strong> â€‹ ğŸŒ»</p><p>ğŸ”¹ æå‡çµæ´»æ€§ã€‚æ•´æ•°â€‹é›†åˆå¯ä»¥é€šè¿‡è‡ªåŠ¨å‡çº§åº•å±‚æ•°ç»„æ¥é€‚åº”æ–°å…ƒç´ ã€‚</p><p>ğŸ”¸ èŠ‚çº¦å†…å­˜ã€‚â€‹ å‡çº§æ“ä½œåªä¼šåœ¨æœ‰éœ€è¦çš„æ—¶å€™è¿›è¡Œï¼Œå¯ä»¥å°½é‡èŠ‚çœå†…å­˜ã€‚</p><p><strong><font color="FF8888">æ³¨æ„</font></strong>ï¼šğŸ¥€ æ²¡æœ‰**<font color="008F88">é™çº§</font>**æ“ä½œï¼Œå‡çº§ä¹‹åï¼Œç¼–ç å°±ä¼šä¸€ç›´ä¿æŒå‡çº§åçš„çŠ¶æ€ã€‚</p><hr><h4 id="1-5-3-æ•´æ•°é›†åˆ-API"><a class="header-anchor" href="#1-5-3-æ•´æ•°é›†åˆ-API">Â¶</a>1.5.3 æ•´æ•°é›†åˆ API</h4><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/intsetAPI.png" style="zoom:61%"><blockquote><p>ã€ŠRedis è®¾è®¡ä¸å®ç°ã€‹ ç¬¬å…­ç« </p></blockquote><hr><h3 id="1-6-å‹ç¼©åˆ—è¡¨"><a class="header-anchor" href="#1-6-å‹ç¼©åˆ—è¡¨">Â¶</a>1.6 å‹ç¼©åˆ—è¡¨</h3><p>å‹ç¼©åˆ—è¡¨ï¼ˆ<strong>ziplist</strong>ï¼‰æ˜¯åˆ—è¡¨é”®å’Œå“ˆå¸Œé”®çš„åº•å±‚å®ç°ä¹‹ä¸€ã€‚å‹ç¼©åˆ—è¡¨æ˜¯ Redis ä¸ºäº†èŠ‚çº¦å†…å­˜è€Œå¼€å‘çš„ï¼Œæ˜¯ç”±ä¸€ç³»åˆ—ç‰¹æ®Šç¼–ç çš„è¿ç»­å†…å­˜å—ç»„æˆçš„é¡ºåºå‹æ•°æ®ç»“æ„ã€‚ä¸€ä¸ªå‹ç¼©åˆ—è¡¨å¯ä»¥åŒ…å«ä»»æ„å¤šä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹å¯ä»¥ä¿å­˜ä¸€ä¸ªå­—èŠ‚æ•°ç»„æˆ–è€…ä¸€ä¸ªæ•´æ•°å€¼ã€‚</p><h4 id="1-6-1-åŸºæœ¬ç»“æ„"><a class="header-anchor" href="#1-6-1-åŸºæœ¬ç»“æ„">Â¶</a>1.6.1 åŸºæœ¬ç»“æ„</h4><p>å‹ç¼©é“¾è¡¨çš„å„ä¸ªç»„æˆéƒ¨åˆ†ï¼Œä»¥åŠå…¶ç»†èŠ‚å¦‚ä¸‹å›¾æè¿°ï¼š</p><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/ziplistç»“æ„.png" style="zoom:61%"> <img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/ziplistç»“æ„ç»†èŠ‚.png" style="zoom:61%"><hr><h4 id="1-6-2-å‹ç¼©åˆ—è¡¨èŠ‚ç‚¹çš„æ„æˆ"><a class="header-anchor" href="#1-6-2-å‹ç¼©åˆ—è¡¨èŠ‚ç‚¹çš„æ„æˆ">Â¶</a>1.6.2 å‹ç¼©åˆ—è¡¨èŠ‚ç‚¹çš„æ„æˆ</h4><p>å‹ç¼©åˆ—è¡¨æ¯ä¸ªèŠ‚ç‚¹éƒ½ç”± <code>previous_entry_length</code>ã€<code>encoding</code> å’Œ <code>content</code> ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/ziplistNode.png" style="zoom:61%"><p>æ¯ä¸ªå‹ç¼©åˆ—è¡¨èŠ‚ç‚¹å¯ä»¥ä¿å­˜ä¸€ä¸ªå­—èŠ‚æ•°ç»„æˆ–ä¸€ä¸ªæ•´æ•°å€¼ã€‚</p><p>å…¶ä¸­ <strong><font color="008F88">å­—èŠ‚æ•°ç»„</font></strong> å¯ä»¥æ˜¯ä»¥ä¸‹ä¸‰ç§é•¿åº¦çš„å…¶ä¸­ä¸€ç§ï¼Œä¸‹é¢è¡¨æ ¼è§£é‡Šäº†åŸå› ï¼š</p><p>ğŸ”¹ é•¿åº¦å°äºç­‰äº $63(2^6 - 1)$ å­—èŠ‚çš„æ•°ç»„ï¼Œç¼–ç é•¿åº¦ä¸ºä¸€ä¸ªå­—èŠ‚ï¼Œç¼–ç å‰ä¸¤ä½å›ºå®šä¸º 00</p><p>ğŸ”¸ é•¿åº¦å°äºç­‰äº $16383(2^{14} - 1)$ å­—èŠ‚çš„æ•°ç»„ï¼Œç¼–ç é•¿åº¦ä¸ºä¸¤ä¸ªå­—èŠ‚ï¼Œç¼–ç å‰ä¸¤ä½å›ºå®šä¸º 01</p><p>ğŸ”¹ é•¿åº¦å°äºç­‰äº $4294967295(2^{32} - 1)$ å­—èŠ‚çš„æ•°ç»„ï¼Œç¼–ç é•¿åº¦ä¸ºäº”ä¸ªå­—èŠ‚ï¼Œç¼–ç å‰ä¸¤ä½å›ºå®šä¸º 10</p><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/ziplist_enc.png" style="zoom:61%"><p>å…¶ä¸­ <strong><font color="008F88">æ•´æ•°å€¼</font></strong> å¯ä»¥æ˜¯ä»¥ä¸‹å…­ç§é•¿åº¦ä¸­é€‰æ‹©ï¼š</p><p>ğŸ”¹ 4ä½é•¿ï¼Œä»‹äº 0-12ä¹‹é—´çš„æ— ç¬¦å·æ•´æ•°ï¼›</p><p>ğŸ”¸ 1å­—èŠ‚é•¿çš„æœ‰ç¬¦å·æ•´æ•°ï¼›</p><p>ğŸ”¹ 3å­—èŠ‚é•¿çš„æœ‰ç¬¦å·æ•´æ•°ï¼›</p><p>ğŸ”¸ <strong>int16_t</strong> ç±»å‹æ•´æ•°ï¼›</p><p>ğŸ”¹ <strong>int32_t</strong> ç±»å‹æ•´æ•°ï¼›</p><p>ğŸ”¸ <strong>int64_t</strong> ç±»å‹æ•´æ•°ï¼›</p><hr><h5 id="1-6-2-1-previous-entry-length"><a class="header-anchor" href="#1-6-2-1-previous-entry-length">Â¶</a>1.6.2.1 <code>previous_entry_length</code></h5><p>èŠ‚ç‚¹çš„ <code>previous_entry_length</code> å±æ€§ä»¥å­—èŠ‚ä¸ºå•ä½ï¼Œè®°å½•äº†å‹ç¼©åˆ—è¡¨å‰ä¸€ä¸ªèŠ‚ç‚¹é•¿åº¦ã€‚<code>previous_entry_length</code> å±æ€§çš„é•¿åº¦å¯ä»¥æ˜¯ 1 å­—èŠ‚æˆ–è€… 5 å­—èŠ‚ï¼›</p><p>ğŸ”¹ å¦‚æœå‰ä¸€èŠ‚ç‚¹é•¿åº¦å°äº 254 å­—èŠ‚ï¼Œé‚£ä¹ˆè¯¥å­—æ®µä¸€ä¸ªå­—èŠ‚å³å¯ï¼›</p><p>ğŸ”¸ å¦‚æœå‰ä¸€ä¸ªèŠ‚ç‚¹é•¿åº¦å¤§äºç­‰äº 254å­—èŠ‚ï¼Œé‚£ä¹ˆè¯¥å­—æ®µè®¾ç½®ä¸º 5 ä¸ªå­—èŠ‚ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå­—èŠ‚ä¼šè¢«è®¾ç½®ä¸º 0xFEï¼Œåé¢å››ä¸ªå­—èŠ‚ç”¨æ¥ä¿å­˜å‰ä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦ï¼ˆè¶³å¤Ÿäº†ï¼‰ã€‚</p><p>ğŸŒ» â€‹**<font color="FF8888">é€šè¿‡previous_entry_length</font>** å¯ä»¥è®¡ç®—å‡ºå‰ä¸€ä¸ªèŠ‚ç‚¹çš„åœ°å€ï¼Œå‹ç¼©åˆ—è¡¨ä»è¡¨å°¾å‘è¡¨å¤´çš„éå†æ“ä½œå°±æ˜¯ä½¿ç”¨è¿™ä¸€åŸç†ã€‚</p><hr><h5 id="1-6-2-2-encoding"><a class="header-anchor" href="#1-6-2-2-encoding">Â¶</a>1.6.2.2 <code>encoding</code></h5><p>èŠ‚ç‚¹ <code>encoding</code> å±æ€§è®°å½•äº†èŠ‚ç‚¹ <code>content</code> å±æ€§ä¿å­˜æ•°æ®çš„ <strong><font color="F88F00">ç±»å‹</font></strong> ä»¥åŠ <strong><font color="F88F00">é•¿åº¦</font></strong> ã€‚</p><p>å­—èŠ‚æ•°ç»„ç¼–ç è§ 1.6.2 èŠ‚è¡¨æ ¼ã€‚æ•´æ•°ç¼–ç è§ä¸‹è¡¨ï¼š</p><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/ziplist_enc_int.png" style="zoom:61%"><hr><h5 id="1-6-2-3-content"><a class="header-anchor" href="#1-6-2-3-content">Â¶</a>1.6.2.3 <code>content</code></h5><p>èŠ‚ç‚¹çš„ <code>content</code> å±æ€§è´Ÿè´£ä¿å­˜èŠ‚ç‚¹çš„å€¼ï¼ŒèŠ‚ç‚¹å€¼å¯ä»¥æ˜¯ä¸€ä¸ªå­—èŠ‚æ•°ç»„æˆ–è€…æ•´æ•°å€¼ï¼Œå€¼çš„ç±»å‹å’Œé•¿åº¦ç”±èŠ‚ç‚¹çš„ <code>encoding</code> å±æ€§å†³å®šã€‚</p><p>ä¸¤ä¸ªç®€å•çš„ä¾‹å­å¦‚ä¸‹ï¼š</p><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/ziplist_example1.png" style="zoom:61%"> <img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/ziplist_example2.png" style="zoom:61%"><hr><h4 id="1-6-3-è¿é”æ›´æ–°"><a class="header-anchor" href="#1-6-3-è¿é”æ›´æ–°">Â¶</a>1.6.3 è¿é”æ›´æ–°</h4><p>å› ä¸ºå‰ä¸€èŠ‚ç‚¹é•¿åº¦å°äº 254 å­—èŠ‚ï¼Œå¤§äºç­‰äº 254 å­—èŠ‚ï¼Œ<code>previous_entry_length</code> å±æ€§çš„é•¿åº¦ä¸åŒï¼Œæ‰€ä»¥å¤šä¸ªè¿ç»­ã€é•¿åº¦ä»‹äº 250 å­—èŠ‚åˆ° 253 å­—èŠ‚çš„èŠ‚ç‚¹ï¼Œä¼šå› ä¸ºåœ¨æœ€å‰æ–¹æ·»åŠ èŠ‚ç‚¹é•¿åº¦å¤§äºç­‰äº 254 å­—èŠ‚çš„æ–°èŠ‚ç‚¹è€Œå¯¼è‡´ç¨‹åºå°†ä¼šå¯¹å‹ç¼©åˆ—è¡¨è¿™ä¸€ä¸²èŠ‚ç‚¹ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½æ‰§è¡Œç©ºé—´é‡åˆ†é…ï¼Œè¿™ç§ç°è±¡è¢«ç§°ä¹‹ä¸ºâ€œè¿é”æ›´æ–°â€ã€‚</p><p>å› ä¸ºè¿é”æ›´æ–°åœ¨æœ€åæƒ…å†µä¸‹éœ€è¦å¯¹å‹ç¼©åˆ—è¡¨æ‰§è¡Œ N æ¬¡ç©ºé—´é‡åˆ†é…æ“ä½œï¼Œè€Œæ¯æ¬¡ç©ºé—´é‡åˆ†é…çš„æœ€åæ—¶é—´å¤æ‚åº¦ä¸º $O(N)$ï¼Œæ‰€ä»¥è¿é”æ›´æ–°çš„æœ€åæ—¶é—´å¤æ‚åº¦ä¸º $O(N^2)$ã€‚</p><p>ğŸ˜„ ä½†æ˜¯å®ƒçœŸæ­£é€ æˆçš„æ€§èƒ½é—®é¢˜å‡ ç‡å¾ˆä½ï¼š</p><p>ğŸ”¹ é¦–å…ˆå‹ç¼©åˆ—è¡¨é‡Œè¦æ°å¥½æœ‰å¤šä¸ªè¿ç»­çš„ã€é•¿åº¦ä»‹äº 250 - 253 å­—èŠ‚ä¹‹é—´çš„èŠ‚ç‚¹ï¼Œè¿é”æ›´æ–°æ‰å¯èƒ½å‘ç”Ÿï¼Œå®é™…ä¸­ä¸å¸¸è§ã€‚</p><p>ğŸ”¸ å³ä½¿å‡ºç°äº†è¿é”æ›´æ–°ï¼Œä½†æ˜¯åªè¦è¢«æ›´æ–°çš„èŠ‚ç‚¹æ•°é‡ä¸å¤šï¼Œå°±ä¸ä¼šå¯¹æ€§èƒ½é€ æˆä»»ä½•å½±å“ã€‚</p><p>æ­£æ˜¯ä»¥ä¸ŠåŸå› ï¼Œ<code>ziplistPush</code> ç­‰å‘½ä»¤çš„å¹³å‡å¤æ‚åº¦ä»…ä¸º $O(N)$ã€‚</p><hr><h4 id="1-6-4-å‹ç¼©åˆ—è¡¨-API"><a class="header-anchor" href="#1-6-4-å‹ç¼©åˆ—è¡¨-API">Â¶</a>1.6.4 å‹ç¼©åˆ—è¡¨ API</h4><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/ziplistAPI.png" style="zoom:65%"><blockquote><p>ã€ŠRedis è®¾è®¡ä¸å®ç°ã€‹ ç¬¬ä¸ƒç« </p></blockquote><hr><h2 id="2-å¯¹è±¡"><a class="header-anchor" href="#2-å¯¹è±¡">Â¶</a>2 å¯¹è±¡</h2><p>Redis å¹¶æ²¡æœ‰ç›´æ¥ä½¿ç”¨ä¸Šæ–‡è¿™äº›æ•°æ®ç»“æ„æ¥å®ç°é”®å€¼å¯¹æ•°æ®åº“ï¼Œè€Œæ˜¯åŸºäºè¿™äº›æ•°æ®ç»“æ„åˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡ç³»ç»Ÿï¼Œè¿™ä¸ªç³»ç»ŸåŒ…å«å­—ç¬¦ä¸²å¯¹è±¡ã€åˆ—è¡¨å¯¹è±¡ã€å“ˆå¸Œå¯¹è±¡ã€é›†åˆå¯¹è±¡å’Œæœ‰åºé›†åˆå¯¹è±¡è¿™äº”ç§ç±»å‹çš„å¯¹è±¡ï¼Œæ¯ç§å¯¹è±¡éƒ½ç”¨åˆ°äº†è‡³å°‘ä¸€ç§å‰æ–‡æ‰€è¿°çš„æ•°æ®ç»“æ„ã€‚</p><h3 id="2-1-åŸºæœ¬ç»“æ„"><a class="header-anchor" href="#2-1-åŸºæœ¬ç»“æ„">Â¶</a>2.1 åŸºæœ¬ç»“æ„</h3><p>Redis ä¸­çš„æ¯ä¸ªå¯¹è±¡éƒ½æ˜¯ç”±ä¸€ä¸ª <code>redisObject</code> ç»“æ„è¡¨ç¤ºï¼Œè¿™ä¸ªç»“æ„ä¸­ä¿å­˜æ•°æ®æœ‰å…³çš„ä¸‰ä¸ªå±æ€§åˆ†åˆ«æ˜¯ <code>type</code> ã€<code>encoding</code> å’Œ <code>ptr</code> å±æ€§ï¼š</p><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/redisobjå®šä¹‰.png" style="zoom:61%"><hr><h4 id="2-1-1-type"><a class="header-anchor" href="#2-1-1-type">Â¶</a>2.1.1 <code>type</code></h4><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/redisobj_type.png" style="zoom:61%"><hr><h4 id="2-1-2-encoding"><a class="header-anchor" href="#2-1-2-encoding">Â¶</a>2.1.2 <code>encoding</code></h4><p>å¯¹è±¡çš„ç¼–ç ä»¥åŠåº•å±‚æ•°æ®ç»“æ„ï¼š</p><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/redisobj_encoding1.png" style="zoom:61%"><p>ä¸åŒå¯¹è±¡ç±»å‹å¯èƒ½å¯¹åº”çš„ç¼–ç ï¼š</p><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/redisobj_encoding2.png" style="zoom:61%"><hr><h3 id="2-2-å­—ç¬¦ä¸²å¯¹è±¡"><a class="header-anchor" href="#2-2-å­—ç¬¦ä¸²å¯¹è±¡">Â¶</a>2.2 å­—ç¬¦ä¸²å¯¹è±¡</h3><h4 id="2-2-1-å­—ç¬¦ä¸²å¯¹è±¡åˆ†ç±»"><a class="header-anchor" href="#2-2-1-å­—ç¬¦ä¸²å¯¹è±¡åˆ†ç±»">Â¶</a>2.2.1 å­—ç¬¦ä¸²å¯¹è±¡åˆ†ç±»</h4><p>å­—ç¬¦ä¸²å¯¹è±¡çš„ç¼–ç å¯ä»¥æ˜¯ **int **ã€ <strong>raw</strong> æˆ–è€… <strong>embstr</strong>ã€‚</p><p><strong>int</strong> ç¼–ç çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼š</p><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/redisobj_string_int.png" style="zoom:61%"><p><strong>raw</strong> ç¼–ç çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼š</p><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/redisobj_string_raw.png" style="zoom:61%"><p><strong>embstr</strong> ç¼–ç çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼š</p><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/redisobj_string_embstr.png" style="zoom:61%"><p><strong><font color="FF8888">è¡¥å……</font></strong> ğŸ–ï¼š <strong>embstr</strong> ç¼–ç æ˜¯ä¸“é—¨ç”¨äºä¿å­˜æ®µå­—ç¬¦ä¸²çš„ä¸€ç§ä¼˜åŒ–ç¼–ç æ–¹å¼ï¼Œè¿™ç§ç¼–ç å’Œ <strong>raw</strong> ç¼–ç ä¸€æ ·ï¼Œéƒ½æ˜¯ç”¨ <code>redisObject</code> ç»“æ„å’Œ <code>sdshdr</code> ç»“æ„æ¥è¡¨ç¤ºå­—ç¬¦ä¸²å¯¹è±¡ï¼Œä½† <strong>raw</strong> ä¼šè°ƒç”¨ä¸¤æ¬¡å†…å­˜åˆ†é…å‡½æ•°æ¥åˆ†åˆ«åˆ›å»º <code>redisObject</code> ç»“æ„å’Œ <code>sdshdr</code> ç»“æ„ï¼Œè€Œ <strong>embstr</strong> ç¼–ç åˆ™é€šè¿‡è°ƒç”¨ä¸€æ¬¡å†…å­˜åˆ†é…å‡½æ•°æ¥åˆ†é…ä¸€å—è¿ç»­ç©ºé—´ï¼Œç©ºé—´ä¸­ä¾æ¬¡åŒ…å« <code>redisObject</code> å’Œ <code>sdshdr</code> ä¸¤ä¸ªç»“æ„ã€‚</p><p>ä½¿ç”¨ <strong>embstr</strong> ç¼–ç çš„å­—ç¬¦ä¸²å¯¹è±¡æ¥ä¿å­˜çŸ­å­—ç¬¦ä¸²å€¼æœ‰ä»¥ä¸‹å¥½å¤„ ğŸŒ»ï¼š</p><p>ğŸ”¹ <strong>embstr</strong> ç¼–ç å°†åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡æ‰€éœ€çš„å†…å­˜åˆ†é…æ¬¡æ•°ä» <strong>raw</strong> ç¼–ç çš„ä¸¤æ¬¡å°†ä¸ºäº†ä¸€æ¬¡ã€‚</p><p>ğŸ”¸ é‡Šæ”¾ <strong>embstr</strong> ç¼–ç çš„å­—ç¬¦ä¸²å¯¹è±¡ä¹Ÿåªéœ€è¦è°ƒç”¨ä¸€æ¬¡å†…å­˜é‡Šæ”¾å‡½æ•°å³å¯ï¼Œè€Œ <strong>raw</strong> ç¼–ç éœ€è¦ä¸¤æ¬¡ã€‚</p><p>ğŸ”¹ å› ä¸º <strong>embstr</strong> ç¼–ç çš„å­—ç¬¦ä¸²å¯¹è±¡çš„æ‰€æœ‰æ•°æ®éƒ½ä¿å­˜åœ¨ä¸€å—è¿ç»­çš„å†…å­˜é‡Œé¢ï¼Œæ‰€ä»¥è¿™ç§ç¼–ç çš„å­—ç¬¦ä¸²å¯¹è±¡æ¯” <strong>raw</strong> ç¼–ç çš„å­—ç¬¦ä¸²å¯¹è±¡èƒ½å¤Ÿæ›´å¥½çš„åˆ©ç”¨ç¼“å­˜å¸¦æ¥çš„ä¼˜åŠ¿ã€‚</p><p><strong><font color="FF8888">æ³¨æ„</font></strong>ï¼šğŸ™‹â€â™‚</p><p>å¯ä»¥ç”¨ long double ç±»å‹è¡¨ç¤ºçš„æµ®ç‚¹æ•°ï¼Œåœ¨ Redis ä¸­ä¹Ÿæ˜¯ä½œä¸ºå­—ç¬¦ä¸²å€¼æ¥ä¿å­˜çš„ï¼Œå¦‚æœè¦ä¿å­˜ä¸€ä¸ªæµ®ç‚¹æ•°åˆ°å­—ç¬¦ä¸²å¯¹è±¡é‡Œé¢ï¼Œé‚£ä¹ˆç¨‹åºä¼šå…ˆå°†è¿™ä¸ªæµ®ç‚¹æ•°è½¬åŒ–æˆå­—ç¬¦ä¸²å€¼ï¼Œç„¶åå†ä¿å­˜è½¬åŒ–æ‰€å¾—çš„å­—ç¬¦ä¸²å€¼ã€‚</p><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/redisobj_string_longdouble1.png" style="zoom:61%"><p>åœ¨æœ‰éœ€è¦çš„æ—¶å€™ï¼Œç¨‹åºä¼šå°†ä¿å­˜åœ¨å­—ç¬¦ä¸²å¯¹è±¡é‡Œé¢çš„å­—ç¬¦ä¸²è½¬åŒ–å›æµ®ç‚¹æ•°å€¼ï¼Œæ‰§è¡Œé»˜å†™æ“ä½œï¼Œç„¶åå†å°†æ‰§è¡Œæ‰€å¾—çš„æµ®ç‚¹æ•°å€¼è½¬åŒ–å›å­—ç¬¦ä¸²å€¼ï¼Œå¹¶ç»§ç»­ä¿å­˜åœ¨å­—ç¬¦ä¸²å¯¹è±¡é‡Œé¢ã€‚</p><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/redisobj_string_longdouble2.png" style="zoom:61%"><hr><h4 id="2-2-2-ç¼–ç è½¬åŒ–"><a class="header-anchor" href="#2-2-2-ç¼–ç è½¬åŒ–">Â¶</a>2.2.2 ç¼–ç è½¬åŒ–</h4><p><strong>int</strong> ç¼–ç çš„å­—ç¬¦ä¸²å¯¹è±¡å’Œ <strong>embstr</strong> ç¼–ç çš„å­—ç¬¦ä¸²å¯¹è±¡åœ¨æ¡ä»¶æ»¡è¶³çš„æƒ…å†µä¸‹ï¼Œä¼šè¢«è½¬åŒ–ä¸º <strong>raw</strong> ç¼–ç çš„å­—ç¬¦ä¸²å¯¹è±¡ã€‚</p><p>ğŸ”¹ å¯¹äº <strong>int</strong> ç¼–ç çš„å­—ç¬¦ä¸²æ¥è¯´ï¼Œå¦‚æœå¯¹è±¡æ‰§è¡Œä¸€äº›å‘½ä»¤åä¿å­˜çš„ä¸å†æ˜¯æ•´æ•°å€¼ï¼Œè€Œæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å€¼ï¼Œé‚£ä¹ˆå­—ç¬¦ä¸²å¯¹è±¡çš„ç¼–ç å°†ä» <strong>int</strong> å˜ä¸º <strong>raw</strong>;</p><p>ğŸ”¸ å› ä¸º Redis æ²¡æœ‰ä¸º <strong>embstr</strong> ç¼–ç çš„å­—ç¬¦ä¸²å¯¹è±¡ç¼–å†™ä»»ä½•ç›¸åº”çš„ä¿®æ”¹ç¨‹åºï¼Œæ‰€ä»¥ <strong>embstr</strong> ç¼–ç çš„å­—ç¬¦ä¸²å¯¹è±¡å®é™…ä¸Šæ˜¯åªè¯»çš„ã€‚å½“æˆ‘ä»¬å¯¹ <strong>embstr</strong> ç¼–ç çš„å­—ç¬¦ä¸²å¯¹è±¡æ‰§è¡Œä»»ä½•ä¿®æ”¹å‘½ä»¤æ—¶ï¼Œç¨‹åºå°†ä¼šå…ˆå°†å¯¹è±¡çš„ç¼–ç ä» <strong>embstr</strong> è½¬åŒ–ä¸º <strong>raw</strong>ï¼Œç„¶åå†æ‰§è¡Œä¿®æ”¹å‘½ä»¤ã€‚</p><hr><h4 id="2-2-3-å­—ç¬¦ä¸²å‘½ä»¤çš„å®ç°"><a class="header-anchor" href="#2-2-3-å­—ç¬¦ä¸²å‘½ä»¤çš„å®ç°">Â¶</a>2.2.3 å­—ç¬¦ä¸²å‘½ä»¤çš„å®ç°</h4><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/redisobj_string_command.png" style="zoom:75%"><blockquote><p>ã€ŠRedis è®¾è®¡ä¸å®ç°ã€‹ ç¬¬å…«ç« ï¼šç¬¬äºŒèŠ‚</p></blockquote><hr><h3 id="2-3-åˆ—è¡¨å¯¹è±¡"><a class="header-anchor" href="#2-3-åˆ—è¡¨å¯¹è±¡">Â¶</a>2.3 åˆ—è¡¨å¯¹è±¡</h3><h4 id="2-3-1-åˆ—è¡¨å¯¹è±¡åˆ†ç±»"><a class="header-anchor" href="#2-3-1-åˆ—è¡¨å¯¹è±¡åˆ†ç±»">Â¶</a>2.3.1 åˆ—è¡¨å¯¹è±¡åˆ†ç±»</h4><p>åˆ—è¡¨å¯¹è±¡çš„ç¼–ç å¯ä»¥æ—¶ <strong>ziplist</strong> æˆ–è€… <strong>linkedlist</strong>ã€‚</p><p><strong>ziplist</strong> ç¼–ç çš„åˆ—è¡¨å¯¹è±¡ï¼š</p><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/redisobj_list_ziplistå®šä¹‰.png" style="zoom:61%"><p><strong>linkedlist</strong> ç¼–ç çš„åˆ—è¡¨å¯¹è±¡ï¼š</p><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/redisobj_list_linkedlistå®šä¹‰.png" style="zoom:61%"><p><strong><font color="FF8888">æ³¨æ„</font></strong>ï¼šğŸ™‹</p><p><strong>linkedlist</strong> ç¼–ç çš„åˆ—è¡¨å¯¹è±¡å†åº•å±‚çš„åŒç«¯é“¾è¡¨ç»“æ„ä¸­åŒ…å«å¤šä¸ªå­—ç¬¦ä¸²å¯¹è±¡ã€‚ï¼ˆå­—ç¬¦ä¸²å¯¹è±¡æ˜¯ Redis äº”ç§ç±»å‹çš„å¯¹è±¡ä¸­å”¯ä¸€ä¸€ç§ä¼šè¢«å…¶ä»–å››ç§ç±»å‹å¯¹è±¡åµŒå¥—çš„å¯¹è±¡ã€‚</p><hr><h4 id="2-3-2-ç¼–ç è½¬åŒ–"><a class="header-anchor" href="#2-3-2-ç¼–ç è½¬åŒ–">Â¶</a>2.3.2 ç¼–ç è½¬åŒ–</h4><p>å½“åˆ—è¡¨å¯¹è±¡å¯ä»¥åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶æ—¶ï¼Œåˆ—è¡¨å¯¹è±¡ä½¿ç”¨ <strong>ziplist</strong> ç¼–ç ï¼š</p><p>â—»ï¸ åˆ—è¡¨å¯¹è±¡ä¿å­˜çš„æ‰€æœ‰å­—ç¬¦ä¸²å…ƒç´ çš„é•¿åº¦éƒ½å°äº 64 å­—èŠ‚ï¼›</p><p>â—»ï¸ åˆ—è¡¨å¯¹è±¡ä¿å­˜çš„å…ƒç´ æ•°é‡å°äº 512 ä¸ªã€‚</p><p>å¦åˆ™ï¼Œä¸€å¾‹ä½¿ç”¨ <strong>linkedlist</strong> ç¼–ç ã€‚ï¼ˆä¸Šé¢ä¸¤ä¸ªä¸Šé™å€¼å¯ä»¥è¢«ä¿®æ”¹ï¼‰</p><hr><h4 id="2-3-3-åˆ—è¡¨å‘½ä»¤çš„å®ç°"><a class="header-anchor" href="#2-3-3-åˆ—è¡¨å‘½ä»¤çš„å®ç°">Â¶</a>2.3.3 åˆ—è¡¨å‘½ä»¤çš„å®ç°</h4><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/redisobj_list_command.png" style="zoom:75%"><blockquote><p>ã€ŠRedis è®¾è®¡ä¸å®ç°ã€‹ ç¬¬å…«ç« ï¼šç¬¬ä¸‰èŠ‚</p></blockquote><hr><h3 id="2-4-å“ˆå¸Œå¯¹è±¡"><a class="header-anchor" href="#2-4-å“ˆå¸Œå¯¹è±¡">Â¶</a>2.4 å“ˆå¸Œå¯¹è±¡</h3><h4 id="2-4-1-å“ˆå¸Œå¯¹è±¡åˆ†ç±»"><a class="header-anchor" href="#2-4-1-å“ˆå¸Œå¯¹è±¡åˆ†ç±»">Â¶</a>2.4.1 å“ˆå¸Œå¯¹è±¡åˆ†ç±»</h4><p>å“ˆå¸Œå¯¹è±¡çš„ç¼–ç å¯ä»¥æ˜¯ <strong>ziplist</strong> æˆ–è€… <strong>hashtable</strong>ã€‚</p><p><strong>ziplist</strong> ç¼–ç çš„å“ˆå¸Œå¯¹è±¡ï¼š</p><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/redisobj_hash_ziplist1.png" style="zoom:61%"> <img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/redisobj_hash_ziplist2.png" style="zoom:61%"><p><strong><font color="FF8888">æ³¨æ„</font></strong>ï¼šğŸ™‹â€â™‚</p><p>ziplist ç¼–ç çš„å“ˆå¸Œå¯¹è±¡ä½¿ç”¨å‹ç¼©åˆ—è¡¨ä½œä¸ºåº•å±‚å®ç°ï¼Œæ¯å½“æœ‰æ–°çš„é”®å€¼å¯¹è¦åŠ å…¥åˆ°å“ˆå¸Œå¯¹è±¡æ—¶ï¼Œç¨‹åºå›å…ˆå°†ä¿å­˜äº†é”®çš„å‹ç¼©åˆ—è¡¨èŠ‚ç‚¹æ¨å…¥å‹ç¼©åˆ—è¡¨è¡¨å°¾ï¼Œç„¶åå†å°†ä¿å­˜äº†å€¼çš„å‹ç¼©åˆ—è¡¨èŠ‚ç‚¹æ¨å…¥åˆ°å‹ç¼©åˆ—è¡¨è¡¨å°¾ï¼Œå› æ­¤ï¼š</p><p>ğŸ”¹ ä¿å­˜äº†åŒä¸€é”®å€¼å¯¹çš„ä¸¤ä¸ªèŠ‚ç‚¹æ€»æ˜¯ç´§ç´§æŒ¨åœ¨ä¸€èµ·çš„ï¼Œä¿å­˜é”®çš„èŠ‚ç‚¹åœ¨å‰ï¼Œä¿å­˜å€¼çš„èŠ‚ç‚¹åœ¨åï¼›</p><p>ğŸ”¸ å…ˆæ·»åŠ åˆ°å“ˆå¸Œå¯¹è±¡ä¸­çš„é”®å€¼ä¼šè¢«æ”¾åœ¨å‹ç¼©åˆ—è¡¨çš„è¡¨å¤´æ–¹å‘ï¼Œè€Œåæ¥æ·»åŠ åˆ°å“ˆå¸Œå¯¹è±¡ä¸­çš„é”®å€¼å¯¹ä¼šè¢«æ”¾åœ¨å‹ç¼©åˆ—è¡¨çš„è¡¨å°¾æ–¹å‘ã€‚</p><p><strong>hashtable</strong> ç¼–ç çš„å“ˆå¸Œå¯¹è±¡ï¼š</p><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/redisobj_hash_hashtable.png" style="zoom:61%"><hr><h4 id="2-4-2-ç¼–ç è½¬åŒ–"><a class="header-anchor" href="#2-4-2-ç¼–ç è½¬åŒ–">Â¶</a>2.4.2 ç¼–ç è½¬åŒ–</h4><p>å½“å“ˆå¸Œå¯¹è±¡å¯ä»¥åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶æ—¶ï¼Œå“ˆå¸Œå¯¹è±¡ä½¿ç”¨ <strong>ziplist</strong> ç¼–ç ï¼š</p><p>â—»ï¸ å“ˆå¸Œå¯¹è±¡ä¿å­˜çš„æ‰€æœ‰é”®å€¼å¯¹çš„é”®å’Œå€¼çš„å­—ç¬¦ä¸²é•¿åº¦éƒ½å°äº 64 å­—èŠ‚ï¼›</p><p>â—»ï¸ å“ˆå¸Œå¯¹è±¡ä¿å­˜çš„é”®å€¼å¯¹æ•°é‡å°äº 512 ä¸ªã€‚</p><p>å¦åˆ™ï¼Œä¸€å¾‹ä½¿ç”¨ <strong>hashtable</strong> ç¼–ç ã€‚ï¼ˆä¸Šé¢ä¸¤ä¸ªä¸Šé™å€¼å¯ä»¥è¢«ä¿®æ”¹ï¼‰</p><hr><h4 id="2-4-3-å“ˆå¸Œå‘½ä»¤çš„å®ç°"><a class="header-anchor" href="#2-4-3-å“ˆå¸Œå‘½ä»¤çš„å®ç°">Â¶</a>2.4.3 å“ˆå¸Œå‘½ä»¤çš„å®ç°</h4><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/redisobj_hash_command.png" style="zoom:65%"><blockquote><p>ã€ŠRedis è®¾è®¡ä¸å®ç°ã€‹ ç¬¬å…«ç« ï¼šç¬¬å››èŠ‚</p></blockquote><hr><h3 id="2-5-é›†åˆå¯¹è±¡"><a class="header-anchor" href="#2-5-é›†åˆå¯¹è±¡">Â¶</a>2.5 é›†åˆå¯¹è±¡</h3><h4 id="2-5-1-é›†åˆå¯¹è±¡åˆ†ç±»"><a class="header-anchor" href="#2-5-1-é›†åˆå¯¹è±¡åˆ†ç±»">Â¶</a>2.5.1 é›†åˆå¯¹è±¡åˆ†ç±»</h4><p>é›†åˆå¯¹è±¡çš„ç¼–ç å¯ä»¥æ˜¯ <strong>intset</strong> æˆ–è€… <strong>hashtable</strong>ã€‚</p><p><strong>intset</strong> ç¼–ç çš„é›†åˆå¯¹è±¡ï¼š</p><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/redisobj_set_intset.png" style="zoom:61%"><p><strong>hashtable</strong> ç¼–ç çš„é›†åˆå¯¹è±¡ï¼š</p><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/redisobj_set_hashtable.png" style="zoom:61%"><hr><h4 id="2-5-2-ç¼–ç è½¬åŒ–"><a class="header-anchor" href="#2-5-2-ç¼–ç è½¬åŒ–">Â¶</a>2.5.2 ç¼–ç è½¬åŒ–</h4><p>å½“é›†åˆå¯¹è±¡å¯ä»¥åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶æ—¶ï¼Œé›†åˆå¯¹è±¡ä½¿ç”¨ <strong>intset</strong> ç¼–ç ï¼š</p><p>â—»ï¸ é›†åˆå¯¹è±¡ä¿å­˜çš„æ‰€æœ‰å…ƒç´ çš„é•¿åº¦éƒ½æ˜¯æ•´æ•°ï¼›</p><p>â—»ï¸ é›†åˆå¯¹è±¡ä¿å­˜çš„å…ƒç´ æ•°é‡å°äº 512 ä¸ªã€‚</p><p>å¦åˆ™ï¼Œä¸€å¾‹ä½¿ç”¨ <strong>hashtable</strong> ç¼–ç ã€‚ï¼ˆä¸Šé¢çš„ä¸Šé™å€¼å¯ä»¥è¢«ä¿®æ”¹ï¼‰</p><hr><h4 id="2-5-3-é›†åˆå‘½ä»¤çš„å®ç°"><a class="header-anchor" href="#2-5-3-é›†åˆå‘½ä»¤çš„å®ç°">Â¶</a>2.5.3 é›†åˆå‘½ä»¤çš„å®ç°</h4><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/redisobj_set_command1.png" style="zoom:61%"> <img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/redisobj_set_command2.png" style="zoom:61%"><blockquote><p>ã€ŠRedis è®¾è®¡ä¸å®ç°ã€‹ ç¬¬å…«ç« ï¼šç¬¬äº”èŠ‚</p></blockquote><hr><h3 id="2-6-æœ‰åºé›†åˆå¯¹è±¡"><a class="header-anchor" href="#2-6-æœ‰åºé›†åˆå¯¹è±¡">Â¶</a>2.6 æœ‰åºé›†åˆå¯¹è±¡</h3><h4 id="2-6-1-æœ‰åºé›†åˆå¯¹è±¡åˆ†ç±»"><a class="header-anchor" href="#2-6-1-æœ‰åºé›†åˆå¯¹è±¡åˆ†ç±»">Â¶</a>2.6.1 æœ‰åºé›†åˆå¯¹è±¡åˆ†ç±»</h4><p>æœ‰åºé›†åˆå¯¹è±¡çš„ç¼–ç å¯ä»¥æ˜¯ <strong>ziplist</strong> æˆ–è€… <strong>skiplist</strong>ã€‚</p><p><strong>ziplist</strong> ç¼–ç çš„æœ‰åºé›†åˆå¯¹è±¡ï¼š</p><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/redisobj_zset_ziplist1.png" style="zoom:61%"> <img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/redisobj_zset_ziplist2.png" style="zoom:61%"><p><strong>skiplist</strong> ç¼–ç çš„æœ‰åºé›†åˆå¯¹è±¡ï¼š</p><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/redisobj_zset_skiplist1.png" style="zoom:61%"> <img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/redisobj_zset_skiplist2.png" style="zoom:61%"><p><strong><font color="FF8888">æ³¨æ„</font></strong>ï¼šğŸ™‹ ä¸Šå›¾å­—å…¸å’Œè·³è·ƒè¡¨ä¸­é‡å¤å±•ç¤ºäº†å„ä¸ªå…ƒç´ çš„æˆå‘˜å’Œåˆ†å€¼ï¼Œä½†åœ¨å®é™…ä¸­ï¼Œå­—å…¸å’Œè·³è·ƒè¡¨ä¼šå…±äº«å…ƒç´ çš„æˆå‘˜å’Œåˆ†å€¼ï¼ˆä½¿ç”¨æŒ‡é’ˆï¼‰ï¼Œæ‰€ä»¥ä¸ä¼šé€ æˆä»»ä½•æ•°æ®é‡å¤ï¼Œä¹Ÿä¸ä¼šå› æ­¤è€Œæµªè´¹èµ„æºã€‚</p><p><strong>skiplist</strong> ç¼–ç çš„æœ‰åºé›†åˆå¯¹è±¡ä½¿ç”¨ <code>zset</code> ç»“æ„ä½œä¸ºåº•å±‚å®ç°ï¼Œä¸€ä¸ª <code>zset</code> ç»“æ„åŒæ—¶åŒ…å«ä¸€ä¸ªå­—å…¸å’Œä¸€ä¸ªè·³è·ƒè¡¨ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">zset</span> &#123;</span></span><br><span class="line">    zskiplist *zsl;</span><br><span class="line">    dict *dict;</span><br><span class="line">&#125; zset;</span><br></pre></td></tr></table></figure><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/redisobj_zset_skiplist_why.png" style="zoom:61%"><hr><h4 id="2-6-2-ç¼–ç è½¬åŒ–"><a class="header-anchor" href="#2-6-2-ç¼–ç è½¬åŒ–">Â¶</a>2.6.2 ç¼–ç è½¬åŒ–</h4><p>å½“æœ‰åºé›†åˆå¯¹è±¡å¯ä»¥åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶æ—¶ï¼Œæœ‰åºé›†åˆå¯¹è±¡ä½¿ç”¨ <strong>ziplist</strong> ç¼–ç ï¼š</p><p>â—»ï¸ æœ‰åºé›†åˆå¯¹è±¡ä¿å­˜çš„å…ƒç´ æ•°é‡å°äº 128 ä¸ªï¼›</p><p>â—»ï¸ é›†åˆå¯¹è±¡ä¿å­˜çš„æ‰€æœ‰å…ƒç´ æˆå‘˜çš„é•¿åº¦éƒ½å°äº 64 å­—èŠ‚ã€‚</p><p>å¦åˆ™ï¼Œä¸€å¾‹ä½¿ç”¨ <strong>skiplist</strong> ç¼–ç ã€‚ï¼ˆä¸Šé¢çš„ä¸Šé™å€¼å¯ä»¥è¢«ä¿®æ”¹ï¼‰</p><hr><h4 id="2-6-3-æœ‰åºé›†åˆå‘½ä»¤çš„å®ç°"><a class="header-anchor" href="#2-6-3-æœ‰åºé›†åˆå‘½ä»¤çš„å®ç°">Â¶</a>2.6.3 æœ‰åºé›†åˆå‘½ä»¤çš„å®ç°</h4><img src="/Database/Redis/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/redisobj_zset_command.png" style="zoom:75%"><blockquote><p>ã€ŠRedis è®¾è®¡ä¸å®ç°ã€‹ ç¬¬å…«ç« ï¼šç¬¬å…­èŠ‚</p></blockquote><hr><h2 id="3-å‚è€ƒèµ„æ–™"><a class="header-anchor" href="#3-å‚è€ƒèµ„æ–™">Â¶</a>3 å‚è€ƒèµ„æ–™</h2><blockquote><p>ã€ŠRedis è®¾è®¡ä¸å®ç°ã€‹</p></blockquote><!-- rebuild by neat -->]]></content>
      <categories>
        <category>Database</category>
      </categories>
      <tags>
        <tag>Database</tag>
      </tags>
  </entry>
  <entry>
    <title>STL_Algorithm</title>
    <url>/C++_Language/STL/Algorithm/</url>
    <content><![CDATA[<!-- build time:Tue Jun 22 2021 17:02:33 GMT+0800 (GMT+08:00) --><a id="more"></a><h1>STL_Algorithm</h1><h2 id="0-æ–‡ä»¶ç»“æ„"><a class="header-anchor" href="#0-æ–‡ä»¶ç»“æ„">Â¶</a>0. æ–‡ä»¶ç»“æ„</h2><p>ç®—æ³•éƒ¨åˆ†æ€»å…±åˆ†ä¸ºäº† 5 ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>algo</li><li>algobase</li><li>algoset</li><li>heap</li><li>numeric</li></ul><h2 id="1-algo"><a class="header-anchor" href="#1-algo">Â¶</a>1. algo</h2><p><strong>ç¬¬ä¸€éƒ¨åˆ†ï¼š</strong></p><p><code>adjacent_find, count, count_if, find, find_if, find_end, find_first_of, for_each, generate, generate_n, remove, remove_copy, remove_if, remove_copy_if, replace, replace_copy,replace_if, replace_copy_if, reverse, reverse_copy, rotate, rotate_copy, search, search_n, swap_range, transform, max_element, min_element, includes, merge, partition, unique, unique_copy</code></p><p><strong>ç¬¬äºŒéƒ¨åˆ†ï¼š</strong></p><p><code>lower_bound, upper_bound, binary_search, next_permutation, prev_permutation, random_shuffle, partial_sort, sort, stable_sort, equal_range, random_shuffle, nth_element, stable_partition</code></p><h3 id="1-1-ç¬¬ä¸€éƒ¨åˆ†"><a class="header-anchor" href="#1-1-ç¬¬ä¸€éƒ¨åˆ†">Â¶</a>1.1 ç¬¬ä¸€éƒ¨åˆ†</h3><p><strong>ç›´æ¥ä¸Šä¾‹å­</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">display</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">const</span> T&amp; x)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; x &lt;&lt; <span class="string">' '</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">even</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">int</span> x)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x % <span class="number">2</span> ? <span class="literal">false</span> : <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">even_by_two</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">operator</span><span class="params">()</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _x += <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> _x;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> even_by_two::_x = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ia[] = &#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">6</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>&#125;;</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">iv</span><span class="params">(ia, ia + <span class="keyword">sizeof</span>(ia) / <span class="keyword">sizeof</span>(<span class="keyword">int</span>))</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰¾åˆ° iv ä¹‹ä¸­ç›¸é‚»å…ƒç´ å€¼ç›¸ç­‰çš„ç¬¬ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; *adjacent_find(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>()) &lt;&lt; <span class="built_in">endl</span>;   <span class="comment">// 6</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; *adjacent_find(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), equal_to&lt;<span class="keyword">int</span>&gt;()) &lt;&lt; <span class="built_in">endl</span>;  <span class="comment">// 6</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰¾åˆ° iv ä¹‹ä¸­å…ƒç´ å€¼ä¸º 6 çš„å…ƒç´ ä¸ªæ•°</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; count(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), <span class="number">6</span>) &lt;&lt; <span class="built_in">endl</span>;  <span class="comment">// 3</span></span><br><span class="line">    <span class="comment">// æ‰¾åˆ° iv ä¹‹ä¸­å°äº 7 çš„ä¸ªæ•°</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; count_if(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), bind2nd(less&lt;<span class="keyword">int</span>&gt;(), <span class="number">7</span>)) &lt;&lt; <span class="built_in">endl</span>; <span class="comment">// 9</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; *<span class="built_in">find</span>(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), <span class="number">4</span>) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; *find_if(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), bind2nd(greater&lt;<span class="keyword">int</span>&gt;(), <span class="number">2</span>)) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ‰¾å‡º iv åºåˆ—ä¹‹ä¸­å­åºåˆ— iv2 æ‰€å‡ºç°çš„æœ€åä¸€ä¸ªä½ç½®ï¼ˆå†å¾€åçš„ä¸‰ä¸ªä½ç½®çš„å€¼ï¼‰</span></span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">iv2</span><span class="params">(ia + <span class="number">6</span>, ia + <span class="number">8</span>)</span></span>;  <span class="comment">// &#123;6 6&#125;</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; *(find_end(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), iv2.<span class="built_in">begin</span>(), iv2.<span class="built_in">end</span>()) + <span class="number">3</span>) &lt;&lt; <span class="built_in">endl</span>; <span class="comment">// 8</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰¾å‡º iv åºåˆ—ä¹‹ä¸­å­åºåˆ— iv2 æ‰€å‡ºç°çš„ç¬¬ä¸€ä¸ªä½ç½®ï¼ˆå†å¾€åçš„ä¸‰ä¸ªä½ç½®çš„å€¼ï¼‰</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; *(find_first_of(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), iv2.<span class="built_in">begin</span>(), iv2.<span class="built_in">end</span>()) + <span class="number">3</span>) &lt;&lt; <span class="built_in">endl</span>; <span class="comment">// 7</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿­ä»£éå†æ•´ä¸ª iv åŒºé—´ï¼Œå¯¹æ¯ä¸ªå…ƒç´ æ–½è¡Œ display æ“ä½œï¼ˆä¸å¾—æ”¹å˜å…ƒç´ å†…å®¹ï¼‰</span></span><br><span class="line">    for_each(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), <span class="built_in">display</span>&lt;<span class="keyword">int</span>&gt;());  <span class="comment">// iv : 0 1 2 3 4 5 6 6 6 7 8</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// generate</span></span><br><span class="line">    generate(iv2.<span class="built_in">begin</span>(), iv2.<span class="built_in">end</span>(), even_by_two());   <span class="comment">// æ¯æ¬¡æ‰§è¡Œä¸€æ¬¡: _x + 2</span></span><br><span class="line">    for_each(iv2.<span class="built_in">begin</span>(), iv2.<span class="built_in">end</span>(), <span class="built_in">display</span>&lt;<span class="keyword">int</span>&gt;());  <span class="comment">// iv2 : 2 4</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    generate_n(iv.<span class="built_in">begin</span>(), <span class="number">3</span>, even_by_two());  <span class="comment">// å‰ä¸‰ä¸ªä¼šè¦†ç›– 6 8 10</span></span><br><span class="line">    for_each(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), <span class="built_in">display</span>&lt;<span class="keyword">int</span>&gt;()); <span class="comment">// iv : 6 8 10 3 4 5 6 6 6 7 8</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// remove </span></span><br><span class="line">    <span class="built_in">remove</span>(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), <span class="number">6</span>);                <span class="comment">// __ ä»£è¡¨æ®‹ä½™æ•°æ®</span></span><br><span class="line">    for_each(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), <span class="built_in">display</span>&lt;<span class="keyword">int</span>&gt;()); </span><br><span class="line">    <span class="comment">// iv : 8 10 3 4 5 7 8 _6_6_7_8_</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">iv3</span><span class="params">(<span class="number">12</span>)</span></span>;</span><br><span class="line">    remove_copy(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), iv3.<span class="built_in">begin</span>(), <span class="number">6</span>); </span><br><span class="line">    for_each(iv3.<span class="built_in">begin</span>(), iv3.<span class="built_in">end</span>(), <span class="built_in">display</span>&lt;<span class="keyword">int</span>&gt;());  </span><br><span class="line">    <span class="comment">// iv3 : 8 10 3 4 5 7 8 7 8 _0_0_0_</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    remove_if(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), bind2nd(less&lt;<span class="keyword">int</span>&gt;(), <span class="number">6</span>));  </span><br><span class="line">    for_each(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), <span class="built_in">display</span>&lt;<span class="keyword">int</span>&gt;());  </span><br><span class="line">    <span class="comment">// iv : 8 10 7 8 6 6 7 8 _7_8_</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    remove_copy_if(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), iv3.<span class="built_in">begin</span>(), bind2nd(less&lt;<span class="keyword">int</span>&gt;(), <span class="number">7</span>));  </span><br><span class="line">    for_each(iv3.<span class="built_in">begin</span>(), iv3.<span class="built_in">end</span>(), <span class="built_in">display</span>&lt;<span class="keyword">int</span>&gt;());  </span><br><span class="line">    <span class="comment">// iv3 : 8 10 7 8 7 8 7 8 8_0_0_0_</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// replace</span></span><br><span class="line">    replace(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), <span class="number">6</span>, <span class="number">3</span>);</span><br><span class="line">    for_each(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), <span class="built_in">display</span>&lt;<span class="keyword">int</span>&gt;());    </span><br><span class="line">    <span class="comment">// iv : 8 10 7 8 3 3 7 8 3 7 8</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    replace_copy(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), iv3.<span class="built_in">begin</span>(), <span class="number">3</span>, <span class="number">5</span>);</span><br><span class="line">    for_each(iv3.<span class="built_in">begin</span>(), iv3.<span class="built_in">end</span>(), <span class="built_in">display</span>&lt;<span class="keyword">int</span>&gt;());  </span><br><span class="line">    <span class="comment">// iv3 : 8 10 7 8 5 5 7 8 5 7 8 _0_</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    replace_if(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), bind2nd(less&lt;<span class="keyword">int</span>&gt;(), <span class="number">5</span>), <span class="number">2</span>);</span><br><span class="line">    for_each(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), <span class="built_in">display</span>&lt;<span class="keyword">int</span>&gt;());    </span><br><span class="line">    <span class="comment">// iv : 8 10 7 8 2 2 7 8 2 7 8 </span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    replace_copy_if(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), iv3.<span class="built_in">begin</span>(), bind2nd(equal_to&lt;<span class="keyword">int</span>&gt;(), <span class="number">8</span>), <span class="number">9</span>);</span><br><span class="line">    for_each(iv3.<span class="built_in">begin</span>(), iv3.<span class="built_in">end</span>(), <span class="built_in">display</span>&lt;<span class="keyword">int</span>&gt;());  </span><br><span class="line">    <span class="comment">// iv3 : 9 10 7 9 2 2 7 9 2 7 9 _0_</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// reverse</span></span><br><span class="line">    reverse(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>());</span><br><span class="line">    for_each(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), <span class="built_in">display</span>&lt;<span class="keyword">int</span>&gt;());  </span><br><span class="line">    <span class="comment">// iv : 8 7 2 8 7 2 2 8 7 10 8</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    reverse_copy(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), iv3.<span class="built_in">begin</span>());</span><br><span class="line">    for_each(iv3.<span class="built_in">begin</span>(), iv3.<span class="built_in">end</span>(), <span class="built_in">display</span>&lt;<span class="keyword">int</span>&gt;()); </span><br><span class="line">    <span class="comment">// iv3: 8 10 7 8 2 2 7 8 2 7 8 _0_</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// rotate</span></span><br><span class="line">    rotate(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">begin</span>() + <span class="number">4</span>, iv.<span class="built_in">end</span>());</span><br><span class="line">    for_each(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), <span class="built_in">display</span>&lt;<span class="keyword">int</span>&gt;());  </span><br><span class="line">    <span class="comment">// iv : 7 2 2 8 7 10 8 8 7 2 8</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    rotate_copy(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">begin</span>() + <span class="number">5</span>, iv.<span class="built_in">end</span>(), iv3.<span class="built_in">begin</span>());</span><br><span class="line">    for_each(iv3.<span class="built_in">begin</span>(), iv3.<span class="built_in">end</span>(), <span class="built_in">display</span>&lt;<span class="keyword">int</span>&gt;()); </span><br><span class="line">    <span class="comment">// iv3: 10 8 8 7 2 8 7 2 2 8 7 _0_</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// search</span></span><br><span class="line">    <span class="keyword">int</span> ia2[<span class="number">3</span>] = &#123;<span class="number">2</span>, <span class="number">8</span>&#125;;</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">iv4</span><span class="params">(ia2, ia2 + <span class="number">2</span>)</span></span>;  <span class="comment">// iv4 : &#123;2 8&#125;</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; *search(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), iv4.<span class="built_in">begin</span>(), iv4.<span class="built_in">end</span>()) &lt;&lt; <span class="built_in">endl</span>;  <span class="comment">// 2</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; *search_n(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), <span class="number">2</span>, <span class="number">8</span>) &lt;&lt; <span class="built_in">endl</span>;  <span class="comment">// 8</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; *search_n(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), <span class="number">3</span>, <span class="number">8</span>, less&lt;<span class="keyword">int</span>&gt;()) &lt;&lt; <span class="built_in">endl</span>;  <span class="comment">// 7</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// swap_range</span></span><br><span class="line">    swap_ranges(iv4.<span class="built_in">begin</span>(), iv4.<span class="built_in">end</span>(), iv.<span class="built_in">begin</span>());</span><br><span class="line">    for_each(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), <span class="built_in">display</span>&lt;<span class="keyword">int</span>&gt;());  <span class="comment">// iv : 2 8 2 8 7 10 8 8 7 2 8</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    for_each(iv4.<span class="built_in">begin</span>(), iv4.<span class="built_in">end</span>(), <span class="built_in">display</span>&lt;<span class="keyword">int</span>&gt;()); <span class="comment">// iv4 : 7 2</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//transform</span></span><br><span class="line">    transform(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), iv.<span class="built_in">begin</span>(), bind2nd(minus&lt;<span class="keyword">int</span>&gt;(), <span class="number">2</span>));</span><br><span class="line">    for_each(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), <span class="built_in">display</span>&lt;<span class="keyword">int</span>&gt;());</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="comment">// ç¬¬ä¸€ä¸ª begin() è¡¨ç¤ºè¾“å…¥åŒºé—´å¼€å§‹ï¼Œç¬¬äºŒä¸ª begin() ç¬¬äºŒä¸ªåŒºé—´å¼€å§‹ï¼Œç¬¬ä¸‰ä¸ªbegin()è¡¨ç¤ºè¾“å‡ºåŒºé—´å¼€å§‹</span></span><br><span class="line">    transform(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), iv.<span class="built_in">begin</span>(), iv.<span class="built_in">begin</span>(), plus&lt;<span class="keyword">int</span>&gt;());</span><br><span class="line">    for_each(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), <span class="built_in">display</span>&lt;<span class="keyword">int</span>&gt;());</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ******************************</span></span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">iv5</span><span class="params">(ia, ia + <span class="keyword">sizeof</span>(ia) / <span class="keyword">sizeof</span>(<span class="keyword">int</span>))</span></span>;</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">iv6</span><span class="params">(ia + <span class="number">4</span>, ia + <span class="number">8</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">iv7</span><span class="params">(<span class="number">15</span>)</span></span>;</span><br><span class="line">    for_each(iv5.<span class="built_in">begin</span>(), iv5.<span class="built_in">end</span>(), <span class="built_in">display</span>&lt;<span class="keyword">int</span>&gt;());       </span><br><span class="line">    <span class="comment">// iv5 : 0 1 2 3 4 5 6 6 6 7 8</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    for_each(iv6.<span class="built_in">begin</span>(), iv6.<span class="built_in">end</span>(), <span class="built_in">display</span>&lt;<span class="keyword">int</span>&gt;());       <span class="comment">// iv6 : 4 5 6 6</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="comment">// max_element, min_element</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; *max_element(iv5.<span class="built_in">begin</span>(), iv5.<span class="built_in">end</span>()) &lt;&lt; <span class="built_in">endl</span>;   <span class="comment">// 8</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; *min_element(iv5.<span class="built_in">begin</span>(), iv5.<span class="built_in">end</span>()) &lt;&lt; <span class="built_in">endl</span>;   <span class="comment">// 0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// includes</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; includes(iv5.<span class="built_in">begin</span>(), iv5.<span class="built_in">end</span>(), iv6.<span class="built_in">begin</span>(), iv6.<span class="built_in">end</span>()) &lt;&lt; <span class="built_in">endl</span>; <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// merge</span></span><br><span class="line">    merge(iv5.<span class="built_in">begin</span>(), iv5.<span class="built_in">end</span>(), iv6.<span class="built_in">begin</span>(), iv6.<span class="built_in">end</span>(), iv7.<span class="built_in">begin</span>());</span><br><span class="line">    for_each(iv7.<span class="built_in">begin</span>(), iv7.<span class="built_in">end</span>(), <span class="built_in">display</span>&lt;<span class="keyword">int</span>&gt;()); </span><br><span class="line">    <span class="comment">// iv7 : 0 1 2 3 4 4 5 5 6 6 6 6 6 7 8</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// partition</span></span><br><span class="line">    partition(iv7.<span class="built_in">begin</span>(), iv7.<span class="built_in">end</span>(), even());</span><br><span class="line">    for_each(iv7.<span class="built_in">begin</span>(), iv7.<span class="built_in">end</span>(), <span class="built_in">display</span>&lt;<span class="keyword">int</span>&gt;());  </span><br><span class="line">    <span class="comment">// iv7 : 0 8 2 6 4 4 6 6 6 6 6 5 5 3 7 1</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// unique</span></span><br><span class="line">    unique(iv5.<span class="built_in">begin</span>(), iv5.<span class="built_in">end</span>());</span><br><span class="line">    for_each(iv5.<span class="built_in">begin</span>(), iv5.<span class="built_in">end</span>(), <span class="built_in">display</span>&lt;<span class="keyword">int</span>&gt;());  </span><br><span class="line">    <span class="comment">// iv5 : 0 1 2 3 4 5 6 7 8 _7_8_</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    unique_copy(iv5.<span class="built_in">begin</span>(), iv5.<span class="built_in">end</span>(), iv7.<span class="built_in">end</span>());</span><br><span class="line">    for_each(iv7.<span class="built_in">begin</span>(), iv7.<span class="built_in">end</span>(), <span class="built_in">display</span>&lt;<span class="keyword">int</span>&gt;());  </span><br><span class="line">    <span class="comment">// 0 1 2 3 4 5 6 7 8 _7_8_5_3_7_1_</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P338 - P343 (ä¾‹å­å‡ºå¤„)</p><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P343 - P372 (å…·ä½“ç»†èŠ‚)</p></blockquote><hr><h3 id="1-2-ç¬¬äºŒéƒ¨åˆ†"><a class="header-anchor" href="#1-2-ç¬¬äºŒéƒ¨åˆ†">Â¶</a>1.2 ç¬¬äºŒéƒ¨åˆ†</h3><p><strong>ç›´æ¥ä¸Šä¾‹å­ï¼š</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iterator&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">even</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">operator</span><span class="params">()</span> <span class="params">(<span class="keyword">int</span> x)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x % <span class="number">2</span> ? <span class="literal">false</span> : <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ia[] = &#123;<span class="number">12</span>,<span class="number">17</span>,<span class="number">20</span>,<span class="number">22</span>,<span class="number">23</span>,<span class="number">30</span>,<span class="number">33</span>,<span class="number">40</span>&#125;;</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">iv</span><span class="params">(ia, ia + <span class="keyword">sizeof</span>(ia) / <span class="keyword">sizeof</span>(<span class="keyword">int</span>))</span></span>;</span><br><span class="line">    <span class="comment">// lower_bound : ç»“æœä¸¥æ ¼ &gt;= å‚æ•°</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; *lower_bound(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), <span class="number">21</span>) &lt;&lt; <span class="built_in">endl</span>;  <span class="comment">// 22</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; *lower_bound(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), <span class="number">22</span>) &lt;&lt; <span class="built_in">endl</span>;  <span class="comment">// 22</span></span><br><span class="line">    <span class="comment">// upper_bound : ç»“æœä¸¥æ ¼ &lt; å‚æ•°</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; *upper_bound(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), <span class="number">21</span>) &lt;&lt; <span class="built_in">endl</span>;  <span class="comment">// 22</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; *upper_bound(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), <span class="number">22</span>) &lt;&lt; <span class="built_in">endl</span>;  <span class="comment">// 23</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// äºŒåˆ†æŸ¥æ‰¾</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; binary_search(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), <span class="number">33</span>) &lt;&lt; <span class="built_in">endl</span>; <span class="comment">// ture</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; binary_search(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), <span class="number">34</span>) &lt;&lt; <span class="built_in">endl</span>; <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line">    <span class="function">ostream_iterator&lt;<span class="keyword">int</span>&gt; <span class="title">oite</span><span class="params">(<span class="built_in">cout</span>, <span class="string">" "</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸‹ä¸€ä¸ªæ’åˆ—ç»„åˆ</span></span><br><span class="line">    next_permutation(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>());</span><br><span class="line">    copy(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), oite);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸Šä¸€ä¸ªæ’åˆ—ç»„åˆ</span></span><br><span class="line">    prev_permutation(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>());</span><br><span class="line">    copy(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), oite);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éšå³é‡æ’</span></span><br><span class="line">    <span class="comment">// shuffle(iv.begin(), iv.end());</span></span><br><span class="line">    <span class="comment">// copy(iv.begin(), iv.end(), oite);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// éƒ¨åˆ†åŒºé—´æ’åº</span></span><br><span class="line">    partial_sort(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">begin</span>() + <span class="number">4</span>, iv.<span class="built_in">end</span>());</span><br><span class="line">    copy(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), oite);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// sort å¢åº</span></span><br><span class="line">    sort(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>());</span><br><span class="line">    copy(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), oite);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="comment">// é™åº</span></span><br><span class="line">    sort(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), greater&lt;<span class="keyword">int</span>&gt;());</span><br><span class="line">    copy(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), oite);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ¨ iv å°¾ç«¯é™„åŠ ä¸‰ä¸ªæ–°å…ƒç´ </span></span><br><span class="line">    iv.push_back(<span class="number">22</span>);</span><br><span class="line">    iv.push_back(<span class="number">30</span>);</span><br><span class="line">    iv.push_back(<span class="number">17</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¨³å®šç‰ˆæœ¬çš„ sort</span></span><br><span class="line">    stable_sort(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>());</span><br><span class="line">    copy(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), oite);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// equal_range é¢å¯¹æœ‰åºåŒºé—´</span></span><br><span class="line">    <span class="comment">// è¿”å›è¯¥å­åŒºé—´çš„é¦–å°¾è¿­ä»£å™¨</span></span><br><span class="line">    <span class="comment">// å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œå°±è¿”å›å¯æ’å…¥çš„åŒºåŸŸ</span></span><br><span class="line">    pair&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;::iterator, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;::iterator&gt; pairIte;</span><br><span class="line">    pairIte = equal_range(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), <span class="number">22</span>);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; *(pairIte.first) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; *(pairIte.second) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    pairIte = equal_range(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), <span class="number">25</span>);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; *(pairIte.first) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; *(pairIte.second) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// random_shuffle(iv.begin(), iv.end());</span></span><br><span class="line">    <span class="comment">// copy(iv.begin(), iv.end(), oite);</span></span><br><span class="line">    <span class="comment">// cout &lt;&lt; endl;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†å°äº iv.begin() + 5 çš„å…ƒç´ ç½®äºè¯¥å…ƒç´ å·¦è¾¹</span></span><br><span class="line">    nth_element(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">begin</span>() + <span class="number">5</span>, iv.<span class="built_in">end</span>());</span><br><span class="line">    copy(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), oite);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†å¤§äº iv.begin() + 5 çš„å…ƒç´ ç½®äºè¯¥å…ƒç´ å·¦è¾¹</span></span><br><span class="line">    nth_element(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">begin</span>() + <span class="number">5</span>, iv.<span class="built_in">end</span>(), greater&lt;<span class="keyword">int</span>&gt;());</span><br><span class="line">    copy(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), oite);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    stable_partition(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), even());</span><br><span class="line">    copy(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), oite);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P372 - P374</p></blockquote><hr><h3 id="1-2-1-sort"><a class="header-anchor" href="#1-2-1-sort">Â¶</a>1.2.1 sort</h3><p>å¿«é€Ÿæ’åºä¼šä¸ºäº†ä¸€äº›å°åºåˆ—äº§ç”Ÿå¤§é‡çš„é€’å½’è°ƒç”¨ï¼Œ<code>quick sort</code> åœ¨æ•ˆç‡ä¸Šåè€Œä½äº <code>insertion sort</code>ï¼ŒSTLé‡Œé¢çš„è®¾è®¡äº†ä¸¤ä¸ª <strong>threshold</strong>ï¼š<code>_lg</code>, <code>_stl_threshold</code>ã€‚</p><p><code>_lg</code> ç”¨ä»¥æ§åˆ¶åˆ†å‰²æ¶åŒ–çš„æƒ…å†µï¼Œç”¨ä»¥é€‰æ‹© <code>quick_sort</code> æˆ–è€… <code>heap_sort</code>ï¼›</p><p><code>_stl_threshold</code> é»˜è®¤ä¸º 16 ç”¨ä»¥ä½œä¸ºé€‰æ‹©<code>quick_sort</code> æˆ–è€… <code>insertion sort</code>;</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// sort å¯¹å¤–æ¥å£</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">RandomAccessIterator</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">void</span> <span class="title">sort</span>(<span class="title">RandomAccessIterator</span> <span class="title">first</span>, <span class="title">RandomAccessIterator</span> <span class="title">last</span>) &#123;</span></span><br><span class="line">    <span class="keyword">if</span> (first != last) &#123;					           <span class="comment">// _lg è®¾å®šé€’å½’æ·±åº¦ä¸Šé™ </span></span><br><span class="line">        __introsort_loop(first, last, value_type(first), __lg(last - first) * <span class="number">2</span>);</span><br><span class="line">        __final_insertion_sort(first, last);    <span class="comment">// æ’å…¥æ’åº</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// _lg:ç”¨ä»¥æ§åˆ¶åˆ†å‰²æ¶åŒ–çš„æƒ…å†µï¼Œæ‰¾å‡º 2^k &lt;= n çš„æœ€å¤§å€¼ k</span></span><br><span class="line"><span class="comment">// ä¸¾ä¾‹è€Œè¨€ï¼Œå½“ size = 40 æ—¶ï¼Œ_lg = 5</span></span><br><span class="line"><span class="comment">// __introsort_loop çš„æœ€åä¸€ä¸ªå‚æ•°ä¸º 5*2ï¼Œå³æœ€å¤šå…è®¸åˆ†å‰² 5*2 å±‚</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Size</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">Size</span> __<span class="title">lg</span>(<span class="title">Size</span> <span class="title">n</span>) &#123;</span></span><br><span class="line">    Size k;</span><br><span class="line">    <span class="keyword">for</span> (k = <span class="number">0</span>; n &gt; <span class="number">1</span>; n &gt;&gt;= <span class="number">1</span>) ++k;</span><br><span class="line">    <span class="keyword">return</span> k;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// __introsort_loopï¼šintosortçš„å…·ä½“å®ç°</span></span><br><span class="line"><span class="comment">// å­åºåˆ—é•¿åº¦å¤§äº 16 ä½¿ç”¨å¿«é€Ÿæ’åºï¼Œå­åºåˆ—é•¿åº¦å°äº 16 ä½¿ç”¨æ’å…¥æ’åº</span></span><br><span class="line"><span class="comment">// (é€’å½’æ·±åº¦æœªè¾¾åˆ°ä¸Šé™ï¼Œä½¿ç”¨å¿«é€Ÿæ’åºï¼Œé€’å½’æ·±åº¦è¾¾åˆ°ä¸Šé™ï¼Œä½¿ç”¨å †æ’åºï¼Œåç›´æ¥è¿”å›)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">RandomAccessIterator</span>, <span class="title">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Size</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">void</span> __<span class="title">introsort_loop</span>(<span class="title">RandomAccessIterator</span> <span class="title">first</span>, <span class="title">RandomAccessIterator</span> <span class="title">last</span>, <span class="title">T</span> *, <span class="title">Size</span> <span class="title">depth_limit</span>) &#123;</span></span><br><span class="line">    <span class="comment">//__STL_thresholdæ˜¯ä¸€ä¸ªå®šä¹‰ä¸º 16 çš„å…¨å±€å¸¸æ•°</span></span><br><span class="line">    <span class="keyword">while</span> (last - first &gt; <span class="comment">/*__stl_threshold*/</span> <span class="number">16</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (depth_limit == <span class="number">0</span>) &#123;               <span class="comment">// å·²ç»äº§ç”Ÿäº†åˆ†å‰²æ¶åŒ–</span></span><br><span class="line">            partial_sort(first, last, last);  <span class="comment">// æ”¹ç”¨ heap-sort</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        --depth_limit;  <span class="comment">// æ¯æ¬¡é€’å½’å°±ä¼šè¶Šæ¥è¿‘ä¸Šé™</span></span><br><span class="line">        RandomAccessIterator cut = __unguarded_partition(first, last,</span><br><span class="line">            T(__median(*first, *(first + (last - first) / <span class="number">2</span>), *(last - <span class="number">1</span>))));</span><br><span class="line">        __introsort_loop(cut, last, value_type(first), depth_limit); <span class="comment">// é€’å½’</span></span><br><span class="line">        last = cut;  <span class="comment">// å›å½’ whileï¼Œæ‰§è¡Œå·¦ä¾§æ’åº</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// last - first &lt;= 16 ä¼š return, å›åˆ°ä¸»å‡½æ•°</span></span><br><span class="line">    <span class="comment">// æ¥ç€è°ƒç”¨ __final_insertion_sort (æ’å…¥æ’åº)</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ’å…¥æ’åº...</span></span><br><span class="line"><span class="keyword">void</span> __final_insertion_sort(RandomAccessIterator first, RandomAccessIterator last)&#123;&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P389 - P400</p></blockquote><hr><h2 id="2-algobase"><a class="header-anchor" href="#2-algobase">Â¶</a>2. algobase</h2><p>STL æ ‡å‡†è§„æ ¼ä¸­å¹¶æ²¡æœ‰åŒºåˆ†åŸºæœ¬ç®—æ³•æˆ–å¤æ‚ç®—æ³•ï¼Œç„¶è€ŒSGIå´æŠŠå¸¸ç”¨çš„ä¸€äº›ç®—æ³•å®šä¹‰ä¸<code>&lt;stl_algobase.h&gt;</code> ä¹‹ä¸­ï¼Œå…¶ä»–ç®—æ³•å®šä¹‰ä¸ <code>&lt;stl_algo.h&gt;</code>ä¸­ï¼Œä»¥ä¸‹ä¸€ä¸€åˆ—ä¸¾è¿™äº›æ‰€è°“çš„åŸºæœ¬ç®—æ³•ã€‚ä»¥ä¸‹åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†ï¼š<code>equal,fill,fill_n,iter_swap,lexicographical_compare,max,min,mismatch,swap</code></p><p>ç¬¬äºŒéƒ¨åˆ†ï¼š<code>copy, copy_backward</code></p><h3 id="2-1-ç¬¬ä¸€éƒ¨åˆ†"><a class="header-anchor" href="#2-1-ç¬¬ä¸€éƒ¨åˆ†">Â¶</a>2.1 ç¬¬ä¸€éƒ¨åˆ†</h3><p><strong>ç›´æ¥ä¸Šä¾‹å­ï¼š</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iterator&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">display</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">const</span> T&amp; x)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; x &lt;&lt; <span class="string">' '</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ia[<span class="number">9</span>] = &#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>&#125;;</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">iv1</span><span class="params">(ia, ia + <span class="number">5</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">iv2</span><span class="params">(ia, ia + <span class="number">9</span>)</span></span>;</span><br><span class="line">    <span class="comment">// &#123;0,1,2,3,4&#125;  v.s &#123;0,1,2,3,4,5,6,7,8&#125;</span></span><br><span class="line">    <span class="comment">// è¯¥æ“ä½œå¾ˆå±é™©ï¼Œåº”è¯¥å…ˆåˆ¤æ–­è¿”å›çš„è¿­ä»£å™¨æ˜¯å¦ä¸ç­‰äºå®¹å™¨çš„ end()</span></span><br><span class="line">    <span class="comment">// cout &lt;&lt; *(mismatch(iv1.begin(), iv1.end(), iv2.begin()).first);   </span></span><br><span class="line">    <span class="comment">// cout &lt;&lt; *(mismatch(iv1.begin(), iv1.end(), iv2.begin()).second);</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¦‚æœç¬¬äºŒåºåˆ—çš„å…ƒç´ è¾ƒå¤šï¼Œå¤šå‡ºæ¥çš„ä¸äºˆè€ƒè™‘</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; equal(iv1.<span class="built_in">begin</span>(), iv1.<span class="built_in">end</span>(), iv2.<span class="built_in">begin</span>()) &lt;&lt; <span class="built_in">endl</span>;  <span class="comment">// 1, true</span></span><br><span class="line">    <span class="comment">// &#123;0,1,2,3,4&#125; ä¸ç­‰äº &#123;3ï¼Œ4ï¼Œ5ï¼Œ6ï¼Œ7&#125;</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; equal(iv1.<span class="built_in">begin</span>(), iv1.<span class="built_in">end</span>(), &amp;ia[<span class="number">3</span>]) &lt;&lt; <span class="built_in">endl</span>; <span class="comment">// 0, false </span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">fill</span>(iv1.<span class="built_in">begin</span>(), iv1.<span class="built_in">end</span>(), <span class="number">9</span>);   <span class="comment">// 9 9 9 9 9</span></span><br><span class="line">    for_each(iv1.<span class="built_in">begin</span>(), iv1.<span class="built_in">end</span>(), <span class="built_in">display</span>&lt;<span class="keyword">int</span>&gt;()); <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    fill_n(iv1.<span class="built_in">begin</span>(), <span class="number">3</span>, <span class="number">7</span>);         <span class="comment">// 7 7 7 9 9</span></span><br><span class="line">    for_each(iv1.<span class="built_in">begin</span>(), iv1.<span class="built_in">end</span>(), <span class="built_in">display</span>&lt;<span class="keyword">int</span>&gt;()); <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;::iterator ite1 = iv1.<span class="built_in">begin</span>();   <span class="comment">// æŒ‡å‘ 7</span></span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;::iterator ite2 = ite1;</span><br><span class="line">    advance(ite2, <span class="number">3</span>);  <span class="comment">// æŒ‡å‘ 9</span></span><br><span class="line"></span><br><span class="line">    iter_swap(ite1, ite2);  <span class="comment">// 9 7 7 9 9</span></span><br><span class="line">    for_each(iv1.<span class="built_in">begin</span>(), iv1.<span class="built_in">end</span>(), <span class="built_in">display</span>&lt;<span class="keyword">int</span>&gt;()); <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">max</span>(*ite1, *ite2) &lt;&lt; <span class="built_in">endl</span>;  <span class="comment">// 9</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">min</span>(*ite1, *ite2) &lt;&lt; <span class="built_in">endl</span>;  <span class="comment">// 7</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»¥ä¸‹æ˜¯é”™è¯¯å½¢å¼ï¼Œæ¯”è¾ƒçš„è¿­ä»£å™¨æœ¬èº«çš„å¤§å°ï¼Œä¸æ‰€æŒ‡å‘çš„å…ƒç´ æ— å…³</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; *<span class="built_in">max</span>(ite1, ite2) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; *<span class="built_in">min</span>(ite1, ite2) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// iv1 : 9 7 7 7 9; iv2 : 0 1 2 3 4 5 6 7 8</span></span><br><span class="line">    swap(*iv1.<span class="built_in">begin</span>(), *iv2.<span class="built_in">begin</span>());</span><br><span class="line">    for_each(iv1.<span class="built_in">begin</span>(), iv1.<span class="built_in">end</span>(), <span class="built_in">display</span>&lt;<span class="keyword">int</span>&gt;()); <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;  </span><br><span class="line">    <span class="comment">// 0 7 7 7 9</span></span><br><span class="line">    for_each(iv2.<span class="built_in">begin</span>(), iv2.<span class="built_in">end</span>(), <span class="built_in">display</span>&lt;<span class="keyword">int</span>&gt;()); <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="comment">// 9 1 2 3 4 5 6 7 8</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">string</span> stra1[] = &#123;<span class="string">"jamie"</span>, <span class="string">"JJHou"</span>, <span class="string">"Jason"</span>&#125;;</span><br><span class="line">    <span class="built_in">string</span> stra2[] = &#123;<span class="string">"jamie"</span>, <span class="string">"JJHou"</span>, <span class="string">"Jerry"</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; lexicographical_compare(stra1, stra1 + <span class="number">2</span>, stra2, stra2 + <span class="number">2</span>) &lt;&lt; <span class="built_in">endl</span>;  <span class="comment">// 1</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; lexicographical_compare(stra1, stra1 + <span class="number">2</span>, stra2, stra2 + <span class="number">2</span>, greater&lt;<span class="built_in">string</span>&gt;()) &lt;&lt; <span class="built_in">endl</span>; <span class="comment">// 0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P306 - P307</p></blockquote><hr><h3 id="2-2-ç¬¬äºŒéƒ¨åˆ†"><a class="header-anchor" href="#2-2-ç¬¬äºŒéƒ¨åˆ†">Â¶</a>2.2 ç¬¬äºŒéƒ¨åˆ†</h3><p><code>copy()</code> çš„æ“ä½œè„‰ç»œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><img src="/C++_Language/STL/Algorithm/copyè„‰ç»œ.png" style="zoom:75%"><p>ä¸Šè¿°çš„å„ä¸ªç‰ˆæœ¬çš„çš„æµ‹è¯•è§ï¼š</p><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P321 - P324</p></blockquote><p>**<font color="FF8888">æ³¨æ„ï¼š</font>**copy()ï¼Œä»¥åŠcopy_backward() éœ€è¦æ³¨æ„åŒºé—´é‡å çš„æƒ…å†µã€‚</p><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P301, P326</p></blockquote><hr><h2 id="3-algoset"><a class="header-anchor" href="#3-algoset">Â¶</a>3. algoset</h2><p>STL ä¸€å…±æä¾›äº†å››ç§ä¸ set ç›¸å…³çš„ç®—æ³•ï¼Œåˆ†åˆ«æ˜¯å¹¶é›†ã€äº¤é›†ã€å·®é›†å’Œå¯¹ç§°å·®é›†ã€‚æœ¬èŠ‚çš„å››ä¸ªç®—æ³•æ‰€æ¥å—çš„ setï¼Œå¿…é¡»æ˜¯æœ‰åºåŒºé—´ï¼Œå…ƒç´ å€¼å¯ä»¥é‡å¤å‡ºç°ã€‚</p><p><strong>ç›´æ¥ä¸Šä¾‹å­ï¼š</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iterator&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">display</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">const</span> T&amp; x)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; x &lt;&lt; <span class="string">' '</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ia1[<span class="number">6</span>] = &#123;<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">9</span>,<span class="number">11</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> ia2[<span class="number">7</span>] = &#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">8</span>,<span class="number">13</span>&#125;;</span><br><span class="line">    <span class="function"><span class="built_in">multiset</span>&lt;<span class="keyword">int</span>&gt; <span class="title">S1</span><span class="params">(ia1, ia1 + <span class="number">6</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="built_in">multiset</span>&lt;<span class="keyword">int</span>&gt; <span class="title">S2</span><span class="params">(ia2, ia2 + <span class="number">7</span>)</span></span>;</span><br><span class="line">    <span class="comment">// &#123;1,3,5,7,9,11&#125;</span></span><br><span class="line">    for_each(S1.<span class="built_in">begin</span>(), S1.<span class="built_in">end</span>(), <span class="built_in">display</span>&lt;<span class="keyword">int</span>&gt;()); <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="comment">// &#123;1,1,2,3,5,8,13&#125;</span></span><br><span class="line">    for_each(S2.<span class="built_in">begin</span>(), S2.<span class="built_in">end</span>(), <span class="built_in">display</span>&lt;<span class="keyword">int</span>&gt;()); <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">multiset</span>&lt;<span class="keyword">int</span>&gt;::iterator first1 = S1.<span class="built_in">begin</span>();</span><br><span class="line">    <span class="built_in">multiset</span>&lt;<span class="keyword">int</span>&gt;::iterator last1  = S1.<span class="built_in">end</span>();</span><br><span class="line">    <span class="built_in">multiset</span>&lt;<span class="keyword">int</span>&gt;::iterator first2 = S2.<span class="built_in">begin</span>();</span><br><span class="line">    <span class="built_in">multiset</span>&lt;<span class="keyword">int</span>&gt;::iterator last2  = S2.<span class="built_in">end</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function">ostream_iterator&lt;<span class="keyword">int</span>&gt; <span class="title">oite</span><span class="params">(<span class="built_in">cout</span>, <span class="string">" "</span>)</span></span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"Union of S1 and S2: "</span>;</span><br><span class="line">    set_union(first1, last1, first2, last2, oite); <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="comment">// Union of S1 and S2: 1 1 2 3 5 7 8 9 11 13</span></span><br><span class="line">    <span class="comment">// é‡å¤å…ƒç´ ä¸º max(m, n) æ¬¡, m æ˜¯ S1 ä¸­å‡ºç°çš„æ¬¡æ•°, n æ˜¯ S2 ä¸­å‡ºç°çš„æ¬¡æ•°ã€‚</span></span><br><span class="line"></span><br><span class="line">    first1 = S1.<span class="built_in">begin</span>();</span><br><span class="line">    first2 = S2.<span class="built_in">begin</span>();</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"Intersection of S1 and S3: "</span>;</span><br><span class="line">    set_intersection(first1, last1, first2, last2, oite); <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="comment">// Intersection of S1 and S3: 1 3 5</span></span><br><span class="line">    <span class="comment">// é‡å¤å…ƒç´ ä¸º min(m, n) æ¬¡, m æ˜¯ S1 ä¸­å‡ºç°çš„æ¬¡æ•°, n æ˜¯ S2 ä¸­å‡ºç°çš„æ¬¡æ•°ã€‚</span></span><br><span class="line"></span><br><span class="line">    first1 = S1.<span class="built_in">begin</span>();</span><br><span class="line">    first2 = S2.<span class="built_in">begin</span>();</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"Difference of S1 and S2 (S1 - S2): "</span>;</span><br><span class="line">    set_difference(first1, last1, first2, last2, oite); <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="comment">// Difference of S1 and S2 (S1 - S2): 7 9 11</span></span><br><span class="line">    <span class="comment">// é‡å¤å…ƒç´ ä¸º max(n - m, 0) æ¬¡, m æ˜¯ S1 ä¸­å‡ºç°çš„æ¬¡æ•°, n æ˜¯ S2 ä¸­å‡ºç°çš„æ¬¡æ•°ã€‚</span></span><br><span class="line">    <span class="comment">// set_difference è¡¨ç¤º S1 ä¸­æœ‰ S2 ä¸­æ²¡æœ‰,è¡¨ç¤º -&gt; S1 - S1 âˆ© S2</span></span><br><span class="line"></span><br><span class="line">    first1 = S1.<span class="built_in">begin</span>();</span><br><span class="line">    first2 = S2.<span class="built_in">begin</span>();</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"Difference of S2 and S1 (S2 - S1): "</span>;</span><br><span class="line">    set_difference(first2, last2, first1, last1, oite); <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    first1 = S1.<span class="built_in">begin</span>();</span><br><span class="line">    first2 = S2.<span class="built_in">begin</span>();</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"symmetric difference of S1 and S2: "</span>;</span><br><span class="line">    set_symmetric_difference(first1, last1, first2, last2, oite); <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="comment">// set_symmetric_difference è¡¨ç¤º -&gt; S1 U S2 - S1 âˆ© S2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/C++_Language/STL/Algorithm/set_example.png" alt></p><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P329 - P330</p></blockquote><hr><h2 id="4-heap"><a class="header-anchor" href="#4-heap">Â¶</a>4 heap</h2><p>åŒ…å«ä»¥ä¸‹å››ä¸ªå‡½æ•°ï¼š<code>make_heap, pop_heap, push_heap, sort_heap</code></p><hr><h2 id="5-numeric"><a class="header-anchor" href="#5-numeric">Â¶</a>5. numeric</h2><p>è¯¥éƒ¨åˆ†çš„ç®—æ³•ï¼Œç»Ÿç§°ä¸ºæ•°å€¼ç®—æ³•ï¼Œæ¬²ä½¿ç”¨ä»–ä»¬å¿…é¡»è¦åŒ…å«å¤´æ–‡ä»¶ã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;numeric&gt;</span></span></span><br></pre></td></tr></table></figure><p>æ€»å…±åŒ…å«äº† 6 ä¸ªç®—æ³•ï¼š</p><ul><li><code>accumulate</code></li><li><code>adjacent_difference</code></li><li><code>partial_sum</code></li><li><code>inner_product</code></li><li><code>power</code></li><li><code>iota</code></li></ul><h3 id="5-1-accumulate"><a class="header-anchor" href="#5-1-accumulate">Â¶</a>5.1 <code>accumulate</code></h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ~ ç´¯ç§¯ç®—æ³•</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator</span>, <span class="title">class</span> <span class="title">T</span>&gt;  // ~ å¦‚æœæ²¡æœ‰ç»™å®šåˆå€¼ï¼Œä¼šé»˜è®¤åˆå§‹åŒ–ä¸€ä¸ª</span></span><br><span class="line"><span class="class"><span class="title">T</span> <span class="title">accumulate</span>(<span class="title">InputIterator</span> <span class="title">first</span>, <span class="title">InputIterator</span> <span class="title">last</span>, <span class="title">T</span> <span class="title">init</span> = <span class="title">T</span>()) &#123;</span></span><br><span class="line">    <span class="keyword">for</span> (; first != last; ++first) init += *first;</span><br><span class="line">    <span class="keyword">return</span> init;    <span class="comment">// ~ è¿”å›ä¸´æ—¶å¯¹è±¡</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator</span>, <span class="title">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">BinaryOperation</span>&gt;  </span></span><br><span class="line"><span class="class">// ~ äºŒå…ƒæ“ä½œç¬¦,ä¸å¿…æ»¡è¶³äº¤æ¢å¾‹ã€ç»“åˆå¾‹</span></span><br><span class="line"><span class="class"><span class="title">T</span> <span class="title">accumulate</span>(<span class="title">InputIterator</span> <span class="title">first</span>, <span class="title">InputIterator</span> <span class="title">last</span>, <span class="title">T</span> <span class="title">init</span>, <span class="title">BinaryOperation</span> <span class="title">binary_op</span>) &#123;</span>  </span><br><span class="line">    <span class="keyword">for</span> (; first != last; ++first) binary_op(init, *first);  <span class="comment">// ~ å¯ä»¥ä¼ å…¥äºŒå…ƒä»¿å‡½æ•°</span></span><br><span class="line">    <span class="keyword">return</span> init;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>**ä½¿ç”¨ï¼š**è¯¦ç»†ä»£ç è§ 5.7</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; iv&#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>&#125;;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; accumulate(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), <span class="number">0</span>) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"><span class="comment">// output : 20</span></span><br><span class="line"><span class="comment">// 0 + 2 + 3 + 4 + 5 + 6</span></span><br></pre></td></tr></table></figure><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P299 - P300</p></blockquote><hr><h3 id="5-2-adjacent-difference"><a class="header-anchor" href="#5-2-adjacent-difference">Â¶</a>5.2 <code>adjacent_difference</code></h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator</span>, <span class="title">class</span> <span class="title">OutputIterator</span>&gt;  // ! ç‰ˆæœ¬ä¸€</span></span><br><span class="line"><span class="class"><span class="title">OutputIterator</span> <span class="title">adjacent_difference</span>(<span class="title">InputIterator</span> <span class="title">first</span>, <span class="title">InputIterator</span> <span class="title">last</span>, <span class="title">OutputIterator</span> <span class="title">result</span>) &#123;</span></span><br><span class="line">    <span class="keyword">if</span> (first == last) <span class="keyword">return</span> first;</span><br><span class="line">    *result = *first;   <span class="comment">// ! è®°å½•ç¬¬ä¸€ä¸ªå…ƒç´                             </span></span><br><span class="line">    <span class="keyword">return</span> __adjacent_difference(first, last, result, value_type(first));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator</span>, <span class="title">class</span> <span class="title">OutputIterator</span>, <span class="title">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">OutputIterator</span> __<span class="title">adjacent_difference</span>(<span class="title">InputIterator</span> <span class="title">first</span>, <span class="title">InputIterator</span> <span class="title">last</span>, <span class="title">OutputIterator</span> <span class="title">result</span>, <span class="title">T</span> *) &#123;</span></span><br><span class="line">    T value = *result;</span><br><span class="line">    <span class="keyword">while</span> (++first != last) &#123;</span><br><span class="line">        T temp = *first;</span><br><span class="line">        *++result = temp - value;  <span class="comment">// ! å…ˆ++ï¼Œé¦–éƒ¨å…ƒç´ è¿˜æ˜¯åŸæ¥çš„æ•°æ®</span></span><br><span class="line">        value = temp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ++result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator</span>, <span class="title">class</span> <span class="title">OutputIterator</span>, <span class="title">class</span> <span class="title">BinaryOperation</span>&gt; // ! ç‰ˆæœ¬äºŒ</span></span><br><span class="line"><span class="class"><span class="title">OutputIterator</span> <span class="title">adjacent_difference</span>(<span class="title">InputIterator</span> <span class="title">first</span>, <span class="title">InputIterator</span> <span class="title">last</span>, <span class="title">OutputIterator</span> <span class="title">result</span>, <span class="title">BinaryOperation</span> <span class="title">binary_op</span>) &#123;</span>  <span class="comment">// ! ä¼ å…¥ä»¿å‡½æ•°çš„ç‰ˆæœ¬</span></span><br><span class="line">    <span class="keyword">if</span> (first == last) <span class="keyword">return</span> first;</span><br><span class="line">    *result = *first;</span><br><span class="line">    <span class="keyword">return</span> __adjacent_difference(first, last, result, value_type(first), binary_op);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator</span>, <span class="title">class</span> <span class="title">OutputIterator</span>, <span class="title">class</span> <span class="title">T</span>,</span></span><br><span class="line"><span class="class">          <span class="title">class</span> <span class="title">BinaryOperation</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">OutputIterator</span> __<span class="title">adjacent_difference</span>(<span class="title">InputIterator</span> <span class="title">first</span>, <span class="title">InputIterator</span> <span class="title">last</span>, <span class="title">OutputIterator</span> <span class="title">result</span>, <span class="title">T</span> *,<span class="title">BinaryOperation</span> <span class="title">binary_op</span>) &#123;</span></span><br><span class="line">    T value = *result;</span><br><span class="line">    <span class="keyword">while</span> (++first != last) &#123;</span><br><span class="line">        T temp = *first;</span><br><span class="line">        *++result = binary_op(temp, value);  <span class="comment">// ! ä¸‹ä¸€ä¸ªå…ƒç´ åœ¨è¿ç®—ç¬¦å·¦ä¾§</span></span><br><span class="line">        value = temp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ++result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å­˜åœ¨ä¸¤ä¸ªç‰ˆæœ¬ï¼Œåˆ†åˆ«é’ˆå¯¹é»˜è®¤çš„é‚»æ¥å·®å€¼ç‰ˆæœ¬ï¼Œä»¥åŠè‡ªå®šä¹‰ä»¿å‡½æ•°ç‰ˆæœ¬ã€‚</p><p><strong>ä½¿ç”¨ï¼š</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; iv&#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>&#125;;</span><br><span class="line"><span class="function">ostream_iterator&lt;<span class="keyword">int</span>&gt; <span class="title">oite</span><span class="params">(<span class="built_in">cout</span>, <span class="string">" "</span>)</span></span>;</span><br><span class="line">adjacent_difference(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), oite);</span><br><span class="line">adjacent_difference(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), oite, plus&lt;<span class="keyword">int</span>&gt;());</span><br><span class="line"><span class="comment">// output1 : 2 1 1 1 1                     </span></span><br><span class="line"><span class="comment">//        (2, 3-2, 4-3, 5-4, 6-5)   	 </span></span><br><span class="line"><span class="comment">// output2 : 2 5 7 9 11</span></span><br><span class="line"><span class="comment">//        (2, 3+2, 4+3, 5+4, 6+5)</span></span><br></pre></td></tr></table></figure><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P300 - P301</p></blockquote><hr><h3 id="5-3-partial-sum"><a class="header-anchor" href="#5-3-partial-sum">Â¶</a>5.3 <code>partial_sum</code></h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator</span>, <span class="title">class</span> <span class="title">OutputIterator</span>&gt; // @ ç‰ˆæœ¬ä¸€</span></span><br><span class="line"><span class="class"><span class="title">OutputIterator</span> <span class="title">partial_sum</span>(<span class="title">InputIterator</span> <span class="title">first</span>, <span class="title">InputIterator</span> <span class="title">last</span>, <span class="title">OutputIterator</span> <span class="title">result</span>) &#123;</span></span><br><span class="line">    <span class="keyword">if</span> (first == last) <span class="keyword">return</span> first;</span><br><span class="line">    *result = *first;</span><br><span class="line">    <span class="keyword">return</span> __partial_sum(first, last, result, value_type(first));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator</span>, <span class="title">class</span> <span class="title">OutputIterator</span>, <span class="title">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">OutputIterator</span> __<span class="title">partial_sum</span>(<span class="title">InputIterator</span> <span class="title">first</span>, <span class="title">InputIterator</span> <span class="title">last</span>,</span></span><br><span class="line"><span class="class">                             <span class="title">OutputIterator</span> <span class="title">result</span>, <span class="title">T</span> *) &#123;</span></span><br><span class="line">    T value = *first;</span><br><span class="line">    <span class="keyword">while</span> (++first != last) &#123;</span><br><span class="line">        value += *first;   <span class="comment">// @ é»˜è®¤åŠ æ³•</span></span><br><span class="line">        *++result = value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ++result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator</span>, <span class="title">class</span> <span class="title">OutputIterator</span>, <span class="title">class</span> <span class="title">BinaryOperation</span>&gt; // @ ç‰ˆæœ¬äºŒ</span></span><br><span class="line"><span class="class"><span class="title">OutputIterator</span> <span class="title">partial_sum</span>(<span class="title">InputIterator</span> <span class="title">first</span>, <span class="title">InputIterator</span> <span class="title">last</span>,</span></span><br><span class="line"><span class="class">                           <span class="title">OutputIterator</span> <span class="title">result</span>, <span class="title">BinaryOperation</span> <span class="title">binary_op</span>) &#123;</span></span><br><span class="line">    <span class="keyword">if</span> (first == last) <span class="keyword">return</span> first;</span><br><span class="line">    *result = *first;</span><br><span class="line">    <span class="keyword">return</span> __partial_sum(first, last, result, value_type(first), binary_op);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator</span>, <span class="title">class</span> <span class="title">OutputIterator</span>, <span class="title">class</span> <span class="title">T</span>,</span></span><br><span class="line"><span class="class">          <span class="title">class</span> <span class="title">BinaryOperation</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">OutputIterator</span> __<span class="title">partial_sum</span>(<span class="title">InputIterator</span> <span class="title">first</span>, <span class="title">InputIterator</span> <span class="title">last</span>,</span></span><br><span class="line"><span class="class">                             <span class="title">OutputIterator</span> <span class="title">result</span>, <span class="title">T</span> *,</span></span><br><span class="line"><span class="class">                             <span class="title">BinaryOperation</span> <span class="title">binary_op</span>) &#123;</span></span><br><span class="line">    T value = *result;</span><br><span class="line">    <span class="keyword">while</span> (++first != last) &#123;</span><br><span class="line">        value = binary_op(value, *first);  <span class="comment">// ! ä¸‹ä¸€ä¸ªå…ƒç´ åœ¨è¿ç®—ç¬¦å³</span></span><br><span class="line">        *++result = value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ++result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å­˜åœ¨ä¸¤ä¸ªç‰ˆæœ¬ï¼Œåˆ†åˆ«é’ˆå¯¹é»˜è®¤ç´¯è®¡åŠ æ³•ç‰ˆæœ¬ï¼Œä»¥åŠè‡ªå®šä¹‰ä»¿å‡½æ•°ç‰ˆæœ¬ã€‚</p><p><strong>ä½¿ç”¨ï¼š</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; iv&#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>&#125;;</span><br><span class="line"><span class="function">ostream_iterator&lt;<span class="keyword">int</span>&gt; <span class="title">oite</span><span class="params">(<span class="built_in">cout</span>, <span class="string">" "</span>)</span></span>;</span><br><span class="line">partial_sum(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), oite);</span><br><span class="line">partial_sum(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), oite, minus&lt;<span class="keyword">int</span>&gt;());</span><br><span class="line"><span class="comment">// output1 : 2 5 9 14 20</span></span><br><span class="line"><span class="comment">//      (2, 2 + 3, 2 + 3 + 4, 2 + 3 + 4 + 5, 2 + 3 + 4 + 5 + 6) // ç±»ä¼¼accumulate</span></span><br><span class="line"><span class="comment">// output2 : 2 -1 -5 -10 -16</span></span><br><span class="line"><span class="comment">//      (2, 2 - 3, 2 - 3 - 4, 2 - 3 - 4 - 5, 2 - 3 - 4 - 5 - 6)</span></span><br></pre></td></tr></table></figure><p>å…¶å® <code>partial_sum</code> ä¸ <code>adjacent_difference</code> ä¸ºäº’é€†è¿ç®—ã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; iv&#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>&#125;;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; iv2&#123;<span class="number">2</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">14</span>, <span class="number">20</span>&#125;;</span><br><span class="line"><span class="function">ostream_iterator&lt;<span class="keyword">int</span>&gt; <span class="title">oite</span><span class="params">(<span class="built_in">cout</span>, <span class="string">" "</span>)</span></span>;</span><br><span class="line">partial_sum(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), oite);</span><br><span class="line">adjacent_difference(iv2.<span class="built_in">begin</span>(), iv2.<span class="built_in">end</span>(), oite);</span><br><span class="line"><span class="comment">// output1 : 2 5 9 14 20</span></span><br><span class="line"><span class="comment">// output2 : 2 3 4 5 6</span></span><br></pre></td></tr></table></figure><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P303 - P304</p></blockquote><hr><h3 id="5-4-inner-product"><a class="header-anchor" href="#5-4-inner-product">Â¶</a>5.4 <code>inner_product</code></h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator1</span>, <span class="title">class</span> <span class="title">InputIterator2</span>, <span class="title">class</span> <span class="title">T</span>&gt;  </span></span><br><span class="line"><span class="class"><span class="title">T</span> <span class="title">inner_product</span>(<span class="title">InputIterator1</span> <span class="title">first1</span>, <span class="title">InputIterator2</span> <span class="title">last1</span>, <span class="title">InputIterator2</span> <span class="title">first2</span>, <span class="title">T</span> <span class="title">init</span> = <span class="title">T</span>()) &#123;</span></span><br><span class="line">    <span class="keyword">for</span> (; first1 != last1; ++first1, ++first2) init += (*first1) * (*first2);</span><br><span class="line">    <span class="keyword">return</span> init;</span><br><span class="line">&#125;  <span class="comment">// @ æ³¨æ„å¦‚æœä¼ å…¥çš„é•¿åº¦ä¸ç›¸åŒï¼Œä¹Ÿæ˜¯å¯ä»¥é€šè¿‡ç¼–è¯‘çš„ï¼Œå°±æ˜¯ç»“æœä¸å¯¹</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator1</span>, <span class="title">class</span> <span class="title">IutputIterator2</span>, <span class="title">class</span> <span class="title">T</span>,</span></span><br><span class="line"><span class="class">          <span class="title">class</span> <span class="title">BinaryOperation1</span>, <span class="title">class</span> <span class="title">BinaryOperation2</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">T</span> <span class="title">inner_product</span>(<span class="title">InputIterator1</span> <span class="title">first1</span>, <span class="title">InputIterator1</span> <span class="title">last1</span>,</span></span><br><span class="line"><span class="class">                <span class="title">IutputIterator2</span> <span class="title">first2</span>, <span class="title">T</span> <span class="title">init</span>, <span class="title">BinaryOperation1</span> <span class="title">binary_op1</span>,</span></span><br><span class="line"><span class="class">                <span class="title">BinaryOperation2</span> <span class="title">binary_op2</span>) &#123;</span></span><br><span class="line">    <span class="keyword">for</span> (; first1 != last1; ++first1, ++first2)  <span class="comment">// @ å¯ä»¥ä¼ å…¥ä¸¤ä¸ªäºŒå…ƒä»¿å‡½æ•°</span></span><br><span class="line">        <span class="comment">// @ op1 æ›¿æ¢åŸæ¥çš„ +ï¼Œop2 æ›¿æ¢åŸæ¥çš„ *</span></span><br><span class="line">        init = binary_op1(init, binary_op2(*first1, *first2));  </span><br><span class="line">        <span class="comment">// @ first1 ä½äºæ“ä½œç¬¦å·¦ä¾§</span></span><br><span class="line">    <span class="keyword">return</span> init;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å­˜åœ¨ä¸¤ä¸ªç‰ˆæœ¬ï¼Œåˆ†åˆ«é’ˆå¯¹é»˜è®¤å†…ç§¯ç‰ˆæœ¬ï¼Œä»¥åŠè‡ªå®šä¹‰ä»¿å‡½æ•°ç‰ˆæœ¬ã€‚</p><p><strong>ä½¿ç”¨ï¼š</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; iv&#123;<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>&#125;;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; iv2&#123;<span class="number">2</span>,<span class="number">5</span>,<span class="number">9</span>,<span class="number">14</span>,<span class="number">20</span>&#125;;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; inner_product(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), iv2.<span class="built_in">begin</span>(), <span class="number">0</span>) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; inner_product(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), iv2.<span class="built_in">begin</span>(), <span class="number">0</span>, plus&lt;<span class="keyword">int</span>&gt;(), minus&lt;<span class="keyword">int</span>&gt;()) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"><span class="comment">// output1 : 245  (2*2 + 3*5 + 4*9 + 5*14 + 6*20)</span></span><br><span class="line"><span class="comment">// output2 : -30  ((2-2) + (3-5) + (4-9) + (5-14) + (6-20))</span></span><br></pre></td></tr></table></figure><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P301 - P302</p></blockquote><hr><h3 id="5-5-power"><a class="header-anchor" href="#5-5-power">Â¶</a>5.5 <code>power</code></h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// $ å¯¹xåå¤æ‰§è¡Œnæ¬¡ç®—æ•°æ“ä½œ</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Integer</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">T</span> <span class="title">power</span>(<span class="title">T</span> <span class="title">x</span>, <span class="title">Integer</span> <span class="title">n</span>) &#123;</span></span><br><span class="line">    <span class="keyword">return</span> power(x, n, mutiplies&lt;T&gt;());  <span class="comment">// $ é»˜è®¤çš„æƒ…å†µä¸‹ä½¿ç”¨ä¹˜æ³•</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// $ æ”¯æŒä¼ å…¥äºŒå…ƒè¿ç®—ç¬¦ï¼Œè¯¥è¿ç®—å¿…é¡»æ”¯æŒç»“åˆå¾‹</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Integer</span>, <span class="title">class</span> <span class="title">MonoidOperation</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">T</span> <span class="title">power</span>(<span class="title">T</span> <span class="title">x</span>, <span class="title">Integer</span> <span class="title">n</span>, <span class="title">MonoidOperation</span> <span class="title">op</span>) &#123;</span></span><br><span class="line">    <span class="comment">// $ å¿«é€Ÿå¹‚ç®—æ³•</span></span><br><span class="line">	<span class="comment">// $ è¯¥ç®—æ³•ä¸»è¦é’ˆå¯¹ n &gt;= 0 çš„æƒ…å†µ </span></span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> identity_element(op);  </span><br><span class="line">    <span class="comment">// $ å–å‡ºè¯åŒå…ƒç´ ï¼ˆè¯¥å…ƒç´ ä¸Aä½œè¿ç®—å°†å¾—åˆ°Aè‡ªèº«ï¼Œä¾‹å¦‚åŠ æ³•çš„è¯åŒä¸º0ï¼Œä¹˜æ³•ä¸º1ï¼Œç­‰ç­‰ï¼‰</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> ((n &amp; <span class="number">1</span>) == <span class="number">0</span>) &#123;  <span class="comment">// $ å‰¥ç¦»å¶æ•°å› å­</span></span><br><span class="line">            n &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">            x = op(x, x);</span><br><span class="line">        &#125;</span><br><span class="line">        T result = x;</span><br><span class="line">        n &gt;&gt;= <span class="number">1</span>;  <span class="comment">// $ å³ç§»</span></span><br><span class="line">        <span class="keyword">while</span> (n != <span class="number">0</span>) &#123;   </span><br><span class="line">            x = op(x, x);</span><br><span class="line">            <span class="keyword">if</span> ((n &amp; <span class="number">1</span>) != <span class="number">0</span>)  <span class="comment">// $ ä¾ç„¶å­˜åœ¨å¥‡æ•°ä½</span></span><br><span class="line">                result = op(result, x);</span><br><span class="line">            n &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://czgitaccount.github.io/Data_Structure_and_Algorithm/%E5%89%91%E6%8C%87offer/%E5%88%86%E6%B2%BB%E7%AE%97%E6%B3%95/">å‰‘æŒ‡offer16</a>ä½¿ç”¨äº†åŒæ ·çš„æ€æƒ³ã€‚</p><p><strong>ä½¿ç”¨ï¼š</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cout</span> &lt;&lt; power(<span class="number">10</span>, <span class="number">3</span>) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; power(<span class="number">10</span>, <span class="number">3</span>, plus&lt;<span class="keyword">int</span>&gt;()) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"><span class="comment">// output1 : 1000 (10*10*10)</span></span><br><span class="line"><span class="comment">// output2 : 30   (10+10+10)</span></span><br></pre></td></tr></table></figure><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P304 - P305</p><p><a href="https://czgitaccount.github.io/Data_Structure_and_Algorithm/%E5%89%91%E6%8C%87offer/%E5%88%86%E6%B2%BB%E7%AE%97%E6%B3%95/">å‰‘æŒ‡offer16</a></p></blockquote><hr><h3 id="5-6-itoa"><a class="header-anchor" href="#5-6-itoa">Â¶</a>5.6 <code>itoa</code></h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ~ èµ‹å€¼æ“ä½œ</span></span><br><span class="line"><span class="comment">// ~ vector&lt;int&gt; vec(5);</span></span><br><span class="line"><span class="comment">// ~ iota(vec.begin(), vec.end(), 0);   --&gt; vec : [0,1,2,3,4] </span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">ForwardIterator</span>, <span class="title">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">void</span> <span class="title">iota</span>(<span class="title">ForwardIterator</span> <span class="title">first</span>, <span class="title">ForwardIterator</span> <span class="title">last</span>, <span class="title">T</span> <span class="title">value</span>) &#123;</span></span><br><span class="line">    <span class="keyword">while</span> (first != last) *first++ = value++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä½¿ç”¨ï¼š</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> n = <span class="number">3</span>;</span><br><span class="line">iota(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), n);   <span class="comment">// ! åœ¨æŒ‡å®šåŒºé—´å†…å¡«å…¥ n,n+1,...</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; v : iv) &#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; v &lt;&lt; <span class="string">' '</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P305</p></blockquote><hr><h3 id="5-7-ç»¼åˆä¾‹å­"><a class="header-anchor" href="#5-7-ç»¼åˆä¾‹å­">Â¶</a>5.7 ç»¼åˆä¾‹å­</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iterator&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ext/numeric&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="comment">// è™½ç„¶GCCç¼–è¯‘å™¨å®Œç¾é›†æˆäº†SGI STLï¼Œä½†æ˜¯åœ¨ä½¿ç”¨GCCç¼–è¯‘å™¨ç¼–è¯‘ä½¿ç”¨SGI STLçš„æºç æ—¶ï¼Œéœ€è¦æ³¨æ„ï¼šå¦‚iotaã€powerç­‰å‡½æ•°æ˜¯éC++æ ‡å‡†çš„å‡½æ•°ï¼Œæ˜¯SGIä¸“å±çš„å‡½æ•°ï¼Œå¯¹äºè¿™ç±»å‡½æ•°éœ€è¦ä¿®æ”¹åŒ…å«çš„å¤´æ–‡ä»¶.</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> __gnu_cxx;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; iv&#123;<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>&#125;;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; iv2&#123;<span class="number">2</span>,<span class="number">5</span>,<span class="number">9</span>,<span class="number">14</span>,<span class="number">20</span>&#125;;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"accumulate test : "</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; accumulate(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), <span class="number">0</span>) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">ostream_iterator&lt;<span class="keyword">int</span>&gt; <span class="title">oite</span><span class="params">(<span class="built_in">cout</span>, <span class="string">" "</span>)</span></span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"adjacent_difference test : "</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    adjacent_difference(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), oite); <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    adjacent_difference(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), oite, plus&lt;<span class="keyword">int</span>&gt;());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span> &lt;&lt; <span class="string">"partial_sum test : "</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    partial_sum(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), oite);  <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    partial_sum(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), oite, minus&lt;<span class="keyword">int</span>&gt;()); <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    adjacent_difference(iv2.<span class="built_in">begin</span>(), iv2.<span class="built_in">end</span>(), oite); </span><br><span class="line"></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span> &lt;&lt; <span class="string">"inner_product test : "</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; inner_product(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), iv2.<span class="built_in">begin</span>(), <span class="number">0</span>) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; inner_product(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), iv2.<span class="built_in">begin</span>(), <span class="number">0</span>, plus&lt;<span class="keyword">int</span>&gt;(), minus&lt;<span class="keyword">int</span>&gt;()) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"power test : "</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; power(<span class="number">10</span>, <span class="number">3</span>) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; power(<span class="number">10</span>, <span class="number">3</span>, plus&lt;<span class="keyword">int</span>&gt;()) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"iota test : "</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">int</span> n = <span class="number">3</span>;</span><br><span class="line">    iota(iv.<span class="built_in">begin</span>(), iv.<span class="built_in">end</span>(), n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; v : iv) &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; v &lt;&lt; <span class="string">' '</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</strong></p><img src="/C++_Language/STL/Algorithm/æ•°å€¼ç®—æ³•ä¾‹å­.png" style="zoom:80%"><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P298 - P299</p></blockquote><hr><h1>5 å‚è€ƒèµ„æ–™</h1><blockquote><p>ã€ŠSTLæºç å‰–æã€‹</p><p>MiniSTL / Algorithm éƒ¨åˆ†</p></blockquote><!-- rebuild by neat -->]]></content>
      <categories>
        <category>C++_Language</category>
      </categories>
      <tags>
        <tag>STL</tag>
      </tags>
  </entry>
  <entry>
    <title>STL_Adapter</title>
    <url>/C++_Language/STL/Adapter/</url>
    <content><![CDATA[<!-- build time:Tue Jun 22 2021 17:02:33 GMT+0800 (GMT+08:00) --><a id="more"></a><h1>STL_Adapter</h1><h2 id="1-é…æ¥å™¨ä¹‹æ¦‚è§‚ä¸åˆ†ç±»"><a class="header-anchor" href="#1-é…æ¥å™¨ä¹‹æ¦‚è§‚ä¸åˆ†ç±»">Â¶</a>1. é…æ¥å™¨ä¹‹æ¦‚è§‚ä¸åˆ†ç±»</h2><p>STLæ‰€æä¾›çš„å„ç§é…æ¥å™¨ä¸­ï¼Œæ”¹å˜ä»¿å‡½æ•°ï¼ˆ<em>functors</em>ï¼‰æ¥å£è€…ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º <em>function adapter</em>ï¼Œæ”¹å˜å®¹å™¨ï¼ˆ<em>containers</em>ï¼‰æ¥å£è€…ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º <em>container adapter</em>ï¼Œæ”¹å˜è¿­ä»£å™¨ï¼ˆ<em>iterator</em>ï¼‰æ¥å£è€…ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º <em>iterator adapter</em>ã€‚</p><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P425</p></blockquote><hr><h3 id="1-1-container-adapters"><a class="header-anchor" href="#1-1-container-adapters">Â¶</a>1.1 container adapters</h3><p>STLæä¾›çš„ä¸¤ä¸ªå®¹å™¨ <em>queue</em> å’Œ <em>stack</em>ï¼Œå…¶å®éƒ½ä¸è¿‡æ˜¯ä¸€ç§é…æ¥å™¨ï¼Œä»–ä»¬ä¿®é¥° <em>deque</em> çš„æ¥å£è€Œæˆå°±å‡ºå¦å¤–ä¸€ç§å®¹å™¨é£è²Œã€‚</p><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P425</p></blockquote><h3 id="1-2-iterator-adapters"><a class="header-anchor" href="#1-2-iterator-adapters">Â¶</a>1.2 iterator adapters</h3><p>STL æä¾›äº†è®¸å¤šåº”ç”¨äºè¿­ä»£å™¨èº«ä¸Šçš„é…æ¥å™¨</p><ul><li><em>insert iterators</em><ul><li><em>back_insert_iterator</em></li><li><em>front_insert_iterator</em></li><li><em>insert_iterator</em></li></ul></li><li><em>reverse iterator</em></li><li><em>iostream iterator</em><ul><li><em>istream_iterator</em></li><li><em>ostream_iterator</em></li></ul></li></ul><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P425 - P428</p></blockquote><h3 id="1-3-function-adapters"><a class="header-anchor" href="#1-3-function-adapters">Â¶</a>1.3 function adapters</h3><p><em>functor adapter</em> æ˜¯æ‰€æœ‰é…æ¥å™¨ä¸­æ•°é‡æœ€åºå¤§çš„ä¸€ä¸ªæ—ç¾¤ï¼Œå…¶é…æ¥çµæ´»åº¦ä¹Ÿæ˜¯å‰ä¸¤è€…ä¸èƒ½åŠçš„ï¼Œå¯ä»¥é…æ¥ã€é…æ¥ã€å†é…æ¥ï¼Œè¿™äº›é…æ¥æ“ä½œåŒ…æ‹¬ç»‘å®šï¼ˆ<em>bind</em>ï¼‰ã€å¦å®šï¼ˆ<em>negate</em>ï¼‰ï¼Œç»„åˆï¼ˆ<em>compose</em>ï¼‰ï¼Œä»¥åŠå¯¹ä¸€å‡½æ•°æˆ–æˆå‘˜å‡½æ•°çš„ä¿®é¥°ï¼ˆä½¿å…¶æˆä¸ºä¸€ä¸ªä»¿å‡½æ•°ï¼‰</p><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P428 - P433</p></blockquote><hr><h2 id="2-container-adapters"><a class="header-anchor" href="#2-container-adapters">Â¶</a>2. container adapters</h2><h3 id="2-1-stack"><a class="header-anchor" href="#2-1-stack">Â¶</a>2.1 stack</h3><p><em>stack</em> çš„åº•å±‚ç”± <em>deque</em> æ„æˆï¼Œä»ä»¥ä¸‹æ¥å£å¯ä»¥æ¸…æ¥šçš„çœ‹å‡º <em>stack</em> ä¸ <em>deque</em> çš„å…³ç³»ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Sequence</span> = <span class="title">deque</span>&lt;T&gt;&gt;</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">stack</span> &#123;</span></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    Sequence c;  <span class="comment">// åº•å±‚å®¹å™¨</span></span><br><span class="line">    ....</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P434</p></blockquote><hr><h3 id="2-2-queue"><a class="header-anchor" href="#2-2-queue">Â¶</a>2.2 queue</h3><p><em>queue</em> çš„åº•å±‚ç”± <em>deque</em> æ„æˆï¼Œä»ä»¥ä¸‹æ¥å£å¯ä»¥æ¸…æ¥šçš„çœ‹å‡º <em>stack</em> ä¸ <em>deque</em> çš„å…³ç³»ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Sequence</span> = <span class="title">deque</span>&lt;T&gt;&gt;</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">queue</span> &#123;</span></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    Sequence c;  <span class="comment">// åº•å±‚å®¹å™¨</span></span><br><span class="line">    ....</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P434</p></blockquote><hr><h2 id="3-iterator-adapters"><a class="header-anchor" href="#3-iterator-adapters">Â¶</a>3. iterator adapters</h2><h3 id="3-1-insert-iterators"><a class="header-anchor" href="#3-1-insert-iterators">Â¶</a>3.1 insert iterators</h3><p>ä¸‹é¢ä¸‰ç§ <em>insert iterators</em> å†…éƒ¨éƒ½ç»´æŠ¤äº†ä¸€ä¸ªå®¹å™¨ï¼ˆå¿…é¡»ç”±ç”¨æˆ·æŒ‡å®šï¼‰ï¼›å®¹å™¨å½“ç„¶éœ€è¦æ‹¥æœ‰è‡ªå·±çš„è¿­ä»£å™¨ã€‚äºæ˜¯ï¼Œå½“å®¢æˆ·ç«¯å¯¹ <em>insert iterators</em> åšèµ‹å€¼ï¼ˆ<strong>assign</strong>ï¼‰æ“ä½œæ—¶ï¼Œå°±åœ¨ <em>insert iterators</em> ä¸­è¢«è½¬ä¸ºå¯¹è¯¥å®¹å™¨çš„è¿­ä»£å™¨åšæ’å…¥ï¼ˆ<strong>insert</strong>ï¼‰æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<em>insert iterators</em> çš„ <code>operator=</code> æ“ä½œç¬¦ä¸­è°ƒç”¨åº•å±‚å®¹å™¨çš„ <code>push_back()</code>ï¼Œ<code>push_front()</code>, <code>insert()</code> æ“ä½œå‡½æ•°ã€‚è‡³äºå…¶ä»–è¿­ä»£å™¨é€šå¸¸è¡Œä¸ºå¦‚ <code>operator++</code>ï¼Œ<code>operator++(int)</code>ï¼Œ<code>operator*</code> éƒ½è¢«å…³é—­åŠŸèƒ½ï¼Œæ›´æ²¡æœ‰ <code>operator--</code>, <code>operator--(int)</code>, <code>operator-&gt;</code> ç­‰åŠŸèƒ½ï¼Œæ‰€ä»¥è¢«å®šä¹‰ä¸º <strong><font color="FF8888">output_iterator_tag</font></strong>ã€‚</p><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P435</p></blockquote><hr><h4 id="3-1-1-back-insert-iterator"><a class="header-anchor" href="#3-1-1-back-insert-iterator">Â¶</a>3.1.1 back_insert_iterator</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Container</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">back_insert_iterator</span> &#123;</span></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    Container *container;  <span class="comment">// ~ åº•å±‚å®¹å™¨</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">using</span> iterator_category = output_iterator_tag;  <span class="comment">// æ³¨æ„è¿­ä»£å™¨ç±»å‹</span></span><br><span class="line">    <span class="keyword">using</span> value_tyep        = <span class="keyword">void</span>;</span><br><span class="line">    <span class="keyword">using</span> difference_type   = <span class="keyword">void</span>;</span><br><span class="line">    <span class="keyword">using</span> pointer           = <span class="keyword">void</span>;</span><br><span class="line">    <span class="keyword">using</span> reference         = <span class="keyword">void</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">back_insert_iterator</span><span class="params">(Container &amp;value)</span> : <span class="title">container</span><span class="params">(value)</span> </span>&#123;&#125;</span><br><span class="line">    back_insert_iterator &amp;<span class="keyword">operator</span>=(<span class="keyword">const</span> <span class="keyword">typename</span> Container::value_type &amp;value) &#123;</span><br><span class="line">        container-&gt;push_back(value);  <span class="comment">// ~ æœ¬è´¨ä¸Šæ˜¯è°ƒç”¨äº†push_back</span></span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ~ ä»¥ä¸‹ä¸‰ä¸ªæ¥å£å¯¹ back_insert_iterator æ— ç”¨, å…³é—­åŠŸèƒ½, ç›´æ¥è¿”å›</span></span><br><span class="line">    back_insert_iterator <span class="keyword">operator</span>*() &#123; <span class="keyword">return</span> *<span class="keyword">this</span>; &#125;</span><br><span class="line">    back_insert_iterator <span class="keyword">operator</span>++() &#123; <span class="keyword">return</span> *<span class="keyword">this</span>; &#125;</span><br><span class="line">    back_insert_iterator <span class="keyword">operator</span>++(<span class="keyword">int</span>) &#123; <span class="keyword">return</span> *<span class="keyword">this</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ~ ä»¥ä¸‹æ˜¯ä¸€ä¸ªè¾…åŠ©å‡½æ•°ï¼Œä¾¿äºå¿«é€Ÿä½¿ç”¨ back_insert_iterator</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Container</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">back_insert_iterator</span>&lt;Container&gt; <span class="title">back_inserter</span>(<span class="title">Container</span> &amp;<span class="title">x</span>) &#123;</span></span><br><span class="line">    <span class="keyword">return</span> back_insert_iterator&lt;Container&gt;(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P435 - P436</p></blockquote><hr><h4 id="3-1-2-front-insert-iterator"><a class="header-anchor" href="#3-1-2-front-insert-iterator">Â¶</a>3.1.2 front_insert_iterator</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Container</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">front_insert_iterator</span> &#123;</span></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    Container *container;  <span class="comment">// ! åº•å±‚å®¹å™¨</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">using</span> iterator_category = output_iterator_tag;</span><br><span class="line">    <span class="keyword">using</span> value_tyep        = <span class="keyword">void</span>;</span><br><span class="line">    <span class="keyword">using</span> difference_type   = <span class="keyword">void</span>;</span><br><span class="line">    <span class="keyword">using</span> pointer           = <span class="keyword">void</span>;</span><br><span class="line">    <span class="keyword">using</span> reference         = <span class="keyword">void</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">front_insert_iterator</span><span class="params">(Container &amp;value)</span> : <span class="title">container</span><span class="params">(value)</span> </span>&#123;&#125;</span><br><span class="line">    front_insert_iterator &amp;<span class="keyword">operator</span>=(<span class="keyword">const</span> <span class="keyword">typename</span> Container::value_type &amp;value) &#123;</span><br><span class="line">        container-&gt;push_front(value);  <span class="comment">// ~ æœ¬è´¨ä¸Šæ˜¯è°ƒç”¨äº†push_front</span></span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ! ä»¥ä¸‹ä¸‰ä¸ªæ¥å£å¯¹ front_insert_iteratoræ— ç”¨, å…³é—­åŠŸèƒ½</span></span><br><span class="line">    front_insert_iterator <span class="keyword">operator</span>*() &#123; <span class="keyword">return</span> *<span class="keyword">this</span>; &#125;</span><br><span class="line">    front_insert_iterator <span class="keyword">operator</span>++() &#123; <span class="keyword">return</span> *<span class="keyword">this</span>; &#125;</span><br><span class="line">    front_insert_iterator <span class="keyword">operator</span>++(<span class="keyword">int</span>) &#123; <span class="keyword">return</span> *<span class="keyword">this</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ! ä»¥ä¸‹æ˜¯ä¸€ä¸ªè¾…åŠ©å‡½æ•°ï¼Œä¾¿äºå¿«é€Ÿä½¿ç”¨ front_insert_iterator</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Container</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">front_insert_iterator</span>&lt;Container&gt; <span class="title">front_inserter</span>(<span class="title">Container</span> &amp;<span class="title">x</span>) &#123;</span></span><br><span class="line">    <span class="keyword">return</span> front_insert_iterator&lt;Container&gt;(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåº•å±‚çš„å®¹å™¨è¦æ”¯æŒè¿­ä»£å™¨ï¼Œå¹¶ä¸”æ”¯æŒ <code>push_front()</code> çš„æ“ä½œã€‚</p><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P436</p></blockquote><hr><h4 id="3-1-3-insert-iterator"><a class="header-anchor" href="#3-1-3-insert-iterator">Â¶</a>3.1.3 insert_iterator</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Container</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">insert_iterator</span> &#123;</span></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    Container *container;  <span class="comment">// @ åº•å±‚å®¹å™¨</span></span><br><span class="line">    <span class="keyword">typename</span> Container::iterator iter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">using</span> iterator_category = output_iterator_tag;</span><br><span class="line">    <span class="keyword">using</span> value_tyep        = <span class="keyword">void</span>;</span><br><span class="line">    <span class="keyword">using</span> difference_type   = <span class="keyword">void</span>;</span><br><span class="line">    <span class="keyword">using</span> pointer           = <span class="keyword">void</span>;</span><br><span class="line">    <span class="keyword">using</span> reference         = <span class="keyword">void</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    insert_iterator(Container &amp;value, <span class="keyword">typename</span> Container::iterator i) : container(value), iter(i) &#123;&#125;</span><br><span class="line">    insert_iterator &amp;<span class="keyword">operator</span>=(<span class="keyword">const</span> <span class="keyword">typename</span> Container::value_type &amp;value) &#123;</span><br><span class="line">        container-&gt;insert(iter, value);  <span class="comment">// @ è°ƒç”¨insert</span></span><br><span class="line">        ++iter;  <span class="comment">// @ ä¿è¯insert_iteratoræ°¸è¿œä¸ç›®æ ‡è´´åˆï¼ˆæ„Ÿè§‰å½¢å¼ä½œç”¨å¤§äºå®é™…ä½œç”¨ï¼‰</span></span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// @ ä»¥ä¸‹ä¸‰ä¸ªæ¥å£å¯¹insert_iterator æ— ç”¨ï¼Œå…³é—­åŠŸèƒ½</span></span><br><span class="line">    insert_iterator <span class="keyword">operator</span>*() &#123; <span class="keyword">return</span> *<span class="keyword">this</span>; &#125;</span><br><span class="line">    insert_iterator <span class="keyword">operator</span>++() &#123; <span class="keyword">return</span> *<span class="keyword">this</span>; &#125;</span><br><span class="line">    insert_iterator <span class="keyword">operator</span>++(<span class="keyword">int</span>) &#123; <span class="keyword">return</span> *<span class="keyword">this</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// @ ä»¥ä¸‹æ˜¯ä¸€ä¸ªè¾…åŠ©å‡½æ•°ï¼Œä¾¿äºå¿«é€Ÿä½¿ç”¨ insert_iterator</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Container</span>, <span class="title">class</span> <span class="title">Iterator</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">insert_iterator</span>&lt;Container&gt; <span class="title">inserter</span>(<span class="title">Container</span> &amp;<span class="title">x</span>, <span class="title">Iterator</span> <span class="title">i</span>) &#123;</span></span><br><span class="line">    <span class="keyword">return</span> insert_iterator&lt;Container&gt;(x, i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P437</p></blockquote><hr><h3 id="3-2-reverse-iterator"><a class="header-anchor" href="#3-2-reverse-iterator">Â¶</a>3.2 reverse iterator</h3><p>æ‰€è°“çš„ <em>reverse iterator</em>ï¼Œå°±æ˜¯å°†è¿­ä»£å™¨çš„ç§»åŠ¨è¡Œä¸ºå€’è½¬ã€‚å¦‚æœ STL ç®—æ³•æ¥å—çš„ä¸æ˜¯ä¸€èˆ¬æ­£å¸¸çš„è¿­ä»£å™¨ï¼Œè€Œæ˜¯è¿™ç§é€†å‘çš„è¿­ä»£å™¨ï¼Œå®ƒå°±ä¼šä»¥ä»å°¾åˆ°å¤´çš„æ–¹å‘æ¥å¤„ç†åºåˆ—ä¸­çš„å…ƒç´ ã€‚å¦‚ <code>rbegin()</code> å’Œ <code>rend()</code>ã€‚</p><p>æ³¨æ„ï¼šå•é¡¹åºåˆ—å®¹å™¨å¦‚ <em>slist</em> ä¸å¯ä»¥ä½¿ç”¨ <em>reserve iterator</em>ï¼Œæœ‰äº›å®¹å™¨å¦‚ <em>stack</em>ï¼Œ<em>queue</em>ï¼Œ<em>priority_queue</em> å¹¶ä¸æä¾› <code>begin()</code>ï¼Œ<code>end()</code>ï¼Œå½“ç„¶ä¹Ÿæ²¡æœ‰ <code>rbegin()</code> å’Œ <code>rend()</code>ã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// # reverse_iterator</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Iterator</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">class</span> __<span class="title">reverse_iterator</span> &#123;</span></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    Iterator current;  <span class="comment">// # ä¸ä¹‹å¯¹åº”çš„æ­£å‘è¿­ä»£å™¨</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">using</span> iterator_category = <span class="keyword">iterator_category_t</span>&lt;Iterator&gt;;</span><br><span class="line">    <span class="keyword">using</span> value_type        = <span class="keyword">value_type_t</span>&lt;Iterator&gt;;</span><br><span class="line">    <span class="keyword">using</span> difference_type   = <span class="keyword">difference_type_t</span>&lt;Iterator&gt;;</span><br><span class="line">    <span class="keyword">using</span> pointer           = <span class="keyword">pointer_t</span>&lt;Iterator&gt;;</span><br><span class="line">    <span class="keyword">using</span> reference         = <span class="keyword">reference_t</span>&lt;Iterator&gt;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> iterator_type = Iterator;            <span class="comment">// # æ­£å‘è¿­ä»£å™¨</span></span><br><span class="line">    <span class="keyword">using</span> self          = __reverse_iterator;  <span class="comment">// # åå‘è¿­ä»£å™¨</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    __reverse_iterator() &#123;&#125;</span><br><span class="line">    <span class="keyword">explicit</span> __reverse_iterator(iterator_type value) : current(value) &#123;&#125; <span class="comment">// # æ„é€ å‡½æ•°</span></span><br><span class="line">    __reverse_iterator(<span class="keyword">const</span> self &amp;value) : current(value.current) &#123;&#125; <span class="comment">// # æ‹·è´æ„é€ å‡½æ•°</span></span><br><span class="line"> 	<span class="comment">// # è¿”å›æ­£å‘è¿­ä»£å™¨ï¼Œå³åå‘è¿­ä»£å™¨å¾€ rbegin() è¿›ä¸€æ­¥çš„é‚£ä¸ªä½ç½®, ä¸ä¸‹é¢å¯¹åº” â†“</span></span><br><span class="line">    <span class="function">iterator_type <span class="title">base</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> current; &#125; </span><br><span class="line">    reference <span class="keyword">operator</span>*() <span class="keyword">const</span> &#123;</span><br><span class="line">        Iterator temp = current;</span><br><span class="line">        <span class="keyword">return</span> *--temp;  <span class="comment">// # å¯¹é€†å‘è¿­ä»£å™¨çš„å–å€¼ç­‰ä»·äºå¯¹åº”çš„æ­£å‘è¿­ä»£å™¨åé€€ä¸€ä¸ªå•ä½å–å€¼</span></span><br><span class="line">        <span class="comment">// # * -- ä¼˜å…ˆçº§ç›¸åŒï¼Œä»å³è‡³å·¦ï¼Œ  *--temp = *(--temp)</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    pointer <span class="keyword">operator</span>-&gt;() <span class="keyword">const</span> &#123; <span class="keyword">return</span> &amp;(<span class="keyword">operator</span>*()); &#125;</span><br><span class="line">	<span class="comment">// # ç›¸å…³è¿­ä»£å™¨çš„æ“ä½œéƒ½æ˜¯åå‘æ“ä½œ</span></span><br><span class="line">    self &amp;<span class="keyword">operator</span>++() &#123;    <span class="comment">// # å‰ç½®</span></span><br><span class="line">        --current;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    self <span class="keyword">operator</span>++(<span class="keyword">int</span>) &#123;  <span class="comment">// # åç½®</span></span><br><span class="line">        self temp = *<span class="keyword">this</span>;</span><br><span class="line">        --current;</span><br><span class="line">        <span class="keyword">return</span> temp;</span><br><span class="line">    &#125;</span><br><span class="line">    self &amp;<span class="keyword">operator</span>--() &#123;    <span class="comment">// # å‰ç½®</span></span><br><span class="line">        ++current;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    self <span class="keyword">operator</span>--(<span class="keyword">int</span>) &#123; <span class="comment">// # åç½®</span></span><br><span class="line">        self temp = *<span class="keyword">this</span>;</span><br><span class="line">        ++current;</span><br><span class="line">        <span class="keyword">return</span> temp;</span><br><span class="line">    &#125;</span><br><span class="line">    self <span class="keyword">operator</span>+(difference_type n) <span class="keyword">const</span> &#123; <span class="keyword">return</span> self(current - n); &#125;</span><br><span class="line">    self &amp;<span class="keyword">operator</span>+=(difference_type n) <span class="keyword">const</span> &#123;</span><br><span class="line">        current -= n;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    self <span class="keyword">operator</span>-(difference_type n) <span class="keyword">const</span> &#123; <span class="keyword">return</span> self(current + n); &#125;</span><br><span class="line">    self &amp;<span class="keyword">operator</span>-=(difference_type n) <span class="keyword">const</span> &#123;</span><br><span class="line">        current += n;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// # æ³¨æ„æ­¤æ—¶operator[]å‰è¿› n æ ¼ï¼Œå…¶ä¸­è°ƒç”¨äº†é‡è½½ç‰ˆæœ¬çš„ operator+ï¼Œä¸æ­£å‘è¿­ä»£å™¨ç›¸å</span></span><br><span class="line">    reference <span class="keyword">operator</span>[](difference_type n) <span class="keyword">const</span> &#123; <span class="keyword">return</span> *(*<span class="keyword">this</span> + n); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>==(<span class="keyword">const</span> self &amp;rhs) <span class="keyword">const</span> &#123; <span class="keyword">return</span> current == rhs.current; &#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>!=(<span class="keyword">const</span> self &amp;rhs) <span class="keyword">const</span> &#123; <span class="keyword">return</span> !((*<span class="keyword">this</span>) == rhs); &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ­£å‘è¿­ä»£å™¨ä¸å¯¹åº”çš„é€†å‘è¿­ä»£å™¨å–å‡ºä¸åŒå…ƒç´ ï¼Œè¿™ä¸ªå¹¶ä¸æ˜¯ä¸€ä¸ªæ½œä¼çš„é”™è¯¯ï¼Œè€Œæ˜¯ä¸€ä¸ªåˆ»æ„ä¸ºä¹‹çš„ç‰¹å¾ï¼Œä¸»è¦é…åˆè¿­ä»£å™¨åŒºé—´çš„â€œ<strong><font color="FF8888">å‰é—­åå¼€</font></strong>â€ä¹ æƒ¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><img src="/C++_Language/STL/Adapter/å›¾1é€†å‘è¿­ä»£å™¨.png" style="zoom:67%"><center><strong>å›¾ 1</strong> é€†å‘è¿­ä»£å™¨å‰é—­åå¼€é€»è¾‘</center><p>å°ä¾‹å­ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">deque</span>&lt;<span class="keyword">int</span>&gt; id&#123;<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">3</span>&#125;</span><br><span class="line"><span class="built_in">deque</span>&lt;<span class="keyword">int</span>&gt;::<span class="function">reverse_iterator <span class="title">rite2</span><span class="params">(id.<span class="built_in">end</span>())</span></span>;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; *(rite2);			<span class="comment">// 3</span></span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; *(++++++rite2);		<span class="comment">// 1 (å‰è¿› 3 ä¸ªä½ç½®åå–å€¼)</span></span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; *(--rite2);			<span class="comment">// 2 (åé€€ 1 ä¸ªä½ç½®åå–å€¼)</span></span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; *(rite2.base());	<span class="comment">// 5 (æ¢å¤æ­£å‘è¿­ä»£å™¨åï¼Œå–å€¼)</span></span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; rite2[<span class="number">3</span>];			<span class="comment">// 4 (å‰è¿› 3 ä¸ªä½ç½®åå–å€¼)</span></span><br></pre></td></tr></table></figure><p>æ¯ä¸ªæ­¥éª¤çš„ç§»åŠ¨è§ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="/C++_Language/STL/Adapter/å›¾2é€†å‘ä¾‹å­2.png" style="zoom:67%"><center><strong>å›¾ 2</strong> é€†å‘è¿­ä»£å™¨å°ä¾‹å­</center><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P437 - P442</p><p>ä¸Šè¿°çš„å°ä¾‹å­æ¥è‡ªäº P441 â†‘</p></blockquote><hr><h3 id="3-3-stream-iterator"><a class="header-anchor" href="#3-3-stream-iterator">Â¶</a>3. 3 stream iterator</h3><p>æ‰€è°“ <em>stream iterator</em>ï¼Œå¯ä»¥å°†è¿­ä»£å™¨ç»‘å®šåˆ°ä¸€ä¸ª <em>stream</em> å¯¹è±¡ä¸Šï¼Œç»‘å®šåˆ° <em>istream</em> å¯¹è±¡è€…ï¼Œç§°ä¹‹ä¸º <em>istream_iterator</em>ï¼Œæ‹¥æœ‰è¾“å…¥èƒ½åŠ›ï¼›ç»‘å®šåˆ° <em>ostream</em> å¯¹è±¡è€…ï¼Œç§°ä¹‹ä¸º <em>ostream_iterator</em>ï¼Œæ‹¥æœ‰è¾“å‡ºèƒ½åŠ›ã€‚</p><h4 id="3-3-1-istream-iterator"><a class="header-anchor" href="#3-3-1-istream-iterator">Â¶</a>3.3.1 istream_iterator</h4><p>æ‰€è°“ç»‘å®šä¸€ä¸ª <em>istream object</em>ï¼Œå…¶å®å°±æ˜¯åœ¨ <em>istream iterator</em> å†…éƒ¨ç»´æŠ¤ä¸€ä¸ª <em>istream member</em>ï¼Œå®¢æˆ·ç«¯å¯¹äºè¿™ä¸ªè¿­ä»£å™¨æ‰€ä½œçš„ <code>operator++</code> æ“ä½œï¼Œä¼šè¢«å¯¼å¼•è°ƒç”¨è¿­ä»£å™¨å†…éƒ¨æ‰€å«çš„é‚£ä¸ª <em>istream member</em> çš„è¾“å…¥æ“ä½œï¼ˆ<code>operator&gt;&gt;</code>ï¼‰ï¼Œè¿™ä¸ªè¿­ä»£å™¨çš„ç±»å‹æ˜¯ <strong><font color="FF8888">input_iterator_tag</font></strong>ï¼Œä¸å…·å¤‡ <code>operator--</code>ã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// $ stream: input_stream</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Distance</span> = <span class="title">ptrdiff_t</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">istream_iterator</span> &#123;</span></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="built_in">std</span>::istream *stream;  <span class="comment">// istream å¯¹è±¡</span></span><br><span class="line">    T value;</span><br><span class="line">    <span class="keyword">bool</span> end_marker;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        end_marker = (*stream) ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (end_marker) *stream &gt;&gt; value;       <span class="comment">// $ å…³é”®</span></span><br><span class="line">        end_marker = (*stream) ? <span class="literal">true</span> : <span class="literal">false</span>;  </span><br><span class="line">        <span class="comment">// $ å®Œæˆè¾“å…¥åï¼Œstream çŠ¶æ€å¯èƒ½å‘ç”Ÿäº†æ”¹å˜ï¼Œå†æ¬¡åˆ¤å®š</span></span><br><span class="line">    	<span class="comment">// $ å½“è¯»åˆ° eof æˆ–è¯»åˆ°æ€§åˆ«ä¸ç¬¦çš„èµ„æ–™ï¼Œstream å³å‡ºä¸ false çŠ¶æ€</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">using</span> iterator_category = input_iterator_tag;  <span class="comment">// ç±»å‹</span></span><br><span class="line">    <span class="keyword">using</span> value_tyep        = T;</span><br><span class="line">    <span class="keyword">using</span> difference_type   = Distance;</span><br><span class="line">    <span class="keyword">using</span> pointer           = <span class="keyword">const</span> T *;  <span class="comment">// $ ç”±äºä¸ºinput_iteratorï¼Œé‡‡ç”¨constè¾ƒä¸ºä¿é™©</span></span><br><span class="line">    <span class="keyword">using</span> reference         = <span class="keyword">const</span> T &amp;;</span><br><span class="line"></span><br><span class="line">    istream_iterator() : stream(&amp;<span class="built_in">std</span>::<span class="built_in">cin</span>), end_marker(<span class="literal">false</span>) &#123;&#125;</span><br><span class="line">    istream_iterator(<span class="built_in">std</span>::istream &amp;s) : stream(&amp;s) &#123; <span class="built_in">read</span>(); &#125;</span><br><span class="line"></span><br><span class="line">    reference <span class="keyword">operator</span>*() <span class="keyword">const</span> &#123; <span class="keyword">return</span> value; &#125;</span><br><span class="line">    pointer <span class="keyword">operator</span>-&gt;() <span class="keyword">const</span> &#123; <span class="keyword">return</span> &amp;(<span class="keyword">operator</span>*()); &#125;</span><br><span class="line"></span><br><span class="line">    istream_iterator &amp;<span class="keyword">operator</span>++() &#123; <span class="comment">// $ è¿­ä»£å™¨å‰è¿›ä¸€ä¸ªä½ç½®ï¼Œå°±ä»£è¡¨è¦è¯»å–ä¸€ç¬”èµ„æ–™</span></span><br><span class="line">        <span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    istream_iterator <span class="keyword">operator</span>++(<span class="keyword">int</span>) &#123; <span class="comment">// $ åç½®</span></span><br><span class="line">        istream_iterator temp = *<span class="keyword">this</span>;</span><br><span class="line">        <span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">return</span> temp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>ä½¿ç”¨æ–¹æ³•ï¼š</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">istream_iterator&lt;<span class="keyword">int</span>&gt; eos;  		<span class="comment">// (A) é€ æˆ end_marker ä¸º false;</span></span><br><span class="line"><span class="function">istream_iterator&lt;<span class="keyword">int</span>&gt; <span class="title">initer</span><span class="params">(<span class="built_in">cin</span>)</span></span>;  <span class="comment">// (B) å¼•å‘ read(), ç¨‹åºè‡³æ­¤ä¼šç­‰å¾…è¾“å…¥</span></span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">"please input ..."</span> &lt;&lt; <span class="built_in">endl</span>; <span class="comment">// (C) </span></span><br><span class="line"><span class="comment">// $ æ³¨æ„ C ä¼šç­‰å¾… B ç»“æŸåæ‰è¿è¡Œï¼Œæ‰€ä»¥æ°¸è¿œåœ¨å¿…è¦çš„æ—¶å€™ï¼Œæ‰å®šä¹‰ä¸€ä¸ª istream_iterator</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡ä»¥ä¸Šä»£ç å¯ä»¥çŸ¥é“ï¼Œåªè¦å®¢æˆ·ç«¯å®šä¹‰ä¸€ä¸ª <em>istream iterator</em> å¹¶ç»‘å®šåˆ°æŸä¸ª <em>istream</em> å¯¹è±¡ä¸Šï¼Œç¨‹åºä¾¿ç«‹åˆ»åœåœ¨ <code>istream_iterator&lt;T&gt;::read()</code> å‡½æ•°ï¼Œç­‰å¾…è¾“å…¥ï¼Œè¿™ä¸ªå¹¶ä¸æ˜¯æˆ‘ä»¬æ‰€é¢„æœŸçš„è¡Œä¸ºã€‚å› æ­¤ï¼Œè¯·åœ¨ç»å¯¹å¿…è¦çš„æ—¶åˆ»æ‰å®šä¹‰ä½ æ‰€éœ€è¦çš„ <em>istream iterator</em>ã€‚</p><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P442 - P445</p></blockquote><hr><h4 id="3-3-2-ostream-iterator"><a class="header-anchor" href="#3-3-2-ostream-iterator">Â¶</a>3.3.2 ostream_iterator</h4><p>æ‰€è°“ç»‘å®šä¸€ä¸ª <em>ostream object</em>ï¼Œå…¶å®å°±æ˜¯åœ¨ <em>ostream iterator</em> å†…éƒ¨ç»´æŠ¤ä¸€ä¸ª <em>ostream member</em>ï¼Œå®¢æˆ·ç«¯å¯¹äºè¿™ä¸ªè¿­ä»£å™¨æ‰€ä½œçš„ <code>operator=</code> æ“ä½œï¼Œä¼šè¢«å¯¼å¼•è°ƒç”¨è¿­ä»£å™¨å†…éƒ¨æ‰€å«çš„é‚£ä¸ª <em>ostream member</em> çš„è¾“å…¥æ“ä½œï¼ˆ<code>operator&lt;&lt;</code>ï¼‰ï¼Œè¿™ä¸ªè¿­ä»£å™¨çš„ç±»å‹æ˜¯ <strong><font color="FF8888">output_iterator_tag</font></strong>ã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">ostream_iterator</span> &#123;</span></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="built_in">std</span>::ostream *stream;   <span class="comment">// ~ å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *interval;   <span class="comment">// ~ è¾“å‡ºé—´éš”ç¬¦, æ¯æ¬¡è¾“å‡ºåçš„é—´éš”ç¬¦å·</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">using</span> iterator_category = output_iterator_tag;  <span class="comment">// ~ ç±»å‹</span></span><br><span class="line">    <span class="keyword">using</span> value_tyep        = <span class="keyword">void</span>;</span><br><span class="line">    <span class="keyword">using</span> difference_type   = <span class="keyword">void</span>;</span><br><span class="line">    <span class="keyword">using</span> pointer           = <span class="keyword">void</span>;</span><br><span class="line">    <span class="keyword">using</span> reference         = <span class="keyword">void</span>;</span><br><span class="line">	<span class="comment">// æ„é€ å‡½æ•°</span></span><br><span class="line">    ostream_iterator() : stream(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>), interval(<span class="literal">nullptr</span>) &#123;&#125;</span><br><span class="line">    ostream_iterator(<span class="built_in">std</span>::ostream &amp;s, <span class="keyword">const</span> <span class="keyword">char</span> *c)</span><br><span class="line">        : stream(&amp;s), interval(c) &#123;&#125;</span><br><span class="line">	<span class="comment">// ~ å¯¹è¿­ä»£å™¨åšèµ‹å€¼æ“ä½œï¼Œå°±ä»£è¡¨è¦è¾“å‡ºä¸€ç¬”èµ„æ–™</span></span><br><span class="line">    ostream_iterator &amp;<span class="keyword">operator</span>=(<span class="keyword">const</span> T &amp;value) &#123;</span><br><span class="line">        *stream &lt;&lt; value;					<span class="comment">// ~ å…³é”®ï¼Œè¾“å‡ºæ•°å€¼</span></span><br><span class="line">        <span class="keyword">if</span> (interval) *stream &lt;&lt; interval;  <span class="comment">// ~ æœ€åè¾“å‡ºé—´éš”ç¬¦</span></span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ~ ä¸ä½¿ç”¨ï¼Œç›´æ¥è¿”å›åŸè¿­ä»£å™¨å³å¯</span></span><br><span class="line">    ostream_iterator &amp;<span class="keyword">operator</span>*() &#123; <span class="keyword">return</span> *<span class="keyword">this</span>; &#125;</span><br><span class="line">    ostream_iterator &amp;<span class="keyword">operator</span>++() &#123; <span class="keyword">return</span> *<span class="keyword">this</span>; &#125;</span><br><span class="line">    ostream_iterator <span class="keyword">operator</span>++(<span class="keyword">int</span>) &#123; <span class="keyword">return</span> *<span class="keyword">this</span>; &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>ä½¿ç”¨æ–¹æ³•ï¼š</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">ostream_iterator&lt;<span class="keyword">int</span>&gt; <span class="title">outiter</span><span class="params">(<span class="built_in">cout</span>, <span class="string">' '</span>)</span></span>;  <span class="comment">// ~ è¾“å‡ºè‡³ cout, æ¯æ¬¡é—´éš”ä¸€ä¸ªç©ºæ ¼</span></span><br></pre></td></tr></table></figure><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P445 - P447</p></blockquote><hr><h4 id="3-3-3-stream-iterator-ä¸-copy-åˆä½œ"><a class="header-anchor" href="#3-3-3-stream-iterator-ä¸-copy-åˆä½œ">Â¶</a>3.3.3 stream_iterator ä¸ <code>copy()</code> åˆä½œ</h4><p>ä»¥ä¸‹æ˜¯ <em>stream iterator</em> ä¸ <code>copy()</code> åˆä½œçš„å°ä¾‹å­ï¼Œç”±ä»¥ä¸‹ä¸¤ä¸ªä¾‹å­ç»“åˆ</p><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P444 <em>istream_iterator</em> ä¸ <code>copy()</code> åˆä½œçš„ä¾‹å­</p><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P447 <em>ostream_iterator</em> ä¸ <code>copy()</code> åˆä½œçš„ä¾‹å­</p></blockquote><p><strong>å®ç°çš„åŠŸèƒ½</strong>ï¼šæ‰‹åŠ¨å®æ—¶åœ°å‘ <em><strong>vector</strong></em> ä¸­è¾“å…¥å…ƒç´ ï¼Œå¹¶æœ€åæ¯ä¸ªå…ƒç´ ä»¥ä¸€ä¸ªç©ºæ ¼ä¸ºé—´éš”è¾“å‡ºã€‚</p><p>ä¹¦ä¸­ä¸¤ä¸ªä¾‹å­å¦‚ä¸‹ï¼š</p><img src="/C++_Language/STL/Adapter/å›¾3ä¾‹å­1.png" style="zoom:61%"><center><strong>å›¾ 3</strong> ä¾‹å­ä¸€</center><img src="/C++_Language/STL/Adapter/å›¾å››ä¾‹å­2.png" style="zoom:61%"><center><strong>å›¾ 4</strong> ä¾‹å­äºŒ</center><p><strong>ä¸¤è€…ç›¸ç»“åˆæµ‹è¯•ç”¨ä¾‹å¦‚ä¸‹ï¼š</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iterator&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; vec;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"int(s) please: "</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    istream_iterator&lt;int&gt; iite(cin), eos;</span><br><span class="line">    copy(iite, eos, inserter(vec, vec.<span class="built_in">begin</span>()));</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"vec : "</span>;</span><br><span class="line">    <span class="function">ostream_iterator&lt;<span class="keyword">int</span>&gt; <span class="title">oite</span><span class="params">(<span class="built_in">cout</span>, <span class="string">" "</span>)</span></span>;</span><br><span class="line">    copy(vec.<span class="built_in">begin</span>(), vec.<span class="built_in">end</span>(), oite);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®æ—¶è¾“å…¥ï¼š</p><img src="/C++_Language/STL/Adapter/å›¾5å®æ—¶è¾“å…¥.png" style="zoom:80%"><center><strong>å›¾ 5(1)</strong> å®æ—¶è¾“å…¥</center><p><strong>è¾“å‡ºç»“æœ1ï¼š</strong>ï¼ˆåªè¦è¾“å…¥ä¸æ˜¯ int å°±ä¼šé€€å‡ºï¼‰</p><img src="/C++_Language/STL/Adapter/å›¾6ç»“æœ.png" style="zoom:80%"><center><strong>å›¾ 5(2)</strong> ä»¥ç©ºæ ¼é—´éš”è¾“å…¥ï¼Œchar ç»“å°¾</center><p><strong>è¾“å‡ºç»“æœ2ï¼š</strong></p><img src="/C++_Language/STL/Adapter/å›¾7ç»“æœ2.png" style="zoom:80%"><center><strong>å›¾ 5(3)</strong> ä»¥å›è½¦é—´éš”è¾“å…¥ï¼Œlong ç»“å°¾</center><p>å›è½¦æˆ–è€…ç©ºæ ¼éƒ½å¯ä»¥ä½œä¸ºåˆ¤æ–­æˆªå–æ•°æ®ï¼Œè¾“å‡ºç»“æœ1ä»¥ end é€€å‡ºï¼Œè¾“å‡ºç»“æœ2ä»¥1212123221222ä¸€ä¸ªè¶…é™çš„å¤§æ•°é€€å‡ºã€‚</p><hr><h2 id="4-function-adapter"><a class="header-anchor" href="#4-function-adapter">Â¶</a>4. function adapter</h2><h3 id="4-1-not1-not2"><a class="header-anchor" href="#4-1-not1-not2">Â¶</a>4.1 not1, not2</h3><h4 id="4-1-1-ä¸€å…ƒ"><a class="header-anchor" href="#4-1-1-ä¸€å…ƒ">Â¶</a>4.1.1 ä¸€å…ƒ</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// $ å¯¹ä»¿å‡½æ•°è¿”å›å€¼è¿›è¡Œå¦å®šé…æ¥å™¨</span></span><br><span class="line"><span class="comment">// $ ä¼ å…¥ä»¿å‡½æ•°å¯¹è±¡å³å¯ï¼Œå’Œä»¥å‰ä¸€æ ·ä½¿ç”¨ï¼Œä»…ä»…åŒ…è£…äº†ä¸€ä¸‹å­è€Œå·²ã€‚</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Predicate</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">unary_negate</span>      // $ ä¸€å…ƒ</span></span><br><span class="line"><span class="class">    :</span> <span class="keyword">public</span> unary_function&lt;<span class="keyword">typename</span> Predicate::argument_type, <span class="keyword">bool</span>&gt; &#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    Predicate pred;     <span class="comment">// $ å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">unary_negate</span><span class="params">(<span class="keyword">const</span> Predicate &amp;x)</span> : <span class="title">pred</span><span class="params">(x)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">const</span> <span class="keyword">typename</span> Predicate::argument_type &amp;x)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> !pred(x);  <span class="comment">// $ å…³é”®ï¼šè¿”å›Predicatelä¸´æ—¶å¯¹è±¡</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// $ è¾…åŠ©å‡½æ•°ï¼Œè¯†åˆ«ä¼ å…¥å¯¹è±¡ï¼Œé€šè¿‡å‡½æ•°æ¨¡æ¿çš„å‚æ•°æ¨å¯¼å‹åˆ«ï¼Œ</span></span><br><span class="line"><span class="comment">// $ å¹¶é€šè¿‡å‡½æ•°é…æ¥å™¨çš„æ„é€ å‡½æ•°æ¥æ„é€ å¯¹è±¡å¹¶é€šè¿‡operator()è¿”å›å¯¹è±¡</span></span><br><span class="line"><span class="comment">// $ è¾…åŠ©å‡½æ•°ï¼Œç”¨ not1(pred) æ¥ä»£æ›¿ unary_negate&lt;Predicate&gt;(pre)</span></span><br><span class="line"><span class="comment">// $ ä¼ å…¥å¯¹è±¡ï¼Œå¹¶è¿”å›ä¸´æ—¶å¯¹è±¡</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Predicate</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">unary_negate</span>&lt;Predicate&gt; <span class="title">not1</span>(<span class="title">const</span> <span class="title">Predicate</span> &amp;<span class="title">pred</span>) &#123;</span></span><br><span class="line">    <span class="keyword">return</span> unary_negate&lt;Predicate&gt;(pred);  <span class="comment">// $ è¿”å›ä¸´æ—¶å¯¹è±¡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä½¿ç”¨ï¼š</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//not1 example</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;     // std::cout</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;functional&gt;   // std::not1</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;    // std::count_if</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">IsOdd</span> &#123;</span>   		<span class="comment">// è‡ªå®šä¹‰åˆ¤æ–­å¥‡å¶ç±»</span></span><br><span class="line">  <span class="function"><span class="keyword">bool</span> <span class="title">operator</span><span class="params">()</span> <span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; x)</span> <span class="keyword">const</span> </span>&#123;<span class="keyword">return</span> x % <span class="number">2</span> == <span class="number">1</span>;&#125;</span><br><span class="line">  <span class="keyword">typedef</span> <span class="keyword">int</span> argument_type; <span class="comment">// å®šä¹‰ä¸€ä¸ªå‹åˆ«</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> values[] = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;;</span><br><span class="line">  <span class="comment">// æ‰¾å‡ºä¸æ˜¯å¥‡æ•°çš„ä¸ªæ•°</span></span><br><span class="line">  <span class="keyword">int</span> cx = count_if(values, values + <span class="number">5</span>, not1(IsOdd())); </span><br><span class="line">  <span class="comment">// IsOdd()äº§ç”Ÿä¸´æ—¶å¯¹è±¡ temp1, not1 ä½¿ç”¨ temp1 è°ƒç”¨ä»¿å‡½æ•°ï¼Œå¹¶è¿”å›ä¸´æ—¶å¯¹è±¡ temp2ã€‚</span></span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"There are "</span> &lt;&lt; cx &lt;&lt; <span class="string">" elements with even values.\n"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">// output: There are 2 elements with even values.</span></span><br></pre></td></tr></table></figure><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P451</p><p><a href="https://blog.csdn.net/u010710458/article/details/79734558" target="_blank" rel="noopener">STLä¹‹ä»¿å‡½æ•°å®ç°è¯¦è§£</a> &lt;-- ä¾‹å­æ¥æº</p></blockquote><hr><h4 id="4-1-2-äºŒå…ƒ"><a class="header-anchor" href="#4-1-2-äºŒå…ƒ">Â¶</a>4.1.2 äºŒå…ƒ</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Predicate</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">binary_negate</span>     // $ äºŒå…ƒ</span></span><br><span class="line"><span class="class">    :</span> <span class="keyword">public</span> binary_function&lt;<span class="keyword">typename</span> Predicate::first_argument_type,</span><br><span class="line">                             <span class="keyword">typename</span> Predicate::second_argument_type, <span class="keyword">bool</span>&gt; &#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    Predicate pred;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">binary_negate</span><span class="params">(<span class="keyword">const</span> Predicate &amp;x)</span> : <span class="title">pred</span><span class="params">(x)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">const</span> <span class="keyword">typename</span> Predicate::first_argument_type &amp;x,</span></span></span><br><span class="line"><span class="function"><span class="params">                    <span class="keyword">const</span> <span class="keyword">typename</span> Predicate::second_argument_type &amp;y)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> !pred(x, y); <span class="comment">// $ å…³é”®</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// $ è¾…åŠ©å‡½æ•°</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Predicate</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">binary_negate</span>&lt;_Predicate&gt; <span class="title">not2</span>(<span class="title">const</span> _<span class="title">Predicate</span> &amp;<span class="title">pred</span>) &#123;</span></span><br><span class="line">    <span class="keyword">return</span> binary_negate&lt;_Predicate&gt;(pred);  <span class="comment">// è¿”å›ä¸´æ—¶å¯¹è±¡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä½¿ç”¨ï¼š</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// not2 example</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;     // std::cout</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;functional&gt;   // std::not2, std::equal_to</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;    // std::mismatch</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;utility&gt;      // std::pair</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> foo[] = &#123;<span class="number">10</span>,<span class="number">20</span>,<span class="number">30</span>,<span class="number">40</span>,<span class="number">50</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> bar[] = &#123;<span class="number">0</span>,<span class="number">15</span>,<span class="number">30</span>,<span class="number">45</span>,<span class="number">60</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::pair&lt;<span class="keyword">int</span>*,<span class="keyword">int</span>*&gt; firstmatch, firstmismatch;</span><br><span class="line">    <span class="comment">//è¿”å›ç¬¬ä¸€ä¸ªä¸åŒ¹é…æ•°å€¼</span></span><br><span class="line">    firstmismatch = <span class="built_in">std</span>::mismatch (foo, foo + <span class="number">5</span>, bar, <span class="built_in">std</span>::equal_to&lt;<span class="keyword">int</span>&gt;());</span><br><span class="line">    <span class="comment">//è¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…çš„æ•°å€¼</span></span><br><span class="line">    firstmatch = <span class="built_in">std</span>::mismatch (foo, foo + <span class="number">5</span>, bar, <span class="built_in">std</span>::not2(<span class="built_in">std</span>::equal_to&lt;<span class="keyword">int</span>&gt;()));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"First mismatch in bar is "</span> &lt;&lt; *firstmismatch.second &lt;&lt; <span class="string">'\n'</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"First match in bar is "</span> &lt;&lt; *firstmatch.second &lt;&lt; <span class="string">'\n'</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// output : First mismatch in bar is 0</span></span><br><span class="line"><span class="comment">//        : First match in bar is 30</span></span><br></pre></td></tr></table></figure><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P451</p><p><a href="https://blog.csdn.net/u010710458/article/details/79734558" target="_blank" rel="noopener">STLä¹‹ä»¿å‡½æ•°å®ç°è¯¦è§£</a> &lt;-- ä¾‹å­æ¥æº</p></blockquote><hr><h3 id="4-2-bind1st-bind2nd"><a class="header-anchor" href="#4-2-bind1st-bind2nd">Â¶</a>4.2 bind1st, bind2nd</h3><h4 id="4-2-1-bind1st"><a class="header-anchor" href="#4-2-1-bind1st">Â¶</a>4.2.1 bind1st</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Operation</span>&gt;  </span></span><br><span class="line"><span class="class">// ~ <span class="title">Operation</span> ä¸ºä»¿å‡½æ•°ç±», åŸæ¥äºŒå…ƒçš„æ“ä½œï¼Œé€šè¿‡ç»‘å®šå…¶ä¸­ä¸€ä¸ªå‚æ•°ï¼Œå˜æˆäº†ä¸€å…ƒæ“ä½œ</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">binder1st</span> // ~  â†“ ç»‘å®šäº† <span class="title">first</span>, <span class="title">bunary_function</span> çš„ å‚æ•°å˜æˆäº† <span class="title">second</span> å’Œ <span class="title">result</span> </span></span><br><span class="line"><span class="class">    :</span> <span class="keyword">public</span> unary_function&lt;<span class="keyword">typename</span> Operation::second_argument_type, <span class="keyword">typename</span> Operation::result_type&gt; &#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    Operation op;  <span class="comment">// ~ ä»¿å‡½æ•°å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">typename</span> Operation::first_argument_type value; </span><br><span class="line">    <span class="comment">// ~ ç”¨ first_argument_type å£°æ˜ value</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:   <span class="comment">// ~ æ„é€ å‡½æ•° : ä»¿å‡½æ•°å¯¹è±¡ä¼ å…¥ op, ç»‘å®šå€¼ä¼ å…¥ value</span></span><br><span class="line">    binder1st(<span class="keyword">const</span> Operation &amp;x, <span class="keyword">const</span> <span class="keyword">typename</span> Operation::first_argument_type &amp;y) : op(x), value(y) &#123;&#125; </span><br><span class="line">    <span class="function"><span class="keyword">typename</span> Operation::result_type <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">const</span> <span class="keyword">typename</span> Operation::second_argument_type &amp;x)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> op(value, x);  <span class="comment">//  ~ è°ƒç”¨è¡¨è¾¾å¼ï¼Œå°† value ä½œä¸ºç¬¬ä¸€å‚æ•°</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// ~ è¾…åŠ©å‡½æ•°</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Operation</span>, <span class="title">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">binder1st</span>&lt;Operation&gt; <span class="title">bind1st</span>(<span class="title">const</span> <span class="title">Operation</span> &amp;<span class="title">op</span>, <span class="title">const</span> <span class="title">T</span> &amp;<span class="title">x</span>) &#123;</span></span><br><span class="line">    <span class="keyword">using</span> Arg1_type = <span class="keyword">typename</span> Operation::first_argument_type;</span><br><span class="line">    <span class="keyword">return</span> binder1st&lt;Operation&gt;(op, <span class="keyword">static_cast</span>&lt;Arg1_type&gt;(x));  <span class="comment">// ~ è¿”å›ä¸´æ—¶å¯¹è±¡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P452</p></blockquote><hr><h4 id="4-2-2-bind2nd"><a class="header-anchor" href="#4-2-2-bind2nd">Â¶</a>4.2.2 bind2nd</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Operation</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">binder2nd</span> :</span> <span class="keyword">public</span> unary_function&lt;<span class="keyword">typename</span> Operation::first_argument_type, <span class="keyword">typename</span> Operation::result_type&gt; &#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    Operation op;</span><br><span class="line">    <span class="keyword">typename</span> Operation::second_argument_type value;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    binder2nd(<span class="keyword">const</span> Operation &amp;x, <span class="keyword">const</span> <span class="keyword">typename</span> Operation::second_argument_type &amp;y) : op(x), value(y) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">typename</span> Operation::result_type <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">const</span> <span class="keyword">typename</span> Operation::first_argument_type &amp;x)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> op(x, value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Operation</span>, <span class="title">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">binder2nd</span>&lt;Operation&gt; <span class="title">bind2nd</span>(<span class="title">const</span> <span class="title">Operation</span> &amp;<span class="title">op</span>, <span class="title">const</span> <span class="title">T</span> &amp;<span class="title">x</span>) &#123;</span></span><br><span class="line">    <span class="keyword">using</span> Arg2_type = <span class="keyword">typename</span> Operation::second_argument_type;</span><br><span class="line">    <span class="keyword">return</span> binder2nd&lt;Operation&gt;(op, Arg2_type(x));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P452 - P453</p></blockquote><hr><h4 id="4-2-3-ä½¿ç”¨"><a class="header-anchor" href="#4-2-3-ä½¿ç”¨">Â¶</a>4.2.3 ä½¿ç”¨</h4><p>ä¸‹é¢çš„ä¾‹å­ï¼Œä½¿ç”¨äº† <code>binder1st</code>ï¼Œä¸ <code>binder2nd</code>ï¼Œå¹¶åˆ†åˆ«é€šè¿‡ï¼šâ‘  <code>binder1st</code> ç›´æ¥ç”Ÿæˆå‡½æ•°å¯¹è±¡å’Œâ‘¡ è¾…åŠ©å‡½æ•° <code>bind2nd</code> ç”Ÿæˆå‡½æ•°å¯¹è±¡ï¼Œå®ç°äº†ä¸åŒçš„åŠŸèƒ½ï¼Œå‰è€…æ‰¾å‡ºè´Ÿæ•°çš„ä¸ªæ•°ï¼Œåè€…æ‰¾å‡ºæ­£æ•°çš„ä¸ªæ•°ã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// binder1st example</span></span><br><span class="line"><span class="comment">// binder2nd example</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> numbers[] = &#123;<span class="number">10</span>,<span class="number">-20</span>,<span class="number">-30</span>,<span class="number">40</span>,<span class="number">-50</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> cx_1;</span><br><span class="line">    <span class="keyword">int</span> cx_2;</span><br><span class="line">    <span class="comment">// ~ å°†less&lt;int&gt;é‡æ–°åŒ…è£…äº§ç”Ÿæ–°çš„å¯¹è±¡ binder1st</span></span><br><span class="line">    <span class="function">binder1st&lt;less&lt;<span class="keyword">int</span>&gt;&gt; <span class="title">IsNegative</span> <span class="params">(less&lt;<span class="keyword">int</span>&gt;(), <span class="number">0</span>)</span></span>;</span><br><span class="line">    cx_1 = count_if(numbers, numbers + <span class="number">5</span> , IsNegative); <span class="comment">// ~ ä½¿ç”¨å‡½æ•°å¯¹è±¡</span></span><br><span class="line">    cx_2 = count_if(numbers, numbers + <span class="number">5</span>, bind2nd(less&lt;<span class="keyword">int</span>&gt;(), <span class="number">0</span>)); <span class="comment">// ä½¿ç”¨è¾…åŠ©å‡½æ•°ç”Ÿæˆå‡½æ•°å¯¹è±¡</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"There are "</span> &lt;&lt; cx_1 &lt;&lt; <span class="string">" negative elements.\n"</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"There are "</span> &lt;&lt; cx_2 &lt;&lt; <span class="string">" positive elements.\n"</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ~ output: There are 2 negative elements.</span></span><br><span class="line"><span class="comment">// ~         There are 3 positive elements.</span></span><br></pre></td></tr></table></figure><blockquote><p>ä¾‹å­æ”¹å†™äº --&gt; <a href="https://blog.csdn.net/u010710458/article/details/79734558" target="_blank" rel="noopener">STLä¹‹ä»¿å‡½æ•°å®ç°è¯¦è§£</a></p></blockquote><hr><h3 id="4-3-compose-and-compose2"><a class="header-anchor" href="#4-3-compose-and-compose2">Â¶</a>4.3 compose and compose2</h3><h4 id="4-3-1-compose"><a class="header-anchor" href="#4-3-1-compose">Â¶</a>4.3.1 compose</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ! å°†ä¸¤ä¸ªä»¿å‡½æ•°åˆå¹¶æˆä¸€ä¸ªä»¿å‡½æ•°çš„é€‚é…å™¨</span></span><br><span class="line"><span class="comment">// ! ä¸€å…ƒä»¿å‡½æ•°çš„åˆæˆæ“ä½œ  h(x) = f(g(x))</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Operation1</span>, <span class="title">class</span> <span class="title">Operation2</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">unary_compose</span> :</span> <span class="keyword">public</span> unary_function&lt;<span class="keyword">typename</span> Operation2::argument_type, <span class="keyword">typename</span> Operation1::result_type&gt; &#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    Operation1 op1;</span><br><span class="line">    Operation2 op2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    unary_compose(<span class="keyword">const</span> Operation1 &amp;x, <span class="keyword">const</span> Operation2 &amp;y) : op1(x), op2(y) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">typename</span> Operation1::result_type <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">const</span> <span class="keyword">typename</span> Operation2::argument_type &amp;x)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> op1(op2(x));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// ! è¾…åŠ©å‡½æ•°</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Operation1</span>, <span class="title">class</span> <span class="title">Operation2</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">unary_compose</span>&lt;Operation1, Operation2&gt; <span class="title">compose1</span>(<span class="title">const</span> <span class="title">Operation1</span> &amp;<span class="title">op1</span>, <span class="title">const</span> <span class="title">Operation2</span> &amp;<span class="title">op2</span>) &#123;</span></span><br><span class="line">    <span class="keyword">return</span> unary_compose&lt;Operation1, Operation2&gt;(op1, op2);  <span class="comment">// ! è¿”å›ä¸´æ—¶å¯¹è±¡</span></span><br></pre></td></tr></table></figure><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P453</p></blockquote><hr><h4 id="4-3-2-compose2"><a class="header-anchor" href="#4-3-2-compose2">Â¶</a>4.3.2 compose2</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ! äºŒå…ƒä»¿å‡½æ•°åˆæˆæ“ä½œ   h(x) = f(g1(x), g2(x))</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Operation1</span>, <span class="title">class</span> <span class="title">Operation2</span>, <span class="title">class</span> <span class="title">Operation3</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">binary_compose</span> :</span> <span class="keyword">public</span> unary_function&lt;<span class="keyword">typename</span> Operation2::argument_type, <span class="keyword">typename</span> Operation1::result_type&gt; &#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    Operation1 op1;</span><br><span class="line">    Operation2 op2;</span><br><span class="line">    Operation3 op3;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    binary_compose(<span class="keyword">const</span> Operation1 &amp;x, <span class="keyword">const</span> Operation2 &amp;y, <span class="keyword">const</span> Operation3 &amp;z) : op1(x), op2(y), op3(z) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">typename</span> Operation1::result_type <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">const</span> <span class="keyword">typename</span> Operation2::argument_type &amp;x)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> op1(op2(x), op3(x));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// ! è¾…åŠ©å‡½æ•°</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Operation1</span>, <span class="title">class</span> <span class="title">Operation2</span>, <span class="title">class</span> <span class="title">Operation3</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">binary_compose</span>&lt;Operation1, Operation2, Operation3&gt; <span class="title">compose2</span>(</span></span><br><span class="line"><span class="class">    <span class="title">const</span> <span class="title">Operation1</span> &amp;<span class="title">op1</span>, <span class="title">const</span> <span class="title">Operation2</span> &amp;<span class="title">op2</span>, <span class="title">const</span> <span class="title">Operation3</span> &amp;<span class="title">op3</span>) &#123;</span></span><br><span class="line">    <span class="keyword">return</span> binary_compose&lt;Operation1, Operation2, Operation3&gt;(op1, op2, op3);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P453 - P454</p></blockquote><hr><h3 id="4-4-ç”¨äºå‡½æ•°æŒ‡é’ˆï¼šptr-fun"><a class="header-anchor" href="#4-4-ç”¨äºå‡½æ•°æŒ‡é’ˆï¼šptr-fun">Â¶</a>4.4 ç”¨äºå‡½æ•°æŒ‡é’ˆï¼š<code>ptr_fun</code></h3><h4 id="4-4-1-å°†å‡½æ•°æŒ‡é’ˆåŒ…è£…æˆä»¿å‡½æ•°çš„é…æ¥å™¨"><a class="header-anchor" href="#4-4-1-å°†å‡½æ•°æŒ‡é’ˆåŒ…è£…æˆä»¿å‡½æ•°çš„é…æ¥å™¨">Â¶</a>4.4.1 å°†å‡½æ•°æŒ‡é’ˆåŒ…è£…æˆä»¿å‡½æ•°çš„é…æ¥å™¨</h4><p>å…·ä½“çš„ä»£ç è§ï¼š</p><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P455</p></blockquote><p><strong>ä½¿ç”¨ï¼š</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// # ptr_fun example</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;numeric&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span>* foo[] = &#123;<span class="string">"10"</span>,<span class="string">"20"</span>,<span class="string">"30"</span>,<span class="string">"40"</span>,<span class="string">"50"</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> bar[<span class="number">5</span>];</span><br><span class="line">    <span class="keyword">int</span> sum;</span><br><span class="line">    <span class="comment">// # å°†å‡½æ•°æŒ‡é’ˆè½¬æ¢æˆä»¿å‡½æ•°å¯¹è±¡ï¼Œè¿™é‡Œè¾“å…¥å‡½æ•°æŒ‡é’ˆæ•ˆæœä¸€æ ·</span></span><br><span class="line">    transform (foo, foo + <span class="number">5</span>, bar, ptr_fun(atoi) );</span><br><span class="line">    transform (foo, foo + <span class="number">5</span>, bar, atoi);</span><br><span class="line">    sum = accumulate (bar, bar + <span class="number">5</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"sum = "</span> &lt;&lt; sum &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// # output: sum = 150</span></span><br></pre></td></tr></table></figure><blockquote><p><a href="https://blog.csdn.net/u010710458/article/details/79734558" target="_blank" rel="noopener">STLä¹‹ä»¿å‡½æ•°å®ç°è¯¦è§£</a> &lt;-- ä¾‹å­æ¥æº</p></blockquote><hr><h4 id="4-4-2-å°†æˆå‘˜å‡½æ•°æŒ‡é’ˆåŒ…è£…æˆä»¿å‡½æ•°çš„é…æ¥å™¨"><a class="header-anchor" href="#4-4-2-å°†æˆå‘˜å‡½æ•°æŒ‡é’ˆåŒ…è£…æˆä»¿å‡½æ•°çš„é…æ¥å™¨">Â¶</a>4.4.2 å°†æˆå‘˜å‡½æ•°æŒ‡é’ˆåŒ…è£…æˆä»¿å‡½æ•°çš„é…æ¥å™¨</h4><p>å…·ä½“çš„ä»£ç åŠç›¸å…³å†…å®¹è§ï¼š</p><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P456 - P460</p></blockquote><p><strong>ä½¿ç”¨ï¼š</strong></p><p><code>mem_fun</code> å†™æ³•ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// @ mem_fun example</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// vector é‡Œé¢å­˜çš„æ˜¯æŒ‡å‘stringå¯¹è±¡çš„æŒ‡é’ˆ</span></span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">string</span>*&gt; num;</span><br><span class="line">    num.push_back ( <span class="keyword">new</span> <span class="built_in">string</span> (<span class="string">"one"</span>) );</span><br><span class="line">    num.push_back ( <span class="keyword">new</span> <span class="built_in">string</span> (<span class="string">"two"</span>) );</span><br><span class="line">    num.push_back ( <span class="keyword">new</span> <span class="built_in">string</span> (<span class="string">"three"</span>) );</span><br><span class="line">    num.push_back ( <span class="keyword">new</span> <span class="built_in">string</span> (<span class="string">"four"</span>) );</span><br><span class="line">    num.push_back ( <span class="keyword">new</span> <span class="built_in">string</span> (<span class="string">"five"</span>) );</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">len</span><span class="params">(num.<span class="built_in">size</span>())</span></span>;</span><br><span class="line">    <span class="comment">// ä»å†…éƒ¨å¯ä»¥çœ‹å‡ºï¼šS operator()(T *p) const &#123; return (p-&gt;*f)(); &#125;  </span></span><br><span class="line">    <span class="comment">// men_fun åœ¨æŒ‡é’ˆä¸Šé€šè¿‡æŒ‡å‘æˆå‘˜çš„æŒ‡é’ˆè®¿é—®æˆå‘˜</span></span><br><span class="line">    transform(num.<span class="built_in">begin</span>(), num.<span class="built_in">end</span>(), len.<span class="built_in">begin</span>(), mem_fun(&amp;<span class="built_in">string</span>::<span class="built_in">size</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">5</span>; i++) &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; *numb[i] &lt;&lt; <span class="string">" has "</span> &lt;&lt; len[i] &lt;&lt; <span class="string">" letters.\n"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ææ„ï¼Œä¸è¦å¿˜äº† new çš„è¦è®°å¾—é‡Šæ”¾æ‰</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> it = num.<span class="built_in">begin</span>(); it != num.<span class="built_in">end</span>(); ++it)</span><br><span class="line">    	<span class="keyword">delete</span> *it;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// @ output: one has 3 letters.</span></span><br><span class="line"><span class="comment">// @         two has 3 letters.</span></span><br><span class="line"><span class="comment">// @         three has 5 letters.</span></span><br><span class="line"><span class="comment">// @         four has 4 letters.</span></span><br><span class="line"><span class="comment">// @         five has 4 letters.</span></span><br></pre></td></tr></table></figure><p><code>mem_fun_ref</code> å†™æ³•ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// @ mem_fun example</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// vector é‡Œé¢å­˜çš„æ˜¯stringå¯¹è±¡</span></span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; num&#123;<span class="string">"one"</span>, <span class="string">"two"</span>, <span class="string">"three"</span>, <span class="string">"four"</span>, <span class="string">"five"</span>&#125;;</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">len</span><span class="params">(num.<span class="built_in">size</span>())</span></span>;</span><br><span class="line">    <span class="comment">// ä»å†…éƒ¨å¯ä»¥çœ‹å‡ºï¼šS operator()(T &amp;r) const &#123; return (r.*f)(); &#125;  </span></span><br><span class="line">    <span class="comment">// mem_fun_ref åœ¨å¯¹è±¡ä¸Šé€šè¿‡æŒ‡å‘æˆå‘˜çš„æŒ‡é’ˆè®¿é—®æˆå‘˜çš„æ“ä½œ</span></span><br><span class="line">    transform(num.<span class="built_in">begin</span>(), num.<span class="built_in">end</span>(), len.<span class="built_in">begin</span>(), mem_fun_ref(&amp;<span class="built_in">string</span>::<span class="built_in">size</span>));</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">5</span>; i++) &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; numbers[i] &lt;&lt; <span class="string">" has "</span> &lt;&lt; len[i] &lt;&lt; <span class="string">" letters.\n"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// ææ„äº¤ç»™ vector å¤„ç† </span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// @ output: one has 3 letters.</span></span><br><span class="line"><span class="comment">// @         two has 3 letters.</span></span><br><span class="line"><span class="comment">// @         three has 5 letters.</span></span><br><span class="line"><span class="comment">// @         four has 4 letters.</span></span><br><span class="line"><span class="comment">// @         five has 4 letters.</span></span><br></pre></td></tr></table></figure><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P456 - P460</p><p><a href="https://blog.csdn.net/u010710458/article/details/79734558" target="_blank" rel="noopener">STLä¹‹ä»¿å‡½æ•°å®ç°è¯¦è§£</a> &lt;-- ä¾‹å­æ¥æº</p><p><a href="https://www.cnblogs.com/MrLiuZF/p/14081052.html" target="_blank" rel="noopener">C++ä¹‹ptr_funã€mem_fun å’Œ mem_fun_ref</a></p></blockquote><hr><h1>5 å‚è€ƒèµ„æ–™</h1><blockquote><p>ã€ŠSTLæºç å‰–æã€‹</p><p><a href="https://blog.csdn.net/u010710458/article/details/79734558" target="_blank" rel="noopener">STLä¹‹ä»¿å‡½æ•°å®ç°è¯¦è§£</a></p><p><a href="https://www.cnblogs.com/MrLiuZF/p/14081052.html" target="_blank" rel="noopener">C++ä¹‹ptr_funã€mem_fun å’Œ mem_fun_ref</a></p><p>MiniSTL / Function éƒ¨åˆ†</p><p>MiniSTL / Iterator éƒ¨åˆ†</p><p>MiniSTL / SequenceContainers / queueï¼Œstack éƒ¨åˆ†</p></blockquote><!-- rebuild by neat -->]]></content>
      <categories>
        <category>C++_Language</category>
      </categories>
      <tags>
        <tag>STL</tag>
      </tags>
  </entry>
  <entry>
    <title>STL_Function</title>
    <url>/C++_Language/STL/Function/</url>
    <content><![CDATA[<!-- build time:Tue Jun 22 2021 17:02:33 GMT+0800 (GMT+08:00) --><a id="more"></a><h1>STL_Function</h1><h2 id="1-ä»¿å‡½æ•°çš„æ¦‚å¿µ"><a class="header-anchor" href="#1-ä»¿å‡½æ•°çš„æ¦‚å¿µ">Â¶</a>1 ä»¿å‡½æ•°çš„æ¦‚å¿µ</h2><p>ä»¿å‡½æ•°ï¼ˆfunctorsï¼‰æ˜¯æ—©æœŸçš„å‘½åï¼ŒC++æ ‡å‡†è§„æ ¼å®šæ¡ˆåé‡‡ç”¨çš„åç§°æ˜¯å‡½æ•°å¯¹è±¡ï¼ˆfunction objectsï¼‰ã€‚å°±ç°å®æ„ä¹‰è€Œè¨€ï¼Œâ€œå‡½æ•°å¯¹è±¡â€æ¯”è¾ƒè´´åˆ‡ï¼Œä¸€ç§å…·æœ‰å‡½æ•°ç‰¹è´¨çš„å¯¹è±¡ã€‚ä¸è¿‡ï¼Œå°±å…¶è¡Œä¸ºè€Œè¨€ï¼Œä»¥åŠå°±ä¸­æ–‡ç”¨è¯çš„æ¸…æ™°æ¼‚äº®ä¸ç‹¬ç‰¹æ€§è€Œè¨€ï¼Œâ€œä»¿å‡½æ•°â€ä¾æ¬¡æ¯”è¾ƒçªå‡ºã€‚</p><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P413</p></blockquote><p>ä»¿å‡½æ•°å…¶å®å°±æ˜¯ä¸€ä¸ªâ€œè¡Œä¸ºç±»ä¼¼å‡½æ•°â€çš„å¯¹è±¡ï¼Œä¸ºäº†èƒ½å¤Ÿâ€œè¡Œä¸ºç±»ä¼¼å‡½æ•°â€ï¼Œå…¶ç±»åˆ«å®šä¹‰ä¸­å¿…é¡»è‡ªå®šä¹‰ï¼ˆæˆ–è¯´æ”¹å†™ã€é‡è½½ï¼‰<em>function call</em> è¿ç®—å­ï¼ˆ<code>operator()</code>ï¼‰ï¼Œæ‹¥æœ‰è¿™æ ·çš„è¿ç®—å­åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ä»¿å‡½æ•°çš„å¯¹è±¡åé¢åŠ ä¸Šä¸€å †å°æ‹¬å·ï¼Œä»¥æ­¤è°ƒç”¨ä»¿å‡½æ•°æ‰€å®šä¹‰çš„ <code>operator()</code>ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    greater&lt;<span class="keyword">int</span>&gt; ig; <span class="comment">// igå¯¹è±¡</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; boolalpha &lt;&lt; ig(<span class="number">4</span>, <span class="number">6</span>) &lt;&lt; <span class="built_in">endl</span>;  <span class="comment">// ç›´æ¥ä½¿ç”¨igå¯¹è±¡è°ƒç”¨operator()</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; ig.<span class="keyword">operator</span>()(<span class="number">4</span>, <span class="number">6</span>) &lt;&lt; <span class="built_in">endl</span>;    <span class="comment">// é€šè¿‡igå¯¹è±¡æ˜¾ç¤ºè°ƒç”¨operator()</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; greater&lt;<span class="keyword">int</span>&gt;()(<span class="number">6</span>,<span class="number">4</span>) &lt;&lt; <span class="built_in">endl</span>;	<span class="comment">// é€šè¿‡äº§ç”Ÿä¸´æ—¶å¯¹è±¡è°ƒç”¨operator()</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š <img src="/C++_Language/STL/Function/å›¾1ä»¿å‡½æ•°çš„è°ƒç”¨.png" style="zoom:90%"></p><p><strong><font color="FF8888">æ³¨æ„</font></strong>ï¼š</p><ul><li>ä»£ç ä¸­ <code>boolalpha</code> çš„ä½œç”¨ï¼šè®©è¾“å‡ºæµå°† <em><strong>bool</strong></em> è§£ææˆä¸º <em><strong>true</strong></em> æˆ–è€… <em><strong>false</strong></em>ï¼Œå½“ä½¿ç”¨ <code>boolalpha</code> åï¼Œä»¥åçš„ <em><strong>bool</strong></em> ç±»å‹ç»“æœéƒ½å°†ä»¥ <em><strong>true</strong></em> æˆ– <em><strong>false</strong></em> å½¢å¼è¾“å‡ºï¼Œé™¤éä½¿ç”¨ <code>noboolalpha</code> å–æ¶ˆ <code>boolalpha</code> æµçš„æ ¼å¼æ ‡å¿—ã€‚å¤´æ–‡ä»¶ <code>&lt;iostream&gt;</code></li><li>åœ¨STLä¸­ï¼Œå½“éœ€è¦ä¼ é€’ä»¿å‡½æ•°å¯¹è±¡çš„æ—¶å€™ï¼Œé€šè¿‡é‡‡ç”¨æœ€åä¸€ç§æ–¹æ³•ï¼Œå› ä¸ºä¼ é€’è¿›å»ä»…ä»…ä¸ºäº†ç»™å®¹å™¨å†…éƒ¨æˆå‘˜èµ‹å€¼ï¼Œæ‰€ä»¥æ²¡å¿…è¦ç”Ÿæˆå¯¹è±¡ï¼Œäº§ç”Ÿä¸´æ—¶å¯¹è±¡å³å¯ã€‚</li><li>STL ä»¿å‡½æ•°ä¸ STL ç®—æ³•ä¹‹é—´çš„å…³ç³»å¦‚å›¾æ‰€ç¤ºï¼š</li></ul><img src="/C++_Language/STL/Function/å›¾1ä»¿å‡½æ•°ä¸ç®—æ³•ä¹‹é—´çš„å…³ç³».png" style="zoom:50%"><center><strong>å›¾ 1</strong> STL ä»¿å‡½æ•°ä¸ STL ç®—æ³•ä¹‹é—´çš„å…³ç³»</center><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P414</p><p><a href="https://blog.csdn.net/qq_28584889/article/details/83503777" target="_blank" rel="noopener">C++ä¸­ boolalpha çš„ç”¨æ³•</a></p></blockquote><p>ä»¿å‡½æ•°æ‰®æ¼”ä¸€ç§â€œç­–ç•¥â€è§’è‰²ï¼Œå¯ä»¥è®© STL ç®—æ³•æœ‰æ›´çµæ´»çš„æ¼”å‡ºï¼Œè€Œæ›´åŠ çµæ´»çš„å…³é”®ï¼Œåœ¨äº STL ä»¿å‡½æ•°çš„å¯é…æ¥æ€§ (<strong>adaptability</strong>)ã€‚STL ä»¿å‡½æ•°åº”è¯¥æœ‰èƒ½åŠ›è¢«<a href="https://czgitaccount.github.io/C++_Language/STL/Adapter/">å‡½æ•°é…æ¥å™¨</a>ï¼ˆ<code>function adapter</code>ï¼‰ä¿®é¥°ï¼Œå½¼æ­¤åƒç§¯æœ¨ä¸€æ ·åœ°ä¸²æ¥ï¼Œä¸ºäº†æ‹¥æœ‰é…æ¥èƒ½åŠ›ï¼Œæ¯ä¸ªä»¿å‡½æ•°å¿…é¡»å®šä¹‰è‡ªå·±çš„ç›¸åº”å‹åˆ«ï¼Œå°±åƒè¿­ä»£å™¨å¦‚æœè¦èå…¥æ•´ä¸ª STL å¤§å®¶åº­ï¼Œä¹Ÿå¿…é¡»ä¾ç…§è§„å®šå®šä¹‰è‡ªå·±çš„ 5 ä¸ª<a href="https://czgitaccount.github.io/C++_Language/STL/Iterator/">ç›¸åº”å‹åˆ«</a>ä¸€æ ·ï¼Œè¿™äº›ç›¸åº”å‹åˆ«æ˜¯ä¸ºäº†è®©é…æ¥å™¨èƒ½å¤Ÿå–å‡ºï¼Œè·å¾— ä»¿å‡½æ•°çš„æŸäº›ä¿¡æ¯ã€‚ç›¸åº”å‹åˆ«éƒ½åªæ˜¯ä¸€äº› <em>typedef</em>ï¼Œæ‰€æœ‰å¿…è¦æ“ä½œåœ¨<strong>ç¼–è¯‘æœŸ</strong>å°±å…¨éƒ¨å®Œæˆäº†ï¼Œå¯¹ç¨‹åºçš„<strong>æ‰§è¡Œæ•ˆç‡</strong>æ²¡æœ‰ä»»ä½•å½±å“ï¼Œä¸å¸¦æ¥é¢å¤–è´Ÿæ‹…ã€‚</p><p>ä»¿å‡½æ•°çš„ç›¸åº”å‹åˆ«ä¸»è¦ç”¨æ¥è¡¨ç°å‡½æ•°çš„å‚æ•°å‹åˆ«å’Œè¿”å›å€¼ï¼Œä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œ<code>&lt;stl_function.h&gt;</code> å®šä¹‰äº†ä¸¤ä¸ª classesï¼Œåˆ†åˆ«ä»£è¡¨<strong>ä¸€å…ƒä»¿å‡½æ•°</strong>å’Œ<strong>äºŒå…ƒä»¿å‡½æ•°</strong>ï¼Œå…¶ä¸­<strong>æ²¡æœ‰ä»»ä½•æ•°æ®æˆå‘˜å’Œæˆå‘˜å‡½æ•°ï¼Œå”¯æœ‰ä¸€äº›å‹åˆ«å®šä¹‰ï¼Œä»»ä½•ä»¿å‡½æ•°</strong>ï¼Œåªè¦ä¾ä¸ªäººéœ€æ±‚é€‰æ‹©ç»§æ‰¿å…¶ä¸­ä¸€ä¸ª <em>class</em>ï¼Œä¾¿è‡ªåŠ¨æ‹¥æœ‰äº†é‚£äº›ç›¸åº”å‹åˆ«ï¼Œä¹Ÿå°±è‡ªåŠ¨æ‹¥æœ‰äº†é…æ¥èƒ½åŠ›ã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ~ ä¸€å…ƒè¿ç®—ç¬¦</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Arg</span>, <span class="title">class</span> <span class="title">Result</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">unary_function</span> &#123;</span></span><br><span class="line">    <span class="keyword">using</span> argument_type = Arg;</span><br><span class="line">    <span class="keyword">using</span> result_type = Result;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ! äºŒå…ƒæ“ä½œç»“æ„å®šä¹‰</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Arg1</span>, <span class="title">class</span> <span class="title">Arg2</span>, <span class="title">class</span> <span class="title">Result</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">binary_function</span> &#123;</span></span><br><span class="line">    <span class="keyword">using</span> first_argument_type = Arg1;</span><br><span class="line">    <span class="keyword">using</span> second_argument_type = Arg2;</span><br><span class="line">    <span class="keyword">using</span> result_type = Result;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P415 - P416</p></blockquote><hr><h2 id="2-ä»¿å‡½æ•°çš„åˆ†ç±»"><a class="header-anchor" href="#2-ä»¿å‡½æ•°çš„åˆ†ç±»">Â¶</a>2. ä»¿å‡½æ•°çš„åˆ†ç±»</h2><h3 id="2-1-ç®—æœ¯ç±»ä»¿å‡½æ•°"><a class="header-anchor" href="#2-1-ç®—æœ¯ç±»ä»¿å‡½æ•°">Â¶</a>2.1 ç®—æœ¯ç±»ä»¿å‡½æ•°</h3><p>STL å†…å»ºçš„â€œç®—æœ¯ç±»ä»¿å‡½æ•°â€ï¼Œæ”¯æŒåŠ æ³•ã€å‡æ³•ã€ä¹˜æ³•ã€é™¤æ³•ã€å–ä½™å’Œå¦å®šè¿ç®—ï¼Œé™¤äº†å¦å®šè¿ç®—æ˜¯ä¸€å…ƒè¿ç®—ï¼Œå…¶ä»–éƒ½æ˜¯äºŒå…ƒè¿ç®—ã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">plus</span> :</span> <span class="keyword">public</span> binary_function&lt;T, T, T&gt; &#123;</span><br><span class="line">    <span class="function">T <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">const</span> T &amp;x, <span class="keyword">const</span> T &amp;y)</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> x + y; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">minus</span> :</span> <span class="keyword">public</span> binary_function&lt;T, T, T&gt; &#123;</span><br><span class="line">    <span class="function">T <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">const</span> T &amp;x, <span class="keyword">const</span> T &amp;y)</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> x - y; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">multiplies</span> :</span> <span class="keyword">public</span> binary_function&lt;T, T, T&gt; &#123;</span><br><span class="line">    <span class="function">T <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">const</span> T &amp;x, <span class="keyword">const</span> T &amp;y)</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> x * y; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">divides</span> :</span> <span class="keyword">public</span> binary_function&lt;T, T, T&gt; &#123;</span><br><span class="line">    <span class="function">T <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">const</span> T &amp;x, <span class="keyword">const</span> T &amp;y)</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> x / y; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">modulus</span> :</span> <span class="keyword">public</span> binary_function&lt;T, T, T&gt; &#123;</span><br><span class="line">    <span class="function">T <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">const</span> T &amp;x, <span class="keyword">const</span> T &amp;y)</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> x % y; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;   // æ³¨æ„å¦å®šè¿ç®—ç»§æ‰¿ <span class="title">unary_function</span> (ä¸€å…ƒè¿ç®—)</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">negate</span> :</span> <span class="keyword">public</span> unary_function&lt;T, T&gt; &#123;</span><br><span class="line">    <span class="function">T <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">const</span> T &amp;x)</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> -x; &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æµ‹è¯•ç¨‹åºå¦‚ä¸‹ï¼š</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;     // std::cout</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;functional&gt;   // std::plus</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    plus&lt;<span class="keyword">int</span>&gt; plusObj;</span><br><span class="line">    minus&lt;<span class="keyword">int</span>&gt; minusObj;</span><br><span class="line">    multiplies&lt;<span class="keyword">int</span>&gt; multipliesObj;</span><br><span class="line">    divides&lt;<span class="keyword">int</span>&gt; dividesObj;</span><br><span class="line">    modulus&lt;<span class="keyword">int</span>&gt; nodulusObj;</span><br><span class="line">    negate&lt;<span class="keyword">int</span>&gt; negateObj;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"ä»¥ä¸‹è¿ç”¨ä¸Šè¿°å¯¹è±¡ï¼Œå±¥è¡Œå‡½æ•°åŠŸèƒ½"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; plusObj(<span class="number">10</span>, <span class="number">5</span>) &lt;&lt; <span class="built_in">endl</span>;  		<span class="comment">// 15</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; minusObj(<span class="number">10</span>,<span class="number">5</span>) &lt;&lt; <span class="built_in">endl</span>;			<span class="comment">// 5</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; multipliesObj(<span class="number">10</span>,<span class="number">5</span>) &lt;&lt; <span class="built_in">endl</span>;	<span class="comment">// 50</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; dividesObj(<span class="number">10</span>,<span class="number">5</span>) &lt;&lt; <span class="built_in">endl</span>;		<span class="comment">// 2</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; modulusObj(<span class="number">10</span>,<span class="number">5</span>) &lt;&lt; <span class="built_in">endl</span>;		<span class="comment">// 0</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; negateObj(<span class="number">10</span>) &lt;&lt; <span class="built_in">endl</span>;			<span class="comment">//-10</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"ä»¥ä¸‹ç›´æ¥ä»¥ä»¿å‡½æ•°çš„ä¸´æ—¶å¯¹è±¡å±¥è¡Œå‡½æ•°åŠŸèƒ½"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; plus&lt;<span class="keyword">int</span>&gt;()(<span class="number">10</span>, <span class="number">5</span>) &lt;&lt; <span class="built_in">endl</span>;  		<span class="comment">// 15</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; minus&lt;<span class="keyword">int</span>&gt;()(<span class="number">10</span>,<span class="number">5</span>) &lt;&lt; <span class="built_in">endl</span>;			<span class="comment">// 5</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; multiplies&lt;<span class="keyword">int</span>&gt;()(<span class="number">10</span>,<span class="number">5</span>) &lt;&lt; <span class="built_in">endl</span>;	<span class="comment">// 50</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; divides&lt;<span class="keyword">int</span>&gt;()(<span class="number">10</span>,<span class="number">5</span>) &lt;&lt; <span class="built_in">endl</span>;		<span class="comment">// 2</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; modulus&lt;<span class="keyword">int</span>&gt;()(<span class="number">10</span>,<span class="number">5</span>) &lt;&lt; <span class="built_in">endl</span>;		<span class="comment">// 0</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; negate&lt;<span class="keyword">int</span>&gt;()(<span class="number">10</span>) &lt;&lt; <span class="built_in">endl</span>;			<span class="comment">//-10</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š</strong></p><img src="/C++_Language/STL/Function/å›¾2ç®—æ•°æµ‹è¯•ç»“æœ.png" style="zoom:67%"><center><strong>å›¾ 2</strong> ç®—æœ¯ç±»ä»¿å‡½æ•°æµ‹è¯•ç»“æœ</center><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P418 - P419</p></blockquote><p><strong>è¯åŒå…ƒç´ ï¼ˆidentity elementï¼‰</strong></p><p>æ‰€è°“â€œè¿ç®— op çš„è¯åŒå…ƒç´ â€ï¼Œæ„æ€æ˜¯æ•°å€¼ A è‹¥ä¸è¯¥å…ƒç´ åš op è¿ç®—ï¼Œä¼šå¾—åˆ° A è‡ªå·±ï¼ŒåŠ æ³•çš„è¯åŒå…ƒç´ ä¸º 0ï¼Œå› ä¸ºä»»ä½•å…ƒç´ åŠ ä¸Š 0 ä»ç„¶æ˜¯è‡ªå·±ï¼›ä¹˜æ³•çš„è¯åŒå…ƒç´ æ˜¯ 1ï¼Œå› ä¸ºä»»ä½•å…ƒç´ ä¹˜ä»¥ 1ï¼Œå› ä¸ºä»»ä½•å…ƒç´ ä¹˜ä»¥ 1ä»ç„¶æ˜¯è‡ªå·±ã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¯åŒå…ƒç´ ï¼ˆå¹¶éæ ‡å‡†STLæ‰€è¦æ±‚ï¼‰</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">T</span> <span class="title">identity_element</span>(<span class="title">plus</span>&lt;T&gt;) &#123;</span></span><br><span class="line">    <span class="keyword">return</span> T(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">T</span> <span class="title">identity_element</span>(<span class="title">multiplies</span>&lt;T&gt;) &#123;</span></span><br><span class="line">    <span class="keyword">return</span> T(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P420</p></blockquote><hr><h3 id="2-2-å…³ç³»è¿ç®—ç±»ä»¿å‡½æ•°"><a class="header-anchor" href="#2-2-å…³ç³»è¿ç®—ç±»ä»¿å‡½æ•°">Â¶</a>2.2 å…³ç³»è¿ç®—ç±»ä»¿å‡½æ•°</h3><p>STL å†…å»ºçš„â€œå…³ç³»è¿ç®—ç±»ä»¿å‡½æ•°â€ï¼Œæ”¯æŒç­‰äºã€ä¸ç­‰äºã€å¤§äºã€å¤§äºç­‰äºã€å°äºå’Œå°äºç­‰äºå…­ç§è¿ç®—ï¼Œæ¯ä¸€ä¸ªéƒ½æ˜¯äºŒå…ƒè¿ç®—ã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">equal_to</span> :</span> <span class="keyword">public</span> binary_function&lt;T, T, <span class="keyword">bool</span>&gt; &#123;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">const</span> T &amp;x, <span class="keyword">const</span> T &amp;y)</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> x == y; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">not_equal_to</span> :</span> <span class="keyword">public</span> binary_function&lt;T, T, <span class="keyword">bool</span>&gt; &#123;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">const</span> T &amp;x, <span class="keyword">const</span> T &amp;y)</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> x != y; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">greater</span> :</span> <span class="keyword">public</span> binary_function&lt;T, T, <span class="keyword">bool</span>&gt; &#123;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">const</span> T &amp;x, <span class="keyword">const</span> T &amp;y)</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> x &gt; y; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">less</span> :</span> <span class="keyword">public</span> binary_function&lt;T, T, <span class="keyword">bool</span>&gt; &#123;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">const</span> T &amp;x, <span class="keyword">const</span> T &amp;y)</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> x &lt; y; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">greater_equal</span> :</span> <span class="keyword">public</span> binary_function&lt;T, T, <span class="keyword">bool</span>&gt; &#123;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">const</span> T &amp;x, <span class="keyword">const</span> T &amp;y)</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> x &gt;= y; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">less_equal</span> :</span> <span class="keyword">public</span> binary_function&lt;T, T, <span class="keyword">bool</span>&gt; &#123;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">const</span> T &amp;x, <span class="keyword">const</span> T &amp;y)</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> x &lt;= y; &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æµ‹è¯•ç¨‹åºå¦‚ä¸‹ï¼š</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;     // std::cout</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;    // std::sort</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;       // std::vector</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;functional&gt;   // std::less&lt;T&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">myfunction</span> <span class="params">(<span class="keyword">int</span> i,<span class="keyword">int</span> j)</span> </span>&#123; <span class="keyword">return</span> (i &lt; j); &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> myints[] = &#123;<span class="number">32</span>,<span class="number">71</span>,<span class="number">12</span>,<span class="number">45</span>,<span class="number">26</span>,<span class="number">80</span>,<span class="number">53</span>,<span class="number">33</span>&#125;;</span><br><span class="line">    <span class="function"><span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">myvector</span> <span class="params">(myints, myints+<span class="number">8</span>)</span></span>; </span><br><span class="line"></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"using default comparison (operator &lt;)"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">std</span>::sort (myvector.<span class="built_in">begin</span>(), myvector.<span class="built_in">begin</span>()+<span class="number">4</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; v : myvector) <span class="built_in">cout</span> &lt;&lt; v &lt;&lt; <span class="string">' '</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"-------------------------------"</span>&lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="comment">//  (12 32 45 71) 26 80 53 33</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"using function as comp"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">std</span>::sort (myvector.<span class="built_in">begin</span>()+<span class="number">4</span>, myvector.<span class="built_in">end</span>(), myfunction); </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; v : myvector) <span class="built_in">cout</span> &lt;&lt; v &lt;&lt; <span class="string">' '</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"-------------------------------"</span>&lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="comment">// 12 32 45 71 (26 33 53 80)</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"using object as comp"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">std</span>::sort (myvector.<span class="built_in">begin</span>(), myvector.<span class="built_in">end</span>(), <span class="built_in">std</span>::less&lt;<span class="keyword">int</span>&gt;());   </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; v : myvector) <span class="built_in">cout</span> &lt;&lt; v &lt;&lt; <span class="string">' '</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="comment">// (12 26 32 33 45 53 71 80)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š</strong></p><img src="/C++_Language/STL/Function/å›¾3æµ‹è¯•å…³ç³»è¿ç®—ç±».png" style="zoom:80%"><p>ä¾‹å­ä½¿ç”¨<strong>ä¸‰ç§</strong>æ–¹å¼é…åˆæ’åºç®—æ³•å®ç°æ’åºï¼š</p><ul><li>ä½¿ç”¨é»˜è®¤çš„ <strong>comp</strong> ï¼š <code>operator &lt;</code></li><li>ä½¿ç”¨ç”¨æˆ·è‡ªå®šä¹‰çš„ <strong>comp</strong> ï¼š <code>myfunction</code></li><li>ä½¿ç”¨ä»¿å‡½æ•° ï¼š <code>less&lt;int&gt;()</code></li></ul><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P420 - P422</p><p><a href="https://blog.csdn.net/u010710458/article/details/79734558" target="_blank" rel="noopener">STLä¹‹ä»¿å‡½æ•°å®ç°è¯¦è§£</a>ï¼Œ&lt;-- ä¾‹å­æ¥æº</p></blockquote><hr><h3 id="2-3-é€»è¾‘è¿ç®—ç±»ä»¿å‡½æ•°"><a class="header-anchor" href="#2-3-é€»è¾‘è¿ç®—ç±»ä»¿å‡½æ•°">Â¶</a>2.3 é€»è¾‘è¿ç®—ç±»ä»¿å‡½æ•°</h3><p>STL å†…å»ºçš„â€œ é€»è¾‘è¿ç®—ç±»ä»¿å‡½æ•°â€ï¼Œæ”¯æŒä¸æˆ–éä¸‰ç§è¿ç®—ï¼Œä¸æˆ–ä¸ºäºŒå…ƒè¿ç®—ï¼Œéä¸ºä¸€å…ƒè¿ç®—ã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">logical_and</span> :</span> <span class="keyword">public</span> binary_function&lt;T, T, <span class="keyword">bool</span>&gt; &#123;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">const</span> T &amp;x, <span class="keyword">const</span> T &amp;y)</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> x &amp;&amp; y; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">logical_or</span> :</span> <span class="keyword">public</span> binary_function&lt;T, T, <span class="keyword">bool</span>&gt; &#123;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">const</span> T &amp;x, <span class="keyword">const</span> T &amp;y)</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> x || y; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">logical_not</span> :</span> <span class="keyword">public</span> unary_function&lt;T, <span class="keyword">bool</span>&gt; &#123;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">const</span> T &amp;x)</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> !x; &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æµ‹è¯•ç¨‹åºå¦‚ä¸‹ï¼š</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    logical_and&lt;<span class="keyword">int</span>&gt; andObj;</span><br><span class="line">    logical_or&lt;<span class="keyword">int</span>&gt; orObj;</span><br><span class="line">    logical_not&lt;<span class="keyword">int</span>&gt; notObj;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"ä»¥ä¸‹è¿ç”¨ä¸Šè¿°å¯¹è±¡ï¼Œå±¥è¡Œå‡½æ•°åŠŸèƒ½"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; boolalpha;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; andObj(<span class="literal">true</span>, <span class="literal">true</span>) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; orObj(<span class="literal">true</span>, <span class="literal">false</span>) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; notObj(<span class="literal">true</span>) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"ä»¥ä¸‹ç›´æ¥ä»¥ä»¿å‡½æ•°çš„ä¸´æ—¶å¯¹è±¡å±¥è¡Œå‡½æ•°åŠŸèƒ½"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; logical_and&lt;<span class="keyword">int</span>&gt;()(<span class="literal">true</span>, <span class="literal">true</span>) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; logical_or&lt;<span class="keyword">int</span>&gt;()(<span class="literal">true</span>, <span class="literal">false</span>) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; logical_not&lt;<span class="keyword">int</span>&gt;()(<span class="literal">true</span>) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š</strong></p><img src="/C++_Language/STL/Function/å›¾4æµ‹è¯•é€»è¾‘è¿ç®—ç±».png" style="zoom:80%"><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P422 - P423 &lt;-- ä¾‹å­æ¥æº</p></blockquote><hr><h3 id="2-4-è¯åŒã€é€‰æ‹©ã€æŠ•å°„"><a class="header-anchor" href="#2-4-è¯åŒã€é€‰æ‹©ã€æŠ•å°„">Â¶</a>2.4 è¯åŒã€é€‰æ‹©ã€æŠ•å°„</h3><p>è¿™ä¸€èŠ‚ä»‹ç»çš„ä»¿å‡½æ•°ï¼Œéƒ½åªæ˜¯å°†å…¶å‚æ•°åŸå°ä¸åŠ¨åœ°ä¼ å›ï¼Œå…¶ä¸­æŸäº›ä»¿å‡½æ•°å¯¹ä¼ å›çš„å‚æ•°æœ‰å¯ä»¥çš„é€‰æ‹©ï¼Œæˆ–æ˜¯åˆ»æ„å¿½ç•¥ï¼Œä¹‹æ‰€ä»¥ä¸åœ¨ STL æˆ–å…¶ä»–æ³›å‹ç¨‹åºè®¾è®¡è¿‡ç¨‹ä¸­ç›´æ¥ä½¿ç”¨åŸæœ¬æå…¶ç®€å•çš„ identityã€projectã€select ç­‰æ“ä½œï¼Œè€Œåœ¨è¦åˆ’åˆ†ä¸€å±‚å‡ºæ¥ï¼Œå…¨æ˜¯ä¸ºäº†é—´æ¥æ€§ â€“ <strong>é—´æ¥æ€§æ˜¯æŠ½è±¡åŒ–çš„é‡è¦å·¥å…·</strong>ã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// @ è¯åŒä»¿å‡½æ•°ï¼Œä¸»è¦ç”¨äº RB tree æˆ–è€… hashmap é‡Œé¢ key = value æƒ…å†µ</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">identity</span> :</span> <span class="keyword">public</span> unary_function&lt;T, T&gt; &#123;</span><br><span class="line">    <span class="function"><span class="keyword">const</span> T &amp;<span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">const</span> T &amp;x)</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> x; &#125;</span><br><span class="line">&#125;;  <span class="comment">// @ identity&lt;T&gt;()(x)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// @ é€‰æ‹©ä»¿å‡½æ•°,ä¸»è¦ç”¨ä¸ RB treee å’Œ hashmapï¼Œä» pair ä¸­å–å‡º key</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Pair</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">select1st</span> :</span> <span class="keyword">public</span> unary_function&lt;Pair, <span class="keyword">typename</span> Pair::first_type&gt; &#123;</span><br><span class="line">    <span class="function"><span class="keyword">const</span> <span class="keyword">typename</span> Pair::first_type &amp;<span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">const</span> Pair &amp;x)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x.first;    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;  <span class="comment">// @ identity&lt;pair&gt;()(x)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// @ é€‰æ‹©ä»¿å‡½æ•°,ä¸»è¦ç”¨ä¸ RB treee å’Œ hashmapï¼Œä» pair ä¸­å–å‡º value</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Pair</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">select2nd</span> :</span> <span class="keyword">public</span> unary_function&lt;Pair, <span class="keyword">typename</span> Pair::second_type&gt; &#123;</span><br><span class="line">    <span class="function"><span class="keyword">const</span> <span class="keyword">typename</span> Pair::second_type &amp;<span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">const</span> Pair &amp;x)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x.second;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// @ æŠ•å°„å‡½æ•°ï¼Œè¾“å…¥ x å’Œ y è¿”å› x</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Arg1</span>, <span class="title">class</span> <span class="title">Arg2</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">project1st</span> :</span> <span class="keyword">public</span> binary_function&lt;Arg1, Arg2, Arg1&gt; &#123;</span><br><span class="line">    <span class="function">Arg1 <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">const</span> Arg1 &amp;x, <span class="keyword">const</span> Arg2 &amp;)</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> x; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// @ æŠ•å°„å‡½æ•°ï¼Œè¾“å…¥ x å’Œ y è¿”å› y</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Arg1</span>, <span class="title">class</span> <span class="title">Arg2</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">Project2nd</span> :</span> <span class="keyword">public</span> binary_function&lt;Arg1, Arg2, Arg2&gt; &#123;</span><br><span class="line">    <span class="function">Arg2 <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">const</span> Arg1 &amp;, <span class="keyword">const</span> Arg2 &amp;y)</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> y; &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P423 - P424</p></blockquote><hr><p>å‡½æ•°é…æ¥å™¨å†…å®¹è§ <a href="https://czgitaccount.github.io/C++_Language/STL/Adapter/">STL_Adapter</a></p><hr><h2 id="3-å‚è€ƒèµ„æ–™"><a class="header-anchor" href="#3-å‚è€ƒèµ„æ–™">Â¶</a>3. å‚è€ƒèµ„æ–™</h2><blockquote><p>ã€ŠSTLæºç å‰–æã€‹</p><p><a href="https://blog.csdn.net/qq_28584889/article/details/83503777" target="_blank" rel="noopener">C++ä¸­ boolalpha çš„ç”¨æ³•</a></p><p><a href="https://blog.csdn.net/u010710458/article/details/79734558" target="_blank" rel="noopener">STLä¹‹ä»¿å‡½æ•°å®ç°è¯¦è§£</a></p><p><a href="https://czgitaccount.github.io/C++_Language/STL/Iterator/">STL_Iterator</a></p><p><a href="https://czgitaccount.github.io/C++_Language/STL/Adapter/">STL_Adapter</a></p><p>MiniSTL / Function éƒ¨åˆ†</p></blockquote><!-- rebuild by neat -->]]></content>
      <categories>
        <category>C++_Language</category>
      </categories>
      <tags>
        <tag>STL</tag>
      </tags>
  </entry>
  <entry>
    <title>å‰‘æŒ‡offer -- æ•°æ®ç»“æ„</title>
    <url>/Data_Structure_and_Algorithm/%E5%89%91%E6%8C%87offer/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/</url>
    <content><![CDATA[<!-- build time:Tue Jun 22 2021 17:02:33 GMT+0800 (GMT+08:00) --><a id="more"></a><h2 id="å‰‘æŒ‡offer-â€“-æ•°æ®ç»“æ„"><a class="header-anchor" href="#å‰‘æŒ‡offer-â€“-æ•°æ®ç»“æ„">Â¶</a>å‰‘æŒ‡offer â€“ æ•°æ®ç»“æ„</h2><h3 id="å‰‘æŒ‡-Offer-05-æ›¿æ¢ç©ºæ ¼"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-05-æ›¿æ¢ç©ºæ ¼">Â¶</a><a href="https://leetcode-cn.com/problems/ti-huan-kong-ge-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 05. æ›¿æ¢ç©ºæ ¼</a></h3><p>Difficulty: <strong><font color="008F00">ç®€å•</font></strong></p><p>è¯·å®ç°ä¸€ä¸ªå‡½æ•°ï¼ŒæŠŠå­—ç¬¦ä¸² <code>s</code> ä¸­çš„æ¯ä¸ªç©ºæ ¼æ›¿æ¢æˆ&quot;%20&quot;ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šs &#x3D; &quot;We are happy.&quot;</span><br><span class="line">è¾“å‡ºï¼š&quot;We%20are%20happy.&quot;</span><br></pre></td></tr></table></figure><p><strong>é™åˆ¶ï¼š</strong></p><p><code>0 &lt;= s çš„é•¿åº¦ &lt;= 10000</code></p><p><strong>Solution</strong></p><p><strong><font color="F08F00">æ–¹æ³•ä¸€ï¼šæ­£åºä¿®æ”¹</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">string</span> <span class="title">replaceSpace</span><span class="params">(<span class="built_in">string</span> s)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">string</span> res;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.length(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (s[i] == <span class="string">' '</span>) &#123;</span><br><span class="line">                res += <span class="string">"%20"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> res += s[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œ<em>N</em> ä¸º <em>s</em> çš„é•¿åº¦ã€‚</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œ<em>res</em> æ‰€éœ€è¦çš„é¢å¤–ç©ºé—´ã€‚</p><hr><p><strong><font color="F08F00">æ–¹æ³•äºŒï¼šåå‘ä¿®æ”¹</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">string</span> <span class="title">replaceSpace</span><span class="params">(<span class="built_in">string</span> s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> len = s.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// ç»Ÿè®¡ç©ºæ ¼çš„æ•°é‡</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; a : s) &#123;</span><br><span class="line">            <span class="keyword">if</span> (a == <span class="string">' '</span>) count++;</span><br><span class="line">        &#125;</span><br><span class="line">        s.resize(len + <span class="number">2</span> * count); <span class="comment">// ä¿®æ”¹ s çš„é•¿åº¦</span></span><br><span class="line">        <span class="comment">// åŒæŒ‡é’ˆå€’åº</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = len - <span class="number">1</span>, j = s.<span class="built_in">size</span>() - <span class="number">1</span>; i &lt; j; i--, j--) &#123;</span><br><span class="line">            <span class="keyword">if</span> (s[i] != <span class="string">' '</span>) &#123;</span><br><span class="line">                s[j] = s[i];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                s[j] = <span class="string">'0'</span>;</span><br><span class="line">                s[j - <span class="number">1</span>] = <span class="string">'2'</span>;</span><br><span class="line">                s[j - <span class="number">2</span>] = <span class="string">'%'</span>;</span><br><span class="line">                j -= <span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> s;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œ<em>N</em> ä¸º <em>s</em> çš„é•¿åº¦ã€‚</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(1)$ï¼Œç”±äºåŸåœ°æ‰©å±• <em>s</em> çš„é•¿åº¦ï¼Œå› æ­¤ä½¿ç”¨å¸¸æ•°çš„é¢å¤–ç©ºé—´ã€‚</p><hr><h3 id="å‰‘æŒ‡-Offer-06-ä»å°¾åˆ°å¤´æ‰“å°é“¾è¡¨"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-06-ä»å°¾åˆ°å¤´æ‰“å°é“¾è¡¨">Â¶</a><a href="https://leetcode-cn.com/problems/cong-wei-dao-tou-da-yin-lian-biao-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 06. ä»å°¾åˆ°å¤´æ‰“å°é“¾è¡¨</a></h3><p>Difficulty: <strong><font color="008F00">ç®€å•</font></strong></p><p>è¾“å…¥ä¸€ä¸ªé“¾è¡¨çš„å¤´èŠ‚ç‚¹ï¼Œä»å°¾åˆ°å¤´åè¿‡æ¥è¿”å›æ¯ä¸ªèŠ‚ç‚¹çš„å€¼ï¼ˆç”¨æ•°ç»„è¿”å›ï¼‰ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šhead &#x3D; [1,3,2]</span><br><span class="line">è¾“å‡ºï¼š[2,3,1]</span><br></pre></td></tr></table></figure><p><strong>é™åˆ¶ï¼š</strong></p><p><code>0 &lt;= é“¾è¡¨é•¿åº¦ &lt;= 10000</code></p><p><strong>Solution</strong></p><p><strong><font color="F08F00">æ–¹æ³•ä¸€ï¼šæ­£åºè¾“å…¥ï¼Œåè½¬æ•°ç»„</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">reversePrint</span><span class="params">(ListNode* head)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; res;</span><br><span class="line">        <span class="keyword">while</span> (head) &#123;</span><br><span class="line">            res.push_back(head-&gt;val);</span><br><span class="line">            head = head-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        reverse(res.<span class="built_in">begin</span>(), res.<span class="built_in">end</span>());</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œ<em>N</em> ä¸ºé“¾è¡¨é•¿åº¦ï¼Œä¸€æ¬¡éå†é“¾è¡¨ã€‚</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œ<em>res</em> æ‰€éœ€è¦çš„é¢å¤–ç©ºé—´ã€‚</p><hr><p><strong><font color="F08F00">æ–¹æ³•äºŒï¼šè¾…åŠ©æ ˆ</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">reversePrint</span><span class="params">(ListNode* head)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt; stk;</span><br><span class="line">        <span class="keyword">while</span>(head != <span class="literal">nullptr</span>) &#123;</span><br><span class="line">            stk.push(head-&gt;val);</span><br><span class="line">            head = head-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; res;</span><br><span class="line">        <span class="keyword">while</span>(!stk.empty()) &#123;</span><br><span class="line">            res.push_back(stk.top());</span><br><span class="line">            stk.pop();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œ<em>N</em> ä¸ºé“¾è¡¨é•¿åº¦ï¼Œä¸€æ¬¡éå†é“¾è¡¨ã€‚</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œ<em>stk</em> æ‰€éœ€è¦çš„é¢å¤–ç©ºé—´ã€‚</p><hr><p><strong><font color="F08F00">æ–¹æ³•ä¸‰ï¼šé€’å½’</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">reversePrint</span><span class="params">(ListNode* head)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!head)</span><br><span class="line">            <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">        <span class="comment">// é€’å½’åœ¨ push ä¹‹å‰</span></span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; a = reversePrint(head-&gt;next);</span><br><span class="line">        a.push_back(head-&gt;val); </span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œ<em>N</em> ä¸ºé“¾è¡¨é•¿åº¦ï¼Œä¸€æ¬¡éå†é“¾è¡¨ã€‚</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œç³»ç»Ÿé€’å½’æ‰€éœ€è¦ä½¿ç”¨çš„æ ˆç©ºé—´ã€‚</p><hr><h3 id="å‰‘æŒ‡-Offer-09-ç”¨ä¸¤ä¸ªæ ˆå®ç°é˜Ÿåˆ—"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-09-ç”¨ä¸¤ä¸ªæ ˆå®ç°é˜Ÿåˆ—">Â¶</a><a href="https://leetcode-cn.com/problems/yong-liang-ge-zhan-shi-xian-dui-lie-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 09. ç”¨ä¸¤ä¸ªæ ˆå®ç°é˜Ÿåˆ—</a></h3><p>Difficulty: <strong><font color="008F00">ç®€å•</font></strong></p><p>ç”¨ä¸¤ä¸ªæ ˆå®ç°ä¸€ä¸ªé˜Ÿåˆ—ã€‚é˜Ÿåˆ—çš„å£°æ˜å¦‚ä¸‹ï¼Œè¯·å®ç°å®ƒçš„ä¸¤ä¸ªå‡½æ•° <code>appendTail</code> å’Œ <code>deleteHead</code> ï¼Œåˆ†åˆ«å®Œæˆåœ¨é˜Ÿåˆ—å°¾éƒ¨æ’å…¥æ•´æ•°å’Œåœ¨é˜Ÿåˆ—å¤´éƒ¨åˆ é™¤æ•´æ•°çš„åŠŸèƒ½ã€‚(è‹¥é˜Ÿåˆ—ä¸­æ²¡æœ‰å…ƒç´ ï¼Œ<code>deleteHead</code> æ“ä½œè¿”å› -1 )</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š</span><br><span class="line">[&quot;CQueue&quot;,&quot;appendTail&quot;,&quot;deleteHead&quot;,&quot;deleteHead&quot;]</span><br><span class="line">[[],[3],[],[]]</span><br><span class="line">è¾“å‡ºï¼š[null,null,3,-1]</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š</span><br><span class="line">[&quot;CQueue&quot;,&quot;deleteHead&quot;,&quot;appendTail&quot;,&quot;appendTail&quot;,&quot;deleteHead&quot;,&quot;deleteHead&quot;]</span><br><span class="line">[[],[],[5],[2],[],[]]</span><br><span class="line">è¾“å‡ºï¼š[null,-1,null,null,5,2]</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li><code>1 &lt;= values &lt;= 10000</code></li><li><code>æœ€å¤šä¼šå¯¹ appendTailã€deleteHead è¿›è¡Œ 10000 æ¬¡è°ƒç”¨</code></li></ul><p><strong>Solution</strong></p><p><strong><font color="F08F00">æ–¹æ³•ä¸€ï¼šæ¯æ¬¡deleteï¼Œéƒ½è¿›è¡Œå€’å‡ºå€’å…¥æ“ä½œ</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CQueue</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt; stack1;</span><br><span class="line">    <span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt; stack2;</span><br><span class="line">    CQueue() &#123;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">appendTail</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1 å‹æ ˆ</span></span><br><span class="line">        stack1.push(value);</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">deleteHead</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//  1 ç©º åˆ™è¿”å› - 1</span></span><br><span class="line">        <span class="keyword">if</span> (stack1.empty()) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="comment">// å°† 1 ä¸­å…ƒç´ å€’å…¥ 2</span></span><br><span class="line">        <span class="keyword">while</span> (!stack1.empty()) &#123;</span><br><span class="line">            <span class="keyword">int</span> temp = stack1.top();</span><br><span class="line">            stack1.pop();</span><br><span class="line">            stack2.push(temp);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è®°å½• 2 ä¸­æ ˆé¡¶å…ƒç´ ä¸ºç»“æœ</span></span><br><span class="line">        <span class="keyword">int</span> res = stack2.top();</span><br><span class="line">        stack2.pop();</span><br><span class="line">        <span class="comment">// å€’å›å»</span></span><br><span class="line">        <span class="keyword">while</span> (!stack2.empty()) &#123;</span><br><span class="line">            <span class="keyword">int</span> temp = stack2.top();</span><br><span class="line">            stack2.pop();</span><br><span class="line">            stack1.push(temp);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>**æ—¶é—´å¤æ‚åº¦ï¼š**æ’å…¥æ“ä½œ $O(1)$ï¼Œåˆ é™¤æ“ä½œ $O(N)$</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(N)$</p><hr><p><strong><font color="F08F00">æ–¹æ³•äºŒï¼šä»…è¾“å‡ºæ ˆç©ºè°ƒç”¨å€’å…¥æ“ä½œï¼Œæ— å€’å›æ“ä½œ</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CQueue</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt; stack1; <span class="comment">// è¾“å…¥æ ˆ</span></span><br><span class="line">    <span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt; stack2; <span class="comment">// è¾“å‡ºæ ˆ</span></span><br><span class="line">    CQueue() &#123;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">appendTail</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å‹æ ˆ</span></span><br><span class="line">        stack1.push(value);</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">deleteHead</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å¦‚æœè¾“å‡ºæ ˆä¸ºç©ºï¼Œåˆ™éœ€è¦å€’å…¥è¾“å…¥æ ˆçš„æ•°æ®</span></span><br><span class="line">        <span class="keyword">if</span> (stack2.empty()) &#123;</span><br><span class="line">            <span class="keyword">while</span> (!stack1.empty()) &#123;</span><br><span class="line">                stack2.push(stack1.top());</span><br><span class="line">                stack1.pop();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¦‚æœæ­¤æ—¶ä»ç„¶ä¸ºç©ºï¼Œåˆ™è¯´æ˜æ²¡æœ‰å…ƒç´ ï¼Œè¿”å›-1</span></span><br><span class="line">        <span class="keyword">if</span> (stack2.empty()) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="comment">// å¦åˆ™ï¼Œå¼¹å‡ºè¾“å‡ºæ ˆæ ˆé¡¶å…ƒç´ å³å¯</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> deleteItem = stack2.top();</span><br><span class="line">            stack2.pop();</span><br><span class="line">            <span class="keyword">return</span> deleteItem;</span><br><span class="line">        &#125;    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>**æ—¶é—´å¤æ‚åº¦ï¼š**æ’å…¥æ“ä½œ $O(1)$ï¼Œåˆ é™¤æ“ä½œ $O(N)$</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(N)$</p><hr><h3 id="å‰‘æŒ‡-Offer-20-è¡¨ç¤ºæ•°å€¼çš„å­—ç¬¦ä¸²"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-20-è¡¨ç¤ºæ•°å€¼çš„å­—ç¬¦ä¸²">Â¶</a><a href="https://leetcode-cn.com/problems/biao-shi-shu-zhi-de-zi-fu-chuan-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 20. è¡¨ç¤ºæ•°å€¼çš„å­—ç¬¦ä¸²</a></h3><p>Difficulty: <strong><font color="F08F00">ä¸­ç­‰</font></strong></p><p>è¯·å®ç°ä¸€ä¸ªå‡½æ•°ç”¨æ¥åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦è¡¨ç¤º<strong>æ•°å€¼</strong>ï¼ˆåŒ…æ‹¬æ•´æ•°å’Œå°æ•°ï¼‰ã€‚</p><p><strong>æ•°å€¼</strong>ï¼ˆæŒ‰é¡ºåºï¼‰å¯ä»¥åˆ†æˆä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š</p><ol><li>è‹¥å¹²ç©ºæ ¼</li><li>ä¸€ä¸ª <strong>å°æ•°</strong> æˆ–è€… <strong>æ•´æ•°</strong></li><li>ï¼ˆå¯é€‰ï¼‰ä¸€ä¸ª <code>'e'</code> æˆ– <code>'E'</code> ï¼Œåé¢è·Ÿç€ä¸€ä¸ª <strong>æ•´æ•°</strong></li><li>è‹¥å¹²ç©ºæ ¼</li></ol><p><strong>å°æ•°</strong>ï¼ˆæŒ‰é¡ºåºï¼‰å¯ä»¥åˆ†æˆä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š</p><ol><li>ï¼ˆå¯é€‰ï¼‰ä¸€ä¸ªç¬¦å·å­—ç¬¦ï¼ˆ<code>'+'</code> æˆ– <code>'-'</code>ï¼‰</li><li>ä¸‹è¿°æ ¼å¼ä¹‹ä¸€ï¼š<ol><li>è‡³å°‘ä¸€ä½æ•°å­—ï¼Œåé¢è·Ÿç€ä¸€ä¸ªç‚¹ <code>'.'</code></li><li>è‡³å°‘ä¸€ä½æ•°å­—ï¼Œåé¢è·Ÿç€ä¸€ä¸ªç‚¹ <code>'.'</code> ï¼Œåé¢å†è·Ÿç€è‡³å°‘ä¸€ä½æ•°å­—</li><li>ä¸€ä¸ªç‚¹ <code>'.'</code> ï¼Œåé¢è·Ÿç€è‡³å°‘ä¸€ä½æ•°å­—</li></ol></li></ol><p><strong>æ•´æ•°</strong>ï¼ˆæŒ‰é¡ºåºï¼‰å¯ä»¥åˆ†æˆä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š</p><ol><li>ï¼ˆå¯é€‰ï¼‰ä¸€ä¸ªç¬¦å·å­—ç¬¦ï¼ˆ<code>'+'</code> æˆ– <code>'-'</code>ï¼‰</li><li>è‡³å°‘ä¸€ä½æ•°å­—</li></ol><p>éƒ¨åˆ†<strong>æ•°å€¼</strong>åˆ—ä¸¾å¦‚ä¸‹ï¼š</p><ul><li><code>[&quot;+100&quot;, &quot;5e2&quot;, &quot;-123&quot;, &quot;3.1416&quot;, &quot;-1E-16&quot;, &quot;0123&quot;]</code></li></ul><p>éƒ¨åˆ†<strong>éæ•°å€¼</strong>åˆ—ä¸¾å¦‚ä¸‹ï¼š</p><ul><li><code>[&quot;12e&quot;, &quot;1a3.14&quot;, &quot;1.2.3&quot;, &quot;+-5&quot;, &quot;12e+5.4&quot;]</code></li></ul><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šs &#x3D; &quot;0&quot;</span><br><span class="line">è¾“å‡ºï¼štrue</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šs &#x3D; &quot;e&quot;</span><br><span class="line">è¾“å‡ºï¼šfalse</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šs &#x3D; &quot;.&quot;</span><br><span class="line">è¾“å‡ºï¼šfalse</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 4ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šs &#x3D; &quot;    .1  &quot;</span><br><span class="line">è¾“å‡ºï¼štrue</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li><code>1 &lt;= s.length &lt;= 20</code></li><li><code>s</code> ä»…å«è‹±æ–‡å­—æ¯ï¼ˆå¤§å†™å’Œå°å†™ï¼‰ï¼Œæ•°å­—ï¼ˆ<code>0-9</code>ï¼‰ï¼ŒåŠ å· <code>'+'</code> ï¼Œå‡å· <code>'-'</code> ï¼Œç©ºæ ¼ <code>' '</code> æˆ–è€…ç‚¹ <code>'.'</code> ã€‚</li></ul><p><strong>Solution</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">isNumber</span><span class="params">(<span class="built_in">string</span> s)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">unordered_map</span>&lt;<span class="keyword">int</span>, <span class="built_in">unordered_map</span>&lt;<span class="keyword">char</span>, <span class="keyword">int</span>&gt;&gt; mp &#123;</span><br><span class="line">            &#123; <span class="number">0</span>, &#123; &#123;<span class="string">' '</span>, <span class="number">0</span>&#125;, &#123;<span class="string">'s'</span>, <span class="number">1</span>&#125;, &#123;<span class="string">'d'</span>, <span class="number">2</span>&#125;, &#123;<span class="string">'.'</span>, <span class="number">4</span>&#125; &#125; &#125;,</span><br><span class="line">            &#123; <span class="number">1</span>, &#123; &#123;<span class="string">'d'</span>, <span class="number">2</span>&#125;, &#123;<span class="string">'.'</span>, <span class="number">4</span>&#125; &#125; &#125;,</span><br><span class="line">            &#123; <span class="number">2</span>, &#123; &#123;<span class="string">'d'</span>, <span class="number">2</span>&#125;, &#123;<span class="string">'.'</span>, <span class="number">3</span>&#125;, &#123;<span class="string">'e'</span>, <span class="number">5</span>&#125;, &#123;<span class="string">' '</span>, <span class="number">8</span>&#125; &#125; &#125;,</span><br><span class="line">            &#123; <span class="number">3</span>, &#123; &#123;<span class="string">'d'</span>, <span class="number">3</span>&#125;, &#123;<span class="string">'e'</span>, <span class="number">5</span>&#125;, &#123;<span class="string">' '</span>, <span class="number">8</span>&#125; &#125; &#125;,</span><br><span class="line">            &#123; <span class="number">4</span>, &#123; &#123;<span class="string">'d'</span>, <span class="number">3</span>&#125; &#125; &#125;,</span><br><span class="line">            &#123; <span class="number">5</span>, &#123; &#123;<span class="string">'s'</span>, <span class="number">6</span>&#125;, &#123;<span class="string">'d'</span>, <span class="number">7</span>&#125; &#125; &#125;,</span><br><span class="line">            &#123; <span class="number">6</span>, &#123; &#123;<span class="string">'d'</span>, <span class="number">7</span>&#125; &#125; &#125;,</span><br><span class="line">            &#123; <span class="number">7</span>, &#123; &#123;<span class="string">'d'</span>, <span class="number">7</span>&#125;, &#123;<span class="string">' '</span>, <span class="number">8</span>&#125; &#125; &#125;,</span><br><span class="line">            &#123; <span class="number">8</span>, &#123; &#123;<span class="string">' '</span>, <span class="number">8</span>&#125; &#125; &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">int</span> state = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">char</span> t;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> c : s) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">isdigit</span>(c)) t = <span class="string">'d'</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (c == <span class="string">'+'</span> || c == <span class="string">'-'</span>) t = <span class="string">'s'</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (c == <span class="string">'.'</span> || c == <span class="string">' '</span>) t = c;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (c == <span class="string">'e'</span> || c == <span class="string">'E'</span>) t = <span class="string">'e'</span>;</span><br><span class="line">            <span class="keyword">else</span> t = <span class="string">'?'</span>; <span class="comment">// å½“å‰è¾“å…¥æœ‰é—®é¢˜ï¼Œä¹‹ååœ¨ mp ä¸­ä¸€å®šæ‰¾ä¸åˆ°ï¼Œä¼šç›´æ¥è¿”å› false</span></span><br><span class="line">            <span class="comment">// å¦‚æœåœ¨å½“å‰çŠ¶æ€è½¬åŒ–è¡¨ä¸­æ²¡æœ‰æ‰¾åˆ°å½“å‰ key</span></span><br><span class="line"> 			<span class="comment">// åˆ™è¯´æ˜æ­£å¸¸æƒ…å†µä¸‹è¯¥çŠ¶æ€ä¸æœŸå¾…å‡ºç°è¯¥è¾“å…¥</span></span><br><span class="line">            <span class="keyword">if</span> (!mp[state].count(t)) <span class="keyword">return</span> <span class="literal">false</span>; </span><br><span class="line">            state = mp[state][t];  <span class="comment">// çŠ¶æ€è½¬ç§»</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// åªæœ‰ 2 3 7 8 å››ç§çŠ¶æ€æ˜¯åˆæ³•çš„é€€å‡ºçŠ¶æ€</span></span><br><span class="line">        <span class="keyword">return</span> state == <span class="number">2</span> || state == <span class="number">3</span> || state == <span class="number">7</span> || state == <span class="number">8</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong> $O(N)$ï¼Œå…¶ä¸­ <em>N</em> ä¸ºå­—ç¬¦ä¸² <em>s</em> çš„é•¿åº¦ï¼Œä¸€æ¬¡éå†å³å¯ã€‚</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(1)$ï¼Œ<em>mp</em> å’Œ <em>state</em> ä½¿ç”¨å¸¸æ•°å¤§å°çš„é¢å¤–ç©ºé—´ã€‚</p><p>çŠ¶æ€è½¬ç§»å›¾è§ï¼š</p><blockquote><p><a href="https://leetcode-cn.com/leetbook/read/illustration-of-algorithm/5dkal2/" target="_blank" rel="noopener">å›¾è§£ç®—æ³•æ•°æ®ç»“æ„_å‰‘æŒ‡offer20</a></p></blockquote><hr><h3 id="å‰‘æŒ‡-Offer-24-åè½¬é“¾è¡¨"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-24-åè½¬é“¾è¡¨">Â¶</a><a href="https://leetcode-cn.com/problems/fan-zhuan-lian-biao-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 24. åè½¬é“¾è¡¨</a></h3><p>Difficulty: <strong><font color="008F00">ç®€å•</font></strong></p><p>å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œè¾“å…¥ä¸€ä¸ªé“¾è¡¨çš„å¤´èŠ‚ç‚¹ï¼Œåè½¬è¯¥é“¾è¡¨å¹¶è¾“å‡ºåè½¬åé“¾è¡¨çš„å¤´èŠ‚ç‚¹ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: 1-&gt;2-&gt;3-&gt;4-&gt;5-&gt;NULL</span><br><span class="line">è¾“å‡º: 5-&gt;4-&gt;3-&gt;2-&gt;1-&gt;NULL</span><br></pre></td></tr></table></figure><p><strong>é™åˆ¶ï¼š</strong></p><p><code>0 &lt;= èŠ‚ç‚¹ä¸ªæ•° &lt;= 5000</code></p><p><strong>Solution</strong></p><p><strong><font color="F08F00">æ–¹æ³•ä¸€ï¼šåŒæŒ‡é’ˆ</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ListNode* <span class="title">reverseList</span><span class="params">(ListNode* head)</span> </span>&#123;</span><br><span class="line">        ListNode* pre = <span class="literal">nullptr</span>;</span><br><span class="line">        ListNode* cur = head;</span><br><span class="line">        <span class="keyword">while</span> (cur) &#123;</span><br><span class="line">            ListNode* post = cur-&gt;next;</span><br><span class="line">            cur-&gt;next = pre;</span><br><span class="line">            pre = cur;</span><br><span class="line">            cur = post;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> pre;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œ<em>N</em> ä¸ºé“¾è¡¨é•¿åº¦ï¼Œä¸€æ¬¡éå†é“¾è¡¨ã€‚</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(1)$ï¼Œ<em>pre, cur, post</em> æ‰€éœ€è¦å¸¸æ•°çº§çš„é¢å¤–ç©ºé—´ã€‚</p><hr><p><strong><font color="F08F00">æ–¹æ³•äºŒï¼šé€’å½’</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ListNode* <span class="title">reverseList</span><span class="params">(ListNode* head)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> recur(head, <span class="literal">nullptr</span>);           <span class="comment">// è°ƒç”¨é€’å½’å¹¶è¿”å›</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function">ListNode* <span class="title">recur</span><span class="params">(ListNode* cur, ListNode* pre)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (cur == <span class="literal">nullptr</span>) <span class="keyword">return</span> pre;        <span class="comment">// ç»ˆæ­¢æ¡ä»¶</span></span><br><span class="line">        ListNode* res = recur(cur-&gt;next, cur); <span class="comment">// é€’å½’åç»§èŠ‚ç‚¹</span></span><br><span class="line">        cur-&gt;next = pre;                       <span class="comment">// ä¿®æ”¹èŠ‚ç‚¹å¼•ç”¨æŒ‡å‘</span></span><br><span class="line">        <span class="keyword">return</span> res;                            <span class="comment">// è¿”å›åè½¬é“¾è¡¨çš„å¤´èŠ‚ç‚¹</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œ<em>N</em> ä¸ºé“¾è¡¨é•¿åº¦ï¼Œä¸€æ¬¡éå†é“¾è¡¨ã€‚</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œéå†é“¾è¡¨çš„é€’å½’æ·±åº¦è¾¾åˆ° <em>N</em>ï¼Œç³»ç»Ÿä½¿ç”¨ <em>O(N)</em> å¤§å°çš„é¢å¤–ç©ºé—´ã€‚</p><hr><h3 id="å‰‘æŒ‡-Offer-30-åŒ…å«minå‡½æ•°çš„æ ˆ"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-30-åŒ…å«minå‡½æ•°çš„æ ˆ">Â¶</a><a href="https://leetcode-cn.com/problems/bao-han-minhan-shu-de-zhan-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 30. åŒ…å«minå‡½æ•°çš„æ ˆ</a></h3><p>Difficulty: <strong><font color="008F00">ç®€å•</font></strong></p><p>å®šä¹‰æ ˆçš„æ•°æ®ç»“æ„ï¼Œè¯·åœ¨è¯¥ç±»å‹ä¸­å®ç°ä¸€ä¸ªèƒ½å¤Ÿå¾—åˆ°æ ˆçš„æœ€å°å…ƒç´ çš„ min å‡½æ•°åœ¨è¯¥æ ˆä¸­ï¼Œè°ƒç”¨ minã€push åŠ pop çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(1)ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">MinStack minStack &#x3D; new MinStack();</span><br><span class="line">minStack.push(-2);</span><br><span class="line">minStack.push(0);</span><br><span class="line">minStack.push(-3);</span><br><span class="line">minStack.min();   --&gt; è¿”å› -3.</span><br><span class="line">minStack.pop();</span><br><span class="line">minStack.top();      --&gt; è¿”å› 0.</span><br><span class="line">minStack.min();   --&gt; è¿”å› -2.</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ol><li>å„å‡½æ•°çš„è°ƒç”¨æ€»æ¬¡æ•°ä¸è¶…è¿‡ 20000 æ¬¡</li></ol><p><strong>Solution</strong></p><p><strong><font color="F08F00">æ–¹æ³•ä¸€ï¼švector å®ç°</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MinStack</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/** initialize your data structure here. */</span></span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="built_in">stack</span>;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; minN;</span><br><span class="line">    MinStack() &#123;</span><br><span class="line">        minN.push_back(INT_MAX);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">push</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">stack</span>.push_back(x);</span><br><span class="line">        <span class="comment">// è¾“å…¥çš„xæ›´å°</span></span><br><span class="line">        <span class="keyword">if</span> (minN.back() &gt; x) &#123;</span><br><span class="line">            minN.push_back(x);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// è¯¥æ­¥éª¤ä¸èƒ½çœç•¥</span></span><br><span class="line">            minN.push_back(minN.back());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        minN.pop_back();</span><br><span class="line">        <span class="built_in">stack</span>.pop_back();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">top</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">stack</span>.back();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">min</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">stack</span>.empty()) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> minN.back();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Your MinStack object will be instantiated and called as such:</span></span><br><span class="line"><span class="comment"> * MinStack* obj = new MinStack();</span></span><br><span class="line"><span class="comment"> * obj-&gt;push(x);</span></span><br><span class="line"><span class="comment"> * obj-&gt;pop();</span></span><br><span class="line"><span class="comment"> * int param_3 = obj-&gt;top();</span></span><br><span class="line"><span class="comment"> * int param_4 = obj-&gt;min();</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><p><strong><font color="F08F00">æ–¹æ³•äºŒï¼šstack å®ç°</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MinStack</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/** initialize your data structure here. */</span></span><br><span class="line">    <span class="built_in">stack</span> &lt;<span class="keyword">int</span>&gt; s;</span><br><span class="line">    <span class="built_in">stack</span> &lt;<span class="keyword">int</span>&gt; m;</span><br><span class="line">    MinStack() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">push</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        s.push(x);</span><br><span class="line">        <span class="keyword">if</span>(m.empty() || x &lt;= m.top()) m.push(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(s.top() == m.top())  m.pop();</span><br><span class="line">        s.pop();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">top</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> s.top();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">min</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> m.top();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š$O(1)$ï¼Œ<em>push, pop, top, min</em>ï¼Œçš†æ˜¯ $O(1)$ã€‚</p><p><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š$O(N)$ï¼Œéœ€è¦é¢å¤–çš„ <em>vector</em> ç©ºé—´ï¼Œæˆ–è€… <em>stack</em> ç©ºé—´ã€‚</p><hr><h3 id="å‰‘æŒ‡-Offer-35-å¤æ‚é“¾è¡¨çš„å¤åˆ¶"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-35-å¤æ‚é“¾è¡¨çš„å¤åˆ¶">Â¶</a><a href="https://leetcode-cn.com/problems/fu-za-lian-biao-de-fu-zhi-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 35. å¤æ‚é“¾è¡¨çš„å¤åˆ¶</a></h3><p>Difficulty: <strong><font color="F08F00">ä¸­ç­‰</font></strong></p><p>è¯·å®ç° <code>copyRandomList</code> å‡½æ•°ï¼Œå¤åˆ¶ä¸€ä¸ªå¤æ‚é“¾è¡¨ã€‚åœ¨å¤æ‚é“¾è¡¨ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹é™¤äº†æœ‰ä¸€ä¸ª <code>next</code> æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¿˜æœ‰ä¸€ä¸ª <code>random</code> æŒ‡é’ˆæŒ‡å‘é“¾è¡¨ä¸­çš„ä»»æ„èŠ‚ç‚¹æˆ–è€… <code>null</code>ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><p><img src="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2020/01/09/e1.png" alt></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šhead &#x3D; [[7,null],[13,0],[11,4],[10,2],[1,0]]</span><br><span class="line">è¾“å‡ºï¼š[[7,null],[13,0],[11,4],[10,2],[1,0]]</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><p><img src="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2020/01/09/e2.png" alt></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šhead &#x3D; [[1,1],[2,1]]</span><br><span class="line">è¾“å‡ºï¼š[[1,1],[2,1]]</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><p><strong><img src="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2020/01/09/e3.png" alt></strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šhead &#x3D; [[3,null],[3,0],[3,null]]</span><br><span class="line">è¾“å‡ºï¼š[[3,null],[3,0],[3,null]]</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 4ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šhead &#x3D; []</span><br><span class="line">è¾“å‡ºï¼š[]</span><br><span class="line">è§£é‡Šï¼šç»™å®šçš„é“¾è¡¨ä¸ºç©ºï¼ˆç©ºæŒ‡é’ˆï¼‰ï¼Œå› æ­¤è¿”å› nullã€‚</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li><code>-10000 &lt;= Node.val &lt;= 10000</code></li><li><code>Node.random</code> ä¸ºç©ºï¼ˆnullï¼‰æˆ–æŒ‡å‘é“¾è¡¨ä¸­çš„èŠ‚ç‚¹ã€‚</li><li>èŠ‚ç‚¹æ•°ç›®ä¸è¶…è¿‡ 1000 ã€‚</li></ul><p><strong>Solution</strong></p><p><strong><font color="F08F00">æ–¹æ³•ä¸€ï¼šå“ˆå¸Œè¡¨</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">Node* <span class="title">copyRandomList</span><span class="params">(Node* head)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(head == <span class="literal">nullptr</span>) <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">        Node* cur = head;</span><br><span class="line">        <span class="built_in">unordered_map</span>&lt;Node*, Node*&gt; <span class="built_in">map</span>;</span><br><span class="line">        <span class="comment">// 3. å¤åˆ¶å„èŠ‚ç‚¹ï¼Œå¹¶å»ºç«‹ â€œåŸèŠ‚ç‚¹ -&gt; æ–°èŠ‚ç‚¹â€ çš„ Map æ˜ å°„</span></span><br><span class="line">        <span class="keyword">while</span>(cur != <span class="literal">nullptr</span>) &#123;</span><br><span class="line">            <span class="built_in">map</span>[cur] = <span class="keyword">new</span> Node(cur-&gt;val);</span><br><span class="line">            cur = cur-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        cur = head;</span><br><span class="line">        <span class="comment">// 4. æ„å»ºæ–°é“¾è¡¨çš„ next å’Œ random æŒ‡å‘</span></span><br><span class="line">        <span class="keyword">while</span>(cur != <span class="literal">nullptr</span>) &#123;</span><br><span class="line">            <span class="built_in">map</span>[cur]-&gt;next = <span class="built_in">map</span>[cur-&gt;next];</span><br><span class="line">            <span class="built_in">map</span>[cur]-&gt;<span class="built_in">random</span> = <span class="built_in">map</span>[cur-&gt;<span class="built_in">random</span>];</span><br><span class="line">            cur = cur-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 5. è¿”å›æ–°é“¾è¡¨çš„å¤´èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">map</span>[head];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š$O(N)$ï¼ŒN ä¸ºé“¾è¡¨é•¿åº¦ï¼Œä¸¤æ¬¡éå†é“¾è¡¨ã€‚</p><p><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š$O(N)$ï¼Œå“ˆå¸Œè¡¨æ‰€éœ€çš„é¢å¤–ç©ºé—´ã€‚</p><hr><p><strong><font color="F08F00">æ–¹æ³•äºŒï¼šæ‹¼æ¥ + æ‹†åˆ†</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">Node* <span class="title">copyRandomList</span><span class="params">(Node* head)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(head == <span class="literal">nullptr</span>) <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">        Node* cur = head;</span><br><span class="line">        <span class="comment">// 1. å¤åˆ¶å„èŠ‚ç‚¹ï¼Œå¹¶æ„å»ºæ‹¼æ¥é“¾è¡¨</span></span><br><span class="line">        <span class="keyword">while</span>(cur != <span class="literal">nullptr</span>) &#123;</span><br><span class="line">            Node* tmp = <span class="keyword">new</span> Node(cur-&gt;val);</span><br><span class="line">            tmp-&gt;next = cur-&gt;next;</span><br><span class="line">            cur-&gt;next = tmp;</span><br><span class="line">            cur = tmp-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2. æ„å»ºå„æ–°èŠ‚ç‚¹çš„ random æŒ‡å‘</span></span><br><span class="line">        cur = head;</span><br><span class="line">        <span class="keyword">while</span>(cur != <span class="literal">nullptr</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(cur-&gt;<span class="built_in">random</span> != <span class="literal">nullptr</span>)</span><br><span class="line">                cur-&gt;next-&gt;<span class="built_in">random</span> = cur-&gt;<span class="built_in">random</span>-&gt;next;</span><br><span class="line">            cur = cur-&gt;next-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3. æ‹†åˆ†ä¸¤é“¾è¡¨</span></span><br><span class="line">        cur = head-&gt;next;</span><br><span class="line">        Node* pre = head, *res = head-&gt;next;</span><br><span class="line">        <span class="keyword">while</span>(cur-&gt;next != <span class="literal">nullptr</span>) &#123;</span><br><span class="line">            pre-&gt;next = pre-&gt;next-&gt;next;</span><br><span class="line">            cur-&gt;next = cur-&gt;next-&gt;next;</span><br><span class="line">            pre = pre-&gt;next;</span><br><span class="line">            cur = cur-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        pre-&gt;next = <span class="literal">nullptr</span>; <span class="comment">// å•ç‹¬å¤„ç†åŸé“¾è¡¨å°¾èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">return</span> res;      <span class="comment">// è¿”å›æ–°é“¾è¡¨å¤´èŠ‚ç‚¹</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š$O(N)$ï¼ŒN ä¸ºé“¾è¡¨é•¿åº¦ï¼Œä¸‰æ¬¡éå†é“¾è¡¨ã€‚</p><p><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š$O(1)$ï¼ŒèŠ‚ç‚¹å¼•ç”¨å˜é‡æ‰€éœ€çš„é¢å¤–ç©ºé—´ã€‚</p><hr><h3 id="å‰‘æŒ‡-Offer-58-II-å·¦æ—‹è½¬å­—ç¬¦ä¸²"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-58-II-å·¦æ—‹è½¬å­—ç¬¦ä¸²">Â¶</a><a href="https://leetcode-cn.com/problems/zuo-xuan-zhuan-zi-fu-chuan-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 58 - II. å·¦æ—‹è½¬å­—ç¬¦ä¸²</a></h3><p>Difficulty: <strong><font color="008F00">ç®€å•</font></strong></p><p>å­—ç¬¦ä¸²çš„å·¦æ—‹è½¬æ“ä½œæ˜¯æŠŠå­—ç¬¦ä¸²å‰é¢çš„è‹¥å¹²ä¸ªå­—ç¬¦è½¬ç§»åˆ°å­—ç¬¦ä¸²çš„å°¾éƒ¨ã€‚è¯·å®šä¹‰ä¸€ä¸ªå‡½æ•°å®ç°å­—ç¬¦ä¸²å·¦æ—‹è½¬æ“ä½œçš„åŠŸèƒ½ã€‚æ¯”å¦‚ï¼Œè¾“å…¥å­—ç¬¦ä¸²&quot;abcdefg&quot;å’Œæ•°å­—2ï¼Œè¯¥å‡½æ•°å°†è¿”å›å·¦æ—‹è½¬ä¸¤ä½å¾—åˆ°çš„ç»“æœ&quot;cdefgab&quot;ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: s &#x3D; &quot;abcdefg&quot;, k &#x3D; 2</span><br><span class="line">è¾“å‡º: &quot;cdefgab&quot;</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: s &#x3D; &quot;lrloseumgh&quot;, k &#x3D; 6</span><br><span class="line">è¾“å‡º: &quot;umghlrlose&quot;</span><br></pre></td></tr></table></figure><p><strong>é™åˆ¶ï¼š</strong></p><ul><li><code>1 &lt;= k &lt; s.length &lt;= 10000</code></li></ul><p><strong>Solution</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">string</span> <span class="title">reverseLeftWords</span><span class="params">(<span class="built_in">string</span> s, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        reverse(s.<span class="built_in">begin</span>(), s.<span class="built_in">begin</span>() + n);</span><br><span class="line">        reverse(s.<span class="built_in">begin</span>() + n, s.<span class="built_in">end</span>());</span><br><span class="line">        reverse(s.<span class="built_in">begin</span>(), s.<span class="built_in">end</span>());</span><br><span class="line">        <span class="keyword">return</span> s;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œ<em>N</em> ä¸º <em>s</em> çš„é•¿åº¦ï¼Œå…±ä¸¤æ¬¡éå† <em>s</em>ã€‚</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(1)$ï¼ŒC++ åŸåœ°å­—ç¬¦ä¸²æ“ä½œï¼Œä½¿ç”¨å¸¸æ•°å¤§å°é¢å¤–ç©ºé—´ã€‚</p><hr><h3 id="å‰‘æŒ‡-Offer-59-I-æ»‘åŠ¨çª—å£çš„æœ€å¤§å€¼"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-59-I-æ»‘åŠ¨çª—å£çš„æœ€å¤§å€¼">Â¶</a><a href="https://leetcode-cn.com/problems/hua-dong-chuang-kou-de-zui-da-zhi-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 59 - I. æ»‘åŠ¨çª—å£çš„æœ€å¤§å€¼</a></h3><p>Difficulty: <strong><font color="FF0000">å›°éš¾</font></strong></p><p>ç»™å®šä¸€ä¸ªæ•°ç»„ <code>nums</code> å’Œæ»‘åŠ¨çª—å£çš„å¤§å° <code>k</code>ï¼Œè¯·æ‰¾å‡ºæ‰€æœ‰æ»‘åŠ¨çª—å£é‡Œçš„æœ€å¤§å€¼ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: nums &#x3D; [1,3,-1,-3,5,3,6,7], å’Œ k &#x3D; 3</span><br><span class="line">è¾“å‡º: [3,3,5,5,6,7] </span><br><span class="line">è§£é‡Š: </span><br><span class="line"></span><br><span class="line">  æ»‘åŠ¨çª—å£çš„ä½ç½®                æœ€å¤§å€¼</span><br><span class="line">---------------               -----</span><br><span class="line">[1  3  -1] -3  5  3  6  7       3</span><br><span class="line"> 1 [3  -1  -3] 5  3  6  7       3</span><br><span class="line"> 1  3 [-1  -3  5] 3  6  7       5</span><br><span class="line"> 1  3  -1 [-3  5  3] 6  7       5</span><br><span class="line"> 1  3  -1  -3 [5  3  6] 7       6</span><br><span class="line"> 1  3  -1  -3  5 [3  6  7]      7</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><p>ä½ å¯ä»¥å‡è®¾ <em>k</em> æ€»æ˜¯æœ‰æ•ˆçš„ï¼Œåœ¨è¾“å…¥æ•°ç»„ä¸ä¸ºç©ºçš„æƒ…å†µä¸‹ï¼Œ1 â‰¤ k â‰¤ è¾“å…¥æ•°ç»„çš„å¤§å°ã€‚</p><p><strong>Solution</strong></p><p><strong><font color="F08F00">æ–¹æ³•ä¸€ï¼šä¼˜å…ˆé˜Ÿåˆ—</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">maxSlidingWindow</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">        priority_queue&lt;pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;&gt; q;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; k; ++i) &#123;</span><br><span class="line">            q.emplace(nums[i], i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; ans = &#123;q.top().first&#125;;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = k; i &lt; n; ++i) &#123;</span><br><span class="line">            q.emplace(nums[i], i);</span><br><span class="line">            <span class="keyword">while</span> (q.top().second &lt;= i - k) &#123;</span><br><span class="line">                q.pop();</span><br><span class="line">            &#125;</span><br><span class="line">            ans.push_back(q.top().first);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(N\log N)$ï¼Œå…¶ä¸­ <em>N</em> æ˜¯ <em>nums</em> çš„é•¿åº¦ï¼Œ<em>nums</em> å•è°ƒé€’å¢æƒ…å†µï¼Œä¼˜å…ˆé˜Ÿåˆ—åŒ…å«æ‰€æœ‰å…ƒç´ ï¼Œæ²¡æœ‰å…ƒç´ è¢«ç§»é™¤ï¼Œä¸‹ä¸€ä¸ªå…ƒç´ æ”¾å…¥ä¼˜å…ˆé˜Ÿåˆ—çš„æ—¶é—´å¤æ‚åº¦ä¸º $O(\log N)$ï¼Œå› æ­¤æ€»çš„æ—¶é—´å¤æ‚åº¦ä¸º $O(n \log N)$ã€‚</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œnums å•è°ƒé€’å¢æƒ…å†µä¸‹ä¼šå­˜ä¸‹æ‰€æœ‰å…ƒç´ ã€‚</p><hr><p><strong><font color="F08F00">æ–¹æ³•äºŒï¼šå•è°ƒé˜Ÿåˆ—ï¼ˆå­˜å…ƒç´ ï¼‰</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">maxSlidingWindow</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">0</span>) <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">        <span class="built_in">deque</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line">        <span class="comment">// å¤„ç† å‰ k ä¸ª</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; k; i++) &#123;</span><br><span class="line">            <span class="comment">// push æ“ä½œ</span></span><br><span class="line">            <span class="comment">// å•è°ƒé˜Ÿåˆ—å†™æ³•ï¼Œé˜Ÿé¦–å…ƒç´ æ€»æ˜¯æœ€å¤§å€¼</span></span><br><span class="line">            <span class="keyword">while</span> (!q.empty() &amp;&amp; nums[i] &gt; q.back()) &#123;</span><br><span class="line">                q.pop_back();</span><br><span class="line">            &#125;</span><br><span class="line">            q.push_back(nums[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; res;</span><br><span class="line">        res.push_back(q.front());</span><br><span class="line">        <span class="comment">// å¤„ç†å n - k ä¸ª</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = k; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="comment">// å…³é”®ï¼Œéœ€è¦åœ¨ push ä¹‹å‰åˆ¤æ–­ï¼Œä»¥å½“å‰ä½ç½®ä¸ºå³è¾¹æ¡†ï¼Œå·¦è¾¹æ¡†å…ƒç´ æ˜¯å¦åœ¨é˜Ÿåˆ—ä¸­</span></span><br><span class="line">            <span class="comment">// å¦‚æœåœ¨é˜Ÿåˆ—ä¸­ï¼Œéœ€è¦ pop å®ƒ</span></span><br><span class="line">            <span class="comment">// push æ“ä½œ</span></span><br><span class="line">            <span class="keyword">if</span> (q.front() == nums[i - k]) q.pop_front();</span><br><span class="line">            <span class="keyword">while</span> (!q.empty() &amp;&amp; nums[i] &gt; q.back()) &#123;</span><br><span class="line">                q.pop_back();</span><br><span class="line">            &#125;</span><br><span class="line">            q.push_back(nums[i]);</span><br><span class="line">            <span class="comment">// è®°å½•ç»“æœ</span></span><br><span class="line">            res.push_back(q.front());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong><font color="F08F00">æ–¹æ³•ä¸‰ï¼šå•è°ƒé˜Ÿåˆ—ï¼ˆå­˜å…ƒç´ ç´¢å¼•ï¼‰</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">maxSlidingWindow</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">0</span>) <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">        <span class="built_in">deque</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; k; ++i) &#123;</span><br><span class="line">            <span class="keyword">while</span> (!q.empty() &amp;&amp; nums[i] &gt;= nums[q.back()]) &#123;</span><br><span class="line">                q.pop_back();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// ä¸æ–¹æ³•ä¸€ç›¸ä¼¼ï¼Œåªä¸è¿‡æ­¤æ—¶å­˜å…¥é˜Ÿåˆ—çš„æ˜¯å…ƒç´ ç´¢å¼•</span></span><br><span class="line">            q.push_back(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; res = &#123;nums[q.front()]&#125;;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = k; i &lt; n; ++i) &#123;</span><br><span class="line">            <span class="keyword">while</span> (!q.empty() &amp;&amp; nums[i] &gt;= nums[q.back()]) &#123;</span><br><span class="line">                q.pop_back();</span><br><span class="line">            &#125;</span><br><span class="line">            q.push_back(i);</span><br><span class="line">            <span class="comment">// åŒæ ·è¦åˆ¤æ–­ï¼Œä»¥å½“å‰ä½ç½®ä¸ºå³è¾¹æ¡†ï¼Œå·¦è¾¹æ¡†å…ƒç´ æ˜¯å¦åœ¨é˜Ÿåˆ—ä¸­</span></span><br><span class="line">            <span class="comment">// å¦‚æœåœ¨é˜Ÿåˆ—ä¸­ï¼Œéœ€è¦ pop å®ƒ</span></span><br><span class="line">            <span class="keyword">while</span> (q.front() &lt;= i - k) &#123;</span><br><span class="line">                q.pop_front();</span><br><span class="line">            &#125;</span><br><span class="line">            res.push_back(nums[q.front()]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä¸¤ç§æ–¹æ³•çš„æ—¶é—´ç©ºé—´å¤æ‚åº¦ç›¸åŒã€‚</p><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œå…¶ä¸­ <em>N</em> æ˜¯ <em>nums</em> çš„é•¿åº¦ï¼Œæ¯ä¸ªä½ç½®çš„å…ƒç´ æˆ–è€…ç´¢å¼•æ°å¥½è¢«æ”¾å…¥é˜Ÿåˆ—ä¸€æ¬¡ï¼Œå¹¶ä¸”æœ€å¤šè¢«å¼¹å‡ºé˜Ÿåˆ—ä¸€æ¬¡ã€‚</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(K)$ï¼Œè¶…å‡º <em>K</em>ï¼Œä¼šæœ‰ <em>pop</em> æ“ä½œï¼Œæ‰€ä»¥é˜Ÿåˆ—ä¸­çš„å…ƒç´ ä¸ªæ•°ä¸ä¼šè¶…è¿‡ <em>K</em>ï¼›</p><hr><h3 id="å‰‘æŒ‡-Offer-59-II-é˜Ÿåˆ—çš„æœ€å¤§å€¼"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-59-II-é˜Ÿåˆ—çš„æœ€å¤§å€¼">Â¶</a><a href="https://leetcode-cn.com/problems/dui-lie-de-zui-da-zhi-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 59 - II. é˜Ÿåˆ—çš„æœ€å¤§å€¼</a></h3><p>Difficulty: <strong><font color="F08F00">ä¸­ç­‰</font></strong></p><p>è¯·å®šä¹‰ä¸€ä¸ªé˜Ÿåˆ—å¹¶å®ç°å‡½æ•° <code>max_value</code> å¾—åˆ°é˜Ÿåˆ—é‡Œçš„æœ€å¤§å€¼ï¼Œè¦æ±‚å‡½æ•°<code>max_value</code>ã€<code>push_back</code> å’Œ <code>pop_front</code> çš„<strong>å‡æ‘Š</strong>æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(1)ã€‚</p><p>è‹¥é˜Ÿåˆ—ä¸ºç©ºï¼Œ<code>pop_front</code> å’Œ <code>max_value</code> éœ€è¦è¿”å› -1</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: </span><br><span class="line">[&quot;MaxQueue&quot;,&quot;push_back&quot;,&quot;push_back&quot;,&quot;max_value&quot;,&quot;pop_front&quot;,&quot;max_value&quot;]</span><br><span class="line">[[],[1],[2],[],[],[]]</span><br><span class="line">è¾“å‡º: [null,null,null,2,1,2]</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: </span><br><span class="line">[&quot;MaxQueue&quot;,&quot;pop_front&quot;,&quot;max_value&quot;]</span><br><span class="line">[[],[],[]]</span><br><span class="line">è¾“å‡º: [null,-1,-1]</span><br></pre></td></tr></table></figure><p><strong>é™åˆ¶ï¼š</strong></p><ul><li><code>1 &lt;= push_back,pop_front,max_valueçš„æ€»æ“ä½œæ•° &lt;= 10000</code></li><li><code>1 &lt;= value &lt;= 10^5</code></li></ul><p><strong>Solution</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MaxQueue</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">deque</span>&lt;<span class="keyword">int</span>&gt; maxQ;  <span class="comment">// ç”¨æ¥å­˜é˜Ÿåˆ—æœ€å¤§å€¼, è¶Šé è¿‘é˜Ÿé¦–å…ƒç´ è¶Šå¤§</span></span><br><span class="line">    <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; que;   <span class="comment">// é˜Ÿåˆ—</span></span><br><span class="line">    MaxQueue() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">max_value</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// é˜Ÿåˆ—ä¸ºç©ºï¼Œç›´æ¥è¿”å› -1</span></span><br><span class="line">        <span class="keyword">if</span> (que.<span class="built_in">size</span>()== <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¦åˆ™åé¦ˆ æœ€å¤§å€¼é˜Ÿåˆ—é˜Ÿé¦–</span></span><br><span class="line">        <span class="keyword">return</span> maxQ.front();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">push_back</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">        que.push(value);  <span class="comment">// é˜Ÿåˆ— push</span></span><br><span class="line">        <span class="comment">// å¦‚æœæœ€å¤§å€¼é˜Ÿåˆ—ä¸ºç©ºï¼Œå½“å‰å€¼å°±æ˜¯æœ€å¤§å€¼ï¼Œç›´æ¥pushåˆ°æœ€å¤§å€¼é˜Ÿåˆ—</span></span><br><span class="line">        <span class="keyword">if</span> (maxQ.<span class="built_in">size</span>() == <span class="number">0</span>) &#123;</span><br><span class="line">            maxQ.push_back(value);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å½“å‰å€¼å¤§äºé˜Ÿé¦–ï¼Œä¹Ÿå°±æ˜¯å¤§äºæ‰€æœ‰å€¼ï¼Œç›´æ¥æ¸…ç©ºæœ€å¤§å€¼é˜Ÿåˆ—å¹¶pushå½“å‰å€¼ </span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (value &gt; maxQ.front()) &#123;</span><br><span class="line">            maxQ.<span class="built_in">clear</span>();</span><br><span class="line">            maxQ.push_back(value);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¦åˆ™popæ‰æ¯”å®ƒå°çš„çš„ï¼Œæ”¾å…¥è¯¥æ”¾å…¥çš„ä½ç½® </span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (maxQ.back() &lt; value) &#123;</span><br><span class="line">                maxQ.pop_back();</span><br><span class="line">            &#125;</span><br><span class="line">            maxQ.push_back(value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">pop_front</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (que.<span class="built_in">size</span>() == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">int</span> res = que.front();</span><br><span class="line">        que.pop();</span><br><span class="line">        <span class="comment">// å¦‚æœ push çš„æ˜¯æœ€å¤§å€¼ï¼Œéœ€è¦å°† maxQ é˜Ÿé¦– pop</span></span><br><span class="line">        <span class="keyword">if</span> (res == maxQ.front()) maxQ.pop_front();</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Your MaxQueue object will be instantiated and called as such:</span></span><br><span class="line"><span class="comment"> * MaxQueue* obj = new MaxQueue();</span></span><br><span class="line"><span class="comment"> * int param_1 = obj-&gt;max_value();</span></span><br><span class="line"><span class="comment"> * obj-&gt;push_back(value);</span></span><br><span class="line"><span class="comment"> * int param_3 = obj-&gt;pop_front();</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(1)$ï¼Œ<code>max_value()</code>, <code>push_back()</code>ï¼Œ<code>pop_front()</code> æ–¹æ³•çš„å‡æ‘Šæ—¶é—´å¤æ‚åº¦å‡ä¸º $O(1)$</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œå¦‚æœè¿ç»­å­˜å…¥é€’å¢åºåˆ—ï¼Œ<em>maxQ</em> ä¸­å­˜ <em>N</em> ä¸ªå…ƒç´ ï¼Œä½¿ç”¨ $O(N)$ çš„é¢å¤–ç©ºé—´ã€‚</p><hr><h3 id="å‰‘æŒ‡-Offer-67-æŠŠå­—ç¬¦ä¸²è½¬æ¢æˆæ•´æ•°"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-67-æŠŠå­—ç¬¦ä¸²è½¬æ¢æˆæ•´æ•°">Â¶</a><a href="https://leetcode-cn.com/problems/ba-zi-fu-chuan-zhuan-huan-cheng-zheng-shu-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 67. æŠŠå­—ç¬¦ä¸²è½¬æ¢æˆæ•´æ•°</a></h3><p>Difficulty: <strong><font color="F08F00">ä¸­ç­‰</font></strong></p><p>å†™ä¸€ä¸ªå‡½æ•° StrToIntï¼Œå®ç°æŠŠå­—ç¬¦ä¸²è½¬æ¢æˆæ•´æ•°è¿™ä¸ªåŠŸèƒ½ã€‚ä¸èƒ½ä½¿ç”¨ atoi æˆ–è€…å…¶ä»–ç±»ä¼¼çš„åº“å‡½æ•°ã€‚</p><p>é¦–å…ˆï¼Œè¯¥å‡½æ•°ä¼šæ ¹æ®éœ€è¦ä¸¢å¼ƒæ— ç”¨çš„å¼€å¤´ç©ºæ ¼å­—ç¬¦ï¼Œç›´åˆ°å¯»æ‰¾åˆ°ç¬¬ä¸€ä¸ªéç©ºæ ¼çš„å­—ç¬¦ä¸ºæ­¢ã€‚</p><p>å½“æˆ‘ä»¬å¯»æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªéç©ºå­—ç¬¦ä¸ºæ­£æˆ–è€…è´Ÿå·æ—¶ï¼Œåˆ™å°†è¯¥ç¬¦å·ä¸ä¹‹åé¢å°½å¯èƒ½å¤šçš„è¿ç»­æ•°å­—ç»„åˆèµ·æ¥ï¼Œä½œä¸ºè¯¥æ•´æ•°çš„æ­£è´Ÿå·ï¼›å‡å¦‚ç¬¬ä¸€ä¸ªéç©ºå­—ç¬¦æ˜¯æ•°å­—ï¼Œåˆ™ç›´æ¥å°†å…¶ä¸ä¹‹åè¿ç»­çš„æ•°å­—å­—ç¬¦ç»„åˆèµ·æ¥ï¼Œå½¢æˆæ•´æ•°ã€‚</p><p>è¯¥å­—ç¬¦ä¸²é™¤äº†æœ‰æ•ˆçš„æ•´æ•°éƒ¨åˆ†ä¹‹åä¹Ÿå¯èƒ½ä¼šå­˜åœ¨å¤šä½™çš„å­—ç¬¦ï¼Œè¿™äº›å­—ç¬¦å¯ä»¥è¢«å¿½ç•¥ï¼Œå®ƒä»¬å¯¹äºå‡½æ•°ä¸åº”è¯¥é€ æˆå½±å“ã€‚</p><p>æ³¨æ„ï¼šå‡å¦‚è¯¥å­—ç¬¦ä¸²ä¸­çš„ç¬¬ä¸€ä¸ªéç©ºæ ¼å­—ç¬¦ä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆæ•´æ•°å­—ç¬¦ã€å­—ç¬¦ä¸²ä¸ºç©ºæˆ–å­—ç¬¦ä¸²ä»…åŒ…å«ç©ºç™½å­—ç¬¦æ—¶ï¼Œåˆ™ä½ çš„å‡½æ•°ä¸éœ€è¦è¿›è¡Œè½¬æ¢ã€‚</p><p>åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œè‹¥å‡½æ•°ä¸èƒ½è¿›è¡Œæœ‰æ•ˆçš„è½¬æ¢æ—¶ï¼Œè¯·è¿”å› 0ã€‚</p><p><strong>è¯´æ˜ï¼š</strong></p><p>å‡è®¾æˆ‘ä»¬çš„ç¯å¢ƒåªèƒ½å­˜å‚¨ 32 ä½å¤§å°çš„æœ‰ç¬¦å·æ•´æ•°ï¼Œé‚£ä¹ˆå…¶æ•°å€¼èŒƒå›´ä¸º [âˆ’2<sup>31</sup>, 2<sup>31 </sup>âˆ’ 1]ã€‚å¦‚æœæ•°å€¼è¶…è¿‡è¿™ä¸ªèŒƒå›´ï¼Œè¯·è¿”å› INT_MAX (2<sup>31 </sup>âˆ’ 1) æˆ– INT_MIN (âˆ’2<sup>31</sup>) ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: &quot;42&quot;</span><br><span class="line">è¾“å‡º: 42</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: &quot;   -42&quot;</span><br><span class="line">è¾“å‡º: -42</span><br><span class="line">è§£é‡Š: ç¬¬ä¸€ä¸ªéç©ºç™½å­—ç¬¦ä¸º &#39;-&#39;, å®ƒæ˜¯ä¸€ä¸ªè´Ÿå·ã€‚</span><br><span class="line">     æˆ‘ä»¬å°½å¯èƒ½å°†è´Ÿå·ä¸åé¢æ‰€æœ‰è¿ç»­å‡ºç°çš„æ•°å­—ç»„åˆèµ·æ¥ï¼Œæœ€åå¾—åˆ° -42 ã€‚</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 3:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: &quot;4193 with words&quot;</span><br><span class="line">è¾“å‡º: 4193</span><br><span class="line">è§£é‡Š: è½¬æ¢æˆªæ­¢äºæ•°å­— &#39;3&#39; ï¼Œå› ä¸ºå®ƒçš„ä¸‹ä¸€ä¸ªå­—ç¬¦ä¸ä¸ºæ•°å­—ã€‚</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 4:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: &quot;words and 987&quot;</span><br><span class="line">è¾“å‡º: 0</span><br><span class="line">è§£é‡Š: ç¬¬ä¸€ä¸ªéç©ºå­—ç¬¦æ˜¯ &#39;w&#39;, ä½†å®ƒä¸æ˜¯æ•°å­—æˆ–æ­£ã€è´Ÿå·ã€‚</span><br><span class="line">     å› æ­¤æ— æ³•æ‰§è¡Œæœ‰æ•ˆçš„è½¬æ¢ã€‚</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 5:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: &quot;-91283472332&quot;</span><br><span class="line">è¾“å‡º: -2147483648</span><br><span class="line">è§£é‡Š: æ•°å­— &quot;-91283472332&quot; è¶…è¿‡ 32 ä½æœ‰ç¬¦å·æ•´æ•°èŒƒå›´ã€‚ </span><br><span class="line">     å› æ­¤è¿”å› INT_MIN (âˆ’231) ã€‚</span><br></pre></td></tr></table></figure><p><strong>Solution</strong></p><p><strong><font color="F08F00">æ–¹æ³•ä¸€ï¼šéå†</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">strToInt</span><span class="params">(<span class="built_in">string</span> str)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// INT_MIN ~ MAX [-2147483648, 2147483647 ] </span></span><br><span class="line">        <span class="comment">// ä¸€ï¼š(2147483647 / 10) * 10 = 2147483650 &gt; INT_MAX è¶Šç•Œ</span></span><br><span class="line">        <span class="comment">// äºŒï¼š2147483648 ~ 2147483649 è¶Šç•Œ </span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> res = <span class="number">0</span>, bound = INT_MAX / <span class="number">10</span>; </span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>, sign = <span class="number">1</span>, len = str.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">if</span> (len == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// å»æœ€å‰æ–¹ç©ºæ ¼</span></span><br><span class="line">        <span class="keyword">while</span> (str[i] == <span class="string">' '</span>) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœæ•´ä¸ªå­—ç¬¦ä¸²å…¨ç©ºæ ¼ï¼Œåˆ™è¿”å› 0</span></span><br><span class="line">            <span class="keyword">if</span> (++i == len) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// åˆ¤æ–­ + - å·</span></span><br><span class="line">        <span class="keyword">if</span> (str[i] == <span class="string">'-'</span>) &#123;</span><br><span class="line">            sign = <span class="number">-1</span>;</span><br><span class="line">            i++;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (str[i] == <span class="string">'+'</span>) &#123;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i; j &lt; len; j++) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœä¸æ˜¯æ•°å­—ï¼Œç›´æ¥ break</span></span><br><span class="line">            <span class="keyword">if</span> (str[j] &gt; <span class="string">'9'</span> || str[j] &lt; <span class="string">'0'</span>) <span class="keyword">break</span>;</span><br><span class="line">            <span class="comment">// å¦‚æœè¶Šç•Œ</span></span><br><span class="line">            <span class="keyword">if</span> (res &gt; bound || (res == bound &amp;&amp; str[j] &gt; <span class="string">'7'</span>)) &#123;</span><br><span class="line">                <span class="comment">// çœ‹ç¬¦å·åˆ¤æ–­è¶Šä¸Šç•Œè¿˜æ˜¯ä¸‹ç•Œ</span></span><br><span class="line">                <span class="keyword">return</span> sign == <span class="number">1</span> ? INT_MAX : INT_MIN;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 10 è¿›åˆ¶æ›´æ–°</span></span><br><span class="line">            res = res * <span class="number">10</span> + (str[j] - <span class="string">'0'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sign * res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š$O(N)$ï¼Œå…¶ä¸­ <em>N</em> ä¸ºå­—ç¬¦ä¸²é•¿åº¦ï¼Œéå†å­—ç¬¦ä¸²ï¼›</p><p><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š$O(N)$ï¼Œåˆ é™¤é¦–å°¾ç©ºæ ¼åéœ€è¦å»ºç«‹æ–°å­—ç¬¦ä¸²ï¼Œæœ€å·®æƒ…å†µä¸‹å ç”¨ $O(N)$ é¢å¤–ç©ºé—´ã€‚</p><p><strong><font color="FF8888">æ³¨æ„</font></strong>ï¼šè¯¥æ–¹æ³•çš„è¶Šç•Œåˆ¤æ–­ååˆ†å·§å¦™ï¼</p><blockquote><p><a href="https://leetcode-cn.com/leetbook/read/illustration-of-algorithm/58mttv/" target="_blank" rel="noopener">å›¾è§£ç®—æ³•æ•°æ®ç»“æ„_å‰‘æŒ‡offer67</a></p></blockquote><hr><p><strong><font color="F08F00">æ–¹æ³•äºŒï¼šå…ˆæ‰¾æ•°å­—é¦–ä½</font></strong>ï¼Œæœ¬è´¨ç›¸åŒï¼Œåªä¸è¿‡é€šè¿‡ STL ç®—æ³•æ¥å®ç°ã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// æ³¨æ„ï¼šä½¿ç”¨çš„ leetcode 8 â€œå­—ç¬¦ä¸²è½¬æ•´æ•°â€ï¼Œé‚£ä¸ªé¢˜ç›®çš„å˜é‡åç§°ã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">myAtoi</span><span class="params">(<span class="built_in">string</span> s)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// åˆ©ç”¨ STL ç®—æ³• find_first_of() æ¥æ‰¾åˆ°å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªæ•°å­—å‡ºç°çš„ä½ç½®ï¼Œç¡®å®šå¼€å¤´ä½ç½®ã€‚</span></span><br><span class="line">        <span class="keyword">size_t</span> pos = s.find_first_of(<span class="string">"0123456789"</span>);</span><br><span class="line">        <span class="keyword">if</span> (pos == <span class="number">-1</span>) <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">// æ²¡æœ‰æ‰¾åˆ°ï¼Œè¯´æ˜è¿™ä¸ªå­—ç¬¦ä¸²é‡Œé¢ä¸€ä¸ªæ•°å­—éƒ½æ²¡æœ‰ï¼Œç›´æ¥è¿”å› 0</span></span><br><span class="line">        <span class="comment">// åœ¨å­—ç¬¦ä¸²é¦–éƒ¨å°±æ‰¾åˆ°ï¼Œä¹Ÿå°±æ˜¯å­—ç¬¦ä¸²ç¬¬ä¸€ä¸ªç¬¦å·å°±æ˜¯æ•°å­—</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (pos == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">string</span> temp = <span class="string">""</span>;</span><br><span class="line">            <span class="keyword">int</span> i = pos; <span class="comment">// i = 0;</span></span><br><span class="line">            <span class="keyword">while</span> (i &lt; s.<span class="built_in">size</span>()) &#123; <span class="comment">// å¾€åéå†ï¼Œç¡®å®šæ•°å­—</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">isdigit</span>(s[i])) &#123;</span><br><span class="line">                    temp += s[i++];</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">long</span> <span class="keyword">long</span> res = <span class="number">0</span>;</span><br><span class="line">            <span class="built_in">stringstream</span> ss;  <span class="comment">// é€šè¿‡ stringstream å‡½æ•° å¯ä»¥å°† string è½¬åŒ–ä¸º long long</span></span><br><span class="line">            ss &lt;&lt; temp;</span><br><span class="line">            ss &gt;&gt; res;</span><br><span class="line">            <span class="comment">// åˆ¤æ–­ä¸Šä¸‹é™</span></span><br><span class="line">            <span class="keyword">if</span> (res &gt; INT_MAX) <span class="keyword">return</span> INT_MAX;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (res &lt; INT_MIN) <span class="keyword">return</span> INT_MIN;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">return</span> <span class="keyword">int</span>(res);   </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// éé¦–éƒ¨æ‰¾åˆ°ï¼Œéœ€è¦åˆ¤æ–­å‰é¢çš„å‡ ç§æƒ…å†µ </span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// æ­¤æ—¶éœ€è¦åˆ¤æ–­ï¼Œæ•°å­—ä¹‹å‰æœ‰æ²¡æœ‰å‡ºç°ç©ºæ ¼ä»¥å¤–çš„ç¬¦å·</span></span><br><span class="line">            <span class="comment">// æ³¨æ„æ­¤æ—¶ i &lt; pos - 1, éœ€è¦ç•™ä¸‹æ•°å­—å‰ä¸€ä½ç½®ï¼Œå®ƒå¯èƒ½æ˜¯ç¬¦å·ä½ï¼Œå•ç‹¬åˆ¤æ–­</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; pos - <span class="number">1</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!<span class="built_in">isspace</span>(s[i])) <span class="keyword">return</span> <span class="number">0</span>;  <span class="comment">// å­˜åœ¨å…¶ä»–ç¬¦å·ï¼Œç›´æ¥è¿”å› 0</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// å•ç‹¬åˆ¤æ–­æ•°å­—å‰ä¸€ä½</span></span><br><span class="line">            <span class="keyword">if</span> (!(s[pos - <span class="number">1</span>] == <span class="string">' '</span> || s[pos - <span class="number">1</span>] == <span class="string">'-'</span> || s[pos - <span class="number">1</span>] == <span class="string">'+'</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125; </span><br><span class="line">            <span class="comment">// åŒä¸Šæ–‡å¤„ç†</span></span><br><span class="line">            <span class="built_in">string</span> temp = <span class="string">""</span>;</span><br><span class="line">            <span class="keyword">int</span> i = pos;</span><br><span class="line">            <span class="keyword">while</span> (i &lt; s.<span class="built_in">size</span>()) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">isdigit</span>(s[i])) &#123;</span><br><span class="line">                    temp += s[i++];</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">long</span> <span class="keyword">long</span> res = <span class="number">0</span>;</span><br><span class="line">            <span class="built_in">stringstream</span> ss;</span><br><span class="line">            ss &lt;&lt; temp;</span><br><span class="line">            ss &gt;&gt; res;</span><br><span class="line">            <span class="comment">// è¦å…ˆå¤„ç†æ­£è´Ÿå·é—®é¢˜ï¼Œåœ¨è¿›è¡Œå¤§å°å€¼åˆ¤æ–­</span></span><br><span class="line">            <span class="keyword">if</span> (s[pos - <span class="number">1</span>] == <span class="string">'-'</span>) res = -res;</span><br><span class="line">            <span class="keyword">if</span> (res &gt; INT_MAX) <span class="keyword">return</span> INT_MAX;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (res &lt; INT_MIN) <span class="keyword">return</span> INT_MIN;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">return</span> <span class="keyword">int</span>(res); </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š$O(N)$ï¼Œå…¶ä¸­ <em>N</em> ä¸ºå­—ç¬¦ä¸²é•¿åº¦ï¼Œéå†å­—ç¬¦ä¸²ï¼›</p><p><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š$O(N)$ï¼Œä¸­é—´å˜é‡ <em>temp, stringstream</em> å¯¹è±¡ç­‰æ‰€éœ€çš„é¢å¤–ç©ºé—´ã€‚</p><hr><h3 id="å‚è€ƒèµ„æ–™"><a class="header-anchor" href="#å‚è€ƒèµ„æ–™">Â¶</a>å‚è€ƒèµ„æ–™</h3><blockquote><p><a href="https://leetcode-cn.com/leetbook/detail/illustration-of-algorithm/" target="_blank" rel="noopener">å›¾è§£ç®—æ³•æ•°æ®ç»“æ„ - LeetBook - åŠ›æ‰£ï¼ˆLeetCodeï¼‰å…¨çƒæå®¢æŒšçˆ±çš„æŠ€æœ¯æˆé•¿å¹³å° (leetcode-cn.com)</a></p><p><a href="https://leetcode-cn.com/" target="_blank" rel="noopener">åŠ›æ‰£ï¼ˆLeetCodeï¼‰å®˜ç½‘ - å…¨çƒæå®¢æŒšçˆ±çš„æŠ€æœ¯æˆé•¿å¹³å° (leetcode-cn.com)</a> å®˜æ–¹é¢˜è§£</p></blockquote><!-- rebuild by neat -->]]></content>
      <categories>
        <category>Data_Structure_and_Algorithm</category>
      </categories>
      <tags>
        <tag>æ•°æ®ç»“æ„</tag>
      </tags>
  </entry>
  <entry>
    <title>STL_vector</title>
    <url>/C++_Language/STL/vector/</url>
    <content><![CDATA[<!-- build time:Tue Jun 22 2021 17:02:33 GMT+0800 (GMT+08:00) --><a id="more"></a><h1>STL_vector</h1><h2 id="1-å†…éƒ¨ç»“æ„"><a class="header-anchor" href="#1-å†…éƒ¨ç»“æ„">Â¶</a>1. å†…éƒ¨ç»“æ„</h2><p>å°† <code>stl_vector.h</code> åˆ†ä¸ºäº†å››ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>å¤´æ–‡ä»¶</li><li>ç±»å‹åˆ«åå£°æ˜</li><li>æ•°æ®æˆå‘˜</li><li>æˆå‘˜å‡½æ•°</li></ul><hr><h3 id="1-1-å¤´æ–‡ä»¶"><a class="header-anchor" href="#1-1-å¤´æ–‡ä»¶">Â¶</a>1.1 å¤´æ–‡ä»¶</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstddef&gt;      	// ptrdiff_t</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"allocator.h"</span>		<span class="comment">// allocate</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"uninitialized.h"</span>	<span class="comment">// uninitialize_fill()....</span></span></span><br></pre></td></tr></table></figure><hr><h3 id="1-2-ç±»å‹åˆ«åå£°æ˜"><a class="header-anchor" href="#1-2-ç±»å‹åˆ«åå£°æ˜">Â¶</a>1.2 ç±»å‹åˆ«åå£°æ˜</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span>:  <span class="comment">// alias declarartions</span></span><br><span class="line">    <span class="comment">// ç±»å‹åˆ«å</span></span><br><span class="line">    <span class="keyword">using</span> value_type = T; </span><br><span class="line">    <span class="keyword">using</span> pointer = value_type *;</span><br><span class="line">    <span class="keyword">using</span> iterator = value_type *;  <span class="comment">// iterator is raw pointer</span></span><br><span class="line">    <span class="keyword">using</span> const_iterator = <span class="keyword">const</span> value_type *;</span><br><span class="line">    <span class="keyword">using</span> reverse_iterator = __reverse_iterator&lt;iterator&gt;;</span><br><span class="line">    <span class="keyword">using</span> const_reverse_iterator = __reverse_iterator&lt;const_iterator&gt;;</span><br><span class="line">    <span class="keyword">using</span> reference = value_type &amp;;</span><br><span class="line">    <span class="keyword">using</span> const_reference = <span class="keyword">const</span> value_type &amp;;</span><br><span class="line">    <span class="keyword">using</span> size_type = <span class="keyword">size_t</span>;</span><br><span class="line">    <span class="keyword">using</span> difference_type = <span class="keyword">ptrdiff_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:  <span class="comment">// allocate and construct aux functions</span></span><br><span class="line">    <span class="keyword">using</span> data_allocator = Alloc;   <span class="comment">// Alloc = simpleAlloc&lt;T&gt;</span></span><br></pre></td></tr></table></figure><hr><h3 id="1-3-æ•°æ®æˆå‘˜"><a class="header-anchor" href="#1-3-æ•°æ®æˆå‘˜">Â¶</a>1.3 æ•°æ®æˆå‘˜</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span>:  <span class="comment">// data member</span></span><br><span class="line">    <span class="comment">// iterator to indicate the vector's memory location</span></span><br><span class="line">    <span class="comment">// ä¸€å…±æœ‰ä¸‰ä¸ªæ•°æ®æˆå‘˜ï¼Œè¿­ä»£å™¨ï¼Œ ä¸‰ä¸ªæŒ‡é’ˆ æ‰€ä»¥ sizeof(vector) --&gt; 12 bytes </span></span><br><span class="line">    iterator start;</span><br><span class="line">    iterator finish;</span><br><span class="line">    iterator end_of_storage;</span><br></pre></td></tr></table></figure><hr><h3 id="1-4-æˆå‘˜å‡½æ•°"><a class="header-anchor" href="#1-4-æˆå‘˜å‡½æ•°">Â¶</a>1.4 æˆå‘˜å‡½æ•°</h3><p>æˆå‘˜å‡½æ•°åˆ†ä¸ºä¸¤ç§ã€‚æ›´å¤šçš„ç»†èŠ‚è§ä¸‹æ–‡ã€‚</p><p><strong>å¯¹å¤–å¯è°ƒç”¨çš„æ¥å£å‡½æ•°</strong>ï¼ˆ <strong><font color="F08F00">public</font></strong> ï¼‰ï¼š</p><ul><li>æ„é€ å‡½æ•°ï¼Œææ„å‡½æ•°</li><li>æ‹·è´èµ‹å€¼è¿ç®—ç¬¦ï¼Œç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦</li><li>getter ï¼Œsetter</li><li>ä¿®æ”¹ size å’Œ capacity çš„æ¥å£</li><li>æ¯”è¾ƒè¿ç®—ç¬¦</li><li>push å’Œ pop æ“ä½œ</li><li>eraseï¼Œinsertï¼Œassign æ“ä½œ</li></ul><p>ç§æœ‰æˆå‘˜å‡½æ•°ï¼Œ<strong>å®ç°æ¥å£å‡½æ•°åŠŸèƒ½</strong>ï¼ˆ <strong><font color="F08F00">private</font></strong> ï¼‰</p><hr><h2 id="2-æˆå‘˜å‡½æ•°"><a class="header-anchor" href="#2-æˆå‘˜å‡½æ•°">Â¶</a>2. æˆå‘˜å‡½æ•°</h2><h3 id="2-1-æ„é€ å‡½æ•°ï¼Œææ„å‡½æ•°"><a class="header-anchor" href="#2-1-æ„é€ å‡½æ•°ï¼Œææ„å‡½æ•°">Â¶</a>2.1 æ„é€ å‡½æ•°ï¼Œææ„å‡½æ•°</h3><p>å‡½æ•°å£°æ˜æˆ–å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span>:  <span class="comment">// ctor &amp;&amp; dtor</span></span><br><span class="line">    <span class="built_in">vector</span>() : start(<span class="literal">nullptr</span>), finish(<span class="literal">nullptr</span>), end_of_storage(<span class="literal">nullptr</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ä¼ å…¥äº† value_type ç±»å‹çš„å¯¹è±¡ï¼Œé»˜è®¤å€¼æ˜¯value_typeå¯¹åº”çš„é»˜è®¤å€¼  </span></span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">vector</span><span class="params">(size_type n)</span> </span>&#123; fill_initialize(n, value_type()); &#125;          </span><br><span class="line">	<span class="built_in">vector</span>(size_type n, <span class="keyword">const</span> value_type &amp;value) &#123; fill_initialize(n, value); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="title">vector</span>(<span class="title">InputIterator</span> <span class="title">first</span>, <span class="title">InputIterator</span> <span class="title">last</span>) &#123;</span>                            </span><br><span class="line">        initialize_aux(first, last, <span class="keyword">_is_integer_t</span>&lt;InputIterator&gt;());  </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">vector</span>(<span class="built_in">std</span>::<span class="built_in">initializer_list</span>&lt;T&gt;);   <span class="comment">// vector&#123;....&#125; </span></span><br><span class="line">    <span class="built_in">vector</span>(<span class="keyword">const</span> <span class="built_in">vector</span> &amp;);             <span class="comment">// æ‹·è´æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">vector</span>(<span class="built_in">vector</span> &amp;&amp;) <span class="keyword">noexcept</span>;         <span class="comment">// ç§»åŠ¨æ„é€ å‡½æ•° </span></span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">vector</span>() &#123;                         <span class="comment">// ææ„å‡½æ•° </span></span><br><span class="line">        <span class="comment">// destory in "construct.h"</span></span><br><span class="line">        destroy(start, finish);         <span class="comment">// å…ˆå¯¹å¯¹è±¡ææ„</span></span><br><span class="line">        deallocate();                   <span class="comment">// åé‡Šæ”¾å†…å­˜ç©ºé—´</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><strong><font color="FF8888">æ³¨æ„</font></strong>ï¼š</p><p><code>è¡Œ: 5</code>ï¼Œä¼ å…¥å‚æ•°ä¸º <code>value_type()</code> æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæœ‰é»˜è®¤å€¼ã€‚</p><p><code>è¡Œ: 5,6</code>ï¼Œè°ƒç”¨ <code>fill_initialize()</code> å‡½æ•°åˆå§‹åŒ–ï¼Œå…¶å†…éƒ¨ä½¿ç”¨ <code>allocate_and_fill()</code> å‡½æ•°ã€‚</p><p><code>è¡Œ: 8-11</code>ï¼Œä¼ å…¥å‚æ•°æ˜¯ä¸¤ä¸ªè¿­ä»£å™¨ï¼Œä¼šè°ƒç”¨ <code>initialize_aux()</code>ï¼Œä¼šåˆ©ç”¨èƒå–æœºè·å¾—ç¬¬ä¸‰ä¸ªå‚æ•°ã€‚</p><p><code>è¡Œ: 12-13</code>ï¼Œéƒ½è°ƒç”¨äº† <code>allocate_and_copy()</code> å‡½æ•°ï¼ŒåŒ…å«åˆ†é…å†…å­˜å’Œ copy æ“ä½œã€‚</p><p><code>è¡Œ: 15</code>ï¼Œä½¿ç”¨äº†æµ…æ‹·è´ï¼Œå¹¶å°†ä¼ å…¥å¯¹è±¡æŒ‡é’ˆç½®ç©ºã€‚</p><hr><h4 id="fill-initialize"><a class="header-anchor" href="#fill-initialize">Â¶</a><code>fill_initialize()</code></h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fill_initialize</span><span class="params">(size_type n, <span class="keyword">const</span> value_type &amp;value)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è°ƒç”¨ allocate_and_fill å‡½æ•°ï¼Œå…ˆåˆ†é…å†…å­˜ï¼Œç„¶åè¿›è¡Œåˆå§‹åŒ–æ“ä½œ</span></span><br><span class="line">    start = allocate_and_fill(n, value);</span><br><span class="line">    <span class="comment">// ä¸º finish å’Œ end_of_storage èµ‹å€¼</span></span><br><span class="line">    finish = start + n;</span><br><span class="line">    end_of_storage = finish;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="allocate-and-fill"><a class="header-anchor" href="#allocate-and-fill">Â¶</a><code>allocate_and_fill()</code></h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">iterator <span class="title">allocate_and_fill</span><span class="params">(size_type n, <span class="keyword">const</span> value_type &amp;value)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è°ƒç”¨ allocated åˆ†é…å†…å­˜ï¼Œè¿”å›æŒ‡é’ˆ</span></span><br><span class="line">    iterator result = data_allocator::allocate(n);</span><br><span class="line">    <span class="comment">// å¯¹åˆ†é…çš„å†…å­˜è¿›è¡Œåˆå§‹åŒ–ï¼Œè°ƒç”¨ uninitialized_fill_n</span></span><br><span class="line">    MiniSTL::uninitialized_fill_n(result, n, value);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;  <span class="comment">// ä»¥ä¸Šä¸¤ä¸ªå‡½æ•°è§ Allocator</span></span><br></pre></td></tr></table></figure><hr><h4 id="initialize-aux"><a class="header-anchor" href="#initialize-aux">Â¶</a><code>initialize_aux()</code></h4><p><em>_true_type</em> å’Œ <em>_false_type</em> è§ <strong>Iterator</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// _true_type</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Integer</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="title">void</span> <span class="title">initialize_aux</span>(<span class="title">Integer</span> <span class="title">n</span>, <span class="title">Integer</span> <span class="title">val</span>, _<span class="title">true_type</span>) &#123;</span></span><br><span class="line">    fill_initialize(<span class="keyword">static_cast</span>&lt;size_type&gt;(n),</span><br><span class="line">                    <span class="keyword">static_cast</span>&lt;value_type&gt;(val)); <span class="comment">// è°ƒç”¨ fill_initialize</span></span><br><span class="line">&#125;												   <span class="comment">// å†…éƒ¨è°ƒç”¨ allocate_and_fill</span></span><br><span class="line"><span class="comment">// _false_type</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="title">void</span> <span class="title">initialize_aux</span>(<span class="title">InputIterator</span> <span class="title">first</span>, <span class="title">InputIterator</span> <span class="title">last</span>, _<span class="title">false_type</span>) &#123;</span></span><br><span class="line">    start = allocate_and_copy(first, last);  <span class="comment">// è°ƒç”¨ allocate_and_copy</span></span><br><span class="line">    finish = end_of_storage = start + MiniSTL::distance(first, last);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="allocate-and-copy"><a class="header-anchor" href="#allocate-and-copy">Â¶</a><code>allocate_and_copy()</code></h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator</span>&gt;  /* åˆ†é…å†…å­˜å¹¶æ‹·è´å¯¹åº”åˆ†ä¸ºå†…çš„å€¼ï¼Œè¿”å›å¤´è¿­ä»£å™¨ */</span></span><br><span class="line"><span class="class">    <span class="title">iterator</span> <span class="title">allocate_and_copy</span>(<span class="title">InputIterator</span> <span class="title">first</span>, <span class="title">InputIterator</span> <span class="title">last</span>) &#123;</span></span><br><span class="line">    size_type n = MiniSTL::distance(first, last);</span><br><span class="line">    iterator result = data_allocator::allocate(n);</span><br><span class="line">    MiniSTL::uninitialized_copy(first, last, result);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><font color="FF8888">æ³¨æ„</font></strong>ï¼š</p><p><em>_true_type</em> ä»£è¡¨äº†æ¥å—çš„ä¸º <em><strong>int</strong></em>ï¼Œ<em>_false_type</em> ä»£è¡¨äº†æ¥å—çš„æ˜¯<strong>è¿­ä»£å™¨</strong>ã€‚å†…éƒ¨åˆ†åˆ«å¯¹åº”äº†ä½¿ç”¨ <code>uninitialized_fill_n()</code> è¿˜æ˜¯ <code>uninitialized_copy()</code>ã€‚</p><hr><h4 id="vector-const-vector"><a class="header-anchor" href="#vector-const-vector">Â¶</a><code>vector(const vector &amp;)</code></h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Alloc</span>&gt; /* æ‹·è´æ„é€ å‡½æ•° */</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">vector</span>&lt;T, Alloc&gt;:</span>:<span class="built_in">vector</span>(<span class="keyword">const</span> <span class="built_in">vector</span> &amp;rhs) &#123;</span><br><span class="line">    start = allocate_and_copy(rhs.<span class="built_in">begin</span>(), rhs.<span class="built_in">end</span>());</span><br><span class="line">    <span class="comment">/* å¯ä»¥å‘ç°æ‹·è´æ„é€ å‡½æ•°åªæ˜¯åˆ†é…æ‹·è´å…ƒç´ çš„å†…å­˜ï¼Œfinish == end_of_storage </span></span><br><span class="line"><span class="comment">       è¿™ä¹Ÿå°±è§£é‡Šäº† shrink_to_fit å‡½æ•°çš„å®ç° */</span></span><br><span class="line">    finish = end_of_storage = start + rhs.<span class="built_in">size</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="vector-std-initializer-list-T"><a class="header-anchor" href="#vector-std-initializer-list-T">Â¶</a><code>vector(std::initializer_list&lt;T&gt;)</code></h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Alloc</span>&gt; /* æ‹·è´æ„é€ å‡½æ•°ï¼ˆåˆå§‹åŒ–é“¾è¡¨ï¼‰*/</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">vector</span>&lt;T, Alloc&gt;:</span>:<span class="built_in">vector</span>(<span class="built_in">std</span>::<span class="built_in">initializer_list</span>&lt;T&gt; il) &#123;</span><br><span class="line">    start = allocate_and_copy(il.<span class="built_in">begin</span>(), il.<span class="built_in">end</span>());</span><br><span class="line">    finish = end_of_storage = start + il.<span class="built_in">size</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="vector-vector-noexcept"><a class="header-anchor" href="#vector-vector-noexcept">Â¶</a><code>vector(vector &amp;&amp;) noexcept</code></h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Alloc</span>&gt; /* ç§»åŠ¨æ„é€ å‡½æ•° */</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">vector</span>&lt;T, Alloc&gt;:</span>:<span class="built_in">vector</span>(<span class="built_in">vector</span> &amp;&amp;rhs) <span class="keyword">noexcept</span> &#123;</span><br><span class="line">    <span class="comment">/* äº¤æ¢æŒ‡é’ˆ, æµ…æ‹·è´ */</span></span><br><span class="line">    start = rhs.start;</span><br><span class="line">    finish = rhs.finish;</span><br><span class="line">    end_of_storage = rhs.end_of_storage;</span><br><span class="line">    <span class="comment">/* åŸæŒ‡é’ˆç½®ç©º */</span></span><br><span class="line">    rhs.start = rhs.finish = rhs.end_of_storage = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="2-2-æ‹·è´èµ‹å€¼è¿ç®—ç¬¦ï¼Œç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦"><a class="header-anchor" href="#2-2-æ‹·è´èµ‹å€¼è¿ç®—ç¬¦ï¼Œç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦">Â¶</a>2.2 æ‹·è´èµ‹å€¼è¿ç®—ç¬¦ï¼Œç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦</h3><h4 id="vector-operator-const-vector"><a class="header-anchor" href="#vector-operator-const-vector">Â¶</a><code>vector &amp;operator=(const vector &amp;)</code></h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Alloc</span>&gt; /* æ‹·è´èµ‹å€¼è¿ç®—ç¬¦ */</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">vector</span>&lt;T, Alloc&gt; &amp;<span class="title">vector</span>&lt;T, Alloc&gt;:</span>:<span class="keyword">operator</span>=(<span class="keyword">const</span> <span class="built_in">vector</span> &amp;rhs) &#123;</span><br><span class="line">    <span class="built_in">vector</span> temp(rhs); <span class="comment">/* å†…éƒ¨è°ƒç”¨æ‹·è´æ„é€ å‡½æ•° */</span></span><br><span class="line">    swap(temp);</span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="vector-operator-vector-noexcept"><a class="header-anchor" href="#vector-operator-vector-noexcept">Â¶</a><code>vector &amp;operator=(vector &amp;&amp;) noexcept</code></h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Alloc</span>&gt; /* ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦ */</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">vector</span>&lt;T, Alloc&gt; &amp;<span class="title">vector</span>&lt;T, Alloc&gt;:</span>:<span class="keyword">operator</span>=(<span class="built_in">vector</span> &amp;&amp;rhs) <span class="keyword">noexcept</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span> != &amp;rhs) &#123; <span class="comment">/* è‡ªèµ‹å€¼çš„åˆ¤æ–­ */</span></span><br><span class="line">        destroy_and_deallocate(); <span class="comment">/* å…ˆææ„é‡Šæ”¾åŸå†…å­˜ */</span></span><br><span class="line">        <span class="comment">/* æµ…æ‹·è´ */</span></span><br><span class="line">        start = rhs.start;</span><br><span class="line">        finish = rhs.finish;</span><br><span class="line">        end_of_storage = rhs.end_of_storage;</span><br><span class="line">        <span class="comment">/* å°† rhs æŒ‡é’ˆç½® nullptr */</span></span><br><span class="line">        rhs.start = rhs.finish = rhs.end_of_storage = <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><font color="FF8888">æ³¨æ„</font></strong>ï¼šç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦éœ€è¦è€ƒè™‘è‡ªèµ‹å€¼ï¼</p><hr><h3 id="2-3-getter"><a class="header-anchor" href="#2-3-getter">Â¶</a>2.3 getter</h3><p>ä¸»è¦ç”¨æ¥è·å– vector çš„ä¸€äº›æ•°æ®ï¼Œçš†æ˜¯ const ç±»å‹æˆå‘˜å‡½æ•°ã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span>:  <span class="comment">// getter</span></span><br><span class="line">    <span class="function">const_iterator <span class="title">begin</span><span class="params">()</span> <span class="keyword">const</span> <span class="keyword">noexcept</span> </span>&#123; <span class="keyword">return</span> start; &#125;  </span><br><span class="line">    <span class="function">const_iterator <span class="title">end</span><span class="params">()</span> <span class="keyword">const</span> <span class="keyword">noexcept</span> </span>&#123; <span class="keyword">return</span> finish; &#125;</span><br><span class="line">    <span class="function">const_iterator <span class="title">cbegin</span><span class="params">()</span> <span class="keyword">const</span> <span class="keyword">noexcept</span> </span>&#123; <span class="keyword">return</span> start; &#125; </span><br><span class="line">    <span class="function">const_iterator <span class="title">cend</span><span class="params">()</span> <span class="keyword">const</span> <span class="keyword">noexcept</span> </span>&#123; <span class="keyword">return</span> finish; &#125;</span><br><span class="line">    <span class="function">const_reverse_iterator <span class="title">crbegin</span><span class="params">()</span> <span class="keyword">const</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> const_reverse_iterator(finish);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">const_reverse_iterator <span class="title">crend</span><span class="params">()</span> <span class="keyword">const</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> const_reverse_iterator(start);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span></span></span><br><span class="line">    <span class="comment">// have no empty check</span></span><br><span class="line">    <span class="function">const_reference <span class="title">front</span><span class="params">()</span> <span class="keyword">const</span> <span class="keyword">noexcept</span> </span>&#123; <span class="keyword">return</span> *<span class="built_in">begin</span>(); &#125;</span><br><span class="line">    <span class="function">const_reference <span class="title">back</span><span class="params">()</span> <span class="keyword">const</span> <span class="keyword">noexcept</span> </span>&#123; <span class="keyword">return</span> *(<span class="built_in">end</span>() - <span class="number">1</span>); &#125;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span></span></span><br><span class="line">    <span class="comment">// have no boundary check and don't use proxy</span></span><br><span class="line">    const_reference <span class="keyword">operator</span>[](<span class="keyword">const</span> size_type n) <span class="keyword">const</span> <span class="keyword">noexcept</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> *(start + n);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">size_type <span class="title">size</span><span class="params">()</span> <span class="keyword">const</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">static_cast</span>&lt;size_type&gt;(finish - start);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">size_type <span class="title">capacity</span><span class="params">()</span> <span class="keyword">const</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">static_cast</span>&lt;size_type&gt;(end_of_storage - start);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">empty</span><span class="params">()</span> <span class="keyword">const</span> <span class="keyword">noexcept</span> </span>&#123; <span class="keyword">return</span> start == finish; &#125;</span><br></pre></td></tr></table></figure><hr><h3 id="2-4-setter"><a class="header-anchor" href="#2-4-setter">Â¶</a>2.4 setter</h3><p>ä¸ <strong>getter</strong> ç›¸å‘¼åº”ï¼Œæä¾›ä¸€äº›ç”¨æˆ·å¯ä»¥è·å–å¹¶ä¿®æ”¹å‚æ•°çš„æ¥å£ã€‚</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span>:  <span class="comment">// setter</span></span><br><span class="line">    <span class="function">iterator <span class="title">begin</span><span class="params">()</span> <span class="keyword">noexcept</span> </span>&#123; <span class="keyword">return</span> start; &#125;</span><br><span class="line">    <span class="function">iterator <span class="title">end</span><span class="params">()</span> <span class="keyword">noexcept</span> </span>&#123; <span class="keyword">return</span> finish; &#125;</span><br><span class="line">    <span class="function">reverse_iterator <span class="title">rbegin</span><span class="params">()</span> <span class="keyword">noexcept</span> </span>&#123; <span class="keyword">return</span> reverse_iterator(finish); &#125;</span><br><span class="line">    <span class="function">reverse_iterator <span class="title">rend</span><span class="params">()</span> <span class="keyword">noexcept</span> </span>&#123; <span class="keyword">return</span> reverse_iterator(start); &#125;</span><br><span class="line">    reference <span class="keyword">operator</span>[](<span class="keyword">const</span> size_type n) <span class="keyword">noexcept</span> &#123; <span class="keyword">return</span> *(start + n); &#125;</span><br><span class="line">    <span class="function">reference <span class="title">front</span><span class="params">()</span> <span class="keyword">noexcept</span> </span>&#123; <span class="keyword">return</span> *<span class="built_in">begin</span>(); &#125;</span><br><span class="line">    <span class="function">reference <span class="title">back</span><span class="params">()</span> <span class="keyword">noexcept</span> </span>&#123; <span class="keyword">return</span> *(<span class="built_in">end</span>() - <span class="number">1</span>); &#125;</span><br></pre></td></tr></table></figure><hr><h3 id="2-5-ä¿®æ”¹-size-å’Œ-capacity-çš„æ¥å£"><a class="header-anchor" href="#2-5-ä¿®æ”¹-size-å’Œ-capacity-çš„æ¥å£">Â¶</a>2.5 ä¿®æ”¹ size å’Œ capacity çš„æ¥å£</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span>:  <span class="comment">// interface for size and capacity</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">resize</span><span class="params">(size_type, <span class="keyword">const</span> value_type &amp;)</span></span>; <span class="comment">/* ä¿®æ”¹ size */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">resize</span><span class="params">(size_type new_size)</span> </span>&#123; resize(new_size, value_type()); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">reserve</span><span class="params">(size_type)</span></span>;                    <span class="comment">/* ä¿®æ”¹ capacity */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">shrink_to_fit</span><span class="params">()</span> <span class="keyword">noexcept</span> </span>&#123;             <span class="comment">/* å°†æœ€å¤§å®¹é‡å‡å°‘åˆ°å®ƒæ‰€éœ€è¦çš„å®¹é‡ */</span></span><br><span class="line">        <span class="function"><span class="built_in">vector</span> <span class="title">temp</span><span class="params">(*<span class="keyword">this</span>)</span></span>;  <span class="comment">/* è°ƒç”¨æ‹·è´æ„é€ å‡½æ•°ï¼Œæ³¨æ„æ‹·è´æ„é€ å‡½æ•°åªåˆ†é…æ‹·è´çš„å…ƒç´ æ‰€éœ€çš„å†…å­˜</span></span><br><span class="line"><span class="comment">                                æ‰€ä»¥æ­¤æ—¶ finish == end_of_storage */</span></span><br><span class="line">        swap(temp); <span class="comment">/* äº¤æ¢æ•°æ® */</span></span><br><span class="line">    &#125; <span class="comment">/* temp åœ¨ç¦»å¼€ä½œç”¨åŸŸåè‡ªåŠ¨ææ„é‡Šæ”¾ */</span></span><br></pre></td></tr></table></figure><p><strong><font color="FF8888">æ³¨æ„</font></strong>ï¼š</p><p><code>è¡Œ: 3</code>ï¼Œåˆ©ç”¨ <code>value_type()</code> è°ƒç”¨ <code>resize(n, val)</code> ç‰ˆæœ¬é‡è½½ã€‚</p><p><code>è¡Œ: 5-9</code>ï¼Œ<code>shrink_to_fit()</code> ä¸»è¦åˆ©ç”¨æ‹·è´æ„é€ å‡½æ•°æ¥å®ç°ã€‚</p><blockquote><p><a href="https://blog.csdn.net/baidu_35679960/article/details/78900332" target="_blank" rel="noopener">C++ shrink_to_fit() çš„å®ç°</a></p></blockquote><hr><h4 id="void-resize-size-type-const-value-type"><a class="header-anchor" href="#void-resize-size-type-const-value-type">Â¶</a><code>void resize(size_type, const value_type &amp;)</code></h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Alloc</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">void</span> <span class="title">vector</span>&lt;T, Alloc&gt;:</span>:resize(size_type new_size, <span class="keyword">const</span> value_type &amp;value) &#123;</span><br><span class="line">    <span class="comment">/* å¦‚æœ new_size å°äºå½“å‰ size ç›´æ¥ erase å¤šä½™çš„å³å¯*/</span></span><br><span class="line">    <span class="keyword">if</span> (new_size &lt; <span class="built_in">size</span>())</span><br><span class="line">        erase(<span class="built_in">begin</span>() + new_size, <span class="built_in">end</span>());</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    <span class="comment">/* å¦åˆ™åœ¨åé¢å¡«å…… value åˆ°æŒ‡å®š size å³å¯ï¼Œè°ƒç”¨ fill_insert å‡½æ•° */</span></span><br><span class="line">        fill_insert(<span class="built_in">end</span>(), new_size - <span class="built_in">size</span>(), value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><font color="FF8888">æ³¨æ„</font></strong>ï¼šå†…éƒ¨å¯èƒ½è°ƒç”¨ <code>erase()</code> ï¼Œ<code>fill_insert()</code> ï¼Œè§ä¸‹æ–‡ã€‚</p><hr><h4 id="void-reserve-size-type"><a class="header-anchor" href="#void-reserve-size-type">Â¶</a><code>void reserve(size_type)</code></h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Alloc</span>&gt; </span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">void</span> <span class="title">vector</span>&lt;T, Alloc&gt;:</span>:reserve(size_type new_capacity) &#123;</span><br><span class="line">    <span class="comment">/* å¦‚æœä¿®æ”¹æˆæ›´å°å€¼ï¼Œå°±ä»€ä¹ˆéƒ½ä¸æ“ä½œ */</span></span><br><span class="line">    <span class="keyword">if</span> (new_capacity &lt;= capacity()) <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">/* å¦åˆ™åˆ†é…ä¸€ä¸ª new_capacity çš„å†…å­˜ï¼Œå¹¶å°†å½“å‰å¯¹è±¡éƒ½æ‹·è´è¿‡å»ï¼Œå¹¶ææ„é‡Šæ”¾å½“å‰å¯¹è±¡ */</span></span><br><span class="line">    T *new_start = data_allocator::allocate(new_capacity);</span><br><span class="line">    T *new_finish = MiniSTL::uninitialized_copy(start, finish, new_start);</span><br><span class="line">    destroy_and_deallocate(); <span class="comment">// åŒ…å« destroy, deallocate ç­‰æ“ä½œ</span></span><br><span class="line">    start = new_start;</span><br><span class="line">    finish = new_finish;</span><br><span class="line">    end_of_storage = start + new_capacity;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><font color="FF8888">æ³¨æ„</font></strong>ï¼šå¦‚æœä¿®æ”¹æˆæ›´å°å€¼ï¼Œä»€ä¹ˆéƒ½ä¸æ“ä½œï¼Œå¦åˆ™é‡æ–°åˆ†é…å†…å­˜ï¼Œå¹¶æ‹·è´è¿‡å»ï¼Œé‡Šæ”¾å°±å¯¹è±¡ã€‚</p><hr><h3 id="2-6-æ¯”è¾ƒè¿ç®—ç¬¦"><a class="header-anchor" href="#2-6-æ¯”è¾ƒè¿ç®—ç¬¦">Â¶</a>2.6 æ¯”è¾ƒè¿ç®—ç¬¦</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span>:  <span class="comment">// compare operator(member function)</span></span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>==(<span class="keyword">const</span> <span class="built_in">vector</span> &amp;) <span class="keyword">const</span> <span class="keyword">noexcept</span>;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>!=(<span class="keyword">const</span> <span class="built_in">vector</span> &amp;rhs) <span class="keyword">const</span> <span class="keyword">noexcept</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> !(*<span class="keyword">this</span> == rhs); <span class="comment">/* è°ƒç”¨ == æ“ä½œç¬¦ */</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><strong><font color="FF8888">æ³¨æ„</font></strong>ï¼š<code>è¡Œ: 3-5</code>ï¼Œå¯ä»¥å‘ç°ä¸ç­‰äºæ“ä½œæ˜¯åŸºäºç­‰äºæ“ä½œå®ç°çš„ã€‚</p><hr><h4 id="bool-operator-const-vector-const-noexcept"><a class="header-anchor" href="#bool-operator-const-vector-const-noexcept">Â¶</a><code>bool operator==(const vector &amp;) const noexcept</code></h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Alloc</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">bool</span> <span class="title">vector</span>&lt;T, Alloc&gt;:</span>:<span class="keyword">operator</span>==(<span class="keyword">const</span> <span class="built_in">vector</span> &amp;rhs) <span class="keyword">const</span> <span class="keyword">noexcept</span> &#123;</span><br><span class="line">    <span class="comment">/* å¦‚æœ size ä¸åŒï¼Œç›´æ¥è¿”å› false */</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">size</span>() != rhs.<span class="built_in">size</span>()) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        iterator ptr1 = start;</span><br><span class="line">        iterator ptr2 = rhs.start;</span><br><span class="line">        <span class="comment">/* åŒæ—¶éå†ï¼Œåªè¦æœ‰ä¸€ä¸ªå…ƒç´ å€¼ä¸ç›¸åŒå°±ç›´æ¥è¿”å› false */</span></span><br><span class="line">        <span class="keyword">for</span> (; ptr1 != finish &amp;&amp; ptr2 != rhs.finish; ++ptr1, ++ptr2)</span><br><span class="line">            <span class="keyword">if</span> (*ptr1 != *ptr2) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="2-7-push-back-å’Œ-pop-back"><a class="header-anchor" href="#2-7-push-back-å’Œ-pop-back">Â¶</a>2.7 push_back() å’Œ pop_back()</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span>:  <span class="comment">// push &amp;&amp; pop</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">push_back</span><span class="params">(<span class="keyword">const</span> value_type &amp;)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pop_back</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        --finish;        <span class="comment">/* å…ˆ finish-- ï¼Œä¸ºä¹‹å‰ end() å‰é¢æŒ‡å‘çš„å¯¹è±¡ï¼Œä¹Ÿå³æ˜¯æœ€åçš„å…ƒç´ */</span></span><br><span class="line">        destroy(finish); <span class="comment">/* ç„¶åææ„ finish å¤„å¯¹è±¡ï¼Œä¸æ˜¯æ”¾å†…å­˜ */</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><strong><font color="FF8888">æ³¨æ„</font></strong>ï¼š<code>è¡Œ: 2-6</code>ï¼Œ<code>pop_back()</code> æ“ä½œå…ˆ <code>finish--</code>ï¼Œæ‰å¯ä»¥å¯¹ <code>finish</code> ææ„ã€‚</p><hr><h4 id="void-push-back-const-value-type"><a class="header-anchor" href="#void-push-back-const-value-type">Â¶</a><code>void push_back(const value_type &amp;)</code></h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Alloc</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">void</span> <span class="title">vector</span>&lt;T, Alloc&gt;:</span>:push_back(<span class="keyword">const</span> value_type &amp;value) &#123;</span><br><span class="line">    <span class="comment">/* capacity è¶³å¤Ÿï¼Œç›´æ¥åœ¨å°¾ç«¯ä½¿ç”¨æ„é€ å‡½æ•°å³å¯ */</span></span><br><span class="line">    <span class="keyword">if</span> (finish != end_of_storage) &#123;</span><br><span class="line">        construct(finish, value);</span><br><span class="line">        ++finish;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦åˆ™ä½¿ç”¨ insert_aux æ¥å£ï¼Œå†…éƒ¨åŒ…å«é‡æ–°åˆ†é…å†…å­˜....</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        insert_aux(<span class="built_in">end</span>(), value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><font color="FF8888">æ³¨æ„</font></strong>ï¼šå†…éƒ¨å¯èƒ½è°ƒç”¨ <code>insert_aux()</code> ï¼Œè§ä¸‹æ–‡ã€‚</p><hr><h3 id="2-8-erase-æ“ä½œ"><a class="header-anchor" href="#2-8-erase-æ“ä½œ">Â¶</a>2.8 erase æ“ä½œ</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span>:  <span class="comment">// erase</span></span><br><span class="line">    <span class="function">iterator <span class="title">erase</span><span class="params">(iterator, iterator)</span></span>; <span class="comment">/* åˆ é™¤ä¸€ä¸² */</span></span><br><span class="line">    <span class="function">iterator <span class="title">erase</span><span class="params">(iterator <span class="built_in">position</span>)</span> </span>&#123; <span class="comment">/* åˆ é™¤ä¸€ä¸ªï¼Œå†…éƒ¨è°ƒç”¨å‰è€… */</span></span><br><span class="line">        <span class="keyword">return</span> erase(<span class="built_in">position</span>, <span class="built_in">position</span> + <span class="number">1</span>); </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123; erase(<span class="built_in">begin</span>(), <span class="built_in">end</span>()); &#125; <span class="comment">/* å…¨åˆ  */</span></span><br></pre></td></tr></table></figure><p><strong><font color="FF8888">æ³¨æ„</font></strong>ï¼š<code>è¡Œ: 3-5,6</code>ï¼Œå†…éƒ¨è°ƒç”¨ <code>iterator erase(iterator, iterator)</code></p><hr><h4 id="iterator-erase-iterator-iterator"><a class="header-anchor" href="#iterator-erase-iterator-iterator">Â¶</a><code>iterator erase(iterator, iterator)</code></h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Alloc</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">typename</span> <span class="title">vector</span>&lt;T, Alloc&gt;:</span>:iterator <span class="comment">// è¿”å›å€¼</span></span><br><span class="line">    <span class="built_in">vector</span>&lt;T, Alloc&gt;::erase(iterator first, iterator last) &#123;</span><br><span class="line">    <span class="comment">/* å°† [last, finish) æ•°æ®æ‹·è´åˆ° [first, first + (finish - last)) </span></span><br><span class="line"><span class="comment">       å¹¶è¿”å› new_finish --&gt; i */</span></span><br><span class="line">    iterator i = MiniSTL::copy(last, finish, first);</span><br><span class="line">    <span class="comment">/* ææ„ [i, finish) */</span></span><br><span class="line">    destroy(i, finish);</span><br><span class="line">    <span class="comment">/* æ›´æ–° finish */</span></span><br><span class="line">    finish -= (last - first);</span><br><span class="line">    <span class="comment">/* è¿”å›çš„æ˜¯ first è¿™ä¸ª åŸ last åä¸€ä¸ªå…ƒç´ */</span></span><br><span class="line">    <span class="keyword">return</span> first;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ›´ç›´è§‚è§ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="/C++_Language/STL/vector/erase.png" style="zoom:50%"><center><strong>å›¾ 1</strong> å±€éƒ¨åŒºé—´çš„æ¸…æ¥šæ“ä½œ</center><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P123 - P124</p></blockquote><hr><h3 id="2-9-insert-æ“ä½œ"><a class="header-anchor" href="#2-9-insert-æ“ä½œ">Â¶</a>2.9 insert æ“ä½œ</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span>:  <span class="comment">// insert</span></span><br><span class="line">    <span class="function">iterator <span class="title">insert</span><span class="params">(iterator)</span></span>;                      <span class="comment">/* å†…éƒ¨è°ƒç”¨ insert */</span></span><br><span class="line">    <span class="function">iterator <span class="title">insert</span><span class="params">(iterator, <span class="keyword">const</span> value_type &amp;)</span></span>;  <span class="comment">/* å†…éƒ¨å¯èƒ½è°ƒç”¨ insert_aux */</span></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator</span>&gt; 					</span></span><br><span class="line"><span class="class">    <span class="title">void</span> <span class="title">insert</span>(<span class="title">iterator</span> <span class="title">pos</span>, <span class="title">InputIterator</span> <span class="title">first</span>, <span class="title">InputIterator</span> <span class="title">last</span>) &#123;</span></span><br><span class="line">        insert_dispatch(pos, first, last, <span class="keyword">_is_integer_t</span>&lt;InputIterator&gt;()); </span><br><span class="line">        <span class="comment">/* å†…éƒ¨è°ƒç”¨ fill_insert */</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><strong><font color="FF8888">æ³¨æ„</font></strong>ï¼š</p><p><code>è¡Œ: 2</code>ï¼Œå†…éƒ¨è°ƒç”¨ <code>iterator insert(iterator, const value_type &amp;);</code></p><p><code>è¡Œ: 5-8</code>ï¼Œä¼ å…¥å‚æ•°æ˜¯ä¸‰ä¸ªè¿­ä»£å™¨ï¼Œå†…éƒ¨è°ƒç”¨ <code>insert_dispatch()</code>ï¼Œä¼šåˆ©ç”¨èƒå–æœºè·å¾—ç¬¬å››ä¸ªå‚æ•°ã€‚</p><hr><h4 id="iterator-insert-iterator-const-value-type"><a class="header-anchor" href="#iterator-insert-iterator-const-value-type">Â¶</a><code>iterator insert(iterator, const value_type &amp;)</code></h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Alloc</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">typename</span> <span class="title">vector</span>&lt;T, Alloc&gt;:</span>:iterator </span><br><span class="line"><span class="built_in">vector</span>&lt;T, Alloc&gt;::insert(iterator <span class="built_in">position</span>, <span class="keyword">const</span> value_type &amp;value) &#123;</span><br><span class="line">    size_type n = <span class="built_in">position</span> - <span class="built_in">begin</span>();  <span class="comment">/* position ä»¥åŠä¹‹åçš„è¿­ä»£å™¨å¤±æ•ˆ */</span></span><br><span class="line">    <span class="comment">/* å¦‚æœæ’å…¥ä½ç½®æ˜¯é˜Ÿå°¾ï¼Œå¹¶ä¸”è¿˜æœ‰å†…å­˜ç©ºé—´ï¼Œ</span></span><br><span class="line"><span class="comment">       åˆ™ä¼šåœ¨é˜Ÿå°¾ç›´æ¥ä½¿ç”¨æ„é€ å‡½æ•°æ¥å®Œæˆæ’å…¥æ“ä½œ*/</span></span><br><span class="line">    <span class="keyword">if</span> (finish != end_of_storage &amp;&amp; <span class="built_in">position</span> == <span class="built_in">end</span>()) &#123;</span><br><span class="line">        construct(finish, value);</span><br><span class="line">        ++finish;</span><br><span class="line">    &#125; <span class="keyword">else</span></span><br><span class="line">        <span class="comment">/* åœ¨é˜Ÿä¸­è°ƒç”¨ insert_aux å‡½æ•°*/</span></span><br><span class="line">        insert_aux(<span class="built_in">position</span>, value); </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">begin</span>() + n;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="void-insert-aux-iterator-const-value-type"><a class="header-anchor" href="#void-insert-aux-iterator-const-value-type">Â¶</a><code>void insert_aux(iterator, const value_type &amp;)</code></h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Alloc</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">void</span> <span class="title">vector</span>&lt;T, Alloc&gt;:</span>:insert_aux(iterator <span class="built_in">position</span>, <span class="keyword">const</span> value_type &amp;value) &#123;</span><br><span class="line">    <span class="keyword">if</span> (finish != end_of_storage) &#123;  		<span class="comment">/* ä¸éœ€è¦æ‰©å±• */</span></span><br><span class="line">        construct(finish, *(finish - <span class="number">1</span>));  	<span class="comment">/* ä»¥å½“å‰å°¾ç«¯å…ƒç´ æ„é€ ä¸€ä¸ªæ–°å°¾ç«¯ */</span></span><br><span class="line">        ++finish;</span><br><span class="line">        value_type value_copy = value;    	<span class="comment">/* ä¿å­˜éœ€è¦æ’å…¥çš„ value */</span></span><br><span class="line">        MiniSTL::copy_backward(<span class="built_in">position</span>, finish - <span class="number">2</span>, finish - <span class="number">1</span>); </span><br><span class="line">        <span class="comment">/* å°† [position, finish - 2] å¤„çš„å†…å­˜ç§»åŠ¨åˆ° ä»¥ finish - 1 ä¸ºå°¾éƒ¨çš„åŒºåŸŸ */</span></span><br><span class="line">        *<span class="built_in">position</span> = value_copy;    <span class="comment">/* ä¿®æ”¹ position æŒ‡å‘æ•°æ®å³å¯ */</span>                   </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;  <span class="comment">// expand</span></span><br><span class="line">        <span class="keyword">const</span> size_type old_size = <span class="built_in">size</span>(); <span class="comment">/* æ­¤æ—¶ finish = end_of_storage </span></span><br><span class="line"><span class="comment">                                              size() = capacity */</span></span><br><span class="line">        <span class="comment">/* ä¸‰å…ƒè¿ç®—ç¬¦ï¼Œå¦‚æœ old_size != 0 new_size æ‰©å±•ä¸¤å€ï¼Œå¦åˆ™ new_size = 1 */</span></span><br><span class="line">        <span class="keyword">const</span> size_type new_size = old_size ? <span class="number">2</span> * old_size : <span class="number">1</span>;  </span><br><span class="line">        iterator new_start = data_allocator::allocate(new_size);  <span class="comment">/* åˆ†é…å†…å­˜ */</span></span><br><span class="line">        iterator new_finish = new_start;  <span class="comment">/* å¹¶åˆå§‹åŒ– new_start, new_finish */</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">/* å…ˆå°† position å‰é¢çš„æ•°æ®æ‹·è´åˆ°æ–°å†…å­˜ï¼Œè¿”å›çš„å…¶å®æ˜¯ position è¿­ä»£å™¨*/</span></span><br><span class="line">            new_finish = MiniSTL::uninitialized_copy(start, <span class="built_in">position</span>, new_start); </span><br><span class="line">            construct(new_finish, value); <span class="comment">/* ä»¥ value åœ¨è¿”å›è¿­ä»£å™¨å¤„ï¼Œè°ƒç”¨æ„é€ å‡½æ•° */</span></span><br><span class="line">            ++new_finish;</span><br><span class="line">            <span class="comment">/* æœ€åæŠŠåŸ position ä»¥åŠå…¶åçš„å…ƒç´ æ‹·è´åˆ° new_finish ä¹‹å */</span></span><br><span class="line">            new_finish = MiniSTL::uninitialized_copy(<span class="built_in">position</span>, finish, new_finish); </span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="built_in">std</span>::exception &amp;) &#123;</span><br><span class="line">            <span class="comment">// commit or rollback</span></span><br><span class="line">            <span class="comment">/* å¦‚æœæ„é€ å¤±è´¥ï¼Œå›æ»šï¼Œå¹¶æŠ›å‡ºå¼‚å¸¸ */</span></span><br><span class="line">            destroy(new_start, new_finish);</span><br><span class="line">            data_allocator::deallocate(new_start, new_size);</span><br><span class="line">            <span class="keyword">throw</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/* å¯¹åŸæ¥çš„å†…å­˜è¿›è¡Œææ„å’Œé‡Šæ”¾å†…å­˜ */</span></span><br><span class="line">        destroy_and_deallocate();</span><br><span class="line">        <span class="comment">/* vector æ•°æ®æˆå‘˜æ›´æ–°ä¸ºæ–°çš„å€¼ */</span></span><br><span class="line">        start = new_start;</span><br><span class="line">        finish = new_finish;</span><br><span class="line">        end_of_storage = new_start + new_size;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¥å‡½æ•°å®ç°ï¼Œæ’å…¥ä¸€ä¸ªæ•°ã€‚å…·ä½“çš„å®ç°è§æ³¨é‡Šã€‚</p><hr><h4 id="insert-dispatch"><a class="header-anchor" href="#insert-dispatch">Â¶</a><code>insert_dispatch()</code></h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* _true_type å‹åˆ«ï¼Œä½¿ç”¨ fill_insert */</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Integer</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="title">void</span> <span class="title">insert_dispatch</span>(<span class="title">iterator</span> <span class="title">pos</span>, <span class="title">Integer</span> <span class="title">n</span>, <span class="title">Integer</span> <span class="title">value</span>, _<span class="title">true_type</span>) &#123;</span>     </span><br><span class="line">    fill_insert(pos, <span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(n), value_type(value));</span><br><span class="line">&#125;</span><br><span class="line"> <span class="comment">/* _false_type å‹åˆ«,ä½¿ç”¨ range_insert */</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="title">void</span> <span class="title">insert_dispatch</span>(<span class="title">iterator</span> <span class="title">pos</span>, <span class="title">InputIterator</span> <span class="title">first</span>, <span class="title">InputIterator</span> <span class="title">last</span>,     </span></span><br><span class="line"><span class="class">                         _<span class="title">false_type</span>) &#123;</span></span><br><span class="line">    range_insert(pos, first, last, <span class="keyword">iterator_category_t</span>&lt;InputIterator&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸å‰æ–‡ç›¸åŒï¼Œ<em>_true_type</em> ä¸»è¦é’ˆå¯¹ <em><strong>int</strong></em>ï¼Œ<em>_false_type</em> ä¸»è¦é’ˆå¯¹<strong>è¿­ä»£å™¨</strong>ï¼Œåˆ†åˆ«é‡‡ç”¨ <code>fill_insert()</code> å’Œ <code>range_insert()</code>ã€‚è€Œåè€…ä¼šåˆ©ç”¨åˆ°<strong>èƒå–æœº</strong>æ¨å¯¼ç¬¬å››ä¸ªå‚æ•°ã€‚</p><p><strong><code>fill_insert()</code></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Alloc</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">void</span> <span class="title">vector</span>&lt;T, Alloc&gt;:</span>:fill_insert(iterator <span class="built_in">position</span>, size_type n, <span class="keyword">const</span> value_type &amp;value) &#123;</span><br><span class="line">    <span class="keyword">if</span> (n) &#123;  </span><br><span class="line">        <span class="comment">// needn't expand</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">static_cast</span>&lt;size_type&gt;(end_of_storage - finish) &gt;=  n) &#123;  </span><br><span class="line">            value_type value_copy = value;  <span class="comment">/* ä¿å­˜éœ€è¦æ’å…¥çš„å€¼ */</span></span><br><span class="line">            <span class="comment">/* æ±‚å‡ºæ’å…¥ä½ç½®åŠå…¶åé¢æœ‰å¤šå°‘å…ƒç´  */</span></span><br><span class="line">            <span class="keyword">const</span> size_type elems_after = finish - <span class="built_in">position</span>;  </span><br><span class="line">            iterator old_finish = finish;   <span class="comment">/* ä¿å­˜å½“å‰ finish */</span></span><br><span class="line">            <span class="keyword">if</span> (elems_after &gt; n) &#123;          <span class="comment">/* å¦‚æœåé¢çš„å…ƒç´ ä¸ªæ•°å¤§äº n */</span></span><br><span class="line">			<span class="comment">/* 1. å°†[old_finish - n, old_finish) å†…å…ƒç´ </span></span><br><span class="line"><span class="comment">			   æ‹·è´åˆ° [old_finish, old_finish + n) */</span></span><br><span class="line">                MiniSTL::uninitialized_copy(finish - n, finish, finish);</span><br><span class="line">                finish += n;</span><br><span class="line">            <span class="comment">/* 2. å°† [position, oid_finish - n] å†…å…ƒç´ </span></span><br><span class="line"><span class="comment">               ç§»åŠ¨åˆ° [position + n, old_finish] */</span></span><br><span class="line">                MiniSTL::copy_backward(<span class="built_in">position</span>, old_finish - n, old_finish);</span><br><span class="line">			<span class="comment">/* 3. [position, position + n) å¡«å…… value */</span></span><br><span class="line">                MiniSTL::<span class="built_in">fill</span>(<span class="built_in">position</span>, <span class="built_in">position</span> + n, value_copy);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">/* 1. åœ¨ [old_finish, old_finish + n - elems_after) å¡«å…… value */</span></span><br><span class="line">                MiniSTL::uninitialized_fill_n(finish, n - elems_after, value_copy);</span><br><span class="line">                finish += n - elems_after;</span><br><span class="line">            <span class="comment">/* 2. å°† [position, old_finish) å†…å…ƒç´ æ‹·è´åˆ° [finish, old_finish + n) */</span></span><br><span class="line">                MiniSTL::uninitialized_copy(<span class="built_in">position</span>, old_finish, finish);</span><br><span class="line">                finish += elems_after;</span><br><span class="line">            <span class="comment">/* 3. å°† [position, old_finish) å†…å…ƒç´ å¡«å……ä¸º value */</span></span><br><span class="line">                MiniSTL::<span class="built_in">fill</span>(<span class="built_in">position</span>, old_finish, value_copy);  <span class="comment">// complement</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;  <span class="comment">// expand</span></span><br><span class="line">            <span class="keyword">const</span> size_type old_size = <span class="built_in">size</span>();</span><br><span class="line">            <span class="keyword">const</span> size_type new_size = old_size + MiniSTL::<span class="built_in">max</span>(old_size, n);</span><br><span class="line">            iterator new_start = data_allocator::allocate(new_size);</span><br><span class="line">            iterator new_finish = new_start;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">/* 1. å¤åˆ¶ position å‰é¢å…ƒç´   */</span></span><br><span class="line">                new_finish =</span><br><span class="line">                    MiniSTL::uninitialized_copy(start, <span class="built_in">position</span>, new_start);</span><br><span class="line">                <span class="comment">/* 2. å¡«å…… n ä¸ªå…ƒç´ å€¼ä¸º value çš„å…ƒç´   */</span></span><br><span class="line">                new_finish =</span><br><span class="line">                    MiniSTL::uninitialized_fill_n(new_finish, n, value);</span><br><span class="line">                <span class="comment">/* 3. å¤åˆ¶ position ä»¥åŠåé¢çš„æ•°æ®åˆ° new_finish å  */</span></span><br><span class="line">                new_finish =</span><br><span class="line">                    MiniSTL::uninitialized_copy(<span class="built_in">position</span>, finish, new_finish);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (<span class="built_in">std</span>::exception &amp;) &#123;</span><br><span class="line">                <span class="comment">/* å¦‚æœæ„é€ å¤±è´¥ï¼Œå›æ»šï¼Œå¹¶æŠ›å‡ºå¼‚å¸¸ */</span></span><br><span class="line">                destroy(new_start, new_finish);</span><br><span class="line">                data_allocator::deallocate(new_start, new_size);</span><br><span class="line">                <span class="keyword">throw</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">/* å¯¹åŸæ¥çš„å†…å­˜è¿›è¡Œææ„å’Œé‡Šæ”¾å†…å­˜ */</span></span><br><span class="line">            destroy_and_deallocate();</span><br><span class="line">            <span class="comment">/* vector æ•°æ®æˆå‘˜æ›´æ–°ä¸ºæ–°çš„å€¼ */</span></span><br><span class="line">            start = new_start;</span><br><span class="line">            finish = new_finish;</span><br><span class="line">            end_of_storage = new_start + new_size;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°† <strong>position</strong> ä½œä¸ºå“¨å…µï¼Œå¯ä»¥å°†ä»¥ä¸Šè¿‡ç¨‹åˆ†ä¸ºä¸‰ç§æƒ…å†µï¼š</p><ul><li><p>å¤‡ç”¨ç©ºé—´è¶³å¤Ÿ</p><ul><li>â‘  æ’å…¥ç‚¹åçš„å…ƒç´ ä¸ªæ•° <strong>elems_after</strong> å¤§äºæ–°å¢å…ƒç´ ä¸ªæ•°</li><li>â‘¡ æ’å…¥ç‚¹åçš„å…ƒç´ ä¸ªæ•° <strong>elems_after</strong> å°äºç­‰äºæ–°å¢å…ƒç´ ä¸ªæ•°</li></ul></li><li><p>â‘¢ å¤‡ç”¨ç©ºé—´ä¸è¶³</p></li></ul><p>å…·ä½“çš„æ“ä½œæ–¹å¼è§æ³¨é‡Šï¼Œæ›´å½¢è±¡çš„è¡¨ç¤ºå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="/C++_Language/STL/vector/insert1.png" style="zoom:50%"><center><strong>å›¾ 2(a)</strong> æƒ…å†µä¸€</center><img src="/C++_Language/STL/vector/insert2.png" style="zoom:50%"><center><strong>å›¾ 2(b)</strong> æƒ…å†µäºŒ</center><img src="/C++_Language/STL/vector/insert3.png" style="zoom:50%"><center><strong>å›¾ 2(c)</strong> æƒ…å†µä¸‰</center><p><strong><font color="FF8888">æ³¨æ„</font></strong>ï¼šå…¶ä¸­çš„å†…å­˜ç§»åŠ¨åˆ©ç”¨<code>copy</code>ï¼Œæ’å…¥ä½¿ç”¨ <code>fill</code></p><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P125 - P128</p></blockquote><hr><h4 id="range-insert"><a class="header-anchor" href="#range-insert">Â¶</a><code>range_insert()</code></h4><p><code>range_insert()</code> çš„ç¬¬å››ä¸ªå‚æ•°ç”±èƒå–æœºæ¨å¯¼è·å¾—ï¼Œæœ‰ä¸¤ç§æƒ…å†µï¼›</p><ul><li><em>input_iterator_tag</em></li><li><em>forward_iterator_tag</em></li></ul><p>ä¹Ÿå°±å¯¹åº”äº†ä¸¤ç§é‡è½½å‡½æ•°ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"> <span class="comment">/* å°†æŒ‡å®šèŒƒå›´å†…çš„å…ƒç´ ï¼Œæ’å…¥åˆ°æŒ‡å®šä½ç½®*/</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator</span>&gt;                                                  </span></span><br><span class="line"><span class="class">    <span class="title">void</span> <span class="title">range_insert</span>(<span class="title">iterator</span> <span class="title">pos</span>, <span class="title">InputIterator</span> <span class="title">first</span>, <span class="title">InputIterator</span> <span class="title">last</span>,       </span></span><br><span class="line"><span class="class">                      <span class="title">input_iterator_tag</span>);</span>                                         </span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">ForwardIterator</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="title">void</span> <span class="title">range_insert</span>(<span class="title">iterator</span> <span class="title">pos</span>, <span class="title">ForwardIterator</span> <span class="title">first</span>, <span class="title">ForwardIterator</span> <span class="title">last</span>,</span></span><br><span class="line"><span class="class">                      <span class="title">forward_iterator_tag</span>);</span></span><br></pre></td></tr></table></figure><p>ä¸¤ä¸ªçš„åŒºåˆ«åœ¨äºï¼Œ<em>input_iterator_tag</em> æƒ…å†µä¸‹æ²¡æœ‰ <code>distance()</code> æ“ä½œï¼Œåªèƒ½å•æ­¥æ‰§è¡Œ <strong>insert</strong> æ“ä½œæ¥å®ç°ã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Alloc</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">template</span> &lt;class InputIterator&gt;</span></span><br><span class="line"><span class="class"><span class="title">void</span> <span class="title">vector</span>&lt;T, Alloc&gt;:</span>:range_insert(iterator pos, InputIterator first, InputIterator last, input_iterator_tag) &#123;</span><br><span class="line">    <span class="keyword">for</span> (; first != last; ++first) &#123;</span><br><span class="line">        pos = insert(pos, *first);   <span class="comment">/* å†…éƒ¨è°ƒç”¨ insert */</span></span><br><span class="line">        ++pos;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em>forward_iterator_tag</em> æƒ…å†µä¸‹æœ‰<code>distance()</code> æ“ä½œï¼Œå¯ä»¥æå‰çŸ¥é“æ’å…¥å¤šå°‘ä¸ªå…ƒç´ ã€‚é‡‡ç”¨æ›´é«˜æ•ˆçš„æ’å…¥æ–¹æ³•ï¼Œå…·ä½“çš„æ’å…¥æ–¹æ³•ä¸ <code>fill_insert()</code>å®Œå…¨ç›¸åŒï¼Œä»…ä»…æ˜¯æ’å…¥çš„æ–¹å¼ä¸åŒã€‚å…·ä½“çš„æ“ä½œæ–¹å¼è§ <code>fill_insert()</code>ã€‚</p><p><strong><font color="FF8888">æ³¨æ„</font></strong>ï¼š</p><ul><li><code>fill_insert()</code>ï¼šå…¶ä¸­çš„å†…å­˜ç§»åŠ¨åˆ©ç”¨<code>copy</code>ï¼Œæ’å…¥ä½¿ç”¨ <code>fill</code></li><li><code>range_insert()</code> ï¼šå…¶ä¸­çš„å†…å­˜ç§»åŠ¨åˆ©ç”¨<code>copy</code>ï¼Œæ’å…¥ä½¿ç”¨ <code>copy</code></li></ul><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Alloc</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">template</span> &lt;class ForwardIterator&gt;</span></span><br><span class="line"><span class="class"><span class="title">void</span> <span class="title">vector</span>&lt;T, Alloc&gt;:</span>:range_insert(iterator <span class="built_in">position</span>, ForwardIterator first, ForwardIterator last, forward_iterator_tag) &#123;</span><br><span class="line">    <span class="comment">/* è¿™é‡Œçš„æ“ä½œä¸ fill_insert å‡ ä¹ç›¸åŒï¼Œåªæ˜¯ fill æ“ä½œ æ”¹ä¸ºäº† copy æ“ä½œ */</span></span><br><span class="line">    <span class="keyword">if</span> (first != last) &#123;</span><br><span class="line">        <span class="comment">/* forward_iterator,å¯ä»¥ä½¿ç”¨ distance() è®¡ç®—æ’å…¥çš„å…ƒç´ ä¸ªæ•° */</span></span><br><span class="line">        size_type n = MiniSTL::distance(first, last);  </span><br><span class="line">        <span class="comment">/* å†…å­˜è¶³å¤Ÿï¼Œä¸éœ€è¦æ‰©å±• */</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">static_cast</span>&lt;size_type&gt;(end_of_storage - finish) &gt;= n) &#123;  </span><br><span class="line">            <span class="keyword">const</span> size_type elems_after = finish - <span class="built_in">position</span>;  </span><br><span class="line">            iterator old_finish = finish;</span><br><span class="line">            <span class="keyword">if</span> (elems_after &gt; n) &#123;</span><br><span class="line">                MiniSTL::uninitialized_copy(finish - n, finish, finish);</span><br><span class="line">                finish += n;</span><br><span class="line">                MiniSTL::copy_backward(<span class="built_in">position</span>, old_finish - n, old_finish);</span><br><span class="line">                MiniSTL::copy(<span class="built_in">position</span>, <span class="built_in">position</span> + n, <span class="built_in">position</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                ForwardIterator mid = first;</span><br><span class="line">                advance(mid, elems_after);</span><br><span class="line">                MiniSTL::uninitialized_copy(mid, last, finish);</span><br><span class="line">                finish += n - elems_after;</span><br><span class="line">                MiniSTL::uninitialized_copy(<span class="built_in">position</span>, old_finish, finish);</span><br><span class="line">                finish += elems_after;</span><br><span class="line">                MiniSTL::copy(first, mid, <span class="built_in">position</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;  <span class="comment">// expand</span></span><br><span class="line">            <span class="keyword">const</span> size_type old_size = <span class="built_in">size</span>();</span><br><span class="line">            <span class="keyword">const</span> size_type new_size = old_size + MiniSTL::<span class="built_in">max</span>(old_size, n);</span><br><span class="line">            iterator new_start = data_allocator::allocate(new_size);</span><br><span class="line">            iterator new_finish = new_start;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                new_finish =</span><br><span class="line">                    MiniSTL::uninitialized_copy(start, <span class="built_in">position</span>, new_start);</span><br><span class="line">                new_finish =</span><br><span class="line">                    MiniSTL::uninitialized_copy(first, last, new_finish);</span><br><span class="line">                new_finish =</span><br><span class="line">                    MiniSTL::uninitialized_copy(<span class="built_in">position</span>, finish, new_finish);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (<span class="built_in">std</span>::exception &amp;) &#123;</span><br><span class="line">                destroy(new_start, new_finish);</span><br><span class="line">                data_allocator::deallocate(new_start, new_size);</span><br><span class="line">                <span class="keyword">throw</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            destroy_and_deallocate();</span><br><span class="line">            start = new_start;</span><br><span class="line">            finish = new_finish;</span><br><span class="line">            end_of_storage = new_start + new_size;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://www.zhihu.com/question/26843011?sort=created" target="_blank" rel="noopener">ä¸ºä»€ä¹ˆSTLçš„å¾ˆå¤šcontainerçš„range version insertå‡½æ•°å®ç°éƒ½æœ‰input iteratorå’Œforward iteratorä¸¤ä¸ªé‡è½½ï¼Ÿ</a></p></blockquote><hr><h3 id="2-10-assign-æ“ä½œ"><a class="header-anchor" href="#2-10-assign-æ“ä½œ">Â¶</a>2.10 assign æ“ä½œ</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span>:  <span class="comment">// assign</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">assign</span><span class="params">(size_type n, <span class="keyword">const</span> value_type &amp;val)</span> </span>&#123; fill_assign(n, val); &#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="title">void</span> <span class="title">assign</span>(<span class="title">InputIterator</span> <span class="title">first</span>, <span class="title">InputIterator</span> <span class="title">last</span>) &#123;</span></span><br><span class="line">        <span class="comment">/* å†…éƒ¨è°ƒç”¨ assign_aux */</span></span><br><span class="line">        assign_dispatch(first, last, <span class="keyword">_is_integer_t</span>&lt;InputIterator&gt;());  </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">assign</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">initializer_list</span>&lt;value_type&gt; ils)</span> </span>&#123; <span class="comment">/* åˆå§‹åŒ–é“¾è¡¨ */</span></span><br><span class="line">        assign(ils.<span class="built_in">begin</span>(), ils.<span class="built_in">end</span>());</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">/* æ‹·è´èµ‹å€¼è¿ç®—ç¬¦ï¼ˆåˆå§‹åŒ–é“¾è¡¨ï¼‰*/</span></span><br><span class="line">    <span class="built_in">vector</span> &amp;<span class="keyword">operator</span>=(<span class="built_in">std</span>::<span class="built_in">initializer_list</span>&lt;value_type&gt; ils) &#123; </span><br><span class="line">        assign(ils);</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><strong><font color="FF8888">æ³¨æ„</font></strong>ï¼š</p><p><code>è¡Œ: 2</code>ï¼Œå†…éƒ¨è°ƒç”¨ <code>fill_assign()</code>ã€‚</p><p><code>è¡Œ: 4-7</code>ï¼Œä¼ å…¥å‚æ•°æ˜¯ä¸¤ä¸ªè¿­ä»£å™¨ï¼Œå†…éƒ¨è°ƒç”¨ <code>assign_dispatch()</code>ï¼Œä¼šåˆ©ç”¨èƒå–æœºè·å¾—ç¬¬ä¸‰ä¸ªå‚æ•°ã€‚</p><p><code>è¡Œ: 12-15</code>ï¼Œå†…éƒ¨è°ƒç”¨ <code>void assign(std::initializer_list&lt;value_type&gt; ils)</code> é‡è½½å‡½æ•°ã€‚</p><p><code>è¡Œ: 8-10</code>ï¼Œå†…éƒ¨è°ƒç”¨ <code>void assign(InputIterator first, InputIterator last)</code> é‡è½½å‡½æ•°ã€‚</p><hr><h4 id="fill-assign"><a class="header-anchor" href="#fill-assign">Â¶</a><code>fill_assign()</code></h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Alloc</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">void</span> <span class="title">vector</span>&lt;T, Alloc&gt;:</span>:fill_assign(size_type n, <span class="keyword">const</span> value_type &amp;val) &#123;</span><br><span class="line">    <span class="comment">/* å¦‚æœå¡«å……å®¹é‡å¤§äº capcityï¼Œæ„é€ ä¸€ä¸ªæ–°çš„ vectorï¼Œå¹¶ç›´æ¥ä¸å½“å‰ vector äº¤æ¢ */</span></span><br><span class="line">    <span class="keyword">if</span> (n &gt; capacity()) &#123;</span><br><span class="line">        vector&lt;T, Alloc&gt; temp(n, val);</span><br><span class="line">        temp.swap(*<span class="keyword">this</span>);</span><br><span class="line">    &#125; <span class="comment">// temp ä¼šåœ¨å‡ºä½œç”¨åŸŸçš„æ—¶å€™é‡Šæ”¾</span></span><br><span class="line">    <span class="comment">/* å¦‚æœèµ‹å€¼å®¹é‡å¤§äºç›®å‰çš„ sizeï¼Œå…ˆå¡«å……ï¼Œåè¡¥å…¨å¡«å……å³å¯*/</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (n &gt; <span class="built_in">size</span>()) &#123;</span><br><span class="line">        MiniSTL::<span class="built_in">fill</span>(<span class="built_in">begin</span>(), <span class="built_in">end</span>(), val);</span><br><span class="line">        finish = MiniSTL::uninitialized_fill_n(finish, n - <span class="built_in">size</span>(), val);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* å¦‚æœå¡«å……çš„å®¹é‡å°äºç­‰äº sizeï¼Œå…ˆå¡«å……å…¨éƒ¨ï¼Œä¹‹ååˆ é™¤å¤šä½™çš„ */</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        erase(MiniSTL::fill_n(<span class="built_in">begin</span>(), n, val), <span class="built_in">end</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…·ä½“çš„æ“ä½œæ–¹å¼è§æ³¨é‡Šã€‚</p><hr><h4 id="assign-dispatch"><a class="header-anchor" href="#assign-dispatch">Â¶</a><code>assign_dispatch</code></h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// _true_type å†…éƒ¨è°ƒç”¨ fill_assign()</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Integer</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="title">void</span> <span class="title">assign_dispatch</span>(<span class="title">Integer</span> <span class="title">n</span>, <span class="title">Integer</span> <span class="title">val</span>, _<span class="title">true_type</span>) &#123;</span></span><br><span class="line">    fill_assign(<span class="keyword">static_cast</span>&lt;size_type&gt;(n), <span class="keyword">static_cast</span>&lt;value_type&gt;(val));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// _false_type å†…éƒ¨è°ƒç”¨ assign_aux()</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="title">void</span> <span class="title">assign_dispatch</span>(<span class="title">InputIterator</span> <span class="title">first</span>, <span class="title">InputIterator</span> <span class="title">last</span>, _<span class="title">false_type</span>) &#123;</span></span><br><span class="line">    assign_aux(first, last, <span class="keyword">iterator_category_t</span>&lt;InputIterator&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸å‰æ–‡ç›¸åŒï¼Œ<em>_true_type</em> ä¸»è¦é’ˆå¯¹ <em><strong>int</strong></em>ï¼Œ<em>_false_type</em> ä¸»è¦é’ˆå¯¹<strong>è¿­ä»£å™¨</strong>ï¼Œåˆ†åˆ«é‡‡ç”¨ <code>fill_assign()</code> å’Œ <code>assign_aux()</code>ã€‚è€Œåè€…ä¼šåˆ©ç”¨åˆ°<strong>èƒå–æœº</strong>æ¨å¯¼ç¬¬ä¸‰ä¸ªå‚æ•°ã€‚</p><h4 id="assign-aux"><a class="header-anchor" href="#assign-aux">Â¶</a><code>assign_aux()</code></h4><p><code>assign_aux()</code> çš„ç¬¬ä¸‰ä¸ªå‚æ•°ç”±èƒå–æœºæ¨å¯¼è·å¾—ï¼Œæœ‰ä¸¤ç§æƒ…å†µï¼›</p><ul><li><em>input_iterator_tag</em></li><li><em>forward_iterator_tag</em></li></ul><p>ä¹Ÿå°±å¯¹åº”äº†ä¸¤ç§é‡è½½å‡½æ•°ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">void</span> <span class="title">assign_aux</span>(<span class="title">InputIterator</span> <span class="title">first</span>, <span class="title">InputIterator</span> <span class="title">last</span>,</span></span><br><span class="line"><span class="class">                <span class="title">input_iterator_tag</span>);</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">ForwardIterator</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">void</span> <span class="title">assign_aux</span>(<span class="title">ForwardIterator</span> <span class="title">first</span>, <span class="title">ForwardIterator</span> <span class="title">last</span>,</span></span><br><span class="line"><span class="class">                <span class="title">forward_iterator_tag</span>);</span></span><br></pre></td></tr></table></figure><p>ä¸¤ä¸ªçš„åŒºåˆ«åœ¨äºï¼Œ<em>input_iterator_tag</em> æƒ…å†µä¸‹æ²¡æœ‰ <code>distance()</code> æ“ä½œï¼Œåªèƒ½å•æ­¥æ‰§è¡Œ <strong>assign</strong> æ“ä½œæ¥å®ç°ã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Alloc</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">template</span> &lt;class InputIterator&gt;  /* ä¸èƒ½ä½¿ç”¨ <span class="title">distance</span> è®¡ç®—èµ‹å€¼é•¿åº¦ */</span></span><br><span class="line"><span class="class"><span class="title">void</span> <span class="title">vector</span>&lt;T, Alloc&gt;:</span>:assign_aux(InputIterator first, InputIterator last, input_iterator_tag) &#123;</span><br><span class="line">    iterator cur = <span class="built_in">begin</span>();  <span class="comment">/* cur ä¸ºå½“å‰ vector begin() */</span></span><br><span class="line">    <span class="comment">/* å°† [first last] å…ƒç´ æŸ¥è¦†åˆ° begin()åŠå…¶åé¢*/</span></span><br><span class="line">    <span class="keyword">for</span> (; first != last &amp;&amp; cur != <span class="built_in">end</span>(); ++cur, ++first) *cur = *first;</span><br><span class="line">    <span class="comment">/* åˆ é™¤  end() - (last - first) åå¤šä½™çš„å…ƒç´  */</span></span><br><span class="line">    <span class="keyword">if</span> (first == last)</span><br><span class="line">        erase(cur, <span class="built_in">end</span>());</span><br><span class="line">    <span class="comment">/* å¦‚æœ è¢«èµ‹å€¼ vector ä¸ºç©ºï¼Œç›´æ¥è°ƒç”¨ insert æ“ä½œ */</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        insert(<span class="built_in">end</span>(), first, last);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em>forward_iterator_tag</em> æƒ…å†µä¸‹æœ‰<code>distance()</code> æ“ä½œï¼Œå¯ä»¥æå‰çŸ¥é“èµ‹å€¼å¤šå°‘ä¸ªå…ƒç´ ã€‚é‡‡ç”¨æ›´é«˜æ•ˆçš„èµ‹å€¼æ–¹æ³•ï¼Œå…·ä½“çš„æ’å…¥æ–¹æ³•ä¸ <code>fill_assign</code>å®Œå…¨ç›¸åŒï¼Œä»…ä»…æ˜¯æ’å…¥çš„æ–¹å¼ä¸åŒã€‚å…·ä½“çš„æ“ä½œæ–¹å¼è§æ³¨é‡Šã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Alloc</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">template</span> &lt;class ForwardIterator&gt;</span></span><br><span class="line"><span class="class"><span class="title">void</span> <span class="title">vector</span>&lt;T, Alloc&gt;:</span>:assign_aux(ForwardIterator first, ForwardIterator last, forward_iterator_tag) &#123;</span><br><span class="line">    size_type len = MiniSTL::distance(first, last);</span><br><span class="line">    <span class="comment">/* capacity ä¸è¶³ */</span></span><br><span class="line">    <span class="keyword">if</span> (len &gt; capacity()) &#123;</span><br><span class="line">        <span class="comment">/* è·å¾—æ–°çš„å¯¹è±¡ */</span></span><br><span class="line">        iterator temp = allocate_and_copy(first, last);</span><br><span class="line">        destroy_and_deallocate(); <span class="comment">/* ææ„é‡Šæ”¾æ—§å¯¹è±¡ */</span></span><br><span class="line">        start = temp;</span><br><span class="line">        end_of_storage = finish = start + len;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="comment">/* size è¶³å¤Ÿ */</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">size</span>() &gt;= len) &#123;</span><br><span class="line">        <span class="comment">/* æ‹·è´ size å¤§å°éƒ¨åˆ†ï¼Œç„¶åææ„é‡Šæ”¾å¤šä½™çš„*/</span></span><br><span class="line">        iterator new_finish = MiniSTL::copy(first, last, start);</span><br><span class="line">        destroy(new_finish, finish);</span><br><span class="line">        finish = new_finish;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* size &lt; len &lt;= capacity */</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">/* å…ˆæ‰¾åˆ° size é•¿åº¦çš„éƒ¨åˆ† */</span></span><br><span class="line">        ForwardIterator mid = first;</span><br><span class="line">        MiniSTL::advance(mid, <span class="built_in">size</span>());</span><br><span class="line">        <span class="comment">/* å…ˆå°†å‰é¢ size éƒ¨åˆ†æ‹·è´ç»™ç›®æ ‡ */</span></span><br><span class="line">        MiniSTL::copy(first, mid, start);</span><br><span class="line">        <span class="comment">/* å†å°†åé¢å‰©ä¸‹çš„æ‹·è´ç»™ç›®æ ‡ï¼Œä¼šè°ƒç”¨æ„é€ å‡½æ•°*/</span></span><br><span class="line">        finish = MiniSTL::uninitialized_copy(mid, last, finish);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="2-11-è¡¥å……"><a class="header-anchor" href="#2-11-è¡¥å……">Â¶</a>2.11 è¡¥å……</h3><h4 id="äº¤æ¢æ“ä½œ"><a class="header-anchor" href="#äº¤æ¢æ“ä½œ">Â¶</a>äº¤æ¢æ“ä½œ</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Alloc</span>&gt; /* äº¤æ¢æ“ä½œ */</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">void</span> <span class="title">vector</span>&lt;T, Alloc&gt;:</span>:swap(<span class="built_in">vector</span> &amp;rhs) <span class="keyword">noexcept</span> &#123;</span><br><span class="line">    MiniSTL::swap(start, rhs.start);</span><br><span class="line">    MiniSTL::swap(finish, rhs.finish);</span><br><span class="line">    MiniSTL::swap(end_of_storage, rhs.end_of_storage);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ¯”è¾ƒè¿ç®—ç¬¦-ä¸æ˜¯æˆå‘˜å‡½æ•°"><a class="header-anchor" href="#æ¯”è¾ƒè¿ç®—ç¬¦-ä¸æ˜¯æˆå‘˜å‡½æ•°">Â¶</a>æ¯”è¾ƒè¿ç®—ç¬¦(ä¸æ˜¯æˆå‘˜å‡½æ•°)</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Alloc</span>&gt; /* <span class="title">A</span> == <span class="title">B</span> */</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">bool</span> <span class="title">operator</span>==(<span class="title">const</span> <span class="title">vector</span>&lt;T, Alloc&gt; &amp;<span class="title">lhs</span>, <span class="title">const</span> <span class="title">vector</span>&lt;T, Alloc&gt; &amp;<span class="title">rhs</span>) &#123;</span></span><br><span class="line">    <span class="keyword">return</span> lhs.<span class="keyword">operator</span>==(rhs);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Alloc</span>&gt; /* <span class="title">A</span> != <span class="title">B</span> */</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">bool</span> <span class="title">operator</span>!=(<span class="title">const</span> <span class="title">vector</span>&lt;T, Alloc&gt; &amp;<span class="title">lhs</span>, <span class="title">const</span> <span class="title">vector</span>&lt;T, Alloc&gt; &amp;<span class="title">rhs</span>) &#123;</span></span><br><span class="line">    <span class="keyword">return</span> !(lhs == rhs);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;  /* <span class="title">A</span> &lt; B */</span></span><br><span class="line"><span class="class">inline bool operator&lt;(const vector&lt;T&gt; &amp;lhs, const vector&lt;T&gt; &amp;rhs) &#123;</span></span><br><span class="line"><span class="class">    return MiniSTL::lexicographical_compare(lhs.begin(), lhs.end(), rhs.begin(),</span></span><br><span class="line"><span class="class">                                            rhs.end());  // in stl_algobase.h</span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">template &lt;class T&gt;   /* A &gt; B */</span></span><br><span class="line"><span class="class">inline bool operator&gt;(<span class="title">const</span> <span class="title">vector</span>&lt;T&gt; &amp;<span class="title">lhs</span>, <span class="title">const</span> <span class="title">vector</span>&lt;T&gt; &amp;<span class="title">rhs</span>) &#123;</span></span><br><span class="line">    <span class="keyword">return</span> rhs &lt; lhs;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;  /* <span class="title">A</span> &lt;= B */</span></span><br><span class="line"><span class="class">inline bool operator&lt;=(const vector&lt;T&gt; &amp;lhs, const vector&lt;T&gt; &amp;rhs) &#123;</span></span><br><span class="line"><span class="class">    return !(rhs &lt; lhs);</span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">template &lt;class T&gt;  /* A &gt;= B */</span></span><br><span class="line"><span class="class">inline bool operator&gt;=(const vector&lt;T&gt; &amp;lhs, const vector&lt;T&gt; &amp;rhs) &#123;</span></span><br><span class="line"><span class="class">    return !(lhs &lt; rhs);</span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">template &lt;class T, class Alloc&gt; /* äº¤æ¢æ“ä½œ */</span></span><br><span class="line"><span class="class">inline void swap(const vector&lt;T, Alloc&gt; &amp;lhs, const vector&lt;T, Alloc&gt; &amp;rhs) &#123;</span></span><br><span class="line"><span class="class">    lhs.swap(rhs);</span></span><br><span class="line"><span class="class">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="3-å‚è€ƒæ–‡çŒ®"><a class="header-anchor" href="#3-å‚è€ƒæ–‡çŒ®">Â¶</a>3 å‚è€ƒæ–‡çŒ®</h2><blockquote><p>ã€ŠSTLæºç å‰–æã€‹</p><p><a href="https://blog.csdn.net/baidu_35679960/article/details/78900332" target="_blank" rel="noopener">C++ shrink_to_fit() çš„å®ç°</a></p><p><a href="https://www.zhihu.com/question/26843011?sort=created" target="_blank" rel="noopener">ä¸ºä»€ä¹ˆSTLçš„å¾ˆå¤šcontainerçš„range version insertå‡½æ•°å®ç°éƒ½æœ‰input iteratorå’Œforward iteratorä¸¤ä¸ªé‡è½½ï¼Ÿ</a></p></blockquote><!-- rebuild by neat -->]]></content>
      <categories>
        <category>C++_Language</category>
      </categories>
      <tags>
        <tag>STL</tag>
      </tags>
  </entry>
  <entry>
    <title>STL_Iterator</title>
    <url>/C++_Language/STL/Iterator/</url>
    <content><![CDATA[<!-- build time:Tue Jun 22 2021 17:02:33 GMT+0800 (GMT+08:00) --><a id="more"></a><h1>STL_Iterator</h1><h2 id="1-æ–‡ä»¶ç»“æ„"><a class="header-anchor" href="#1-æ–‡ä»¶ç»“æ„">Â¶</a>1. æ–‡ä»¶ç»“æ„</h2><img src="/C++_Language/STL/Iterator/æ–‡ä»¶ç»“æ„.png" style="zoom:67%"><center><strong>å›¾ 1</strong> æ–‡ä»¶ç»“æ„</center><p><strong>Iterator</strong> çš„æ–‡ä»¶ç»“æ„å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæœ‰ä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¸€ä¸ªæ˜¯æ ¸å¿ƒéƒ½æ–‡ä»¶ <code>stl_iterator.h</code>ï¼Œé‡Œé¢åŒ…å«äº†è¿­ä»£å™¨ç›¸å…³çš„æ•°æ®ç»“æ„ï¼Œèƒå–æœºç­‰å…³é”®ä»£ç ï¼›ä¸€ä¸ªæ˜¯ <code>typeTraits.h</code>ï¼Œé‡Œé¢å®šä¹‰äº† <code>_type_traits</code> å‹åˆ«ç›¸å…³å£°æ˜å’Œå®šä¹‰ã€‚</p><hr><h2 id="2-å…³é”®ä»£ç "><a class="header-anchor" href="#2-å…³é”®ä»£ç ">Â¶</a>2. å…³é”®ä»£ç </h2><h3 id="2-1-stl-iterator-h"><a class="header-anchor" href="#2-1-stl-iterator-h">Â¶</a>2.1 <code>stl_iterator.h</code></h3><h4 id="2-1-1-è¿­ä»£å™¨çš„å‹åˆ«"><a class="header-anchor" href="#2-1-1-è¿­ä»£å™¨çš„å‹åˆ«">Â¶</a>2.1.1 è¿­ä»£å™¨çš„å‹åˆ«</h4><p>åœ¨ç®—æ³•ä¸­è¿ç”¨è¿­ä»£å™¨æ—¶ï¼Œå¾ˆå¯èƒ½ä¼šç”¨åˆ°å…¶ç›¸åº”å‹åˆ«ã€‚æœ€å¸¸è§çš„è¿­ä»£å™¨ç›¸åº”å‹åˆ«æœ‰<strong>äº”ç§</strong>ï¼š</p><ul><li><em>value_type</em></li><li><em>difference_type</em></li><li><em>reference_type</em></li><li><em>pointer_type</em></li><li><em>iterator_category</em></li></ul><p>ä»¥ <em>value_type</em> ä¸ºä¾‹ï¼Œä¸ºäº†è·å–å®ƒï¼Œ<strong>å¸¸ç”¨çš„æ‰‹æ³•</strong>æ˜¯ï¼šåˆ©ç”¨**<font color="F08F00">å‡½æ•°æ¨¡æ¿çš„å‚æ•°æ¨å¯¼æœºåˆ¶</font>**ã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">I</span>, <span class="title">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">void</span> <span class="title">func_impl</span>(<span class="title">I</span> <span class="title">iter</span>, <span class="title">T</span> <span class="title">t</span>) &#123;</span></span><br><span class="line">    T tmp;  <span class="comment">// T å°±æ˜¯è¿­ä»£å™¨æ‰€æŒ‡ä¹‹ç‰©çš„å‹åˆ«</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">I</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">void</span> <span class="title">func</span>(<span class="title">I</span> <span class="title">iter</span>) &#123;</span></span><br><span class="line">    func_impl(iter, *iter); <span class="comment">// func çš„å·¥ä½œå…¨éƒ¨ç§»å¾€ func_impl</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    func(&amp;i);</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¥æ–¹æ³•ä»¥ <code>func()</code> ä¸ºå¯¹å¤–æ¥å£ï¼Œå´æŠŠå®é™…æ“ä½œç½®äº <code>func_impl()</code> ä¹‹ä¸­ï¼Œç”±äº <code>func_impl()</code> æ˜¯ä¸€ä¸ªå‡½æ•°æ¨¡æ¿ï¼Œä¸€æ—¦è¢«è°ƒç”¨ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨è¿›è¡Œæ¨¡æ¿å‚æ•°æ¨å¯¼ï¼Œäºæ˜¯æ¨å¯¼å‡ºå‹åˆ« Tã€‚</p><p>ä½†æ˜¯å¦‚ä¹‹å‰æè¿°æ‰€è¿°ï¼Œè¿­ä»£å™¨çš„ç›¸åº”å‹åˆ«ä¸åª<code>value_type</code> ä¸€ç§ï¼Œå¹¶éä»»ä½•æƒ…å†µä¸‹éƒ½å¯ä»¥åˆ©ç”¨ä¸Šè¿°çš„æ¨¡æ¿å‚æ•°æ¨å¯¼æ¥å–å¾—ï¼Œæ‰€ä»¥ STL å¼•å…¥äº† <strong><font color="FF8888">Traits ç¼–ç¨‹æŠ€æ³•</font></strong>ã€‚</p><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P84 - P85</p></blockquote><hr><h4 id="2-1-2-Traits-ç¼–ç¨‹æŠ€æ³•"><a class="header-anchor" href="#2-1-2-Traits-ç¼–ç¨‹æŠ€æ³•">Â¶</a>2.1.2 Traits ç¼–ç¨‹æŠ€æ³•</h4><p>ä¸Šæ–‡æ‰€è¿°çš„åˆ©ç”¨æ¨¡æ¿çš„å½¢å‚æ¨å¯¼æ¥è·å¾—å‹åˆ«çš„æ‰‹æ³•ï¼Œé’ˆå¯¹è¿”å›å€¼å°±æŸæ‰‹æ— ç­–äº†ï¼Œæ¯•ç«Ÿå‡½æ•°çš„æ¨¡æ¿å‚æ•°æ¨å¯¼æœºåˆ¶æ¨åˆ°çš„åªæ˜¯å‚æ•°ï¼Œæ— æ³•æ¨å¯¼å‡½æ•°çš„è¿”å›å€¼ã€‚**<font color="F08F00">å£°æ˜å†…åµŒå‹åˆ«</font>**æˆä¸ºäº†è§£å†³æ–¹æ¡ˆï¼</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">MyIter</span> &#123;</span></span><br><span class="line">    <span class="keyword">typedef</span> T value_type; <span class="comment">// å†…åµŒå‹åˆ«çš„å£°æ˜ ï¼ˆnested typeï¼‰</span></span><br><span class="line">    MyIter(T* p = <span class="number">0</span>) : ptr(p) &#123;&#125;</span><br><span class="line">    T&amp; <span class="keyword">operator</span>*() <span class="keyword">const</span> &#123; <span class="keyword">return</span> *ptr; &#125;</span><br><span class="line">    <span class="comment">// .... </span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">typename</span> <span class="title">I</span>:</span>:value_type <span class="comment">// è¿”å›ç±»å‹ï¼Œå¿…é¡»è¦åŠ  typename å‘Šè¯‰ç¼–è¯‘å™¨è¿™æ˜¯å†…åµŒå‹åˆ«</span></span><br><span class="line">func(I ite) &#123; <span class="keyword">return</span> *ite; &#125;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="function">MyIter&lt;<span class="keyword">int</span>&gt; <span class="title">ite</span><span class="params">(<span class="keyword">new</span> <span class="keyword">int</span>(<span class="number">8</span>))</span></span>;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; func(ite);  <span class="comment">// è¾“å‡ºï¼š8</span></span><br></pre></td></tr></table></figure><p><strong><font color="FF8888">æ³¨æ„</font></strong>ï¼š</p><p><code>è¡Œ:10</code>ï¼Œå¿…é¡»åŠ å…³é”®è¯ <code>typename</code>ï¼Œå› ä¸º T æ˜¯ä¸€ä¸ªæ¨¡æ¿å‚æ•°ï¼Œåœ¨è¢«ç¼–è¯‘å™¨å…·ç°åŒ–ä¹‹å‰ï¼Œç¼–è¯‘å™¨ä¸çŸ¥é“æ­¤æ—¶ <code>MyIter&lt;T&gt;::value_type</code> æ˜¯ä¸€ä¸ªå‹åˆ«æˆ–æ˜¯ä¸€ä¸ªæˆå‘˜å˜é‡æˆ–è€…æˆå‘˜æ•°æ®ã€‚è€Œ <code>typename</code> å‘Šè¯‰ç¼–è¯‘å™¨è¿™æ˜¯ä¸€ä¸ªå‹åˆ«ï¼Œæ‰èƒ½é¡ºåˆ©é€šè¿‡ç¼–è¯‘ã€‚ ï¼ˆåµŒå¥—ä»å±åç§°ï¼‰</p><blockquote><p>ã€ŠEffective C++ 3rdã€‹ â€“ æ¡æ¬¾42ï¼šäº†è§£ typename çš„åŒé‡æ„ä¹‰ï¼ˆP204- P207ï¼‰ åµŒå¥—ä»å±åç§°</p></blockquote><p>ç„¶è€Œè¿­ä»£å™¨é™¤äº†æ˜¯ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆç±»ä¹‹å¤–ï¼Œè¿˜å¯ä»¥æ˜¯ä¸€ä¸ªåŸç”Ÿçš„æŒ‡é’ˆï¼Œè€ŒåŸç”ŸæŒ‡é’ˆä¸æ˜¯ class typeï¼Œæ— æ³•å®šä¹‰å†…åµŒå‹åˆ«ã€‚æ‰€ä»¥é™¤äº†ä¸Šè¿°çš„è§£å†³æ–¹æ¡ˆä»¥ä¸ºï¼Œè¿˜éœ€è¦é’ˆå¯¹åŸç”ŸæŒ‡é’ˆè¿›è¡Œç‰¹æ®ŠåŒ–çš„å¤„ç†ï¼š<strong><font color="F08F00">æ¨¡æ¿çš„åç‰¹åŒ–</font></strong>ã€‚æ³›åŒ–å’Œåç‰¹åŒ–å¯¹æ¯”å¦‚ä¸‹ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> &#123;</span>...&#125;; <span class="comment">// è¿™ä¸ªæ³›åŒ–ç‰ˆæœ¬å…è®¸æ¥å— T ä¸ºä»»ä½•å‹åˆ«</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span>&lt;T*&gt; &#123;</span>...&#125; <span class="comment">// è¿™ä¸ªç‰¹åŒ–ç‰ˆæœ¬ä»…é€‚ç”¨äºâ€œTä¸ºåŸç”ŸæŒ‡é’ˆâ€çš„æƒ…å†µ</span></span><br></pre></td></tr></table></figure><p>æ‰€ä»¥å¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„ç‰¹åŒ–ç‰ˆæœ¬æ¥å¤„ç†åŸç”ŸæŒ‡é’ˆé—®é¢˜ã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">iterator_traits</span>&lt;T*&gt; &#123;</span></span><br><span class="line">    <span class="keyword">typedef</span> T value_type;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥åˆ©ç”¨èƒå–æœºæœºåˆ¶å¯ä»¥è®©å¤–ç•Œæ–¹ä¾¿çš„è·å–ç›¸åº”çš„å‹åˆ«ã€‚</p><img src="/C++_Language/STL/Iterator/èƒå–æœº.png" style="zoom:67%"><center><strong>å›¾ 2</strong> èƒå–æœºåŠŸèƒ½</center><blockquote><p>åç‰¹åŒ–çš„ä¸€äº›ç»†èŠ‚è§ï¼šã€ŠSTLæºç å‰–æã€‹ â€“ P86 - P88</p></blockquote><hr><h4 id="2-1-3-äº”ç§å‹åˆ«"><a class="header-anchor" href="#2-1-3-äº”ç§å‹åˆ«">Â¶</a>2.1.3 äº”ç§å‹åˆ«</h4><h5 id="2-1-3-1-value-type"><a class="header-anchor" href="#2-1-3-1-value-type">Â¶</a>2.1.3.1 <em>value_type</em></h5><p>æ‰€è°“çš„ <em>value_type</em>ï¼Œæ˜¯æŒ‡è¿­ä»£å™¨æŒ‡å‘å¯¹è±¡çš„å‹åˆ«ã€‚ä»»ä½•ä¸€ä¸ªæ‰“ç®—ä¸ STL ç®—æ³•æœ‰å®Œç¾æ­é…çš„ç±»ï¼Œéƒ½åº”è¯¥å®šä¹‰è‡ªå·±çš„ <em>value_type</em> å†…åµŒå‹åˆ«ï¼Œå¦‚ä¸Šæ–‡æ‰€è¿°ã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// class type</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">iterator_traits</span> &#123;</span></span><br><span class="line">    <span class="keyword">typedef</span> T value_type;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// åŸç”ŸæŒ‡é’ˆ</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">iterator_traits</span>&lt;T*&gt; &#123;</span></span><br><span class="line">    <span class="keyword">typedef</span> T value_type;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">iterator_traits</span>&lt;const T*&gt; &#123;</span></span><br><span class="line">    <span class="keyword">typedef</span> T value_type; <span class="comment">// è¿™é‡Œä¸ç”¨ const </span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong><font color="FF8888">æ³¨æ„</font></strong>ï¼š</p><p><code>è¡Œ:12</code> å¤„ä¸åº”è¯¥æ·»åŠ  <em>const</em>ï¼Œå› ä¸ºæˆ‘ä»¬åˆ©ç”¨è¿™ç§æœºåˆ¶æ¥å£°æ˜ä¸€ä¸ªæš‚æ—¶çš„å˜é‡ï¼Œä½¿å…¶å‹åˆ«å’Œè¿­ä»£å™¨çš„ <em>value type</em> ç›¸åŒï¼Œè€Œç°åœ¨ï¼Œå£°æ˜ä¸€ä¸ªæ— æ³•èµ‹å€¼ï¼ˆ<em>const</em>ï¼‰çš„æš‚æ—¶å˜é‡ï¼Œæ²¡æœ‰ä»€ä¹ˆç”¨ï¼å› æ­¤ï¼Œå¦‚æœè¿­ä»£å™¨æ˜¯ä¸ª <em>pointer-to-cons</em>tï¼Œæˆ‘ä»¬åº”è¯¥è®¾æ³•å–å…¶ <em>value type</em> çš„ <em>non-const</em> ç‰ˆæœ¬ã€‚</p><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P88</p></blockquote><hr><h5 id="2-1-3-2-difference-type"><a class="header-anchor" href="#2-1-3-2-difference-type">Â¶</a>2.1.3.2 <em>difference_type</em></h5><p><em>difference type</em> ç”¨æ¥è¡¨ç¤ºä¸¤ä¸ªè¿­ä»£å™¨ä¹‹é—´çš„è·ç¦»ï¼Œå› æ­¤ä¹Ÿå¯ä»¥ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªå®¹å™¨çš„æœ€å¤§å®¹é‡ï¼Œå› ä¸ºå¯¹äºè¿ç»­ç©ºé—´çš„å®¹å™¨è€Œè¨€ï¼Œå¤´å°¾ä¹‹é—´çš„è·ç¦»å°±æ˜¯å…¶å®¹é‡çš„æœ€å¤§å€¼ã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// class type</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">I</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">iterator_traits</span> &#123;</span></span><br><span class="line">    <span class="keyword">typedef</span> <span class="keyword">typename</span> I::difference_type difference_type;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// åŸç”ŸæŒ‡é’ˆ</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">iterator_traits</span>&lt;T*&gt; &#123;</span></span><br><span class="line">    <span class="keyword">typedef</span> <span class="keyword">ptrdiff_t</span> difference_type;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">I</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">iterator_traits</span>&lt;const *T&gt; &#123;</span></span><br><span class="line">    <span class="keyword">typedef</span> <span class="keyword">ptrdiff_t</span> difference_type;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong><font color="FF8888">æ³¨æ„</font></strong>ï¼š</p><p><code>è¡Œ:9,13</code>ï¼š<strong>traits</strong> çš„ä¸¤ä¸ªåŸç”ŸæŒ‡é’ˆçš„ç‰¹åŒ–ç‰ˆæœ¬ï¼Œä»¥ C++ å†…å»ºçš„ <em>ptrdiff_t</em>ï¼ˆå®šä¹‰äº <code>&lt;cstddef&gt;</code> éƒ½æ–‡ä»¶ï¼‰ ä½œä¸ºåŸç”ŸæŒ‡é’ˆçš„ <em>difference type</em>ã€‚</p><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P90</p></blockquote><hr><h5 id="2-1-3-3-pointer-type-reference-type"><a class="header-anchor" href="#2-1-3-3-pointer-type-reference-type">Â¶</a>2.1.3.3 <em>pointer_type, reference_type</em></h5><p>è¿™ä¸¤ä¸ªä¸å¸¸ç”¨ã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// class type</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">I</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">iterator_traits</span> &#123;</span></span><br><span class="line">    <span class="keyword">typedef</span> <span class="keyword">typename</span> I::pointer pointer;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="keyword">typename</span> I::reference reference;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// åŸç”ŸæŒ‡é’ˆ</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">iterator_traits</span>&lt;T*&gt; &#123;</span></span><br><span class="line">    <span class="keyword">typedef</span> T* pointer;</span><br><span class="line">    <span class="keyword">typedef</span> T&amp; reference;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">I</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">iterator_traits</span>&lt;const *T&gt; &#123;</span></span><br><span class="line">    <span class="keyword">typedef</span> <span class="keyword">const</span> T* pointer;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="keyword">const</span> T&amp; reference;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong><font color="FF8888">æ³¨æ„</font></strong>ï¼š</p><p><code>è¡Œ:15,16</code>ï¼šäº <em>value_type</em> ä¸åŒï¼Œæ­¤æ—¶éœ€è¦åŠ ä¸Š <em>const</em>ï¼Œæ­¤æ—¶æ˜¯æŒ‡é’ˆä¸å¼•ç”¨ã€‚</p><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P91 - P92</p></blockquote><hr><h5 id="2-1-3-4-iterator-category"><a class="header-anchor" href="#2-1-3-4-iterator-category">Â¶</a>2.1.3.4 <em>iterator_category</em></h5><p>æ ¹æ®ç§»åŠ¨ç‰¹æ€§ä¸æ–½è¡Œæ“ä½œï¼Œè¿­ä»£å™¨è¢«åˆ†ä¸ºäº†<strong>äº”ç±»</strong>ï¼š</p><ul><li><em>input Iterator</em>ï¼šè¿™ç§è¿­ä»£å™¨æ‰€æŒ‡çš„å¯¹è±¡ï¼Œä¸å…è®¸å¤–ç•Œæ”¹å˜ã€‚åªè¯»ï¼ˆ<em>read only</em>ï¼‰ã€‚</li><li><em>Output Iterator</em>ï¼šå”¯å†™ï¼ˆ<em>write only</em>ï¼‰ã€‚</li><li><em>Forward Iterator</em>ï¼šå…è®¸â€å†™å…¥å‹â€œç®—æ³•åœ¨æ­¤ç§è¿­ä»£å™¨æ‰€å½¢æˆçš„åŒºé—´ä¸Šè¿›è¡Œè¯»å†™æ“ä½œã€‚</li><li><em>Bidirectional Iterator</em>ï¼šå¯åŒå‘ç§»åŠ¨ã€‚æ”¯æŒæŸäº›ç®—æ³•é€†å‘èµ°è®¿è¿­ä»£å™¨åŒºé—´ã€‚</li><li><em>Random Access Iterator</em>ï¼šå‰å››ç§è¿­ä»£å™¨åªä¾›åº”ä¸€éƒ¨åˆ†æŒ‡é’ˆç®—æ•°èƒ½åŠ›ï¼ˆå‰ä¸‰ç§æ”¯æŒ <em>operator++</em>ï¼Œç¬¬å››ç§å†åŠ ä¸Š <em>operatorâ€“</em>ï¼‰ï¼Œç¬¬äº”ç§åˆ™æ¶µç›–æ‰€æœ‰æŒ‡é’ˆç®—æ•°èƒ½åŠ›ï¼ŒåŒ…æ‹¬ <em>p + n, p - n, p[n], p1 - p2, p1 &lt; p2</em>ã€‚</li></ul><p>è¿™äº›è¿­ä»£å™¨çš„åˆ†ç±»ä¸ä»å±å…³ç³»å¦‚<strong>å›¾3</strong>æ‰€ç¤ºã€‚</p><img src="/C++_Language/STL/Iterator/è¿­ä»£å™¨åˆ†ç±»ä»å±.png" style="zoom:80%"><center><strong>å›¾ 3</strong> è¿­ä»£å™¨çš„åˆ†ç±»ä¸ä»å±å…³ç³»</center><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P92 - P93</p></blockquote><p>æ ¹æ®è¿­ä»£å™¨çš„åˆ†ç±»çš„ä¸åŒï¼Œå¯ä»¥ä¸ºç®—æ³•æä¾›ä¸åŒé€‰æ‹©ã€‚</p><p>ä»¥ <code>advance()</code> ä¸ºä¾‹ï¼Œå®ƒå¯ä»¥ä½¿ç”¨ <em>Input Iteratorï¼ŒBidirectional Iteratorï¼ŒRandom Access Iterator</em> ä¸‰ç§ç‰ˆæœ¬ã€‚<em>Forward Iterator</em> ä¸ <em>Input Iterator</em> å®Œå…¨ç›¸åŒï¼Œé¿å…é‡å¤ã€‚</p><p>ï¼ˆè¿­ä»£å™¨ç§»åŠ¨ä»£ç å¦‚ä¸‹ï¼Œè¯¦ç»†ä»£ç è§å‚è€ƒèµ„æ–™ï¼‰</p><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P93 - P94</p></blockquote><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Input Iterator           advance_II()</span></span><br><span class="line"><span class="keyword">while</span> (n--) ++i;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Bidirectional Iterator   advance_BI()</span></span><br><span class="line"><span class="keyword">if</span> (n &gt;= <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">while</span> (n--) ++i;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="keyword">while</span> (n++) --i;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Random Access Iterator   advance_RAI()</span></span><br><span class="line">i += n;</span><br></pre></td></tr></table></figure><p>å¦‚æœé€‰æ‹© <code>advance_II()</code> åˆ™ç›¸å¯¹äº <code>advance_RAI()</code> æ•ˆç‡æå·®ã€‚å¦‚æœé€‰æ‹© <code>advance_RAI()</code>ï¼Œåˆ™ä»–æ— æ³•æ¥å— <em>Input Interator</em>ã€‚ æ‰€ä»¥éœ€è¦å°†ä¸‰è€…åˆä¸€ï¼Œä¸‹é¢æ˜¯ä¸€ç§åšæ³•ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator</span>, <span class="title">class</span> <span class="title">Distance</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">void</span> <span class="title">advance</span>(<span class="title">InputIterator</span>&amp; <span class="title">i</span>, <span class="title">Distance</span> <span class="title">n</span>) &#123;</span></span><br><span class="line">    <span class="keyword">if</span> (is_random_access_iterator(i)) </span><br><span class="line">        advance_RAI(i, n);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (is_bidirectional_iterator(i)) </span><br><span class="line">        advance_BI(i, n);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (is_input_iterator(i)) </span><br><span class="line">        advance_II(i, n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§åšæ³•æœ‰ä¸€ä¸ª<strong>ç¼ºé™·</strong>ï¼šåªæœ‰åœ¨**<font color="FF8888">è¿è¡ŒæœŸ</font><strong>æ‰èƒ½çŸ¥é“ä½¿ç”¨å“ªä¸ªç‰ˆæœ¬ï¼Œä¼šå½±å“æ•ˆç‡ã€‚æœ€å¥½èƒ½å¤Ÿåœ¨</strong><font color="FF8888">ç¼–è¯‘æœŸ</font>**å°±é€‰æ‹©æ­£ç¡®çš„ç‰ˆæœ¬ã€‚é‡è½½å‡½æ•°æœºåˆ¶å¯ä»¥è¾¾åˆ°è¿™ä¸ªç›®æ ‡ã€‚ï¼ˆæ¨¡æ¿å…ƒç¼–ç¨‹æ€æƒ³ï¼‰</p><blockquote><p>ã€ŠEffective C++ 3rdã€‹ â€“ æ¡æ¬¾48ï¼šè®¤è¯† template å…ƒç¼–ç¨‹ ï¼ˆP233 - P234ï¼‰</p></blockquote><p>è®¾è®¡è€ƒè™‘å¦‚ä¸‹ï¼šå°†â€è¿­ä»£å™¨ç±»å‹â€œç›¸åº”å‹åˆ«ä½œä¸º <code>advance()</code> çš„ç¬¬ä¸‰å‚æ•°ï¼Œè¿™ä¸ªç›¸åº”å‹åˆ«**<font color="F08F00">ä¸€å®šå¿…é¡»æ˜¯ <em>class type</em></font><strong>ï¼Œä¸èƒ½åªæ˜¯æ•°å€¼å·ç ç±»çš„ä¸œè¥¿ï¼Œå› ä¸ºç¼–è¯‘å™¨ä¾èµ–å®ƒï¼ˆä¸€ä¸ªå‹åˆ«ï¼‰æ¥è¿›è¡Œ</strong>é‡è½½å†³è®®**ã€‚</p><blockquote><p><a href="https://blog.csdn.net/sinat_35261315/article/details/74907096" target="_blank" rel="noopener">C++å‡½æ•°è°ƒç”¨æ—¶çš„å†³è®®ï¼šåå­—æŸ¥æ‰¾ï¼Œé‡è½½å†³è®®ï¼Œå¯è®¿é—®æ€§æ£€æµ‹</a></p></blockquote><p>æ‰€ä»¥å®šä¹‰äº†ä»¥ä¸‹ç»“æ„ä½“ï¼Œä»–ä»¬åªæ˜¯ä¸ª <em>tag</em>ï¼Œæ‰€ä»¥æ²¡æœ‰ä»»ä½•æˆå‘˜ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// äº”ç§è¿­ä»£å™¨ç±»å‹</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">input_iterator_tag</span> &#123;</span>&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">output_iterator_tag</span> &#123;</span>&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">forward_iterator_tag</span> :</span> <span class="keyword">public</span> input_iterator_tag &#123;&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">bidirectional_iterator_tag</span> :</span> <span class="keyword">public</span> forward_iterator_tag &#123;&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">random_access_iterator_tag</span> :</span> <span class="keyword">public</span> bidirectional_iterator_tag &#123;&#125;;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥<code>__advance()</code>çš„é‡è½½ç‰ˆæœ¬è¡¨ç¤ºå¦‚ä¸‹ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator</span>, <span class="title">class</span> <span class="title">Distance</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">void</span> __<span class="title">advance</span>(<span class="title">InputIterator</span> &amp;<span class="title">i</span>, <span class="title">Distance</span> <span class="title">n</span>, <span class="title">input_iterator_tag</span>) &#123;</span></span><br><span class="line">    <span class="keyword">while</span> (n--) ++i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator</span>, <span class="title">class</span> <span class="title">Distance</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> </span></span><br><span class="line"><span class="class"><span class="title">void</span> __<span class="title">advance</span>(<span class="title">InputIterator</span> &amp;<span class="title">i</span>, <span class="title">Distance</span> <span class="title">n</span>, <span class="title">bidirectional_iterator_tag</span>) &#123;</span></span><br><span class="line">    <span class="keyword">if</span> (n &gt;= <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">while</span> (n--) ++i;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">while</span> (n++) --i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator</span>, <span class="title">class</span> <span class="title">Distance</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> </span></span><br><span class="line"><span class="class"><span class="title">void</span> __<span class="title">advance</span>(<span class="title">InputIterator</span> &amp;<span class="title">i</span>, <span class="title">Distance</span> <span class="title">n</span>, <span class="title">random_access_iterator_tag</span>) &#123;</span></span><br><span class="line">    i += n;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°æ¨¡æ¿åªæä¾›äº†ä¸¤ä¸ªå‚æ•°ï¼Œè¿˜éœ€è¦è®© <code>__advance()</code>æœ‰èƒ½åŠ›ä»è·å¾—çš„è¿­ä»£å™¨ä¸­æ¨å¯¼å‡ºå…¶ç±»å‹ã€‚è¿™ä»½å·¥ä½œè‡ªç„¶è€Œç„¶å°±äº¤ç»™äº† <strong>traits</strong>ã€‚æ‰€ä»¥ä¸Šå±‚æ¥å£å‡½æ•°å¯ä»¥å¦‚ä¸‹ç¼–å†™ã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator</span>, <span class="title">class</span> <span class="title">Distance</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> </span></span><br><span class="line"><span class="class"><span class="title">void</span> <span class="title">advance</span>(<span class="title">InputIterator</span> &amp;<span class="title">i</span>, <span class="title">Distance</span> <span class="title">n</span>, <span class="title">random_access_iterator_tag</span>) &#123;</span></span><br><span class="line">    __advance(i, n, iterator_traits&lt;InputIterator&gt;::iterator_category());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>iterator_traits&lt;InputIterator&gt;::iterator_category()</code> å°†äº§ç”Ÿä¸€ä¸ªä¸´æ—¶å¯¹è±¡ï¼Œå…¶å‹åˆ«å¯¹äºè¯¥éš¶å±äºå‰è¿°äº”ä¸ªè¿­ä»£å™¨ç±»å‹ä¹‹ä¸€ã€‚ç„¶åï¼Œæ ¹æ®è¿™ä¸ªå‹åˆ«ï¼Œç¼–è¯‘å™¨æ‰å†³å®šè°ƒç”¨å“ªä¸ª <code>__advance()</code> é‡è½½å‡½æ•°ã€‚</p><p><strong><font color="FF8888">æ³¨æ„</font></strong>ï¼š</p><p>ä»»ä½•ä¸€ä¸ªè¿­ä»£å™¨ï¼Œ<strong><font color="F08F00">å…¶ç±»å‹æ°¸è¿œåº”è¯¥è½åœ¨â€œè¯¥è¿­ä»£å™¨æ‰€éš¶å±ä¹‹å„ç§ç±»å‹ä¸­æœ€å¼ºåŒ–çš„é‚£ä¸ª</font></strong>â€ã€‚å¦‚ä¸Šä¸ªä¾‹å­ï¼Œæ—¢æ˜¯ <em>Random_Access_Iterator</em>ï¼Œåˆæ˜¯ <em>Bidirectional_Iterator</em>ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ <em>Forward_Iterator</em>ï¼Œè€Œä¸”ä¹Ÿæ˜¯ <em>Input_Iterator</em>ï¼Œé‚£ä¹ˆï¼Œå…¶ç±»å‹åº”è¯¥å½’å±äº <em>random_access_iterator_tag</em>ã€‚</p><p>å¦å¤–å¯ä»¥å‘ç°ä¸Šé¢ä»£ç ï¼Œæ¨¡æ¿å‚æ•°åç§°å–å¾—å¹¶ä¸æ˜¯ <em>RandomAccessIterator</em>ï¼Œè€Œæ˜¯ <em>InputIterator</em>ï¼Œè¿™æ˜¯ä¸€ä¸ª STL ç®—æ³•çš„<strong>å‘½åè§„åˆ™</strong>ï¼š<strong><font color="F08F00">ä»¥ç®—æ³•èƒ½æ¥å—çš„æœ€ä½é˜¶è¿­ä»£å™¨ç±»å‹ï¼Œæ¥ä¸ºå…¶è¿­ä»£å™¨å‹åˆ«å‚æ•°å‘½å</font></strong>ã€‚(æ–¹ä¾¿ä»£ç é˜…è¯»)</p><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P97</p></blockquote><p>é€šè¿‡äº”ç§è¿­ä»£å™¨ç±»å‹çš„ç»“æ„ä½“å¯ä»¥å‘ç°ï¼Œå®ƒä»¬ä¸ä»…æ˜¯ä»¥ class å®šä¹‰çš„è¿­ä»£å™¨æ ‡ç­¾ï¼Œè¿˜æ»¡è¶³<strong>ç»§æ‰¿</strong>å…³ç³»ã€‚</p><img src="/C++_Language/STL/Iterator/è¿­ä»£å™¨åˆ†ç±»ç»§æ‰¿å…³ç³».png" style="zoom:50%"><center><strong>å›¾ 4</strong> è¿­ä»£å™¨ç±»å‹æ ‡ç­¾çš„ç»§æ‰¿å…³ç³»</center><p><strong><font color="FF8888">æ³¨æ„</font></strong>ï¼š</p><p>é¦–å…ˆä»¥ <em>class</em> æ¥å®šä¹‰è¿­ä»£å™¨çš„å„ç§åˆ†ç±»æ ‡ç­¾ï¼Œå¯ä»¥ä¿ƒæˆé‡è½½æœºåˆ¶çš„æˆåŠŸè¿ä½œï¼ˆä½¿ç¼–è¯‘å™¨å¾—ä»¥æ­£ç¡®æ‰§è¡Œé‡è½½å†³è®®ï¼‰ï¼›</p><p>å…¶æ¬¡é€šè¿‡ç»§æ‰¿ï¼Œä¸å¿…å†å†™â€œå•çº¯åªåšä¼ é€’è°ƒç”¨â€çš„å‡½æ•°ï¼ˆä¾‹å¦‚å‰è¿°çš„ <code>__advance()</code> çš„ <em>ForwordIterator</em> ç‰ˆæœ¬ï¼‰ã€‚å› ä¸ºå¦‚æœ <code>advance()</code> ä¼ å…¥çš„è¿­ä»£å™¨ç±»å‹æ˜¯ <em>ForwordIterator</em>ï¼Œè™½ç„¶ <code>__advance()</code> é‡è½½ç‰ˆæœ¬ä¸­æ²¡æœ‰ä¸ä¹‹å¯¹åº”çš„ç‰ˆæœ¬ï¼Œä½†æ˜¯é€šè¿‡é‡è½½ä¸ç»§æ‰¿çš„ç»“åˆï¼Œ<code>advance()</code> ä¼šè°ƒç”¨ <code>__advance()</code> çš„ <em>InputIterator</em> ç‰ˆæœ¬ã€‚</p><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P97 - P99</p></blockquote><p>æœ€åï¼Œä¸ºäº†ç¬¦åˆè§„èŒƒï¼Œä»»ä½•è¿­ä»£å™¨éƒ½åº”è¯¥æä¾›è¿™äº”ä¸ªå†…åµŒç›¸åº”çš„å‹åˆ«ï¼Œä»¥ä¾¿äº <strong>traits</strong> èƒå–ï¼ŒSTL æä¾›äº†ä¸€ä¸ª <em>iterator class</em> å¦‚ä¸‹ï¼Œå¦‚æœæ¯ä¸ªæ–°è®¾è®¡çš„è¿­ä»£å™¨éƒ½<strong>ç»§æ‰¿</strong>è‡ªå®ƒï¼Œå°±å¯ä»¥ä¿è¯ç¬¦åˆ STL æ‰€éœ€ä¹‹è§„èŒƒï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åä¸‰ä¸ªæä¾›äº†å›ºå®šçš„é»˜è®¤å€¼</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Category</span>, <span class="title">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Distance</span> = <span class="title">ptrdiff_t</span>,</span></span><br><span class="line"><span class="class">          <span class="title">class</span> <span class="title">Pointer</span> = <span class="title">T</span> *, <span class="title">class</span> <span class="title">Reference</span> = <span class="title">T</span> &amp;&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">iterator</span> &#123;</span></span><br><span class="line">    <span class="keyword">using</span> iterator_category = Category;</span><br><span class="line">    <span class="keyword">using</span> value_type = T;</span><br><span class="line">    <span class="keyword">using</span> difference_type = Distance;</span><br><span class="line">    <span class="keyword">using</span> pointer = Pointer;</span><br><span class="line">    <span class="keyword">using</span> reference = Reference;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P100</p></blockquote><hr><h4 id="2-1-4-Iterator-æ€»ç»“"><a class="header-anchor" href="#2-1-4-Iterator-æ€»ç»“">Â¶</a>2.1.4 Iterator æ€»ç»“</h4><h5 id="2-1-4-1-äº”ç§è¿­ä»£å™¨ç±»å‹åŠå…¶ç»§æ‰¿å…³ç³»"><a class="header-anchor" href="#2-1-4-1-äº”ç§è¿­ä»£å™¨ç±»å‹åŠå…¶ç»§æ‰¿å…³ç³»">Â¶</a>2.1.4.1 äº”ç§è¿­ä»£å™¨ç±»å‹åŠå…¶ç»§æ‰¿å…³ç³»</h5><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//äº”ç§è¿­ä»£å™¨ç±»å‹ </span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">input_iterator_tag</span> &#123;</span>&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">output_iterator_tag</span> &#123;</span>&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">forward_iterator_tag</span> :</span> <span class="keyword">public</span> input_iterator_tag &#123;&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">bidirectional_iterator_tag</span> :</span> <span class="keyword">public</span> forward_iterator_tag &#123;&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">random_access_iterator_tag</span> :</span> <span class="keyword">public</span> bidirectional_iterator_tag &#123;&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P95</p></blockquote><hr><h5 id="2-1-4-2-STL-æä¾›çš„-Iterator-class"><a class="header-anchor" href="#2-1-4-2-STL-æä¾›çš„-Iterator-class">Â¶</a>2.1.4.2 STL æä¾›çš„ Iterator class</h5><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åä¸‰ä¸ªæä¾›äº†å›ºå®šçš„é»˜è®¤å€¼</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Category</span>, <span class="title">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Distance</span> = <span class="title">ptrdiff_t</span>,</span></span><br><span class="line"><span class="class">          <span class="title">class</span> <span class="title">Pointer</span> = <span class="title">T</span> *, <span class="title">class</span> <span class="title">Reference</span> = <span class="title">T</span> &amp;&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">iterator</span> &#123;</span></span><br><span class="line">    <span class="keyword">using</span> iterator_category = Category;</span><br><span class="line">    <span class="keyword">using</span> value_type = T;</span><br><span class="line">    <span class="keyword">using</span> difference_type = Distance;</span><br><span class="line">    <span class="keyword">using</span> pointer = Pointer;</span><br><span class="line">    <span class="keyword">using</span> reference = Reference;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P100</p></blockquote><hr><h5 id="2-1-4-3-traits"><a class="header-anchor" href="#2-1-4-3-traits">Â¶</a>2.1.4.3 traits</h5><p>**<font color="FF8888">æ³¨æ„</font>**ä»¥ä¸‹ MiniSTL ä»£ç ä½¿ç”¨ C++11/14 æ–°ç‰¹æ€§ï¼š<em><strong>using</strong></em> ä»£æ›¿ <em>typedef</em></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Iterator</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">iterator_traits</span> &#123;</span></span><br><span class="line">    <span class="keyword">using</span> iterator_category = <span class="keyword">typename</span> Iterator::iterator_category;</span><br><span class="line">    <span class="keyword">using</span> value_type = <span class="keyword">typename</span> Iterator::value_type;</span><br><span class="line">    <span class="keyword">using</span> difference_type = <span class="keyword">typename</span> Iterator::difference_type;</span><br><span class="line">    <span class="keyword">using</span> pointer = <span class="keyword">typename</span> Iterator::pointer;</span><br><span class="line">    <span class="keyword">using</span> reference = <span class="keyword">typename</span> Iterator::reference;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//é’ˆå¯¹raw pointerè®¾è®¡çš„åç‰¹åŒ–ç‰ˆæœ¬</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">iterator_traits</span>&lt;T *&gt; &#123;</span></span><br><span class="line">    <span class="keyword">using</span> iterator_category = random_access_iterator_tag;</span><br><span class="line">    <span class="keyword">using</span> value_type = T;</span><br><span class="line">    <span class="keyword">using</span> difference_type = <span class="keyword">ptrdiff_t</span>;</span><br><span class="line">    <span class="keyword">using</span> pointer = T *;</span><br><span class="line">    <span class="keyword">using</span> reference = T &amp;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//é’ˆå¯¹ pointer-to-const è®¾è®¡çš„åç‰¹åŒ–ç‰ˆæœ¬</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">iterator_traits</span>&lt;const T *&gt; &#123;</span></span><br><span class="line">    <span class="keyword">using</span> iterator_category = random_access_iterator_tag;</span><br><span class="line">    <span class="keyword">using</span> value_type = T; 				<span class="comment">// æ²¡æœ‰ const</span></span><br><span class="line">    <span class="keyword">using</span> difference_type = <span class="keyword">ptrdiff_t</span>;</span><br><span class="line">    <span class="keyword">using</span> pointer = <span class="keyword">const</span> T *;  		<span class="comment">// æœ‰ const</span></span><br><span class="line">    <span class="keyword">using</span> reference = <span class="keyword">const</span> T &amp;;		<span class="comment">// æœ‰ const</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å› ä¸ºåŸç”ŸæŒ‡é’ˆæ— æ³•å®šä¹‰å†…åµŒå‹åˆ«ï¼Œä¹Ÿå°±å› æ­¤æ— æ³•ä½¿ç”¨ <em>class type</em> çš„ç‰ˆæœ¬ï¼Œä½† STL æ®å¯¹å¿…é¡»æ¥å—åŸç”ŸæŒ‡é’ˆä½œä¸ºä¸€ç§è¿­ä»£å™¨ï¼Œè§£å†³æ€è·¯æ˜¯ä½¿ç”¨åŸç”ŸæŒ‡é’ˆçš„åç‰¹åŒ–ç‰ˆæœ¬ï¼Œå¦‚ä¸Šæ‰€ç¤ºã€‚</p><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P86</p></blockquote><p>**<font color="FF8888">æ³¨æ„</font>**ä»¥ä¸‹ MiniSTL ä»£ç åŒæ ·ä½¿ç”¨äº† C++11/14 æ–°ç‰¹æ€§ï¼š<strong>åˆ«åæ¨¡æ¿</strong>ï¼Œæä¾›äº†ä¸€ç§æ›´åŠ é«˜æ•ˆçš„ä½¿ç”¨æ–¹æ³•ã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Iterator</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">using</span> <span class="title">iterator_category_t</span> =</span></span><br><span class="line"><span class="class">    <span class="title">typename</span> <span class="title">iterator_traits</span>&lt;Iterator&gt;:</span>:iterator_category;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Iterator</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">using</span> <span class="title">value_type_t</span> = <span class="title">typename</span> <span class="title">iterator_traits</span>&lt;Iterator&gt;:</span>:value_type;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Iterator</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">using</span> <span class="title">difference_type_t</span> = <span class="title">typename</span> <span class="title">iterator_traits</span>&lt;Iterator&gt;:</span>:difference_type;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Iterator</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">using</span> <span class="title">pointer_t</span> = <span class="title">typename</span> <span class="title">iterator_traits</span>&lt;Iterator&gt;:</span>:pointer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Iterator</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">using</span> <span class="title">reference_t</span> = <span class="title">typename</span> <span class="title">iterator_traits</span>&lt;Iterator&gt;:</span>:reference;</span><br></pre></td></tr></table></figure><p>å¦‚æœè¦ç”¨è¿­ä»£å™¨ $I$ çš„ <em>value_type</em> æ¥å£°æ˜å˜é‡ <em>val</em> ä¸¤ä¸ªç‰ˆæœ¬çš„å·®å¼‚å¦‚ä¸‹ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">iterator_traits&lt;I&gt;::iterator_value val;</span><br><span class="line"><span class="keyword">value_type_t</span>&lt;I&gt; val;</span><br></pre></td></tr></table></figure><p><strong><font color="FF8888">æ³¨æ„</font></strong>ï¼š</p><p>å¯ä»¥å‘ç°è¿™æ ·æ›´åŠ æ–¹ä¾¿ä»£ç çš„ä¹¦å†™ï¼Œå…¶å®å¹¶ä¸ä»…ä»…åªæ˜¯ä¹¦å†™ç®€å•çš„å¸®åŠ©ï¼Œåˆ©ç”¨åˆ«åæ¨¡æ¿è¿˜èƒ½å®ç° <code>template template parameter</code>ã€‚</p><blockquote><p>MiniSTL / Iterator / stl_iterator.h</p><p><a href="https://www.bilibili.com/video/BV1RB4y1F7x4?p=10" target="_blank" rel="noopener">ä¾¯æ·C<ins>æ–°æ ‡å‡†-C</ins>11/14_10 Alias Template</a></p><p><a href="https://www.bilibili.com/video/BV1RB4y1F7x4?p=11" target="_blank" rel="noopener">ä¾¯æ·C<ins>æ–°æ ‡å‡†-C</ins>11/14_11 template template parameter</a></p></blockquote><hr><h5 id="2-1-4-4-advance-ï¼Œdistance"><a class="header-anchor" href="#2-1-4-4-advance-ï¼Œdistance">Â¶</a>2.1.4.4 <code>advance()</code>ï¼Œ<code>distance()</code></h5><p>æ•´ç»„ <code>advance()</code> å‡½æ•°</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator</span>, <span class="title">class</span> <span class="title">Distance</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">void</span> __<span class="title">advance</span>(<span class="title">InputIterator</span> &amp;<span class="title">i</span>, <span class="title">Distance</span> <span class="title">n</span>, <span class="title">input_iterator_tag</span>) &#123;</span></span><br><span class="line">    <span class="keyword">while</span> (n--) ++i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator</span>, <span class="title">class</span> <span class="title">Distance</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">void</span> __<span class="title">advance</span>(<span class="title">InputIterator</span> &amp;<span class="title">i</span>, <span class="title">Distance</span> <span class="title">n</span>,<span class="title">bidirectional_iterator_tag</span>) &#123;</span></span><br><span class="line">    <span class="keyword">if</span> (n &gt;= <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">while</span> (n--) ++i;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">while</span> (n++) --i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator</span>, <span class="title">class</span> <span class="title">Distance</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">void</span> __<span class="title">advance</span>(<span class="title">InputIterator</span> &amp;<span class="title">i</span>, <span class="title">Distance</span> <span class="title">n</span>,<span class="title">random_access_iterator_tag</span>) &#123;</span></span><br><span class="line">    i += n;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator</span>, <span class="title">class</span> <span class="title">Distance</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">void</span> <span class="title">advance</span>(<span class="title">InputIterator</span> &amp;<span class="title">i</span>, <span class="title">Distance</span> <span class="title">n</span>) &#123;</span></span><br><span class="line">    __advance(i, n, <span class="keyword">iterator_category_t</span>&lt;InputIterator&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•´ç»„ <code>distance()</code> å‡½æ•°</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">difference_type_t</span>&lt;InputIterator&gt; __<span class="title">distance</span>(<span class="title">InputIterator</span> <span class="title">first</span>,</span></span><br><span class="line"><span class="class">                                                   <span class="title">InputIterator</span> <span class="title">last</span>,</span></span><br><span class="line"><span class="class">                                                   <span class="title">input_iterator_tag</span>) &#123;</span></span><br><span class="line">    <span class="keyword">difference_type_t</span>&lt;InputIterator&gt; n = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (first != last) ++first, ++n;</span><br><span class="line">    <span class="keyword">return</span> n;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">difference_type_t</span>&lt;InputIterator&gt; __<span class="title">distance</span>(<span class="title">InputIterator</span> <span class="title">first</span>,</span></span><br><span class="line"><span class="class">                                                   <span class="title">InputIterator</span> <span class="title">last</span>,</span></span><br><span class="line"><span class="class">                                                   <span class="title">random_access_iterator_tag</span>) &#123;</span></span><br><span class="line">    <span class="keyword">return</span> last - first;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">difference_type_t</span>&lt;InputIterator&gt; <span class="title">distance</span>(<span class="title">InputIterator</span> <span class="title">first</span>,</span></span><br><span class="line"><span class="class">                                                 <span class="title">InputIterator</span> <span class="title">last</span>) &#123;</span></span><br><span class="line">    <span class="keyword">return</span> __distance(first, last, <span class="keyword">iterator_category_t</span>&lt;InputIterator&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P102 - P103</p></blockquote><hr><h5 id="2-1-4-5-è¿­ä»£å™¨é€‚é…å™¨"><a class="header-anchor" href="#2-1-4-5-è¿­ä»£å™¨é€‚é…å™¨">Â¶</a>2.1.4.5 è¿­ä»£å™¨é€‚é…å™¨</h5><p><em>insert, reverse, stream</em> è§ <strong>adapters</strong> ç« èŠ‚</p><h3 id="2-2-typeTraits-h"><a class="header-anchor" href="#2-2-typeTraits-h">Â¶</a>2.2 <code>typeTraits.h</code></h3><p><strong>iterator_traits</strong> è´Ÿè´£èƒå–è¿­ä»£å™¨ç‰¹æ€§ï¼Œ<strong>__type_traits</strong> è´Ÿè´£èƒå–å‹åˆ«çš„ç‰¹æ€§ã€‚æ­¤å¤„æ‰€å…³æ³¨çš„å‹åˆ«ç‰¹æ€§æ˜¯æŒ‡ï¼Œè¿™ä¸ªå‹åˆ«æ˜¯å¦å…·å¤‡ <em>non-trivial defalt ctor, non-trivial copy ctor, non-trivial assignment operator, non-trivial dtor</em>ï¼Œå¦‚æœç­”æ¡ˆæ˜¯å¦å®šçš„æˆ‘ä»¬åœ¨å¯¹è¿™ä¸ªå‹åˆ«è¿›è¡Œæ„é€ ã€æ‹·è´ã€èµ‹å€¼ã€ææ„ç­‰æ“ä½œæ—¶ï¼Œå°±å¯ä»¥é‡‡ç”¨æœ€æœ‰æ•ˆçš„æªæ–½ï¼ˆæ ¹æœ¬ä¸ç”¨è°ƒç”¨èº«å±…é«˜ä½ï¼Œä¸è°‹å®äº‹çš„é‚£äº› <code>constructor</code>ï¼Œ<code>destructor</code>ï¼‰ï¼Œè€Œé‡‡ç”¨å†…å­˜ç›´æ¥å¤„ç†æ“ä½œï¼Œå¦‚ <code>malloc()</code>ï¼Œ<code>memcpy()</code> ç­‰ç­‰ï¼Œè·å¾—æœ€é«˜æ•ˆç‡ï¼Œè¿™å¯¹äºå¤§è§„æ¨¡è€Œæ“ä½œé¢‘ç¹çš„å®¹å™¨ï¼Œæœ‰ç€æ˜¾è‘—çš„æ•ˆç‡æå‡ã€‚</p><p><strong>__type_trait</strong> æä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œå…è®¸é’ˆå¯¹ä¸åŒçš„å‹åˆ«å±æ€§ï¼Œåœ¨ç¼–è¯‘å™¨å®Œæˆå‡½æ•°æ´¾é€å†³å®šã€‚è¿™å¯¹äºæ’°å†™æ¨¡æ¿å¾ˆæœ‰å¸®åŠ©ã€‚ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬å‡†å¤‡å¯¹ä¸€ä¸ªâ€œå…ƒç´ å‹åˆ«â€æœªçŸ¥çš„æ•°ç»„æ‰§è¡Œ <em>copy</em> æ“ä½œæ—¶ï¼Œå¦‚æœæˆ‘ä»¬èƒ½å®ç°çŸ¥é“å…¶å…ƒç´ æ˜¯å¦æœ‰ä¸€ä¸ª <code>trivial copy constructor</code>ï¼Œä¾¿èƒ½å¸®åŠ©æˆ‘ä»¬å†³å®šæ˜¯å¦å¯ä»¥ä½¿ç”¨å¿«é€Ÿçš„ <code>memcpy()</code> æˆ– <code>memmove()</code>ã€‚</p><h4 id="2-2-1-éƒ¨åˆ†-type-traits-å®šä¹‰"><a class="header-anchor" href="#2-2-1-éƒ¨åˆ†-type-traits-å®šä¹‰">Â¶</a>2.2.1 éƒ¨åˆ† _type_traits å®šä¹‰</h4><p>é»˜è®¤è‡ªå®šä¹‰ç±»å‹å‡ä¸º non-POD ç±»å‹</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> _<span class="title">type_traits</span> &#123;</span></span><br><span class="line">    <span class="keyword">using</span> has_trivial_default_constructor = _false_type;</span><br><span class="line">    <span class="keyword">using</span> has_trivial_copy_constructor = _false_type;</span><br><span class="line">    <span class="keyword">using</span> has_trivial_assignment_operator = _false_type;</span><br><span class="line">    <span class="keyword">using</span> has_trivial_destructor = _false_type;</span><br><span class="line">    <span class="keyword">using</span> is_POD_type = _false_type;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>é’ˆå¯¹ C++åŸºæœ¬å‹åˆ«ï¼š<em>bool, char, signed char, unsigned char, short, unsigned short, int unsigned int, long, unsigned long, float, double, long double</em> æä¾›äº†ç‰¹åŒ–ç‰ˆæœ¬ï¼Œä¸”æ¯ä¸€ä¸ªæˆå‘˜çš„å€¼éƒ½æ˜¯ <strong>__true_type</strong>ï¼Œè¡¨ç¤ºè¿™äº›å‹åˆ«éƒ½å¯ä»¥é‡‡ç”¨æœ€å¿«é€Ÿæ–¹å¼æ¥è¿›è¡Œæ‹·è´èµ‹å€¼ç­‰æ“ä½œã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;&gt;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">type_traits</span>&lt;bool&gt; &#123;</span>  <span class="comment">//  bool å¯ä»¥æ›¿æ¢ä¸º char....</span></span><br><span class="line">    <span class="keyword">using</span> has_trivial_default_constructor = _true_type;</span><br><span class="line">    <span class="keyword">using</span> has_trivial_copy_constructor = _true_type;</span><br><span class="line">    <span class="keyword">using</span> has_trivial_assignment_operator = _true_type;</span><br><span class="line">    <span class="keyword">using</span> has_trivial_destructor = _true_type;</span><br><span class="line">    <span class="keyword">using</span> is_POD_type = _true_type;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>é’ˆå¯¹åŸç”ŸæŒ‡é’ˆè®¾è®¡ __type_traits åç‰¹åŒ–ç‰ˆæœ¬ï¼ŒåŸç”ŸæŒ‡é’ˆäº¦å¯è¢«è§†ä¸ºä¸€ç§æ ‡é‡å‹åˆ«</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> _<span class="title">type_traits</span>&lt;const T *&gt; &#123;</span></span><br><span class="line">    <span class="keyword">using</span> has_trivial_default_constructor = _true_type;</span><br><span class="line">    <span class="keyword">using</span> has_trivial_copy_constructor = _true_type;</span><br><span class="line">    <span class="keyword">using</span> has_trivial_assignment_operator = _true_type;</span><br><span class="line">    <span class="keyword">using</span> has_trivial_destructor = _true_type;</span><br><span class="line">    <span class="keyword">using</span> is_POD_type = _true_type;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P103 - P111</p><p><a href="https://blog.csdn.net/francisapp/article/details/77063819?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_title-1&amp;spm=1001.2101.3001.4242" target="_blank" rel="noopener">C++ trivialã€non-trivialåŠPODç±»å‹</a></p></blockquote><hr><p>è¿­ä»£å™¨é…æ¥å™¨å†…å®¹è§ï¼š <a href="https://czgitaccount.github.io/C++_Language/STL/Adapter/">STL_Adapter</a></p><hr><h2 id="3-å‚è€ƒèµ„æ–™"><a class="header-anchor" href="#3-å‚è€ƒèµ„æ–™">Â¶</a>3.å‚è€ƒèµ„æ–™</h2><blockquote><p>ã€ŠSTLæºç å‰–æã€‹</p><p>ã€ŠEffective C++ 3rdã€‹</p><p><a href="https://blog.csdn.net/sinat_35261315/article/details/74907096" target="_blank" rel="noopener">C++å‡½æ•°è°ƒç”¨æ—¶çš„å†³è®®ï¼šåå­—æŸ¥æ‰¾ï¼Œé‡è½½å†³è®®ï¼Œå¯è®¿é—®æ€§æ£€æµ‹</a></p><p><a href="https://blog.csdn.net/francisapp/article/details/77063819?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_title-1&amp;spm=1001.2101.3001.4242" target="_blank" rel="noopener">C++ trivialã€non-trivialåŠPODç±»å‹</a></p><p><a href="https://www.bilibili.com/video/BV1RB4y1F7x4?p=10" target="_blank" rel="noopener">ä¾¯æ·C<ins>æ–°æ ‡å‡†-C</ins>11/14_10 Alias Template</a></p><p><a href="https://www.bilibili.com/video/BV1RB4y1F7x4?p=11" target="_blank" rel="noopener">ä¾¯æ·C<ins>æ–°æ ‡å‡†-C</ins>11/14_11 template template parameter</a></p><p><a href="https://czgitaccount.github.io/C++_Language/STL/Adapter/">STL_Adapter</a></p><p>MiniSTL / Iterator éƒ¨åˆ†</p></blockquote><!-- rebuild by neat -->]]></content>
      <categories>
        <category>C++_Language</category>
      </categories>
      <tags>
        <tag>STL</tag>
      </tags>
  </entry>
  <entry>
    <title>STL_Allocator</title>
    <url>/C++_Language/STL/Allocator/</url>
    <content><![CDATA[<!-- build time:Tue Jun 22 2021 17:02:33 GMT+0800 (GMT+08:00) --><a id="more"></a><h1>STL_Allocator</h1><h2 id="1-æ–‡ä»¶ç»“æ„"><a class="header-anchor" href="#1-æ–‡ä»¶ç»“æ„">Â¶</a>1. æ–‡ä»¶ç»“æ„</h2><img src="/C++_Language/STL/Allocator/æ–‡ä»¶ç»“æ„.png" style="zoom:67%"><center><strong>å›¾ 1</strong> Allocator æ–‡ä»¶ç»“æ„</center><p>Allocator æ–‡ä»¶ç»“æ„ä»¥åŠå…³é”®å‡½æ•°å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåˆ†ä¸ºäº†ä¸¤ä¸ªéƒ¨åˆ†ï¼ŒsimpleAllocï¼ŒsubAllocationã€‚</p><h3 id="1-1-simpleAlloc"><a class="header-anchor" href="#1-1-simpleAlloc">Â¶</a>1.1 simpleAlloc</h3><p>å†…éƒ¨åŒ…å« 1 ä¸ªå¤´æ–‡ä»¶ï¼š<code>simpleAlloc.h</code></p><h4 id="1-1-1-simpleAlloc-h"><a class="header-anchor" href="#1-1-1-simpleAlloc-h">Â¶</a>1.1.1 simpleAlloc.h</h4><p><code>simpleAlloc.h</code> è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ç©ºé—´é…ç½®å™¨çš„ä¾‹å­ï¼Œå®ç°äº†éƒ¨åˆ†çš„æ¥å£å’ŒåŠŸèƒ½ã€‚</p><p>å†…éƒ¨<strong>è°ƒç”¨</strong> <strong><font color="FF8888">::operator newã€ ::operator delete</font></strong></p><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P44 - P47</p></blockquote><hr><h3 id="1-2-subAllocation"><a class="header-anchor" href="#1-2-subAllocation">Â¶</a>1.2 subAllocation</h3><p>å†…éƒ¨åŒ…å« 5 ä¸ªå¤´æ–‡ä»¶ï¼š</p><ul><li><code>allocator.h</code></li><li><code>memory.h</code></li><li><code>alloc.h</code></li><li><code>construct.h</code></li><li><code>uninitialized.h</code></li></ul><hr><h4 id="1-2-1-allocator-h"><a class="header-anchor" href="#1-2-1-allocator-h">Â¶</a>1.2.1 allocator.h</h4><p>ä¸ <code>simpleAlloc.h</code> ç›¸ç±»ä¼¼ã€‚å®ƒç”± SGI å®šä¹‰çš„ä¸€ä¸ªç¬¦åˆéƒ¨åˆ†æ ‡å‡†ï¼Œåä¸º allocator çš„é…ç½®å™¨ï¼Œä½†æ˜¯ SGI ä»æœªä½¿ç”¨è¿‡å®ƒï¼Œä¹Ÿä¸å»ºè®®æˆ‘ä»¬ä½¿ç”¨ã€‚ä¸»è¦çš„åŸå› æ˜¯æ•ˆç‡ä¸ä½³ï¼Œåªæ˜¯æŠŠ C++ çš„ <strong><font color="FF8888">::operator new</font></strong> å’Œ <strong><font color="FF8888">::operator delete</font></strong> åšä¸€å±‚è–„è–„çš„åŒ…è£…è€Œå·²ã€‚</p><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P48 - P49</p></blockquote><hr><p>ä½†æ˜¯é‡è¦çš„æ˜¯ SGI STL æŠŠä¸€çº§äºŒçº§é…ç½®å™¨å°è£…åœ¨ <strong>simple_alloc</strong> æ¥å£ä¸­ï¼Œæ‰€æœ‰çš„ SGI STL å®¹å™¨éƒ½æ˜¯ç”¨è¿™ä¸ªæ¥å£ã€‚è¿™ä¸ªæ¥å£å®šä¹‰åœ¨ <code>allocator.h</code> æ–‡ä»¶ä¸­ã€‚ä¸€äºŒçº§é…ç½®å™¨çš„å…³ç³»ï¼Œæ¥å£åŒ…è£…ï¼Œå®é™…è¿ç”¨æ–¹å¼è§ä¸‹å›¾ã€‚</p><img src="/C++_Language/STL/Allocator/é…ç½®å™¨å…³ç³».png" style="zoom:50%"><center><strong>å›¾ 2(a)</strong> ä¸€çº§ï¼ŒäºŒçº§é…ç½®å™¨</center><img src="/C++_Language/STL/Allocator/æ¥å£.png" style="zoom:50%"><center><strong>å›¾ 2(b)</strong> ä¸€çº§ï¼ŒäºŒçº§é…ç½®å™¨çš„åŒ…è£…æ¥å£å’Œè¿ç”¨æ–¹å¼</center><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P53 - P56</p></blockquote><h4 id="1-2-2-memory-h"><a class="header-anchor" href="#1-2-2-memory-h">Â¶</a>1.2.2 memory.h</h4><p>å†…éƒ¨åŒ…å«äº† 3 ä¸ªå¤´æ–‡ä»¶ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"alloc.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"construct.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"uninitialized.h"</span></span></span><br></pre></td></tr></table></figure><p><strong><font color="F08F00">alloc.h</font></strong> å®šä¹‰äº†ä¸€ã€äºŒçº§é…ç½®å™¨ï¼Œå½¼æ­¤åˆä½œã€‚é…ç½®å™¨åä¸º <strong>alloc</strong>ã€‚åˆ©ç”¨ <code>allocate()</code> <strong>åˆ†é…å†…å­˜</strong>ï¼Œåˆ©ç”¨ <code>deallocate()</code> <strong>é‡Šæ”¾å†…å­˜</strong>ã€‚</p><p><strong><font color="F08F00">construct.h</font></strong> å®šä¹‰äº†å…¨å±€å‡½æ•° <code>construct()</code> å’Œ <code>destroy()</code>ï¼Œè´Ÿè´£å¯¹è±¡çš„<strong>æ„é€ </strong>å’Œ<strong>ææ„</strong>ã€‚</p><p><strong><font color="F08F00">uninitialized.h</font></strong> å®šä¹‰äº†ä¸€äº›å…¨å±€å‡½æ•°ï¼Œç”¨æ¥<strong>å¡«å……</strong>æˆ–<strong>å¤åˆ¶</strong>å¤§å—å†…å­˜æ•°æ®ï¼Œè¿™äº›å‡½æ•°è™½ç„¶ä¸å±äºé…ç½®å™¨çš„èŒƒç•´ï¼Œä½†ä¸å¯¹è±¡åˆå€¼è®¾ç½®æœ‰å…³ã€‚å¯¹äºå®¹å™¨çš„å¤§è§„æ¨¡å…ƒç´ åˆå€¼è®¾ç½®å¾ˆæœ‰å¸®åŠ©ã€‚è¿™äº›å‡½æ•°å¯¹äºæ•ˆç‡éƒ½æœ‰é¢é¢ä¿±åˆ°çš„è€ƒè™‘ï¼Œ<strong>æœ€å·®</strong>æƒ…å†µä¸‹ä¼šè°ƒç”¨ <code>construct()</code>ï¼Œ<strong>æœ€ä½³</strong>æƒ…å†µåˆ™ä¼šä½¿ç”¨ C æ ‡å‡†å‡½æ•° <code>memmove()</code> ç›´æ¥è¿›è¡Œå†…å­˜æ•°æ®çš„ç§»åŠ¨ã€‚</p><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P50</p></blockquote><hr><h2 id="2-å…³é”®ä»£ç "><a class="header-anchor" href="#2-å…³é”®ä»£ç ">Â¶</a>2. å…³é”®ä»£ç </h2><h3 id="2-1-construct-h"><a class="header-anchor" href="#2-1-construct-h">Â¶</a>2.1 construct.h</h3><h4 id="2-1-1-å¤´æ–‡ä»¶"><a class="header-anchor" href="#2-1-1-å¤´æ–‡ä»¶">Â¶</a>2.1.1 å¤´æ–‡ä»¶</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;new&gt;  // placement new æ‰€éœ€çš„å¤´æ–‡ä»¶       </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"typeTraits.h"</span> <span class="comment">// èƒå–æœºæ‰€éœ€è¦çš„å¤´æ–‡ä»¶</span></span></span><br></pre></td></tr></table></figure><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P51</p></blockquote><hr><h4 id="2-1-2-æ„é€ "><a class="header-anchor" href="#2-1-2-æ„é€ ">Â¶</a>2.1.2 æ„é€ </h4><p>æ„é€ å‡½æ•°åªæœ‰ä¸€ç§ï¼Œå¯ä»¥ä½¿ç”¨ <strong><font color="FF8888">placement new</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T1</span>, <span class="title">class</span> <span class="title">T2</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">void</span> <span class="title">construct</span>(<span class="title">T1</span> *<span class="title">p</span>, <span class="title">T2</span> <span class="title">value</span>) &#123;</span></span><br><span class="line">    <span class="keyword">new</span> (p) T1(value);  <span class="comment">// placement new, è°ƒç”¨ T1::T1(value)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P51</p></blockquote><hr><h4 id="2-1-3-ææ„"><a class="header-anchor" href="#2-1-3-ææ„">Â¶</a>2.1.3 ææ„</h4><p>ææ„å‡½æ•°æœ‰å››ä¸ªé‡è½½å‡½æ•°ï¼Œ<strong>ç‰ˆæœ¬ä¸€</strong>å°±æ˜¯ç®€å•è°ƒç”¨å¯¹è±¡çš„ææ„å‡½æ•°ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">void</span> <span class="title">destroy</span>(<span class="title">T</span> *<span class="title">p</span>) &#123;</span></span><br><span class="line">    p-&gt;~T();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç‰ˆæœ¬äºŒ</strong>æ¥å—ä¸¤ä¸ªè¿­ä»£å™¨ï¼Œå¹¶æ ¹æ®ä¸åŒçš„å…ƒç´ å‹åˆ«é€‰æ‹©è°ƒç”¨ä¸åŒçš„æ¥å£å‡½æ•°ã€‚<code>destroy()</code> å†…éƒ¨è°ƒç”¨ä¸åŒå‹åˆ«å¯¹åº”çš„æ¥å£å‡½æ•° <code>_destroy_aux()</code>ã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è®¾æ³•åˆ©ç”¨traitsæ‰¹é‡ææ„å¯¹è±¡</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">ForwardIterator</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">void</span> <span class="title">destroy</span>(<span class="title">ForwardIterator</span> <span class="title">beg</span>, <span class="title">ForwardIterator</span> <span class="title">end</span>) &#123;</span> </span><br><span class="line">    <span class="comment">/* typename å¿…é¡»è¦ä½¿ç”¨,å› ä¸ºæ˜¯æ¨¡æ¿çš„åˆ«å */</span></span><br><span class="line">    <span class="keyword">using</span> is_POD_type = <span class="keyword">typename</span> _type_traits&lt;ForwardIterator&gt;::is_POD_type; </span><br><span class="line">    _destroy_aux(beg, <span class="built_in">end</span>, is_POD_type()); <span class="comment">// æ ¹æ®å…ƒç´ å‹åˆ«è°ƒç”¨é€‚é…çš„æ¥å£å‡½æ•°</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœå…ƒç´ çš„ value_type å­˜åœ¨nonâ€”trivial destructorï¼Œè€è€å®å®è°ƒç”¨ææ„å‡½æ•°</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">ForwardIterator</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">void</span> _<span class="title">destroy_aux</span>(<span class="title">ForwardIterator</span> <span class="title">beg</span>, <span class="title">ForwardIterator</span> <span class="title">end</span>, _<span class="title">false_type</span>) &#123;</span></span><br><span class="line">    <span class="keyword">for</span> (; beg != <span class="built_in">end</span>; ++beg) destroy(&amp;*beg);  <span class="comment">// æ¯•ç«Ÿè¿­ä»£å™¨ä¸æ˜¯çœŸæ­£çš„åœ°å€</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å­˜åœ¨trivial destructor</span></span><br><span class="line"><span class="comment">// å¦‚æœå¯¹è±¡çš„ææ„å‡½æ•°æ— å…³ç—›ç—’ï¼Œé‚£ä¹ˆåå¤è°ƒç”¨å®ƒæ˜¯ä¸€ç§æ•ˆç‡ä¸Šçš„å·¨å¤§æµªè´¹</span></span><br><span class="line"><span class="comment">/* å› æ­¤ï¼Œè‹¥æ˜¯_true_type çš„è¯å°±ä»€ä¹ˆä¹Ÿä¸åšå°±ç»“æŸ*/</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">ForwardIterator</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">void</span> _<span class="title">destroy_aux</span>(<span class="title">ForwardIterator</span>, <span class="title">ForwardIterator</span>, _<span class="title">true_type</span>) &#123;</span>&#125;</span><br></pre></td></tr></table></figure><p><strong>ç‰ˆæœ¬ä¸‰ã€å››</strong>æ˜¯å¯¹åº” <strong>char</strong>* å’Œ <strong>wchar_t</strong>* çš„ç‰¹åŒ–ç‰ˆæœ¬ã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å› ä¸º char* å’Œ wchar_t* å½’äº POD ç±»å‹ï¼Œå±äº trivial ç±»å‹ï¼Œ--&gt; _true_type</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">(<span class="keyword">char</span> *, <span class="keyword">char</span> *)</span> </span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">(<span class="keyword">wchar_t</span> *, <span class="keyword">wchar_t</span> *)</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å¯ä»¥å‚è€ƒ <a href="https://blog.csdn.net/francisapp/article/details/77063819?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_title-1&amp;spm=1001.2101.3001.4242" target="_blank" rel="noopener">C++ trivialã€non-trivialåŠPODç±»å‹</a></p><p>â€œtypeTraits.hâ€ å¤´æ–‡ä»¶ä¸­æœ‰è¯¦ç»†çš„åˆ†ç±»</p><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P51</p></blockquote><hr><h3 id="2-2-alloc-h"><a class="header-anchor" href="#2-2-alloc-h">Â¶</a>2.2 alloc.h</h3><p><code>alloc.h</code> ä¸º <strong>sub-Allocation</strong> çš„ä¸»è¦å®ç°ï¼Œ<strong>sub-Allocation</strong> ç†è§£ä¸ºå…·æœ‰æ¬¡é…ç½®çš„ç©ºé—´é…ç½®å™¨ï¼Œåˆ†ä¸ºä¸¤çº§é…ç½®ã€‚</p><ul><li>ä¸€çº§é…ç½®å™¨ <strong>_malloc_alloc</strong>ï¼Œåˆ†é…å†…å­˜ $&gt; 128\ bytes$</li><li>äºŒçº§é…ç½®å™¨ <strong>_default_alloc</strong>ï¼Œåˆ†é…å†…å­˜ $\leq 128\ bytes$</li></ul><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P53 - P56</p></blockquote><hr><h4 id="2-2-1-å¤´æ–‡ä»¶"><a class="header-anchor" href="#2-2-1-å¤´æ–‡ä»¶">Â¶</a>2.2.1 å¤´æ–‡ä»¶</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;   // malloc free realloc</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;new&gt;		 // bad_alloc </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;  // memcpy</span></span></span><br></pre></td></tr></table></figure><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P56</p></blockquote><hr><h4 id="2-2-2-ä¸€çº§é…ç½®å™¨"><a class="header-anchor" href="#2-2-2-ä¸€çº§é…ç½®å™¨">Â¶</a>2.2.2 ä¸€çº§é…ç½®å™¨</h4><p>ä¸€çº§é…ç½®å™¨ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªä¸»è¦åŠŸèƒ½ï¼š</p><ul><li>åˆ†é…å’Œé‡Šæ”¾å†…å­˜</li><li>å¤„ç†å†…å­˜ä¸è¶³çš„çŠ¶å†µ</li></ul><h5 id="2-2-2-1-åˆ†é…å’Œé‡Šæ”¾å†…å­˜"><a class="header-anchor" href="#2-2-2-1-åˆ†é…å’Œé‡Šæ”¾å†…å­˜">Â¶</a>2.2.2.1 åˆ†é…å’Œé‡Šæ”¾å†…å­˜</h5><p><code>allocate()</code> ç›´æ¥ä½¿ç”¨ <code>malloc()</code> ï¼›</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> *<span class="title">allocate</span><span class="params">(<span class="keyword">size_t</span> n)</span> </span>&#123;</span><br><span class="line">	<span class="comment">// ä½¿ç”¨ malloc åˆ†é…å†…å­˜</span></span><br><span class="line">	<span class="keyword">void</span> *result = <span class="built_in">malloc</span>(n);</span><br><span class="line">	<span class="comment">// å¦‚æœåˆ†é…å†…å­˜å¤±è´¥ï¼Œè°ƒç”¨ oom_malloc å¤„ç†ï¼Œ ç±»ä¼¼äº new_handler</span></span><br><span class="line">	<span class="keyword">if</span> (result == <span class="literal">nullptr</span>) result = oom_malloc(n);</span><br><span class="line">	<span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>deallocate()</code> ç›´æ¥ä½¿ç”¨ <code>free()</code> ï¼›</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// deallocate é‡Šæ”¾å†…å­˜ï¼Œå†…éƒ¨è°ƒç”¨ free</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">deallocate</span><span class="params">(<span class="keyword">void</span> *p, <span class="keyword">size_t</span> <span class="comment">/*n*/</span>)</span> </span>&#123; <span class="built_in">free</span>(p); &#125;</span><br></pre></td></tr></table></figure><p><code>reallocate()</code> ç›´æ¥ä½¿ç”¨ <code>reallocate()</code> ï¼›</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// reallocate ä¿®æ”¹åˆ†é…å†…å­˜ï¼Œå†…éƒ¨è°ƒç”¨ realloc</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> *<span class="title">reallocate</span><span class="params">(<span class="keyword">void</span> *p, <span class="keyword">size_t</span> <span class="comment">/*old_sz*/</span>, <span class="keyword">size_t</span> new_sz)</span> </span>&#123;</span><br><span class="line">	<span class="comment">// ä½¿ç”¨ realloc é‡æ–°åˆ†é…å†…å­˜ï¼Œ å¦‚æœ new_sz = nullptr  realloc ç­‰ä»·äº malloc</span></span><br><span class="line">	<span class="keyword">void</span> *result = <span class="built_in">realloc</span>(p, new_sz);</span><br><span class="line">	<span class="comment">// å¦‚æœåˆ†é…å†…å­˜å¤±è´¥ï¼Œè°ƒç”¨ oom_realloc å¤„ç†ï¼Œ ç±»ä¼¼äº new_handler</span></span><br><span class="line">	<span class="keyword">if</span> (result == <span class="literal">nullptr</span>) oom_realloc(p, new_sz);</span><br><span class="line">	<span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°ï¼Œä¸‰ä¸ªå‡½æ•°çš†æ˜¯ç›´æ¥ä½¿ç”¨åº“å‡½æ•°æ¥å®ç°ï¼Œä½†æ˜¯è¿›è¡Œäº†å†…å­˜åˆ†é…å¤±è´¥çš„å¤„ç† <code>oom_malloc(n)</code>ï¼Œ<code>oom_realloc(n)</code>ã€‚</p><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P57</p></blockquote><hr><h5 id="2-2-2-2-å¤„ç†å†…å­˜ä¸è¶³çš„çŠ¶å†µ"><a class="header-anchor" href="#2-2-2-2-å¤„ç†å†…å­˜ä¸è¶³çš„çŠ¶å†µ">Â¶</a>2.2.2.2 å¤„ç†å†…å­˜ä¸è¶³çš„çŠ¶å†µ</h5><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> malloc_handler = <span class="keyword">void</span> (*)();</span><br><span class="line"><span class="comment">//ä»¥ä¸‹å‡½æ•°æŒ‡é’ˆç”¨ä»¥å¤„ç†å†…å­˜ä¸è¶³çš„æƒ…å†µ (ä¸¤ä¸ªé™æ€å‡½æ•°ï¼Œä¸€ä¸ªé™æ€æˆå‘˜å˜é‡(å‡½æ•°æŒ‡é’ˆ))</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> *<span class="title">oom_malloc</span><span class="params">(<span class="keyword">size_t</span>)</span></span>;  <span class="comment">// å¤„ç† allocate å¤±è´¥</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> *<span class="title">oom_realloc</span><span class="params">(<span class="keyword">void</span> *, <span class="keyword">size_t</span>)</span></span>; <span class="comment">// å¤„ç† realloc å¤±è´¥</span></span><br><span class="line"><span class="keyword">static</span> malloc_handler __malloc_alloc_oom_handler; <span class="comment">// ç±»ä¼¼ new_handler ç”¨æˆ·å¤„ç†å‡½æ•°</span></span><br></pre></td></tr></table></figure><hr><p>ä¸ºäº†æ¨¡æ‹Ÿ <strong><font color="FF8888">set_new_handler</font></strong> è¡Œä¸ºï¼Œéœ€è¦å†™ä¸€ä¸ªç±»ä¼¼æ ‡å‡†ç‰ˆçš„<code>set_malloc_handler()</code></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ¨¡æ‹Ÿ C++ çš„ set_new_handler(), å¯ä»¥é€šè¿‡å®ƒæ¥æŒ‡å®šè‡ªå·±çš„ out-of-memory handler</span></span><br><span class="line"><span class="comment">// Effective c++ æ¡æ¬¾ 49</span></span><br><span class="line"><span class="comment">// set_malloc_handler ä¼šå°†å®ƒè·å¾—çš„æŒ‡é’ˆå­˜å‚¨èµ·æ¥ï¼Œç„¶åè¿”å›å…ˆå‰ï¼ˆåœ¨æ­¤è°ƒç”¨ä¹‹å‰ï¼‰å­˜å‚¨çš„æŒ‡é’ˆ</span></span><br><span class="line"><span class="comment">// ç”¨æ¥ç®¡ç†é™æ€æˆå‘˜å˜é‡ __malloc_alloc_oom_handler</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> malloc_handler <span class="title">set_malloc_handler</span><span class="params">(malloc_handler f)</span> </span>&#123;</span><br><span class="line">	malloc_handler old = __malloc_alloc_oom_handler;</span><br><span class="line">	__malloc_alloc_oom_handler = f;</span><br><span class="line">	<span class="keyword">return</span> old;</span><br><span class="line">&#125; <span class="comment">// ç±»å†…æˆå‘˜å‡½æ•° â†‘ å…±ç”¨æˆ·è°ƒç”¨è£…é…è‡ªå·±çš„ å¤„ç†å‡½æ•°</span></span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// __malloc_alloc_oom_handlerçš„ç±»å¤–å®šä¹‰ï¼Œå‡½æ•°æŒ‡é’ˆä¸º nullptr</span></span><br><span class="line"><span class="keyword">typename</span> __malloc_alloc::malloc_handler</span><br><span class="line">    __malloc_alloc::__malloc_alloc_oom_handler = <span class="literal">nullptr</span>;</span><br></pre></td></tr></table></figure><blockquote><p>ã€ŠEffective C++ 3rdã€‹ â€“ æ¡æ¬¾49ï¼šäº†è§£ new-handler çš„è¡Œä¸º ï¼ˆP243ï¼‰</p><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P57</p></blockquote><hr><p><code>oom_malloc()</code> ç”¨æ¥è‡ªå®šä¹‰å¤„ç† <strong>malloc</strong> åˆ†é…å¤±è´¥çš„æƒ…å†µã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">__malloc_alloc::oom_malloc</span><span class="params">(<span class="keyword">size_t</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// void(*new_alloc_handler)();</span></span><br><span class="line">    malloc_handler new_alloc_handler;  <span class="comment">// å®šä¹‰ new_handler</span></span><br><span class="line">    <span class="keyword">void</span> *result;</span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;  <span class="comment">//ä¸æ–­å°è¯•é‡Šæ”¾ã€é…ç½®</span></span><br><span class="line">		<span class="comment">// åˆ†é…å¤±è´¥ï¼šæ‰¾åˆ°ç›®å‰çš„ new_handing å‡½æ•°ï¼Œä¹‹å‰ç”±ç”¨æˆ·è°ƒç”¨ set_malloc_handler åˆ›å»º</span></span><br><span class="line">        new_alloc_handler = __malloc_alloc_oom_handler;</span><br><span class="line">        <span class="comment">// åªæœ‰å½“ malloc-handling å‡½æ•°çš„æŒ‡é’ˆæ˜¯ null, æ‰ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</span></span><br><span class="line">        <span class="keyword">if</span> (!new_alloc_handler) <span class="keyword">throw</span> <span class="built_in">std</span>::bad_alloc(); </span><br><span class="line">        (*new_alloc_handler)();    <span class="comment">// è°ƒç”¨ handlerï¼Œè¯•å›¾é‡Šæ”¾å†…å­˜</span></span><br><span class="line"></span><br><span class="line">        result = <span class="built_in">malloc</span>(n);        <span class="comment">// å†æ¬¡åˆ†é…å†…å­˜</span></span><br><span class="line">        <span class="keyword">if</span> (result) <span class="keyword">return</span> result; <span class="comment">// å¦‚æœæˆåŠŸï¼Œè¿”å›ä¸€ä¸ªæŒ‡å‘åˆ†é…å¾—æ¥çš„å†…å­˜çš„ä¸€ä¸ªæŒ‡é’ˆ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>oom_realloc()</code> ç”¨æ¥è‡ªå®šä¹‰å¤„ç† <strong>remalloc</strong> åˆ†é…å¤±è´¥çš„æƒ…å†µã€‚ä¸ä¸Šæ–‡ä»£ç ç›¸åŒï¼Œä»…ä»… <code>è¡Œ: 8</code> ä¸åŒã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">__malloc_alloc::oom_realloc</span><span class="params">(<span class="keyword">void</span> *p, <span class="keyword">size_t</span> n)</span> </span>&#123;</span><br><span class="line">    malloc_handler new_alloc_handler; <span class="comment">// å®šä¹‰ new_handler</span></span><br><span class="line">    <span class="keyword">void</span> *result; </span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        new_alloc_handler = __malloc_alloc_oom_handler;</span><br><span class="line">        <span class="keyword">if</span> (!new_alloc_handler) <span class="keyword">throw</span> <span class="built_in">std</span>::bad_alloc();</span><br><span class="line">        (*new_alloc_handler)();</span><br><span class="line">        result = <span class="built_in">realloc</span>(p, n); </span><br><span class="line">        <span class="keyword">if</span> (result) <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°çš„å¤„ç†å‡½æ•°æ­¥éª¤å¦‚ä¸‹ï¼š</p><ul><li><p>ç”¨æˆ·è°ƒç”¨ <code>set_malloc_handler()</code> è‡ªå®šä¹‰è‡ªå·±çš„å¤„ç†å‡½æ•°ï¼Œå¦‚æœæœªå®šä¹‰ï¼Œ<strong>_malloc_alloc_oom_handler</strong> è¢«é»˜è®¤å®šä¹‰ä¸º <strong>nullptr</strong>ï¼Œæ˜¯ä¸€ä¸ªç©ºæŒ‡é’ˆã€‚</p></li><li><p>å¦‚æœå‡ºç°å†…å­˜åˆ†é…å¤±è´¥æƒ…å†µï¼Œè¿›å…¥ç›¸åº”çš„å¤„ç†å‡½æ•°ï¼Œ<code>oom_malloc()</code> æˆ–è€… <code>oom_realloc()</code></p><ul><li>é¦–å…ˆå®šä¹‰å¤„ç†å‡½æ•° <strong>new_alloc_handler</strong> å¹¶å°† <strong>_malloc_alloc_oom_handler</strong> èµ‹ç»™å®ƒï¼›</li><li>å¦‚æœç”¨æˆ·<strong>æœªå®šä¹‰</strong>ç›¸åº”çš„å¤„ç†å‡½æ•°ï¼Œç›´æ¥æŠ›å‡ºå¼‚å¸¸å³å¯ï¼›å¦åˆ™è°ƒç”¨ç”¨æˆ·å®šä¹‰çš„å¤„ç†å‡½æ•°ï¼Œè¯•å›¾è§£å†³å†…å­˜ä¸è¶³çš„æƒ…å†µï¼›</li><li>å†æ¬¡é‡æ–°è°ƒç”¨ <code>malloc()</code> åˆ†é…å†…å­˜ï¼›</li></ul></li></ul><p><strong><font color="FF8888">æ³¨æ„</font></strong>ï¼š</p><ul><li><p>è®¾è®¡å’Œè®¾å®šâ€œå†…å­˜ä¸è¶³å¤„ç†å‡½æ•°â€æ˜¯å®¢ç«¯çš„è´£ä»»ã€‚</p></li><li><p>å…¶ä¸­ <code>for (;;)</code> çš„ä½¿ç”¨å¯ä»¥ä½¿å¾—å¤„ç†å‡½æ•°<strong>ä¸æ–­å°è¯•</strong>å¤„ç†å†…å­˜ä¸è¶³æƒ…å†µã€‚</p></li></ul><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P58 - P59</p><p>ã€ŠEffective C++ 3rdã€‹ â€“ æ¡æ¬¾51ï¼šç¼–å†™ new å’Œ delete æ—¶éœ€å›ºå®ˆçš„å¸¸è§„ ï¼ˆP253ï¼‰</p></blockquote><hr><h4 id="2-2-3-äºŒçº§é…ç½®å™¨"><a class="header-anchor" href="#2-2-3-äºŒçº§é…ç½®å™¨">Â¶</a>2.2.3 äºŒçº§é…ç½®å™¨</h4><p>äºŒçº§é…ç½®å™¨å¤šäº†ä¸€äº›æœºåˆ¶ï¼Œé¿å…å¤ªå¤šå°é¢å¤–åŒºå—é€ æˆå†…å­˜çš„ç¢ç‰‡ã€‚å°é¢åŒºå—å¸¦æ¥çš„å…¶å®ä¸ä»…æ—¶å†…å­˜ç¢ç‰‡ï¼Œé…ç½®æ—¶çš„é¢å¤–è´Ÿæ‹…ä¹Ÿæ˜¯ä¸€ä¸ªå¤§é—®é¢˜ã€‚é¢å¤–è´Ÿæ‹…æ°¸è¿œæ— æ³•é¿å…ï¼Œæ¯•ç«Ÿç³»ç»Ÿè¦é è¿™å¤šå‡ºæ¥çš„ç©ºé—´æ¥ç®¡ç†å†…å­˜ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ä½†æ˜¯å—åŒºè¶Šå°ï¼Œé¢å¤–è´Ÿæ‹…æ‰€å çš„æ¯”ä¾‹å°±è¶Šå¤§ï¼Œè¶Šæ˜¾å¾—æµªè´¹ã€‚</p><img src="/C++_Language/STL/Allocator/å†…å­˜ç®¡ç†.png" style="zoom:50%"><center><strong>å›¾ 3</strong> æ‰€æ±‚ä»»ä½•ä¸€å—å†…å­˜ï¼Œéƒ½å¾—æœ‰ä¸€äº›â€œç¨â€è¦ç¼´ç»™ç³»ç»Ÿ</center><p>SGI ç¬¬äºŒçº§é…ç½®å™¨çš„åšæ³•æ˜¯ï¼Œå¦‚æœåŒºå—å¤Ÿå¤§ï¼Œè¶…è¿‡ 128 $bytes$ æ—¶ï¼Œå°±ç§»äº¤ç»™ç¬¬ä¸€çº§é…ç½®å™¨å¤„ç†ã€‚å½“åŒºå—å°äº 128 $bytes$ æ—¶ï¼Œåˆ™ä»¥å†…å­˜æ± ï¼ˆ<strong>memory pool</strong>ï¼‰ç®¡ç†ï¼Œæ­¤æ³•åˆç§°ä¸ºæ¬¡å±‚é…ç½®ï¼ˆ<strong>sub-allocation</strong>)ï¼šæ¯æ¬¡é…ç½®ä¸€å¤§å—å†…å­˜ï¼Œå¹¶ç»´æŠ¤å¯¹åº”ä¹‹è‡ªç”±é“¾è¡¨ï¼ˆ<em>freeâ€‹-listâ€‹</em>ï¼‰ï¼Œä¸‹æ¬¡è‹¥å†æœ‰ç›¸åŒå¤§å°çš„å†…å­˜éœ€æ±‚ï¼Œå°±ç›´æ¥ä» â€‹<em>free-listâ€‹</em> ä¸­æ‹”å‡ºã€‚å¦‚æœå®¢ç«¯é‡Šæ”¾å°é¢åŒºå—ï¼Œå°±ç”±é…ç½®å™¨æ”¶å›åˆ° <em>free-listâ€‹</em> ä¸­ã€‚</p><h5 id="2-2-3-1-è‡ªç”±é“¾è¡¨"><a class="header-anchor" href="#2-2-3-1-è‡ªç”±é“¾è¡¨">Â¶</a>2.2.3.1 è‡ªç”±é“¾è¡¨</h5><p><em>freeâ€‹-listâ€‹</em> èŠ‚ç‚¹<strong>ç»“æ„</strong>å¦‚ä¸‹ï¼Œå®ç°æŠ€å·§å¦‚ä¸‹å›¾ 4 æ‰€ç¤ºã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// free_listèŠ‚ç‚¹</span></span><br><span class="line">    <span class="comment">// ç”±äºunionç‰¹æ€§ï¼Œå¹¶ä¸éœ€è¦å ç”¨é¢å¤–çš„å†…å­˜</span></span><br><span class="line">	<span class="comment">// obj å¯ä»¥è¢«è§†ä¸ºä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘ç›¸åŒå½¢å¼çš„å¦ä¸€ä¸ªobj</span></span><br><span class="line">	<span class="comment">// obj ä¹Ÿå¯è¢«è§†ä¸ºä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘å®é™…å—åŒº</span></span><br><span class="line"><span class="keyword">union</span> obj &#123;</span><br><span class="line">	<span class="keyword">union</span> obj *free_list_link;  <span class="comment">//æŒ‡å‘ä¸‹ä¸€èŠ‚ç‚¹</span></span><br><span class="line">	<span class="keyword">char</span> client_data[<span class="number">1</span>];        <span class="comment">//æŒ‡å‘èµ„æº</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><img src="/C++_Language/STL/Allocator/è‡ªç”±é“¾è¡¨çš„å®ç°æŠ€å·§.png" style="zoom:50%"><center><strong>å›¾ 4</strong> è‡ªç”±é“¾è¡¨çš„å®ç°æŠ€å·§</center><p>ä¸ºäº†æ–¹ä¾¿ç®¡ç†ï¼ŒSGI äºŒçº§é…ç½®å™¨ä¼šä¸»åŠ¨ä½¿ç”¨ <code>ROUND_UP()</code>å‡½æ•°å°†ä»»ä½•å°é¢åŒºå—çš„å†…å­˜éœ€æ±‚é‡ä¸Šè°ƒè‡³ 8 çš„å€æ•°ï¼Œå¹¶ç»´æŠ¤ 16 ä¸ª <em>free-list</em> ã€‚ä» ${8,16,â€¦128}$ã€‚ä½¿ç”¨ <code>FREELIST_INDEX()</code> å‡½æ•°ç¡®å®šåŒºå—ç¼–å·ã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// freelistå‚æ•°è®¾å®š</span></span><br><span class="line"><span class="comment">// åŒºå—ä¸Šè°ƒè¾¹ç•Œï¼ŒåŒºå—ä¸Šé™ï¼Œfreelistä¸ªæ•°</span></span><br><span class="line"><span class="comment">// Effective C++ æ‰€è¿° enum æƒ¯ç”¨æ³•,æ¡æ¬¾ 2</span></span><br><span class="line"><span class="keyword">enum</span> __freelist_setting &#123;</span><br><span class="line">    __ALIGN = <span class="number">8</span>, </span><br><span class="line">    __MAX_BYTES = <span class="number">128</span>,</span><br><span class="line">    __NFREELISTS = __MAX_BYTES / __ALIGN  <span class="comment">// 16</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å…³äº <strong>_freelist_setting</strong> çš„ç›¸å…³æ“ä½œ</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å°†bytesä¸Šè°ƒè‡³8çš„å€æ•°</span></span><br><span class="line"><span class="comment">// ä¾‹å­ï¼š(bytes + 7) &amp; ~7  --- &gt;  (bytes + 7) &amp; 1..11000</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">size_t</span> <span class="title">ROUND_UP</span><span class="params">(<span class="keyword">size_t</span> bytes)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> (((bytes) + <span class="keyword">static_cast</span>&lt;<span class="keyword">size_t</span>&gt;(__ALIGN) - <span class="number">1</span>) &amp;</span><br><span class="line">			~(<span class="keyword">static_cast</span>&lt;<span class="keyword">size_t</span>&gt;(__ALIGN) - <span class="number">1</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åˆ›å»º free_list[16] æ•°ç»„, é‡Œé¢å­˜æ”¾ obj* ç±»å‹æ•°æ®</span></span><br><span class="line"><span class="keyword">static</span> obj *<span class="keyword">volatile</span> free_list[__NFREELISTS];</span><br><span class="line"></span><br><span class="line"><span class="comment">// å†³å®šä½¿ç”¨ç¬¬å‡ å·èŠ‚ç‚¹ï¼Œä» 0 èµ·ç®— (æœ¬è´¨å°±æ˜¯å°±åç§»)</span></span><br><span class="line"><span class="comment">// ((1~7) + 7) / 8 - 1 ---&gt; 0   .... ä¾æ¬¡ç±»æ¨</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">size_t</span> <span class="title">FREELIST_INDEX</span><span class="params">(<span class="keyword">size_t</span> bytes)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (bytes + <span class="keyword">static_cast</span>&lt;<span class="keyword">size_t</span>&gt;(__ALIGN) - <span class="number">1</span>) /</span><br><span class="line">        <span class="keyword">static_cast</span>&lt;<span class="keyword">size_t</span>&gt;(__ALIGN) - <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P59 - P61</p><p>ã€ŠEffective C++ 3rdã€‹ â€“ æ¡æ¬¾2ï¼šå°½é‡ç”¨ <em>const,enum,inline</em> æ›¿ä»£ #define ï¼ˆP15ï¼‰</p></blockquote><hr><h5 id="2-2-3-2-ç©ºé—´é…ç½®å‡½æ•°-allocate"><a class="header-anchor" href="#2-2-3-2-ç©ºé—´é…ç½®å‡½æ•°-allocate">Â¶</a>2.2.3.2 ç©ºé—´é…ç½®å‡½æ•° <code>allocate()</code></h5><p>ç©ºé—´é…ç½®å‡½æ•°ä¸º <code>allocate()</code>ï¼Œå¦‚æœéœ€è¦åˆ†é…çš„å†…å­˜å¤§äº 128 åˆ™é‡‡ç”¨ä¸€çº§é…ç½®å™¨ï¼Œå¦åˆ™ä»è‡ªç”±é“¾è¡¨ä¸­æ‹”å‡ºå†…å­˜ä½¿ç”¨ï¼Œå¦‚æœè‡ªç”±é“¾è¡¨æ²¡æœ‰æ²¡å­˜å°±éœ€è¦è°ƒç”¨ <code>refill()</code> æ¥å¡«å……è‡ªç”±é“¾è¡¨ã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">__default_alloc::allocate</span><span class="params">(<span class="keyword">size_t</span> n)</span> </span>&#123;  <span class="comment">/*n &gt; 0*/</span></span><br><span class="line">    obj *<span class="keyword">volatile</span> *my_free_list;</span><br><span class="line">    obj *result;</span><br><span class="line">    <span class="comment">// è‹¥ n å¤§äº128,åˆ™é‡‡ç”¨ä¸€çº§é…ç½®å™¨</span></span><br><span class="line">    <span class="keyword">if</span> (n &gt; __MAX_BYTES) <span class="keyword">return</span> (malloc_alloc::allocate(n));</span><br><span class="line">    </span><br><span class="line">	<span class="comment">// free_list æ˜¯ä¸€ä¸ªå­˜ obj*çš„æ•°ç»„, æ•°ç»„åä¸ºfree_list[0]æŒ‡é’ˆ</span></span><br><span class="line">    <span class="comment">// é€šè¿‡ FREELIST_INDEX æ±‚å‡ºåç§»ï¼Œå¹¶é€‰æ‹©é‡‡ç”¨ç¬¬å‡ åŒºå—ï¼Œå¹¶è®© result æŒ‡å‘å®ƒ</span></span><br><span class="line">    my_free_list = free_list + FREELIST_INDEX(n);</span><br><span class="line">    result = *my_free_list;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (result == <span class="literal">nullptr</span>) &#123;</span><br><span class="line">        <span class="comment">// æœªæ‰¾åˆ°å¯ç”¨free_listï¼Œå‡†å¤‡å¡«å……free_list</span></span><br><span class="line">        <span class="keyword">void</span> *r = refill(ROUND_UP(n));</span><br><span class="line">        <span class="keyword">return</span> r; <span class="comment">// å¹¶ä¸”è¿”å›ä¸€ä¸ªæŒ‡å‘å†…å­˜çš„æŒ‡é’ˆ</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å°† my_free_list æŒ‡å‘ï¼Œå½“å‰ result èŠ‚ç‚¹çš„ next (free_list_link)</span></span><br><span class="line">    *my_free_list = result-&gt;free_list_link;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="/C++_Language/STL/Allocator/åŒºå—è‡ªfreelistæ‹”å‡º.png" style="zoom:50%"><center><strong>å›¾ 5</strong> åŒºå—è‡ª <i>free-list</i> æ‹”å‡º</center><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P62 - P63</p></blockquote><hr><h5 id="2-2-3-3-ç©ºé—´é‡Šæ”¾å‡½æ•°-deallocate"><a class="header-anchor" href="#2-2-3-3-ç©ºé—´é‡Šæ”¾å‡½æ•°-deallocate">Â¶</a>2.2.3.3 ç©ºé—´é‡Šæ”¾å‡½æ•° <code>deallocate()</code></h5><p>åŒæ ·éœ€è¦åˆ¤æ–­åŒºå—å¤§å°ï¼Œå¤§äº128 å­—èŠ‚ï¼Œä½¿ç”¨ä¸€çº§é…ç½®å™¨ï¼Œå°äº128 å­—èŠ‚å°±æ‰¾åˆ°å¯¹åº”çš„ <em>free-list</em>ï¼Œå°†åŒºå—å›æ”¶ã€‚</p><p>åˆ†ä¸ºå››ä¸ªæ­¥éª¤</p><ul><li>å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œå°† <em>p</em> è½¬åŒ–ä¸º <em>obj*</em> èŠ‚ç‚¹ç±»å‹ <em>q</em> ï¼Œä½¿ç”¨ <em>reinterpret_cast</em> å°† <em>void* -&gt; obj*</em></li><li>æ ¹æ®å†…å­˜çš„å¤§å°ç¡®å®šåŒºå—ï¼Œè°ƒç”¨ <code>FREELIST_INDEX()</code></li><li>å°† <em>q</em> çš„ next åŒºå—æŒ‡å‘å½“å‰ <strong>my_free_list</strong> æŒ‡å‘çš„å†…å­˜</li><li>æ›´æ–° <em>my_free_list</em> ä¸º <em>q</em></li></ul><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">__default_alloc::deallocate</span><span class="params">(<span class="keyword">void</span> *p, <span class="keyword">size_t</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// pä¸å¯ä¸ºnullptrï¼Œå¤§äº128å­—èŠ‚ï¼Œå°±è°ƒç”¨ä¸€çº§é…ç½®å™¨</span></span><br><span class="line">    <span class="keyword">if</span> (n &gt; <span class="keyword">static_cast</span>&lt;<span class="keyword">size_t</span>&gt;(__MAX_BYTES))</span><br><span class="line">        malloc_alloc::deallocate(p, n);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å¯»æ‰¾å¯¹åº”çš„free list, åˆ†ä¸ºå››ä¸ªæ­¥éª¤ ï¼š</span></span><br><span class="line">		<span class="comment">// 1ï¼šå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œå°† p è½¬åŒ–ä¸º q çš„ èŠ‚ç‚¹ç±»å‹æŒ‡é’ˆ</span></span><br><span class="line">		<span class="comment">// ä½¿ç”¨ reinterpret_cast å°† void* -&gt; obj* </span></span><br><span class="line">        obj *q = <span class="keyword">reinterpret_cast</span>&lt;obj *&gt;(p);</span><br><span class="line">		<span class="comment">// 2ï¼šæ ¹æ®å†…å­˜çš„å¤§å°ç¡®å®šåŒºå— </span></span><br><span class="line">        obj *<span class="keyword">volatile</span> *my_free_list = free_list + FREELIST_INDEX(n);</span><br><span class="line">		<span class="comment">// 3ï¼šå°† q çš„ä¸‹ä¸€åŒºå—æŒ‡å‘å½“å‰ my_free_list æŒ‡å‘çš„å†…å­˜</span></span><br><span class="line">        q-&gt;free_list_link = *my_free_list;</span><br><span class="line">		<span class="comment">// 4ï¼šæ›´æ–° my_free_list ä¸º q</span></span><br><span class="line">        *my_free_list = q;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="/C++_Language/STL/Allocator/åŒºå—å›æ”¶_çº³å…¥freelist.png" style="zoom:50%"><center><strong>å›¾ 6</strong> åŒºå—å›æ”¶ï¼Œçº³å…¥ <i>free-list</i></center><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P64 - P65</p></blockquote><hr><h5 id="2-2-3-4-ç©ºé—´é‡é…ç½®å‡½æ•°-reallocate"><a class="header-anchor" href="#2-2-3-4-ç©ºé—´é‡é…ç½®å‡½æ•°-reallocate">Â¶</a>2.2.3.4 ç©ºé—´é‡é…ç½®å‡½æ•° <code>reallocate()</code></h5><p>æ ¹æ®æ–°æ—§å†…å­˜éœ€æ±‚çš„å¤§å°å…³ç³»å¯ä»¥åˆ†ä¸ºäº”ç§æƒ…å†µï¼Œåˆ†åˆ«å¯¹åº”è¿™ä¸‰ç§å¤„ç†æ–¹å¼ã€‚</p><ul><li>â‘  <em>old_sz &gt; 128, new_sz &gt; 128â€‹</em> ï¼Œç›´æ¥ä½¿ç”¨ <code>realloc()</code> ï¼›</li><li>â‘¡ <code>ROUND_UP(old_sz)</code> == <code>ROUND_UP(new_sz)</code> <em>&lt;= 128â€‹</em>ï¼šç›´æ¥è¿”å›åŸå†…å­˜æŒ‡é’ˆå³å¯ï¼›</li><li><code>ROUND_UP(old_sz)</code> != <code>ROUND_UP(new_sz)</code> ï¼Œç»Ÿä¸€è°ƒç”¨ <code>allocate()</code> å‡½æ•°ï¼Œåªæ˜¯å†…éƒ¨æ ¹æ® <em>new_sz</em> çš„å¤§å°ä½¿ç”¨ä¸åŒçš„é…ç½®å™¨ã€‚<ul><li>â‘¢ <em>old_sz &gt; 128, new_sz &lt;= 128</em> ï¼šåˆ™ä¼šä½¿ç”¨äºŒçº§é…ç½®å™¨ï¼›</li><li>â‘£ <em>old_sz &lt;= 128, new_sz &gt; 128</em> ï¼šåˆ™ä¼šä½¿ç”¨ä¸€çº§é…ç½®å™¨ï¼›</li><li>â‘¤ <em>old_sz &lt;= 128, new_sz &lt;= 128</em> ï¼šåˆ™ä¼šä½¿ç”¨äºŒçº§é…ç½®å™¨ï¼›</li></ul></li></ul><p><strong><font color="FF8888">æ³¨æ„</font></strong>ï¼šæƒ…å†µ â‘  ä¸­åŒ…å«äº† <code>ROUND_UP(old_sz)</code> == <code>ROUND_UP(new_sz)</code> <em>&gt; 128</em></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">__default_alloc::reallocate</span><span class="params">(<span class="keyword">void</span> *p, <span class="keyword">size_t</span> old_sz, <span class="keyword">size_t</span> new_sz)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">void</span> *result;</span><br><span class="line">    <span class="keyword">size_t</span> copy_sz;</span><br><span class="line">    <span class="comment">// 1. old_sz &gt; 128,  new_sz &gt; 128   ç›´æ¥ä½¿ç”¨ realloc()</span></span><br><span class="line">    <span class="keyword">if</span> (old_sz &gt; <span class="keyword">static_cast</span>&lt;<span class="keyword">size_t</span>&gt;(__MAX_BYTES) &amp;&amp;</span><br><span class="line">        new_sz &gt; <span class="keyword">static_cast</span>&lt;<span class="keyword">size_t</span>&gt;(__MAX_BYTES))</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">realloc</span>(p, new_sz);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. (ROUND_UP(old_sz) == ROUND_UP(new_sz) &lt;= 128</span></span><br><span class="line">    <span class="keyword">if</span> (ROUND_UP(old_sz) == ROUND_UP(new_sz)) <span class="keyword">return</span> p;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. old_sz &gt; 128,  new_sz &lt;= 128 :  åˆ™ä¼šä½¿ç”¨äºŒçº§é…ç½®å™¨</span></span><br><span class="line">    <span class="comment">// 4. old_sz &lt;= 128, new_sz &gt; 128  :  åˆ™ä¼šä½¿ç”¨ä¸€çº§é…ç½®å™¨</span></span><br><span class="line">    <span class="comment">// 5. old_sz &lt;= 128, new_sz &lt;= 128 :  åˆ™ä¼šä½¿ç”¨äºŒçº§é…ç½®å™¨</span></span><br><span class="line">    result = allocate(new_sz);</span><br><span class="line">    <span class="comment">// æ‰¾åˆ° copy_sz, å³ new_sz å’Œ old_sz çš„æœ€å°å€¼</span></span><br><span class="line">    copy_sz = new_sz &gt; old_sz ? old_sz : new_sz;</span><br><span class="line">    <span class="comment">// å°†åŸæœ‰å†…å®¹å¤åˆ¶åˆ°æ–°å†…å­˜ä¸­</span></span><br><span class="line">    <span class="built_in">memcpy</span>(result, p, copy_sz);</span><br><span class="line">    <span class="comment">// é‡Šæ”¾æ—§å†…å­˜</span></span><br><span class="line">    deallocate(p, old_sz);</span><br><span class="line">    <span class="comment">// è¿”å›æ–°å†…å­˜</span></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>MiniSTL / Allocator / subAllocation / alloc.h : <code>reallocate()</code></p><p><a href="https://www.it610.com/article/1289144097491197952.htm" target="_blank" rel="noopener">å†…å­˜æ± æŠ€æœ¯ï¼ˆä¸‰ï¼‰</a> æœ€å <code>mem_realloc()</code> è®²è§£</p><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P62</p></blockquote><hr><h5 id="2-2-3-5-é‡æ–°å¡«å……-refill"><a class="header-anchor" href="#2-2-3-5-é‡æ–°å¡«å……-refill">Â¶</a>2.2.3.5 é‡æ–°å¡«å…… <code>refill()</code></h5><p><code>refill()</code> çš„å·¥ä½œå°±æ˜¯ï¼Œä»å†…å­˜æ± ä¸­è·å–å†…å­˜ã€‚ä¸»è¦é€šè¿‡ <code>chunk_alloc()</code> å‡½æ•°æ¥è·å–å†…å­˜ã€‚é»˜è®¤è·å– 20 ä¸ªåŒºå—å†…å­˜ï¼Œç”±äºå†…å­˜ä¸è¶³ï¼Œå¯èƒ½ä¼šå°äºè¿™ä¸ªæ•°å­—ï¼Œä¼šæ ¹æ®è·å¾—å†…å­˜çš„ä¸åŒè¿›è¡Œä¸åŒçš„å¤„ç†ã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å½“free_listæ— å¯ç”¨åŒºå—æ—¶ï¼Œé‡æ–°å¡«å……ç©ºé—´</span></span><br><span class="line"><span class="comment">// æ–°ç©ºé—´å–è‡ªå†…å­˜æ± ï¼Œé»˜è®¤è·å– 20 ä¸ªèŠ‚ç‚¹(åŒºå—)</span></span><br><span class="line"><span class="comment">// è‹¥å†…å­˜æ± ä¸è¶³ï¼Œåˆ™è·å–çš„å°†å°äº 20</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">__default_alloc::refill</span><span class="params">(<span class="keyword">size_t</span> n)</span> </span>&#123; <span class="comment">/* è¿™é‡Œçš„ n æ˜¯ 8 çš„å€æ•° */</span></span><br><span class="line">    <span class="keyword">int</span> nobjs = <span class="number">20</span>;</span><br><span class="line">    <span class="comment">// å°è¯•è°ƒç”¨ chunk_alloc,æ³¨æ„ nobjs ä»¥ pass-by-reference ä¼ å…¥</span></span><br><span class="line">    <span class="keyword">char</span> *chunk = chunk_alloc(n, nobjs);</span><br><span class="line">    obj *<span class="keyword">volatile</span> *my_free_list;</span><br><span class="line">    obj *result;</span><br><span class="line">    obj *current_obj, *next_obj;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è‹¥åªè·å–äº†ä¸€ä¸ªåŒºå—åˆ™ç›´æ¥åˆ†é…ç»™è°ƒç”¨è€…ï¼Œä¸åŠ å…¥free_list</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="number">1</span> == nobjs) <span class="keyword">return</span> (chunk);</span><br><span class="line"></span><br><span class="line">    my_free_list = free_list + FREELIST_INDEX(n);</span><br><span class="line">    <span class="comment">// åœ¨ chunk ç©ºé—´å†…å»ºç«‹free_list</span></span><br><span class="line">    result = <span class="keyword">reinterpret_cast</span>&lt;obj *&gt;(chunk);</span><br><span class="line">    <span class="comment">// å¼•å¯¼ free_list æŒ‡å‘å†…å­˜æ± åˆ†é…çš„ç©ºé—´</span></span><br><span class="line">    <span class="comment">// chunk æŒ‡å‘çš„å†…å­˜ç›´æ¥åˆ†ç»™ç”¨æˆ·ï¼Œfree_listæŒ‡å‘å‰©ä¸‹ï¼ˆ19æˆ–æ›´å°‘ï¼‰çš„åŒºå—</span></span><br><span class="line">    *my_free_list = next_obj = <span class="keyword">reinterpret_cast</span>&lt;obj *&gt;(chunk + n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;; ++i) &#123;</span><br><span class="line">        current_obj = next_obj;</span><br><span class="line">        next_obj =</span><br><span class="line">            <span class="keyword">reinterpret_cast</span>&lt;obj *&gt;(<span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">char</span> *&gt;(next_obj) + n);</span><br><span class="line">        <span class="comment">// åˆ†é…åˆ°æœ€åæ—¶å€™</span></span><br><span class="line">		<span class="keyword">if</span> (nobjs - <span class="number">1</span> == i) &#123;</span><br><span class="line">            current_obj-&gt;free_list_link = <span class="literal">nullptr</span>;</span><br><span class="line">            <span class="keyword">break</span>;  <span class="comment">// é€€å‡º</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            current_obj-&gt;free_list_link = next_obj;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P65 - P66</p></blockquote><hr><h5 id="2-2-3-6-å†…å­˜æ± "><a class="header-anchor" href="#2-2-3-6-å†…å­˜æ± ">Â¶</a>2.2.3.6 å†…å­˜æ± </h5><p>ä»å†…å­˜æ± ä¸­å–ç©ºé—´ç»™ <em>free-list</em> ä½¿ç”¨ï¼Œæ˜¯ <code>chunk_alloc()</code> çš„å·¥ä½œã€‚åœ¨ <code>chunk_alloc()</code>ä¹‹å‰éœ€è¦æ˜ç¡®å†…å­˜æ± çš„ç»“æ„ã€‚å†…å­˜æ± çš„ç»“æ„å®šä¹‰å¦‚ä¸‹ï¼Œå›¾ç¤ºå¦‚å›¾ 7 æ‰€ç¤ºã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// chunk allocation state</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">char</span> *start_free;  <span class="comment">// å†…å­˜æ± èµ·å§‹ä½ç½®ï¼Œåªåœ¨chunk_alloc()ä¸­å˜åŒ–</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">char</span> *end_free;    <span class="comment">// å†…å­˜æ± ç»“æŸä½ç½®ï¼Œåªåœ¨chunk_alloc()ä¸­å˜åŒ–</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">size_t</span> heap_size;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é™æ€æˆå‘˜åˆå§‹åŒ–(ç±»å¤–)</span></span><br><span class="line"><span class="keyword">char</span> *__default_alloc::start_free = <span class="literal">nullptr</span>;</span><br><span class="line"><span class="keyword">char</span> *__default_alloc::end_free = <span class="literal">nullptr</span>;</span><br><span class="line"><span class="keyword">size_t</span> __default_alloc::heap_size = <span class="number">0</span>;</span><br></pre></td></tr></table></figure><img src="/C++_Language/STL/Allocator/å†…å­˜æ± .png" style="zoom:50%"><center><strong>å›¾ 7</strong> å†…å­˜æ± ç®€å›¾</center><p><code>chunk_alloc()</code> æ˜¯å†…å­˜æ± çš„å…³é”®å‡½æ•°ã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">__default_alloc::chunk_alloc</span><span class="params">(<span class="keyword">size_t</span> <span class="built_in">size</span>, <span class="keyword">int</span> &amp;nobjs)</span> </span>&#123; <span class="comment">// sizeä¸º 8 çš„æ•´æ•°å€</span></span><br><span class="line">    <span class="keyword">char</span> *result;</span><br><span class="line">    <span class="keyword">size_t</span> total_bytes = <span class="built_in">size</span> * nobjs;  <span class="comment">// æ‰€éœ€è¦åˆ†é…çš„å†…å­˜</span></span><br><span class="line">    <span class="keyword">size_t</span> bytes_left = end_free - start_free;  <span class="comment">// å†…å­˜æ± å‰©ä½™ç©ºé—´</span></span><br><span class="line">    <span class="comment">/* ...</span></span><br><span class="line"><span class="comment">       ...</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ¹æ®å†…å­˜æ± çš„å‰©ä½™ç©ºé—´ä¸å®¢ç«¯éœ€æ±‚çš„å…³ç³»ï¼Œæœ‰<strong>ä¸‰ä¸ª</strong>å¤„ç†è·¯å¾„ï¼š</p><ul><li>æ‰€éœ€è¦åˆ†é…çš„å†…å­˜è¶³å¤Ÿ</li><li>å®¹é‡è‡³å°‘æ»¡è¶³ä¸€ä¸ªåŒºå—çš„éœ€æ±‚</li><li>å†…å­˜æ± ä¸€ä¸ªåŒºå—éƒ½æ— æ³•æ»¡è¶³æä¾›</li></ul><p><strong><font color="F08F00">1. æ‰€éœ€è¦åˆ†é…çš„å†…å­˜è¶³å¤Ÿ</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1. å®¹é‡æ»¡è¶³éœ€æ±‚</span></span><br><span class="line"><span class="keyword">if</span> (bytes_left &gt;= total_bytes) &#123;</span><br><span class="line">    <span class="comment">// æ›´æ–° start_free, å¹¶è¿”å›å†…å­˜æŒ‡é’ˆ</span></span><br><span class="line">    result = start_free;</span><br><span class="line">    start_free += total_bytes;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><font color="F08F00">2. å®¹é‡è‡³å°‘æ»¡è¶³ä¸€ä¸ªåŒºå—çš„éœ€æ±‚</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 2. å®¹é‡è‡³å°‘æ»¡è¶³ä¸€ä¸ªåŒºå—éœ€æ±‚</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (bytes_left &gt; <span class="built_in">size</span>) &#123;</span><br><span class="line">    <span class="comment">// æ›´æ–° nobjs, start_free, å¹¶è¿”å›å†…å­˜æŒ‡é’ˆ</span></span><br><span class="line">    nobjs = <span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(bytes_left / <span class="built_in">size</span>);</span><br><span class="line">    total_bytes = <span class="built_in">size</span> * nobjs;</span><br><span class="line">    result = start_free;</span><br><span class="line">    start_free += total_bytes;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><font color="F08F00">3. å†…å­˜æ± ä¸€ä¸ªåŒºå—éƒ½æ— æ³•æ»¡è¶³æä¾›</font></strong></p><p><code>è¡Œï¼š5</code> æ­¤æ—¶æ‰©å¤§éœ€æ±‚é‡ï¼Œæ–°éœ€æ±‚é‡æ˜¯åŸéœ€æ±‚é‡çš„<strong>äºŒå€</strong>ä¸ç°æœ‰å†…å­˜æ± å¤§å°çš„<strong>åå…­åˆ†ä¹‹ä¸€</strong>ä¹‹å’Œã€‚</p><p><code>è¡Œï¼š7-12</code>å¹¶åšç¢ç‰‡èµ„æºå›æ”¶æ“ä½œï¼Œå°†å†…å­˜æ± ä¸­ç¢ç‰‡èµ„æºåŠ å…¥åˆ°å¯¹åº”çš„è‡ªç”±é“¾è¡¨ä¸­ã€‚</p><p><code>è¡Œï¼š14</code> åˆ©ç”¨ <strong>malloc</strong> å‡½æ•°å‘ <em>heap</em> ä¸­ç”³è¯·æ‰€éœ€å†…å­˜</p><p>ç”±äº <strong>malloc</strong> çš„ä½¿ç”¨ï¼Œä¼šå­˜åœ¨ä¸¤ç§æƒ…å†µ</p><ul><li><em>heap</em> ç©ºé—´å……è¶³</li><li><em>heap</em> ç©ºé—´ä¸å¤Ÿ</li></ul><p><strong>å‰è€…</strong> ç›´æ¥æ›´æ–°éƒ¨åˆ†å‚æ•°ï¼Œå¹¶é€’å½’è°ƒç”¨è‡ªèº«ä»¥ä¿®æ­£ <em>nobjs</em>ï¼Œæœ€ç»ˆè¿”å›æ‰€éœ€å†…å­˜ï¼Œç»“æŸè°ƒç”¨ã€‚ï¼ˆé€’å½’æ“ä½œå¿…å®šä¼šè¿›å…¥<em>if_else</em> è¯­å¥ä¸­ï¼Œä¸‹åŒï¼‰</p><p><strong>åè€…</strong></p><ul><li>ä¼šåœ¨å¤§äº <em>size</em> çš„è‡ªç”±é“¾è¡¨ä¸­ï¼Œå°è¯•åˆ†é…æ‰€éœ€çš„åŒºå—ï¼Œå¦‚æœæˆåŠŸæ‰¾åˆ°ï¼Œåˆ™å›æ”¶è‡³å†…å­˜æ± ï¼Œå¹¶é€’å½’è°ƒç”¨è‡ªèº«ä»¥ä¿®æ­£ <em>nobjs</em>ï¼Œæœ€ç»ˆè¿”å›æ‰€éœ€å†…å­˜ï¼Œç»“æŸè°ƒç”¨ã€‚</li><li>å¦‚æœè‡ªç”±é“¾è¡¨ä¸­ä¹Ÿæ²¡æœ‰å†…å­˜ï¼Œåˆ™ä¼šè°ƒç”¨ä¸€çº§é…ç½®å™¨ï¼Œå°è¯•è°ƒç”¨ä¸€çº§é…ç½®å™¨è§‚å¯Ÿå…¶èƒ½å¦åˆ†é…å†…å­˜ï¼Œæˆ–æŠ›å‡ºå¼‚å¸¸ã€‚</li></ul><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 3. å†…å­˜æ± ä¸€ä¸ªåŒºå—éƒ½æ— æ³•æä¾›</span></span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// å‘ heap ç”³è¯·æ³¨å…¥çš„å†…å­˜ï¼Œheap_size å°†éšç€é…ç½®æ¬¡æ•°å¢åŠ è€Œå¢åŠ </span></span><br><span class="line">    <span class="comment">// æ‰©å¤§éœ€è¦é‡,æ–°éœ€æ±‚é‡æ˜¯åŸéœ€æ±‚é‡çš„äºŒå€ä¸ç°æœ‰å†…å­˜æ± å¤§å°çš„16åˆ†ä¹‹ä¸€ä¹‹å’Œ</span></span><br><span class="line">    <span class="keyword">size_t</span> bytes_to_get = <span class="number">2</span> * total_bytes + ROUND_UP(heap_size &gt;&gt; <span class="number">4</span>);  </span><br><span class="line">    <span class="comment">// å½“å‰å†…å­˜æ± è¿˜æœ‰ä¸€éƒ¨åˆ†å†…å­˜ï¼Œä¸ºäº†ä¸æµªè´¹åˆ†é…ç»™å¯¹åº”çš„ free_list (æœ€å°‘éƒ½ä¸º 8)</span></span><br><span class="line">    <span class="keyword">if</span> (bytes_left &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// è¯¥æ“ä½œä¸å›æ”¶èµ„æºç±»ä¼¼</span></span><br><span class="line">        obj *<span class="keyword">volatile</span> *my_free_list = free_list + FREELIST_INDEX(bytes_left);</span><br><span class="line">        <span class="keyword">reinterpret_cast</span>&lt;obj *&gt;(start_free)-&gt;free_list_link = *my_free_list;</span><br><span class="line">        *my_free_list = <span class="keyword">reinterpret_cast</span>&lt;obj *&gt;(start_free);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// é…ç½® heap ç©ºé—´ä»¥è¡¥å……å†…å­˜æ±  (ä½¿ç”¨ malloc å‡½æ•°)</span></span><br><span class="line">    start_free = <span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">char</span> *&gt;(<span class="built_in">malloc</span>(bytes_to_get));</span><br><span class="line">    <span class="keyword">if</span> (!start_free) &#123;</span><br><span class="line">        <span class="comment">// heap ç©ºé—´ä¸è¶³ï¼Œmalloc å¤±è´¥</span></span><br><span class="line">        obj *<span class="keyword">volatile</span> *my_free_list;</span><br><span class="line">        obj *p;</span><br><span class="line">        <span class="comment">// 1. å…ˆåœ¨ free_list ä¸­æ£€æŸ¥æ˜¯å¦æœ‰ç¬¦åˆéœ€æ±‚çš„åŒºå—</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="built_in">size</span>; i &lt;= <span class="keyword">static_cast</span>&lt;<span class="keyword">size_t</span>&gt;(__MAX_BYTES);</span><br><span class="line">             i += <span class="keyword">static_cast</span>&lt;<span class="keyword">size_t</span>&gt;(__ALIGN)) &#123;</span><br><span class="line">            my_free_list = free_list + FREELIST_INDEX(i);</span><br><span class="line">            p = *my_free_list;</span><br><span class="line">            <span class="keyword">if</span> (p) &#123;</span><br><span class="line">                <span class="comment">// å­˜åœ¨è¶³ä»¥åˆ†é…çš„åŒºå—</span></span><br><span class="line">                *my_free_list = p-&gt;free_list_link;  <span class="comment">// æŠ½ç¦»å½“å‰åŒºå—</span></span><br><span class="line">                start_free = <span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">char</span> *&gt;(p);</span><br><span class="line">                end_free = start_free + i;</span><br><span class="line">                <span class="comment">// é€’å½’è°ƒç”¨ä»¥ä¿®æ­£ nobjsï¼Œæ­¤æ—¶å¿…ç„¶è¿›å…¥ else_if åˆ†æ”¯</span></span><br><span class="line">                <span class="keyword">return</span> (chunk_alloc(<span class="built_in">size</span>, nobjs));  </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        end_free = <span class="literal">nullptr</span>;  <span class="comment">// åˆ°å¤„éƒ½æ‰¾ä¸åˆ°å†…å­˜</span></span><br><span class="line">        <span class="comment">// è°ƒç”¨ä¸€çº§é…ç½®å™¨è§‚å¯Ÿå…¶èƒ½å¦åˆ†é…å†…å­˜ï¼Œæˆ–æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">        start_free = <span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">char</span> *&gt;(malloc_alloc::allocate(bytes_to_get));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// heap ç©ºé—´å……è¶³ä¼šè¿è¡Œåˆ°è¯¥æ­¥éª¤</span></span><br><span class="line">    heap_size += bytes_to_get;  <span class="comment">// å·²å ç”¨çš„å †å†…å­˜</span></span><br><span class="line">    end_free = start_free + bytes_to_get;</span><br><span class="line">    <span class="keyword">return</span> chunk_alloc(<span class="built_in">size</span>, nobjs);  <span class="comment">// è°ƒç”¨è‡ªèº«ä»¥ä¿®æ­£ nobjs</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="/C++_Language/STL/Allocator/å†…å­˜æ± å®é™…æ“ä½œç»“æœ.png" style="zoom:60%"><center><strong>å›¾ 8</strong> å†…å­˜æ± å®é™…æ“ç»ƒç»“æœ</center><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P66 - P69</p></blockquote><hr><h3 id="2-3-å†…å­˜åŸºæœ¬å¤„ç†å·¥å…·-uninitialized-h"><a class="header-anchor" href="#2-3-å†…å­˜åŸºæœ¬å¤„ç†å·¥å…·-uninitialized-h">Â¶</a>2.3 å†…å­˜åŸºæœ¬å¤„ç†å·¥å…· uninitialized.h</h3><h4 id="2-3-1-å¤´æ–‡ä»¶"><a class="header-anchor" href="#2-3-1-å¤´æ–‡ä»¶">Â¶</a>2.3.1 å¤´æ–‡ä»¶</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;        // è°ƒç”¨memove()</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"construct.h"</span>    <span class="comment">// è°ƒç”¨æ„é€ å‡½æ•°</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stl_algobase.h"</span> <span class="comment">// è°ƒç”¨ copy()</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stl_iterator.h"</span> <span class="comment">// è¿­ä»£å™¨</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"typeTraits.h"</span>   <span class="comment">// èƒå–æœº</span></span></span><br></pre></td></tr></table></figure><p>å…³é”®çš„ä¸‰ä¸ªå‡½æ•°ï¼š</p><ul><li><code>uninitialized_copy()</code></li><li><code>uninitialized_fill()</code></li><li><code>uninitialized_fill_n()</code></li></ul><h4 id="2-3-2-uninitialized-copy"><a class="header-anchor" href="#2-3-2-uninitialized-copy">Â¶</a>2.3.2 <code>uninitialized_copy()</code></h4><p>è¯¥å‡½æ•°æœ‰ä¸‰ä¸ªé‡è½½ç‰ˆæœ¬ï¼Œåˆ†åˆ«æ˜¯ä¸€ä¸ªæ³›åŒ–ç‰ˆæœ¬å’Œä¸¤ä¸ªç‰¹åŒ–ç‰ˆæœ¬</p><p><strong><font color="F08F00">ä¸¤ä¸ªç‰¹åŒ–ç‰ˆæœ¬</font></strong>ï¼šç›´æ¥ä½¿ç”¨ <code>memmove()</code> ç§»åŠ¨å†…å­˜</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//é’ˆå¯¹char*ã€wchar_t*å­˜åœ¨ç‰¹åŒ–ç‰ˆæœ¬ memmoveç›´æ¥ç§»åŠ¨å†…å­˜</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">char</span> *<span class="title">uninitialized_copy</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *first, <span class="keyword">const</span> <span class="keyword">char</span> *last, <span class="keyword">char</span> *result)</span> </span>&#123;</span><br><span class="line">    memmove(result, first, last - first);</span><br><span class="line">    <span class="keyword">return</span> result + (last - first);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">wchar_t</span> *<span class="title">uninitialized_copy</span><span class="params">(<span class="keyword">const</span> <span class="keyword">wchar_t</span> *first, <span class="keyword">const</span> <span class="keyword">wchar_t</span> *last, <span class="keyword">wchar_t</span> *result)</span> </span>&#123;</span><br><span class="line">    memmove(result, first, <span class="keyword">sizeof</span>(<span class="keyword">wchar_t</span>) * (last - first));</span><br><span class="line">    <span class="keyword">return</span> result + (last - first);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><font color="F08F00">æ³›åŒ–ç‰ˆæœ¬</font></strong>ï¼šéœ€è¦ä½¿ç”¨<strong>èƒå–æœº</strong>è·å¾—å‹åˆ«ï¼Œåé€šè¿‡ä¸åŒçš„å‹åˆ«åˆ¤æ–­ä½¿ç”¨ä½•ç§æ¥å£å‡½æ•°ã€‚<strong>(åˆæ˜¯ä¸¤ä¸ªç‰¹åŒ–)</strong></p><p><strong>å‹åˆ«</strong>ï¼š<em>_true_typeï¼Œ _false_type</em></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator</span>, <span class="title">class</span> <span class="title">ForwardIterator</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">ForwardIterator</span> <span class="title">uninitialized_copy</span>(<span class="title">InputIterator</span> <span class="title">first</span>,</span></span><br><span class="line"><span class="class">                                          <span class="title">InputIterator</span> <span class="title">last</span>,</span></span><br><span class="line"><span class="class">                                          <span class="title">ForwardIterator</span> <span class="title">result</span>) &#123;</span></span><br><span class="line">    <span class="keyword">using</span> isPODType =</span><br><span class="line">        <span class="keyword">typename</span> _type_traits&lt;<span class="keyword">value_type_t</span>&lt;InputIterator&gt;&gt;::is_POD_type;</span><br><span class="line">    <span class="keyword">return</span> __uninitialized_copy_aux(first, last, result, isPODType());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ¥å£å‡½æ•°</strong>ï¼š<code>__uninitialized_copy_aux()</code></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// _true_type è¯´æ˜ trivial ç±»å‹ï¼Œç›´æ¥è°ƒç”¨ STL ä¸­ copy å‡½æ•°å³å¯</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator</span>, <span class="title">class</span> <span class="title">ForwardIterator</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">ForwardIterator</span> __<span class="title">uninitialized_copy_aux</span>(<span class="title">InputIterator</span> <span class="title">first</span>,</span></span><br><span class="line"><span class="class">                                                <span class="title">InputIterator</span> <span class="title">last</span>,</span></span><br><span class="line"><span class="class">                                                <span class="title">ForwardIterator</span> <span class="title">result</span>,</span></span><br><span class="line"><span class="class">                                                _<span class="title">true_type</span>) &#123;</span></span><br><span class="line">    <span class="keyword">return</span> MiniSTL::copy(first, last, result);  <span class="comment">// in stl_algobase.h</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// _true_type è¯´æ˜ non-trivial ç±»å‹ï¼Œä½¿ç”¨æ„é€ å‡½æ•°æ¥å¡«å……</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator</span>, <span class="title">class</span> <span class="title">ForwardIterator</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">ForwardIterator</span> __<span class="title">uninitialized_copy_aux</span>(<span class="title">InputIterator</span> <span class="title">first</span>,</span></span><br><span class="line"><span class="class">                                                <span class="title">InputIterator</span> <span class="title">last</span>,</span></span><br><span class="line"><span class="class">                                                <span class="title">ForwardIterator</span> <span class="title">result</span>,</span></span><br><span class="line"><span class="class">                                                _<span class="title">false_type</span>) &#123;</span></span><br><span class="line">    ForwardIterator cur = result;</span><br><span class="line">    <span class="keyword">for</span> (; first != last; ++cur, ++first) construct(&amp;*cur, *first);</span><br><span class="line">    <span class="keyword">return</span> cur;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><font color="FF8888">æ³¨æ„</font></strong>ï¼š(ä¸‹åŒ)</p><p>is_POD_type å­˜åœ¨ä¸¤ç§çŠ¶æ€ï¼Œ<em>_true_type, false_type</em>ï¼Œç”±èƒå–æœºè·å¾—ã€‚</p><p><em>_true_type</em> è¯´æ˜ <em>trivial</em><br>å¦‚æœè¿™ä¸ªç±»<strong>éƒ½æ˜¯</strong> <em>trivial ctor / dtor / copy / assignment</em> å‡½æ•°<br>æˆ‘ä»¬å¯¹è¿™ä¸ªç±»è¿›è¡Œæ„é€ ã€ææ„ã€æ‹·è´å’Œèµ‹å€¼æ—¶å¯ä»¥é‡‡ç”¨æœ€æœ‰æ•ˆç‡çš„æ–¹æ³•ï¼Œä¸è°ƒç”¨æ— æ‰€äº‹äº‹æ­£çœŸçš„é‚£äº› <em>ctor / dtor</em>ç­‰ï¼Œè€Œç›´æ¥é‡‡ç”¨å†…å­˜æ“ä½œå¦‚ *malloc()ã€memcpy(), memmove()*ç­‰æé«˜æ€§èƒ½ã€‚è¿™ä¹Ÿæ˜¯SGI STLå†…éƒ¨å¹²çš„äº‹æƒ…ã€‚</p><p><em>_false_type ä¹Ÿå°±æ˜¯ non trivial</em><br>é‚£ä¹ˆä¸Šé¢çš„å››ç§å‡½æ•°æœ‰(<em>ctor / dtor / copy / assignment</em>) æ˜¯ <em>non - trivial</em> å‡½æ•°ï¼Œæ¯”å¦‚ <em>non-trivial ctorã€non - trivial copy</em> ï¼Œä¹Ÿå°±æ˜¯è¯´æœ‰æ„ä¹‰çš„å‡½æ•°ï¼Œé‡Œé¢æœ‰ä¸€ä¸‹å¿…è¦çš„æ“ä½œï¼Œæ¯”å¦‚ç±»æˆå‘˜çš„åˆå§‹åŒ–ï¼Œé‡Šæ”¾å†…å­˜ç­‰ã€‚è¿™æ—¶å€™åªèƒ½è°ƒç”¨å¯¹åº”çš„ ctorï¼Œcopyâ€¦</p><img src="/C++_Language/STL/Allocator/uni_copy.png" style="zoom:50%"><center><strong>å›¾ 9</strong> <i>uninitialized_copy()</i> çš„æ³›å‹ç‰ˆæœ¬ä¸ç‰¹åŒ–ç‰ˆæœ¬</center><blockquote><p>å¯ä»¥å‚è€ƒ <a href="https://blog.csdn.net/francisapp/article/details/77063819?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_title-1&amp;spm=1001.2101.3001.4242" target="_blank" rel="noopener">C++ trivialã€non-trivialåŠPODç±»å‹</a></p><p>â€œtypeTraits.hâ€ å¤´æ–‡ä»¶ä¸­æœ‰è¯¦ç»†çš„åˆ†ç±»</p><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P70, P73 - P75</p></blockquote><hr><h4 id="2-3-3-uninitialized-fill"><a class="header-anchor" href="#2-3-3-uninitialized-fill">Â¶</a>2.3.3 <code>uninitialized_fill()</code></h4><p>è¯¥å‡½æ•°æ˜¯ä¸€ä¸ªæ³›åŒ–ç‰ˆæœ¬ï¼Œä½†æ˜¯åˆ©ç”¨èƒå–æœºåˆå¯ä»¥åˆ†ä¸ºä¸¤ä¸ªç‰¹åŒ–çš„æ¥å£å‡½æ•°ã€‚</p><p><strong><font color="F08F00">æ³›åŒ–ç‰ˆæœ¬</font></strong>ï¼šéœ€è¦ä½¿ç”¨<strong>èƒå–æœº</strong>è·å¾—å‹åˆ«ï¼Œåé€šè¿‡ä¸åŒçš„å‹åˆ«åˆ¤æ–­ä½¿ç”¨ä½•ç§æ¥å£å‡½æ•°ã€‚<strong>(ä¸¤ä¸ªç‰¹åŒ–)</strong></p><p><strong>å‹åˆ«</strong>ï¼š<em>_true_typeï¼Œ _false_type</em></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">ForwardIterator</span>, <span class="title">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">void</span> <span class="title">uninitialized_fill</span>(<span class="title">ForwardIterator</span> <span class="title">first</span>, <span class="title">ForwardIterator</span> <span class="title">last</span>,</span></span><br><span class="line"><span class="class">                               <span class="title">const</span> <span class="title">T</span> &amp;<span class="title">value</span>) &#123;</span></span><br><span class="line">    <span class="keyword">using</span> isPODType =</span><br><span class="line">        <span class="keyword">typename</span> _type_traits&lt;<span class="keyword">value_type_t</span>&lt;ForwardIterator&gt;&gt;::is_POD_type;</span><br><span class="line">    __uninitialized_fill_aux(first, last, value, isPODType());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ¥å£å‡½æ•°</strong>ï¼š <code>__uninitialized_fill_aux()</code></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// _true_type è¯´æ˜ trivial ç±»å‹ï¼Œç›´æ¥è°ƒç”¨ STL ä¸­ fill å‡½æ•°å³å¯</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">ForwardIterator</span>, <span class="title">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">void</span> __<span class="title">uninitialized_fill_aux</span>(<span class="title">ForwardIterator</span> <span class="title">first</span>,</span></span><br><span class="line"><span class="class">                                     <span class="title">ForwardIterator</span> <span class="title">last</span>, <span class="title">const</span> <span class="title">T</span> &amp;<span class="title">value</span>,</span></span><br><span class="line"><span class="class">                                     _<span class="title">true_type</span>) &#123;</span></span><br><span class="line">    MiniSTL::<span class="built_in">fill</span>(first, last, value);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// _true_type è¯´æ˜ non-trivial ç±»å‹ï¼Œä½¿ç”¨æ„é€ å‡½æ•°æ¥å¡«å……</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">ForwardIterator</span>, <span class="title">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">void</span> __<span class="title">uninitialized_fill_aux</span>(<span class="title">ForwardIterator</span> <span class="title">first</span>, <span class="title">ForwardIterator</span> <span class="title">last</span>,</span></span><br><span class="line"><span class="class">                              <span class="title">const</span> <span class="title">T</span> &amp;<span class="title">value</span>, _<span class="title">false_type</span>) &#123;</span></span><br><span class="line">    ForwardIterator cur = first;</span><br><span class="line">    <span class="keyword">for</span> (; cur != last; ++cur) construct(&amp;*cur, value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="/C++_Language/STL/Allocator/uni_fill.png" style="zoom:50%"><center><strong>å›¾ 10</strong> <i>uninitialized_fill()</i> çš„æ³›å‹ç‰ˆæœ¬ä¸ç‰¹åŒ–ç‰ˆæœ¬</center><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P71, P75 - P76</p></blockquote><hr><h4 id="2-3-4-uninitialized-fill-n"><a class="header-anchor" href="#2-3-4-uninitialized-fill-n">Â¶</a>2.3.4 <code>uninitialized_fill_n()</code></h4><p>è¯¥å‡½æ•°æ˜¯ä¸€ä¸ªæ³›åŒ–ç‰ˆæœ¬ï¼Œä½†æ˜¯åˆ©ç”¨èƒå–æœºåˆå¯ä»¥åˆ†ä¸ºä¸¤ä¸ªç‰¹åŒ–çš„æ¥å£å‡½æ•°ã€‚</p><p><strong><font color="F08F00">æ³›åŒ–ç‰ˆæœ¬</font></strong>ï¼šéœ€è¦ä½¿ç”¨<strong>èƒå–æœº</strong>è·å¾—å‹åˆ«ï¼Œåé€šè¿‡ä¸åŒçš„å‹åˆ«åˆ¤æ–­ä½¿ç”¨ä½•ç§æ¥å£å‡½æ•°ã€‚<strong>(ä¸¤ä¸ªç‰¹åŒ–)</strong></p><p><strong>å‹åˆ«</strong>ï¼š<em>_true_typeï¼Œ _false_type</em></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">ForwardIterator</span>, <span class="title">class</span> <span class="title">Size</span>, <span class="title">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">ForwardIterator</span> <span class="title">uninitialized_fill_n</span>(<span class="title">ForwardIterator</span> <span class="title">first</span>, <span class="title">Size</span> <span class="title">n</span>,</span></span><br><span class="line"><span class="class">                                            <span class="title">const</span> <span class="title">T</span> &amp;<span class="title">value</span>) &#123;</span></span><br><span class="line">    <span class="keyword">using</span> isPODType =</span><br><span class="line">        <span class="keyword">typename</span> _type_traits&lt;<span class="keyword">value_type_t</span>&lt;ForwardIterator&gt;&gt;::is_POD_type; </span><br><span class="line">    <span class="keyword">return</span> __uninitialized_fill_n_aux(first, n, value, isPODType());      </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ¥å£å‡½æ•°</strong>ï¼š <code>__uninitialized_fill_n_aux()</code></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// _true_type è¯´æ˜ trivial ç±»å‹ï¼Œç›´æ¥è°ƒç”¨ STL ä¸­ fill å‡½æ•°å³å¯</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">ForwardIterator</span>, <span class="title">class</span> <span class="title">Size</span>, <span class="title">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">ForwardIterator</span> __<span class="title">uninitialized_fill_n_aux</span>(<span class="title">ForwardIterator</span> <span class="title">first</span>, <span class="title">Size</span> <span class="title">n</span>,</span></span><br><span class="line"><span class="class">                                                  <span class="title">const</span> <span class="title">T</span> &amp;<span class="title">value</span>, _<span class="title">true_type</span>) &#123;</span></span><br><span class="line">    <span class="keyword">return</span> MiniSTL::fill_n(first, n, value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// _true_type è¯´æ˜ non-trivial ç±»å‹ï¼Œä½¿ç”¨æ„é€ å‡½æ•°æ¥å¡«å……</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">ForwardIterator</span>, <span class="title">class</span> <span class="title">Size</span>, <span class="title">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">ForwardIterator</span> __<span class="title">uninitialized_fill_n_aux</span>(<span class="title">ForwardIterator</span> <span class="title">first</span>, <span class="title">Size</span> <span class="title">n</span>,</span></span><br><span class="line"><span class="class">                                           <span class="title">const</span> <span class="title">T</span> &amp;<span class="title">value</span>, _<span class="title">false_type</span>) &#123;</span></span><br><span class="line">    ForwardIterator cur = first;</span><br><span class="line">    <span class="keyword">for</span> (; n &gt; <span class="number">0</span>; --n, ++cur) construct(&amp;*cur, value);</span><br><span class="line">    <span class="keyword">return</span> cur;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="/C++_Language/STL/Allocator/uni_fill_n.png" style="zoom:50%"><center><strong>å›¾ 11</strong> <i>uninitialized_fill_n()</i> çš„æ³›å‹ç‰ˆæœ¬ä¸ç‰¹åŒ–ç‰ˆæœ¬</center><blockquote><p>ã€ŠSTLæºç å‰–æã€‹ â€“ P71 - P73</p></blockquote><hr><h4 id="2-3-5-SGI-STLçš„æ‰©å±•"><a class="header-anchor" href="#2-3-5-SGI-STLçš„æ‰©å±•">Â¶</a>2.3.5 SGI_STLçš„æ‰©å±•</h4><p>SGI_STLçš„æ‰©å±•ï¼š</p><ul><li><code>uninitializd_copy_copy()</code></li><li><code>uninitialized_copy_fill()</code></li><li><code>uninitialized_fill_copy()</code></li></ul><p><code>uninitializd_copy_copy()</code></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// __uninitialized_copy_copy</span></span><br><span class="line"><span class="comment">// Copies [first1, last1) into [result, result + (last1 - first1)), and</span></span><br><span class="line"><span class="comment">// copies [first2, last2) into [result, result + (last1 - first1) + (last2 -</span></span><br><span class="line"><span class="comment">// first2)).</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator1</span>, <span class="title">class</span> <span class="title">InputIterator2</span>, <span class="title">class</span> <span class="title">ForwardIterator</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">ForwardIterator</span> <span class="title">uninitialized_copy_copy</span>(<span class="title">InputIterator1</span> <span class="title">first1</span>,</span></span><br><span class="line"><span class="class">                                               <span class="title">InputIterator1</span> <span class="title">last1</span>,</span></span><br><span class="line"><span class="class">                                               <span class="title">InputIterator2</span> <span class="title">first2</span>,</span></span><br><span class="line"><span class="class">                                               <span class="title">InputIterator2</span> <span class="title">last2</span>,</span></span><br><span class="line"><span class="class">                                               <span class="title">ForwardIterator</span> <span class="title">result</span>) &#123;</span></span><br><span class="line">    ForwardIterator mid = MiniSTL::uninitialized_copy(first1, last1, result);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> MiniSTL::uninitialized_copy(first2, last2, mid);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="built_in">std</span>::exception &amp;) &#123;</span><br><span class="line">        destroy(result, mid);</span><br><span class="line">        <span class="keyword">throw</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>uninitialized_copy_fill()</code></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// uninitialized_fill_copy</span></span><br><span class="line"><span class="comment">// Fills [result, mid) with x, and copies [first, last) into [mid, mid + (last -</span></span><br><span class="line"><span class="comment">// first)).</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">ForwardIterator</span>, <span class="title">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">InputIterator</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">ForwardIterator</span> <span class="title">uninitialized_fill_copy</span>(<span class="title">ForwardIterator</span> <span class="title">result</span>,</span></span><br><span class="line"><span class="class">                                               <span class="title">ForwardIterator</span> <span class="title">mid</span>,</span></span><br><span class="line"><span class="class">                                               <span class="title">const</span> <span class="title">T</span> &amp;<span class="title">val</span>,</span></span><br><span class="line"><span class="class">                                               <span class="title">InputIterator</span> <span class="title">first</span>,</span></span><br><span class="line"><span class="class">                                               <span class="title">InputIterator</span> <span class="title">last</span>) &#123;</span></span><br><span class="line">    MiniSTL::uninitialized_fill(result, mid, val);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> MiniSTL::uninitialized_copy(first, last, mid);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="built_in">std</span>::exception &amp;) &#123;</span><br><span class="line">        destroy(result, mid);</span><br><span class="line">        <span class="keyword">throw</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>uninitialized_fill_copy()</code></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// __uninitialized_copy_fill</span></span><br><span class="line"><span class="comment">// Copies [first1, last1) into [first2, first2 + (last1 - first1)), and fills</span></span><br><span class="line"><span class="comment">// [first2 + (last1 - first1), last2) with x.</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator</span>, <span class="title">class</span> <span class="title">ForwardIterator</span>, <span class="title">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">void</span> <span class="title">uninitialized_copy_fill</span>(<span class="title">InputIterator</span> <span class="title">first1</span>, <span class="title">InputIterator</span> <span class="title">last1</span>,</span></span><br><span class="line"><span class="class">                                    <span class="title">ForwardIterator</span> <span class="title">first2</span>,</span></span><br><span class="line"><span class="class">                                    <span class="title">ForwardIterator</span> <span class="title">last2</span>, <span class="title">const</span> <span class="title">T</span> &amp;<span class="title">val</span>) &#123;</span></span><br><span class="line">    ForwardIterator mid2 = MiniSTL::uninitialized_copy(first1, last1, first2);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        MiniSTL::uninitialized_fill(mid2, last2, val);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="built_in">std</span>::exception &amp;) &#123;</span><br><span class="line">        destroy(first2, mid2);</span><br><span class="line">        <span class="keyword">throw</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>MiniSTL / Allocator / subAllocation / alloc.h : <code>uninitializd_copy_copy()</code></p><p>MiniSTL / Allocator / subAllocation / alloc.h : <code>uninitializd_fill_copy()</code></p><p>MiniSTL / Allocator / subAllocation / alloc.h : <code>uninitializd_copy_fill()</code></p></blockquote><hr><h2 id="3-å‚è€ƒèµ„æ–™"><a class="header-anchor" href="#3-å‚è€ƒèµ„æ–™">Â¶</a>3. å‚è€ƒèµ„æ–™</h2><blockquote><p>ã€ŠSTLæºç å‰–æã€‹</p><p>ã€ŠEffective C++ 3rdã€‹</p><p><a href="https://blog.csdn.net/francisapp/article/details/77063819?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_title-1&amp;spm=1001.2101.3001.4242" target="_blank" rel="noopener">C++ trivialã€non-trivialåŠPODç±»å‹</a></p><p><a href="https://www.it610.com/article/1289144097491197952.htm" target="_blank" rel="noopener">å†…å­˜æ± æŠ€æœ¯ï¼ˆä¸‰ï¼‰</a> æœ€å <code>mem_realloc()</code> è®²è§£</p><p>MiniSTL / Allocator éƒ¨åˆ†</p></blockquote><!-- rebuild by neat -->]]></content>
      <categories>
        <category>C++_Language</category>
      </categories>
      <tags>
        <tag>STL</tag>
      </tags>
  </entry>
  <entry>
    <title>å‰‘æŒ‡offer -- åŠ¨æ€è§„åˆ’</title>
    <url>/Data_Structure_and_Algorithm/%E5%89%91%E6%8C%87offer/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/</url>
    <content><![CDATA[<!-- build time:Tue Jun 22 2021 17:02:33 GMT+0800 (GMT+08:00) --><a id="more"></a><h2 id="å‰‘æŒ‡offer-â€“-åŠ¨æ€è§„åˆ’"><a class="header-anchor" href="#å‰‘æŒ‡offer-â€“-åŠ¨æ€è§„åˆ’">Â¶</a>å‰‘æŒ‡offer â€“ åŠ¨æ€è§„åˆ’</h2><h3 id="å‰‘æŒ‡-Offer-10-I-æ–æ³¢é‚£å¥‘æ•°åˆ—"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-10-I-æ–æ³¢é‚£å¥‘æ•°åˆ—">Â¶</a><a href="https://leetcode-cn.com/problems/fei-bo-na-qi-shu-lie-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 10- I. æ–æ³¢é‚£å¥‘æ•°åˆ—</a></h3><p>Difficulty: <strong><font color="008F00">ç®€å•</font></strong></p><p>å†™ä¸€ä¸ªå‡½æ•°ï¼Œè¾“å…¥ <code>n</code> ï¼Œæ±‚æ–æ³¢é‚£å¥‘ï¼ˆFibonacciï¼‰æ•°åˆ—çš„ç¬¬ <code>n</code> é¡¹ï¼ˆå³ <code>F(N)</code>ï¼‰ã€‚æ–æ³¢é‚£å¥‘æ•°åˆ—çš„å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">F(0) &#x3D; 0,   F(1) &#x3D; 1</span><br><span class="line">F(N) &#x3D; F(N - 1) + F(N - 2), å…¶ä¸­ N &gt; 1.</span><br></pre></td></tr></table></figure><p>æ–æ³¢é‚£å¥‘æ•°åˆ—ç”± 0 å’Œ 1 å¼€å§‹ï¼Œä¹‹åçš„æ–æ³¢é‚£å¥‘æ•°å°±æ˜¯ç”±ä¹‹å‰çš„ä¸¤æ•°ç›¸åŠ è€Œå¾—å‡ºã€‚</p><p>ç­”æ¡ˆéœ€è¦å–æ¨¡ 1e9+7ï¼ˆ1000000007ï¼‰ï¼Œå¦‚è®¡ç®—åˆå§‹ç»“æœä¸ºï¼š1000000008ï¼Œè¯·è¿”å› 1ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šn &#x3D; 2</span><br><span class="line">è¾“å‡ºï¼š1</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šn &#x3D; 5</span><br><span class="line">è¾“å‡ºï¼š5</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li><code>0 &lt;= n &lt;= 100</code></li></ul><p><strong>Solution</strong></p><p><strong><font color="F08F00">æ–¹æ³•ä¸€ï¼šé€’å½’å†™æ³•</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">fib</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (n &lt; <span class="number">2</span>) <span class="keyword">return</span> n;</span><br><span class="line">        <span class="keyword">return</span> fib(n - <span class="number">1</span>) + fib(n - <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(2^N)$ï¼ŒæŒ‡æ•°çº§åˆ«ã€‚</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œæ¯ä¸€å±‚è¿ç®—æ‰€å ç”¨çš„ç©ºé—´ä¸º1ï¼Œä¸€å…±è¦é€’å½’ <em>n-1</em> æ¬¡ï¼›ä¹Ÿå°±æ˜¯çº¦ç­‰äº<em>n</em>ã€‚</p><hr><p><strong><font color="F08F00">æ–¹æ³•äºŒï¼šåŠ¨æ€è§„åˆ’</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">fib</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (n &lt;= <span class="number">1</span>) <span class="keyword">return</span> n;</span><br><span class="line">        <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">dp</span><span class="params">(n + <span class="number">1</span>)</span></span>;</span><br><span class="line">        dp[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        dp[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            dp[i] = (dp[i - <span class="number">1</span>] + dp[i - <span class="number">2</span>]) % <span class="number">1000000007</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ—¶é—´å¤æ‚åº¦ï¼š$O(N)$ï¼Œ<em>N</em> ä¸ºæ•°ç»„é•¿åº¦ï¼Œä¸€æ¬¡éå†</p><p>ç©ºé—´å¤æ‚åº¦ï¼š$O(N )$ï¼Œ<em>dp</em> æ•°ç»„æ‰€éœ€è¦çš„é¢å¤–ç©ºé—´</p><hr><p><strong><font color="F08F00">æ–¹æ³•äºŒï¼šåŠ¨æ€è§„åˆ’</font></strong>ï¼Œæ»šåŠ¨æ•°ç»„ï¼Œ<strong><font color="FF8888">ç©ºé—´ä¼˜åŒ–</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">fib</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (n &lt;= <span class="number">1</span>) <span class="keyword">return</span> n;</span><br><span class="line">        <span class="keyword">int</span> p = <span class="number">0</span>, q = <span class="number">0</span>, r = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">            p = q;</span><br><span class="line">            q = r;</span><br><span class="line">            r = (p + q) % <span class="number">1000000007</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œ<em>N</em> ä¸ºæ•°ç»„é•¿åº¦ï¼Œä¸€æ¬¡éå†</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(1)$ï¼Œ<em>p,q,r</em> æ‰€éœ€çš„é¢å¤–å¸¸æ•°ç©ºé—´</p><hr><p><strong><font color="F08F00">æ–¹æ³•ä¸‰ï¼šçŸ©é˜µå¿«é€Ÿå¹‚</font></strong></p><p><a href="https://leetcode-cn.com/problems/fibonacci-number/solution/fei-bo-na-qi-shu-by-leetcode-solution-o4ze/" target="_blank" rel="noopener">æ–æ³¢é‚£å¥‘æ•°_å®˜æ–¹é¢˜è§£__æ–¹æ³•äºŒï¼šçŸ©é˜µå¿«é€Ÿå¹‚</a></p><p><img src="/Data_Structure_and_Algorithm/%E5%89%91%E6%8C%87offer/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E7%9F%A9%E9%98%B5%E5%BF%AB%E9%80%9F%E5%B9%82.png" alt></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">fib</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (n &lt; <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> n;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; q&#123;&#123;<span class="number">1</span>, <span class="number">1</span>&#125;, &#123;<span class="number">1</span>, <span class="number">0</span>&#125;&#125;;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; res = matrix_pow(q, n - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> res[<span class="number">0</span>][<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// æ±‚çŸ©é˜µçš„ n æ¬¡å¹‚</span></span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; <span class="title">matrix_pow</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt;&amp; a, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; ret&#123;&#123;<span class="number">1</span>, <span class="number">0</span>&#125;, &#123;<span class="number">0</span>, <span class="number">1</span>&#125;&#125;; <span class="comment">// åˆå§‹åŒ–å•ä½çŸ©é˜µ</span></span><br><span class="line">        <span class="keyword">while</span> (n &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// n å­˜åœ¨å¥‡æ•°å’Œå¶æ•°ä¸¤ç§æƒ…å†µï¼Œæ•´ä¸ªæ€è·¯åŒ:å‰‘æŒ‡offer16 æ•°å€¼çš„æ•´æ•°æ¬¡æ–¹</span></span><br><span class="line">            <span class="comment">// å¥‡æ•°æƒ…å†µè¦å¤šä¹˜ä¸€æ¬¡ a</span></span><br><span class="line">            <span class="comment">// a^n = a * (a^(n/2) * a^(n/2))</span></span><br><span class="line">            <span class="keyword">if</span> (n &amp; <span class="number">1</span>) &#123;</span><br><span class="line">                ret = matrix_multiply(ret, a);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// å¶æ•°ï¼ša^n = a^(n/2) * a^(n/2)</span></span><br><span class="line">            a = matrix_multiply(a, a);</span><br><span class="line">            n &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// äºŒç»´çŸ©é˜µä¹˜æ³•å…¬å¼</span></span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; <span class="title">matrix_multiply</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt;&amp; a, <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt;&amp; b)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; c&#123;&#123;<span class="number">0</span>, <span class="number">0</span>&#125;, &#123;<span class="number">0</span>, <span class="number">0</span>&#125;&#125;;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">2</span>; j++) &#123;</span><br><span class="line">                c[i][j] = a[i][<span class="number">0</span>] * b[<span class="number">0</span>][j] + a[i][<span class="number">1</span>] * b[<span class="number">1</span>][j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong><font color="FF8888">æ³¨æ„</font></strong>ï¼šæ­¤é¢˜ä½¿ç”¨çš„å¿«é€Ÿå¹‚ç®—æ³•ä¸ <a href="https://czgitaccount.github.io/Data_Structure_and_Algorithm/%E5%89%91%E6%8C%87offer/%E5%88%86%E6%B2%BB%E7%AE%97%E6%B3%95/">æ•°å€¼çš„æ•´æ•°æ¬¡æ–¹</a> ç›¸åŒã€‚</p><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(\log N)$ï¼ŒäºŒåˆ†çš„æ—¶é—´å¤æ‚åº¦ä¸ºå¯¹æ•°çº§åˆ«ã€‚</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(1)$ï¼Œ<em>res , q, a, ret</em> ç­‰å˜é‡éƒ½æœ‰æ˜ç¡®çš„å¤§å°ï¼Œä»…å ç”¨å¸¸æ•°å¤§å°é¢å¤–ç©ºé—´ã€‚</p><hr><p><strong><font color="F08F00">æ–¹æ³•å››ï¼šé€šé¡¹å…¬å¼</font></strong></p><p><a href="https://leetcode-cn.com/problems/fibonacci-number/solution/fei-bo-na-qi-shu-by-leetcode-solution-o4ze/" target="_blank" rel="noopener">æ–æ³¢é‚£å¥‘æ•°_å®˜æ–¹é¢˜è§£__æ–¹æ³•ä¸‰ï¼šé€šé¡¹å…¬å¼</a><br>$$<br>F(n) = \frac{1}{\sqrt{5}}[(\frac{1 + \sqrt{5}}{2})^n - (\frac{1 - \sqrt{5}}{2})^n]<br>$$</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">fib</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">double</span> sqrt5 = <span class="built_in">sqrt</span>(<span class="number">5</span>);</span><br><span class="line">        <span class="keyword">double</span> fibN = <span class="built_in">pow</span>((<span class="number">1</span> + sqrt5) / <span class="number">2</span>, n) - <span class="built_in">pow</span>((<span class="number">1</span> - sqrt5) / <span class="number">2</span>, n);</span><br><span class="line">        <span class="keyword">return</span> round(fibN / sqrt5);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼Œç©ºé—´å¤æ‚åº¦</strong>çš†ä¸º $O(1)$ã€‚</p><hr><h3 id="å‰‘æŒ‡-Offer-10-II-é’è›™è·³å°é˜¶é—®é¢˜"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-10-II-é’è›™è·³å°é˜¶é—®é¢˜">Â¶</a><a href="https://leetcode-cn.com/problems/qing-wa-tiao-tai-jie-wen-ti-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 10- II. é’è›™è·³å°é˜¶é—®é¢˜</a></h3><p>Difficulty: <strong><font color="008F00">ç®€å•</font></strong></p><p>ä¸€åªé’è›™ä¸€æ¬¡å¯ä»¥è·³ä¸Š1çº§å°é˜¶ï¼Œä¹Ÿå¯ä»¥è·³ä¸Š2çº§å°é˜¶ã€‚æ±‚è¯¥é’è›™è·³ä¸Šä¸€ä¸ª <code>n</code> çº§çš„å°é˜¶æ€»å…±æœ‰å¤šå°‘ç§è·³æ³•ã€‚</p><p>ç­”æ¡ˆéœ€è¦å–æ¨¡ 1e9+7ï¼ˆ1000000007ï¼‰ï¼Œå¦‚è®¡ç®—åˆå§‹ç»“æœä¸ºï¼š1000000008ï¼Œè¯·è¿”å› 1ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šn &#x3D; 2</span><br><span class="line">è¾“å‡ºï¼š2</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šn &#x3D; 7</span><br><span class="line">è¾“å‡ºï¼š21</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šn &#x3D; 0</span><br><span class="line">è¾“å‡ºï¼š1</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li><code>0 &lt;= n &lt;= 100</code></li></ul><p><strong>Solution</strong></p><p>ä¸æ–æ³¢é‚£å¥‘æ•°åˆ—æœ¬è´¨ç›¸åŒï¼Œæ›´å¤šè§£æ³•åŒä¸Šã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªå¸¸è§„çš„åŠ¨æ€è§„åˆ’+æ»šåŠ¨æ•°ç»„ä¼˜åŒ–ç©ºé—´è§£æ³•ã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">numWays</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> p = <span class="number">0</span>, q = <span class="number">0</span>, r = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            p = q;</span><br><span class="line">            q = r;</span><br><span class="line">            r = (p + q) % <span class="number">1000000007</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œ<em>N</em> ä¸ºæ•°ç»„é•¿åº¦ï¼Œä¸€æ¬¡éå†</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(1)$ï¼Œ<em>p,q,r</em> æ‰€éœ€çš„é¢å¤–å¸¸æ•°ç©ºé—´</p><hr><h3 id="å‰‘æŒ‡-Offer-19-æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-19-æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…">Â¶</a><a href="https://leetcode-cn.com/problems/zheng-ze-biao-da-shi-pi-pei-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 19. æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</a></h3><p>Difficulty: <strong><font color="FF0000">å›°éš¾</font></strong></p><p>è¯·å®ç°ä¸€ä¸ªå‡½æ•°ç”¨æ¥åŒ¹é…åŒ…å«<code>'. '</code>å’Œ<code>'*'</code>çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚æ¨¡å¼ä¸­çš„å­—ç¬¦<code>'.'</code>è¡¨ç¤ºä»»æ„ä¸€ä¸ªå­—ç¬¦ï¼Œè€Œ<code>'*'</code>è¡¨ç¤ºå®ƒå‰é¢çš„å­—ç¬¦å¯ä»¥å‡ºç°ä»»æ„æ¬¡ï¼ˆå«0æ¬¡ï¼‰ã€‚åœ¨æœ¬é¢˜ä¸­ï¼ŒåŒ¹é…æ˜¯æŒ‡å­—ç¬¦ä¸²çš„æ‰€æœ‰å­—ç¬¦åŒ¹é…æ•´ä¸ªæ¨¡å¼ã€‚ä¾‹å¦‚ï¼Œå­—ç¬¦ä¸²<code>&quot;aaa&quot;</code>ä¸æ¨¡å¼<code>&quot;a.a&quot;</code>å’Œ<code>&quot;ab*ac*a&quot;</code>åŒ¹é…ï¼Œä½†ä¸<code>&quot;aa.a&quot;</code>å’Œ<code>&quot;ab*a&quot;</code>å‡ä¸åŒ¹é…ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥:</span><br><span class="line">s &#x3D; &quot;aa&quot;</span><br><span class="line">p &#x3D; &quot;a&quot;</span><br><span class="line">è¾“å‡º: false</span><br><span class="line">è§£é‡Š: &quot;a&quot; æ— æ³•åŒ¹é… &quot;aa&quot; æ•´ä¸ªå­—ç¬¦ä¸²ã€‚</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥:</span><br><span class="line">s &#x3D; &quot;aa&quot;</span><br><span class="line">p &#x3D; &quot;a*&quot;</span><br><span class="line">è¾“å‡º: true</span><br><span class="line">è§£é‡Š: å› ä¸º &#39;*&#39; ä»£è¡¨å¯ä»¥åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªå‰é¢çš„é‚£ä¸€ä¸ªå…ƒç´ , åœ¨è¿™é‡Œå‰é¢çš„å…ƒç´ å°±æ˜¯ &#39;a&#39;ã€‚å› æ­¤ï¼Œå­—ç¬¦ä¸² &quot;aa&quot; å¯è¢«è§†ä¸º &#39;a&#39; é‡å¤äº†ä¸€æ¬¡ã€‚</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 3:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥:</span><br><span class="line">s &#x3D; &quot;ab&quot;</span><br><span class="line">p &#x3D; &quot;.*&quot;</span><br><span class="line">è¾“å‡º: true</span><br><span class="line">è§£é‡Š: &quot;.*&quot; è¡¨ç¤ºå¯åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªï¼ˆ&#39;*&#39;ï¼‰ä»»æ„å­—ç¬¦ï¼ˆ&#39;.&#39;ï¼‰ã€‚</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 4:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥:</span><br><span class="line">s &#x3D; &quot;aab&quot;</span><br><span class="line">p &#x3D; &quot;c*a*b&quot;</span><br><span class="line">è¾“å‡º: true</span><br><span class="line">è§£é‡Š: å› ä¸º &#39;*&#39; è¡¨ç¤ºé›¶ä¸ªæˆ–å¤šä¸ªï¼Œè¿™é‡Œ &#39;c&#39; ä¸º 0 ä¸ª, &#39;a&#39; è¢«é‡å¤ä¸€æ¬¡ã€‚å› æ­¤å¯ä»¥åŒ¹é…å­—ç¬¦ä¸² &quot;aab&quot;ã€‚</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 5:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥:</span><br><span class="line">s &#x3D; &quot;mississippi&quot;</span><br><span class="line">p &#x3D; &quot;mis*is*p*.&quot;</span><br><span class="line">è¾“å‡º: false</span><br></pre></td></tr></table></figure><ul><li><code>s</code> å¯èƒ½ä¸ºç©ºï¼Œä¸”åªåŒ…å«ä» <code>a-z</code> çš„å°å†™å­—æ¯ã€‚</li><li><code>p</code> å¯èƒ½ä¸ºç©ºï¼Œä¸”åªåŒ…å«ä» <code>a-z</code> çš„å°å†™å­—æ¯ä»¥åŠå­—ç¬¦ <code>.</code> å’Œ <code>*</code>ï¼Œæ— è¿ç»­çš„ <code>'*'</code>ã€‚</li></ul><p><strong>Solution</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">isMatch</span><span class="params">(<span class="built_in">string</span> s, <span class="built_in">string</span> p)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> m = s.<span class="built_in">size</span>() + <span class="number">1</span>, n = p.<span class="built_in">size</span>() + <span class="number">1</span>;</span><br><span class="line">        <span class="function"><span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">bool</span>&gt;&gt; <span class="title">dp</span><span class="params">(m, <span class="built_in">vector</span>&lt;<span class="keyword">bool</span>&gt;(n, <span class="literal">false</span>))</span></span>;</span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="literal">true</span>;</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–é¦–è¡Œ</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">2</span>; j &lt; n; j += <span class="number">2</span>)</span><br><span class="line">            dp[<span class="number">0</span>][j] = dp[<span class="number">0</span>][j - <span class="number">2</span>] &amp;&amp; p[j - <span class="number">1</span>] == <span class="string">'*'</span>;</span><br><span class="line">        <span class="comment">// çŠ¶æ€è½¬ç§»</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; n; j++) &#123;</span><br><span class="line">                <span class="comment">// æ¨¡å¼ä¸²æ˜¯å¦ä¸º *</span></span><br><span class="line">                <span class="keyword">if</span> (p[j - <span class="number">1</span>] == <span class="string">'*'</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (dp[i][j - <span class="number">2</span>]) dp[i][j] = <span class="literal">true</span>;  </span><br><span class="line">                    <span class="comment">// å½“å‰æ¨¡å¼ä¸²å­—ç¬¦å‰ä¸€ä½ä¸å½“å‰åŒ¹é…ä¸²å­—ç¬¦ç›¸åŒï¼Œæˆ–è€…ä¸º . åˆ™å–å†³äºæ­£ä¸Šæ–¹æƒ…å†µ                            </span></span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (s[i - <span class="number">1</span>] == p[j - <span class="number">2</span>] || p[j - <span class="number">2</span>] == <span class="string">'.'</span>) dp[i][j] = dp[i - <span class="number">1</span>][j]; </span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// // å½“å‰æ¨¡å¼ä¸²å­—ç¬¦ä¸å½“å‰åŒ¹é…ä¸²å­—ç¬¦ç›¸åŒï¼Œæˆ–è€…ä¸º . åˆ™å–å†³äºå·¦æ–œä¸Šæ–¹æƒ…å†µ</span></span><br><span class="line">                    <span class="keyword">if</span> (p[j - <span class="number">1</span>] == <span class="string">'.'</span> || s[i - <span class="number">1</span>] == p[j - <span class="number">1</span>]) dp[i][j] = dp[i - <span class="number">1</span>][j - <span class="number">1</span>];  </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[m - <span class="number">1</span>][n - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(MN)$ï¼Œå…¶ä¸­ <em>M</em> ä¸ºåŒ¹é…ä¸²çš„é•¿åº¦ï¼Œ<em>N</em> ä¸ºæ¨¡å¼ä¸²çš„é•¿åº¦ã€‚</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(MN)$ï¼Œ<em>dp</em> çŸ©é˜µæ‰€éœ€è¦çš„é¢å¤–ç©ºé—´æ¶ˆè€—ã€‚</p><hr><h3 id="å‰‘æŒ‡-Offer-42-è¿ç»­å­æ•°ç»„çš„æœ€å¤§å’Œ"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-42-è¿ç»­å­æ•°ç»„çš„æœ€å¤§å’Œ">Â¶</a><a href="https://leetcode-cn.com/problems/lian-xu-zi-shu-zu-de-zui-da-he-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 42. è¿ç»­å­æ•°ç»„çš„æœ€å¤§å’Œ</a></h3><p>Difficulty: <strong><font color="008F00">ç®€å•</font></strong></p><p>è¾“å…¥ä¸€ä¸ªæ•´å‹æ•°ç»„ï¼Œæ•°ç»„ä¸­çš„ä¸€ä¸ªæˆ–è¿ç»­å¤šä¸ªæ•´æ•°ç»„æˆä¸€ä¸ªå­æ•°ç»„ã€‚æ±‚æ‰€æœ‰å­æ•°ç»„çš„å’Œçš„æœ€å¤§å€¼ã€‚</p><p>è¦æ±‚æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ã€‚</p><p><strong>ç¤ºä¾‹1:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: nums &#x3D; [-2,1,-3,4,-1,2,1,-5,4]</span><br><span class="line">è¾“å‡º: 6</span><br><span class="line">è§£é‡Š: è¿ç»­å­æ•°ç»„ [4,-1,2,1] çš„å’Œæœ€å¤§ï¼Œä¸º 6ã€‚</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li><code>1 &lt;= arr.length &lt;= 10^5</code></li><li><code>-100 &lt;= arr[i] &lt;= 100</code></li></ul><p><strong>Solution</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxSubArray</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">dp</span><span class="params">(n)</span></span>;</span><br><span class="line">        dp[<span class="number">0</span>] = nums[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">int</span> result = dp[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">            <span class="comment">// dp[i - 1] &lt; 0 çš„æƒ…å†µ,dp[i] = nums[i],ä¹Ÿå°±æ˜¯é‡æ–°ä»nums[i]å¼€å§‹éå†</span></span><br><span class="line">            <span class="comment">// dp[i - 1] &gt; 0 çš„æƒ…å†µ,dp[i] = dp[i - 1] + nums[i],è€ƒè™‘å‰è€…ä»ç„¶å¯¹å…¶æœ‰å¢ç›Šæ•ˆæœ</span></span><br><span class="line">            dp[i] = <span class="built_in">max</span>(dp[i - <span class="number">1</span>] + nums[i], nums[i]);</span><br><span class="line">            <span class="keyword">if</span> (dp[i] &gt; result) result = dp[i]; <span class="comment">// æ¯è½®æ›´æ–°æœ€å¤§å€¼</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œ<em>N</em> ä¸ºæ•°ç»„ <em>nums</em> çš„é•¿åº¦ã€‚</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œ<em>dp</em> æ‰€éœ€è¦çš„é¢å¤–ç©ºé—´æ¶ˆè€—ã€‚</p><hr><h3 id="å‰‘æŒ‡-Offer-46-æŠŠæ•°å­—ç¿»è¯‘æˆå­—ç¬¦ä¸²"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-46-æŠŠæ•°å­—ç¿»è¯‘æˆå­—ç¬¦ä¸²">Â¶</a><a href="https://leetcode-cn.com/problems/ba-shu-zi-fan-yi-cheng-zi-fu-chuan-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 46. æŠŠæ•°å­—ç¿»è¯‘æˆå­—ç¬¦ä¸²</a></h3><p>Difficulty: <strong><font color="F08F00">ä¸­ç­‰</font></strong></p><p>ç»™å®šä¸€ä¸ªæ•°å­—ï¼Œæˆ‘ä»¬æŒ‰ç…§å¦‚ä¸‹è§„åˆ™æŠŠå®ƒç¿»è¯‘ä¸ºå­—ç¬¦ä¸²ï¼š0 ç¿»è¯‘æˆ â€œaâ€ ï¼Œ1 ç¿»è¯‘æˆ â€œbâ€ï¼Œâ€¦â€¦ï¼Œ11 ç¿»è¯‘æˆ â€œlâ€ï¼Œâ€¦â€¦ï¼Œ25 ç¿»è¯‘æˆ â€œzâ€ã€‚ä¸€ä¸ªæ•°å­—å¯èƒ½æœ‰å¤šä¸ªç¿»è¯‘ã€‚è¯·ç¼–ç¨‹å®ç°ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥è®¡ç®—ä¸€ä¸ªæ•°å­—æœ‰å¤šå°‘ç§ä¸åŒçš„ç¿»è¯‘æ–¹æ³•ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: 12258</span><br><span class="line">è¾“å‡º: 5</span><br><span class="line">è§£é‡Š: 12258æœ‰5ç§ä¸åŒçš„ç¿»è¯‘ï¼Œåˆ†åˆ«æ˜¯&quot;bccfi&quot;, &quot;bwfi&quot;, &quot;bczi&quot;, &quot;mcfi&quot;å’Œ&quot;mzi&quot;</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li><code>0 &lt;= num &lt; 2^31</code></li></ul><p><strong>Solution</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">translateNum</span><span class="params">(<span class="keyword">int</span> num)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> a = <span class="number">1</span>, b = <span class="number">1</span>, x = <span class="number">0</span>, y = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// num å¤§äºä¸¤ä½æ•°</span></span><br><span class="line">        <span class="keyword">while</span>(num &gt; <span class="number">9</span>) &#123;</span><br><span class="line">            y = num % <span class="number">10</span>; <span class="comment">// å€’æ•°ç¬¬ä¸€ä½</span></span><br><span class="line">            num /= <span class="number">10</span>;</span><br><span class="line">            x = num % <span class="number">10</span>; <span class="comment">// å€’æ•°ç¬¬äºŒä½</span></span><br><span class="line">            <span class="keyword">int</span> tmp = <span class="number">10</span> * x + y;  <span class="comment">// æœ€åä¸¤ä½æ„æˆçš„æ•°å­—</span></span><br><span class="line">            <span class="comment">// å¦‚æœè¯¥æ•°å­—æ»¡è¶³æ„æˆå­—æ¯çš„è¦æ±‚ï¼Œä¹Ÿå³æ˜¯ç¬¦åˆ 10 &lt;= tmp &lt;= 25</span></span><br><span class="line">            <span class="keyword">int</span> c = (tmp &gt;= <span class="number">10</span> &amp;&amp; tmp &lt;= <span class="number">25</span>) ? a + b : a;</span><br><span class="line">            b = a;</span><br><span class="line">            a = c;</span><br><span class="line">            y = x;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(log_{10}N)$ï¼Œå³ <em>num</em> çš„ä½æ•°ã€‚</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(1)$ï¼Œ<em>a, b, c, x, y, tmp</em>, å¸¸æ•°ä¸ªå˜é‡æ‰€éœ€çš„é¢å¤–ç©ºé—´ã€‚</p><hr><h3 id="å‰‘æŒ‡-Offer-47-ç¤¼ç‰©çš„æœ€å¤§ä»·å€¼"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-47-ç¤¼ç‰©çš„æœ€å¤§ä»·å€¼">Â¶</a><a href="https://leetcode-cn.com/problems/li-wu-de-zui-da-jie-zhi-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 47. ç¤¼ç‰©çš„æœ€å¤§ä»·å€¼</a></h3><p>Difficulty: <strong><font color="F08F00">ä¸­ç­‰</font></strong></p><p>åœ¨ä¸€ä¸ª m*n çš„æ£‹ç›˜çš„æ¯ä¸€æ ¼éƒ½æ”¾æœ‰ä¸€ä¸ªç¤¼ç‰©ï¼Œæ¯ä¸ªç¤¼ç‰©éƒ½æœ‰ä¸€å®šçš„ä»·å€¼ï¼ˆä»·å€¼å¤§äº 0ï¼‰ã€‚ä½ å¯ä»¥ä»æ£‹ç›˜çš„å·¦ä¸Šè§’å¼€å§‹æ‹¿æ ¼å­é‡Œçš„ç¤¼ç‰©ï¼Œå¹¶æ¯æ¬¡å‘å³æˆ–è€…å‘ä¸‹ç§»åŠ¨ä¸€æ ¼ã€ç›´åˆ°åˆ°è¾¾æ£‹ç›˜çš„å³ä¸‹è§’ã€‚ç»™å®šä¸€ä¸ªæ£‹ç›˜åŠå…¶ä¸Šé¢çš„ç¤¼ç‰©çš„ä»·å€¼ï¼Œè¯·è®¡ç®—ä½ æœ€å¤šèƒ½æ‹¿åˆ°å¤šå°‘ä»·å€¼çš„ç¤¼ç‰©ï¼Ÿ</p><p><strong>ç¤ºä¾‹ 1:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: </span><br><span class="line">[</span><br><span class="line">  [1,3,1],</span><br><span class="line">  [1,5,1],</span><br><span class="line">  [4,2,1]</span><br><span class="line">]</span><br><span class="line">è¾“å‡º: 12</span><br><span class="line">è§£é‡Š: è·¯å¾„ 1â†’3â†’5â†’2â†’1 å¯ä»¥æ‹¿åˆ°æœ€å¤šä»·å€¼çš„ç¤¼ç‰©</span><br></pre></td></tr></table></figure><p>æç¤ºï¼š</p><ul><li><code>0 &lt; grid.length &lt;= 200</code></li><li><code>0 &lt; grid[0].length &lt;= 200</code></li></ul><p><strong>Solution</strong></p><p><strong><font color="F08F00">åŠ¨æ€è§„åˆ’</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxValue</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt;&amp; grid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> m = grid.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">int</span> n = grid[<span class="number">0</span>].<span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; <span class="title">dp</span><span class="params">(m, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;(n))</span></span>;</span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">0</span>] = grid[<span class="number">0</span>][<span class="number">0</span>];</span><br><span class="line">		<span class="comment">// åˆå§‹åŒ–ç¬¬ä¸€è¡Œ</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">            dp[<span class="number">0</span>][i] = dp[<span class="number">0</span>][i - <span class="number">1</span>] + grid[<span class="number">0</span>][i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–ç¬¬ä¸€åˆ—</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; m; i++) &#123;</span><br><span class="line">            dp[i][<span class="number">0</span>] = dp[i - <span class="number">1</span>][<span class="number">0</span>] + grid[i][<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// åŠ¨æ€è§„åˆ’</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; n; j++) &#123;</span><br><span class="line">                <span class="comment">// å½“å‰å…ƒç´ å–å€¼ç”±å…¶ä¸Šæ–¹å’Œå·¦æ–¹å…ƒç´ å†³å®š</span></span><br><span class="line">                dp[i][j] = <span class="built_in">max</span>(dp[i][j - <span class="number">1</span>], dp[i - <span class="number">1</span>][j]) + grid[i][j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[m - <span class="number">1</span>][n - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(M \times N)$ï¼Œ<em>M</em> ä¸ºè¡Œæ•°ï¼Œ<em>N</em> ä¸ºåˆ—æ•°ã€‚</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(M \times N)$ ï¼Œ<em>dp</em> æ‰€å ç”¨çš„é¢å¤–ç©ºé—´ã€‚</p><hr><p><strong><font color="F08F00">åŠ¨æ€è§„åˆ’</font></strong>ï¼Œ<strong><font color="FF8888">ç©ºé—´ä¼˜åŒ–</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxValue</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt;&amp; grid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> m = grid.<span class="built_in">size</span>(), n = grid[<span class="number">0</span>].<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; n; j++) <span class="comment">// åˆå§‹åŒ–ç¬¬ä¸€è¡Œ</span></span><br><span class="line">            grid[<span class="number">0</span>][j] += grid[<span class="number">0</span>][j - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; m; i++) <span class="comment">// åˆå§‹åŒ–ç¬¬ä¸€åˆ—</span></span><br><span class="line">            grid[i][<span class="number">0</span>] += grid[i - <span class="number">1</span>][<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; m; i++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; n; j++)</span><br><span class="line">                grid[i][j] += <span class="built_in">max</span>(grid[i][j - <span class="number">1</span>], grid[i - <span class="number">1</span>][j]);</span><br><span class="line">        <span class="keyword">return</span> grid[m - <span class="number">1</span>][n - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(M \times N)$ï¼Œ<em>M</em> ä¸ºè¡Œæ•°ï¼Œ<em>N</em> ä¸ºåˆ—æ•°ã€‚</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(1)$ ï¼ŒåŸåœ°æ“ä½œã€‚</p><hr><h3 id="å‰‘æŒ‡-Offer-48-æœ€é•¿ä¸å«é‡å¤å­—ç¬¦çš„å­å­—ç¬¦ä¸²"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-48-æœ€é•¿ä¸å«é‡å¤å­—ç¬¦çš„å­å­—ç¬¦ä¸²">Â¶</a><a href="https://leetcode-cn.com/problems/zui-chang-bu-han-zhong-fu-zi-fu-de-zi-zi-fu-chuan-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 48. æœ€é•¿ä¸å«é‡å¤å­—ç¬¦çš„å­å­—ç¬¦ä¸²</a></h3><p>Difficulty: <strong><font color="F08F00">ä¸­ç­‰</font></strong></p><p>è¯·ä»å­—ç¬¦ä¸²ä¸­æ‰¾å‡ºä¸€ä¸ªæœ€é•¿çš„ä¸åŒ…å«é‡å¤å­—ç¬¦çš„å­å­—ç¬¦ä¸²ï¼Œè®¡ç®—è¯¥æœ€é•¿å­å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: &quot;abcabcbb&quot;</span><br><span class="line">è¾“å‡º: 3 </span><br><span class="line">è§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ &quot;abc&quot;ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 3ã€‚</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: &quot;bbbbb&quot;</span><br><span class="line">è¾“å‡º: 1</span><br><span class="line">è§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ &quot;b&quot;ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 1ã€‚</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 3:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: &quot;pwwkew&quot;</span><br><span class="line">è¾“å‡º: 3</span><br><span class="line">è§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ &quot;wke&quot;ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 3ã€‚</span><br><span class="line">     è¯·æ³¨æ„ï¼Œä½ çš„ç­”æ¡ˆå¿…é¡»æ˜¯ å­ä¸² çš„é•¿åº¦ï¼Œ&quot;pwke&quot; æ˜¯ä¸€ä¸ªå­åºåˆ—ï¼Œä¸æ˜¯å­ä¸²ã€‚</span><br></pre></td></tr></table></figure><p>æç¤ºï¼š</p><ul><li><code>s.length &lt;= 40000</code></li></ul><p><strong>Solution</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">lengthOfLongestSubstring</span><span class="params">(<span class="built_in">string</span> s)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">unordered_map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; mp;</span><br><span class="line">        <span class="keyword">int</span> len = s.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">-1</span>, res = <span class="number">0</span>; <span class="comment">// i = -1ï¼Œä»è¾¹ç•Œå¤–å¼€å§‹</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; len; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (mp.<span class="built_in">find</span>(s[j]) != mp.<span class="built_in">end</span>()) &#123;</span><br><span class="line">                <span class="comment">// i ä¸ºæœ€æ¥è¿‘ j æ—¶ï¼Œé‡å¤çš„ä½ç½®</span></span><br><span class="line">                i = <span class="built_in">max</span>(mp[s[j]], i);</span><br><span class="line">            &#125;</span><br><span class="line">            mp[s[j]] = j; <span class="comment">// æ›´æ–°å­—æ¯çš„ä½ç½®ä¿¡æ¯</span></span><br><span class="line">            res = <span class="built_in">max</span>(res, j - i);  <span class="comment">// æ›´æ–°æœ€å¤§é•¿åº¦</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œ<em>N</em> ä¸ºå­—ç¬¦ä¸²é•¿åº¦ï¼Œä¸€æ¬¡éå†å³å¯</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(1)$ï¼Œå“ˆå¸Œè¡¨æœ€å¤šå­˜26ä¸ªå­—æ¯ï¼Œå› æ­¤æ˜¯ä»…éœ€è¦å¸¸æ•°é¢å¤–ç©ºé—´ã€‚</p><hr><h3 id="å‰‘æŒ‡-Offer-49-ä¸‘æ•°"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-49-ä¸‘æ•°">Â¶</a><a href="https://leetcode-cn.com/problems/chou-shu-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 49. ä¸‘æ•°</a></h3><p>Difficulty: <strong><font color="F08F00">ä¸­ç­‰</font></strong></p><p>æˆ‘ä»¬æŠŠåªåŒ…å«è´¨å› å­ 2ã€3 å’Œ 5 çš„æ•°ç§°ä½œä¸‘æ•°ï¼ˆUgly Numberï¼‰ã€‚æ±‚æŒ‰ä»å°åˆ°å¤§çš„é¡ºåºçš„ç¬¬ n ä¸ªä¸‘æ•°ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: n &#x3D; 10</span><br><span class="line">è¾“å‡º: 12</span><br><span class="line">è§£é‡Š: 1, 2, 3, 4, 5, 6, 8, 9, 10, 12 æ˜¯å‰ 10 ä¸ªä¸‘æ•°ã€‚</span><br></pre></td></tr></table></figure><p>**è¯´æ˜: **</p><ol><li><code>1</code> æ˜¯ä¸‘æ•°ã€‚</li><li><code>n</code> <strong>ä¸è¶…è¿‡</strong>1690ã€‚</li></ol><p><strong>Solution</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">nthUglyNumber</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> a = <span class="number">0</span>, b = <span class="number">0</span>, c = <span class="number">0</span>;</span><br><span class="line">        <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">dp</span><span class="params">(n)</span></span>;</span><br><span class="line">        dp[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> n2 = dp[a] * <span class="number">2</span>, n3 = dp[b] * <span class="number">3</span>, n5 = dp[c] * <span class="number">5</span>;</span><br><span class="line">            dp[i] = <span class="built_in">min</span>(<span class="built_in">min</span>(n1, n2), n3);</span><br><span class="line">            <span class="keyword">if</span> (dp[i] == n2) a++;</span><br><span class="line">            <span class="keyword">if</span> (dp[i] == n3) b++;</span><br><span class="line">            <span class="keyword">if</span> (dp[i] == n5) c++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(n)$</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(n)$ï¼Œ<em>dp</em> é¢å¤–æ‰€éœ€çš„ç©ºé—´å¤æ‚åº¦</p><hr><h3 id="å‰‘æŒ‡-Offer-60-nä¸ªéª°å­çš„ç‚¹æ•°"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-60-nä¸ªéª°å­çš„ç‚¹æ•°">Â¶</a><a href="https://leetcode-cn.com/problems/nge-tou-zi-de-dian-shu-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 60. nä¸ªéª°å­çš„ç‚¹æ•°</a></h3><p>Difficulty: <strong><font color="F08F00">ä¸­ç­‰</font></strong></p><p>æŠŠnä¸ªéª°å­æ‰”åœ¨åœ°ä¸Šï¼Œæ‰€æœ‰éª°å­æœä¸Šä¸€é¢çš„ç‚¹æ•°ä¹‹å’Œä¸ºsã€‚è¾“å…¥nï¼Œæ‰“å°å‡ºsçš„æ‰€æœ‰å¯èƒ½çš„å€¼å‡ºç°çš„æ¦‚ç‡ã€‚</p><p>ä½ éœ€è¦ç”¨ä¸€ä¸ªæµ®ç‚¹æ•°æ•°ç»„è¿”å›ç­”æ¡ˆï¼Œå…¶ä¸­ç¬¬ i ä¸ªå…ƒç´ ä»£è¡¨è¿™ n ä¸ªéª°å­æ‰€èƒ½æ·å‡ºçš„ç‚¹æ•°é›†åˆä¸­ç¬¬ i å°çš„é‚£ä¸ªçš„æ¦‚ç‡ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: 1</span><br><span class="line">è¾“å‡º: [0.16667,0.16667,0.16667,0.16667,0.16667,0.16667]</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: 2</span><br><span class="line">è¾“å‡º: [0.02778,0.05556,0.08333,0.11111,0.13889,0.16667,0.13889,0.11111,0.08333,0.05556,0.02778]</span><br></pre></td></tr></table></figure><p><strong>é™åˆ¶ï¼š</strong></p><p><code>1 &lt;= n &lt;= 11</code></p><p><strong>Solution</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">double</span>&gt; <span class="title">dicesProbability</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">double</span>&gt; <span class="title">dp</span><span class="params">(<span class="number">6</span>, <span class="number">1.0</span> / <span class="number">6.0</span>)</span></span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">double</span>&gt; <span class="title">tmp</span><span class="params">(<span class="number">5</span> * i + <span class="number">1</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; dp.<span class="built_in">size</span>(); j++) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; <span class="number">6</span>; k++) &#123;</span><br><span class="line">                    tmp[j + k] += dp[j] / <span class="number">6.0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            dp = tmp;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="/Data_Structure_and_Algorithm/%E5%89%91%E6%8C%87offer/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/n%E4%B8%AA%E9%AA%B0%E5%AD%90%E7%82%B9%E6%95%B0%E6%97%B6%E9%97%B4%E7%A9%BA%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6.png" alt></p><p><strong><font color="FF8888">å‚è€ƒ</font></strong>: <a href="https://leetcode-cn.com/leetbook/read/illustration-of-algorithm/ozsdss/" target="_blank" rel="noopener">å›¾è§£ç®—æ³•æ•°æ®ç»“æ„ - å‰‘æŒ‡offer60)</a></p><hr><h3 id="å‰‘æŒ‡-Offer-63-è‚¡ç¥¨çš„æœ€å¤§åˆ©æ¶¦"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-63-è‚¡ç¥¨çš„æœ€å¤§åˆ©æ¶¦">Â¶</a><a href="https://leetcode-cn.com/problems/gu-piao-de-zui-da-li-run-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 63. è‚¡ç¥¨çš„æœ€å¤§åˆ©æ¶¦</a></h3><p>Difficulty: <strong><font color="F08F00">ä¸­ç­‰</font></strong></p><p>å‡è®¾æŠŠæŸè‚¡ç¥¨çš„ä»·æ ¼æŒ‰ç…§æ—¶é—´å…ˆåé¡ºåºå­˜å‚¨åœ¨æ•°ç»„ä¸­ï¼Œè¯·é—®ä¹°å–è¯¥è‚¡ç¥¨ä¸€æ¬¡å¯èƒ½è·å¾—çš„æœ€å¤§åˆ©æ¶¦æ˜¯å¤šå°‘ï¼Ÿ</p><p><strong>ç¤ºä¾‹ 1:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: [7,1,5,3,6,4]</span><br><span class="line">è¾“å‡º: 5</span><br><span class="line">è§£é‡Š: åœ¨ç¬¬ 2 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ &#x3D; 1ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 5 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ &#x3D; 6ï¼‰çš„æ—¶å€™å–å‡ºï¼Œæœ€å¤§åˆ©æ¶¦ &#x3D; 6-1 &#x3D; 5 ã€‚</span><br><span class="line">     æ³¨æ„åˆ©æ¶¦ä¸èƒ½æ˜¯ 7-1 &#x3D; 6, å› ä¸ºå–å‡ºä»·æ ¼éœ€è¦å¤§äºä¹°å…¥ä»·æ ¼ã€‚</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: [7,6,4,3,1]</span><br><span class="line">è¾“å‡º: 0</span><br><span class="line">è§£é‡Š: åœ¨è¿™ç§æƒ…å†µä¸‹, æ²¡æœ‰äº¤æ˜“å®Œæˆ, æ‰€ä»¥æœ€å¤§åˆ©æ¶¦ä¸º 0ã€‚</span><br></pre></td></tr></table></figure><p><strong>é™åˆ¶ï¼š</strong></p><p><code>0 &lt;= æ•°ç»„é•¿åº¦ &lt;= 10^5</code></p><p><strong>Solution</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxProfit</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; prices)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> minPrice = INT_MAX;</span><br><span class="line">        <span class="keyword">int</span> maxPro = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; prices.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">            <span class="comment">// æ‰¾åˆ°å½“å‰æœ€ä½å€¼</span></span><br><span class="line">            minPrice = <span class="built_in">min</span>(minPrice, prices[i]);</span><br><span class="line">            maxPro = <span class="built_in">max</span>(maxPro, prices[i] - minPrice);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> maxPro;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(N )$ï¼ŒN ä¸º prices é•¿åº¦ï¼Œä¸€æ¬¡éå†</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(1 )$ï¼Œ<em>minPrice</em> å’Œ <em>maxPro</em> æ‰€éœ€çš„</p><hr><h3 id="å‚è€ƒèµ„æ–™"><a class="header-anchor" href="#å‚è€ƒèµ„æ–™">Â¶</a>å‚è€ƒèµ„æ–™</h3><blockquote><p><a href="https://leetcode-cn.com/leetbook/detail/illustration-of-algorithm/" target="_blank" rel="noopener">å›¾è§£ç®—æ³•æ•°æ®ç»“æ„ - LeetBook - åŠ›æ‰£ï¼ˆLeetCodeï¼‰å…¨çƒæå®¢æŒšçˆ±çš„æŠ€æœ¯æˆé•¿å¹³å° (leetcode-cn.com)</a></p><p><a href="https://leetcode-cn.com/" target="_blank" rel="noopener">åŠ›æ‰£ï¼ˆLeetCodeï¼‰å®˜ç½‘ - å…¨çƒæå®¢æŒšçˆ±çš„æŠ€æœ¯æˆé•¿å¹³å° (leetcode-cn.com)</a> å®˜æ–¹é¢˜è§£</p></blockquote><!-- rebuild by neat -->]]></content>
      <categories>
        <category>Data_Structure_and_Algorithm</category>
      </categories>
      <tags>
        <tag>åŠ¨æ€è§„åˆ’</tag>
      </tags>
  </entry>
  <entry>
    <title>å‰‘æŒ‡offer -- åˆ†æ²»ç®—æ³•</title>
    <url>/Data_Structure_and_Algorithm/%E5%89%91%E6%8C%87offer/%E5%88%86%E6%B2%BB%E7%AE%97%E6%B3%95/</url>
    <content><![CDATA[<!-- build time:Tue Jun 22 2021 17:02:33 GMT+0800 (GMT+08:00) --><a id="more"></a><h2 id="å‰‘æŒ‡offer-â€“-åˆ†æ²»ç®—æ³•"><a class="header-anchor" href="#å‰‘æŒ‡offer-â€“-åˆ†æ²»ç®—æ³•">Â¶</a>å‰‘æŒ‡offer â€“ åˆ†æ²»ç®—æ³•</h2><h3 id="å‰‘æŒ‡-Offer-07-é‡å»ºäºŒå‰æ ‘"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-07-é‡å»ºäºŒå‰æ ‘">Â¶</a><a href="https://leetcode-cn.com/problems/zhong-jian-er-cha-shu-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 07. é‡å»ºäºŒå‰æ ‘</a></h3><p>Difficulty: <strong><font color="F08F00">ä¸­ç­‰</font></strong></p><p>è¾“å…¥æŸäºŒå‰æ ‘çš„å‰åºéå†å’Œä¸­åºéå†çš„ç»“æœï¼Œè¯·é‡å»ºè¯¥äºŒå‰æ ‘ã€‚å‡è®¾è¾“å…¥çš„å‰åºéå†å’Œä¸­åºéå†çš„ç»“æœä¸­éƒ½ä¸å«é‡å¤çš„æ•°å­—ã€‚</p><p>ä¾‹å¦‚ï¼Œç»™å‡º</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å‰åºéå† preorder &#x3D; [3,9,20,15,7]</span><br><span class="line">ä¸­åºéå† inorder &#x3D; [9,3,15,20,7]</span><br></pre></td></tr></table></figure><p>è¿”å›å¦‚ä¸‹çš„äºŒå‰æ ‘ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">  3</span><br><span class="line"> &#x2F; \</span><br><span class="line">9  20</span><br><span class="line">  &#x2F;  \</span><br><span class="line"> 15   7</span><br></pre></td></tr></table></figure><p><strong>é™åˆ¶ï¼š</strong></p><p><code>0 &lt;= èŠ‚ç‚¹ä¸ªæ•° &lt;= 5000</code></p><p><strong>Solution</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(NULL), right(NULL) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">TreeNode* <span class="title">buildTree</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; preorder, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; inorder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = preorder.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            inMap[inorder[i]] = i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> buildTree(preorder, inorder, <span class="number">0</span>, n - <span class="number">1</span>, <span class="number">0</span>, n - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">unordered_map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; inMap; <span class="comment">// ç”¨æ¥å­˜ index å¯¹åº”çš„ inorder å€¼</span></span><br><span class="line">    <span class="function">TreeNode* <span class="title">buildTree</span><span class="params">(<span class="keyword">const</span> <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; preorder, <span class="keyword">const</span> <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; inorder, <span class="keyword">int</span> preLeft, <span class="keyword">int</span> preRight, <span class="keyword">int</span> inLeft, <span class="keyword">int</span> inRight)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (preLeft &gt; preRight) <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">        <span class="comment">// æ ¹èŠ‚ç‚¹æ˜¯å‰åºéå†çš„ç¬¬ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">        <span class="keyword">int</span> rootIndex = preLeft; <span class="keyword">int</span> rootValue = preorder[rootIndex];</span><br><span class="line">        <span class="keyword">int</span> rootIndexInMap = inMap[rootValue];   <span class="comment">// è·å¾—æ ¹èŠ‚ç‚¹åœ¨inorderä¸­ç´¢å¼•ä½ç½®</span></span><br><span class="line">        <span class="keyword">int</span> leftSize = rootIndexInMap - inLeft; <span class="comment">// è·å¾—å·¦å­æ ‘çš„èŠ‚ç‚¹æ ‘</span></span><br><span class="line"></span><br><span class="line">        TreeNode* root = <span class="keyword">new</span> TreeNode(rootValue); <span class="comment">// åˆ›å»ºæ ¹èŠ‚ç‚¹</span></span><br><span class="line">        root-&gt;left = buildTree(preorder, inorder, preLeft + <span class="number">1</span>, preLeft + leftSize, inLeft, rootIndexInMap - <span class="number">1</span>);   <span class="comment">// åˆ›å»ºå·¦èŠ‚ç‚¹</span></span><br><span class="line">        root-&gt;right = buildTree(preorder, inorder, preLeft + leftSize + <span class="number">1</span>, preRight, rootIndexInMap + <span class="number">1</span>, inRight);  <span class="comment">// åˆ›å»ºå³èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œ<em>N</em> ä¸ºèŠ‚ç‚¹æ•°</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œå“ˆå¸Œè¡¨å ç”¨ç©ºé—´ $O(N)$ï¼Œæ ‘åˆ›å»ºè¿‡ç¨‹ä¸­ $O(\log N) \backsim O(N)$</p><hr><h3 id="å‰‘æŒ‡-Offer-16-æ•°å€¼çš„æ•´æ•°æ¬¡æ–¹"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-16-æ•°å€¼çš„æ•´æ•°æ¬¡æ–¹">Â¶</a><a href="https://leetcode-cn.com/problems/shu-zhi-de-zheng-shu-ci-fang-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 16. æ•°å€¼çš„æ•´æ•°æ¬¡æ–¹</a></h3><p>Difficulty: <strong><font color="F08F00">ä¸­ç­‰</font></strong></p><p>å®ç° ï¼Œå³è®¡ç®— x çš„ n æ¬¡å¹‚å‡½æ•°ï¼ˆå³ï¼Œx<sup>n</sup>ï¼‰ã€‚ä¸å¾—ä½¿ç”¨åº“å‡½æ•°ï¼ŒåŒæ—¶ä¸éœ€è¦è€ƒè™‘å¤§æ•°é—®é¢˜ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šx &#x3D; 2.00000, n &#x3D; 10</span><br><span class="line">è¾“å‡ºï¼š1024.00000</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šx &#x3D; 2.10000, n &#x3D; 3</span><br><span class="line">è¾“å‡ºï¼š9.26100</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šx &#x3D; 2.00000, n &#x3D; -2</span><br><span class="line">è¾“å‡ºï¼š0.25000</span><br><span class="line">è§£é‡Šï¼š2-2 &#x3D; 1&#x2F;22 &#x3D; 1&#x2F;4 &#x3D; 0.25</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li><code>-100.0 &lt; x &lt; 100.0</code></li><li>$-2^{31} \leq n \leq 2^{31} - 1$</li><li>$-10^4 \leq x^n \leq 10^4$</li></ul><p><strong>Solution</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">myPow</span><span class="params">(<span class="keyword">double</span> x, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (x == <span class="number">0.0</span>) <span class="keyword">return</span> <span class="number">0.0</span>;</span><br><span class="line">        <span class="keyword">long</span> b = n;</span><br><span class="line">        <span class="keyword">double</span> res = <span class="number">1.0</span>;</span><br><span class="line">        <span class="comment">// è´Ÿæ•°æƒ…å†µ</span></span><br><span class="line">        <span class="keyword">if</span> (b &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            b = -b;</span><br><span class="line">            x = <span class="number">1</span> / x;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (b) &#123;</span><br><span class="line">            <span class="comment">// éœ€è¦åˆ†å¥‡å¶æƒ…å†µï¼Œå¥‡æ•°æƒ…å†µ x^n = x(x^(n/2))^2</span></span><br><span class="line">            <span class="comment">// å¶æ•°æƒ…å†µ x^n = (x^(n/2))^2</span></span><br><span class="line">            <span class="keyword">if</span> ((b &amp; <span class="number">1</span>) == <span class="number">1</span>) res *= x;</span><br><span class="line">            x *= x;</span><br><span class="line">            b &gt;&gt;= <span class="number">1</span>; <span class="comment">// å³ç§»ä¸€ä½</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(\log N)$ï¼ŒäºŒåˆ†çš„æ—¶é—´å¤æ‚åº¦ä¸ºå¯¹æ•°çº§åˆ«ã€‚</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(1)$ï¼Œ<em>res , b</em> ç­‰å˜é‡å ç”¨å¸¸æ•°å¤§å°é¢å¤–ç©ºé—´ã€‚</p><hr><h3 id="å‰‘æŒ‡-Offer-17-æ‰“å°ä»1åˆ°æœ€å¤§çš„nä½æ•°"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-17-æ‰“å°ä»1åˆ°æœ€å¤§çš„nä½æ•°">Â¶</a><a href="https://leetcode-cn.com/problems/da-yin-cong-1dao-zui-da-de-nwei-shu-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 17. æ‰“å°ä»1åˆ°æœ€å¤§çš„nä½æ•°</a></h3><p>Difficulty: <strong><font color="008F00">ç®€å•</font></strong></p><p>è¾“å…¥æ•°å­— <code>n</code>ï¼ŒæŒ‰é¡ºåºæ‰“å°å‡ºä» 1 åˆ°æœ€å¤§çš„ n ä½åè¿›åˆ¶æ•°ã€‚æ¯”å¦‚è¾“å…¥ 3ï¼Œåˆ™æ‰“å°å‡º 1ã€2ã€3 ä¸€ç›´åˆ°æœ€å¤§çš„ 3 ä½æ•° 999ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: n &#x3D; 1</span><br><span class="line">è¾“å‡º: [1,2,3,4,5,6,7,8,9]</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼š</p><ul><li>ç”¨è¿”å›ä¸€ä¸ªæ•´æ•°åˆ—è¡¨æ¥ä»£æ›¿æ‰“å°</li><li>n ä¸ºæ­£æ•´æ•°</li></ul><p><strong>Solution</strong></p><p><strong><font color="F08F00">1. ä¸è€ƒè™‘å¤§æ•°é—®é¢˜</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">printNumbers</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> maxN = <span class="built_in">pow</span>(<span class="number">10</span>, n);</span><br><span class="line">        <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">res</span><span class="params">(maxN - <span class="number">1</span>)</span></span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; maxN; i++) &#123;</span><br><span class="line">            res[i - <span class="number">1</span>] = i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼Œç©ºé—´å¤æ‚åº¦</strong>çš†æ˜¯ $O(10^n)$</p><hr><p><strong><font color="F08F00">2. è€ƒè™‘å¤§æ•°é—®é¢˜</font></strong></p><p>å›æº¯ï¼Œæ’åˆ—é—®é¢˜</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; nums;</span><br><span class="line">    <span class="built_in">string</span> s;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">printNumbers</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        s.resize(n, <span class="string">'0'</span>);  <span class="comment">// åˆå§‹åŒ– s</span></span><br><span class="line">        backtracking(<span class="number">0</span>, n, s);</span><br><span class="line">        <span class="keyword">return</span> nums;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">backtracking</span><span class="params">(<span class="keyword">int</span> idx, <span class="keyword">int</span> <span class="built_in">end</span>, <span class="built_in">string</span>&amp; s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (idx == <span class="built_in">end</span>) &#123;</span><br><span class="line">            <span class="comment">// å»é™¤é¦–éƒ¨0çš„æƒ…å†µ</span></span><br><span class="line">            <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span> (j &lt; s.<span class="built_in">size</span>() &amp;&amp; s[j] == <span class="string">'0'</span>) j++;</span><br><span class="line">            <span class="keyword">if</span> (j != s.<span class="built_in">size</span>()) nums.push_back(stoi(s.substr(j))); </span><br><span class="line">            <span class="comment">// æœ¬é¢˜é™åˆ¶è¾“å‡ºvector&lt;int&gt;ï¼Œæ‰€ä»¥å¯ä»¥ç”¨stoiæ¥è½¬æ¢ï¼Œ</span></span><br><span class="line">            <span class="comment">// å¦‚æœè¾“å‡ºä¸ºvector&lt;string&gt;, åˆ™ä¸éœ€è¦è½¬æ¢</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">9</span>; ++i) &#123;</span><br><span class="line">            <span class="comment">// å¸¸è§å›æº¯å†™æ³•</span></span><br><span class="line">            s[idx] = i + <span class="string">'0'</span>;</span><br><span class="line">            backtracking(idx + <span class="number">1</span>, <span class="built_in">end</span>, s);</span><br><span class="line">            s[idx] = <span class="string">'0'</span>; <span class="comment">// å›æº¯</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong><font color="FF8888">æ³¨æ„</font></strong>ï¼š<a href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzUxNjY5NTYxNA==&amp;action=getalbum&amp;album_id=1607983171550167042&amp;scene=173&amp;from_msgid=2247485372&amp;from_itemidx=1&amp;count=3&amp;nolastread=1#wechat_redirect" target="_blank" rel="noopener">å›æº¯ç®—æ³•</a> å¯ä»¥çœ‹ carl å¤§ä½¬å†™çš„ä¸“é¢˜ï¼</p><p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š$O(10^n)$ï¼Œé€’å½’ç”Ÿæˆçš„æ’åˆ—æ•°é‡ä¸º $10^n - 1$ã€‚</p><p><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š$O(10^n)$ï¼Œä¸­é—´è·å¾—çš„ç»“æœå­˜äº <em>nums</em> ä¸­ã€‚</p><hr><h3 id="å‰‘æŒ‡-Offer-33-äºŒå‰æœç´¢æ ‘çš„ååºéå†åºåˆ—"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-33-äºŒå‰æœç´¢æ ‘çš„ååºéå†åºåˆ—">Â¶</a><a href="https://leetcode-cn.com/problems/er-cha-sou-suo-shu-de-hou-xu-bian-li-xu-lie-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 33. äºŒå‰æœç´¢æ ‘çš„ååºéå†åºåˆ—</a></h3><p>Difficulty: <strong><font color="F08F00">ä¸­ç­‰</font></strong></p><p>è¾“å…¥ä¸€ä¸ªæ•´æ•°æ•°ç»„ï¼Œåˆ¤æ–­è¯¥æ•°ç»„æ˜¯ä¸æ˜¯æŸäºŒå‰æœç´¢æ ‘çš„ååºéå†ç»“æœã€‚å¦‚æœæ˜¯åˆ™è¿”å› <code>true</code>ï¼Œå¦åˆ™è¿”å› <code>false</code>ã€‚å‡è®¾è¾“å…¥çš„æ•°ç»„çš„ä»»æ„ä¸¤ä¸ªæ•°å­—éƒ½äº’ä¸ç›¸åŒã€‚</p><p>å‚è€ƒä»¥ä¸‹è¿™é¢—äºŒå‰æœç´¢æ ‘ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">    5</span><br><span class="line">   &#x2F; \</span><br><span class="line">  2   6</span><br><span class="line"> &#x2F; \</span><br><span class="line">1   3</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: [1,6,3,2,5]</span><br><span class="line">è¾“å‡º: false</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: [1,3,2,6,5]</span><br><span class="line">è¾“å‡º: true</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ol><li><code>æ•°ç»„é•¿åº¦ &lt;= 1000</code></li></ol><p><strong>Solution</strong></p><p><strong><font color="F08F00">æ–¹æ³•ä¸€ï¼šé€’å½’å†™æ³•</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">verifyPostorder</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; postorder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> recur(postorder, <span class="number">0</span>, postorder.<span class="built_in">size</span>() - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">recur</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; postorder, <span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (i &gt;= j) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">int</span> p = i;</span><br><span class="line">        <span class="comment">// æ‰¾åˆ°å·¦å­æ ‘ï¼Œå…¶ä¸­ postorder[j] ä»£è¡¨æ ¹èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">while</span> (postorder[p] &lt; postorder[j]) p++;</span><br><span class="line">        <span class="keyword">int</span> m = p;   <span class="comment">// m ä¸ºå·¦å³å­æ ‘æ‹ç‚¹ï¼Œåœ¨å³å­æ ‘ä¸­ç¬¬ä¸€ä¸ª</span></span><br><span class="line">        <span class="comment">// æ‰¾åˆ°å³å­æ ‘ï¼Œå…¶ä¸­ postorder[j] ä»£è¡¨æ ¹èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">while</span> (postorder[p] &gt; postorder[j]) p++;</span><br><span class="line">        <span class="comment">// åªæœ‰ p éå†åˆ° æ ¹èŠ‚ç‚¹ï¼Œå·¦å³å­æ ‘éƒ½é€’å½’è¿”å› true æ‰è¿”å› true</span></span><br><span class="line">        <span class="keyword">return</span> p == j &amp;&amp; recur(postorder, i, m - <span class="number">1</span>) &amp;&amp; recur(postorder, m, j - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(N^2)$ï¼Œæ¯æ¬¡è°ƒç”¨ <em>recur(i,j)</em> å‡å»ä¸€ä¸ªæ ¹èŠ‚ç‚¹ï¼Œå› æ­¤é€’å½’å ç”¨ <em>O(N)</em> ï¼›æœ€å·®æƒ…å†µä¸‹ï¼ˆå³å½“æ ‘é€€åŒ–ä¸ºé“¾è¡¨ï¼‰ï¼Œæ¯è½®é€’å½’éƒ½éœ€éå†æ ‘æ‰€æœ‰èŠ‚ç‚¹ï¼Œå ç”¨ <em>O(N)</em> ã€‚</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œæœ€å·®æƒ…å†µä¸‹ï¼ˆå³å½“æ ‘é€€åŒ–ä¸ºé“¾è¡¨ï¼‰ï¼Œé€’å½’æ·±åº¦å°†è¾¾åˆ° <em>N</em>ã€‚</p><hr><p><strong><font color="F08F00">æ–¹æ³•äºŒï¼šå•è°ƒæ ˆ</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">verifyPostorder</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; postorder)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt; stk;</span><br><span class="line">        <span class="keyword">int</span> root = INT_MAX;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = postorder.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            <span class="keyword">if</span> (postorder[i] &gt; root) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">while</span> (!stk.empty() &amp;&amp; stk.top() &gt; postorder[i]) &#123;</span><br><span class="line">                root = stk.top();</span><br><span class="line">                stk.pop();</span><br><span class="line">            &#125;</span><br><span class="line">            stk.push(postorder[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œéå† <em>postorder</em> æ‰€æœ‰èŠ‚ç‚¹ï¼Œå„èŠ‚ç‚¹å‡å…¥æ ˆ/å‡ºæ ˆä¸€æ¬¡ï¼Œä½¿ç”¨ $O(N)$ æ—¶é—´ã€‚</p><p>**ç©ºé—´å¤æ‚åº¦ï¼š**æœ€å·®æƒ…å†µä¸‹ï¼Œå•è°ƒæ ˆ <em>stack</em> å­˜å‚¨æ‰€æœ‰èŠ‚ç‚¹ï¼Œä½¿ç”¨ $O(N)$ é¢å¤–ç©ºé—´ã€‚</p><hr><h3 id="å‰‘æŒ‡-Offer-51-æ•°ç»„ä¸­çš„é€†åºå¯¹"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-51-æ•°ç»„ä¸­çš„é€†åºå¯¹">Â¶</a><a href="https://leetcode-cn.com/problems/shu-zu-zhong-de-ni-xu-dui-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 51. æ•°ç»„ä¸­çš„é€†åºå¯¹</a></h3><p>Difficulty: <strong><font color="FF0000">å›°éš¾</font></strong></p><p>åœ¨æ•°ç»„ä¸­çš„ä¸¤ä¸ªæ•°å­—ï¼Œå¦‚æœå‰é¢ä¸€ä¸ªæ•°å­—å¤§äºåé¢çš„æ•°å­—ï¼Œåˆ™è¿™ä¸¤ä¸ªæ•°å­—ç»„æˆä¸€ä¸ªé€†åºå¯¹ã€‚è¾“å…¥ä¸€ä¸ªæ•°ç»„ï¼Œæ±‚å‡ºè¿™ä¸ªæ•°ç»„ä¸­çš„é€†åºå¯¹çš„æ€»æ•°ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: [7,5,6,4]</span><br><span class="line">è¾“å‡º: 5</span><br></pre></td></tr></table></figure><p><strong>é™åˆ¶ï¼š</strong></p><p><code>0 &lt;= æ•°ç»„é•¿åº¦ &lt;= 50000</code></p><p><strong>Solution</strong></p><p><strong><font color="F08F00">æ–¹æ³•ä¸€ï¼šæš´åŠ›è§£æ³•</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">reversePairs</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// æš´åŠ›è§£æ³• (è¶…æ—¶)</span></span><br><span class="line">        <span class="keyword">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">if</span> (n &lt; <span class="number">2</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span>; j &lt; n; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (nums[j] &lt; nums[i]) &#123;</span><br><span class="line">                    count++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(N^2)$ï¼Œä¸¤å±‚éå†</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(1)$ï¼Œ<em>count</em> æ‰€éœ€çš„é¢å¤–ç©ºé—´</p><hr><p><strong><font color="F08F00">æ–¹æ³•äºŒï¼šå½’å¹¶æ’åº</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">reversePairs</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">if</span> (n &lt; <span class="number">2</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">temp</span><span class="params">(n)</span></span>;</span><br><span class="line">        <span class="keyword">return</span> mergeSort(nums, temp, <span class="number">0</span>, n - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">mergeSort</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; temp, <span class="keyword">int</span> left, <span class="keyword">int</span> right)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (left &gt;= right) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> mid = (left + right) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">int</span> res = mergeSort(nums, temp, left, mid) + mergeSort(nums, temp, mid + <span class="number">1</span>, right);</span><br><span class="line">        <span class="keyword">int</span> i = left, j = mid + <span class="number">1</span>, k = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (i &lt;= mid &amp;&amp; j &lt;= right) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i] &lt;= nums[j]) &#123;</span><br><span class="line">                <span class="comment">// çš†æ˜¯é¡ºåºå¯¹</span></span><br><span class="line">                temp[k++] = nums[i++];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                temp[k++] = nums[j++];</span><br><span class="line">                res += mid - i + <span class="number">1</span>; <span class="comment">// æ­¤æ—¶ j æ‰€æŒ‡å‘çš„æ•°ï¼Œä¸ i æŒ‡å‘åŠå…¶ä»¥åæ•°çš†æ„æˆé€†åºå¯¹</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¦‚æœ i è¿˜æœªéå†åˆ° midï¼Œåˆ™è¯´æ˜ j == right + 1, </span></span><br><span class="line">        <span class="comment">// æ­¤æ—¶è™½ç„¶ i æŒ‡å‘å…ƒç´ ä¸ååŠéƒ¨åˆ†å…ƒç´ ä¼šæ„æˆé€†åºå¯¹, ä½†æ˜¯å·²ç»åœ¨å‰é¢è®¡ç®—è¿‡äº†ï¼Œä¸ç”¨é‡å¤</span></span><br><span class="line">        <span class="keyword">while</span> (i &lt;= mid) temp[k++] = nums[i++];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¦‚æœ j è¿˜æœªéå†åˆ° midï¼Œåˆ™è¯´æ˜ i == mid + 1, æ­¤æ—¶ j æ‰€æŒ‡å‘å…ƒç´ ä¸å‰åŠéƒ¨åˆ†å…ƒç´ çš†æ„æˆé¡ºåºå¯¹</span></span><br><span class="line">        <span class="keyword">while</span> (j &lt;= right) temp[k++] = nums[j++]; </span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å½’å¹¶æ’åºå¸¸è§„æ“ä½œï¼štemp è¦†å†™ nums</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">0</span>; l &lt; k; l++) nums[l + left] = temp[l];</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong><font color="FF8888">å‚è€ƒ</font></strong> æˆ‘è‡ªå·±å†™çš„æ’åºç®—æ³•æ€»ç»“ä¸­çš„å½’å¹¶æ’åºï¼š <a href="https://czgitaccount.github.io/Data_Structure_and_Algorithm/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/">æ’åºç®—æ³• | CongZâ€™s Blog (czgitaccount.github.io)</a></p><p>ç”±äºä¸»è¦æ€æƒ³å°±æ˜¯å½’å¹¶æ’åºï¼Œæ•…æ—¶é—´å¤æ‚åº¦ä¸ç©ºé—´å¤æ‚åº¦ä¸å½’å¹¶æ’åºç›¸åŒã€‚</p><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(N\log N)$</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(N)$</p><hr><h3 id="å‚è€ƒèµ„æ–™"><a class="header-anchor" href="#å‚è€ƒèµ„æ–™">Â¶</a>å‚è€ƒèµ„æ–™</h3><blockquote><p><a href="https://leetcode-cn.com/leetbook/detail/illustration-of-algorithm/" target="_blank" rel="noopener">å›¾è§£ç®—æ³•æ•°æ®ç»“æ„ - LeetBook - åŠ›æ‰£ï¼ˆLeetCodeï¼‰å…¨çƒæå®¢æŒšçˆ±çš„æŠ€æœ¯æˆé•¿å¹³å° (leetcode-cn.com)</a></p><p><a href="https://leetcode-cn.com/" target="_blank" rel="noopener">åŠ›æ‰£ï¼ˆLeetCodeï¼‰å®˜ç½‘ - å…¨çƒæå®¢æŒšçˆ±çš„æŠ€æœ¯æˆé•¿å¹³å° (leetcode-cn.com)</a> å®˜æ–¹é¢˜è§£</p><p><a href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzUxNjY5NTYxNA==&amp;action=getalbum&amp;album_id=1607983171550167042&amp;scene=173&amp;from_msgid=2247485372&amp;from_itemidx=1&amp;count=3&amp;nolastread=1#wechat_redirect" target="_blank" rel="noopener">å›æº¯ç®—æ³•__ä»£ç éšæƒ³å½•</a></p></blockquote><!-- rebuild by neat -->]]></content>
      <categories>
        <category>Data_Structure_and_Algorithm</category>
      </categories>
      <tags>
        <tag>åˆ†æ²»ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>å‰‘æŒ‡offer -- æŸ¥æ‰¾ç®—æ³•</title>
    <url>/Data_Structure_and_Algorithm/%E5%89%91%E6%8C%87offer/%E6%9F%A5%E6%89%BE%E7%AE%97%E6%B3%95/</url>
    <content><![CDATA[<!-- build time:Tue Jun 22 2021 17:02:34 GMT+0800 (GMT+08:00) --><a id="more"></a><h2 id="å‰‘æŒ‡offer-â€“-æŸ¥æ‰¾ç®—æ³•"><a class="header-anchor" href="#å‰‘æŒ‡offer-â€“-æŸ¥æ‰¾ç®—æ³•">Â¶</a>å‰‘æŒ‡offer â€“ æŸ¥æ‰¾ç®—æ³•</h2><h3 id="å‰‘æŒ‡-Offer-03-æ•°ç»„ä¸­é‡å¤çš„æ•°å­—"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-03-æ•°ç»„ä¸­é‡å¤çš„æ•°å­—">Â¶</a><a href="https://leetcode-cn.com/problems/shu-zu-zhong-zhong-fu-de-shu-zi-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 03. æ•°ç»„ä¸­é‡å¤çš„æ•°å­—</a></h3><p>Difficulty: <strong><font color="008F00">ç®€å•</font></strong></p><p>æ‰¾å‡ºæ•°ç»„ä¸­é‡å¤çš„æ•°å­—ã€‚</p><p>åœ¨ä¸€ä¸ªé•¿åº¦ä¸º n çš„æ•°ç»„ nums é‡Œçš„æ‰€æœ‰æ•°å­—éƒ½åœ¨ 0ï½n-1 çš„èŒƒå›´å†…ã€‚æ•°ç»„ä¸­æŸäº›æ•°å­—æ˜¯é‡å¤çš„ï¼Œä½†ä¸çŸ¥é“æœ‰å‡ ä¸ªæ•°å­—é‡å¤äº†ï¼Œä¹Ÿä¸çŸ¥é“æ¯ä¸ªæ•°å­—é‡å¤äº†å‡ æ¬¡ã€‚è¯·æ‰¾å‡ºæ•°ç»„ä¸­ä»»æ„ä¸€ä¸ªé‡å¤çš„æ•°å­—ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š</span><br><span class="line">[2, 3, 1, 0, 2, 5, 3]</span><br><span class="line">è¾“å‡ºï¼š2 æˆ– 3</span><br></pre></td></tr></table></figure><p><strong>é™åˆ¶ï¼š</strong></p><p><code>2 &lt;= n &lt;= 100000</code></p><p><strong>Solution</strong></p><p><strong><font color="F08F00">æ–¹æ³•ä¸€ï¼šè®¡æ•°æ–¹æ³•</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">findRepeatNumber</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">res</span><span class="params">(nums.<span class="built_in">size</span>())</span></span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (res[nums[i]] == <span class="number">1</span>) <span class="keyword">return</span> nums[i];</span><br><span class="line">            <span class="keyword">else</span> res[nums[i]]++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œä¸€æ¬¡éå†</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œ res æ•°ç»„å ç”¨é¢å¤–ç©ºé—´</p><hr><p><strong><font color="F08F00">æ–¹æ³•äºŒï¼šåŸåœ°äº¤æ¢</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">findRepeatNumber</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">			<span class="comment">// åªè¦å½“å‰ç´¢å¼•ä½ç½®ä¸æ˜¯å¯¹åº”çš„æ•°å­—ï¼Œå°±ä¸€ç›´å¯»æ‰¾</span></span><br><span class="line">            <span class="keyword">while</span> (nums[i] != i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (nums[i] == nums[nums[i]]) <span class="keyword">return</span> nums[i];</span><br><span class="line">                swap(nums[i], nums[nums[i]]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œä¸€æ¬¡éå†</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(1)$ï¼Œ åŸåœ°æ“ä½œï¼Œæ— é¢å¤–ç©ºé—´æ¶ˆè€—ã€‚</p><hr><p><strong><font color="F08F00">æ–¹æ³•ä¸‰ï¼šæ›¿æ¢æ³•</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">findRepeatNumber</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">			<span class="keyword">int</span> index = nums[i] % n;</span><br><span class="line">            <span class="keyword">if</span> (nums[index] &gt;= n) &#123;</span><br><span class="line">                <span class="keyword">return</span> index;</span><br><span class="line">            &#125;</span><br><span class="line">            nums[index] += n;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œä¸€æ¬¡éå†</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(1)$ï¼Œ åŸåœ°æ“ä½œï¼Œæ— é¢å¤–ç©ºé—´æ¶ˆè€—ã€‚</p><p><strong><font color="FF8888">æ³¨æ„</font></strong>ï¼šæ–¹æ³•äºŒï¼Œåªèƒ½è¿”å›éšæœºä¸€ä¸ªé‡å¤å€¼ï¼ˆæ’åˆ—ä¸­æœ€é å‰çš„é‚£ä¸ªé‡å¤æ•°å­—ï¼‰ï¼Œæ–¹æ³•ä¸€ï¼Œæ–¹æ³•ä¸‰å¯ä»¥è¿”å›ç¬¬ä¸€ä¸ªï¼ˆæœ€å°ï¼‰é‡å¤å€¼ã€‚</p><hr><h3 id="å‰‘æŒ‡-Offer-04-äºŒç»´æ•°ç»„ä¸­çš„æŸ¥æ‰¾"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-04-äºŒç»´æ•°ç»„ä¸­çš„æŸ¥æ‰¾">Â¶</a><a href="https://leetcode-cn.com/problems/er-wei-shu-zu-zhong-de-cha-zhao-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 04. äºŒç»´æ•°ç»„ä¸­çš„æŸ¥æ‰¾</a></h3><p>Difficulty: <strong><font color="F08000">ä¸­ç­‰</font></strong></p><p>åœ¨ä¸€ä¸ª n * m çš„äºŒç»´æ•°ç»„ä¸­ï¼Œæ¯ä¸€è¡Œéƒ½æŒ‰ç…§ä»å·¦åˆ°å³é€’å¢çš„é¡ºåºæ’åºï¼Œæ¯ä¸€åˆ—éƒ½æŒ‰ç…§ä»ä¸Šåˆ°ä¸‹é€’å¢çš„é¡ºåºæ’åºã€‚è¯·å®Œæˆä¸€ä¸ªé«˜æ•ˆçš„å‡½æ•°ï¼Œè¾“å…¥è¿™æ ·çš„ä¸€ä¸ªäºŒç»´æ•°ç»„å’Œä¸€ä¸ªæ•´æ•°ï¼Œåˆ¤æ–­æ•°ç»„ä¸­æ˜¯å¦å«æœ‰è¯¥æ•´æ•°ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><p>ç°æœ‰çŸ©é˜µ matrix å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[</span><br><span class="line">  [1,   4,  7, 11, 15],</span><br><span class="line">  [2,   5,  8, 12, 19],</span><br><span class="line">  [3,   6,  9, 16, 22],</span><br><span class="line">  [10, 13, 14, 17, 24],</span><br><span class="line">  [18, 21, 23, 26, 30]</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>ç»™å®š target = <code>5</code>ï¼Œè¿”å› <code>true</code>ã€‚</p><p>ç»™å®š target = <code>20</code>ï¼Œè¿”å› <code>false</code>ã€‚</p><p><strong>é™åˆ¶ï¼š</strong></p><p><code>0 &lt;= n &lt;= 1000</code></p><p><code>0 &lt;= m &lt;= 1000</code></p><p><strong>Solution</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">findNumberIn2DArray</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt;&amp; matrix, <span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = matrix.<span class="built_in">size</span>();</span><br><span class="line">        <span class="comment">// åˆ¤æ–­æ˜¯å¦ä¸ºç©ºé›†åˆ</span></span><br><span class="line">        <span class="keyword">if</span> (!n) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">int</span> m = matrix[<span class="number">0</span>].<span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å…ˆä»æœ€å³ä¸Šè§’å¼€å§‹å¾€å·¦ä¸‹è§’æ‰¾</span></span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>, j = m - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (j &gt;= <span class="number">0</span> &amp;&amp; i &lt; n) &#123;</span><br><span class="line">            <span class="keyword">if</span> (target == matrix[i][j]) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="comment">// å¤§äº†åˆ™å‘å³æ‰¾</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (target &lt; matrix[i][j]) j--;</span><br><span class="line">            <span class="comment">// å°äº†åˆ™å‘å·¦æ‰¾</span></span><br><span class="line">            <span class="keyword">else</span> i++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(N + M)$ï¼Œå…¶ä¸­ï¼Œ<em>N</em> å’Œ <em>M</em> åˆ†åˆ«ä¸ºçŸ©é˜µè¡Œæ•°å’Œåˆ—æ•°ï¼Œæ­¤ç®—æ³•æœ€å¤šå¾ªç¯<em>M</em>+<em>N</em> æ¬¡ã€‚</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(1)$ï¼Œåªéœ€è¦ <em>iï¼Œ j</em> ä¸¤ä¸ªå˜é‡å³å¯ã€‚</p><hr><h3 id="å‰‘æŒ‡-Offer-11-æ—‹è½¬æ•°ç»„çš„æœ€å°æ•°å­—"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-11-æ—‹è½¬æ•°ç»„çš„æœ€å°æ•°å­—">Â¶</a><a href="https://leetcode-cn.com/problems/xuan-zhuan-shu-zu-de-zui-xiao-shu-zi-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 11. æ—‹è½¬æ•°ç»„çš„æœ€å°æ•°å­—</a></h3><p>Difficulty: <strong><font color="008F00">ç®€å•</font></strong></p><p>æŠŠä¸€ä¸ªæ•°ç»„æœ€å¼€å§‹çš„è‹¥å¹²ä¸ªå…ƒç´ æ¬åˆ°æ•°ç»„çš„æœ«å°¾ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºæ•°ç»„çš„æ—‹è½¬ã€‚è¾“å…¥ä¸€ä¸ªé€’å¢æ’åºçš„æ•°ç»„çš„ä¸€ä¸ªæ—‹è½¬ï¼Œè¾“å‡ºæ—‹è½¬æ•°ç»„çš„æœ€å°å…ƒç´ ã€‚ä¾‹å¦‚ï¼Œæ•°ç»„ <code>[3,4,5,1,2]</code> ä¸º <code>[1,2,3,4,5]</code> çš„ä¸€ä¸ªæ—‹è½¬ï¼Œè¯¥æ•°ç»„çš„æœ€å°å€¼ä¸º1ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š[3,4,5,1,2]</span><br><span class="line">è¾“å‡ºï¼š1</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š[2,2,2,0,1]</span><br><span class="line">è¾“å‡ºï¼š0</span><br></pre></td></tr></table></figure><p><strong>Solution</strong></p><p><strong><font color="F08F00">æ–¹æ³•ä¸€ï¼šæ’åº</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">minArray</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; numbers)</span> </span>&#123;</span><br><span class="line">        sort(numbers.<span class="built_in">begin</span>(), numbers.<span class="built_in">end</span>());</span><br><span class="line">        <span class="keyword">return</span> numbers.front();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ—¶é—´ç©ºé—´å¤æ‚åº¦åŸºäº<strong>æ’åº</strong>ç®—æ³•çš„æ—¶é—´ç©ºé—´å¤æ‚åº¦ã€‚</p><hr><p><strong><font color="F08F00">æ–¹æ³•äºŒï¼šä¸€æ¬¡éå†</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">minArray</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; numbers)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (numbers.empty()) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// ä¹Ÿå³æ˜¯ æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªé™åºçš„æ•°å­—</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; numbers.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (numbers[i] &lt; numbers[i - <span class="number">1</span>]) <span class="keyword">return</span> numbers[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> numbers[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼ŒNä¸ºæ•°ç»„é•¿åº¦</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(1)$ï¼Œæ— é¢å¤–ç©ºé—´æ¶ˆè€—</p><hr><p><strong><font color="F08F00">æ–¹æ³•ä¸‰ï¼šäºŒåˆ†æŸ¥æ‰¾</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">minArray</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; numbers)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = numbers.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>, j = n - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (i &lt; j) &#123;</span><br><span class="line">            <span class="keyword">int</span> m = (i + j) / <span class="number">2</span>;</span><br><span class="line">            <span class="comment">// å¦‚æœä¸­ç‚¹å…ƒç´ å¤§äºå³å€¼ åˆ™è¯´æ˜å½“å‰ç¿»è½¬ç‚¹åœ¨å³ä¾§ (m , j]</span></span><br><span class="line">            <span class="keyword">if</span> (numbers[m] &gt; numbers[j]) i = m + <span class="number">1</span>;</span><br><span class="line">            <span class="comment">// å¦‚æœä¸­ç‚¹å…ƒç´ å°äºå³å€¼ åˆ™è¯´æ˜å½“å‰ç¿»è½¬ç‚¹åœ¨å·¦ä¾§ [i , m]</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (numbers[m] &lt; numbers[j]) j = m;</span><br><span class="line">            <span class="comment">// å¦‚æœç›¸ç­‰ï¼Œåˆ™ç¼©å° å³è¾¹ç•Œ èŒƒå›´å³å¯</span></span><br><span class="line">            <span class="keyword">else</span> j--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> numbers[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(\log N)$</p><p>**ç©ºé—´å¤æ‚åº¦ï¼š**åªéœ€è¦ <em>iï¼Œjï¼Œm</em> å˜é‡å³å¯</p><hr><h3 id="å‰‘æŒ‡-Offer-50-ç¬¬ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-50-ç¬¬ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦">Â¶</a><a href="https://leetcode-cn.com/problems/di-yi-ge-zhi-chu-xian-yi-ci-de-zi-fu-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 50. ç¬¬ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦</a></h3><p>Difficulty: <strong><font color="008F00">ç®€å•</font></strong></p><p>åœ¨å­—ç¬¦ä¸² s ä¸­æ‰¾å‡ºç¬¬ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦ã€‚å¦‚æœæ²¡æœ‰ï¼Œè¿”å›ä¸€ä¸ªå•ç©ºæ ¼ã€‚ s åªåŒ…å«å°å†™å­—æ¯ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">s &#x3D; &quot;abaccdeff&quot;</span><br><span class="line">è¿”å› &quot;b&quot;</span><br><span class="line"></span><br><span class="line">s &#x3D; &quot;&quot; </span><br><span class="line">è¿”å› &quot; &quot;</span><br></pre></td></tr></table></figure><p><strong>é™åˆ¶ï¼š</strong></p><p><code>0 &lt;= s çš„é•¿åº¦ &lt;= 50000</code></p><p><strong>Solution</strong></p><p><strong><font color="F08F00">æ–¹æ³•ä¸€ï¼šå“ˆå¸Œè¡¨</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">char</span> <span class="title">firstUniqChar</span><span class="params">(<span class="built_in">string</span> s)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">unordered_map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; mp;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; a : s) &#123;</span><br><span class="line">            mp[a - <span class="string">'a'</span>]++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; a : s) &#123;</span><br><span class="line">            <span class="keyword">if</span>(mp[a - <span class="string">'a'</span>] == <span class="number">1</span>) <span class="keyword">return</span> a;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">' '</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼ŒN ä¸ºæ•°ç»„é•¿åº¦</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(1)$ï¼Œæœ€å¤š 26 ä¸ªå­—ç¬¦</p><hr><p><strong><font color="F08F00">æ–¹æ³•äºŒï¼šå“ˆå¸Œè¡¨ä¼˜åŒ–</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">char</span> <span class="title">firstUniqChar</span><span class="params">(<span class="built_in">string</span> s)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">char</span>&gt; keys;</span><br><span class="line">        <span class="built_in">unordered_map</span>&lt;<span class="keyword">char</span>, <span class="keyword">bool</span>&gt; dic;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">char</span> c : s) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœ c ä¸åœ¨ map é‡Œé¢ï¼Œå°† c push  keys ä¸­</span></span><br><span class="line">            <span class="comment">// key ä¸­åŒ…å«ç€éé‡å¤çš„æ•°ï¼Œæœ€å¤§ 26 ä¸ª</span></span><br><span class="line">            <span class="keyword">if</span>(dic.<span class="built_in">find</span>(c) == dic.<span class="built_in">end</span>())</span><br><span class="line">                keys.push_back(c);</span><br><span class="line">            <span class="comment">// å¦‚æœ map ä¸­æ²¡æœ‰ cï¼Œå°† map value ç½® true</span></span><br><span class="line">            dic[c] = dic.<span class="built_in">find</span>(c) == dic.<span class="built_in">end</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// åœ¨ keys ä¸­éå†ç¬¬ä¸€æ¬¡å‡ºç° true å³å¯</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">char</span> c : keys) &#123;</span><br><span class="line">            <span class="keyword">if</span>(dic[c]) <span class="keyword">return</span> c;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">' '</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ—¶é—´å’Œç©ºé—´å¤æ‚åº¦å‡ä¸ â€œæ–¹æ³•ä¸€â€ ç›¸åŒï¼Œè€Œå…·ä½“åˆ†æï¼šæ–¹æ³•ä¸€ éœ€éå† <code>s</code> ä¸¤è½®ï¼›æ–¹æ³•äºŒ éå† <code>s</code> ä¸€è½®ï¼Œéå† <code>keys</code> ä¸€è½®ï¼ˆ <code>dic, keys</code> çš„é•¿åº¦éƒ½ä¸å¤§äº 26 ï¼‰ã€‚ç©ºé—´ä¸Šï¼Œæ–¹æ³•äºŒå¤šäº† <code>keys</code>ï¼Œä½†æ˜¯å…¶é•¿åº¦æœ€å¤§ä¸º 26ï¼›</p><hr><h3 id="å‰‘æŒ‡-Offer-53-I-åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾æ•°å­—-I"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-53-I-åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾æ•°å­—-I">Â¶</a><a href="https://leetcode-cn.com/problems/zai-pai-xu-shu-zu-zhong-cha-zhao-shu-zi-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 53 - I. åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾æ•°å­— I</a></h3><p>Difficulty: <strong><font color="008F00">ç®€å•</font></strong></p><p>ç»Ÿè®¡ä¸€ä¸ªæ•°å­—åœ¨æ’åºæ•°ç»„ä¸­å‡ºç°çš„æ¬¡æ•°ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: nums &#x3D; [5,7,7,8,8,10], target &#x3D; 8</span><br><span class="line">è¾“å‡º: 2</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: nums &#x3D; [5,7,7,8,8,10], target &#x3D; 6</span><br><span class="line">è¾“å‡º: 0</span><br></pre></td></tr></table></figure><p><strong>é™åˆ¶ï¼š</strong></p><p><code>0 &lt;= æ•°ç»„é•¿åº¦ &lt;= 50000</code></p><p><strong>Solution</strong></p><p><strong><font color="F08F00">æ–¹æ³•ä¸€ï¼šå“ˆå¸Œè¡¨</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">search</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums, <span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; mp;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; num : nums) &#123;</span><br><span class="line">            mp[num]++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mp.<span class="built_in">find</span>(target) == mp.<span class="built_in">end</span>() ? <span class="number">-1</span> : mp[target];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œ<em>N</em> ä¸ºæ•°ç»„é•¿åº¦ï¼Œä¸€æ¬¡éå†æ„å»ºå“ˆå¸Œè¡¨ã€‚</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œå“ˆå¸Œè¡¨æ‰€å é¢å¤–ç©ºé—´ã€‚</p><hr><p><strong><font color="F08F00">æ–¹æ³•äºŒï¼šäºŒåˆ†æŸ¥æ‰¾</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">search</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums, <span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> len = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">int</span> left = <span class="number">0</span>, right = len - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">            <span class="keyword">int</span> mid = (left + right) / <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (nums[mid] &lt; target) left = mid + <span class="number">1</span>;</span><br><span class="line">            <span class="comment">// å…³é”®åœ¨äºå¦‚æœ &gt;= æƒ…å†µä¸‹éƒ½è®© right = mid</span></span><br><span class="line">            <span class="comment">// è¿™æ ·å¯ä»¥æ‰¾åˆ°æœ€å·¦è¾¹ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„ä½ç½®</span></span><br><span class="line">            <span class="keyword">else</span> right = mid;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (left &lt; len &amp;&amp; nums[left++] == target) count++;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;ï¼›</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(\log N)$ï¼Œ<em>N</em> ä¸ºæ•°ç»„é•¿åº¦ã€‚</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(1)$ï¼Œ<em>left, right, mid, count</em> å‡ ä¸ªå˜é‡æ‰€éœ€çš„é¢å¤–ç©ºé—´ã€‚</p><hr><h3 id="å‰‘æŒ‡-Offer-53-II-0ï½n-1ä¸­ç¼ºå¤±çš„æ•°å­—"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-53-II-0ï½n-1ä¸­ç¼ºå¤±çš„æ•°å­—">Â¶</a><a href="https://leetcode-cn.com/problems/que-shi-de-shu-zi-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 53 - II. 0ï½n-1ä¸­ç¼ºå¤±çš„æ•°å­—</a></h3><p>Difficulty: <strong><font color="008F00">ç®€å•</font></strong></p><p>ä¸€ä¸ªé•¿åº¦ä¸ºn-1çš„é€’å¢æ’åºæ•°ç»„ä¸­çš„æ‰€æœ‰æ•°å­—éƒ½æ˜¯å”¯ä¸€çš„ï¼Œå¹¶ä¸”æ¯ä¸ªæ•°å­—éƒ½åœ¨èŒƒå›´0ï½n-1ä¹‹å†…ã€‚åœ¨èŒƒå›´0ï½n-1å†…çš„nä¸ªæ•°å­—ä¸­æœ‰ä¸”åªæœ‰ä¸€ä¸ªæ•°å­—ä¸åœ¨è¯¥æ•°ç»„ä¸­ï¼Œè¯·æ‰¾å‡ºè¿™ä¸ªæ•°å­—ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: [0,1,3]</span><br><span class="line">è¾“å‡º: 2</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: [0,1,2,3,4,5,6,7,9]</span><br><span class="line">è¾“å‡º: 8</span><br></pre></td></tr></table></figure><p><strong>é™åˆ¶ï¼š</strong></p><p><code>1 &lt;= æ•°ç»„é•¿åº¦ &lt;= 10000</code></p><p><strong>Solution</strong></p><p><strong><font color="F08F00">æ–¹æ³•ä¸€ï¼šä¸€æ¬¡éå†</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">missingNumber</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i] != i) <span class="keyword">return</span> i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> nums.<span class="built_in">size</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œ<em>N</em> ä¸ºæ•°ç»„é•¿åº¦</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(1)$ï¼Œæ— éœ€é¢å¤–ç©ºé—´</p><hr><p><strong><font color="F08F00">æ–¹æ³•äºŒï¼šäºŒåˆ†æŸ¥æ‰¾</font></strong></p><p>**<font color="FF8888">æ³¨æ„</font>ï¼š**çœ‹ä¸ªäººå–œå¥½é€‰æ‹©è‡ªå·±æ›´å®¹æ˜“ç†è§£çš„ç‰ˆæœ¬ï¼Œæœ¬äººæ›´å€¾å‘ç‰ˆæœ¬äºŒã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">missingNumber</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = nums.<span class="built_in">size</span>();     </span><br><span class="line">        <span class="comment">// ç‰ˆæœ¬ä¸€ï¼š</span></span><br><span class="line">        <span class="comment">// å–å°äºç­‰äºç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯ ( ] right å¯ä»¥å–åˆ°ï¼Œæ‰€ä»¥ right = n - 1;</span></span><br><span class="line">        <span class="keyword">int</span> left = <span class="number">0</span>, right = n - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (left &lt;= right) &#123;</span><br><span class="line">            <span class="keyword">int</span> mid = (left + right) / <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (nums[mid] == mid) left = mid + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> right = mid - <span class="number">1</span>; <span class="comment">// right å¯ä»¥å–åˆ°ï¼Œæ‰€ä»¥ mid - 1</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> left;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">missingNumber</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="comment">// ç‰ˆæœ¬äºŒï¼š</span></span><br><span class="line">        <span class="comment">// å–å°äºç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯ ( ) right ä¸å¯ä»¥å–åˆ°ï¼Œæ‰€ä»¥ right = n;</span></span><br><span class="line">        <span class="keyword">int</span> left = <span class="number">0</span>, right = n;</span><br><span class="line">        <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">            <span class="keyword">int</span> mid = (left + right) / <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (nums[mid] == mid) left = mid + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> right = mid;  <span class="comment">// right å–ä¸åˆ° ç­‰åŒäº mid - 1</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> left;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(\log N)$ï¼Œ<em>N</em> ä¸ºæ•°ç»„é•¿åº¦ã€‚</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(1)$ï¼Œ<em>left, right, mid</em> å‡ ä¸ªå˜é‡æ‰€éœ€çš„é¢å¤–ç©ºé—´ã€‚</p><hr><h3 id="å‚è€ƒèµ„æ–™"><a class="header-anchor" href="#å‚è€ƒèµ„æ–™">Â¶</a>å‚è€ƒèµ„æ–™</h3><blockquote><p><a href="https://leetcode-cn.com/leetbook/detail/illustration-of-algorithm/" target="_blank" rel="noopener">å›¾è§£ç®—æ³•æ•°æ®ç»“æ„ - LeetBook - åŠ›æ‰£ï¼ˆLeetCodeï¼‰å…¨çƒæå®¢æŒšçˆ±çš„æŠ€æœ¯æˆé•¿å¹³å° (leetcode-cn.com)</a></p><p><a href="https://leetcode-cn.com/" target="_blank" rel="noopener">åŠ›æ‰£ï¼ˆLeetCodeï¼‰å®˜ç½‘ - å…¨çƒæå®¢æŒšçˆ±çš„æŠ€æœ¯æˆé•¿å¹³å° (leetcode-cn.com)</a> å®˜æ–¹é¢˜è§£</p></blockquote><!-- rebuild by neat -->]]></content>
      <categories>
        <category>Data_Structure_and_Algorithm</category>
      </categories>
      <tags>
        <tag>æŸ¥æ‰¾ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>å‰‘æŒ‡offer -- åŒæŒ‡é’ˆ</title>
    <url>/Data_Structure_and_Algorithm/%E5%89%91%E6%8C%87offer/%E5%8F%8C%E6%8C%87%E9%92%88/</url>
    <content><![CDATA[<!-- build time:Tue Jun 22 2021 17:02:33 GMT+0800 (GMT+08:00) --><a id="more"></a><h2 id="å‰‘æŒ‡offer-â€“-åŒæŒ‡é’ˆ"><a class="header-anchor" href="#å‰‘æŒ‡offer-â€“-åŒæŒ‡é’ˆ">Â¶</a>å‰‘æŒ‡offer â€“ åŒæŒ‡é’ˆ</h2><h3 id="å‰‘æŒ‡-Offer-18-åˆ é™¤é“¾è¡¨çš„èŠ‚ç‚¹"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-18-åˆ é™¤é“¾è¡¨çš„èŠ‚ç‚¹">Â¶</a><a href="https://leetcode-cn.com/problems/shan-chu-lian-biao-de-jie-dian-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 18. åˆ é™¤é“¾è¡¨çš„èŠ‚ç‚¹</a></h3><p>Difficulty: <strong><font color="008F00">ç®€å•</font></strong></p><p>ç»™å®šå•å‘é“¾è¡¨çš„å¤´æŒ‡é’ˆå’Œä¸€ä¸ªè¦åˆ é™¤çš„èŠ‚ç‚¹çš„å€¼ï¼Œå®šä¹‰ä¸€ä¸ªå‡½æ•°åˆ é™¤è¯¥èŠ‚ç‚¹ã€‚</p><p>è¿”å›åˆ é™¤åçš„é“¾è¡¨çš„å¤´èŠ‚ç‚¹ã€‚</p><p>**æ³¨æ„ï¼š**æ­¤é¢˜å¯¹æ¯”åŸé¢˜æœ‰æ”¹åŠ¨</p><p><strong>ç¤ºä¾‹ 1:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: head &#x3D; [4,5,1,9], val &#x3D; 5</span><br><span class="line">è¾“å‡º: [4,1,9]</span><br><span class="line">è§£é‡Š: ç»™å®šä½ é“¾è¡¨ä¸­å€¼ä¸ºÂ 5Â çš„ç¬¬äºŒä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨äº†ä½ çš„å‡½æ•°ä¹‹åï¼Œè¯¥é“¾è¡¨åº”å˜ä¸º 4 -&gt; 1 -&gt; 9.</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: head &#x3D; [4,5,1,9], val &#x3D; 1</span><br><span class="line">è¾“å‡º: [4,5,9]</span><br><span class="line">è§£é‡Š: ç»™å®šä½ é“¾è¡¨ä¸­å€¼ä¸ºÂ 1Â çš„ç¬¬ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨äº†ä½ çš„å‡½æ•°ä¹‹åï¼Œè¯¥é“¾è¡¨åº”å˜ä¸º 4 -&gt; 5 -&gt; 9.</span><br></pre></td></tr></table></figure><p><strong>è¯´æ˜ï¼š</strong></p><ul><li>é¢˜ç›®ä¿è¯é“¾è¡¨ä¸­èŠ‚ç‚¹çš„å€¼äº’ä¸ç›¸åŒ</li><li>è‹¥ä½¿ç”¨ C æˆ– C++ è¯­è¨€ï¼Œä½ ä¸éœ€è¦ <code>free</code> æˆ– <code>delete</code> è¢«åˆ é™¤çš„èŠ‚ç‚¹</li></ul><p><strong>Solution</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * struct ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode *next;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) : val(x), next(NULL) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ListNode* <span class="title">deleteNode</span><span class="params">(ListNode* head, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">        ListNode* dummy = <span class="keyword">new</span> ListNode(<span class="number">0</span>);</span><br><span class="line">        dummy-&gt;next = head;</span><br><span class="line">        <span class="comment">// å¦‚æœè¦åˆ é™¤çš„èŠ‚ç‚¹æ˜¯å¤´èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (head-&gt;val == val) <span class="keyword">return</span> head-&gt;next;</span><br><span class="line">        <span class="keyword">while</span> (head-&gt;next-&gt;val != val) &#123;</span><br><span class="line">            head = head-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        head-&gt;next = head-&gt;next-&gt;next;</span><br><span class="line">        <span class="keyword">return</span> dummy-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong> $O(N)$ ï¼Œ<em>N</em> ä¸ºé“¾è¡¨é•¿åº¦ï¼Œåˆ é™¤æ“ä½œå¹³å‡éœ€å¾ªç¯ <em>N/2</em> æ¬¡ï¼Œæœ€å·® <em>N</em> æ¬¡ã€‚<br><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong> $O(1)$ ï¼Œ <em>dummy</em> å ç”¨å¸¸æ•°å¤§å°é¢å¤–ç©ºé—´ã€‚</p><hr><h3 id="å‰‘æŒ‡-Offer-21-è°ƒæ•´æ•°ç»„é¡ºåºä½¿å¥‡æ•°ä½äºå¶æ•°å‰é¢"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-21-è°ƒæ•´æ•°ç»„é¡ºåºä½¿å¥‡æ•°ä½äºå¶æ•°å‰é¢">Â¶</a><a href="https://leetcode-cn.com/problems/diao-zheng-shu-zu-shun-xu-shi-qi-shu-wei-yu-ou-shu-qian-mian-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 21. è°ƒæ•´æ•°ç»„é¡ºåºä½¿å¥‡æ•°ä½äºå¶æ•°å‰é¢</a></h3><p>Difficulty: <strong><font color="008F00">ç®€å•</font></strong></p><p>è¾“å…¥ä¸€ä¸ªæ•´æ•°æ•°ç»„ï¼Œå®ç°ä¸€ä¸ªå‡½æ•°æ¥è°ƒæ•´è¯¥æ•°ç»„ä¸­æ•°å­—çš„é¡ºåºï¼Œä½¿å¾—æ‰€æœ‰å¥‡æ•°ä½äºæ•°ç»„çš„å‰åŠéƒ¨åˆ†ï¼Œæ‰€æœ‰å¶æ•°ä½äºæ•°ç»„çš„ååŠéƒ¨åˆ†ã€‚</p><p><strong>ç¤ºä¾‹ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums &#x3D; [1,2,3,4]</span><br><span class="line">è¾“å‡ºï¼š[1,3,2,4] </span><br><span class="line">æ³¨ï¼š[3,1,2,4] ä¹Ÿæ˜¯æ­£ç¡®çš„ç­”æ¡ˆä¹‹ä¸€ã€‚</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ol><li><code>0 &lt;= nums.length &lt;= 50000</code></li><li><code>1 &lt;= nums[i] &lt;= 10000</code></li></ol><p><strong>Solution</strong></p><p><strong><font color="F08F00">æ–¹æ³•ä¸€ï¼šéåŸåœ°</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">exchange</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">res</span><span class="params">(n)</span></span>;</span><br><span class="line">        <span class="keyword">int</span> left = <span class="number">0</span>, right = n - <span class="number">1</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœæ˜¯å¥‡æ•°å¾€å·¦ä¾§æ”¾ç½®</span></span><br><span class="line">            <span class="keyword">if</span> (nums[i] % <span class="number">2</span>) &#123;</span><br><span class="line">                res[left] = nums[i];</span><br><span class="line">                left++; <span class="comment">// æŒ‡é’ˆå³ç§»</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// å¦‚æœæ˜¯å¶æ•°å¾€å³ä¾§æ”¾ç½® </span></span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                res[right] = nums[i];</span><br><span class="line">                right--; <span class="comment">// æŒ‡é’ˆå·¦ç§»</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// å¾ªç¯é€€å‡ºæ¡ä»¶</span></span><br><span class="line">            <span class="keyword">if</span> (left &gt; right) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong> $O(N)$ ï¼Œ<em>N</em> ä¸º<em>nums</em>æ•°ç»„é•¿åº¦ã€‚<br><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong> $O(N)$ ï¼Œ <em>res</em> å ç”¨<em>nums</em>ç›¸åŒå¤§å°ç©ºé—´ã€‚</p><hr><p><strong><font color="F08F00">æ–¹æ³•äºŒï¼šåŸåœ°</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">exchange</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>, j = nums.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// è¯¥æ–¹æ³•çš„ while å¾ªç¯æ“ä½œä¸ å¿«é€Ÿæ’åºçš„ partition æ±‚å– pivot è¿‡ç¨‹ç›¸ä¼¼</span></span><br><span class="line">        <span class="keyword">while</span> (i &lt; j)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">while</span>(i &lt; j &amp;&amp; (nums[i] &amp; <span class="number">1</span>) == <span class="number">1</span>) i++;</span><br><span class="line">            <span class="keyword">while</span>(i &lt; j &amp;&amp; (nums[j] &amp; <span class="number">1</span>) == <span class="number">0</span>) j--;</span><br><span class="line">            swap(nums[i], nums[j]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> nums;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>**<font color="FF8888">å…³é”®ç®—æ³•æ€è·¯</font>**å¯ä»¥å‚è€ƒ <a href="https://czgitaccount.github.io/Data_Structure_and_Algorithm/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/">å¿«é€Ÿæ’åº</a> ç®—æ³•ä¸­ <em>partition</em> æ±‚å– <em>pivot</em> è¿‡ç¨‹ã€‚</p><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong> $O(N)$ ï¼Œ<em>N</em> ä¸º <em>nums</em> æ•°ç»„é•¿åº¦ã€‚<br><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong> $O(1)$ ï¼Œ åŸåœ°äº¤æ¢æ“ä½œï¼Œæ— é¢å¤–æ¶ˆè€—ã€‚</p><hr><h3 id="å‰‘æŒ‡-Offer-22-é“¾è¡¨ä¸­å€’æ•°ç¬¬Kä¸ªèŠ‚ç‚¹"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-22-é“¾è¡¨ä¸­å€’æ•°ç¬¬Kä¸ªèŠ‚ç‚¹">Â¶</a><a href="https://leetcode-cn.com/problems/lian-biao-zhong-dao-shu-di-kge-jie-dian-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 22. é“¾è¡¨ä¸­å€’æ•°ç¬¬Kä¸ªèŠ‚ç‚¹</a></h3><p>Difficulty: <strong><font color="008F00">ç®€å•</font></strong></p><p>è¾“å…¥ä¸€ä¸ªé“¾è¡¨ï¼Œè¾“å‡ºè¯¥é“¾è¡¨ä¸­å€’æ•°ç¬¬kä¸ªèŠ‚ç‚¹ã€‚ä¸ºäº†ç¬¦åˆå¤§å¤šæ•°äººçš„ä¹ æƒ¯ï¼Œæœ¬é¢˜ä»1å¼€å§‹è®¡æ•°ï¼Œå³é“¾è¡¨çš„å°¾èŠ‚ç‚¹æ˜¯å€’æ•°ç¬¬1ä¸ªèŠ‚ç‚¹ã€‚</p><p>ä¾‹å¦‚ï¼Œä¸€ä¸ªé“¾è¡¨æœ‰ <code>6</code> ä¸ªèŠ‚ç‚¹ï¼Œä»å¤´èŠ‚ç‚¹å¼€å§‹ï¼Œå®ƒä»¬çš„å€¼ä¾æ¬¡æ˜¯ <code>1ã€2ã€3ã€4ã€5ã€6</code>ã€‚è¿™ä¸ªé“¾è¡¨çš„å€’æ•°ç¬¬ <code>3</code> ä¸ªèŠ‚ç‚¹æ˜¯å€¼ä¸º <code>4</code> çš„èŠ‚ç‚¹ã€‚</p><p><strong>ç¤ºä¾‹ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ç»™å®šä¸€ä¸ªé“¾è¡¨: 1-&gt;2-&gt;3-&gt;4-&gt;5, å’Œ k &#x3D; 2.</span><br><span class="line"></span><br><span class="line">è¿”å›é“¾è¡¨ 4-&gt;5.</span><br></pre></td></tr></table></figure><p><strong>Solution</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * struct ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode *next;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) : val(x), next(NULL) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ListNode* <span class="title">getKthFromEnd</span><span class="params">(ListNode* head, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        ListNode* dummy = <span class="keyword">new</span> ListNode(<span class="number">0</span>);</span><br><span class="line">        dummy-&gt;next = head;</span><br><span class="line">        <span class="comment">// å…ˆè®© head å‘å‰ç§»åŠ¨ k æ­¥éª¤</span></span><br><span class="line">        <span class="keyword">while</span> (k--) &#123;</span><br><span class="line">            head = head-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ç„¶å dummy ä¸ head åŒæ—¶ç§»åŠ¨ï¼Œç›´åˆ° head åˆ°é“¾è¡¨å°¾éƒ¨ï¼Œ</span></span><br><span class="line">        <span class="comment">// æ­¤æ—¶ dummy æŒ‡å‘çš„ä½ç½®å°±æ˜¯æ‰€éœ€çš„ä½ç½®</span></span><br><span class="line">        <span class="keyword">while</span> (head) &#123;</span><br><span class="line">            dummy = dummy-&gt;next;</span><br><span class="line">            head = head-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dummy-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(N) $ ï¼Œ <em>N</em> ä¸ºé“¾è¡¨é•¿åº¦ï¼›æ€»ä½“çœ‹ï¼Œ <em>head</em> èµ°äº† <em>N</em> æ­¥ï¼Œ <em>dummy</em> èµ°äº† <em>(Nâˆ’k)</em> æ­¥ã€‚<br><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong> $O(1)$ ï¼Œ <em>dummy</em> ä½¿ç”¨å¸¸æ•°å¤§å°çš„é¢å¤–ç©ºé—´ã€‚</p><hr><h3 id="å‰‘æŒ‡-Offer-25-åˆå¹¶ä¸¤ä¸ªæ’åºçš„é“¾è¡¨"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-25-åˆå¹¶ä¸¤ä¸ªæ’åºçš„é“¾è¡¨">Â¶</a><a href="https://leetcode-cn.com/problems/he-bing-liang-ge-pai-xu-de-lian-biao-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 25. åˆå¹¶ä¸¤ä¸ªæ’åºçš„é“¾è¡¨</a></h3><p>Difficulty: <strong><font color="008F00">ç®€å•</font></strong></p><p>è¾“å…¥ä¸¤ä¸ªé€’å¢æ’åºçš„é“¾è¡¨ï¼Œåˆå¹¶è¿™ä¸¤ä¸ªé“¾è¡¨å¹¶ä½¿æ–°é“¾è¡¨ä¸­çš„èŠ‚ç‚¹ä»ç„¶æ˜¯é€’å¢æ’åºçš„ã€‚</p><p><strong>ç¤ºä¾‹1ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š1-&gt;2-&gt;4, 1-&gt;3-&gt;4</span><br><span class="line">è¾“å‡ºï¼š1-&gt;1-&gt;2-&gt;3-&gt;4-&gt;4</span><br></pre></td></tr></table></figure><p><strong>é™åˆ¶ï¼š</strong></p><p><code>0 &lt;= é“¾è¡¨é•¿åº¦ &lt;= 1000</code></p><p><strong>Solution</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * struct ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode *next;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) : val(x), next(NULL) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ListNode* <span class="title">mergeTwoLists</span><span class="params">(ListNode* l1, ListNode* l2)</span> </span>&#123;</span><br><span class="line">        ListNode* res = <span class="keyword">new</span> ListNode(<span class="number">0</span>);</span><br><span class="line">        ListNode* cur = res;</span><br><span class="line">        <span class="comment">// å¦‚æœ l1 ä¸ºç©ºèŠ‚ç‚¹ï¼Œç›´æ¥è¿”å› l2</span></span><br><span class="line">        <span class="keyword">if</span> (!l1) <span class="keyword">return</span> l2;</span><br><span class="line">        <span class="comment">// å¦‚æœ l2 ä¸ºç©ºèŠ‚ç‚¹ï¼Œç›´æ¥è¿”å› l1</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (!l2) <span class="keyword">return</span> l1;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// l1 å’Œ l2 éƒ½ä¸æ˜¯ç©ºçš„æƒ…å†µä¸‹ï¼Œåˆ¤æ–­val</span></span><br><span class="line">            <span class="keyword">while</span> (l1 &amp;&amp; l2) &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœ l2 val æ›´å°åˆ™ï¼Œå…ˆé“¾æ¥ l2</span></span><br><span class="line">                <span class="keyword">if</span> (l1-&gt;val &gt; l2-&gt;val) &#123;</span><br><span class="line">                    cur-&gt;next = l2;</span><br><span class="line">                    cur = cur-&gt;next;</span><br><span class="line">                    l2 = l2-&gt;next;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// å¦‚æœ l1 val æ›´å°åˆ™ï¼Œå…ˆé“¾æ¥ l1 </span></span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    cur-&gt;next = l1;</span><br><span class="line">                    cur = cur-&gt;next;</span><br><span class="line">                    l1 = l1-&gt;next;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// æ­¤æ—¶æœ€åæ‹¼æ¥ä¸Šå¤šä½™çš„èŠ‚ç‚¹</span></span><br><span class="line">            cur-&gt;next = (!l1 ? l2 : l1);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(M + N) $ ï¼Œ <em>M</em> ä¸º <em>l1</em> é•¿åº¦ï¼Œ <em>N</em> ä¸º <em>l2</em> é•¿åº¦<br><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong> $O(1)$ ï¼Œ <em>resï¼Œcur</em> ä½¿ç”¨å¸¸æ•°å¤§å°çš„é¢å¤–ç©ºé—´ã€‚</p><hr><h3 id="å‰‘æŒ‡-Offer-52-ä¸¤ä¸ªé“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…¬å…±èŠ‚ç‚¹"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-52-ä¸¤ä¸ªé“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…¬å…±èŠ‚ç‚¹">Â¶</a><a href="https://leetcode-cn.com/problems/liang-ge-lian-biao-de-di-yi-ge-gong-gong-jie-dian-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 52. ä¸¤ä¸ªé“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…¬å…±èŠ‚ç‚¹</a></h3><p>Difficulty: <strong><font color="008F00">ç®€å•</font></strong></p><p>è¾“å…¥ä¸¤ä¸ªé“¾è¡¨ï¼Œæ‰¾å‡ºå®ƒä»¬çš„ç¬¬ä¸€ä¸ªå…¬å…±èŠ‚ç‚¹ã€‚</p><p>å¦‚ä¸‹é¢çš„ä¸¤ä¸ªé“¾è¡¨**ï¼š**</p><img src="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2018/12/14/160_statement.png" style="zoom:67%"><p>åœ¨èŠ‚ç‚¹ c1 å¼€å§‹ç›¸äº¤ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><img src="https://assets.leetcode.com/uploads/2018/12/13/160_example_1.png" style="zoom:67%"><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šintersectVal &#x3D; 8, listA &#x3D; [4,1,8,4,5], listB &#x3D; [5,0,1,8,4,5], skipA &#x3D; 2, skipB &#x3D; 3</span><br><span class="line">è¾“å‡ºï¼šReference of the node with value &#x3D; 8</span><br><span class="line">è¾“å…¥è§£é‡Šï¼šç›¸äº¤èŠ‚ç‚¹çš„å€¼ä¸º 8 ï¼ˆæ³¨æ„ï¼Œå¦‚æœä¸¤ä¸ªåˆ—è¡¨ç›¸äº¤åˆ™ä¸èƒ½ä¸º 0ï¼‰ã€‚ä»å„è‡ªçš„è¡¨å¤´å¼€å§‹ç®—èµ·ï¼Œé“¾è¡¨ A ä¸º [4,1,8,4,5]ï¼Œé“¾è¡¨ B ä¸º [5,0,1,8,4,5]ã€‚åœ¨ A ä¸­ï¼Œç›¸äº¤èŠ‚ç‚¹å‰æœ‰ 2 ä¸ªèŠ‚ç‚¹ï¼›åœ¨ B ä¸­ï¼Œç›¸äº¤èŠ‚ç‚¹å‰æœ‰ 3 ä¸ªèŠ‚ç‚¹ã€‚</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><img src="https://assets.leetcode.com/uploads/2018/12/13/160_example_2.png" style="zoom:67%"><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šintersectVal &#x3D; 2, listA &#x3D; [0,9,1,2,4], listB &#x3D; [3,2,4], skipA &#x3D; 3, skipB &#x3D; 1</span><br><span class="line">è¾“å‡ºï¼šReference of the node with value &#x3D; 2</span><br><span class="line">è¾“å…¥è§£é‡Šï¼šç›¸äº¤èŠ‚ç‚¹çš„å€¼ä¸º 2 ï¼ˆæ³¨æ„ï¼Œå¦‚æœä¸¤ä¸ªåˆ—è¡¨ç›¸äº¤åˆ™ä¸èƒ½ä¸º 0ï¼‰ã€‚ä»å„è‡ªçš„è¡¨å¤´å¼€å§‹ç®—èµ·ï¼Œé“¾è¡¨ A ä¸º [0,9,1,2,4]ï¼Œé“¾è¡¨ B ä¸º [3,2,4]ã€‚åœ¨ A ä¸­ï¼Œç›¸äº¤èŠ‚ç‚¹å‰æœ‰ 3 ä¸ªèŠ‚ç‚¹ï¼›åœ¨ B ä¸­ï¼Œç›¸äº¤èŠ‚ç‚¹å‰æœ‰ 1 ä¸ªèŠ‚ç‚¹ã€‚</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><img src="https://assets.leetcode.com/uploads/2018/12/13/160_example_3.png" style="zoom:67%"><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šintersectVal &#x3D; 0, listA &#x3D; [2,6,4], listB &#x3D; [1,5], skipA &#x3D; 3, skipB &#x3D; 2</span><br><span class="line">è¾“å‡ºï¼šnull</span><br><span class="line">è¾“å…¥è§£é‡Šï¼šä»å„è‡ªçš„è¡¨å¤´å¼€å§‹ç®—èµ·ï¼Œé“¾è¡¨ A ä¸º [2,6,4]ï¼Œé“¾è¡¨ B ä¸º [1,5]ã€‚ç”±äºè¿™ä¸¤ä¸ªé“¾è¡¨ä¸ç›¸äº¤ï¼Œæ‰€ä»¥ intersectVal å¿…é¡»ä¸º 0ï¼Œè€Œ skipA å’Œ skipB å¯ä»¥æ˜¯ä»»æ„å€¼ã€‚</span><br><span class="line">è§£é‡Šï¼šè¿™ä¸¤ä¸ªé“¾è¡¨ä¸ç›¸äº¤ï¼Œå› æ­¤è¿”å› nullã€‚</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼š</strong></p><ul><li>å¦‚æœä¸¤ä¸ªé“¾è¡¨æ²¡æœ‰äº¤ç‚¹ï¼Œè¿”å› <code>null</code>.</li><li>åœ¨è¿”å›ç»“æœåï¼Œä¸¤ä¸ªé“¾è¡¨ä»é¡»ä¿æŒåŸæœ‰çš„ç»“æ„ã€‚</li><li>å¯å‡å®šæ•´ä¸ªé“¾è¡¨ç»“æ„ä¸­æ²¡æœ‰å¾ªç¯ã€‚</li><li>ç¨‹åºå°½é‡æ»¡è¶³ O(<em>n</em>) æ—¶é—´å¤æ‚åº¦ï¼Œä¸”ä»…ç”¨ O(<em>1</em>) å†…å­˜ã€‚</li></ul><p><strong>Solution</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ListNode *<span class="title">getIntersectionNode</span><span class="params">(ListNode *headA, ListNode *headB)</span> </span>&#123;</span><br><span class="line">    	ListNode* A = headA, *B = headB;</span><br><span class="line">        <span class="comment">// å¦‚æœæœ‰ç›¸äº¤ç‚¹ï¼Œåˆ™ä¼šåœ¨ A == B æ—¶å€™è¿”å›</span></span><br><span class="line">        <span class="comment">// å¦‚æœæ²¡æœ‰ç›¸äº¤ç‚¹ï¼Œä¹Ÿä¼š A = nullptr = B æ—¶è¿”å›</span></span><br><span class="line">        <span class="keyword">while</span> (A != B) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœ A ä¸º nullptr æ—¶ï¼Œå°† A æŒ‡å‘ headB,å¦åˆ™ A å‘åéå†</span></span><br><span class="line">            A = !A ? headB : A-&gt;next;</span><br><span class="line">            <span class="comment">// å¦‚æœ B ä¸º nullptr æ—¶ï¼Œå°† B æŒ‡å‘ headA,å¦åˆ™ B å‘åéå†</span></span><br><span class="line">            B = !B ? headA : B-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> A;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(M + N) $ ï¼Œ <em>M</em> ä¸º <em>l1</em> é•¿åº¦ï¼Œ <em>N</em> ä¸º <em>l2</em> é•¿åº¦<br><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong> $O(1)$ ï¼Œ <em>Aï¼ŒB</em> ä½¿ç”¨å¸¸æ•°å¤§å°çš„é¢å¤–ç©ºé—´ã€‚</p><hr><h3 id="å‰‘æŒ‡-Offer-57-å’Œä¸ºsçš„ä¸¤ä¸ªæ•°å­—"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-57-å’Œä¸ºsçš„ä¸¤ä¸ªæ•°å­—">Â¶</a><a href="https://leetcode-cn.com/problems/he-wei-sde-liang-ge-shu-zi-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 57. å’Œä¸ºsçš„ä¸¤ä¸ªæ•°å­—</a></h3><p>Difficulty: <strong><font color="008F00">ç®€å•</font></strong></p><p>è¾“å…¥ä¸€ä¸ªé€’å¢æ’åºçš„æ•°ç»„å’Œä¸€ä¸ªæ•°å­—sï¼Œåœ¨æ•°ç»„ä¸­æŸ¥æ‰¾ä¸¤ä¸ªæ•°ï¼Œä½¿å¾—å®ƒä»¬çš„å’Œæ­£å¥½æ˜¯sã€‚å¦‚æœæœ‰å¤šå¯¹æ•°å­—çš„å’Œç­‰äºsï¼Œåˆ™è¾“å‡ºä»»æ„ä¸€å¯¹å³å¯ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums &#x3D; [2,7,11,15], target &#x3D; 9</span><br><span class="line">è¾“å‡ºï¼š[2,7] æˆ–è€… [7,2]</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums &#x3D; [10,26,30,31,47,60], target &#x3D; 40</span><br><span class="line">è¾“å‡ºï¼š[10,30] æˆ–è€… [30,10]</span><br></pre></td></tr></table></figure><p><strong>é™åˆ¶ï¼š</strong></p><ul><li><code>1 &lt;= nums.length &lt;= 10^5</code></li><li><code>1 &lt;= nums[i] &lt;= 10^6</code></li></ul><p><strong>Solution</strong></p><p><strong><font color="F08F00">æ–¹æ³•ä¸€ï¼šå“ˆå¸Œè¡¨</font></strong>ï¼ˆåŒä¸¤æ•°ä¹‹å’Œï¼‰</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">twoSum</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums, <span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// if (nums.size() &lt;= 1) return &#123;&#125;;</span></span><br><span class="line">        <span class="built_in">unordered_set</span>&lt;<span class="keyword">int</span>&gt; <span class="built_in">set</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; num : nums) &#123;</span><br><span class="line">            <span class="keyword">int</span> toFind = target - num;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">set</span>.<span class="built_in">find</span>(toFind) != <span class="built_in">set</span>.<span class="built_in">end</span>()) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &#123;toFind, num&#125;;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">set</span>.insert(num);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(N) $ ï¼Œ<em>N</em> ä¸ºæ•°ç»„é•¿åº¦ã€‚<br><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong> $O(N)$ ï¼Œ å“ˆå¸Œè¡¨é¢å¤–ç©ºé—´ã€‚</p><hr><p><strong><font color="F08F00">æ–¹æ³•äºŒï¼šåŒæŒ‡é’ˆ</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åŒæŒ‡é’ˆ</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">twoSum</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums, <span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">int</span> left = <span class="number">0</span>, right = n - <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// ç±»åŒäºäºŒåˆ†æŸ¥æ‰¾</span></span><br><span class="line">        <span class="keyword">while</span> (left != right) &#123;</span><br><span class="line">            <span class="keyword">if</span> (target &gt; nums[left] + nums[right]) &#123;</span><br><span class="line">                left++;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (target &lt; nums[left] + nums[right]) &#123;</span><br><span class="line">                right--;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> &#123;nums[left], nums[right]&#125;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(N) $ ï¼Œ<em>N</em> ä¸ºæ•°ç»„é•¿åº¦ã€‚<br><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong> $O(1)$ ï¼Œ æ— é¢å¤–ç©ºé—´æ¶ˆè€—ã€‚</p><hr><h3 id="å‰‘æŒ‡-Offer-58-I-ç¿»è½¬å•è¯é¡ºåº"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-58-I-ç¿»è½¬å•è¯é¡ºåº">Â¶</a><a href="https://leetcode-cn.com/problems/fan-zhuan-dan-ci-shun-xu-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 58 - I. ç¿»è½¬å•è¯é¡ºåº</a></h3><p>Difficulty: <strong><font color="008F00">ç®€å•</font></strong></p><p>è¾“å…¥ä¸€ä¸ªè‹±æ–‡å¥å­ï¼Œç¿»è½¬å¥å­ä¸­å•è¯çš„é¡ºåºï¼Œä½†å•è¯å†…å­—ç¬¦çš„é¡ºåºä¸å˜ã€‚ä¸ºç®€å•èµ·è§ï¼Œæ ‡ç‚¹ç¬¦å·å’Œæ™®é€šå­—æ¯ä¸€æ ·å¤„ç†ã€‚ä¾‹å¦‚è¾“å…¥å­—ç¬¦ä¸²&quot;I am a student. â€œï¼Œåˆ™è¾“å‡º&quot;student. a am Iâ€ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: &quot;the sky is blue&quot;</span><br><span class="line">è¾“å‡º: &quot;blue is sky the&quot;</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: &quot;  hello world!  &quot;</span><br><span class="line">è¾“å‡º: &quot;world! hello&quot;</span><br><span class="line">è§£é‡Š: è¾“å…¥å­—ç¬¦ä¸²å¯ä»¥åœ¨å‰é¢æˆ–è€…åé¢åŒ…å«å¤šä½™çš„ç©ºæ ¼ï¼Œä½†æ˜¯åè½¬åçš„å­—ç¬¦ä¸èƒ½åŒ…æ‹¬ã€‚</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: &quot;a good   example&quot;</span><br><span class="line">è¾“å‡º: &quot;example good a&quot;</span><br><span class="line">è§£é‡Š: å¦‚æœä¸¤ä¸ªå•è¯é—´æœ‰å¤šä½™çš„ç©ºæ ¼ï¼Œå°†åè½¬åå•è¯é—´çš„ç©ºæ ¼å‡å°‘åˆ°åªå«ä¸€ä¸ªã€‚</span><br></pre></td></tr></table></figure><p><strong>è¯´æ˜ï¼š</strong></p><ul><li>æ— ç©ºæ ¼å­—ç¬¦æ„æˆä¸€ä¸ªå•è¯ã€‚</li><li>è¾“å…¥å­—ç¬¦ä¸²å¯ä»¥åœ¨å‰é¢æˆ–è€…åé¢åŒ…å«å¤šä½™çš„ç©ºæ ¼ï¼Œä½†æ˜¯åè½¬åçš„å­—ç¬¦ä¸èƒ½åŒ…æ‹¬ã€‚</li><li>å¦‚æœä¸¤ä¸ªå•è¯é—´æœ‰å¤šä½™çš„ç©ºæ ¼ï¼Œå°†åè½¬åå•è¯é—´çš„ç©ºæ ¼å‡å°‘åˆ°åªå«ä¸€ä¸ªã€‚</li></ul><p><strong>Solution</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">string</span> <span class="title">reverseWords</span><span class="params">(<span class="built_in">string</span> s)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// åè½¬æ•´ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line">        reverse(s.<span class="built_in">begin</span>(), s.<span class="built_in">end</span>());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> n = s.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">int</span> idx = <span class="number">0</span>;  <span class="comment">// ç”¨æ¥æŒ‡ç¤ºå•è¯ä½ç½®</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> start = <span class="number">0</span>; start &lt; n; ++start) &#123;</span><br><span class="line">            <span class="comment">// åˆ é™¤å­—ç¬¦ä¸²å‰éƒ¨åˆ†çš„ç©ºæ ¼</span></span><br><span class="line">            <span class="keyword">if</span> (s[start] != <span class="string">' '</span>) &#123;</span><br><span class="line">                <span class="comment">// å¡«ä¸€ä¸ªç©ºç™½å­—ç¬¦ç„¶åå°†idxç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå•è¯çš„å¼€å¤´ä½ç½®</span></span><br><span class="line">                <span class="keyword">if</span> (idx != <span class="number">0</span>) s[idx++] = <span class="string">' '</span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// å¾ªç¯éå†è‡³å•è¯çš„æœ«å°¾</span></span><br><span class="line">                <span class="keyword">int</span> <span class="built_in">end</span> = start;	<span class="comment">// idx ä» 0 å¼€å§‹è®¡æ•°ï¼Œ end ä» start å¼€å§‹è®¡æ•°</span></span><br><span class="line">                <span class="keyword">while</span> (<span class="built_in">end</span> &lt; n &amp;&amp; s[<span class="built_in">end</span>] != <span class="string">' '</span>) s[idx++] = s[<span class="built_in">end</span>++];</span><br><span class="line"></span><br><span class="line">                <span class="comment">// åè½¬æ•´ä¸ªå•è¯</span></span><br><span class="line">                reverse(s.<span class="built_in">begin</span>() + idx - (<span class="built_in">end</span> - start), s.<span class="built_in">begin</span>() + idx);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// æ›´æ–°startï¼Œå»æ‰¾ä¸‹ä¸€ä¸ªå•è¯</span></span><br><span class="line">                start = <span class="built_in">end</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// åˆ é™¤æœ€åçš„è¿ç»­ç©ºæ ¼</span></span><br><span class="line">        s.erase(s.<span class="built_in">begin</span>() + idx, s.<span class="built_in">end</span>());</span><br><span class="line">        <span class="keyword">return</span> s;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong> $O(N)$ï¼Œ<em>N</em> ä¸ºå­—ç¬¦ä¸²é•¿åº¦</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong> $O(1)$ï¼Œ<em>idxï¼Œstart, end</em> ä½¿ç”¨å¸¸æ•°å¤§å°çš„é¢å¤–ç©ºé—´ã€‚</p><hr><h3 id="å‚è€ƒèµ„æ–™"><a class="header-anchor" href="#å‚è€ƒèµ„æ–™">Â¶</a>å‚è€ƒèµ„æ–™</h3><blockquote><p><a href="https://leetcode-cn.com/leetbook/detail/illustration-of-algorithm/" target="_blank" rel="noopener">å›¾è§£ç®—æ³•æ•°æ®ç»“æ„ - LeetBook - åŠ›æ‰£ï¼ˆLeetCodeï¼‰å…¨çƒæå®¢æŒšçˆ±çš„æŠ€æœ¯æˆé•¿å¹³å° (leetcode-cn.com)</a></p><p><a href="https://leetcode-cn.com/" target="_blank" rel="noopener">åŠ›æ‰£ï¼ˆLeetCodeï¼‰å®˜ç½‘ - å…¨çƒæå®¢æŒšçˆ±çš„æŠ€æœ¯æˆé•¿å¹³å° (leetcode-cn.com)</a> å®˜æ–¹é¢˜è§£</p></blockquote><!-- rebuild by neat -->]]></content>
      <categories>
        <category>Data_Structure_and_Algorithm</category>
      </categories>
      <tags>
        <tag>åŒæŒ‡é’ˆ</tag>
      </tags>
  </entry>
  <entry>
    <title>æ’åºç®—æ³•</title>
    <url>/Data_Structure_and_Algorithm/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/</url>
    <content><![CDATA[<!-- build time:Tue Jun 22 2021 17:02:33 GMT+0800 (GMT+08:00) --><a id="more"></a><h2 id="æ’åºç®—æ³•"><a class="header-anchor" href="#æ’åºç®—æ³•">Â¶</a>æ’åºç®—æ³•</h2><h3 id="1-å†’æ³¡æ’åº"><a class="header-anchor" href="#1-å†’æ³¡æ’åº">Â¶</a>1. å†’æ³¡æ’åº</h3><p>æ¯”è¾ƒç›¸é‚»å…ƒç´ ï¼Œç¬¬ä¸€ä¸ªæ¯”ç¬¬äºŒä¸ªå¤§ï¼Œå°±äº¤æ¢</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bubble_sort</span><span class="params">(<span class="built_in">vector</span>&lt;T&gt;&amp; vec)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n = vec.<span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n - <span class="number">1</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n - <span class="number">1</span> - i; j++) &#123;</span><br><span class="line">        	<span class="keyword">if</span> (vec[j] &gt; vec[j + <span class="number">1</span>]) &#123;</span><br><span class="line">        		swap(vec[j], vec[j + <span class="number">1</span>]);</span><br><span class="line">        	&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; vec&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">6</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">2</span>&#125;;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; v : vec) <span class="built_in">cout</span> &lt;&lt; v &lt;&lt; <span class="string">" "</span>;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	bubble_sort(vec);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; v : vec) <span class="built_in">cout</span> &lt;&lt; v &lt;&lt; <span class="string">" "</span>;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ Linux ä¸‹ç¼–è¯‘çš„æ—¶å€™éœ€è¦æ·»åŠ ç¼–è¯‘é€‰é¡¹ <strong><code>-std=c++11</code></strong></p><p><img src="/Data_Structure_and_Algorithm/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/%E5%86%92%E6%B3%A1%E6%8E%92%E5%BA%8F.png" alt></p><p>æœ€ä¼˜çš„æƒ…å†µä¸‹ä¹Ÿå°±æ˜¯è¾“å…¥æœ‰åºï¼š$O(n)$</p><p>æœ€å·®çš„æƒ…å†µä¸‹ä¹Ÿå°±æ˜¯è¾“å…¥é€†åºï¼š$O(n^2)$</p><p>æ— é¢å¤–<strong>ç©ºé—´</strong>éœ€æ±‚ï¼š$O(1)$</p><p><strong>ç¨³å®š</strong></p><h3 id="2-é€‰æ‹©æ’åº"><a class="header-anchor" href="#2-é€‰æ‹©æ’åº">Â¶</a>2. é€‰æ‹©æ’åº</h3><p>é¦–å…ˆåœ¨æœªæ’åºçš„é˜Ÿåˆ—ä¸­æ‰¾åˆ°æœ€å°çš„å…ƒç´ ï¼Œå­˜æ”¾åœ¨æ’åºåºåˆ—çš„èµ·å§‹ä½ç½®ï¼Œä¹‹åæ‰¾ç¬¬äºŒå°çš„ï¼Œä»¥æ­¤ç±»æ¨</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">selectionSort</span><span class="params">(<span class="built_in">vector</span>&lt;T&gt;&amp; vec)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> n = vec.<span class="built_in">size</span>();</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n - <span class="number">1</span>; i++) &#123;</span><br><span class="line">		<span class="keyword">int</span> minIdx = i;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span>; j &lt; n; j++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (vec[j] &lt; vec[minIdx]) &#123;</span><br><span class="line">				minIdx = j;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		swap(vec[minIdx], vec[i]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; vec&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">1</span>,<span class="number">9</span>&#125;;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; v : vec) <span class="built_in">cout</span> &lt;&lt; v &lt;&lt; <span class="string">" "</span>;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	selectionSort(vec);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; v : vec) <span class="built_in">cout</span> &lt;&lt; v &lt;&lt; <span class="string">" "</span>;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/Data_Structure_and_Algorithm/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/%E9%80%89%E6%8B%A9%E6%8E%92%E5%BA%8F.png" alt></p><p>æ¯æ¬¡æ“ä½œ $n - 1 + n - 2 + â€¦ + 1 = ((1 + n - 1) * n - 1) / 2$</p><p><strong>æ—¶é—´</strong>å¤æ‚åº¦ï¼š$O(n^2)$</p><p><strong>ç©ºé—´</strong>å¤æ‚åº¦ï¼š$O (1)$</p><p><strong>ä¸ç¨³å®š</strong>ï¼šä¾‹å­: $80_1, 80_2, 70 --&gt; 70, 80_2, 80_1$</p><h3 id="3-æ’å…¥æ’åº"><a class="header-anchor" href="#3-æ’å…¥æ’åº">Â¶</a>3. æ’å…¥æ’åº</h3><p>ç®—æ³•æè¿°ï¼šæ–—åœ°ä¸»æ‘¸ç‰Œæ’å…¥æ‰‹ç‰Œ</p><p>å°†ç¬¬ä¸€å¾…æ’åºåºåˆ—ç¬¬ä¸€ä¸ªå…ƒç´ çœ‹åšä¸€ä¸ªæœ‰åºåºåˆ—ï¼ŒæŠŠç¬¬äºŒä¸ªå…ƒç´ åˆ°æœ€åä¸€ä¸ªå…ƒç´ å½“æˆæ˜¯æœªæ’åºåºåˆ—ã€‚</p><p>ä»å¤´åˆ°å°¾ä¾æ¬¡æ‰«ææœªæ’åºåºåˆ—ï¼Œå°†æ‰«æåˆ°çš„æ¯ä¸ªå…ƒç´ æ’å…¥æœ‰åºåºåˆ—çš„é€‚å½“ä½ç½®ã€‚ï¼ˆå¦‚æœå¾…æ’å…¥çš„å…ƒç´ ä¸æœ‰åºåºåˆ—ä¸­çš„æŸä¸ªå…ƒç´ ç›¸ç­‰ï¼Œåˆ™å°†å¾…æ’å…¥å…ƒç´ æ’å…¥åˆ°ç›¸ç­‰å…ƒç´ çš„åé¢ã€‚ï¼‰</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insertSort</span><span class="params">(<span class="built_in">vector</span>&lt;T&gt;&amp; vec)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> n = vec.<span class="built_in">size</span>();</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">		T key = vec[i];</span><br><span class="line">		<span class="keyword">int</span> j = i;</span><br><span class="line">		<span class="keyword">while</span> (j &gt; <span class="number">0</span> &amp;&amp; vec[j - <span class="number">1</span>] &gt; key) &#123;</span><br><span class="line">			vec[j] = vec[j - <span class="number">1</span>];</span><br><span class="line">			j--;</span><br><span class="line">		&#125;</span><br><span class="line">		vec[j] = key;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; vec&#123;<span class="number">1</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">2</span>,<span class="number">10</span>,<span class="number">8</span>,<span class="number">1</span>,<span class="number">6</span>,<span class="number">2</span>,<span class="number">7</span>&#125;;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; v : vec) <span class="built_in">cout</span> &lt;&lt; v &lt;&lt; <span class="string">' '</span>;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	insertSort(vec);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; v : vec) <span class="built_in">cout</span> &lt;&lt; v &lt;&lt; <span class="string">' '</span>;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/Data_Structure_and_Algorithm/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/%E6%8F%92%E5%85%A5%E6%8E%92%E5%BA%8F.png" alt></p><p>æœ€ä¼˜çš„æƒ…å†µä¸‹ä¹Ÿå°±æ˜¯è¾“å…¥æœ‰åºï¼š$O(n)$</p><p>æœ€å·®çš„æƒ…å†µä¸‹ä¹Ÿå°±æ˜¯è¾“å…¥é€†åºï¼š$O(n^2)$</p><p>æ— é¢å¤–<strong>ç©ºé—´</strong>éœ€æ±‚ï¼š$O(1)$</p><p><strong>ç¨³å®š</strong></p><h3 id="4-å¸Œå°”æ’åº"><a class="header-anchor" href="#4-å¸Œå°”æ’åº">Â¶</a>4. å¸Œå°”æ’åº</h3><p>å¸Œå°”æ’åºï¼Œä¹Ÿç§°é€’å‡å¢é‡æ’åºç®—æ³•ï¼Œæ˜¯æ’å…¥æ’åºçš„ä¸€ç§æ›´é«˜æ•ˆçš„æ”¹è¿›ç‰ˆæœ¬ã€‚ä½†å¸Œå°”æ’åºæ˜¯éç¨³å®šæ’åºç®—æ³•ã€‚</p><p>å¸Œå°”æ’åºæ˜¯åŸºäºæ’å…¥æ’åºçš„ä»¥ä¸‹ä¸¤ç‚¹æ€§è´¨è€Œæå‡ºæ”¹è¿›æ–¹æ³•çš„ï¼š</p><ul><li>æ’å…¥æ’åºåœ¨å¯¹å‡ ä¹å·²ç»æ’å¥½åºçš„æ•°æ®æ“ä½œæ—¶ï¼Œæ•ˆç‡é«˜ï¼Œå³å¯ä»¥è¾¾åˆ°çº¿æ€§æ’åºçš„æ•ˆç‡ï¼›</li><li>ä½†æ’å…¥æ’åºä¸€èˆ¬æ¥è¯´æ˜¯ä½æ•ˆçš„ï¼Œå› ä¸ºæ’å…¥æ’åºæ¯æ¬¡åªèƒ½å°†æ•°æ®ç§»åŠ¨ä¸€ä½ï¼›</li></ul><p>å¸Œå°”æ’åºçš„åŸºæœ¬æ€æƒ³æ˜¯ï¼šå…ˆå°†æ•´ä¸ªå¾…æ’åºçš„è®°å½•åºåˆ—åˆ†å‰²æˆä¸ºè‹¥å¹²å­åºåˆ—åˆ†åˆ«è¿›è¡Œç›´æ¥æ’å…¥æ’åºï¼Œå¾…æ•´ä¸ªåºåˆ—ä¸­çš„è®°å½•&quot;åŸºæœ¬æœ‰åº&quot;æ—¶ï¼Œå†å¯¹å…¨ä½“è®°å½•è¿›è¡Œä¾æ¬¡ç›´æ¥æ’å…¥æ’åºã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">shellSort</span><span class="params">(<span class="built_in">vector</span>&lt;T&gt;&amp; vec)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n = vec.<span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> <span class="built_in">step</span> = n / <span class="number">2</span>; <span class="built_in">step</span> &gt; <span class="number">0</span>; <span class="built_in">step</span> /= <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="built_in">step</span>; i &lt; n; i++) &#123;</span><br><span class="line">            T key = vec[i];</span><br><span class="line">            <span class="keyword">int</span> j = i;</span><br><span class="line">            <span class="keyword">while</span> (j &gt;= <span class="built_in">step</span> &amp;&amp; vec[j - <span class="built_in">step</span>] &gt; key) &#123;</span><br><span class="line">                vec[j] = vec[j - <span class="built_in">step</span>];</span><br><span class="line">                j -= <span class="built_in">step</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            vec[j] = key;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; vec&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">9</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; v : vec) <span class="built_in">cout</span> &lt;&lt; v &lt;&lt; <span class="string">' '</span>;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	shellSort(vec);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; v : vec) <span class="built_in">cout</span> &lt;&lt; v &lt;&lt; <span class="string">' '</span>;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="/Data_Structure_and_Algorithm/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/å¸Œå°”æ’åº.png" style="zoom:80%"><p><strong>æ—¶é—´</strong>å¤æ‚åº¦ï¼š$O(nlog_2n)$ï¼Œçœ‹ step</p><p><strong>ç©ºé—´</strong>å¤æ‚åº¦ï¼š$O(1)$</p><p><strong>ä¸ç¨³å®š</strong>ï¼šä¾‹å­ï¼š $80_1, 80_2, 80_3, 70 --&gt; 70, 80_1, 80_3, 80_2$</p><h3 id="5-å½’å¹¶æ’åº"><a class="header-anchor" href="#5-å½’å¹¶æ’åº">Â¶</a>5. å½’å¹¶æ’åº</h3><ol><li>ç”³è¯·ç©ºé—´ï¼Œä½¿å…¶å¤§å°ä¸ºä¸¤ä¸ªå·²ç»æ’åºåºåˆ—ä¹‹å’Œï¼Œè¯¥ç©ºé—´ç”¨æ¥å­˜æ”¾åˆå¹¶åçš„åºåˆ—ï¼›</li><li>è®¾å®šä¸¤ä¸ªæŒ‡é’ˆï¼Œæœ€åˆä½ç½®åˆ†åˆ«ä¸ºä¸¤ä¸ªå·²ç»æ’åºåºåˆ—çš„èµ·å§‹ä½ç½®ï¼›</li><li>æ¯”è¾ƒä¸¤ä¸ªæŒ‡é’ˆæ‰€æŒ‡å‘çš„å…ƒç´ ï¼Œé€‰æ‹©ç›¸å¯¹å°çš„å…ƒç´ æ”¾å…¥åˆ°åˆå¹¶ç©ºé—´ï¼Œå¹¶ç§»åŠ¨æŒ‡é’ˆåˆ°ä¸‹ä¸€ä½ç½®ï¼›</li><li>é‡å¤æ­¥éª¤ 3 ç›´åˆ°æŸä¸€æŒ‡é’ˆè¾¾åˆ°åºåˆ—å°¾ï¼›</li><li>å°†å¦ä¸€åºåˆ—å‰©ä¸‹çš„æ‰€æœ‰å…ƒç´ ç›´æ¥å¤åˆ¶åˆ°åˆå¹¶åºåˆ—å°¾ã€‚</li></ol><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="comment">// å£°æ˜</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mergeSortRecur</span><span class="params">(<span class="built_in">vector</span>&lt;T&gt;&amp; vec, <span class="built_in">vector</span>&lt;T&gt;&amp; temp, <span class="keyword">int</span> left, <span class="keyword">int</span> right)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mergeSort</span><span class="params">(<span class="built_in">vector</span>&lt;T&gt;&amp; vec)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n = vec.<span class="built_in">size</span>();</span><br><span class="line">    <span class="built_in">vector</span>&lt;T&gt;temp(n);</span><br><span class="line">    mergeSortRecur(vec, temp, <span class="number">0</span>, n - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mergeSortRecur</span><span class="params">(<span class="built_in">vector</span>&lt;T&gt;&amp; vec, <span class="built_in">vector</span>&lt;T&gt;&amp; temp, <span class="keyword">int</span> left, <span class="keyword">int</span> right)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (left &lt; right) &#123;</span><br><span class="line">        <span class="keyword">int</span> mid = left + (right - left) / <span class="number">2</span>;</span><br><span class="line">        mergeSortRecur(vec, temp, left, mid);</span><br><span class="line">        mergeSortRecur(vec, temp, mid + <span class="number">1</span>, right);</span><br><span class="line">        <span class="keyword">int</span> i = left;</span><br><span class="line">        <span class="keyword">int</span> j = mid + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> k = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (i &lt;= mid &amp;&amp; j &lt;= right) &#123;</span><br><span class="line">            temp[k++] = vec[i] &lt;= vec[j] ? vec[i++] : vec[j++];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (i &lt;= mid) temp[k++] = vec[i++];</span><br><span class="line">        <span class="keyword">while</span> (j &lt;= right) temp[k++] = vec[j++];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">0</span>; l &lt; k; l++) vec[left + l] = temp[l];  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; vec&#123;<span class="number">1</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">8</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">6</span>&#125;;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; v : vec) <span class="built_in">cout</span> &lt;&lt; v &lt;&lt; <span class="string">' '</span>;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	mergeSort(vec);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; v : vec) <span class="built_in">cout</span> &lt;&lt; v &lt;&lt; <span class="string">' '</span>;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="/Data_Structure_and_Algorithm/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/å½’å¹¶æ’åº.png" style="zoom:80%"><p><strong>æ—¶é—´</strong>å¤æ‚åº¦ï¼šæœ€å¥½ï¼Œæœ€åï¼Œå¹³å‡ï¼š$O(nlog_2n)$</p><p><strong>ç©ºé—´</strong>å¤æ‚åº¦ï¼š$O(n)$</p><p><strong>ç¨³å®š</strong></p><h3 id="6-å¿«é€Ÿæ’åº"><a class="header-anchor" href="#6-å¿«é€Ÿæ’åº">Â¶</a>6. å¿«é€Ÿæ’åº</h3><ol><li>ä»æ•°åˆ—ä¸­æŒ‘å‡ºä¸€ä¸ªå…ƒç´ ï¼Œç§°ä¸º â€œåŸºå‡†â€ï¼ˆpivotï¼‰;</li><li>é‡æ–°æ’åºæ•°åˆ—ï¼Œæ‰€æœ‰å…ƒç´ æ¯”åŸºå‡†å€¼å°çš„æ‘†æ”¾åœ¨åŸºå‡†å‰é¢ï¼Œæ‰€æœ‰å…ƒç´ æ¯”åŸºå‡†å€¼å¤§çš„æ‘†åœ¨åŸºå‡†çš„åé¢ï¼ˆç›¸åŒçš„æ•°å¯ä»¥åˆ°ä»»ä¸€è¾¹ï¼‰ã€‚åœ¨è¿™ä¸ªåˆ†åŒºé€€å‡ºä¹‹åï¼Œè¯¥åŸºå‡†å°±å¤„äºæ•°åˆ—çš„ä¸­é—´ä½ç½®ã€‚è¿™ä¸ªç§°ä¸ºåˆ†åŒºï¼ˆpartitionï¼‰æ“ä½œï¼›</li><li>é€’å½’åœ°ï¼ˆrecursiveï¼‰æŠŠå°äºåŸºå‡†å€¼å…ƒç´ çš„å­æ•°åˆ—å’Œå¤§äºåŸºå‡†å€¼å…ƒç´ çš„å­æ•°åˆ—æ’åºï¼›</li></ol><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">partition</span><span class="params">(<span class="built_in">vector</span>&lt;T&gt;&amp; vec, <span class="keyword">int</span> left, <span class="keyword">int</span> right)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">quickSort</span><span class="params">(<span class="built_in">vector</span>&lt;T&gt;&amp; vec, <span class="keyword">int</span> left, <span class="keyword">int</span> right)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (left &gt;= right) <span class="keyword">return</span>;</span><br><span class="line">	<span class="keyword">int</span> pivot = partition(vec, left, right);</span><br><span class="line">	quickSort(vec, left, pivot - <span class="number">1</span>);</span><br><span class="line">	quickSort(vec, pivot + <span class="number">1</span>, right);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">partition</span><span class="params">(<span class="built_in">vector</span>&lt;T&gt;&amp; vec, <span class="keyword">int</span> left, <span class="keyword">int</span> right)</span> </span>&#123;</span><br><span class="line">	<span class="comment">// åŸºå‡†ä¸ºæœ€å·¦ä¾§å€¼</span></span><br><span class="line">	T pivot = vec[left];</span><br><span class="line">	<span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">		<span class="keyword">while</span> (left &lt; right &amp;&amp; vec[right] &gt;= pivot) --right;</span><br><span class="line">		vec[left] = vec[right];</span><br><span class="line">		<span class="keyword">while</span> (left &lt; right &amp;&amp; vec[left] &lt;= pivot) ++left;</span><br><span class="line">		vec[right] = vec[left];</span><br><span class="line">	&#125;</span><br><span class="line">	vec[left] = pivot;</span><br><span class="line">	<span class="keyword">return</span> left;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; vec&#123;<span class="number">1</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">8</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">6</span>&#125;;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; v : vec) <span class="built_in">cout</span> &lt;&lt; v &lt;&lt; <span class="string">' '</span>;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">int</span> right = vec.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">	quickSort(vec, <span class="number">0</span>, right);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; v : vec) <span class="built_in">cout</span> &lt;&lt; v &lt;&lt; <span class="string">' '</span>;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="/Data_Structure_and_Algorithm/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/å¿«é€Ÿæ’åº.png" style="zoom:80%"><p><strong>æ—¶é—´</strong>å¤æ‚åº¦ï¼š<strong>æœ€å</strong>æƒ…å†µï¼šï¼Œæœ‰åºæƒ…å†µï¼Œ$O(n^2)$ï¼›<strong>å¹³æ‘Š</strong>æœŸæœ›æ—¶é—´ï¼š$O(nlog_2n)$ ä¸”éšå«çš„å¸¸æ•°å› å­å¾ˆå°ï¼Œå¯¹äºç»å¤§å¤šæ•°é¡ºåºæ€§è¾ƒå¼±çš„éšæœºåºåˆ—ï¼Œä¼˜äºå½’å¹¶æ’åºã€‚</p><p><strong>ç©ºé—´</strong>å¤æ‚åº¦ï¼šæ¯æ¬¡é€’å½’ä¼ å‚ <code>left</code>ï¼Œå’Œ <code>right</code>ï¼Œå¹³å‡é€’å½’æ¬¡æ•°æ˜¯ $o(log_2n)$ æ¬¡ï¼Œæ‰€ä»¥<strong>å¹³å‡</strong>ç©ºé—´å¤æ‚åº¦æ˜¯$o(log_2n)$ ,é€’å½’æ ˆçš„æ·±åº¦ã€‚<strong>æœ€å</strong>çš„æƒ…å†µæ˜¯$o(n)$ ï¼ˆåˆå§‹æ˜¯é€†åºçš„æƒ…å†µï¼‰</p><p><strong>ä¸ç¨³å®š</strong>ï¼šä¾‹å­ $80_1, 80_2, 80_3, 70 â€“ &gt; 70, 80_2, 80_3, 80_1$ (åŸºå‡†æœ€å·¦è¾¹)</p><p><strong>å¿«é€Ÿæ’åºçš„ä¼˜åŒ–</strong>ï¼š</p><blockquote><p><a href="https://blog.csdn.net/qq_19525389/article/details/81436838" target="_blank" rel="noopener">å¿«é€Ÿæ’åºçš„5ç§ä¼˜åŒ–æ–¹æ³•</a></p></blockquote><h3 id="7-å †æ’åº"><a class="header-anchor" href="#7-å †æ’åº">Â¶</a>7. å †æ’åº</h3><p>å †æ’åºæ˜¯æŒ‡åˆ©ç”¨å †è¿™ç§æ•°æ®ç»“æ„æ‰€è®¾è®¡çš„ä¸€ç§æ’åºç®—æ³•ã€‚å †ç§¯æ˜¯ä¸€ä¸ªè¿‘ä¼¼å®Œå…¨äºŒå‰æ ‘çš„ç»“æ„ï¼Œå¹¶åŒæ—¶æ»¡è¶³å †ç§¯çš„æ€§è´¨ï¼šå³å­ç»“ç‚¹çš„é”®å€¼æˆ–ç´¢å¼•æ€»æ˜¯å°äºï¼ˆæˆ–è€…å¤§äºï¼‰å®ƒçš„çˆ¶èŠ‚ç‚¹ã€‚å †æ’åºå¯ä»¥è¯´æ˜¯ä¸€ç§åˆ©ç”¨å †çš„æ¦‚å¿µæ¥æ’åºçš„é€‰æ‹©æ’åºã€‚åˆ†ä¸ºä¸¤ç§æ–¹æ³•ï¼š</p><ol><li>å¤§é¡¶å †ï¼šæ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å¤§äºæˆ–ç­‰äºå…¶å­èŠ‚ç‚¹çš„å€¼ï¼Œåœ¨å †æ’åºç®—æ³•ä¸­ç”¨äºå‡åºæ’åˆ—ï¼›</li><li>å°é¡¶å †ï¼šæ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å°äºæˆ–ç­‰äºå…¶å­èŠ‚ç‚¹çš„å€¼ï¼Œåœ¨å †æ’åºç®—æ³•ä¸­ç”¨äºé™åºæ’åˆ—ï¼›</li></ol><p>å †æ’åºçš„å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º $O(nlog_2n)$ã€‚</p><p><strong>ç®—æ³•æ­¥éª¤ï¼š</strong></p><ol><li>åˆ›å»ºä¸€ä¸ªå † $H[0â€¦â€¦n-1]$ï¼›</li><li>æŠŠå †é¦–ï¼ˆæœ€å¤§å€¼ï¼‰å’Œå †å°¾äº’æ¢ï¼›</li><li>æŠŠå †çš„å°ºå¯¸ç¼©å° 1ï¼Œå¹¶è°ƒç”¨ <strong><code>shift_down(0)â€‹</code></strong> ï¼Œç›®çš„æ˜¯æŠŠæ–°çš„æ•°ç»„é¡¶ç«¯æ•°æ®è°ƒæ•´åˆ°ç›¸åº”ä½ç½®ï¼›</li><li>é‡å¤æ­¥éª¤ 2ï¼Œç›´åˆ°å †çš„å°ºå¯¸ä¸º 1</li></ol><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">max_heap</span><span class="params">(<span class="built_in">vector</span>&lt;T&gt;&amp; vec, <span class="keyword">int</span> start, <span class="keyword">int</span> <span class="built_in">end</span>)</span> </span>&#123;</span><br><span class="line">	<span class="comment">// è®°å½•çˆ¶èŠ‚ç‚¹ç´¢å¼•</span></span><br><span class="line">	<span class="keyword">int</span> parent = start;</span><br><span class="line">	<span class="comment">// è®°å½•å­èŠ‚ç‚¹ç´¢å¼•å¼€å§‹ä½ç½®</span></span><br><span class="line">	<span class="keyword">int</span> son = <span class="number">2</span> * parent + <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">while</span> (son &lt;= <span class="built_in">end</span>) &#123;</span><br><span class="line">		<span class="comment">// é€‰æ‹©ä¸¤ä¸ªå­©å­èŠ‚ç‚¹ä¸­ï¼Œæœ€å¤§çš„ä¸€ä¸ªå­©å­ï¼Œè®°å½•å…¶ç´¢å¼•</span></span><br><span class="line">		<span class="keyword">if</span> (son + <span class="number">1</span> &lt;= <span class="built_in">end</span> &amp;&amp; vec[son] &lt; vec[son + <span class="number">1</span>]) &#123;</span><br><span class="line">			son++;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (vec[parent] &gt;= vec[son]) &#123;</span><br><span class="line">			<span class="comment">// å¦‚æœçˆ¶èŠ‚ç‚¹å·²ç»å¤§äºæ‰€æœ‰å­èŠ‚ç‚¹äº†ï¼Œåˆ™ç›´æ¥è¿”å›</span></span><br><span class="line">			<span class="keyword">return</span> ;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">// å¦åˆ™äº¤æ¢çˆ¶å­èŠ‚ç‚¹</span></span><br><span class="line">			swap(vec[parent], vec[son]);</span><br><span class="line">			<span class="comment">// çˆ¶äº²ç´¢å¼•æ”¹ä¸ºå…¶å­èŠ‚ç‚¹ç´¢å¼•</span></span><br><span class="line">			parent = son;</span><br><span class="line">			<span class="comment">// å…¶å­èŠ‚ç‚¹ç´¢å¼•åœ¨æŒ‡å‘å­™èŠ‚ç‚¹ç»§ç»­ç›¸åŒçš„æ¯”è¾ƒ</span></span><br><span class="line">			son = parent * <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">heapSort</span><span class="params">(<span class="built_in">vector</span>&lt;T&gt;&amp; vec)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> len = vec.<span class="built_in">size</span>();</span><br><span class="line">	<span class="comment">// åˆå§‹åŒ–è°ƒæ•´ï¼šä»æœ€åä¸€ä¸ªçˆ¶èŠ‚ç‚¹æ‰¾èµ·</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = len / <span class="number">2</span> - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">		max_heap(vec, i, len - <span class="number">1</span>);</span><br><span class="line">	&#125;<span class="comment">// è·å¾—æœ€å¤§å †</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// å…ˆå°†ç¬¬ä¸€ä¸ªå…ƒç´ å’Œå·²ç»æ’å¥½çš„å…ƒç´ å‰ä¸€ä½åšäº¤æ¢ï¼Œ</span></span><br><span class="line">	<span class="comment">// å†é‡æ–°è°ƒæ•´(åˆšè°ƒæ•´çš„å…ƒç´ ä¹‹å‰çš„å…ƒç´ )ï¼ŒçŸ¥é“æ’åºå®Œæ¯•</span></span><br><span class="line">	<span class="comment">// æ³¨ï¼švec[0] ä¸ºå †é¡¶ï¼Œå³ä¸ºæœ€å¤§å€¼</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = len - <span class="number">1</span>; i &gt; <span class="number">0</span>; i--) &#123;</span><br><span class="line">		swap(vec[<span class="number">0</span>], vec[i]);</span><br><span class="line">		max_heap(vec, <span class="number">0</span>, i - <span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; vec&#123;<span class="number">3</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">6</span>&#125;;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; v : vec) <span class="built_in">cout</span> &lt;&lt; v &lt;&lt; <span class="string">' '</span>;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">int</span> right = vec.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">	heapSort(vec);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; v : vec) <span class="built_in">cout</span> &lt;&lt; v &lt;&lt; <span class="string">' '</span>;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="/Data_Structure_and_Algorithm/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/å †æ’åº.png" style="zoom:80%"><p><strong>æ—¶é—´</strong>å¤æ‚åº¦ï¼š$O(nlog_2n)$</p><p><strong>ç©ºé—´</strong>å¤æ‚åº¦ï¼š$O(1)$</p><p><strong>ä¸ç¨³å®š</strong>ï¼šä¾‹å­ï¼š$80_1, 80_2, 70 --&gt; 70, 80_2, 80_1$</p><h3 id="8-è®¡æ•°æ’åº"><a class="header-anchor" href="#8-è®¡æ•°æ’åº">Â¶</a>8. è®¡æ•°æ’åº</h3><p>è®¡æ•°æ’åºçš„æ ¸å¿ƒåœ¨äºå°†è¾“å…¥çš„æ•°æ®å€¼è½¬åŒ–ä¸ºé”®å­˜å‚¨åœ¨é¢å¤–å¼€è¾Ÿçš„æ•°ç»„ç©ºé—´ä¸­ã€‚ä½œä¸ºä¸€ç§çº¿æ€§æ—¶é—´å¤æ‚åº¦çš„æ’åºï¼Œè®¡æ•°æ’åºè¦æ±‚è¾“å…¥çš„æ•°æ®å¿…é¡»æ˜¯æœ‰ç¡®å®šèŒƒå›´çš„æ•´æ•°ã€‚</p><p><strong>è®¡æ•°æ’åºçš„ç‰¹å¾</strong></p><p>å½“è¾“å…¥çš„å…ƒç´ æ˜¯ n ä¸ª 0 åˆ° k ä¹‹é—´çš„æ•´æ•°æ—¶ï¼Œå®ƒçš„è¿è¡Œæ—¶é—´æ˜¯ $O(n + k)$ã€‚è®¡æ•°æ’åºä¸æ˜¯æ¯”è¾ƒæ’åºï¼Œæ’åºçš„é€Ÿåº¦å¿«äºä»»ä½•æ¯”è¾ƒæ’åºç®—æ³•ã€‚</p><p>ç”±äºç”¨æ¥è®¡æ•°çš„æ•°ç»„Cçš„é•¿åº¦å–å†³äºå¾…æ’åºæ•°ç»„ä¸­æ•°æ®çš„èŒƒå›´ï¼ˆç­‰äºå¾…æ’åºæ•°ç»„çš„æœ€å¤§å€¼ä¸æœ€å°å€¼çš„å·®åŠ ä¸Š1ï¼‰ï¼Œè¿™ä½¿å¾—è®¡æ•°æ’åºå¯¹äºæ•°æ®èŒƒå›´å¾ˆå¤§çš„æ•°ç»„ï¼Œéœ€è¦å¤§é‡æ—¶é—´å’Œå†…å­˜ã€‚ä¾‹å¦‚ï¼šè®¡æ•°æ’åºæ˜¯ç”¨æ¥æ’åº0åˆ°100ä¹‹é—´çš„æ•°å­—çš„æœ€å¥½çš„ç®—æ³•ï¼Œä½†æ˜¯å®ƒä¸é€‚åˆæŒ‰å­—æ¯é¡ºåºæ’åºäººåã€‚ä½†æ˜¯ï¼Œè®¡æ•°æ’åºå¯ä»¥ç”¨åœ¨åŸºæ•°æ’åºä¸­çš„ç®—æ³•æ¥æ’åºæ•°æ®èŒƒå›´å¾ˆå¤§çš„æ•°ç»„ã€‚</p><p>é€šä¿—åœ°ç†è§£ï¼Œä¾‹å¦‚æœ‰ 10 ä¸ªå¹´é¾„ä¸åŒçš„äººï¼Œç»Ÿè®¡å‡ºæœ‰ 8 ä¸ªäººçš„å¹´é¾„æ¯” A å°ï¼Œé‚£ A çš„å¹´é¾„å°±æ’åœ¨ç¬¬ 9 ä½,ç”¨è¿™ä¸ªæ–¹æ³•å¯ä»¥å¾—åˆ°å…¶ä»–æ¯ä¸ªäººçš„ä½ç½®,ä¹Ÿå°±æ’å¥½äº†åºã€‚å½“ç„¶ï¼Œå¹´é¾„æœ‰é‡å¤æ—¶éœ€è¦ç‰¹æ®Šå¤„ç†ï¼ˆä¿è¯ç¨³å®šæ€§ï¼‰ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæœ€åè¦åå‘å¡«å……ç›®æ ‡æ•°ç»„ï¼Œä»¥åŠå°†æ¯ä¸ªæ•°å­—çš„ç»Ÿè®¡å‡å» 1 çš„åŸå› ã€‚</p><p><strong>ç®—æ³•çš„æ­¥éª¤å¦‚ä¸‹ï¼š</strong></p><ul><li>ï¼ˆ1ï¼‰æ‰¾å‡ºå¾…æ’åºçš„æ•°ç»„ä¸­æœ€å¤§å’Œæœ€å°çš„å…ƒç´ </li><li>ï¼ˆ2ï¼‰ç»Ÿè®¡æ•°ç»„ä¸­æ¯ä¸ªå€¼ä¸ºiçš„å…ƒç´ å‡ºç°çš„æ¬¡æ•°ï¼Œå­˜å…¥æ•°ç»„Cçš„ç¬¬ié¡¹</li><li>ï¼ˆ3ï¼‰å¯¹æ‰€æœ‰çš„è®¡æ•°ç´¯åŠ ï¼ˆä»Cä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ï¼Œæ¯ä¸€é¡¹å’Œå‰ä¸€é¡¹ç›¸åŠ ï¼‰</li><li>ï¼ˆ4ï¼‰åå‘å¡«å……ç›®æ ‡æ•°ç»„ï¼šå°†æ¯ä¸ªå…ƒç´ iæ”¾åœ¨æ–°æ•°ç»„çš„ç¬¬C(i)é¡¹ï¼Œæ¯æ”¾ä¸€ä¸ªå…ƒç´ å°±å°†C(i)å‡å»1</li></ul><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;climits&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line">pair&lt;int, int&gt; findMaxMinOfVec(const vector&lt;int&gt;&amp; vec) &#123;</span><br><span class="line">	<span class="keyword">int</span> <span class="built_in">min</span> = INT_MAX;</span><br><span class="line">	<span class="keyword">int</span> <span class="built_in">max</span> = INT_MIN;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; v : vec) &#123;</span><br><span class="line">		<span class="keyword">if</span> (v &gt; <span class="built_in">max</span>) <span class="built_in">max</span> = v;</span><br><span class="line">		<span class="keyword">if</span> (v &lt; <span class="built_in">min</span>) <span class="built_in">min</span> = v;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> &#123;<span class="built_in">max</span>, <span class="built_in">min</span>&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">countSort</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; vec)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> n = vec.<span class="built_in">size</span>();</span><br><span class="line">	pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; pa = findMaxMinOfVec(vec);</span><br><span class="line">	<span class="keyword">int</span> maxN = pa.first;</span><br><span class="line">	<span class="keyword">int</span> minN = pa.second;</span><br><span class="line">	<span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">freq</span><span class="params">(maxN - minN + <span class="number">1</span>)</span></span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; v : vec) &#123;</span><br><span class="line">		freq[v - minN]++;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> <span class="built_in">end</span> = n - <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = maxN - minN; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">		<span class="keyword">while</span>(freq[i] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			vec[<span class="built_in">end</span>--] = i + minN;</span><br><span class="line">			freq[i]--;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; vec&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">5</span>,<span class="number">9</span>&#125;;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; v : vec) <span class="built_in">cout</span> &lt;&lt; v &lt;&lt; <span class="string">' '</span>;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	countSort(vec);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; v : vec) <span class="built_in">cout</span> &lt;&lt; v &lt;&lt; <span class="string">' '</span>;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="/Data_Structure_and_Algorithm/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/è®¡æ•°æ’åº.png" style="zoom:80%"><p><strong>æ—¶é—´</strong>å¤æ‚åº¦ï¼š$O(n + k)$</p><p><strong>ç©ºé—´</strong>å¤æ‚åº¦ï¼š$O(k)$ å…¶ä¸­ k ä¸ºæœ€å¤§æœ€å°å€¼å·®å€¼ + 1</p><p><strong>ç¨³å®š</strong>ï¼šéœ€è¦åå‘å¡«å……æ•°ç»„</p><h3 id="9-æ¡¶æ’åº"><a class="header-anchor" href="#9-æ¡¶æ’åº">Â¶</a>9. æ¡¶æ’åº</h3><p>æ¡¶æ’åºæ˜¯è®¡æ•°æ’åºçš„å‡çº§ç‰ˆã€‚å®ƒåˆ©ç”¨äº†å‡½æ•°çš„æ˜ å°„å…³ç³»ï¼Œé«˜æ•ˆä¸å¦çš„å…³é”®å°±åœ¨äºè¿™ä¸ªæ˜ å°„å‡½æ•°çš„ç¡®å®šã€‚ä¸ºäº†ä½¿æ¡¶æ’åºæ›´åŠ é«˜æ•ˆï¼Œæˆ‘ä»¬éœ€è¦åšåˆ°è¿™ä¸¤ç‚¹ï¼š</p><ol><li>åœ¨é¢å¤–ç©ºé—´å……è¶³çš„æƒ…å†µä¸‹ï¼Œå°½é‡å¢å¤§æ¡¶çš„æ•°é‡</li><li>ä½¿ç”¨çš„æ˜ å°„å‡½æ•°èƒ½å¤Ÿå°†è¾“å…¥çš„ N ä¸ªæ•°æ®å‡åŒ€çš„åˆ†é…åˆ° K ä¸ªæ¡¶ä¸­</li></ol><p>åŒæ—¶ï¼Œå¯¹äºæ¡¶ä¸­å…ƒç´ çš„æ’åºï¼Œé€‰æ‹©ä½•ç§æ¯”è¾ƒæ’åºç®—æ³•å¯¹äºæ€§èƒ½çš„å½±å“è‡³å…³é‡è¦ã€‚</p><p><strong>æœ€å¿«</strong>ï¼šå½“è¾“å…¥çš„æ•°æ®å¯ä»¥å‡åŒ€çš„åˆ†é…åˆ°æ¯ä¸€ä¸ªæ¡¶ä¸­ã€‚</p><p><strong>æœ€æ…¢</strong>ï¼šå½“è¾“å…¥çš„æ•°æ®è¢«åˆ†é…åˆ°äº†åŒä¸€ä¸ªæ¡¶ä¸­ã€‚</p><p><strong>ç¤ºæ„å›¾</strong></p><p>å…ƒç´ åˆ†å¸ƒåœ¨æ¡¶ä¸­ï¼š</p><img src="/Data_Structure_and_Algorithm/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/æ¡¶æ’åºç¤ºæ„å›¾.png" style="zoom:50%"><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iterator&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> BUCKET_NUM = <span class="number">5</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ListNode</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    ListNode* next;</span><br><span class="line">    <span class="keyword">int</span> val;</span><br><span class="line">    explicit ListNode(int i = 0) : val(i), next(nullptr) &#123;&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ’å…¥æ“ä½œï¼Œæ’å…¥æœ‰åºé“¾è¡¨</span></span><br><span class="line"><span class="function">ListNode* <span class="title">insert</span><span class="params">(ListNode* head, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">    ListNode* dummyNode = <span class="keyword">new</span> ListNode(<span class="number">0</span>);</span><br><span class="line">    dummyNode-&gt;next = head;</span><br><span class="line">    ListNode* newNode = <span class="keyword">new</span> ListNode(val);</span><br><span class="line">    ListNode* pre, *cur;</span><br><span class="line">    pre = dummyNode;</span><br><span class="line">    cur = head;</span><br><span class="line">    <span class="keyword">while</span> (cur &amp;&amp; cur-&gt;val &lt;= val) &#123;</span><br><span class="line">        pre = cur;</span><br><span class="line">        cur = cur-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    newNode-&gt;next = cur;</span><br><span class="line">    pre-&gt;next = newNode;</span><br><span class="line">    <span class="keyword">return</span> dummyNode-&gt;next;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¡¶æ’åº</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bucketSort</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; vec)</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;ListNode*&gt; <span class="title">buckets</span><span class="params">(BUCKET_NUM, (ListNode*)(<span class="number">0</span>))</span></span>;</span><br><span class="line">    <span class="keyword">int</span> n = vec.<span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="comment">// æ¡¶ç¼–å·</span></span><br><span class="line">        <span class="keyword">int</span> idx = vec[i] / BUCKET_NUM;</span><br><span class="line">        ListNode *head = buckets.at(idx);</span><br><span class="line">        buckets.at(idx) = insert(head, vec[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> k = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// æŒ‰ç…§æ¡¶ç¼–å·ï¼Œä¾æ¬¡è¾“å‡ºç»“æœå³å¯</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; BUCKET_NUM; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (buckets[i]) &#123;</span><br><span class="line">            ListNode* cur = buckets[i];</span><br><span class="line">            <span class="keyword">while</span> (cur) &#123;</span><br><span class="line">                vec[k++] = cur-&gt;val;</span><br><span class="line">                cur = cur-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; vec&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">14</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">17</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">6</span>,<span class="number">9</span>,<span class="number">4</span>,<span class="number">12</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; v : vec) <span class="built_in">cout</span> &lt;&lt; v &lt;&lt; <span class="string">' '</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    bucketSort(vec);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; v : vec) <span class="built_in">cout</span> &lt;&lt; v &lt;&lt; <span class="string">' '</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="/Data_Structure_and_Algorithm/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/æ¡¶æ’åº.png" style="zoom:80%"><p><strong>æ—¶é—´</strong>å¤æ‚åº¦ï¼š$O(n + k)$ï¼Œæœ€åæƒ…å†µä¸‹ $O(n^2)$</p><p><strong>ç©ºé—´</strong>å¤æ‚åº¦ï¼š$O(n + k)$</p><p><strong>ç¨³å®š</strong>ï¼Œä½†æ˜¯ç¡®åˆ‡è¯´åº”è¯¥å–å†³äºæ¡¶ä¸­æ’åºç®—æ³•ã€‚</p><h3 id="10-åŸºæ•°æ’åº"><a class="header-anchor" href="#10-åŸºæ•°æ’åº">Â¶</a>10. åŸºæ•°æ’åº</h3><p>åŸºæ•°æ’åºæ˜¯ä¸€ç§éæ¯”è¾ƒå‹æ•´æ•°æ’åºç®—æ³•ï¼Œå…¶åŸç†æ˜¯å°†æ•´æ•°æŒ‰ä½æ•°åˆ‡å‰²æˆä¸åŒçš„æ•°å­—ï¼Œç„¶åæŒ‰æ¯ä¸ªä½æ•°åˆ†åˆ«æ¯”è¾ƒã€‚ç”±äºæ•´æ•°ä¹Ÿå¯ä»¥è¡¨è¾¾å­—ç¬¦ä¸²ï¼ˆæ¯”å¦‚åå­—æˆ–æ—¥æœŸï¼‰å’Œç‰¹å®šæ ¼å¼çš„æµ®ç‚¹æ•°ï¼Œæ‰€ä»¥åŸºæ•°æ’åºä¹Ÿä¸æ˜¯åªèƒ½ä½¿ç”¨äºæ•´æ•°ã€‚</p><p>åŸºæ•°æ’åºæœ‰ä¸¤ç§æ–¹æ³•ï¼š</p><p>è¿™ä¸‰ç§æ’åºç®—æ³•éƒ½åˆ©ç”¨äº†æ¡¶çš„æ¦‚å¿µï¼Œä½†å¯¹æ¡¶çš„ä½¿ç”¨æ–¹æ³•ä¸Šæœ‰æ˜æ˜¾å·®å¼‚ï¼š</p><ul><li>åŸºæ•°æ’åºï¼šæ ¹æ®é”®å€¼çš„æ¯ä½æ•°å­—æ¥åˆ†é…æ¡¶ï¼›</li><li>è®¡æ•°æ’åºï¼šæ¯ä¸ªæ¡¶åªå­˜å‚¨å•ä¸€é”®å€¼ï¼›</li><li>æ¡¶æ’åºï¼šæ¯ä¸ªæ¡¶å­˜å‚¨ä¸€å®šèŒƒå›´çš„æ•°å€¼</li></ul><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">maxbit</span><span class="params">(<span class="keyword">const</span> <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; vec)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n = vec.<span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">int</span> maxLen = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; v : vec) &#123;</span><br><span class="line">        <span class="keyword">int</span> len = to_string(v).<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">if</span> (len &gt; maxLen) maxLen = len;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> maxLen;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">radixSort</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; vec)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n = vec.<span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">int</span> d = maxbit(vec);</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">temp</span><span class="params">(n)</span></span>;</span><br><span class="line">    <span class="keyword">int</span> count[<span class="number">10</span>]; <span class="comment">// ç»Ÿè®¡è¢«åˆ†é…åˆ° 0 1 2 ... 9 çš„æ¬¡æ•°</span></span><br><span class="line">    <span class="keyword">int</span> radix = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= d; i++) &#123;</span><br><span class="line">        <span class="built_in">memset</span>(count, <span class="number">0</span>, <span class="keyword">sizeof</span>(count));</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">            <span class="keyword">int</span> k = (vec[j] / radix) % <span class="number">10</span>;</span><br><span class="line">            count[k]++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ ¹æ®æ¯ä¸ªæ¡¶çš„å¤§å°ï¼Œåˆ†é…åŒºé—´ä½ç½®ï¼Œä»å°åˆ°å¤§åˆ†é…</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; <span class="number">10</span>; j++) &#123;</span><br><span class="line">            count[j] = count[j - <span class="number">1</span>] + count[j];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = n - <span class="number">1</span>; j &gt;= <span class="number">0</span>; j--) &#123;</span><br><span class="line">            <span class="keyword">int</span> k = (vec[j] / radix) % <span class="number">10</span>;</span><br><span class="line">            <span class="comment">// åå‘æ’å…¥</span></span><br><span class="line">            temp[count[k] - <span class="number">1</span>] = vec[j];</span><br><span class="line">            count[k]--; <span class="comment">// å‘å‰ç§»åŠ¨</span></span><br><span class="line">        &#125;</span><br><span class="line">        vec = temp; <span class="comment">// èµ‹å€¼</span></span><br><span class="line">        radix *= <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; vec&#123;<span class="number">1</span>,<span class="number">20</span>,<span class="number">51</span>,<span class="number">6</span>,<span class="number">78</span>,<span class="number">9</span>,<span class="number">30</span>,<span class="number">41</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">54</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">18</span>,<span class="number">81</span>,<span class="number">75</span>,<span class="number">94</span>,<span class="number">9</span>,<span class="number">64</span>,<span class="number">82</span>,<span class="number">37</span>,<span class="number">42</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; v : vec) <span class="built_in">cout</span> &lt;&lt; v &lt;&lt; <span class="string">' '</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    radixSort(vec);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; v : vec) <span class="built_in">cout</span> &lt;&lt; v &lt;&lt; <span class="string">' '</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="/Data_Structure_and_Algorithm/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/åŸºæ•°æ’åº.png" style="zoom:80%"><p><strong>æ—¶é—´</strong>å¤æ‚åº¦ï¼š$O(n * k)$</p><p><strong>ç©ºé—´</strong>å¤æ‚åº¦ï¼š$O(n + k)$</p><p><strong>ç¨³å®š</strong></p><h3 id="æ’åºæ€»ç»“"><a class="header-anchor" href="#æ’åºæ€»ç»“">Â¶</a>æ’åºæ€»ç»“</h3><img src="/Data_Structure_and_Algorithm/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/åå¤§æ’åº.png" style="zoom:50%"><h3 id="å‚è€ƒèµ„æ–™"><a class="header-anchor" href="#å‚è€ƒèµ„æ–™">Â¶</a>å‚è€ƒèµ„æ–™</h3><blockquote><p><a href="https://www.runoob.com/w3cnote/ten-sorting-algorithm.html" target="_blank" rel="noopener">1.0 åå¤§ç»å…¸æ’åºç®—æ³• | èœé¸Ÿæ•™ç¨‹ (runoob.com)</a></p></blockquote><!-- rebuild by neat -->]]></content>
      <categories>
        <category>Data_Structure_and_Algorithm</category>
      </categories>
      <tags>
        <tag>æ’åº</tag>
      </tags>
  </entry>
  <entry>
    <title>å‰‘æŒ‡offer -- æ•°å­¦</title>
    <url>/Data_Structure_and_Algorithm/%E5%89%91%E6%8C%87offer/%E6%95%B0%E5%AD%A6/</url>
    <content><![CDATA[<!-- build time:Tue Jun 22 2021 17:02:33 GMT+0800 (GMT+08:00) --><a id="more"></a><h2 id="å‰‘æŒ‡offer-â€“-æ•°å­¦"><a class="header-anchor" href="#å‰‘æŒ‡offer-â€“-æ•°å­¦">Â¶</a>å‰‘æŒ‡offer â€“ æ•°å­¦</h2><h3 id="å‰‘æŒ‡-Offer-14-I-å‰ªç»³å­"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-14-I-å‰ªç»³å­">Â¶</a><a href="https://leetcode-cn.com/problems/jian-sheng-zi-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 14- I. å‰ªç»³å­</a></h3><p>Difficulty: <strong><font color="F08F00">ä¸­ç­‰</font></strong></p><p>ç»™ä½ ä¸€æ ¹é•¿åº¦ä¸º <code>n</code> çš„ç»³å­ï¼Œè¯·æŠŠç»³å­å‰ªæˆæ•´æ•°é•¿åº¦çš„ <code>m</code> æ®µï¼ˆmã€néƒ½æ˜¯æ•´æ•°ï¼Œn&gt;1å¹¶ä¸”m&gt;1ï¼‰ï¼Œæ¯æ®µç»³å­çš„é•¿åº¦è®°ä¸º <code>k[0],k[1]...k[m-1]</code> ã€‚è¯·é—® <code>k[0]*k[1]*...*k[m-1]</code> å¯èƒ½çš„æœ€å¤§ä¹˜ç§¯æ˜¯å¤šå°‘ï¼Ÿä¾‹å¦‚ï¼Œå½“ç»³å­çš„é•¿åº¦æ˜¯8æ—¶ï¼Œæˆ‘ä»¬æŠŠå®ƒå‰ªæˆé•¿åº¦åˆ†åˆ«ä¸º2ã€3ã€3çš„ä¸‰æ®µï¼Œæ­¤æ—¶å¾—åˆ°çš„æœ€å¤§ä¹˜ç§¯æ˜¯18ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: 2</span><br><span class="line">è¾“å‡º: 1</span><br><span class="line">è§£é‡Š: 2 &#x3D; 1 + 1, 1 Ã— 1 &#x3D; 1</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: 10</span><br><span class="line">è¾“å‡º: 36</span><br><span class="line">è§£é‡Š: 10 &#x3D; 3 + 3 + 4, 3 Ã— 3 Ã— 4 &#x3D; 36</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li><code>2 &lt;= n &lt;= 58</code></li></ul><p><strong>Solution</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">cuttingRope</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">2</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">3</span>) <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ä¸ºæ±‚æœ€å¤§ä¹˜ç§¯ï¼Œéœ€è¦å°½å¯èƒ½çš„ä»¥ 3 ä¸ºåˆ†ç»„</span></span><br><span class="line">        <span class="keyword">int</span> m = n % <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">int</span> d = n / <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¯ä»¥åˆ†ä¸º d ä¸ª 3</span></span><br><span class="line">        <span class="keyword">if</span> (!m) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">pow</span>(<span class="number">3</span>, d);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¤šå‡ºä¸€ä¸ª 1 </span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (m == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">pow</span>(<span class="number">3</span>, d - <span class="number">1</span>) * <span class="number">4</span>; </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¤šå‡ºä¸€ä¸ª 2 </span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">pow</span>(<span class="number">3</span>, d) * <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="å‰‘æŒ‡-Offer-14-II-å‰ªç»³å­-II"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-14-II-å‰ªç»³å­-II">Â¶</a><a href="https://leetcode-cn.com/problems/jian-sheng-zi-ii-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 14- II. å‰ªç»³å­ II</a></h3><p>Difficulty: <strong><font color="F08F00">ä¸­ç­‰</font></strong></p><p>ç»™ä½ ä¸€æ ¹é•¿åº¦ä¸º <code>n</code> çš„ç»³å­ï¼Œè¯·æŠŠç»³å­å‰ªæˆæ•´æ•°é•¿åº¦çš„ <code>m</code> æ®µï¼ˆmã€néƒ½æ˜¯æ•´æ•°ï¼Œn&gt;1å¹¶ä¸”m&gt;1ï¼‰ï¼Œæ¯æ®µç»³å­çš„é•¿åº¦è®°ä¸º <code>k[0],k[1]...k[m - 1]</code> ã€‚è¯·é—® <code>k[0]*k[1]*...*k[m - 1]</code> å¯èƒ½çš„æœ€å¤§ä¹˜ç§¯æ˜¯å¤šå°‘ï¼Ÿä¾‹å¦‚ï¼Œå½“ç»³å­çš„é•¿åº¦æ˜¯8æ—¶ï¼Œæˆ‘ä»¬æŠŠå®ƒå‰ªæˆé•¿åº¦åˆ†åˆ«ä¸º2ã€3ã€3çš„ä¸‰æ®µï¼Œæ­¤æ—¶å¾—åˆ°çš„æœ€å¤§ä¹˜ç§¯æ˜¯18ã€‚</p><p>ç­”æ¡ˆéœ€è¦å–æ¨¡ 1e9+7ï¼ˆ1000000007ï¼‰ï¼Œå¦‚è®¡ç®—åˆå§‹ç»“æœä¸ºï¼š1000000008ï¼Œè¯·è¿”å› 1ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: 2</span><br><span class="line">è¾“å‡º: 1</span><br><span class="line">è§£é‡Š: 2 &#x3D; 1 + 1, 1 Ã— 1 &#x3D; 1</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: 10</span><br><span class="line">è¾“å‡º: 36</span><br><span class="line">è§£é‡Š: 10 &#x3D; 3 + 3 + 4, 3 Ã— 3 Ã— 4 &#x3D; 36</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li><code>2 &lt;= n &lt;= 1000</code></li></ul><p><strong>Solution</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">cuttingRope</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">2</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">3</span>) <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">long</span> res = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (n &gt; <span class="number">4</span>) &#123;</span><br><span class="line">            res *= <span class="number">3</span>;</span><br><span class="line">            res %= <span class="number">1000000007</span>;</span><br><span class="line">            n -= <span class="number">3</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">int</span>(res * n % <span class="number">1000000007</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>å‰‘æŒ‡ offer 14</strong> ä¸¤é“é¢˜åŸºæœ¬ç›¸åŒï¼Œæ—¶é—´ç©ºé—´å¤æ‚åº¦åˆ†æç›¸åŒ</p><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong> $O(1)$ï¼Œç®€å•çš„ç®—æœ¯è¿ç®—</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong> $O(1) $</p><hr><h3 id="å‰‘æŒ‡-Offer-39-æ•°ç»„ä¸­å‡ºç°æ¬¡æ•°è¶…è¿‡ä¸€åŠçš„æ•°å­—"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-39-æ•°ç»„ä¸­å‡ºç°æ¬¡æ•°è¶…è¿‡ä¸€åŠçš„æ•°å­—">Â¶</a><a href="https://leetcode-cn.com/problems/shu-zu-zhong-chu-xian-ci-shu-chao-guo-yi-ban-de-shu-zi-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 39. æ•°ç»„ä¸­å‡ºç°æ¬¡æ•°è¶…è¿‡ä¸€åŠçš„æ•°å­—</a></h3><p>Difficulty: <strong><font color="008F00">ç®€å•</font></strong></p><p>æ•°ç»„ä¸­æœ‰ä¸€ä¸ªæ•°å­—å‡ºç°çš„æ¬¡æ•°è¶…è¿‡æ•°ç»„é•¿åº¦çš„ä¸€åŠï¼Œè¯·æ‰¾å‡ºè¿™ä¸ªæ•°å­—ã€‚</p><p>ä½ å¯ä»¥å‡è®¾æ•°ç»„æ˜¯éç©ºçš„ï¼Œå¹¶ä¸”ç»™å®šçš„æ•°ç»„æ€»æ˜¯å­˜åœ¨å¤šæ•°å…ƒç´ ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: [1, 2, 3, 2, 2, 2, 5, 4, 2]</span><br><span class="line">è¾“å‡º: 2</span><br></pre></td></tr></table></figure><p><strong>é™åˆ¶ï¼š</strong></p><p><code>1 &lt;= æ•°ç»„é•¿åº¦ &lt;= 50000</code></p><p><strong>Solution</strong></p><p><strong><font color="F08F00">æ–¹æ³•ä¸€ï¼šæ’åº</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">majorityElement</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">1</span>) <span class="keyword">return</span> nums[<span class="number">0</span>];</span><br><span class="line">        sort(nums.<span class="built_in">begin</span>(), nums.<span class="built_in">end</span>());</span><br><span class="line">        <span class="keyword">return</span> nums[n / <span class="number">2</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å–å†³äºå¿«é€Ÿæ’åºçš„æ—¶é—´ç©ºé—´å¤æ‚åº¦</p><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong> $O(N \log N)$</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong> $O(\log N) $</p><hr><p><strong><font color="F08F00">æ–¹æ³•äºŒï¼šå“ˆå¸Œè¡¨</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">majorityElement</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">unordered_map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; mp;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; n : nums) &#123;</span><br><span class="line">            mp[n]++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; n : nums) &#123;</span><br><span class="line">            <span class="keyword">if</span> (mp[n] &gt;= (nums.<span class="built_in">size</span>() + <span class="number">1</span>) / <span class="number">2</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> n;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong> $O(N)$ï¼Œç®€å•çš„ç®—æœ¯è¿ç®—</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong> $O(N) $</p><hr><p><strong><font color="F08F00">æ–¹æ³•äºŒï¼šæ‘©å°”æŠ•ç¥¨</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">majorityElement</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">1</span>) <span class="keyword">return</span> nums[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">int</span> res = <span class="number">0</span>, count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; num : nums) &#123;</span><br><span class="line">            <span class="keyword">if</span> (count == <span class="number">0</span>) &#123;</span><br><span class="line">                res = num;</span><br><span class="line">                count++;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                res == n ? count++ : count--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong> $O(N)$ï¼Œç®€å•çš„ç®—æœ¯è¿ç®—</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong> $O(1) $</p><hr><h3 id="å‰‘æŒ‡-Offer-43-1ï½n-æ•´æ•°ä¸­-1-å‡ºç°çš„æ¬¡æ•°"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-43-1ï½n-æ•´æ•°ä¸­-1-å‡ºç°çš„æ¬¡æ•°">Â¶</a><a href="https://leetcode-cn.com/problems/1nzheng-shu-zhong-1chu-xian-de-ci-shu-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 43. 1ï½n æ•´æ•°ä¸­ 1 å‡ºç°çš„æ¬¡æ•°</a></h3><p>Difficulty: <strong><font color="FF0000">å›°éš¾</font></strong></p><p>è¾“å…¥ä¸€ä¸ªæ•´æ•° <code>n</code> ï¼Œæ±‚1ï½nè¿™nä¸ªæ•´æ•°çš„åè¿›åˆ¶è¡¨ç¤ºä¸­1å‡ºç°çš„æ¬¡æ•°ã€‚</p><p>ä¾‹å¦‚ï¼Œè¾“å…¥12ï¼Œ1ï½12è¿™äº›æ•´æ•°ä¸­åŒ…å«1 çš„æ•°å­—æœ‰1ã€10ã€11å’Œ12ï¼Œ1ä¸€å…±å‡ºç°äº†5æ¬¡ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šn &#x3D; 12</span><br><span class="line">è¾“å‡ºï¼š5</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šn &#x3D; 13</span><br><span class="line">è¾“å‡ºï¼š6</span><br></pre></td></tr></table></figure><p><strong>é™åˆ¶ï¼š</strong></p><ul><li><code>1 &lt;= n &lt; 2^31</code></li></ul><p><strong>Solution</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">countDigitOne</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> digit = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> high = n / <span class="number">10</span>;</span><br><span class="line">        <span class="keyword">int</span> cur = n % <span class="number">10</span>;</span><br><span class="line">        <span class="keyword">int</span> low = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> res;</span><br><span class="line">        <span class="comment">// å½“ high å’Œ cur åŒæ—¶ä¸º 0ï¼Œè¯´æ˜å·²ç»è¶Šè¿‡æœ€é«˜ä½</span></span><br><span class="line">        <span class="keyword">while</span> (cur || high) &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// æ ¸å¿ƒä»£ç ï¼Œ3 ä¸ªåˆ¤æ–­æ¡ä»¶</span></span><br><span class="line">            <span class="keyword">if</span> (cur == <span class="number">0</span>) res += high * digit;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (cur == <span class="number">1</span>) res += (high * digit) + low + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> res += (high + <span class="number">1</span>) * digit;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// å°† cur åŠ å…¥ low, ç»„æˆä¸‹è½® low, ä¹Ÿå°±æ˜¯ low å·¦ç§»</span></span><br><span class="line">            low += cur * digit;</span><br><span class="line">            <span class="comment">// ä¸‹è½® cur æ˜¯æœ¬è½® high çš„æœ€ä½ä½, ä¹Ÿå°±æ˜¯ cur å·¦ç§»</span></span><br><span class="line">            cur = high % <span class="number">10</span>;</span><br><span class="line">            <span class="comment">// å°†æœ¬è½® high æœ€ä½ä½åˆ é™¤ï¼Œå¾—åˆ°ä¸‹è½® highï¼Œä¹Ÿå°±æ˜¯ high å·¦ç§»</span></span><br><span class="line">            high = high / <span class="number">10</span>;</span><br><span class="line">            <span class="comment">// ä½å› å­æ¯è½® * 10</span></span><br><span class="line">            digit = digit * <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(logn) $ ï¼Œå¾ªç¯å†…çš„è®¡ç®—æ“ä½œä½¿ç”¨ $O(1)$ æ—¶é—´ï¼›å¾ªç¯æ¬¡æ•°ä¸ºæ•°å­— n çš„ä½æ•°ï¼Œå³ $\log_{10}{n}$ ï¼Œå› æ­¤å¾ªç¯ä½¿ç”¨ $O(\log n)$æ—¶é—´ã€‚<br><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š $O(1)$ï¼Œ å‡ ä¸ªå˜é‡ä½¿ç”¨å¸¸æ•°å¤§å°çš„é¢å¤–ç©ºé—´ã€‚</p><hr><h3 id="å‰‘æŒ‡-Offer-44-æ•°å­—åºåˆ—ä¸­æŸä¸€ä½çš„æ•°å­—"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-44-æ•°å­—åºåˆ—ä¸­æŸä¸€ä½çš„æ•°å­—">Â¶</a><a href="https://leetcode-cn.com/problems/shu-zi-xu-lie-zhong-mou-yi-wei-de-shu-zi-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 44. æ•°å­—åºåˆ—ä¸­æŸä¸€ä½çš„æ•°å­—</a></h3><p>Difficulty: <strong><font color="F008F00">ä¸­ç­‰</font></strong></p><p>æ•°å­—ä»¥0123456789101112131415â€¦çš„æ ¼å¼åºåˆ—åŒ–åˆ°ä¸€ä¸ªå­—ç¬¦åºåˆ—ä¸­ã€‚åœ¨è¿™ä¸ªåºåˆ—ä¸­ï¼Œç¬¬5ä½ï¼ˆä»ä¸‹æ ‡0å¼€å§‹è®¡æ•°ï¼‰æ˜¯5ï¼Œç¬¬13ä½æ˜¯1ï¼Œç¬¬19ä½æ˜¯4ï¼Œç­‰ç­‰ã€‚</p><p>è¯·å†™ä¸€ä¸ªå‡½æ•°ï¼Œæ±‚ä»»æ„ç¬¬nä½å¯¹åº”çš„æ•°å­—ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šn &#x3D; 3</span><br><span class="line">è¾“å‡ºï¼š3</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šn &#x3D; 11</span><br><span class="line">è¾“å‡ºï¼š0</span><br></pre></td></tr></table></figure><p><strong>é™åˆ¶ï¼š</strong></p><ul><li><code>0 &lt;= n &lt; 2^31</code></li></ul><p><strong>Solution</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">findNthDigit</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> digit = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">long</span> start = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">long</span> count = <span class="number">9</span>;</span><br><span class="line">        <span class="keyword">while</span> (n &gt; count) &#123;</span><br><span class="line">            n -= count;</span><br><span class="line">            start *= <span class="number">10</span>;  <span class="comment">// 1, 10, 100, ...</span></span><br><span class="line">            digit += <span class="number">1</span>;   <span class="comment">// 1, 2, 3, ...</span></span><br><span class="line">            count = digit * start * <span class="number">9</span>; <span class="comment">// 9, 180, 2700</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ç¡®å®šnum </span></span><br><span class="line">        <span class="keyword">long</span> num = start + (n - <span class="number">1</span>) / digit;</span><br><span class="line">        <span class="comment">// ç¡®å®š n ä½ç½®åœ¨ num ä¸­å“ªä¸€ä½</span></span><br><span class="line">        <span class="keyword">return</span> to_string(num)[(n - <span class="number">1</span>) % digit] - <span class="string">'0'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong> $O(logn)$ï¼Œ æ‰€æ±‚æ•°ä½ n å¯¹åº”æ•°å­— num çš„ä½æ•° digit æœ€å¤§ä¸º $O(\log n)$ ï¼›ç¬¬ä¸€æ­¥æœ€å¤šå¾ªç¯ $O(\log n)$ æ¬¡ï¼›ç¬¬ä¸‰æ­¥ä¸­å°† num è½¬åŒ–ä¸ºå­—ç¬¦ä¸²ä½¿ç”¨ $O(\log n)$ æ—¶é—´ï¼›å› æ­¤æ€»ä½“ä¸º $O(\log n)$ ã€‚<br><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(logn)$ ï¼Œå°†æ•°å­— num è½¬åŒ–ä¸ºå­—ç¬¦ä¸² str(num) ï¼Œå ç”¨ $O(\log n)$ çš„é¢å¤–ç©ºé—´ã€‚</p><hr><h3 id="å‰‘æŒ‡-Offer-57-II-å’Œä¸ºsçš„è¿ç»­æ­£æ•°åºåˆ—"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-57-II-å’Œä¸ºsçš„è¿ç»­æ­£æ•°åºåˆ—">Â¶</a><a href="https://leetcode-cn.com/problems/he-wei-sde-lian-xu-zheng-shu-xu-lie-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 57 - II. å’Œä¸ºsçš„è¿ç»­æ­£æ•°åºåˆ—</a></h3><p>Difficulty: <strong><font color="008F00">ç®€å•</font></strong></p><p>è¾“å…¥ä¸€ä¸ªæ­£æ•´æ•° <code>target</code> ï¼Œè¾“å‡ºæ‰€æœ‰å’Œä¸º <code>target</code> çš„è¿ç»­æ­£æ•´æ•°åºåˆ—ï¼ˆè‡³å°‘å«æœ‰ä¸¤ä¸ªæ•°ï¼‰ã€‚</p><p>åºåˆ—å†…çš„æ•°å­—ç”±å°åˆ°å¤§æ’åˆ—ï¼Œä¸åŒåºåˆ—æŒ‰ç…§é¦–ä¸ªæ•°å­—ä»å°åˆ°å¤§æ’åˆ—ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼štarget &#x3D; 9</span><br><span class="line">è¾“å‡ºï¼š[[2,3,4],[4,5]]</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼štarget &#x3D; 15</span><br><span class="line">è¾“å‡ºï¼š[[1,2,3,4,5],[4,5,6],[7,8]]</span><br></pre></td></tr></table></figure><p><strong>é™åˆ¶ï¼š</strong></p><ul><li><code>1 &lt;= target &lt;= 10^5</code></li></ul><p><strong>Solution</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åŒæŒ‡é’ˆ</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; <span class="title">findContinuousSequence</span><span class="params">(<span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (target == <span class="number">1</span>) <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; res;</span><br><span class="line">        <span class="keyword">int</span> left = <span class="number">1</span>, right = <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">int</span> sum = left + right;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åªéœ€è¦å¾ªç¯åˆ°ä¸­ä½æ•°å³å¯</span></span><br><span class="line">        <span class="keyword">while</span> (right &lt;= ((target + <span class="number">1</span>) / <span class="number">2</span>)) &#123;</span><br><span class="line">            <span class="keyword">while</span> (left &lt; right) &#123;     </span><br><span class="line">                <span class="keyword">if</span> (target == sum) &#123;</span><br><span class="line">                    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; temp;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i = left; i &lt;= right; i++) &#123;</span><br><span class="line">                        temp.push_back(i);</span><br><span class="line">                    &#125;</span><br><span class="line">                    res.push_back(temp);</span><br><span class="line">                    sum -= left;</span><br><span class="line">                    left++;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (target &lt; sum) &#123;</span><br><span class="line">                    sum -= left;</span><br><span class="line">                    left++;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    right++;</span><br><span class="line">                    sum += right;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            right++; <span class="comment">// è·³å‡ºä¸­ä½æ•°</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong> $O(N)$ï¼Œå…¶ä¸­ $N = target$ï¼›è¿ç»­æ•´æ•°åºåˆ—è‡³å°‘æœ‰ä¸¤ä¸ªæ•°å­—ï¼Œè€Œ $i &lt; j$æ’æˆç«‹ï¼Œå› æ­¤è‡³å¤šå¾ªç¯ $target$ æ¬¡ï¼ˆ $i , j$ éƒ½ç§»åŠ¨åˆ° $\frac{target}{2}$ ï¼‰ï¼Œä½¿ç”¨ $O(N)$ æ—¶é—´ï¼›å½“ $i = 1$ æ—¶ï¼Œè¾¾åˆ°æœ€å¤§åºåˆ—é•¿åº¦ $\frac{-1 + \sqrt{1 + 8s}}{2}$ ï¼Œè€ƒè™‘åˆ°è§£çš„ç¨€ç–æ€§ï¼Œå°†åˆ—è¡¨æ„å»ºæ—¶é—´ç®€åŒ–è€ƒè™‘ä¸º $O(1)$ï¼›</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong> $O(1) $</p><hr><h3 id="å‰‘æŒ‡-Offer-62-åœ†åœˆä¸­æœ€åå‰©ä¸‹çš„æ•°å­—"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-62-åœ†åœˆä¸­æœ€åå‰©ä¸‹çš„æ•°å­—">Â¶</a><a href="https://leetcode-cn.com/problems/yuan-quan-zhong-zui-hou-sheng-xia-de-shu-zi-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 62. åœ†åœˆä¸­æœ€åå‰©ä¸‹çš„æ•°å­—</a></h3><p>Difficulty: <strong><font color="0008F00">ç®€å•</font></strong></p><p>0,1,Â·Â·Â·,n-1è¿™nä¸ªæ•°å­—æ’æˆä¸€ä¸ªåœ†åœˆï¼Œä»æ•°å­—0å¼€å§‹ï¼Œæ¯æ¬¡ä»è¿™ä¸ªåœ†åœˆé‡Œåˆ é™¤ç¬¬mä¸ªæ•°å­—ï¼ˆåˆ é™¤åä»ä¸‹ä¸€ä¸ªæ•°å­—å¼€å§‹è®¡æ•°ï¼‰ã€‚æ±‚å‡ºè¿™ä¸ªåœ†åœˆé‡Œå‰©ä¸‹çš„æœ€åä¸€ä¸ªæ•°å­—ã€‚</p><p>ä¾‹å¦‚ï¼Œ0ã€1ã€2ã€3ã€4è¿™5ä¸ªæ•°å­—ç»„æˆä¸€ä¸ªåœ†åœˆï¼Œä»æ•°å­—0å¼€å§‹æ¯æ¬¡åˆ é™¤ç¬¬3ä¸ªæ•°å­—ï¼Œåˆ™åˆ é™¤çš„å‰4ä¸ªæ•°å­—ä¾æ¬¡æ˜¯2ã€0ã€4ã€1ï¼Œå› æ­¤æœ€åå‰©ä¸‹çš„æ•°å­—æ˜¯3ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: n &#x3D; 5, m &#x3D; 3</span><br><span class="line">è¾“å‡º: 3</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: n &#x3D; 10, m &#x3D; 17</span><br><span class="line">è¾“å‡º: 2</span><br></pre></td></tr></table></figure><p><strong>é™åˆ¶ï¼š</strong></p><ul><li><code>1 &lt;= n &lt;= 10^5</code></li><li><code>1 &lt;= m &lt;= 10^6</code></li></ul><p><strong>Solution</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">lastRemaining</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span> m)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            res = (res + m) % i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><img src="/Data_Structure_and_Algorithm/%E5%89%91%E6%8C%87offer/%E6%95%B0%E5%AD%A6/åœ†åœˆä¸­æœ€åå‰©ä¸‹çš„æ•°å­—.png" style="zoom:67%"><hr><h3 id="å‰‘æŒ‡-Offer-66-æ„å»ºä¹˜ç§¯æ•°ç»„"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-66-æ„å»ºä¹˜ç§¯æ•°ç»„">Â¶</a><a href="https://leetcode-cn.com/problems/gou-jian-cheng-ji-shu-zu-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 66. æ„å»ºä¹˜ç§¯æ•°ç»„</a></h3><p>Difficulty: <strong><font color="F08F00">ä¸­ç­‰</font></strong></p><p>ç»™å®šä¸€ä¸ªæ•°ç»„ <code>A[0,1,â€¦,n-1]</code>ï¼Œè¯·æ„å»ºä¸€ä¸ªæ•°ç»„ <code>B[0,1,â€¦,n-1]</code>ï¼Œå…¶ä¸­ <code>B[i]</code> çš„å€¼æ˜¯æ•°ç»„ <code>A</code> ä¸­é™¤äº†ä¸‹æ ‡ <code>i</code> ä»¥å¤–çš„å…ƒç´ çš„ç§¯, å³ <code>B[i]=A[0]Ã—A[1]Ã—â€¦Ã—A[i-1]Ã—A[i+1]Ã—â€¦Ã—A[n-1]</code>ã€‚ä¸èƒ½ä½¿ç”¨é™¤æ³•ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: [1,2,3,4,5]</span><br><span class="line">è¾“å‡º: [120,60,40,30,24]</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li>æ‰€æœ‰å…ƒç´ ä¹˜ç§¯ä¹‹å’Œä¸ä¼šæº¢å‡º 32 ä½æ•´æ•°</li><li><code>a.length &lt;= 100000</code></li></ul><p><strong>Solution</strong></p><p><strong><font color="F08F00">æ–¹æ³•ä¸€ï¼šå½“å‰ä½ç½®çš„å€¼ = å·¦è¾¹ä¹˜ç§¯ * å³è¾¹ä¹˜ç§¯</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">constructArr</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; a)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = a.<span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¾å®šåŠ¨æ€è§„åˆ’çŸ©é˜µ</span></span><br><span class="line">        <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">dpLeft</span><span class="params">(n + <span class="number">1</span>, <span class="number">1</span>)</span></span>;</span><br><span class="line">        <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">dpRight</span><span class="params">(n + <span class="number">1</span>, <span class="number">1</span>)</span></span>;</span><br><span class="line">		</span><br><span class="line">        <span class="comment">// ç®€å•æ±‚å–å·¦å³ä¹˜ç§¯çŸ©é˜µ</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, j = n - <span class="number">1</span>; i &lt; n, j &gt;= <span class="number">0</span>; i++, j--)&#123;</span><br><span class="line">            dpLeft[i] = dpLeft[i - <span class="number">1</span>] * a[i - <span class="number">1</span>];</span><br><span class="line">            dpRight[j] = dpRight[j + <span class="number">1</span>] * a[j];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">res</span><span class="params">(n)</span></span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            res[i] = dpLeft[i] * dpRight[i + <span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong> $O(N)$ï¼Œ2æ¬¡éå†æ•°ç»„</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong> $O(N) $ï¼Œå·¦å³ä¹˜ç§¯çŸ©é˜µå ç”¨çš„ç©ºé—´</p><hr><p><strong><font color="F08F00">æ–¹æ³•äºŒï¼šåŒå‘éå†</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">constructArr</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; a)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = a.<span class="built_in">size</span>();</span><br><span class="line">		<span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">B</span><span class="params">(n)</span></span>;</span><br><span class="line">        <span class="keyword">int</span> temp = <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// æ­£å‘éå†,è·å¾—å·¦ä¹˜ç§¯çŸ©é˜µ</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            B[i] = temp;</span><br><span class="line">            temp *= a[i];</span><br><span class="line">        &#125;</span><br><span class="line">        temp = <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// åå‘éå†,è·å¾—å³ä¹˜ç§¯çŸ©é˜µï¼ŒåŒæ—¶ä¸å·¦ä¹˜ç§¯çŸ©é˜µç›¸ä¹˜ï¼Œç›¸æ¯”äºæ–¹æ³•ä¸€å°‘å»ä¸€éƒ¨åˆ†æ“ä½œ</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = n - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            B[i] = B[i] * temp;</span><br><span class="line">            temp *= a[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> B;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong> $O(N)$ï¼Œ2æ¬¡éå†æ•°ç»„</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong> $O(N) $ï¼Œæ•°ç»„ B å ç”¨çš„ç©ºé—´</p><hr><h3 id="å‚è€ƒèµ„æ–™"><a class="header-anchor" href="#å‚è€ƒèµ„æ–™">Â¶</a>å‚è€ƒèµ„æ–™</h3><blockquote><p><a href="https://leetcode-cn.com/leetbook/detail/illustration-of-algorithm/" target="_blank" rel="noopener">å›¾è§£ç®—æ³•æ•°æ®ç»“æ„ - LeetBook - åŠ›æ‰£ï¼ˆLeetCodeï¼‰å…¨çƒæå®¢æŒšçˆ±çš„æŠ€æœ¯æˆé•¿å¹³å° (leetcode-cn.com)</a></p><p><a href="https://leetcode-cn.com/" target="_blank" rel="noopener">åŠ›æ‰£ï¼ˆLeetCodeï¼‰å®˜ç½‘ - å…¨çƒæå®¢æŒšçˆ±çš„æŠ€æœ¯æˆé•¿å¹³å° (leetcode-cn.com)</a> å®˜æ–¹é¢˜è§£</p></blockquote><!-- rebuild by neat -->]]></content>
      <categories>
        <category>Data_Structure_and_Algorithm</category>
      </categories>
      <tags>
        <tag>æ•°å­¦</tag>
      </tags>
  </entry>
  <entry>
    <title>å‰‘æŒ‡offer -- æ’åº</title>
    <url>/Data_Structure_and_Algorithm/%E5%89%91%E6%8C%87offer/%E6%8E%92%E5%BA%8F/</url>
    <content><![CDATA[<!-- build time:Tue Jun 22 2021 17:02:33 GMT+0800 (GMT+08:00) --><a id="more"></a><h2 id="å‰‘æŒ‡offer-â€“-æ’åº"><a class="header-anchor" href="#å‰‘æŒ‡offer-â€“-æ’åº">Â¶</a>å‰‘æŒ‡offer â€“ æ’åº</h2><h3 id="å‰‘æŒ‡-Offer-40-æœ€å°çš„kä¸ªæ•°"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-40-æœ€å°çš„kä¸ªæ•°">Â¶</a><a href="https://leetcode-cn.com/problems/zui-xiao-de-kge-shu-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 40. æœ€å°çš„kä¸ªæ•°</a></h3><p>Difficulty: <strong><font color="008F00">ç®€å•</font></strong></p><p>è¾“å…¥æ•´æ•°æ•°ç»„ <code>arr</code> ï¼Œæ‰¾å‡ºå…¶ä¸­æœ€å°çš„ <code>k</code> ä¸ªæ•°ã€‚ä¾‹å¦‚ï¼Œè¾“å…¥4ã€5ã€1ã€6ã€2ã€7ã€3ã€8è¿™8ä¸ªæ•°å­—ï¼Œåˆ™æœ€å°çš„4ä¸ªæ•°å­—æ˜¯1ã€2ã€3ã€4ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šarr &#x3D; [3,2,1], k &#x3D; 2</span><br><span class="line">è¾“å‡ºï¼š[1,2] æˆ–è€… [2,1]</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šarr &#x3D; [0,1,2,1], k &#x3D; 1</span><br><span class="line">è¾“å‡ºï¼š[0]</span><br></pre></td></tr></table></figure><p><strong>é™åˆ¶ï¼š</strong></p><ul><li><code>0 &lt;= k &lt;= arr.length &lt;= 10000</code></li><li><code>0 &lt;= arr[i] &lt;= 10000</code></li></ul><p><strong>Solution</strong></p><p><strong><font color="F08000">æ–¹æ³•ä¸€ï¼šæ’åº</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">getLeastNumbers</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; arr, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        sort(arr.<span class="built_in">begin</span>(), arr.<span class="built_in">end</span>());</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; res;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; k; i++) &#123;</span><br><span class="line">            res.push_back(arr[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong> $O(n\log n)$ï¼Œå…¶ä¸­ n æ˜¯æ•°ç»„ arr çš„é•¿åº¦ã€‚ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦å³æ’åºçš„æ—¶é—´å¤æ‚åº¦ã€‚</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong> $O(\log n) $ï¼Œæ’åºæ‰€éœ€é¢å¤–çš„ç©ºé—´å¤æ‚åº¦ã€‚</p><hr><p><strong><font color="F08000">æ–¹æ³•äºŒï¼šå †</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">getLeastNumbers</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; arr, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">vec</span><span class="params">(k, <span class="number">0</span>)</span></span>;</span><br><span class="line">        <span class="keyword">if</span> (k == <span class="number">0</span>) &#123; <span class="comment">// æ’é™¤ 0 çš„æƒ…å†µ</span></span><br><span class="line">            <span class="keyword">return</span> vec;</span><br><span class="line">        &#125;</span><br><span class="line">        priority_queue&lt;<span class="keyword">int</span>&gt; Q;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; k; ++i) &#123;</span><br><span class="line">            Q.push(arr[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = k; i &lt; (<span class="keyword">int</span>)arr.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (Q.top() &gt; arr[i]) &#123;</span><br><span class="line">                Q.pop();</span><br><span class="line">                Q.push(arr[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; k; ++i) &#123;</span><br><span class="line">            vec[i] = Q.top();</span><br><span class="line">            Q.pop();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> vec;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>**æ—¶é—´å¤æ‚åº¦ï¼š **$O(n\log k)$ï¼Œå…¶ä¸­ n æ˜¯æ•°ç»„ arr çš„é•¿åº¦ã€‚ç”±äºå¤§æ ¹å †å®æ—¶ç»´æŠ¤å‰ k å°å€¼ï¼Œæ‰€ä»¥æ’å…¥åˆ é™¤éƒ½æ˜¯ $O(\log k)$ çš„æ—¶é—´å¤æ‚åº¦ï¼Œæœ€åæƒ…å†µä¸‹æ•°ç»„é‡Œ n ä¸ªæ•°éƒ½ä¼šæ’å…¥ï¼Œæ‰€ä»¥ä¸€å…±éœ€è¦ $O(n\log k)$ çš„æ—¶é—´å¤æ‚åº¦ã€‚</p><p>**ç©ºé—´å¤æ‚åº¦ï¼š **$O(k$)ï¼Œå› ä¸ºå¤§æ ¹å †é‡Œæœ€å¤š k ä¸ªæ•°ã€‚</p><hr><h3 id="å‰‘æŒ‡-Offer-41-æ•°æ®æµä¸­çš„ä¸­ä½æ•°"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-41-æ•°æ®æµä¸­çš„ä¸­ä½æ•°">Â¶</a><a href="https://leetcode-cn.com/problems/shu-ju-liu-zhong-de-zhong-wei-shu-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 41. æ•°æ®æµä¸­çš„ä¸­ä½æ•°</a></h3><p>Difficulty: <strong><font color="FF0000">å›°éš¾</font></strong></p><p>å¦‚ä½•å¾—åˆ°ä¸€ä¸ªæ•°æ®æµä¸­çš„ä¸­ä½æ•°ï¼Ÿå¦‚æœä»æ•°æ®æµä¸­è¯»å‡ºå¥‡æ•°ä¸ªæ•°å€¼ï¼Œé‚£ä¹ˆä¸­ä½æ•°å°±æ˜¯æ‰€æœ‰æ•°å€¼æ’åºä¹‹åä½äºä¸­é—´çš„æ•°å€¼ã€‚å¦‚æœä»æ•°æ®æµä¸­è¯»å‡ºå¶æ•°ä¸ªæ•°å€¼ï¼Œé‚£ä¹ˆä¸­ä½æ•°å°±æ˜¯æ‰€æœ‰æ•°å€¼æ’åºä¹‹åä¸­é—´ä¸¤ä¸ªæ•°çš„å¹³å‡å€¼ã€‚</p><p>ä¾‹å¦‚ï¼Œ</p><p>[2,3,4] çš„ä¸­ä½æ•°æ˜¯ 3</p><p>[2,3] çš„ä¸­ä½æ•°æ˜¯ (2 + 3) / 2 = 2.5</p><p>è®¾è®¡ä¸€ä¸ªæ”¯æŒä»¥ä¸‹ä¸¤ç§æ“ä½œçš„æ•°æ®ç»“æ„ï¼š</p><ul><li>void addNum(int num) - ä»æ•°æ®æµä¸­æ·»åŠ ä¸€ä¸ªæ•´æ•°åˆ°æ•°æ®ç»“æ„ä¸­ã€‚</li><li>double findMedian() - è¿”å›ç›®å‰æ‰€æœ‰å…ƒç´ çš„ä¸­ä½æ•°ã€‚</li></ul><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š</span><br><span class="line">[&quot;MedianFinder&quot;,&quot;addNum&quot;,&quot;addNum&quot;,&quot;findMedian&quot;,&quot;addNum&quot;,&quot;findMedian&quot;]</span><br><span class="line">[[],[1],[2],[],[3],[]]</span><br><span class="line">è¾“å‡ºï¼š[null,null,null,1.50000,null,2.00000]</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š</span><br><span class="line">[&quot;MedianFinder&quot;,&quot;addNum&quot;,&quot;findMedian&quot;,&quot;addNum&quot;,&quot;findMedian&quot;]</span><br><span class="line">[[],[2],[],[3],[]]</span><br><span class="line">è¾“å‡ºï¼š[null,null,2.00000,null,2.50000]</span><br></pre></td></tr></table></figure><p><strong>é™åˆ¶ï¼š</strong></p><ul><li>æœ€å¤šä¼šå¯¹ <code>addNumã€findMedian</code> è¿›è¡Œ <code>50000</code> æ¬¡è°ƒç”¨ã€‚</li></ul><p><strong>Solution</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MedianFinder</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/** initialize your data structure here. */</span></span><br><span class="line">    priority_queue&lt;<span class="keyword">int</span>&gt; A;  <span class="comment">// å¤§é¡¶å †</span></span><br><span class="line">    priority_queue&lt;<span class="keyword">int</span>, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;, greater&lt;<span class="keyword">int</span>&gt;&gt; B; <span class="comment">// å°é¡¶å †</span></span><br><span class="line">    MedianFinder() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addNum</span><span class="params">(<span class="keyword">int</span> num)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (A.<span class="built_in">size</span>() == B.<span class="built_in">size</span>()) &#123;</span><br><span class="line">            B.push(num);</span><br><span class="line">            <span class="keyword">int</span> temp = B.top();</span><br><span class="line">            B.pop();</span><br><span class="line">            A.push(temp);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            A.push(num);</span><br><span class="line">            <span class="keyword">int</span> temp = A.top();</span><br><span class="line">            A.pop();</span><br><span class="line">            B.push(temp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">findMedian</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> A.<span class="built_in">size</span>() == B.<span class="built_in">size</span>() ?(A.top() + B.top()) / <span class="number">2.0</span> : A.top();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><ul><li>æŸ¥æ‰¾ä¸­ä½æ•°ï¼š$O(1)$</li><li>æ·»åŠ æ•°å­—ï¼š$O(\log N)$</li></ul><p>**ç©ºé—´å¤æ‚åº¦ï¼š **$O(N)$ï¼Œå…¶ä¸­ N ä¸ºæ•°æ®æµä¸­çš„å…ƒç´ æ•°é‡ã€‚</p><hr><h3 id="å‰‘æŒ‡-Offer-45-æŠŠæ•°ç»„æ’æˆæœ€å°çš„æ•°"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-45-æŠŠæ•°ç»„æ’æˆæœ€å°çš„æ•°">Â¶</a><a href="https://leetcode-cn.com/problems/ba-shu-zu-pai-cheng-zui-xiao-de-shu-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 45. æŠŠæ•°ç»„æ’æˆæœ€å°çš„æ•°</a></h3><p>Difficulty: <strong><font color="F08000">ä¸­ç­‰</font></strong></p><p>è¾“å…¥ä¸€ä¸ªéè´Ÿæ•´æ•°æ•°ç»„ï¼ŒæŠŠæ•°ç»„é‡Œæ‰€æœ‰æ•°å­—æ‹¼æ¥èµ·æ¥æ’æˆä¸€ä¸ªæ•°ï¼Œæ‰“å°èƒ½æ‹¼æ¥å‡ºçš„æ‰€æœ‰æ•°å­—ä¸­æœ€å°çš„ä¸€ä¸ªã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: [10,2]</span><br><span class="line">è¾“å‡º: &quot;102&quot;</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: [3,30,34,5,9]</span><br><span class="line">è¾“å‡º: &quot;3033459&quot;</span><br></pre></td></tr></table></figure><p><strong>æç¤º:</strong></p><ul><li><code>0 &lt; nums.length &lt;= 100</code></li></ul><p><strong>è¯´æ˜:</strong></p><ul><li>è¾“å‡ºç»“æœå¯èƒ½éå¸¸å¤§ï¼Œæ‰€ä»¥ä½ éœ€è¦è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²è€Œä¸æ˜¯æ•´æ•°</li><li>æ‹¼æ¥èµ·æ¥çš„æ•°å­—å¯èƒ½ä¼šæœ‰å‰å¯¼ 0ï¼Œæœ€åç»“æœä¸éœ€è¦å»æ‰å‰å¯¼ 0</li></ul><p><strong>Solution</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">string</span> <span class="title">minNumber</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; vec;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; num : nums) &#123;</span><br><span class="line">            vec.push_back(to_string(num));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ’åºä¸­ä½¿ç”¨ lambda å‡½æ•°</span></span><br><span class="line">        sort(vec.<span class="built_in">begin</span>(), vec.<span class="built_in">end</span>(), [](<span class="keyword">const</span> <span class="built_in">string</span>&amp; A, <span class="keyword">const</span> <span class="built_in">string</span>&amp; B) &#123; <span class="keyword">return</span> A + B &lt; B + A; &#125; );</span><br><span class="line">        <span class="built_in">string</span> res = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; v : vec) &#123;</span><br><span class="line">            res += v;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong> $O(N\log N )$ï¼Œå…¶ä¸­ N ä¸ºæ•°ç»„é•¿åº¦ï¼Œæ—¶é—´å¤æ‚åº¦ä¸»è¦ä¸ºæ’åºç®—æ³•æ—¶é—´å¤æ‚åº¦</p><p>**ç©ºé—´å¤æ‚åº¦ï¼š **$O(N)$ï¼Œå­—ç¬¦ä¸²æ•°ç»„é¢å¤–ç©ºé—´</p><hr><h3 id="å‰‘æŒ‡-Offer-61-æ‰‘å…‹ç‰Œä¸­çš„é¡ºå­"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-61-æ‰‘å…‹ç‰Œä¸­çš„é¡ºå­">Â¶</a><a href="https://leetcode-cn.com/problems/bu-ke-pai-zhong-de-shun-zi-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 61. æ‰‘å…‹ç‰Œä¸­çš„é¡ºå­</a></h3><p>Difficulty: <strong><font color="008F00">ç®€å•</font></strong></p><p>ä»æ‰‘å…‹ç‰Œä¸­éšæœºæŠ½5å¼ ç‰Œï¼Œåˆ¤æ–­æ˜¯ä¸æ˜¯ä¸€ä¸ªé¡ºå­ï¼Œå³è¿™5å¼ ç‰Œæ˜¯ä¸æ˜¯è¿ç»­çš„ã€‚2ï½10ä¸ºæ•°å­—æœ¬èº«ï¼ŒAä¸º1ï¼ŒJä¸º11ï¼ŒQä¸º12ï¼ŒKä¸º13ï¼Œè€Œå¤§ã€å°ç‹ä¸º 0 ï¼Œå¯ä»¥çœ‹æˆä»»æ„æ•°å­—ã€‚A ä¸èƒ½è§†ä¸º 14ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: [1,2,3,4,5]</span><br><span class="line">è¾“å‡º: True</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: [0,0,1,2,5]</span><br><span class="line">è¾“å‡º: True</span><br></pre></td></tr></table></figure><p><strong>é™åˆ¶ï¼š</strong></p><p>æ•°ç»„é•¿åº¦ä¸º 5</p><p>æ•°ç»„çš„æ•°å–å€¼ä¸º [0, 13] .</p><p><strong>Solution</strong></p><p><strong><font color="F08000">æ–¹æ³•ä¸€ï¼šå“ˆå¸Œé›†åˆ</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">isStraight</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">set</span>&lt;<span class="keyword">int</span>&gt; s;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; num : nums) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœ num != 0 , ä¸æ˜¯å¤§å°ç‹çš„æƒ…å†µä¸‹</span></span><br><span class="line">            <span class="keyword">if</span> (num) &#123;</span><br><span class="line">                <span class="comment">// å‡ºç°é‡å¤ï¼Œåˆ™ä¸€å®šä¸æ˜¯é¡ºå­</span></span><br><span class="line">                <span class="keyword">if</span> (s.<span class="built_in">find</span>(num) != s.<span class="built_in">end</span>()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                <span class="comment">// æ²¡æœ‰å‡ºç°è¿‡ï¼Œåˆ™æ’å…¥åˆ°å“ˆå¸Œé›†åˆä¸­</span></span><br><span class="line">                s.insert(num);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// åœ¨é›†åˆéç©ºçš„æƒ…å†µä¸‹ï¼Œå¦‚æœå½“å‰é›†åˆæœ€å¤§æœ€å°å€¼å·®å€¼ &gt;= 5 </span></span><br><span class="line">            <span class="comment">// åˆ™è¯´æ˜ä¸å¯èƒ½å½¢æˆé¡ºå­ (0 å¹¶æ²¡æœ‰è¢«æ’å…¥)</span></span><br><span class="line">            <span class="keyword">if</span> (!s.empty() &amp;&amp; *s.rbegin() - *s.<span class="built_in">begin</span>() &gt;= <span class="number">5</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong> $O(1)$ï¼Œéå†é•¿åº¦ä¸º 5</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong> $O(1)$ï¼Œå“ˆå¸Œé›†åˆå¯èƒ½çš„æœ€å¤§é•¿åº¦ä¸º 5</p><hr><p><strong><font color="F08000">æ–¹æ³•äºŒï¼šæ’åº</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">isStraight</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> joker = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// æ’åºæ•°ç»„</span></span><br><span class="line">        sort(nums.<span class="built_in">begin</span>(), nums.<span class="built_in">end</span>());</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">            <span class="comment">// ç»Ÿè®¡å¤§å°ç‹æ•°é‡</span></span><br><span class="line">            <span class="keyword">if</span> (nums[i] == <span class="number">0</span>) joker++;</span><br><span class="line">            <span class="comment">// å¦‚æœé‡å¤ï¼Œåˆ™ä¸å¯èƒ½å‡ºç°é¡ºå­</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (nums[i] == nums[i + <span class="number">1</span>]) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æœ€å¤§ç‰Œ - æœ€å°ç‰Œ &lt; 5 åˆ™å¯æ„æˆé¡ºå­</span></span><br><span class="line">        <span class="keyword">return</span> nums[<span class="number">4</span>] - nums[joker] &lt; <span class="number">5</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong> $O(1)$ï¼Œéå†é•¿åº¦ä¸º 5ï¼Œæ‰€ä»¥æ’åºç®—æ³•åæ—¶é—´å¤æ‚åº¦ä»ç„¶æ˜¯ $O( 1)$</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong> $O(1)$ï¼Œå˜é‡ joker</p><hr><h3 id="å‚è€ƒèµ„æ–™"><a class="header-anchor" href="#å‚è€ƒèµ„æ–™">Â¶</a>å‚è€ƒèµ„æ–™</h3><blockquote><p><a href="https://leetcode-cn.com/leetbook/detail/illustration-of-algorithm/" target="_blank" rel="noopener">å›¾è§£ç®—æ³•æ•°æ®ç»“æ„ - LeetBook - åŠ›æ‰£ï¼ˆLeetCodeï¼‰å…¨çƒæå®¢æŒšçˆ±çš„æŠ€æœ¯æˆé•¿å¹³å° (leetcode-cn.com)</a></p><p><a href="https://leetcode-cn.com/" target="_blank" rel="noopener">åŠ›æ‰£ï¼ˆLeetCodeï¼‰å®˜ç½‘ - å…¨çƒæå®¢æŒšçˆ±çš„æŠ€æœ¯æˆé•¿å¹³å° (leetcode-cn.com)</a> å®˜æ–¹é¢˜è§£</p></blockquote><!-- rebuild by neat -->]]></content>
      <categories>
        <category>Data_Structure_and_Algorithm</category>
      </categories>
      <tags>
        <tag>æ’åº</tag>
      </tags>
  </entry>
  <entry>
    <title>å‰‘æŒ‡offer -- æœç´¢ä¸å›æº¯ç®—æ³•</title>
    <url>/Data_Structure_and_Algorithm/%E5%89%91%E6%8C%87offer/%E6%90%9C%E7%B4%A2%E4%B8%8E%E5%9B%9E%E6%BA%AF%E7%AE%97%E6%B3%95/</url>
    <content><![CDATA[<!-- build time:Tue Jun 22 2021 17:02:34 GMT+0800 (GMT+08:00) --><a id="more"></a><h2 id="å‰‘æŒ‡offer-â€“-æœç´¢ä¸å›æº¯ç®—æ³•"><a class="header-anchor" href="#å‰‘æŒ‡offer-â€“-æœç´¢ä¸å›æº¯ç®—æ³•">Â¶</a>å‰‘æŒ‡offer â€“ æœç´¢ä¸å›æº¯ç®—æ³•</h2><h3 id="å‰‘æŒ‡-Offer-12-çŸ©é˜µä¸­çš„è·¯å¾„"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-12-çŸ©é˜µä¸­çš„è·¯å¾„">Â¶</a><a href="https://leetcode-cn.com/problems/ju-zhen-zhong-de-lu-jing-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 12. çŸ©é˜µä¸­çš„è·¯å¾„</a></h3><p>Difficulty: <strong><font color="F08000">ä¸­ç­‰</font></strong></p><p>ç»™å®šä¸€ä¸ª <code>m x n</code> äºŒç»´å­—ç¬¦ç½‘æ ¼ <code>board</code> å’Œä¸€ä¸ªå­—ç¬¦ä¸²å•è¯ <code>word</code> ã€‚å¦‚æœ <code>word</code> å­˜åœ¨äºç½‘æ ¼ä¸­ï¼Œè¿”å› <code>true</code> ï¼›å¦åˆ™ï¼Œè¿”å› <code>false</code> ã€‚</p><p>å•è¯å¿…é¡»æŒ‰ç…§å­—æ¯é¡ºåºï¼Œé€šè¿‡ç›¸é‚»çš„å•å…ƒæ ¼å†…çš„å­—æ¯æ„æˆï¼Œå…¶ä¸­â€œç›¸é‚»â€å•å…ƒæ ¼æ˜¯é‚£äº›æ°´å¹³ç›¸é‚»æˆ–å‚ç›´ç›¸é‚»çš„å•å…ƒæ ¼ã€‚åŒä¸€ä¸ªå•å…ƒæ ¼å†…çš„å­—æ¯ä¸å…è®¸è¢«é‡å¤ä½¿ç”¨ã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨ä¸‹é¢çš„ 3Ã—4 çš„çŸ©é˜µä¸­åŒ…å«å•è¯ â€œABCCEDâ€ï¼ˆå•è¯ä¸­çš„å­—æ¯å·²æ ‡å‡ºï¼‰ã€‚</p><p><img src="https://assets.leetcode.com/uploads/2020/11/04/word2.jpg" alt></p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šboard &#x3D; [[&quot;A&quot;,&quot;B&quot;,&quot;C&quot;,&quot;E&quot;],[&quot;S&quot;,&quot;F&quot;,&quot;C&quot;,&quot;S&quot;],[&quot;A&quot;,&quot;D&quot;,&quot;E&quot;,&quot;E&quot;]], word &#x3D; &quot;ABCCED&quot;</span><br><span class="line">è¾“å‡ºï¼štrue</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šboard &#x3D; [[&quot;a&quot;,&quot;b&quot;],[&quot;c&quot;,&quot;d&quot;]], word &#x3D; &quot;abcd&quot;</span><br><span class="line">è¾“å‡ºï¼šfalse</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li><code>1 &lt;= board.length &lt;= 200</code></li><li><code>1 &lt;= board[i].length &lt;= 200</code></li><li><code>board</code> å’Œ <code>word</code> ä»…ç”±å¤§å°å†™è‹±æ–‡å­—æ¯ç»„æˆ</li></ul><p><strong>Solution</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> m = <span class="number">0</span>, n = <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">exist</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">char</span>&gt;&gt;&amp; board, <span class="built_in">string</span> <span class="keyword">word</span>)</span> </span>&#123;</span><br><span class="line">        m = board.<span class="built_in">size</span>();</span><br><span class="line">        n = board[<span class="number">0</span>].<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (verify(board, <span class="keyword">word</span>, i, j, <span class="number">0</span>)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">verify</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">char</span>&gt;&gt;&amp; board, <span class="built_in">string</span>&amp; <span class="keyword">word</span>, <span class="keyword">int</span> i, <span class="keyword">int</span> j, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è¶…å‡ºè¾¹ç•Œçš„è¯ç›´æ¥è¿”å› false</span></span><br><span class="line">        <span class="keyword">if</span> (i &lt; <span class="number">0</span> || i &gt;= m || j &lt; <span class="number">0</span> || j &gt;= n || board[i][j] != <span class="keyword">word</span>[k]) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">// å¦‚æœéå†åˆ°æ°å¥½é•¿åº¦ï¼Œä¸”å…ƒç´ ç›¸ç¬¦åˆåˆ™è¿”å› true</span></span><br><span class="line">        <span class="keyword">if</span> (k == <span class="keyword">word</span>.<span class="built_in">size</span>() - <span class="number">1</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="comment">// ä»£è¡¨å·²ç»è®¿é—®è¿‡ï¼Œéšä¾¿ä¸€ä¸ªéå­—æ¯çš„å­—ç¬¦å³å¯</span></span><br><span class="line">        board[i][j] = <span class="string">'0'</span>;</span><br><span class="line">        <span class="comment">// å‘å››ä¸ªæ–¹å‘è¿›è¡Œæœç´¢ï¼Œåªè¦æœ‰ä¸€æ–¹æ‰¾åˆ°å³å¯</span></span><br><span class="line">        <span class="keyword">bool</span> res = verify(board, <span class="keyword">word</span>, i + <span class="number">1</span>, j, k + <span class="number">1</span>) || </span><br><span class="line">                   verify(board, <span class="keyword">word</span>, i, j + <span class="number">1</span>, k + <span class="number">1</span>) ||</span><br><span class="line">                   verify(board, <span class="keyword">word</span>, i - <span class="number">1</span>, j, k + <span class="number">1</span>) ||</span><br><span class="line">                   verify(board, <span class="keyword">word</span>, i, j - <span class="number">1</span>, k + <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// å›æº¯æ—¶å€™å¡«å›æ•°å­—</span></span><br><span class="line">        board[i][j] = <span class="keyword">word</span>[k];</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong> $O(3^KMN)$ ï¼Œ æœ€å·®æƒ…å†µä¸‹ï¼Œéœ€è¦éå†çŸ©é˜µä¸­é•¿åº¦ä¸º K å­—ç¬¦ä¸²çš„æ‰€æœ‰æ–¹æ¡ˆï¼Œæ—¶é—´å¤æ‚åº¦ä¸º $O(3^K)$ï¼›çŸ©é˜µä¸­å…±æœ‰ $MN $ ä¸ªèµ·ç‚¹ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º $O(MN)$ã€‚</p><ul><li>æ–¹æ¡ˆæ•°è®¡ç®—ï¼š è®¾å­—ç¬¦ä¸²é•¿åº¦ä¸º KK ï¼Œæœç´¢ä¸­æ¯ä¸ªå­—ç¬¦æœ‰ä¸Šã€ä¸‹ã€å·¦ã€å³å››ä¸ªæ–¹å‘å¯ä»¥é€‰æ‹©ï¼Œèˆå¼ƒå›å¤´ï¼ˆä¸Šä¸ªå­—ç¬¦ï¼‰çš„æ–¹å‘ï¼Œå‰©ä¸‹ 3 ç§é€‰æ‹©ï¼Œå› æ­¤æ–¹æ¡ˆæ•°çš„å¤æ‚åº¦ä¸º $O(3^K)$ã€‚</li></ul><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong> $O(K)$ï¼Œ æœç´¢è¿‡ç¨‹ä¸­çš„é€’å½’æ·±åº¦ä¸è¶…è¿‡ K ï¼Œå› æ­¤ç³»ç»Ÿå› å‡½æ•°è°ƒç”¨ç´¯è®¡ä½¿ç”¨çš„æ ˆç©ºé—´å ç”¨ $O(K)$ï¼ˆå› ä¸ºå‡½æ•°è¿”å›åï¼Œç³»ç»Ÿè°ƒç”¨çš„æ ˆç©ºé—´ä¼šé‡Šæ”¾ï¼‰ã€‚æœ€åæƒ…å†µä¸‹ $K = MNK=MN$ ï¼Œé€’å½’æ·±åº¦ä¸º $MN$ ï¼Œæ­¤æ—¶ç³»ç»Ÿæ ˆä½¿ç”¨ $O(MN)$ çš„é¢å¤–ç©ºé—´ã€‚</p><hr><h3 id="å‰‘æŒ‡-Offer-13-æœºå™¨äººçš„è¿åŠ¨èŒƒå›´"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-13-æœºå™¨äººçš„è¿åŠ¨èŒƒå›´">Â¶</a><a href="https://leetcode-cn.com/problems/ji-qi-ren-de-yun-dong-fan-wei-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 13. æœºå™¨äººçš„è¿åŠ¨èŒƒå›´</a></h3><p>Difficulty: <strong><font color="F08000">ä¸­ç­‰</font></strong></p><p>åœ°ä¸Šæœ‰ä¸€ä¸ªmè¡Œnåˆ—çš„æ–¹æ ¼ï¼Œä»åæ ‡ <code>[0,0]</code> åˆ°åæ ‡ <code>[m-1,n-1]</code> ã€‚ä¸€ä¸ªæœºå™¨äººä»åæ ‡ <code>[0, 0]</code> çš„æ ¼å­å¼€å§‹ç§»åŠ¨ï¼Œå®ƒæ¯æ¬¡å¯ä»¥å‘å·¦ã€å³ã€ä¸Šã€ä¸‹ç§»åŠ¨ä¸€æ ¼ï¼ˆä¸èƒ½ç§»åŠ¨åˆ°æ–¹æ ¼å¤–ï¼‰ï¼Œä¹Ÿä¸èƒ½è¿›å…¥è¡Œåæ ‡å’Œåˆ—åæ ‡çš„æ•°ä½ä¹‹å’Œå¤§äºkçš„æ ¼å­ã€‚ä¾‹å¦‚ï¼Œå½“kä¸º18æ—¶ï¼Œæœºå™¨äººèƒ½å¤Ÿè¿›å…¥æ–¹æ ¼ [35, 37] ï¼Œå› ä¸º3+5+3+7=18ã€‚ä½†å®ƒä¸èƒ½è¿›å…¥æ–¹æ ¼ [35, 38]ï¼Œå› ä¸º3+5+3+8=19ã€‚è¯·é—®è¯¥æœºå™¨äººèƒ½å¤Ÿåˆ°è¾¾å¤šå°‘ä¸ªæ ¼å­ï¼Ÿ</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šm &#x3D; 2, n &#x3D; 3, k &#x3D; 1</span><br><span class="line">è¾“å‡ºï¼š3</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šm &#x3D; 3, n &#x3D; 1, k &#x3D; 0</span><br><span class="line">è¾“å‡ºï¼š1</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li><code>1 &lt;= n,m &lt;= 100</code></li><li><code>0 &lt;= k &lt;= 20</code></li></ul><p><strong>Solution</strong></p><p><strong><font color="F08F00">æ–¹æ³•ä¸€ï¼šDFS</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">movingCount</span><span class="params">(<span class="keyword">int</span> m, <span class="keyword">int</span> n, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">bool</span>&gt;&gt; <span class="title">visited</span><span class="params">(m, <span class="built_in">vector</span>&lt;<span class="keyword">bool</span>&gt;(n, <span class="literal">false</span>))</span></span>;</span><br><span class="line">        <span class="keyword">return</span> dfs(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, visited, m, n, k);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j, <span class="keyword">int</span> si, <span class="keyword">int</span> sj, <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">bool</span>&gt;&gt;&amp; visited, <span class="keyword">int</span> m, <span class="keyword">int</span> n, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å¦‚æœè¶Šç•Œï¼Œæˆ–è€…ä¸æ»¡è¶³æ•°ä½å¤§å°ä¹‹å’Œï¼Œæˆ–è€…å·²ç»è¢«è®¿é—®è¿‡ï¼Œåˆ™è¿”å› 0</span></span><br><span class="line">        <span class="keyword">if</span> (i &gt;= m || j &gt;= n || k &lt; si + sj || visited[i][j] == <span class="number">1</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// è®¿é—®è¯¥ç‚¹</span></span><br><span class="line">        visited[i][j] = <span class="literal">true</span>;</span><br><span class="line">                </span><br><span class="line">        <span class="keyword">int</span> a = (i + <span class="number">1</span>) % <span class="number">10</span> ? si + <span class="number">1</span> : si - <span class="number">8</span>;</span><br><span class="line">        <span class="keyword">int</span> b = (j + <span class="number">1</span>) % <span class="number">10</span> ? sj + <span class="number">1</span> : sj - <span class="number">8</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å…³äºä»¥ä¸Šä»£ç çš„ä¸€ä¸ªç®€å•çš„ä¾‹å­, </span></span><br><span class="line">        <span class="comment">// å…¶ä¸­çš„ si æ˜¯å½“å‰æ¨ªåæ ‡å„ä½ä¹‹å’Œ, s_(i+1) æ˜¯ä¸‹ç§»åæƒ…å†µä¸‹æ¨ªåæ ‡å„ä½ä¹‹å’Œ</span></span><br><span class="line">        <span class="comment">// 19 -&gt; 20  si = 10, s_(i+1) = 2, s_(i+1) = si - 8;</span></span><br><span class="line">        <span class="comment">// 18 -&gt; 19  si = 9, s_(i+1) = 10, s_(i+1) = si + 1;</span></span><br><span class="line">        </span><br><span class="line">                   </span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span> + dfs(i + <span class="number">1</span>, j, a, sj, visited, m, n, k)   <span class="comment">// ä¸‹ç§»</span></span><br><span class="line">                 + dfs(i, j + <span class="number">1</span>, si, b, visited, m, n, k);  <span class="comment">// å³ç§»</span></span><br><span class="line">                  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong><font color="F08F00">æ–¹æ³•äºŒï¼šBFS</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">movingCount</span><span class="params">(<span class="keyword">int</span> m, <span class="keyword">int</span> n, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">bool</span>&gt;&gt; <span class="title">visited</span><span class="params">(m, <span class="built_in">vector</span>&lt;<span class="keyword">bool</span>&gt;(n, <span class="number">0</span>))</span></span>;</span><br><span class="line">        <span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// æ¯æ¬¡ push æ˜¯ä¸€ä¸ª å››å…ƒç»„</span></span><br><span class="line">        <span class="built_in">queue</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; q;</span><br><span class="line">        q.push(&#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;);</span><br><span class="line">        <span class="keyword">while</span> (!q.empty()) &#123;</span><br><span class="line">            <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; x = q.front();</span><br><span class="line">            q.pop();</span><br><span class="line">            <span class="keyword">int</span> i = x[<span class="number">0</span>], j = x[<span class="number">1</span>], si = x[<span class="number">2</span>], sj = x[<span class="number">3</span>];</span><br><span class="line">            <span class="keyword">if</span> (i &gt;= m || j &gt;= n || k &lt; si + sj || visited[i][j]) <span class="keyword">continue</span>;</span><br><span class="line">            visited[i][j] = <span class="literal">true</span>;</span><br><span class="line">            res++;</span><br><span class="line">            q.push(&#123;i + <span class="number">1</span>, j, (i + <span class="number">1</span>) % <span class="number">10</span> ? si + <span class="number">1</span>: si - <span class="number">8</span>, sj&#125;);</span><br><span class="line">            q.push(&#123;i, j + <span class="number">1</span>, si, (j + <span class="number">1</span>) % <span class="number">10</span> ? sj + <span class="number">1</span>: sj - <span class="number">8</span>&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä¸¤ç§æ–¹æ³•æ—¶é—´å¤æ‚åº¦ï¼Œç©ºé—´å¤æ‚åº¦åˆ†æç›¸åŒã€‚</p><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong> $O(MN)$ ï¼Œæœ€å·®æƒ…å†µä¸‹ï¼Œæœºå™¨äººéå†çŸ©é˜µæ‰€æœ‰å•å…ƒæ ¼ï¼Œæ­¤æ—¶æ—¶é—´å¤æ‚åº¦ä¸º $O(MN)$ ã€‚<br><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong> $O(MN)$ï¼Œ æœ€å·®æƒ…å†µä¸‹ï¼Œè®¿é—®çŸ©é˜µå­˜å‚¨æ‰€æœ‰å•å…ƒæ ¼çš„ç´¢å¼•ï¼Œä½¿ç”¨ $O(MN)$ çš„é¢å¤–ç©ºé—´ã€‚</p><hr><h3 id="å‰‘æŒ‡-Offer-26-æ ‘çš„å­ç»“æ„"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-26-æ ‘çš„å­ç»“æ„">Â¶</a><a href="https://leetcode-cn.com/problems/shu-de-zi-jie-gou-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 26. æ ‘çš„å­ç»“æ„</a></h3><p>Difficulty: <strong><font color="F08000">ä¸­ç­‰</font></strong></p><p>è¾“å…¥ä¸¤æ£µäºŒå‰æ ‘Aå’ŒBï¼Œåˆ¤æ–­Bæ˜¯ä¸æ˜¯Açš„å­ç»“æ„ã€‚(çº¦å®šç©ºæ ‘ä¸æ˜¯ä»»æ„ä¸€ä¸ªæ ‘çš„å­ç»“æ„)</p><p>Bæ˜¯Açš„å­ç»“æ„ï¼Œ å³ Aä¸­æœ‰å‡ºç°å’ŒBç›¸åŒçš„ç»“æ„å’ŒèŠ‚ç‚¹å€¼ã€‚</p><p>ä¾‹å¦‚:<br>ç»™å®šçš„æ ‘ A:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">    3  </span><br><span class="line">   &#x2F; \  </span><br><span class="line">  4   5  </span><br><span class="line"> &#x2F; \  </span><br><span class="line">1   2</span><br></pre></td></tr></table></figure><p>ç»™å®šçš„æ ‘ Bï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">  4   </span><br><span class="line"> &#x2F;  </span><br><span class="line">1</span><br></pre></td></tr></table></figure><p>è¿”å› trueï¼Œå› ä¸º B ä¸ A çš„ä¸€ä¸ªå­æ ‘æ‹¥æœ‰ç›¸åŒçš„ç»“æ„å’ŒèŠ‚ç‚¹å€¼ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šA &#x3D; [1,2,3], B &#x3D; [3,1]</span><br><span class="line">è¾“å‡ºï¼šfalse</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šA &#x3D; [3,4,5,1,2], B &#x3D; [4,1]</span><br><span class="line">è¾“å‡ºï¼štrue</span><br></pre></td></tr></table></figure><p><strong>é™åˆ¶ï¼š</strong></p><p><code>0 &lt;= èŠ‚ç‚¹ä¸ªæ•° &lt;= 10000</code></p><p><strong>Solution</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(NULL), right(NULL) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">isSubStructure</span><span class="params">(TreeNode* A, TreeNode* B)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// true æ¡ä»¶ï¼š1. A B éƒ½ä¸ä¸ºç©º</span></span><br><span class="line">        <span class="comment">// 2. A æ˜¯æ ¹èŠ‚ç‚¹ï¼ŒBä¸ºå…¶å­æ ‘; B ä¸º A å·¦ï¼ˆå³ï¼‰å­æ ‘ä¸­çš„å­æ ‘</span></span><br><span class="line">        <span class="keyword">return</span> (A &amp;&amp; B) &amp;&amp; (recur(A, B) || isSubStructure(A-&gt;left, B) || isSubStructure(A-&gt;right, B));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">recur</span><span class="params">(TreeNode* A, TreeNode* B)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// B ç©ºåˆ™è¯´æ˜åˆ°åº•ï¼ŒæœŸé—´æ²¡æœ‰é”™è¯¯ï¼Œæ‰€ä»¥æ­£ç¡®</span></span><br><span class="line">        <span class="keyword">if</span> (!B) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="comment">// A ç©ºåˆ™è¯´æ˜ï¼ŒB æ²¡æœ‰æœç´¢åˆ°ï¼Œæˆ–è€… æœŸé—´æœç´¢é”™è¯¯ï¼Œéƒ½è¯´æ˜æœç´¢é”™è¯¯</span></span><br><span class="line">        <span class="keyword">if</span> (!A || A-&gt;val != B-&gt;val) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">// å·¦å­æ ‘å¯¹åº”å·¦å­æ ‘ï¼Œå³å­æ ‘å¯¹åº”å³å­æ ‘</span></span><br><span class="line">        <span class="keyword">return</span> recur(A-&gt;left, B-&gt;left) &amp;&amp; recur(A-&gt;right, B-&gt;right);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(MN)$ï¼Œ å…¶ä¸­ M, NM,N åˆ†åˆ«ä¸ºæ ‘ A å’Œ æ ‘ B çš„èŠ‚ç‚¹æ•°é‡ï¼›å…ˆåºéå†æ ‘ A å ç”¨ $O(M)$ ï¼Œæ¯æ¬¡è°ƒç”¨ recur(A, B) åˆ¤æ–­å ç”¨ $O(N)$ ã€‚<br><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong> $O(M)$ ï¼Œ å½“æ ‘ A å’Œæ ‘ B éƒ½é€€åŒ–ä¸ºé“¾è¡¨æ—¶ï¼Œé€’å½’è°ƒç”¨æ·±åº¦æœ€å¤§ã€‚å½“ $Mâ‰¤N$ æ—¶ï¼Œéå†æ ‘ A ä¸é€’å½’åˆ¤æ–­çš„æ€»é€’å½’æ·±åº¦ä¸º M ï¼›å½“ $M&gt;N$ æ—¶ï¼Œæœ€å·®æƒ…å†µä¸ºéå†è‡³æ ‘ A çš„å¶èŠ‚ç‚¹ï¼Œæ­¤æ—¶æ€»é€’å½’æ·±åº¦ä¸º Mã€‚</p><hr><h3 id="å‰‘æŒ‡-Offer-27-äºŒå‰æ ‘çš„é•œåƒ"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-27-äºŒå‰æ ‘çš„é•œåƒ">Â¶</a><a href="https://leetcode-cn.com/problems/er-cha-shu-de-jing-xiang-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 27. äºŒå‰æ ‘çš„é•œåƒ</a></h3><p>Difficulty: <strong><font color="008F00">ç®€å•</font></strong></p><p>è¯·å®Œæˆä¸€ä¸ªå‡½æ•°ï¼Œè¾“å…¥ä¸€ä¸ªäºŒå‰æ ‘ï¼Œè¯¥å‡½æ•°è¾“å‡ºå®ƒçš„é•œåƒã€‚</p><p>ä¾‹å¦‚è¾“å…¥ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">     4  </span><br><span class="line">   &#x2F;   \  </span><br><span class="line">  2     7  </span><br><span class="line"> &#x2F; \   &#x2F; \  </span><br><span class="line">1   3 6   9</span><br></pre></td></tr></table></figure><p>é•œåƒè¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">     4  </span><br><span class="line">   &#x2F;   \  </span><br><span class="line">  7     2  </span><br><span class="line"> &#x2F; \   &#x2F; \  </span><br><span class="line">9   6 3   1</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šroot &#x3D; [4,2,7,1,3,6,9]</span><br><span class="line">è¾“å‡ºï¼š[4,7,2,9,6,3,1]</span><br></pre></td></tr></table></figure><p><strong>é™åˆ¶ï¼š</strong></p><p><code>0 &lt;= èŠ‚ç‚¹ä¸ªæ•° &lt;= 1000</code></p><p><strong>Solution</strong></p><p><strong><font color="F08F00">æ–¹æ³•ä¸€ï¼šé€’å½’</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode() : val(0), left(nullptr), right(nullptr) &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(nullptr), right(nullptr) &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x, TreeNode *left, TreeNode *right) : val(x), left(left), right(right) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// å†™æ³•ä¸€</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">TreeNode* <span class="title">invertTree</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!root) <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">        swap(root-&gt;left, root-&gt;right);</span><br><span class="line">        invertTree(root-&gt;left);</span><br><span class="line">        invertTree(root-&gt;right);</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å†™æ³•äºŒ</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">TreeNode* <span class="title">invertTree</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dfs(root);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">TreeNode* <span class="title">dfs</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!root) <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">        TreeNode* node = <span class="keyword">new</span> TreeNode(root-&gt;val);</span><br><span class="line">        node-&gt;left = dfs(root-&gt;right);</span><br><span class="line">        node-&gt;right = dfs(root-&gt;left);</span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œ å…¶ä¸­ N ä¸ºäºŒå‰æ ‘çš„èŠ‚ç‚¹æ•°é‡ï¼Œå»ºç«‹äºŒå‰æ ‘é•œåƒéœ€è¦éå†æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚<br><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œ æœ€å·®æƒ…å†µä¸‹ï¼ˆå½“äºŒå‰æ ‘é€€åŒ–ä¸ºé“¾è¡¨ï¼‰ï¼Œé€’å½’æ—¶ç³»ç»Ÿéœ€ä½¿ç”¨ $O(N)$ å¤§å°çš„æ ˆç©ºé—´ã€‚</p><hr><p><strong><font color="F08F00">æ–¹æ³•äºŒï¼šè¿­ä»£</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">TreeNode* <span class="title">invertTree</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!root) <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">        <span class="built_in">stack</span>&lt;TreeNode*&gt; stk;</span><br><span class="line">        stk.push(root);</span><br><span class="line">        <span class="keyword">while</span> (!stk.empty()) &#123;</span><br><span class="line">            TreeNode* node = stk.top();</span><br><span class="line">            stk.pop();</span><br><span class="line">            swap(node-&gt;left, node-&gt;right);</span><br><span class="line">            <span class="keyword">if</span> (node-&gt;right) stk.push(node-&gt;right);</span><br><span class="line">            <span class="keyword">if</span> (node-&gt;left) stk.push(node-&gt;left);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œ å…¶ä¸­ N ä¸ºäºŒå‰æ ‘çš„èŠ‚ç‚¹æ•°é‡ï¼Œå»ºç«‹äºŒå‰æ ‘é•œåƒéœ€è¦éå†æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚<br><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(N) $ï¼Œ æœ€å·®æƒ…å†µä¸‹ï¼Œæ ˆ stack æœ€å¤šåŒæ—¶å­˜å‚¨ $\frac{N + 1}{2}$ ï¼Œå ç”¨ $O(N)$ é¢å¤–ç©ºé—´ã€‚</p><hr><h3 id="å‰‘æŒ‡-Offer-28-å¯¹ç§°çš„äºŒå‰æ ‘"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-28-å¯¹ç§°çš„äºŒå‰æ ‘">Â¶</a><a href="https://leetcode-cn.com/problems/dui-cheng-de-er-cha-shu-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 28. å¯¹ç§°çš„äºŒå‰æ ‘</a></h3><p>Difficulty: <strong><font color="008F00">ç®€å•</font></strong></p><p>è¯·å®ç°ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥åˆ¤æ–­ä¸€æ£µäºŒå‰æ ‘æ˜¯ä¸æ˜¯å¯¹ç§°çš„ã€‚å¦‚æœä¸€æ£µäºŒå‰æ ‘å’Œå®ƒçš„é•œåƒä¸€æ ·ï¼Œé‚£ä¹ˆå®ƒæ˜¯å¯¹ç§°çš„ã€‚</p><p>ä¾‹å¦‚ï¼ŒäºŒå‰æ ‘ [1,2,2,3,4,4,3] æ˜¯å¯¹ç§°çš„ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">    1  </span><br><span class="line">   &#x2F; \  </span><br><span class="line">  2   2  </span><br><span class="line"> &#x2F; \ &#x2F; \  </span><br><span class="line">3  4 4  3</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ä¸‹é¢è¿™ä¸ª [1,2,2,null,3,null,3] åˆ™ä¸æ˜¯é•œåƒå¯¹ç§°çš„:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">  1  </span><br><span class="line"> &#x2F; \  </span><br><span class="line">2   2  </span><br><span class="line"> \   \  </span><br><span class="line"> 3    3</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šroot &#x3D; [1,2,2,3,4,4,3]</span><br><span class="line">è¾“å‡ºï¼štrue</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šroot &#x3D; [1,2,2,null,3,null,3]</span><br><span class="line">è¾“å‡ºï¼šfalse</span><br></pre></td></tr></table></figure><p><strong>é™åˆ¶ï¼š</strong></p><p><code>0 &lt;= èŠ‚ç‚¹ä¸ªæ•° &lt;= 1000</code></p><p><strong>Solution</strong></p><p><strong><font color="F08F00">æ–¹æ³•ä¸€ï¼šé€’å½’</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(NULL), right(NULL) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">isSymmetric</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!root) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">return</span> judge(root-&gt;left, root-&gt;right);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">judge</span><span class="params">(TreeNode* l, TreeNode* r)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å¦‚æœä¸¤ä¸ªèŠ‚ç‚¹çš†ä¸ºç©ºï¼Œè¿”å› true</span></span><br><span class="line">        <span class="keyword">if</span> (!l &amp;&amp; !r) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="comment">// ä¸€ä¸ªèŠ‚ç‚¹ä¸ºç©ºï¼Œå¦ä¸€ä¸ªèŠ‚ç‚¹éç©ºï¼Œè¿”å› false</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (!l || !r) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    	<span class="comment">// æ•°å€¼ä¸åŒï¼Œè¿”å› false</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (l-&gt;val != r-&gt;val) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> judge(l-&gt;left, r-&gt;right) &amp;&amp; judge(l-&gt;right, r-&gt;left);</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œå…¶ä¸­ <em>N</em> ä¸ºäºŒå‰æ ‘çš„èŠ‚ç‚¹æ•°é‡ï¼Œæ¯æ¬¡æ‰§è¡Œ <code>judge()</code> å¯ä»¥åˆ¤æ–­ä¸€å¯¹èŠ‚ç‚¹æ˜¯å¦å¯¹ç§°ï¼Œå› æ­¤æœ€å¤šè°ƒç”¨ N*/2 æ¬¡ <code>judge()</code> æ–¹æ³•ã€‚<br><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œ æœ€å·®æƒ…å†µä¸‹ï¼ˆå½“äºŒå‰æ ‘é€€åŒ–ä¸ºé“¾è¡¨ï¼‰ï¼Œé€’å½’æ—¶ç³»ç»Ÿéœ€ä½¿ç”¨ $O(N)$ å¤§å°çš„æ ˆç©ºé—´ã€‚</p><hr><p><strong><font color="F08F00">æ–¹æ³•äºŒï¼šè¿­ä»£</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">isSymmetric</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>  (!root) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="built_in">queue</span>&lt;TreeNode*&gt; q;</span><br><span class="line">        q.push(root-&gt;left);</span><br><span class="line">        q.push(root-&gt;right);</span><br><span class="line">        <span class="keyword">while</span> (!q.empty()) &#123;</span><br><span class="line">            TreeNode* u = q.front();</span><br><span class="line">            q.pop();</span><br><span class="line">            TreeNode* v = q.front();</span><br><span class="line">            q.pop();</span><br><span class="line">            <span class="keyword">if</span> (!u &amp;&amp; !v) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span> ((!u || !v) || (u-&gt;val != v-&gt;val)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            q.push(u-&gt;left);</span><br><span class="line">            q.push(v-&gt;right);</span><br><span class="line">            q.push(u-&gt;right);</span><br><span class="line">            q.push(v-&gt;left);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š$O(N)$ï¼Œ å…¶ä¸­ N ä¸ºäºŒå‰æ ‘çš„èŠ‚ç‚¹æ•°é‡ï¼Œå»ºç«‹äºŒå‰æ ‘é•œåƒéœ€è¦éå†æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚<br><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š$O(N) $ï¼Œ è¿™é‡Œéœ€è¦ç”¨ä¸€ä¸ªé˜Ÿåˆ—æ¥ç»´æŠ¤èŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ€å¤šè¿›é˜Ÿä¸€æ¬¡ï¼Œå‡ºé˜Ÿä¸€æ¬¡ï¼Œé˜Ÿåˆ—ä¸­æœ€å¤šä¸ä¼šè¶…è¿‡ <em>n</em> ä¸ªç‚¹ï¼Œæ•…æ¸è¿›ç©ºé—´å¤æ‚åº¦ä¸º $O(N) $</p><hr><h3 id="å‰‘æŒ‡-Offer-32-I-ä»ä¸Šåˆ°ä¸‹æ‰“å°äºŒå‰æ ‘"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-32-I-ä»ä¸Šåˆ°ä¸‹æ‰“å°äºŒå‰æ ‘">Â¶</a><a href="https://leetcode-cn.com/problems/cong-shang-dao-xia-da-yin-er-cha-shu-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 32 - I. ä»ä¸Šåˆ°ä¸‹æ‰“å°äºŒå‰æ ‘</a></h3><p>Difficulty: <strong><font color="F08000">ä¸­ç­‰</font></strong></p><p>ä»ä¸Šåˆ°ä¸‹æ‰“å°å‡ºäºŒå‰æ ‘çš„æ¯ä¸ªèŠ‚ç‚¹ï¼ŒåŒä¸€å±‚çš„èŠ‚ç‚¹æŒ‰ç…§ä»å·¦åˆ°å³çš„é¡ºåºæ‰“å°ã€‚</p><p>ä¾‹å¦‚:<br>ç»™å®šäºŒå‰æ ‘: <code>[3,9,20,null,null,15,7]</code>,</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">  3</span><br><span class="line"> &#x2F; \</span><br><span class="line">9  20</span><br><span class="line">  &#x2F;  \</span><br><span class="line"> 15   7</span><br></pre></td></tr></table></figure><p>è¿”å›ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[3,9,20,15,7]</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ol><li><code>èŠ‚ç‚¹æ€»æ•° &lt;= 1000</code></li></ol><p><strong>Solution</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(NULL), right(NULL) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">levelOrder</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!root) <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; res;</span><br><span class="line">        <span class="built_in">queue</span>&lt;TreeNode*&gt; q;</span><br><span class="line">        q.push(root);</span><br><span class="line">        <span class="keyword">while</span> (!q.empty()) &#123;</span><br><span class="line">            <span class="keyword">int</span> <span class="built_in">size</span> = q.<span class="built_in">size</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">size</span>; i++) &#123;</span><br><span class="line">                TreeNode* node = q.front();</span><br><span class="line">                q.pop();</span><br><span class="line">                res.push_back(node-&gt;val);</span><br><span class="line">                <span class="keyword">if</span> (node-&gt;left) q.push(node-&gt;left);</span><br><span class="line">                <span class="keyword">if</span> (node-&gt;right) q.push(node-&gt;right);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="å‰‘æŒ‡-Offer-32-II-ä»ä¸Šåˆ°ä¸‹æ‰“å°äºŒå‰æ ‘-II"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-32-II-ä»ä¸Šåˆ°ä¸‹æ‰“å°äºŒå‰æ ‘-II">Â¶</a><a href="https://leetcode-cn.com/problems/cong-shang-dao-xia-da-yin-er-cha-shu-ii-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 32 - II. ä»ä¸Šåˆ°ä¸‹æ‰“å°äºŒå‰æ ‘ II</a></h3><p>Difficulty: <strong><font color="008F00">ç®€å•</font></strong></p><p>ä»ä¸Šåˆ°ä¸‹æŒ‰å±‚æ‰“å°äºŒå‰æ ‘ï¼ŒåŒä¸€å±‚çš„èŠ‚ç‚¹æŒ‰ä»å·¦åˆ°å³çš„é¡ºåºæ‰“å°ï¼Œæ¯ä¸€å±‚æ‰“å°åˆ°ä¸€è¡Œã€‚</p><p>ä¾‹å¦‚:<br>ç»™å®šäºŒå‰æ ‘: <code>[3,9,20,null,null,15,7]</code>,</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">  3</span><br><span class="line"> &#x2F; \</span><br><span class="line">9  20</span><br><span class="line">  &#x2F;  \</span><br><span class="line"> 15   7</span><br></pre></td></tr></table></figure><p>è¿”å›å…¶å±‚æ¬¡éå†ç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[</span><br><span class="line">  [3],</span><br><span class="line">  [9,20],</span><br><span class="line">  [15,7]</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ol><li><code>èŠ‚ç‚¹æ€»æ•° &lt;= 1000</code></li></ol><p><strong>Solution</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(NULL), right(NULL) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; <span class="title">levelOrder</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!root) <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; res;</span><br><span class="line">        <span class="built_in">queue</span>&lt;TreeNode*&gt; q;</span><br><span class="line">        q.push(root);</span><br><span class="line">        <span class="keyword">while</span> (!q.empty()) &#123;</span><br><span class="line">            <span class="keyword">int</span> <span class="built_in">size</span> = q.<span class="built_in">size</span>();</span><br><span class="line">            <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; path;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">size</span>; i++) &#123;</span><br><span class="line">                TreeNode* node = q.front();</span><br><span class="line">                q.pop();</span><br><span class="line">                path.push_back(node-&gt;val);</span><br><span class="line">                <span class="keyword">if</span> (node-&gt;left) q.push(node-&gt;left);</span><br><span class="line">                <span class="keyword">if</span> (node-&gt;right) q.push(node-&gt;right);</span><br><span class="line">            &#125;</span><br><span class="line">            res.push_back(path);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="å‰‘æŒ‡-Offer-32-III-ä»ä¸Šåˆ°ä¸‹æ‰“å°äºŒå‰æ ‘-III"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-32-III-ä»ä¸Šåˆ°ä¸‹æ‰“å°äºŒå‰æ ‘-III">Â¶</a><a href="https://leetcode-cn.com/problems/cong-shang-dao-xia-da-yin-er-cha-shu-iii-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 32 - III. ä»ä¸Šåˆ°ä¸‹æ‰“å°äºŒå‰æ ‘ III</a></h3><p>Difficulty: <strong><font color="F08000">ä¸­ç­‰</font></strong></p><p>è¯·å®ç°ä¸€ä¸ªå‡½æ•°æŒ‰ç…§ä¹‹å­—å½¢é¡ºåºæ‰“å°äºŒå‰æ ‘ï¼Œå³ç¬¬ä¸€è¡ŒæŒ‰ç…§ä»å·¦åˆ°å³çš„é¡ºåºæ‰“å°ï¼Œç¬¬äºŒå±‚æŒ‰ç…§ä»å³åˆ°å·¦çš„é¡ºåºæ‰“å°ï¼Œç¬¬ä¸‰è¡Œå†æŒ‰ç…§ä»å·¦åˆ°å³çš„é¡ºåºæ‰“å°ï¼Œå…¶ä»–è¡Œä»¥æ­¤ç±»æ¨ã€‚</p><p>ä¾‹å¦‚:<br>ç»™å®šäºŒå‰æ ‘: <code>[3,9,20,null,null,15,7]</code>,</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">  3</span><br><span class="line"> &#x2F; \</span><br><span class="line">9  20</span><br><span class="line">  &#x2F;  \</span><br><span class="line"> 15   7</span><br></pre></td></tr></table></figure><p>è¿”å›å…¶å±‚æ¬¡éå†ç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[</span><br><span class="line">  [3],</span><br><span class="line">  [20,9],</span><br><span class="line">  [15,7]</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ol><li><code>èŠ‚ç‚¹æ€»æ•° &lt;= 1000</code></li></ol><p><strong>Solution</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(NULL), right(NULL) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; <span class="title">levelOrder</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; res;</span><br><span class="line">        <span class="keyword">if</span> (!root) <span class="keyword">return</span> res;</span><br><span class="line">        <span class="built_in">queue</span>&lt;TreeNode*&gt; q;</span><br><span class="line">        q.push(root);</span><br><span class="line">        <span class="keyword">int</span> level = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!q.empty()) &#123;</span><br><span class="line">            <span class="keyword">int</span> <span class="built_in">size</span> = q.<span class="built_in">size</span>();</span><br><span class="line">            level++;</span><br><span class="line">            <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; path;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">size</span>; i++) &#123;</span><br><span class="line">                TreeNode* node = q.front();</span><br><span class="line">                q.pop();</span><br><span class="line">                path.push_back(node-&gt;val);</span><br><span class="line">                <span class="keyword">if</span> (node-&gt;left) q.push(node-&gt;left);</span><br><span class="line">                <span class="keyword">if</span> (node-&gt;right) q.push(node-&gt;right);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (level % <span class="number">2</span> == <span class="number">0</span>)</span><br><span class="line">                reverse(path.<span class="built_in">begin</span>(), path.<span class="built_in">end</span>());</span><br><span class="line">            res.push_back(path);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>å‰‘æŒ‡offer32</strong> 3 é“é¢˜ç›®æ—¶é—´ç©ºé—´å¤æ‚åº¦åˆ†æç›¸åŒ</p><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong> $O(N)$ï¼Œ N ä¸ºäºŒå‰æ ‘çš„èŠ‚ç‚¹æ•°é‡ï¼Œå³ BFS éœ€å¾ªç¯ N æ¬¡ã€‚<br><strong>ç©ºé—´å¤æ‚åº¦ ï¼š</strong>$O(N)$ï¼Œæœ€å·®æƒ…å†µä¸‹ï¼Œå³å½“æ ‘ä¸ºå¹³è¡¡äºŒå‰æ ‘æ—¶ï¼Œæœ€å¤šæœ‰ N/2 ä¸ªæ ‘èŠ‚ç‚¹åŒæ—¶åœ¨ queue ä¸­ï¼Œä½¿ç”¨ $O(N)$ å¤§å°çš„é¢å¤–ç©ºé—´ã€‚</p><hr><h3 id="å‰‘æŒ‡-Offer-34-äºŒå‰æ ‘ä¸­å’Œä¸ºæŸä¸€å€¼çš„è·¯å¾„"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-34-äºŒå‰æ ‘ä¸­å’Œä¸ºæŸä¸€å€¼çš„è·¯å¾„">Â¶</a><a href="https://leetcode-cn.com/problems/er-cha-shu-zhong-he-wei-mou-yi-zhi-de-lu-jing-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 34. äºŒå‰æ ‘ä¸­å’Œä¸ºæŸä¸€å€¼çš„è·¯å¾„</a></h3><p>Difficulty: <strong><font color="F08000">ä¸­ç­‰</font></strong></p><p>è¾“å…¥ä¸€æ£µäºŒå‰æ ‘å’Œä¸€ä¸ªæ•´æ•°ï¼Œæ‰“å°å‡ºäºŒå‰æ ‘ä¸­èŠ‚ç‚¹å€¼çš„å’Œä¸ºè¾“å…¥æ•´æ•°çš„æ‰€æœ‰è·¯å¾„ã€‚ä»æ ‘çš„æ ¹èŠ‚ç‚¹å¼€å§‹å¾€ä¸‹ä¸€ç›´åˆ°å¶èŠ‚ç‚¹æ‰€ç»è¿‡çš„èŠ‚ç‚¹å½¢æˆä¸€æ¡è·¯å¾„ã€‚</p><p><strong>ç¤ºä¾‹:</strong><br>ç»™å®šå¦‚ä¸‹äºŒå‰æ ‘ï¼Œä»¥åŠç›®æ ‡å’Œ <code>target = 22</code>ï¼Œ</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">      5</span><br><span class="line">     &#x2F; \</span><br><span class="line">    4   8</span><br><span class="line">   &#x2F;   &#x2F; \</span><br><span class="line">  11  13  4</span><br><span class="line"> &#x2F;  \    &#x2F; \</span><br><span class="line">7    2  5   1</span><br></pre></td></tr></table></figure><p>è¿”å›:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[</span><br><span class="line">   [5,4,11,2],</span><br><span class="line">   [5,8,4,5]</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ol><li><code>èŠ‚ç‚¹æ€»æ•° &lt;= 10000</code></li></ol><p><strong>Solution</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(NULL), right(NULL) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; <span class="title">pathSum</span><span class="params">(TreeNode* root, <span class="keyword">int</span> sum)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; path;</span><br><span class="line">        dfs(root, sum, path);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; res;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(TreeNode* root, <span class="keyword">int</span> sum, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; path)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!root) <span class="keyword">return</span>;</span><br><span class="line">        <span class="comment">// åªè¦ root éç©º</span></span><br><span class="line">        path.push_back(root-&gt;val);</span><br><span class="line">        sum -= root-&gt;val;</span><br><span class="line">        <span class="comment">// å¦‚æœå¤„ç†è¯¥èŠ‚ç‚¹åæ»¡è¶³ sum æ¡ä»¶ï¼Œä¸”æ˜¯å¶å­èŠ‚ç‚¹ï¼Œåˆ™æ‰¾åˆ°ä¸€ä¸ªæ•°å€¼</span></span><br><span class="line">        <span class="keyword">if</span> (sum == <span class="number">0</span> &amp;&amp; !root-&gt;left &amp;&amp; !root-&gt;right) &#123;</span><br><span class="line">            res.push_back(path);</span><br><span class="line">        &#125;</span><br><span class="line">        dfs(root-&gt;left, sum, path);</span><br><span class="line">        dfs(root-&gt;right, sum, path);</span><br><span class="line">        path.pop_back();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œ å…¶ä¸­ N ä¸ºäºŒå‰æ ‘çš„èŠ‚ç‚¹æ•°é‡ï¼Œéœ€è¦éå†æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚<br><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œ æœ€å·®æƒ…å†µä¸‹ï¼ˆå½“äºŒå‰æ ‘é€€åŒ–ä¸ºé“¾è¡¨ï¼‰ï¼Œpath å­˜å‚¨æ‰€æœ‰èŠ‚ç‚¹ï¼Œä½¿ç”¨é¢å¤– $O(N)$ ç©ºé—´</p><hr><h3 id="å‰‘æŒ‡-Offer-36-äºŒå‰æœç´¢æ ‘ä¸åŒå‘é“¾è¡¨"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-36-äºŒå‰æœç´¢æ ‘ä¸åŒå‘é“¾è¡¨">Â¶</a><a href="https://leetcode-cn.com/problems/er-cha-sou-suo-shu-yu-shuang-xiang-lian-biao-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 36. äºŒå‰æœç´¢æ ‘ä¸åŒå‘é“¾è¡¨</a></h3><p>Difficulty: <strong><font color="F08000">ä¸­ç­‰</font></strong></p><p>è¾“å…¥ä¸€æ£µäºŒå‰æœç´¢æ ‘ï¼Œå°†è¯¥äºŒå‰æœç´¢æ ‘è½¬æ¢æˆä¸€ä¸ªæ’åºçš„å¾ªç¯åŒå‘é“¾è¡¨ã€‚è¦æ±‚ä¸èƒ½åˆ›å»ºä»»ä½•æ–°çš„èŠ‚ç‚¹ï¼Œåªèƒ½è°ƒæ•´æ ‘ä¸­èŠ‚ç‚¹æŒ‡é’ˆçš„æŒ‡å‘ã€‚</p><p>ä¸ºäº†è®©æ‚¨æ›´å¥½åœ°ç†è§£é—®é¢˜ï¼Œä»¥ä¸‹é¢çš„äºŒå‰æœç´¢æ ‘ä¸ºä¾‹ï¼š</p><p><img src="https://assets.leetcode.com/uploads/2018/10/12/bstdlloriginalbst.png" alt></p><p>æˆ‘ä»¬å¸Œæœ›å°†è¿™ä¸ªäºŒå‰æœç´¢æ ‘è½¬åŒ–ä¸ºåŒå‘å¾ªç¯é“¾è¡¨ã€‚é“¾è¡¨ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªå‰é©±å’Œåç»§æŒ‡é’ˆã€‚å¯¹äºåŒå‘å¾ªç¯é“¾è¡¨ï¼Œç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„å‰é©±æ˜¯æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œæœ€åä¸€ä¸ªèŠ‚ç‚¹çš„åç»§æ˜¯ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚</p><p>ä¸‹å›¾å±•ç¤ºäº†ä¸Šé¢çš„äºŒå‰æœç´¢æ ‘è½¬åŒ–æˆçš„é“¾è¡¨ã€‚â€œheadâ€ è¡¨ç¤ºæŒ‡å‘é“¾è¡¨ä¸­æœ‰æœ€å°å…ƒç´ çš„èŠ‚ç‚¹ã€‚</p><p><img src="https://assets.leetcode.com/uploads/2018/10/12/bstdllreturndll.png" alt></p><p>ç‰¹åˆ«åœ°ï¼Œæˆ‘ä»¬å¸Œæœ›å¯ä»¥å°±åœ°å®Œæˆè½¬æ¢æ“ä½œã€‚å½“è½¬åŒ–å®Œæˆä»¥åï¼Œæ ‘ä¸­èŠ‚ç‚¹çš„å·¦æŒ‡é’ˆéœ€è¦æŒ‡å‘å‰é©±ï¼Œæ ‘ä¸­èŠ‚ç‚¹çš„å³æŒ‡é’ˆéœ€è¦æŒ‡å‘åç»§ã€‚è¿˜éœ€è¦è¿”å›é“¾è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆã€‚</p><p><strong>Solution</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">// Definition for a Node.</span></span><br><span class="line"><span class="comment">class Node &#123;</span></span><br><span class="line"><span class="comment">public:</span></span><br><span class="line"><span class="comment">    int val;</span></span><br><span class="line"><span class="comment">    Node* left;</span></span><br><span class="line"><span class="comment">    Node* right;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    Node() &#123;&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    Node(int _val) &#123;</span></span><br><span class="line"><span class="comment">        val = _val;</span></span><br><span class="line"><span class="comment">        left = NULL;</span></span><br><span class="line"><span class="comment">        right = NULL;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    Node(int _val, Node* _left, Node* _right) &#123;</span></span><br><span class="line"><span class="comment">        val = _val;</span></span><br><span class="line"><span class="comment">        left = _left;</span></span><br><span class="line"><span class="comment">        right = _right;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">&#125;;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">Node* <span class="title">treeToDoublyList</span><span class="params">(Node* root)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!root) <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">        recur(root);</span><br><span class="line">        <span class="comment">// é¦–å°¾ç›¸è¿ :  pre &lt;-- head,   pre --&gt; head;</span></span><br><span class="line">        head-&gt;left = pre;</span><br><span class="line">        pre-&gt;right = head;</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line">    Node* pre, head;</span><br><span class="line">    <span class="comment">//  ä¸­åºéå†</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">recur</span><span class="params">(Node* cur)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!cur) <span class="keyword">return</span>;</span><br><span class="line">        recur(cur-&gt;left);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å‰å‘å­˜åœ¨ï¼Œåˆ™ pre å³ä¸º cur : pre  --&gt; cur</span></span><br><span class="line">        <span class="keyword">if</span> (pre) pre-&gt;right = cur;</span><br><span class="line">        <span class="comment">// å¦åˆ™è¯´æ˜å½“å‰ cur ä¸ºä¸­åºéå†æœ€å·¦ä¾§å­èŠ‚ç‚¹ï¼Œä¹Ÿå³æ˜¯ head</span></span><br><span class="line">        <span class="keyword">else</span> head = cur;</span><br><span class="line">        <span class="comment">// ç¡®å®š cur çš„å·¦è¿æ¥ä¸º pre :  pre &lt;-- cur</span></span><br><span class="line">        cur-&gt;left = pre;</span><br><span class="line">        <span class="comment">// pre å‘åéå†</span></span><br><span class="line">        pre = cur;</span><br><span class="line">        </span><br><span class="line">        recur(cur-&gt;right);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;ï¼›</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œ å…¶ä¸­ N ä¸ºäºŒå‰æ ‘çš„èŠ‚ç‚¹æ•°é‡ï¼Œéœ€è¦éå†æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚<br><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œ æœ€å·®æƒ…å†µä¸‹ï¼ˆå½“äºŒå‰æ ‘é€€åŒ–ä¸ºé“¾è¡¨ï¼‰ï¼Œé€’å½’æ·±åº¦ Nï¼Œä½¿ç”¨ç³»ç»Ÿ $O(N)$ æ ˆç©ºé—´ã€‚</p><hr><h3 id="å‰‘æŒ‡-Offer-37-åºåˆ—åŒ–äºŒå‰æ ‘"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-37-åºåˆ—åŒ–äºŒå‰æ ‘">Â¶</a><a href="https://leetcode-cn.com/problems/xu-lie-hua-er-cha-shu-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 37. åºåˆ—åŒ–äºŒå‰æ ‘</a></h3><p>Difficulty: <strong><font color="FF0000">å›°éš¾</font></strong></p><p>è¯·å®ç°ä¸¤ä¸ªå‡½æ•°ï¼Œåˆ†åˆ«ç”¨æ¥åºåˆ—åŒ–å’Œååºåˆ—åŒ–äºŒå‰æ ‘ã€‚</p><p>**ç¤ºä¾‹: **</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ä½ å¯ä»¥å°†ä»¥ä¸‹äºŒå‰æ ‘ï¼š</span><br><span class="line"></span><br><span class="line">    1</span><br><span class="line">   &#x2F; \</span><br><span class="line">  2   3</span><br><span class="line">     &#x2F; \</span><br><span class="line">    4   5</span><br><span class="line"></span><br><span class="line">åºåˆ—åŒ–ä¸º &quot;[1,2,3,null,null,4,5]&quot;</span><br></pre></td></tr></table></figure><p><strong>Solution</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(NULL), right(NULL) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Codec</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// Encodes a tree to a single string.</span></span><br><span class="line">    <span class="function"><span class="built_in">string</span> <span class="title">serialize</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæ ¹èŠ‚ç‚¹ä¸ºç©ºåˆ™è¯´æ˜è¿”å› "[]"</span></span><br><span class="line">        <span class="comment">// å±‚æ¬¡éå†æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">if</span> (!root) <span class="keyword">return</span> <span class="string">"[]"</span>;</span><br><span class="line">        <span class="built_in">queue</span>&lt;TreeNode*&gt; que;</span><br><span class="line">        que.push(root);</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–å…ˆé”®å…¥ [</span></span><br><span class="line">        <span class="built_in">string</span> data&#123;<span class="string">"["</span>&#125;;</span><br><span class="line">        <span class="keyword">while</span> (!que.empty()) &#123;</span><br><span class="line">            TreeNode* node = que.front();</span><br><span class="line">            que.pop();</span><br><span class="line">            <span class="comment">// å¦‚æœå½“å‰èŠ‚ç‚¹å­˜åœ¨çš„è¯</span></span><br><span class="line">            <span class="keyword">if</span>(node) &#123;</span><br><span class="line">                <span class="comment">// é”®å…¥ val,</span></span><br><span class="line">                data.append(to_string(node-&gt;val));</span><br><span class="line">                data.append(<span class="string">","</span>);</span><br><span class="line">                <span class="comment">// é”®å…¥ å·¦å³èŠ‚ç‚¹ï¼Œæ˜¯å¦ä¸ºç©ºä¸ç”¨åˆ¤æ–­</span></span><br><span class="line">                que.push(node-&gt;left);</span><br><span class="line">                que.push(node-&gt;right);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœä¸ºç©ºï¼Œè¾“å…¥ null, å³å¯</span></span><br><span class="line">                data.append(<span class="string">"null,"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ‰¾åˆ°æœ€åæ˜¯æ•°å­—çš„ä½ç½®</span></span><br><span class="line">        <span class="keyword">size_t</span> post = data.find_last_of(<span class="string">"0123456789"</span>);</span><br><span class="line">        <span class="comment">// æˆªå–æ‰€éœ€å­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯å»é™¤å¤šæ·»åŠ çš„ null,</span></span><br><span class="line">        data = data.substr(<span class="number">0</span>, post + <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// æœ«å°¾æ·»åŠ  ]</span></span><br><span class="line">        data.append(<span class="string">"]"</span>);</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Decodes your encoded data to tree.</span></span><br><span class="line">    <span class="function">TreeNode* <span class="title">deserialize</span><span class="params">(<span class="built_in">string</span> data)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæ¥å—çš„å­—ç¬¦ä¸²ä¸º [] åˆ™è¯´æ˜ä¸ºç©º</span></span><br><span class="line">        <span class="keyword">if</span>(data == <span class="string">"[]"</span>) <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">        <span class="comment">// å» "[ ]"</span></span><br><span class="line">        <span class="keyword">size_t</span> len = data.<span class="built_in">size</span>();</span><br><span class="line">        data = data.substr(<span class="number">1</span>, len - <span class="number">2</span>);</span><br><span class="line">        <span class="comment">// æå– data ä¸­æ‰€éœ€çš„å­—ç¬¦ï¼Œä¹Ÿå³æ˜¯å»é™¤ ','</span></span><br><span class="line">        <span class="comment">// æ‰€éœ€å­—ç¬¦å­˜äº vector&lt;string&gt; ä¸­</span></span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; vec;</span><br><span class="line">        <span class="comment">// ç”¨äºè®°å½•ä¸­é—´å˜é‡</span></span><br><span class="line">        <span class="built_in">string</span> temp;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; data.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">            <span class="comment">// é‡åˆ° ',' åˆ™å­˜å…¥ä¸€æ¬¡ string</span></span><br><span class="line">            <span class="keyword">if</span> (data[i] == <span class="string">','</span>) &#123;</span><br><span class="line">                vec.push_back(temp);</span><br><span class="line">                temp = <span class="string">""</span>;</span><br><span class="line">            <span class="comment">// åˆ°è¾¾æœ«å°¾ï¼Œä¹Ÿè¿›è¡Œå­˜å…¥ string æ“ä½œ</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i == data.<span class="built_in">size</span>() - <span class="number">1</span>) &#123;</span><br><span class="line">                temp += data[i];</span><br><span class="line">                vec.push_back(temp);</span><br><span class="line">                temp = <span class="string">""</span>;</span><br><span class="line">            <span class="comment">// é™¤æ­¤ä¹‹å¤–ï¼Œåªè¦æ›´æ–° string å³å¯</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                temp += data[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// é¦–å…ˆç°æ ¹æ® vec[0] åˆ›å»ºæ ¹èŠ‚ç‚¹</span></span><br><span class="line">        TreeNode* root = <span class="keyword">new</span> TreeNode(stoi(vec[<span class="number">0</span>]));</span><br><span class="line">        <span class="built_in">queue</span>&lt;TreeNode*&gt; que;</span><br><span class="line">        que.push(root);</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.empty()) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœ null çš„è¯ä¼šé€æ¸çš„è¢« pop å‡º</span></span><br><span class="line">            TreeNode* node = que.front();</span><br><span class="line">            que.pop();</span><br><span class="line">            <span class="comment">// ä¸æ˜¯ nullï¼Œå…ˆåˆ›å»ºå·¦èŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">if</span> (i &lt; vec.<span class="built_in">size</span>() &amp;&amp; vec[i] != <span class="string">"null"</span>) &#123;</span><br><span class="line">                node-&gt;left = <span class="keyword">new</span> TreeNode(stoi(vec[i]));</span><br><span class="line">                que.push(node-&gt;left);</span><br><span class="line">            &#125;</span><br><span class="line">            i++;</span><br><span class="line">            <span class="comment">// ååˆ›å»ºå³èŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">if</span> (i &lt; vec.<span class="built_in">size</span>() &amp;&amp; vec[i] != <span class="string">"null"</span>) &#123;</span><br><span class="line">                node-&gt;right = <span class="keyword">new</span> TreeNode(stoi(vec[i]));</span><br><span class="line">                que.push(node-&gt;right);</span><br><span class="line">            &#125;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Your Codec object will be instantiated and called as such:</span></span><br><span class="line"><span class="comment">// Codec codec;</span></span><br><span class="line"><span class="comment">// codec.deserialize(codec.serialize(root));</span></span><br></pre></td></tr></table></figure><p>åºåˆ—åŒ–ï¼Œååºåˆ—åŒ–æ—¶é—´ç©ºé—´å¤æ‚åº¦ç›¸åŒã€‚å…¶ä¸­ N ä¸ºå¯èƒ½çš„èŠ‚ç‚¹æ•°ã€‚</p><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong> $O(N)$</p><p><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š$O(N)$</p><hr><h3 id="å‰‘æŒ‡-Offer-38-å­—ç¬¦ä¸²çš„æ’åˆ—"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-38-å­—ç¬¦ä¸²çš„æ’åˆ—">Â¶</a><a href="https://leetcode-cn.com/problems/zi-fu-chuan-de-pai-lie-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 38. å­—ç¬¦ä¸²çš„æ’åˆ—</a></h3><p>Difficulty: <strong><font color="F08000">ä¸­ç­‰</font></strong></p><p>è¾“å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ‰“å°å‡ºè¯¥å­—ç¬¦ä¸²ä¸­å­—ç¬¦çš„æ‰€æœ‰æ’åˆ—ã€‚</p><p>ä½ å¯ä»¥ä»¥ä»»æ„é¡ºåºè¿”å›è¿™ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œä½†é‡Œé¢ä¸èƒ½æœ‰é‡å¤å…ƒç´ ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šs &#x3D; &quot;abc&quot;</span><br><span class="line">è¾“å‡ºï¼š[&quot;abc&quot;,&quot;acb&quot;,&quot;bac&quot;,&quot;bca&quot;,&quot;cab&quot;,&quot;cba&quot;]</span><br></pre></td></tr></table></figure><p><strong>é™åˆ¶ï¼š</strong></p><p><code>1 &lt;= s çš„é•¿åº¦ &lt;= 8</code></p><p><strong>Solution</strong></p><p><strong><font color="F08F00">æ–¹æ³•ä¸€ï¼šå¸¸è§„å›æº¯</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¯¥æ–¹æ³•éå†æ‰€æœ‰å¯èƒ½ï¼Œæœ€ååœ¨è¾“å…¥çš„æ—¶å€™é€šè¿‡å†ä¸€æ¬¡çš„æŸ¥æ‰¾é‡å¤é¡¹æ¥å»é‡ï¼Œä¼šè¶…æ—¶ ï¼</span></span><br><span class="line"><span class="comment">// è¯¥æ–¹æ³•ä½¿ç”¨äº†è®°å¿†åŒ–ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ç”¨æ¥å»é‡ï¼Œè€Œæ˜¯é¿å…é‡å¤é€‰æ‹©ä½¿ç”¨åŒä¸€ä¸ªä½ç½®å…ƒç´ è€Œå·²</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; res;</span><br><span class="line">    <span class="built_in">string</span> path;</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; <span class="title">permutation</span><span class="params">(<span class="built_in">string</span> s)</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">bool</span>&gt; <span class="title">visited</span><span class="params">(s.<span class="built_in">size</span>(), <span class="literal">false</span>)</span></span>;</span><br><span class="line">        backtracking(s, visited);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">backtracking</span><span class="params">(<span class="built_in">string</span> s, <span class="built_in">vector</span>&lt;<span class="keyword">bool</span>&gt;&amp; visited)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (path.<span class="built_in">size</span>() == s.<span class="built_in">size</span>()) &#123;</span><br><span class="line">            <span class="comment">// é€šè¿‡æŸ¥æ‰¾æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨é‡å¤é¡¹</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">find</span>(res.<span class="built_in">begin</span>(), res.<span class="built_in">end</span>()) == res.<span class="built_in">end</span>()) &#123;</span><br><span class="line">                res.push_back();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ¯æ¬¡éƒ½éå†å…¨éƒ¨é•¿åº¦</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (visited[i]) <span class="keyword">continue</span>;</span><br><span class="line">            visited[i] = <span class="literal">true</span>;</span><br><span class="line">            path += s[i];</span><br><span class="line">            backtracking(s, visited);</span><br><span class="line">            path.pop_back();</span><br><span class="line">            visited[i] = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong><font color="F08F00">æ–¹æ³•äºŒï¼šè®°å¿†åŒ–å›æº¯</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; res;</span><br><span class="line">    <span class="built_in">string</span> path;</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; <span class="title">permutation</span><span class="params">(<span class="built_in">string</span> s)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// éœ€è¦æå‰æ’åº</span></span><br><span class="line">        sort(s.<span class="built_in">begin</span>(), s.<span class="built_in">end</span>());</span><br><span class="line">        <span class="keyword">int</span> len = s.<span class="built_in">size</span>();</span><br><span class="line">        <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">bool</span>&gt; <span class="title">visited</span><span class="params">(len)</span></span>;</span><br><span class="line">        backtracking(s, visited);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">backtracking</span><span class="params">(<span class="keyword">const</span> <span class="built_in">string</span>&amp; s, <span class="built_in">vector</span>&lt;<span class="keyword">bool</span>&gt;&amp; visited)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (path.<span class="built_in">size</span>() == s.<span class="built_in">size</span>()) &#123;</span><br><span class="line">            res.push_back(path);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            <span class="comment">// å…³é”®åœ¨äºåŒå±‚å»é‡ï¼Œå¯ä»¥å‰ªæï¼Œå…·ä½“è¯¦è§å¤‡æ³¨</span></span><br><span class="line">            <span class="keyword">if</span> (i &gt; <span class="number">0</span> &amp;&amp; s[i - <span class="number">1</span>] == s[i] &amp;&amp; visited[i - <span class="number">1</span>] == <span class="literal">false</span>) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span> (!visited[i]) &#123;</span><br><span class="line">                path += s[i];</span><br><span class="line">                visited[i] = <span class="literal">true</span>;</span><br><span class="line">                backtracking(s, visited);</span><br><span class="line">                visited[i] = <span class="literal">false</span>;</span><br><span class="line">                path.pop_back();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong><font color="FF8888">å¤‡æ³¨</font></strong> ï¼šcarl å¤§ä½¬å†™çš„ä¸¤ç¯‡ç›¸å…³æ–‡ç« ï¼Œæ„Ÿå—é¢‡æ·±ï¼</p><p><strong>å»é‡æ€è·¯</strong>ï¼š<a href="https://mp.weixin.qq.com/s?__biz=MzUxNjY5NTYxNA==&amp;mid=2247485360&amp;idx=1&amp;sn=2256a0f01a304d82a2b59252327f3edb&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">å›æº¯ç®—æ³•ï¼šæ±‚ç»„åˆæ€»å’Œï¼ˆä¸‰ï¼‰</a></p><p><strong>æ ‘å±‚ä¸Šå»é‡ï¼Œä¸æ ‘æä¸Šå»é‡çš„åŒºåˆ«</strong>ï¼š<a href="https://mp.weixin.qq.com/s?__biz=MzUxNjY5NTYxNA==&amp;mid=2247485514&amp;idx=1&amp;sn=29aa5828c0847fe39d2ea90804fba69e&amp;chksm=f9a23b1bced5b20d3b7b6e5502ad229e4be53cee7c9b3047c0fc23d595ea7cad03d407ccf789&amp;scene=178&amp;cur_album_id=1607983171550167042#rd" target="_blank" rel="noopener">å›æº¯ç®—æ³•ï¼šæ’åˆ—é—®é¢˜ï¼ˆäºŒï¼‰ (qq.com)</a></p><hr><p><strong><font color="F08F00">æ–¹æ³•ä¸‰ï¼šäº¤æ¢æ€æƒ³æ±‚å–æ’åˆ—</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; <span class="title">permutation</span><span class="params">(<span class="built_in">string</span> s)</span> </span>&#123;</span><br><span class="line">        dfs(s, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; res;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="built_in">string</span> s, <span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(x == s.<span class="built_in">size</span>() - <span class="number">1</span>) &#123;</span><br><span class="line">            res.push_back(s);                       <span class="comment">// æ·»åŠ æ’åˆ—æ–¹æ¡ˆ</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">set</span>&lt;<span class="keyword">int</span>&gt; st;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = x; i &lt; s.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(st.<span class="built_in">find</span>(s[i]) != st.<span class="built_in">end</span>()) <span class="keyword">continue</span>; <span class="comment">// é‡å¤ï¼Œå› æ­¤å‰ªæ</span></span><br><span class="line">            st.insert(s[i]);</span><br><span class="line">            swap(s[i], s[x]);                       <span class="comment">// äº¤æ¢ï¼Œå°† s[i] å›ºå®šåœ¨ç¬¬ x ä½</span></span><br><span class="line">            dfs(s, x + <span class="number">1</span>);                          <span class="comment">// å¼€å¯å›ºå®šç¬¬ x + 1 ä½å­—ç¬¦</span></span><br><span class="line">            swap(s[i], s[x]);                       <span class="comment">// æ¢å¤äº¤æ¢</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><img src="/Data_Structure_and_Algorithm/%E5%89%91%E6%8C%87offer/%E6%90%9C%E7%B4%A2%E4%B8%8E%E5%9B%9E%E6%BA%AF%E7%AE%97%E6%B3%95/å­—ç¬¦ä¸²çš„æ’åˆ—æ—¶é—´ç©ºé—´å¤æ‚åº¦.png" style="zoom:67%"><hr><h3 id="å‰‘æŒ‡-Offer-54-äºŒå‰æœç´¢æ ‘çš„ç¬¬kå¤§èŠ‚ç‚¹"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-54-äºŒå‰æœç´¢æ ‘çš„ç¬¬kå¤§èŠ‚ç‚¹">Â¶</a><a href="https://leetcode-cn.com/problems/er-cha-sou-suo-shu-de-di-kda-jie-dian-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 54. äºŒå‰æœç´¢æ ‘çš„ç¬¬kå¤§èŠ‚ç‚¹</a></h3><p>Difficulty: <strong><font color="008F00">ç®€å•</font></strong></p><p>ç»™å®šä¸€æ£µäºŒå‰æœç´¢æ ‘ï¼Œè¯·æ‰¾å‡ºå…¶ä¸­ç¬¬kå¤§çš„èŠ‚ç‚¹ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: root &#x3D; [3,1,4,null,2], k &#x3D; 1</span><br><span class="line">   3</span><br><span class="line">  &#x2F; \</span><br><span class="line"> 1   4</span><br><span class="line">  \</span><br><span class="line">   2</span><br><span class="line">è¾“å‡º: 4</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: root &#x3D; [5,3,6,2,4,null,null,1], k &#x3D; 3</span><br><span class="line">       5</span><br><span class="line">      &#x2F; \</span><br><span class="line">     3   6</span><br><span class="line">    &#x2F; \</span><br><span class="line">   2   4</span><br><span class="line">  &#x2F;</span><br><span class="line"> 1</span><br><span class="line">è¾“å‡º: 4</span><br></pre></td></tr></table></figure><p><strong>é™åˆ¶ï¼š</strong></p><p>1 â‰¤ k â‰¤ äºŒå‰æœç´¢æ ‘å…ƒç´ ä¸ªæ•°</p><p><strong>Solution</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(NULL), right(NULL) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">kthLargest</span><span class="params">(TreeNode* root, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        count = k;</span><br><span class="line">        dfs(root);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> res = <span class="number">0</span>, count = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// äºŒå‰æœç´¢æ ‘çš„ä¸­åºéå†ä¸ºé€’å¢åºåˆ—ï¼Œæ‰€ä»¥åå‘ä¸­åºéå†å¯ä»¥è·å¾—é€’å‡åºåˆ—</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!root) <span class="keyword">return</span>;</span><br><span class="line">        dfs(root-&gt;right);</span><br><span class="line">        count--;</span><br><span class="line">        <span class="keyword">if</span> (!count) &#123;</span><br><span class="line">            res = root-&gt;val;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        dfs(root-&gt;left);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="å‰‘æŒ‡-Offer-55-I-äºŒå‰æ ‘çš„æ·±åº¦"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-55-I-äºŒå‰æ ‘çš„æ·±åº¦">Â¶</a><a href="https://leetcode-cn.com/problems/er-cha-shu-de-shen-du-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 55 - I. äºŒå‰æ ‘çš„æ·±åº¦</a></h3><p>Difficulty: <strong><font color="008F00">ç®€å•</font></strong></p><p>è¾“å…¥ä¸€æ£µäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œæ±‚è¯¥æ ‘çš„æ·±åº¦ã€‚ä»æ ¹èŠ‚ç‚¹åˆ°å¶èŠ‚ç‚¹ä¾æ¬¡ç»è¿‡çš„èŠ‚ç‚¹ï¼ˆå«æ ¹ã€å¶èŠ‚ç‚¹ï¼‰å½¢æˆæ ‘çš„ä¸€æ¡è·¯å¾„ï¼Œæœ€é•¿è·¯å¾„çš„é•¿åº¦ä¸ºæ ‘çš„æ·±åº¦ã€‚</p><p>ä¾‹å¦‚ï¼š</p><p>ç»™å®šäºŒå‰æ ‘ <code>[3,9,20,null,null,15,7]</code>ï¼Œ</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">  3</span><br><span class="line"> &#x2F; \</span><br><span class="line">9  20</span><br><span class="line">  &#x2F;  \</span><br><span class="line"> 15   7</span><br></pre></td></tr></table></figure><p>è¿”å›å®ƒçš„æœ€å¤§æ·±åº¦ 3 ã€‚</p><p><strong>æç¤ºï¼š</strong></p><ol><li><code>èŠ‚ç‚¹æ€»æ•° &lt;= 10000</code></li></ol><p><strong>Solution</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(NULL), right(NULL) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxDepth</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!root) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span> + <span class="built_in">max</span>(maxDepth(root-&gt;left), maxDepth(root-&gt;right));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ ï¼š</strong>$O(N)$ï¼Œ N ä¸ºæ ‘çš„èŠ‚ç‚¹æ•°é‡ï¼Œè®¡ç®—æ ‘çš„æ·±åº¦éœ€è¦éå†æ‰€æœ‰èŠ‚ç‚¹ã€‚<br><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œ æœ€å·®æƒ…å†µä¸‹ï¼ˆå½“æ ‘é€€åŒ–ä¸ºé“¾è¡¨æ—¶ï¼‰ï¼Œé€’å½’æ·±åº¦å¯è¾¾åˆ° N ã€‚</p><hr><h3 id="å‰‘æŒ‡-Offer-55-II-å¹³è¡¡äºŒå‰æ ‘"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-55-II-å¹³è¡¡äºŒå‰æ ‘">Â¶</a><a href="https://leetcode-cn.com/problems/ping-heng-er-cha-shu-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 55 - II. å¹³è¡¡äºŒå‰æ ‘</a></h3><p>Difficulty: <strong><font color="008F00">ç®€å•</font></strong></p><p>è¾“å…¥ä¸€æ£µäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œåˆ¤æ–­è¯¥æ ‘æ˜¯ä¸æ˜¯å¹³è¡¡äºŒå‰æ ‘ã€‚å¦‚æœæŸäºŒå‰æ ‘ä¸­ä»»æ„èŠ‚ç‚¹çš„å·¦å³å­æ ‘çš„æ·±åº¦ç›¸å·®ä¸è¶…è¿‡1ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€æ£µå¹³è¡¡äºŒå‰æ ‘ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><p>ç»™å®šäºŒå‰æ ‘ <code>[3,9,20,null,null,15,7]</code></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">  3</span><br><span class="line"> &#x2F; \</span><br><span class="line">9  20</span><br><span class="line">  &#x2F;  \</span><br><span class="line"> 15   7</span><br></pre></td></tr></table></figure><p>è¿”å› <code>true</code> ã€‚</p><p><strong>ç¤ºä¾‹ 2:</strong></p><p>ç»™å®šäºŒå‰æ ‘ <code>[1,2,2,3,3,null,null,4,4]</code></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">      1</span><br><span class="line">     &#x2F; \</span><br><span class="line">    2   2</span><br><span class="line">   &#x2F; \</span><br><span class="line">  3   3</span><br><span class="line"> &#x2F; \</span><br><span class="line">4   4</span><br></pre></td></tr></table></figure><p>è¿”å› <code>false</code> ã€‚</p><p><strong>é™åˆ¶ï¼š</strong></p><ul><li><code>0 &lt;= æ ‘çš„ç»“ç‚¹ä¸ªæ•° &lt;= 10000</code></li></ul><p><strong>Solution</strong></p><p><strong><font color="F08F00">æ–¹æ³•ä¸€ï¼šå…ˆåºéå† + åˆ¤æ–­æ·±åº¦</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(NULL), right(NULL) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">isBalanced</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!root) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">abs</span>(dfs(root-&gt;left) - dfs(root-&gt;right)) &lt;= <span class="number">1</span> &amp;&amp; isBalanced(root-&gt;left) &amp;&amp; isBalanced(root-&gt;right);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">dfs</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!root) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">max</span>(dfs(root-&gt;left), dfs(root-&gt;right)) + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="/Data_Structure_and_Algorithm/%E5%89%91%E6%8C%87offer/%E6%90%9C%E7%B4%A2%E4%B8%8E%E5%9B%9E%E6%BA%AF%E7%AE%97%E6%B3%95/%E5%B9%B3%E8%A1%A1%E4%BA%8C%E5%8F%89%E6%A0%91%E6%96%B9%E6%B3%95%E4%B8%80%E6%97%B6%E9%97%B4%E7%A9%BA%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6%E5%88%86%E6%9E%90.png" alt></p><hr><p><strong><font color="F08F00">æ–¹æ³•äºŒï¼šååºéå† + å‰ªæ</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(NULL), right(NULL) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">isBalanced</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!root) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">return</span> getDep(root) != <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getDep</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!root) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> left = getDep(root-&gt;left);</span><br><span class="line">        <span class="keyword">if</span> (left == <span class="number">-1</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">int</span> right = getDep(root-&gt;right);</span><br><span class="line">        <span class="keyword">if</span> (right == <span class="number">-1</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">abs</span>(left - right) &gt; <span class="number">1</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> <span class="built_in">max</span>(left, right) + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ ï¼š</strong>$O(N)$ï¼Œ N ä¸ºæ ‘çš„èŠ‚ç‚¹æ•°é‡ï¼Œè®¡ç®—æ ‘çš„æ·±åº¦éœ€è¦éå†æ‰€æœ‰èŠ‚ç‚¹ã€‚<br><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œ æœ€å·®æƒ…å†µä¸‹ï¼ˆå½“æ ‘é€€åŒ–ä¸ºé“¾è¡¨æ—¶ï¼‰ï¼Œé€’å½’æ·±åº¦å¯è¾¾åˆ° N ã€‚</p><hr><h3 id="å‰‘æŒ‡-Offer-64-æ±‚1-2-â€¦-n"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-64-æ±‚1-2-â€¦-n">Â¶</a><a href="https://leetcode-cn.com/problems/qiu-12n-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 64. æ±‚1+2+â€¦+n</a></h3><p>Difficulty: <strong><font color="F08000">ä¸­ç­‰</font></strong></p><p>æ±‚ <code>1+2+...+n</code> ï¼Œè¦æ±‚ä¸èƒ½ä½¿ç”¨ä¹˜é™¤æ³•ã€forã€whileã€ifã€elseã€switchã€caseç­‰å…³é”®å­—åŠæ¡ä»¶åˆ¤æ–­è¯­å¥ï¼ˆA?B:Cï¼‰ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: n &#x3D; 3</span><br><span class="line">è¾“å‡º: 6</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: n &#x3D; 9</span><br><span class="line">è¾“å‡º: 45</span><br></pre></td></tr></table></figure><p><strong>é™åˆ¶ï¼š</strong></p><ul><li><code>1 &lt;= n &lt;= 10000</code></li></ul><p><strong>Solution</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">sumNums</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// åˆ©ç”¨é—¨ç”µè·¯å®ç°åˆ¤æ–­è¯­å¥</span></span><br><span class="line">        n &gt; <span class="number">1</span> &amp;&amp; (n += sumNums(n - <span class="number">1</span>));</span><br><span class="line">        <span class="keyword">return</span> n;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(n) $ï¼Œ è®¡ç®— $n + (n-1) + â€¦ + 2 + 1n+(nâˆ’1)+â€¦+2+1$ éœ€è¦å¼€å¯ n ä¸ªé€’å½’å‡½æ•°ã€‚<br><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong> $O(n)$ï¼Œ é€’å½’æ·±åº¦è¾¾åˆ° n ï¼Œç³»ç»Ÿä½¿ç”¨ $O(n)$ å¤§å°çš„é¢å¤–ç©ºé—´ã€‚</p><hr><h3 id="å‰‘æŒ‡-Offer-68-I-äºŒå‰æœç´¢æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-68-I-äºŒå‰æœç´¢æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ">Â¶</a><a href="https://leetcode-cn.com/problems/er-cha-sou-suo-shu-de-zui-jin-gong-gong-zu-xian-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 68 - I. äºŒå‰æœç´¢æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ</a></h3><p>Difficulty: <strong><font color="008F00">ç®€å•</font></strong></p><p>ç»™å®šä¸€ä¸ªäºŒå‰æœç´¢æ ‘, æ‰¾åˆ°è¯¥æ ‘ä¸­ä¸¤ä¸ªæŒ‡å®šèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚</p><p>ä¸­æœ€è¿‘å…¬å…±ç¥–å…ˆçš„å®šä¹‰ä¸ºï¼šâ€œå¯¹äºæœ‰æ ¹æ ‘ T çš„ä¸¤ä¸ªç»“ç‚¹ pã€qï¼Œæœ€è¿‘å…¬å…±ç¥–å…ˆè¡¨ç¤ºä¸ºä¸€ä¸ªç»“ç‚¹ xï¼Œæ»¡è¶³ x æ˜¯ pã€q çš„ç¥–å…ˆä¸” x çš„æ·±åº¦å°½å¯èƒ½å¤§ï¼ˆ<strong>ä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿå¯ä»¥æ˜¯å®ƒè‡ªå·±çš„ç¥–å…ˆ</strong>ï¼‰ã€‚â€</p><p>ä¾‹å¦‚ï¼Œç»™å®šå¦‚ä¸‹äºŒå‰æœç´¢æ ‘: root = [6,2,8,0,4,7,9,null,null,3,5]</p><p><img src="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2018/12/14/binarysearchtree_improved.png" alt></p><p><strong>ç¤ºä¾‹ 1:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: root &#x3D; [6,2,8,0,4,7,9,null,null,3,5], p &#x3D; 2, q &#x3D; 8</span><br><span class="line">è¾“å‡º: 6 </span><br><span class="line">è§£é‡Š: èŠ‚ç‚¹ 2 å’ŒèŠ‚ç‚¹ 8 çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ˜¯ 6ã€‚</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: root &#x3D; [6,2,8,0,4,7,9,null,null,3,5], p &#x3D; 2, q &#x3D; 4</span><br><span class="line">è¾“å‡º: 2</span><br><span class="line">è§£é‡Š: èŠ‚ç‚¹ 2 å’ŒèŠ‚ç‚¹ 4 çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ˜¯ 2, å› ä¸ºæ ¹æ®å®šä¹‰æœ€è¿‘å…¬å…±ç¥–å…ˆèŠ‚ç‚¹å¯ä»¥ä¸ºèŠ‚ç‚¹æœ¬èº«ã€‚</span><br></pre></td></tr></table></figure><p><strong>è¯´æ˜:</strong></p><ul><li>æ‰€æœ‰èŠ‚ç‚¹çš„å€¼éƒ½æ˜¯å”¯ä¸€çš„ã€‚</li><li>pã€q ä¸ºä¸åŒèŠ‚ç‚¹ä¸”å‡å­˜åœ¨äºç»™å®šçš„äºŒå‰æœç´¢æ ‘ä¸­ã€‚</li></ul><p><strong>Solution</strong></p><p><strong><font color="F08F00">æ–¹æ³•ä¸€ï¼šé€’å½’</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(NULL), right(NULL) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">TreeNode* <span class="title">lowestCommonAncestor</span><span class="params">(TreeNode* root, TreeNode* p, TreeNode* q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!root || root == p || root == q) <span class="keyword">return</span> root;</span><br><span class="line">        <span class="keyword">if</span> (root-&gt;val &gt; p-&gt;val &amp;&amp; root-&gt;val &gt; q-&gt;val) &#123;</span><br><span class="line">            <span class="keyword">return</span> lowestCommonAncestor(root-&gt;left, p, q);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (root-&gt;val &lt; p-&gt;val &amp;&amp; root-&gt;val &lt; q-&gt;val) &#123;</span><br><span class="line">            <span class="keyword">return</span> lowestCommonAncestor(root-&gt;right, p, q);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong> $O(N)$ ï¼Œå…¶ä¸­ N ä¸ºäºŒå‰æ ‘èŠ‚ç‚¹æ•°ï¼›æ¯å¾ªç¯ä¸€è½®æ’é™¤ä¸€å±‚ï¼ŒäºŒå‰æœç´¢æ ‘çš„å±‚æ•°æœ€å°ä¸º $\log N$ï¼ˆæ»¡äºŒå‰æ ‘ï¼‰ï¼Œæœ€å¤§ä¸º N ï¼ˆé€€åŒ–ä¸ºé“¾è¡¨ï¼‰ã€‚<br><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong> $O(N)$ ï¼Œ æœ€å·®æƒ…å†µä¸‹ï¼Œå³æ ‘é€€åŒ–ä¸ºé“¾è¡¨æ—¶ï¼Œé€’å½’æ·±åº¦è¾¾åˆ°æ ‘çš„å±‚æ•° N ã€‚</p><hr><p><strong><font color="F08F00">æ–¹æ³•äºŒï¼šè¿­ä»£</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">TreeNode* <span class="title">lowestCommonAncestor</span><span class="params">(TreeNode* root, TreeNode* p, TreeNode* q)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// æå‰æ¯”è¾ƒpå’Œqçš„å¤§å°ï¼Œå¯ä»¥ä½¿å¾—åœ¨å¾ªç¯ä¸­å¯å‡å°‘åˆ¤æ–­æ¡ä»¶ï¼Œæå‡è®¡ç®—æ•ˆç‡ </span></span><br><span class="line">        <span class="keyword">if</span>(p-&gt;val &gt; q-&gt;val)</span><br><span class="line">            swap(p, q);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span>(root != <span class="literal">nullptr</span>) &#123;</span><br><span class="line">            <span class="comment">// p,q éƒ½åœ¨ root çš„å³å­æ ‘ä¸­</span></span><br><span class="line">            <span class="comment">// if(root-&gt;val &lt; p-&gt;val &amp;&amp; root-&gt;val &lt; q-&gt;val) </span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span>(root-&gt;val &lt; p-&gt;val) <span class="comment">// p,q éƒ½åœ¨ root çš„å³å­æ ‘ä¸­</span></span><br><span class="line">                root = root-&gt;right; <span class="comment">// éå†è‡³å³å­èŠ‚ç‚¹</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// p,q éƒ½åœ¨ root çš„å·¦å­æ ‘ä¸­</span></span><br><span class="line">            <span class="comment">// else if(root-&gt;val &gt; p-&gt;val &amp;&amp; root-&gt;val &gt; q-&gt;val)</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(root-&gt;val &gt; q-&gt;val) <span class="comment">// p,q éƒ½åœ¨ root çš„å·¦å­æ ‘ä¸­</span></span><br><span class="line">                root = root-&gt;left; <span class="comment">// éå†è‡³å·¦å­èŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong> $O(N)$ ï¼Œå…¶ä¸­ N ä¸ºäºŒå‰æ ‘èŠ‚ç‚¹æ•°ï¼›æ¯å¾ªç¯ä¸€è½®æ’é™¤ä¸€å±‚ï¼ŒäºŒå‰æœç´¢æ ‘çš„å±‚æ•°æœ€å°ä¸º $\log N$ï¼ˆæ»¡äºŒå‰æ ‘ï¼‰ï¼Œæœ€å¤§ä¸º N ï¼ˆé€€åŒ–ä¸ºé“¾è¡¨ï¼‰ã€‚<br><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong> $O(1)$ ï¼Œä½¿ç”¨å¸¸æ•°å¤§å°çš„é¢å¤–ç©ºé—´ã€‚</p><hr><h3 id="å‰‘æŒ‡-Offer-68-II-äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-68-II-äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ">Â¶</a><a href="https://leetcode-cn.com/problems/er-cha-shu-de-zui-jin-gong-gong-zu-xian-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 68 - II. äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ</a></h3><p>Difficulty: <strong><font color="008F00">ç®€å•</font></strong></p><p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘, æ‰¾åˆ°è¯¥æ ‘ä¸­ä¸¤ä¸ªæŒ‡å®šèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚</p><p>ä¸­æœ€è¿‘å…¬å…±ç¥–å…ˆçš„å®šä¹‰ä¸ºï¼šâ€œå¯¹äºæœ‰æ ¹æ ‘ T çš„ä¸¤ä¸ªç»“ç‚¹ pã€qï¼Œæœ€è¿‘å…¬å…±ç¥–å…ˆè¡¨ç¤ºä¸ºä¸€ä¸ªç»“ç‚¹ xï¼Œæ»¡è¶³ x æ˜¯ pã€q çš„ç¥–å…ˆä¸” x çš„æ·±åº¦å°½å¯èƒ½å¤§ï¼ˆ<strong>ä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿå¯ä»¥æ˜¯å®ƒè‡ªå·±çš„ç¥–å…ˆ</strong>ï¼‰ã€‚â€</p><p>ä¾‹å¦‚ï¼Œç»™å®šå¦‚ä¸‹äºŒå‰æ ‘: root = [3,5,1,6,2,0,8,null,null,7,4]</p><p><img src="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2018/12/15/binarytree.png" alt></p><p><strong>ç¤ºä¾‹ 1:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: root &#x3D; [3,5,1,6,2,0,8,null,null,7,4], p &#x3D; 5, q &#x3D; 1</span><br><span class="line">è¾“å‡º: 3</span><br><span class="line">è§£é‡Š: èŠ‚ç‚¹ 5 å’ŒèŠ‚ç‚¹ 1 çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ˜¯èŠ‚ç‚¹ 3ã€‚</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: root &#x3D; [3,5,1,6,2,0,8,null,null,7,4], p &#x3D; 5, q &#x3D; 4</span><br><span class="line">è¾“å‡º: 5</span><br><span class="line">è§£é‡Š: èŠ‚ç‚¹ 5 å’ŒèŠ‚ç‚¹ 4 çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ˜¯èŠ‚ç‚¹ 5ã€‚å› ä¸ºæ ¹æ®å®šä¹‰æœ€è¿‘å…¬å…±ç¥–å…ˆèŠ‚ç‚¹å¯ä»¥ä¸ºèŠ‚ç‚¹æœ¬èº«ã€‚</span><br></pre></td></tr></table></figure><p><strong>è¯´æ˜:</strong></p><ul><li>æ‰€æœ‰èŠ‚ç‚¹çš„å€¼éƒ½æ˜¯å”¯ä¸€çš„ã€‚</li><li>pã€q ä¸ºä¸åŒèŠ‚ç‚¹ä¸”å‡å­˜åœ¨äºç»™å®šçš„äºŒå‰æ ‘ä¸­ã€‚</li></ul><p><strong>Solution</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(NULL), right(NULL) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">TreeNode* <span class="title">lowestCommonAncestor</span><span class="params">(TreeNode* root, TreeNode* p, TreeNode* q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!root || p == root || q == root) <span class="keyword">return</span> root;</span><br><span class="line"></span><br><span class="line">        TreeNode* left = lowestCommonAncestor(root-&gt;left, p , q);</span><br><span class="line">        TreeNode* right = lowestCommonAncestor(root-&gt;right, p , q);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!left) <span class="keyword">return</span> right;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (!right) <span class="keyword">return</span> left;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ ï¼š</strong>$O(N)$ï¼Œ N ä¸ºæ ‘çš„èŠ‚ç‚¹æ•°é‡ï¼Œè®¡ç®—æ ‘çš„æ·±åº¦éœ€è¦éå†æ‰€æœ‰èŠ‚ç‚¹ã€‚<br><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(N)$ï¼Œ æœ€å·®æƒ…å†µä¸‹ï¼ˆå½“æ ‘é€€åŒ–ä¸ºé“¾è¡¨æ—¶ï¼‰ï¼Œé€’å½’æ·±åº¦å¯è¾¾åˆ° N ã€‚</p><hr><h3 id="å‚è€ƒèµ„æ–™"><a class="header-anchor" href="#å‚è€ƒèµ„æ–™">Â¶</a>å‚è€ƒèµ„æ–™</h3><blockquote><p><a href="https://leetcode-cn.com/leetbook/detail/illustration-of-algorithm/" target="_blank" rel="noopener">å›¾è§£ç®—æ³•æ•°æ®ç»“æ„ - LeetBook - åŠ›æ‰£ï¼ˆLeetCodeï¼‰å…¨çƒæå®¢æŒšçˆ±çš„æŠ€æœ¯æˆé•¿å¹³å° (leetcode-cn.com)</a></p><p><a href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzUxNjY5NTYxNA==&amp;action=getalbum&amp;album_id=1485825793120387074&amp;scene=173&amp;from_msgid=2247485360&amp;from_itemidx=1&amp;count=3&amp;nolastread=1#wechat_redirect" target="_blank" rel="noopener">#æ•°æ®ç»“æ„ä¸ç®—æ³• (qq.com)</a></p><p><a href="https://leetcode-cn.com/" target="_blank" rel="noopener">åŠ›æ‰£ï¼ˆLeetCodeï¼‰å®˜ç½‘ - å…¨çƒæå®¢æŒšçˆ±çš„æŠ€æœ¯æˆé•¿å¹³å° (leetcode-cn.com)</a> å®˜æ–¹é¢˜è§£</p></blockquote><!-- rebuild by neat -->]]></content>
      <categories>
        <category>Data_Structure_and_Algorithm</category>
      </categories>
      <tags>
        <tag>æœç´¢ä¸å›æº¯ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>å‰‘æŒ‡offer -- ä½è¿ç®—</title>
    <url>/Data_Structure_and_Algorithm/%E5%89%91%E6%8C%87offer/%E4%BD%8D%E8%BF%90%E7%AE%97/</url>
    <content><![CDATA[<!-- build time:Tue Jun 22 2021 17:02:33 GMT+0800 (GMT+08:00) --><a id="more"></a><h2 id="å‰‘æŒ‡offer-â€“-ä½è¿ç®—"><a class="header-anchor" href="#å‰‘æŒ‡offer-â€“-ä½è¿ç®—">Â¶</a>å‰‘æŒ‡offer â€“ ä½è¿ç®—</h2><h3 id="å‰‘æŒ‡-Offer-15-äºŒè¿›åˆ¶ä¸­1çš„ä¸ªæ•°"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-15-äºŒè¿›åˆ¶ä¸­1çš„ä¸ªæ•°">Â¶</a><a href="https://leetcode-cn.com/problems/er-jin-zhi-zhong-1de-ge-shu-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 15. äºŒè¿›åˆ¶ä¸­1çš„ä¸ªæ•°</a></h3><p>Difficulty: <strong><font color="008F00">ç®€å•</font></strong></p><p>è¯·å®ç°ä¸€ä¸ªå‡½æ•°ï¼Œè¾“å…¥ä¸€ä¸ªæ•´æ•°ï¼ˆä»¥äºŒè¿›åˆ¶ä¸²å½¢å¼ï¼‰ï¼Œè¾“å‡ºè¯¥æ•°äºŒè¿›åˆ¶è¡¨ç¤ºä¸­ 1 çš„ä¸ªæ•°ã€‚ä¾‹å¦‚ï¼ŒæŠŠ 9 è¡¨ç¤ºæˆäºŒè¿›åˆ¶æ˜¯ 1001ï¼Œæœ‰ 2 ä½æ˜¯ 1ã€‚å› æ­¤ï¼Œå¦‚æœè¾“å…¥ 9ï¼Œåˆ™è¯¥å‡½æ•°è¾“å‡º 2ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š00000000000000000000000000001011</span><br><span class="line">è¾“å‡ºï¼š3</span><br><span class="line">è§£é‡Šï¼šè¾“å…¥çš„äºŒè¿›åˆ¶ä¸² 00000000000000000000000000001011 ä¸­ï¼Œå…±æœ‰ä¸‰ä½ä¸º &#39;1&#39;ã€‚</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š00000000000000000000000010000000</span><br><span class="line">è¾“å‡ºï¼š1</span><br><span class="line">è§£é‡Šï¼šè¾“å…¥çš„äºŒè¿›åˆ¶ä¸² 00000000000000000000000010000000 ä¸­ï¼Œå…±æœ‰ä¸€ä½ä¸º &#39;1&#39;ã€‚</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š11111111111111111111111111111101</span><br><span class="line">è¾“å‡ºï¼š31</span><br><span class="line">è§£é‡Šï¼šè¾“å…¥çš„äºŒè¿›åˆ¶ä¸² 11111111111111111111111111111101 ä¸­ï¼Œå…±æœ‰ 31 ä½ä¸º &#39;1&#39;ã€‚</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li>è¾“å…¥å¿…é¡»æ˜¯é•¿åº¦ä¸º <code>32</code> çš„ <strong>äºŒè¿›åˆ¶ä¸²</strong> ã€‚</li></ul><p><strong>Solution</strong></p><p><strong><font color="F0800F">æ–¹æ³•ä¸€ï¼šé€ä½è¿ç®—</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">hammingWeight</span><span class="params">(<span class="keyword">uint32_t</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> sum = <span class="number">0</span>;  </span><br><span class="line">        <span class="keyword">while</span> (n) &#123;</span><br><span class="line">            sum += n % <span class="number">2</span>;</span><br><span class="line">            n = n &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong> $O(log_2n)$</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong> $O(1)$</p><hr><p><strong><font color="F0800F">æ–¹æ³•äºŒï¼šn &amp; n - 1</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">hammingWeight</span><span class="params">(<span class="keyword">uint32_t</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> sum = <span class="number">0</span>;  </span><br><span class="line">        <span class="keyword">while</span> (n) &#123;</span><br><span class="line">            sum++;</span><br><span class="line">            n &amp;= n - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong> $O(M)$ ï¼ŒM ä¸ºäºŒè¿›åˆ¶æ•°å­— n ä¸­ 1 çš„<strong>ä¸ªæ•°</strong></p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong> $O(1)$</p><hr><h3 id="å‰‘æŒ‡-Offer-56-I-æ•°ç»„ä¸­æ•°å­—å‡ºç°çš„æ¬¡æ•°"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-56-I-æ•°ç»„ä¸­æ•°å­—å‡ºç°çš„æ¬¡æ•°">Â¶</a><a href="https://leetcode-cn.com/problems/shu-zu-zhong-shu-zi-chu-xian-de-ci-shu-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 56 - I. æ•°ç»„ä¸­æ•°å­—å‡ºç°çš„æ¬¡æ•°</a></h3><p>Difficulty: <strong><font color="F08000">ä¸­ç­‰</font></strong></p><p>ä¸€ä¸ªæ•´å‹æ•°ç»„ <code>nums</code> é‡Œé™¤ä¸¤ä¸ªæ•°å­—ä¹‹å¤–ï¼Œå…¶ä»–æ•°å­—éƒ½å‡ºç°äº†ä¸¤æ¬¡ã€‚è¯·å†™ç¨‹åºæ‰¾å‡ºè¿™ä¸¤ä¸ªåªå‡ºç°ä¸€æ¬¡çš„æ•°å­—ã€‚è¦æ±‚æ—¶é—´å¤æ‚åº¦æ˜¯O(n)ï¼Œç©ºé—´å¤æ‚åº¦æ˜¯O(1)ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums &#x3D; [4,1,4,6]</span><br><span class="line">è¾“å‡ºï¼š[1,6] æˆ– [6,1]</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums &#x3D; [1,2,10,4,1,4,3,3]</span><br><span class="line">è¾“å‡ºï¼š[2,10] æˆ– [10,2]</span><br></pre></td></tr></table></figure><p><strong>é™åˆ¶ï¼š</strong></p><ul><li><code>2 &lt;= nums.length &lt;= 10000</code></li></ul><p><strong>Solution</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">singleNumbers</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// è·å¾—ä¸¤ä¸ªåªå‡ºç°ä¸€æ¬¡æ•°å­—çš„å¼‚æˆ–å€¼</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> num : nums) &#123;</span><br><span class="line">            n ^= num;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// é€šè¿‡è¯¥å¼‚æˆ–å€¼ï¼Œæ±‚å‡ºå…¶æœ€åä¸€ä¸ªä½æ•° 1 æ‰€åœ¨ä½ç½®ï¼Œä»¥æ­¤å¯¹æ•°ç»„åˆ†ç»„</span></span><br><span class="line">        <span class="keyword">int</span> c = <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// ï¼ç‰¹åˆ«éœ€è¦æ³¨æ„çš„æ˜¯ &amp; æ“ä½œæ—¶éœ€è¦åŠ  (), å…¶ä¼˜å…ˆçº§å°äº == ï¼Œ ä¸‹åŒ</span></span><br><span class="line">        <span class="keyword">while</span> ((n &amp; c) == <span class="number">0</span>) &#123;</span><br><span class="line">            c &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å°†æ•°ç»„ä¸­çš„æ•°å­—åˆ†ç»„, </span></span><br><span class="line">        <span class="comment">// a ä¸­å­˜ c ä½ç½®ï¼ŒäºŒè¿›åˆ¶ä¸º 1 çš„æ‰€æœ‰æ•°å¼‚æˆ–å’Œ</span></span><br><span class="line">        <span class="comment">// b ä¸­åˆ™å­˜ç›¸åæƒ…å†µ</span></span><br><span class="line">        <span class="comment">// è¿™æ ·è¿™ä¸¤ä¸ªåªå‡ºç°ä¸€æ¬¡çš„æ•°å­—è¢«åˆ†å¼€</span></span><br><span class="line">        <span class="keyword">int</span> a = <span class="number">0</span>, b = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; num : nums) &#123;</span><br><span class="line">            <span class="comment">// æ³¨æ„ ()</span></span><br><span class="line">            <span class="keyword">if</span> ((c &amp; num) == <span class="number">0</span>) a ^= num;</span><br><span class="line">            <span class="keyword">else</span> b ^= num;</span><br><span class="line">        &#125;   </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&#123;a, b&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong> $O(N)$</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong> $O(1)$</p><hr><h3 id="å‰‘æŒ‡-Offer-56-II-æ•°ç»„ä¸­æ•°å­—å‡ºç°çš„æ¬¡æ•°-II"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-56-II-æ•°ç»„ä¸­æ•°å­—å‡ºç°çš„æ¬¡æ•°-II">Â¶</a><a href="https://leetcode-cn.com/problems/shu-zu-zhong-shu-zi-chu-xian-de-ci-shu-ii-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 56 - II. æ•°ç»„ä¸­æ•°å­—å‡ºç°çš„æ¬¡æ•° II</a></h3><p>Difficulty: <strong><font color="F08000">ä¸­ç­‰</font></strong></p><p>åœ¨ä¸€ä¸ªæ•°ç»„ <code>nums</code> ä¸­é™¤ä¸€ä¸ªæ•°å­—åªå‡ºç°ä¸€æ¬¡ä¹‹å¤–ï¼Œå…¶ä»–æ•°å­—éƒ½å‡ºç°äº†ä¸‰æ¬¡ã€‚è¯·æ‰¾å‡ºé‚£ä¸ªåªå‡ºç°ä¸€æ¬¡çš„æ•°å­—ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums &#x3D; [3,4,3,3]</span><br><span class="line">è¾“å‡ºï¼š4</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums &#x3D; [9,1,7,9,7,9,7]</span><br><span class="line">è¾“å‡ºï¼š1</span><br></pre></td></tr></table></figure><p><strong>é™åˆ¶ï¼š</strong></p><ul><li><code>1 &lt;= nums.length &lt;= 10000</code></li><li><code>1 &lt;= nums[i] &lt; 2^31</code></li></ul><p><strong>Solution</strong></p><p><strong><font color="F0800F">æ–¹æ³•ä¸€ï¼šå“ˆå¸Œè¡¨</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">singleNumber</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">unordered_map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; hashmap;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; num : nums) &#123;</span><br><span class="line">            hashmap[num]++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; [r, t] : hashmap) &#123;</span><br><span class="line">            <span class="keyword">if</span> (t == <span class="number">1</span>) <span class="keyword">return</span> r;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong> $O(N)$ï¼Œéå†ä¸€æ¬¡æ•°ç»„ï¼Œä¸€æ¬¡å“ˆå¸Œè¡¨å³å¯ï¼Œ$O(N + (N - 1) / 3 + 1) \approx O(N)$ã€‚</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong> $O(N)$ï¼Œå“ˆå¸Œè¡¨éœ€è¦ç©ºé—´ $O((N - 1) / 3 + 1) \approx O(N)$ã€‚</p><hr><p><strong><font color="F0800F">æ–¹æ³•äºŒï¼šéå†ç»Ÿè®¡</font></strong>ï¼Œè¯¥æ–¹æ³•å¯ä»¥é€šç”¨ m &gt; 1 çš„æ‰€æœ‰æƒ…å†µ</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">singleNumber</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// æ–¹æ³•å¯ä»¥é€šç”¨ m &gt; 1 çš„æ‰€æœ‰æƒ…å†µ</span></span><br><span class="line">        <span class="keyword">int</span> m = <span class="number">3</span>;</span><br><span class="line">        <span class="comment">// è®°å½•ç»“æœ</span></span><br><span class="line">        <span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">            <span class="comment">// ç”¨æ¥è®°å½•å½“å‰ä½ 1 çš„ä¸ªæ•°ä¹‹å’Œ</span></span><br><span class="line">            <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; num : nums) &#123;</span><br><span class="line">                <span class="comment">// å½“å‰ä½ç½®æ˜¯ 1 æ—¶ï¼Œcount++;</span></span><br><span class="line">                <span class="keyword">if</span> ((num &amp; (<span class="number">1</span> &lt;&lt; i))) count++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// å¦‚æœç»Ÿè®¡ç»“æœ mod m == 1ï¼Œåˆ™è¯´æ˜å½“å‰ 1 å¤šä½™ï¼Œ</span></span><br><span class="line">            <span class="comment">// ä¹Ÿå°±æ˜¯æ‰€æ±‚æ•°å­— 1 çš„ç›¸åº”ä½ç½®</span></span><br><span class="line">            <span class="keyword">if</span> (count % m == <span class="number">1</span>) &#123;</span><br><span class="line">                res |= (<span class="number">1</span> &lt;&lt; i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong> $O(N)$</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong> $O(1)$</p><hr><p><strong><font color="F0800F">æ–¹æ³•ä¸‰ï¼šæœ‰é™çŠ¶æ€æœº</font></strong>ï¼Œæ•°å­—ç”µè·¯æ–¹æ³•</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">singleNumber</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> a = <span class="number">0</span>, b = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// çœŸå€¼è¡¨ è¡¨å¤´ n a b</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; n : nums) &#123;</span><br><span class="line">            b = ~a &amp; (b ^ n);</span><br><span class="line">            <span class="comment">// a = (~a &amp; b &amp; n) | (a &amp; ~b &amp; ~n) ç»è¿‡ä¼˜åŒ–</span></span><br><span class="line">            a = ~b &amp; (a ^ n);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä¼˜åŒ–æ–¹å¼ï¼š<a href="https://leetcode-cn.com/problems/single-number-ii/solution/zhi-chu-xian-yi-ci-de-shu-zi-ii-by-leetc-23t6/" target="_blank" rel="noopener">åªå‡ºç°ä¸€æ¬¡çš„æ•°å­— II</a></p><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong> $O(N)$</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong> $O(1)$</p><hr><h3 id="å‰‘æŒ‡-Offer-65-ä¸ç”¨åŠ å‡ä¹˜é™¤åšåŠ æ³•"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-65-ä¸ç”¨åŠ å‡ä¹˜é™¤åšåŠ æ³•">Â¶</a><a href="https://leetcode-cn.com/problems/bu-yong-jia-jian-cheng-chu-zuo-jia-fa-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 65. ä¸ç”¨åŠ å‡ä¹˜é™¤åšåŠ æ³•</a></h3><p>Difficulty: <strong><font color="008F00">ç®€å•</font></strong></p><p>å†™ä¸€ä¸ªå‡½æ•°ï¼Œæ±‚ä¸¤ä¸ªæ•´æ•°ä¹‹å’Œï¼Œè¦æ±‚åœ¨å‡½æ•°ä½“å†…ä¸å¾—ä½¿ç”¨ â€œ+â€ã€â€œ-â€ã€â€œ*â€ã€â€œ/â€ å››åˆ™è¿ç®—ç¬¦å·ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: a &#x3D; 1, b &#x3D; 1</span><br><span class="line">è¾“å‡º: 2</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li><code>a</code>, <code>b</code> å‡å¯èƒ½æ˜¯è´Ÿæ•°æˆ– 0</li><li>ç»“æœä¸ä¼šæº¢å‡º 32 ä½æ•´æ•°</li></ul><p><strong>Solution</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ä¸»è¦æ€æƒ³å°±æ˜¯å°†å¸¦è¿›ä½çš„åŠ æ³•ï¼Œè½¬å˜æˆæ— è¿›ä½åŠ æ³• + è¿›ä½å€¼ï¼Œä¸¤ä¸ªéƒ¨åˆ†åˆ†å¼€è®¡ç®—</span></span><br><span class="line">        <span class="keyword">while</span> (b) &#123;</span><br><span class="line">            <span class="comment">// c ä»£è¡¨è¿›ä½ï¼Œåªæœ‰ a b å½“å‰ä½çš†ä¸º 1 æ‰ä¼šè¿›ä½</span></span><br><span class="line">            <span class="comment">// æ¯ä¸€ä½å¯èƒ½çš„è¿›ä½ï¼Œå·¦ç§» 1 ä½æ¥å®ç°</span></span><br><span class="line">            <span class="keyword">int</span> c = (<span class="keyword">unsigned</span> <span class="keyword">int</span>) (a &amp; b) &lt;&lt; <span class="number">1</span>;</span><br><span class="line">            <span class="comment">// äºŒè¿›åˆ¶æ— è¿›ä½åŠ æ³•å°±æ˜¯å¼‚æˆ–æ“ä½œ</span></span><br><span class="line">            a ^= b;</span><br><span class="line">            <span class="comment">// å°†è¿›ä½æƒ…å†µå˜æˆä¸‹ä¸€æ¬¡çš„åŠ æ•°</span></span><br><span class="line">            b = c;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong> $O(1)$ï¼Œæœ€å¤§æƒ…å†µ 32 æ¬¡å¾ªç¯</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong> $O(1)$</p><hr><h3 id="å‚è€ƒèµ„æ–™"><a class="header-anchor" href="#å‚è€ƒèµ„æ–™">Â¶</a>å‚è€ƒèµ„æ–™</h3><blockquote><p><a href="https://leetcode-cn.com/leetbook/detail/illustration-of-algorithm/" target="_blank" rel="noopener">å›¾è§£ç®—æ³•æ•°æ®ç»“æ„ - LeetBook - åŠ›æ‰£ï¼ˆLeetCodeï¼‰å…¨çƒæå®¢æŒšçˆ±çš„æŠ€æœ¯æˆé•¿å¹³å° (leetcode-cn.com)</a></p><p><a href="https://leetcode-cn.com/" target="_blank" rel="noopener">åŠ›æ‰£ï¼ˆLeetCodeï¼‰å®˜ç½‘ - å…¨çƒæå®¢æŒšçˆ±çš„æŠ€æœ¯æˆé•¿å¹³å° (leetcode-cn.com)</a> å®˜æ–¹é¢˜è§£</p></blockquote><!-- rebuild by neat -->]]></content>
      <categories>
        <category>Data_Structure_and_Algorithm</category>
      </categories>
      <tags>
        <tag>ä½è¿ç®—</tag>
      </tags>
  </entry>
  <entry>
    <title>å‰‘æŒ‡offer -- æ¨¡æ‹Ÿ</title>
    <url>/Data_Structure_and_Algorithm/%E5%89%91%E6%8C%87offer/%E6%A8%A1%E6%8B%9F/</url>
    <content><![CDATA[<!-- build time:Tue Jun 22 2021 17:02:33 GMT+0800 (GMT+08:00) --><a id="more"></a><h2 id="å‰‘æŒ‡offer-â€“-æ¨¡æ‹Ÿ"><a class="header-anchor" href="#å‰‘æŒ‡offer-â€“-æ¨¡æ‹Ÿ">Â¶</a>å‰‘æŒ‡offer â€“ æ¨¡æ‹Ÿ</h2><h3 id="å‰‘æŒ‡-Offer-29-é¡ºæ—¶é’ˆæ‰“å°çŸ©é˜µ"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-29-é¡ºæ—¶é’ˆæ‰“å°çŸ©é˜µ">Â¶</a><a href="https://leetcode-cn.com/problems/shun-shi-zhen-da-yin-ju-zhen-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 29. é¡ºæ—¶é’ˆæ‰“å°çŸ©é˜µ</a></h3><p>Difficulty: <strong><font color="008F00">ç®€å•</font></strong></p><p>è¾“å…¥ä¸€ä¸ªçŸ©é˜µï¼ŒæŒ‰ç…§ä»å¤–å‘é‡Œä»¥é¡ºæ—¶é’ˆçš„é¡ºåºä¾æ¬¡æ‰“å°å‡ºæ¯ä¸€ä¸ªæ•°å­—ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šmatrix &#x3D; [[1,2,3],[4,5,6],[7,8,9]]</span><br><span class="line">è¾“å‡ºï¼š[1,2,3,6,9,8,7,4,5]</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šmatrix &#x3D; [[1,2,3,4],[5,6,7,8],[9,10,11,12]]</span><br><span class="line">è¾“å‡ºï¼š[1,2,3,4,8,12,11,10,9,5,6,7]</span><br></pre></td></tr></table></figure><p><strong>é™åˆ¶ï¼š</strong></p><ul><li><code>0 &lt;= matrix.length &lt;= 100</code></li><li><code>0 &lt;= matrix[i].length &lt;= 100</code></li></ul><p><strong>Solution</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">spiralOrder</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt;&amp; matrix)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = matrix.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">0</span>) <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">        <span class="comment">// å››ä¸ªè¾¹ç•Œæ¡ä»¶</span></span><br><span class="line">        <span class="keyword">int</span> l = <span class="number">0</span>, t = <span class="number">0</span>, b = n - <span class="number">1</span>, r = matrix[<span class="number">0</span>].<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; res;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// å‘å³è¾“å‡º</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = l; i &lt;= r; i++) res.push_back(matrix[t][i]);</span><br><span class="line">            <span class="comment">// å¦‚æœå½“å‰å¾ªç¯è‡³æœ€åº•å±‚ é€€å‡º</span></span><br><span class="line">            <span class="keyword">if</span> (++t &gt; b) <span class="keyword">break</span>;</span><br><span class="line">            <span class="comment">// å‘ä¸‹è¾“å‡º</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = t; i &lt;= b; i++) res.push_back(matrix[i][r]);</span><br><span class="line">            <span class="comment">// å¦‚æœå½“å‰å¾ªç¯è‡³æœ€å·¦ é€€å‡º</span></span><br><span class="line">            <span class="keyword">if</span> (l &gt; --r) <span class="keyword">break</span>;</span><br><span class="line">            <span class="comment">// å‘å·¦è¾“å‡º</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = r; i &gt;= l; i--) res.push_back(matrix[b][i]);</span><br><span class="line">            <span class="comment">// å¦‚æœå½“å‰å¾ªç¯è‡³æœ€ä¸Š é€€å‡º</span></span><br><span class="line">            <span class="keyword">if</span> (t &gt; --b) <span class="keyword">break</span>;</span><br><span class="line">            <span class="comment">// å‘ä¸Šè¾“å‡º</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = b; i &gt;= t; i--) res.push_back(matrix[i][l]);</span><br><span class="line">            <span class="comment">// å¦‚æœå½“å‰å¾ªç¯è‡³æœ€å³ é€€å‡º</span></span><br><span class="line">            <span class="keyword">if</span> (++l &gt; r) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong> $O(M\cdot N)$</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong> $O(1)$ï¼Œåªéœ€è¦å››ä¸ªæ–¹å‘å˜é‡ï¼Œå…¶ä¸­ res æ˜¯è¾“å‡ºè¦æ±‚ç©ºé—´ï¼Œä¸ç®—åšç®—æ³•ç©ºé—´ã€‚</p><hr><h3 id="å‰‘æŒ‡-Offer-31-æ ˆçš„å‹å…¥ã€å¼¹å‡ºåºåˆ—"><a class="header-anchor" href="#å‰‘æŒ‡-Offer-31-æ ˆçš„å‹å…¥ã€å¼¹å‡ºåºåˆ—">Â¶</a><a href="https://leetcode-cn.com/problems/zhan-de-ya-ru-dan-chu-xu-lie-lcof/" target="_blank" rel="noopener">å‰‘æŒ‡ Offer 31. æ ˆçš„å‹å…¥ã€å¼¹å‡ºåºåˆ—</a></h3><p>Difficulty: <strong><font color="F08000">ä¸­ç­‰</font></strong></p><p>è¾“å…¥ä¸¤ä¸ªæ•´æ•°åºåˆ—ï¼Œç¬¬ä¸€ä¸ªåºåˆ—è¡¨ç¤ºæ ˆçš„å‹å…¥é¡ºåºï¼Œè¯·åˆ¤æ–­ç¬¬äºŒä¸ªåºåˆ—æ˜¯å¦ä¸ºè¯¥æ ˆçš„å¼¹å‡ºé¡ºåºã€‚å‡è®¾å‹å…¥æ ˆçš„æ‰€æœ‰æ•°å­—å‡ä¸ç›¸ç­‰ã€‚ä¾‹å¦‚ï¼Œåºåˆ— {1,2,3,4,5} æ˜¯æŸæ ˆçš„å‹æ ˆåºåˆ—ï¼Œåºåˆ— {4,5,3,2,1} æ˜¯è¯¥å‹æ ˆåºåˆ—å¯¹åº”çš„ä¸€ä¸ªå¼¹å‡ºåºåˆ—ï¼Œä½† {4,3,5,1,2} å°±ä¸å¯èƒ½æ˜¯è¯¥å‹æ ˆåºåˆ—çš„å¼¹å‡ºåºåˆ—ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼špushed &#x3D; [1,2,3,4,5], popped &#x3D; [4,5,3,2,1]</span><br><span class="line">è¾“å‡ºï¼štrue</span><br><span class="line">è§£é‡Šï¼šæˆ‘ä»¬å¯ä»¥æŒ‰ä»¥ä¸‹é¡ºåºæ‰§è¡Œï¼š</span><br><span class="line">push(1), push(2), push(3), push(4), pop() -&gt; 4,</span><br><span class="line">push(5), pop() -&gt; 5, pop() -&gt; 3, pop() -&gt; 2, pop() -&gt; 1</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼špushed &#x3D; [1,2,3,4,5], popped &#x3D; [4,3,5,1,2]</span><br><span class="line">è¾“å‡ºï¼šfalse</span><br><span class="line">è§£é‡Šï¼š1 ä¸èƒ½åœ¨ 2 ä¹‹å‰å¼¹å‡ºã€‚</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ol><li><code>0 &lt;= pushed.length == popped.length &lt;= 1000</code></li><li><code>0 &lt;= pushed[i], popped[i] &lt; 1000</code></li><li><code>pushed</code> æ˜¯ <code>popped</code> çš„æ’åˆ—ã€‚</li></ol><p><strong>Solution</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">validateStackSequences</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; pushed, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; popped)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt; stk;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; num : pushed) &#123;</span><br><span class="line">            stk.push(num);</span><br><span class="line">            <span class="comment">// å› ä¸º pushed ä¸ popped é•¿åº¦ç›¸åŒï¼Œä¸å¯èƒ½å‡ºç° i åœ¨å¾ªç¯ä¸­è¶…é™çš„æƒ…å†µ</span></span><br><span class="line">            <span class="comment">// æ‰€ä»¥ä¸ç”¨å•ç‹¬ä¸º i è®¾å®šåˆ¤æ–­æ¡ä»¶</span></span><br><span class="line">            <span class="keyword">while</span> (!stk.empty() &amp;&amp; stk.top() == popped[i]) &#123;</span><br><span class="line">                stk.pop();</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> stk.empty();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong> $O(N)$ï¼ŒåŒæ—¶éå†ä¸€æ¬¡æ•°ç»„</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong> $O(N)$ï¼Œé¢å¤–æ ˆç©ºé—´</p><hr><h3 id="å‚è€ƒèµ„æ–™"><a class="header-anchor" href="#å‚è€ƒèµ„æ–™">Â¶</a>å‚è€ƒèµ„æ–™</h3><blockquote><p><a href="https://leetcode-cn.com/leetbook/detail/illustration-of-algorithm/" target="_blank" rel="noopener">å›¾è§£ç®—æ³•æ•°æ®ç»“æ„ - LeetBook - åŠ›æ‰£ï¼ˆLeetCodeï¼‰å…¨çƒæå®¢æŒšçˆ±çš„æŠ€æœ¯æˆé•¿å¹³å° (leetcode-cn.com)</a></p><p><a href="https://leetcode-cn.com/" target="_blank" rel="noopener">åŠ›æ‰£ï¼ˆLeetCodeï¼‰å®˜ç½‘ - å…¨çƒæå®¢æŒšçˆ±çš„æŠ€æœ¯æˆé•¿å¹³å° (leetcode-cn.com)</a> å®˜æ–¹é¢˜è§£</p></blockquote><!-- rebuild by neat -->]]></content>
      <categories>
        <category>Data_Structure_and_Algorithm</category>
      </categories>
      <tags>
        <tag>æ¨¡æ‹Ÿ</tag>
      </tags>
  </entry>
  <entry>
    <title>C++11 å¹¶å‘å¤šçº¿ç¨‹</title>
    <url>/C++_Language/C++_Multithreading/</url>
    <content><![CDATA[<!-- build time:Tue Jun 22 2021 17:02:33 GMT+0800 (GMT+08:00) --><a id="more"></a><h3 id="ä¸€ã€çº¿ç¨‹å¯åŠ¨ã€ç»“æŸï¼Œåˆ›å»ºçº¿ç¨‹çš„å¤šç§æ–¹æ³•ã€joinï¼Œdetach"><a class="header-anchor" href="#ä¸€ã€çº¿ç¨‹å¯åŠ¨ã€ç»“æŸï¼Œåˆ›å»ºçº¿ç¨‹çš„å¤šç§æ–¹æ³•ã€joinï¼Œdetach">Â¶</a>ä¸€ã€çº¿ç¨‹å¯åŠ¨ã€ç»“æŸï¼Œåˆ›å»ºçº¿ç¨‹çš„å¤šç§æ–¹æ³•ã€joinï¼Œdetach</h3><ul><li><strong><code>thread</code></strong></li><li><strong><code>join()</code> , <code>detach()</code> , <code>joinable()</code></strong></li><li>ç”¨ç±»ï¼Œlambda è¡¨è¾¾å¼åˆ›å»º</li></ul><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">myPrint</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"æˆ‘çš„çº¿ç¨‹å¼€å§‹æ‰§è¡Œ...."</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="comment">// .....</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"æˆ‘çš„çº¿ç¨‹è¿è¡Œå®Œæ¯•...."</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ta</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// é‡è½½å‡½æ•°è¿ç®—ç¬¦</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">operator</span><span class="params">()</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"æˆ‘çš„çº¿ç¨‹å¼€å§‹è¿è¡Œ..."</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="comment">// ....</span></span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"æˆ‘çš„çº¿ç¨‹è¿è¡Œå®Œæ¯•..."</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æˆå‘˜å‡½æ•°ï¼š</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">getMsg</span><span class="params">(<span class="keyword">int</span> input)</span></span>&#123;&#125;;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">saveMsg</span><span class="params">()</span></span>&#123;&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// (1) åˆ›å»ºçº¿ç¨‹ï¼ŒmyPrintä¸ºçº¿ç¨‹å…¥å£</span></span><br><span class="line">    <span class="comment">// çº¿ç¨‹ç±»å‚æ•°æ˜¯ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡</span></span><br><span class="line">    <span class="comment">// å¯ä»¥æ˜¯å‡½æ•°ï¼Œå‡½æ•°æŒ‡é’ˆï¼Œlambdaè¡¨è¾¾å¼ï¼Œbindåˆ›å»ºçš„å¯¹è±¡æˆ–è€…é‡è½½å‡½æ•°è°ƒç”¨è¿ç®—ç¬¦çš„ç±»å¯¹è±¡</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// â…  ä»¥å‡½æ•°å¯¹è±¡åˆ›å»ºçº¿ç¨‹</span></span><br><span class="line">    <span class="function">thread <span class="title">myThread</span><span class="params">(myPrint)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// â…¡ ä»¥ç±»å¯¹è±¡åˆ›å»ºçº¿ç¨‹</span></span><br><span class="line">    Ta ta;</span><br><span class="line">    <span class="function">thread <span class="title">myThread</span><span class="params">(ta)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// â…¢ ä»¥lambdaè¡¨è¾¾å¼åˆ›å»ºçº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">auto</span> lambdaThread = [] &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"æˆ‘çš„çº¿ç¨‹å¼€å§‹äº†..."</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"æˆ‘çš„çº¿ç¨‹ç»“æŸäº†..."</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">thread <span class="title">myThread</span><span class="params">(lambdaThread)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// â…£ ä»¥ç±»ä¸­æˆå‘˜å‡½æ•°</span></span><br><span class="line">    <span class="comment">// ç¬¬ä¸€ä¸ª &amp; å–åœ°å€ï¼Œç¬¬äºŒä¸ª &amp; å¼•ç”¨ï¼Œç›¸å½“äº std::ref(s)</span></span><br><span class="line">    <span class="comment">// threadObj1(&amp;Ta::saveMsg, ta) ä¼ å€¼ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯ä¼šè°ƒç”¨ä¸€æ¬¡æ„é€ å‡½æ•°ï¼Œä¸¤æ¬¡æ‹·è´æ„é€ </span></span><br><span class="line">    <span class="comment">// threadObj1(&amp;Ta::saveMsg, &amp;ta) ä¼ å¼•ç”¨ï¼Œä¼šè°ƒç”¨ä¸€æ¬¡æ„é€ å‡½æ•°ï¼Œä¸€æ¬¡æ‹·è´æ„é€ </span></span><br><span class="line">    Ta ta;</span><br><span class="line">    <span class="keyword">int</span> input = <span class="number">0</span>;</span><br><span class="line">    <span class="function">thread <span class="title">threadObj1</span><span class="params">(&amp;Ta::saveMsg, &amp;ta)</span></span>;</span><br><span class="line">    <span class="function">thread <span class="title">threadObj2</span><span class="params">(&amp;Ta::getMsg, &amp;ta, input)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// (2) é˜»å¡ä¸»çº¿ç¨‹å¹¶ç­‰å¾… myThread çº¿ç¨‹æ‰§è¡Œå®Œæ¯•</span></span><br><span class="line">    myThread.join();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// (3) ä¸é˜»å¡ä¸»çº¿ç¨‹ï¼Œä¸»çº¿ç¨‹å¾€ä¸‹æ‰§è¡Œï¼Œå¦‚æœä¸»çº¿ç¨‹é€€å‡ºï¼Œå­çº¿ç¨‹è¿˜æœªç»“æŸ</span></span><br><span class="line">    <span class="comment">// å°†ä¼šç”±åå°æ‰˜ç®¡æ‰§è¡Œã€‚</span></span><br><span class="line">    myThread.<span class="built_in">detach</span>();</span><br><span class="line">        </span><br><span class="line">    <span class="comment">// (4) join , detach åªèƒ½ä½¿ç”¨ä¸€ä¸ªï¼Œå¯ä»¥ä½¿ç”¨ joinable æ¥è¿›è¡Œè¾…åŠ©åˆ¤æ–­</span></span><br><span class="line">    <span class="comment">// æ³¨ï¼šä¸Šè¿°åªæ˜¯ä¸¾ä¾‹å†™æ³•ï¼ŒçœŸå®ä»£ç ç¯å¢ƒï¼Œjoin,detachåªèƒ½ä½¿ç”¨ä¸€ä¸ª </span></span><br><span class="line">    <span class="keyword">if</span> (myThread.joinable()) &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"å¯ä»¥è°ƒç”¨join()ï¼Œæˆ–è€…detach()"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"ä¸èƒ½è°ƒç”¨join(), æˆ–è€…detach()"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// ä¸»çº¿ç¨‹æ‰“å°è¯­å¥</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"Hello World!"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="äºŒã€çº¿ç¨‹ä¼ å‚è¯¦è§£ï¼Œdetach-å†æ¢ï¼Œç±»æˆå‘˜å‡½æ•°ä½œä¸ºçº¿ç¨‹å…¥å£å‡½æ•°"><a class="header-anchor" href="#äºŒã€çº¿ç¨‹ä¼ å‚è¯¦è§£ï¼Œdetach-å†æ¢ï¼Œç±»æˆå‘˜å‡½æ•°ä½œä¸ºçº¿ç¨‹å…¥å£å‡½æ•°">Â¶</a>äºŒã€çº¿ç¨‹ä¼ å‚è¯¦è§£ï¼Œdetach()å†æ¢ï¼Œç±»æˆå‘˜å‡½æ•°ä½œä¸ºçº¿ç¨‹å…¥å£å‡½æ•°</h3><ul><li>ä¼ é€’ä¸´æ—¶å¯¹è±¡ä½œä¸ºçº¿ç¨‹å‚æ•°ï¼Œè¦é¿å…çš„é™·é˜±</li><li>ä¸´æ—¶å¯¹è±¡ä½œä¸ºçº¿ç¨‹å‚æ•°ï¼Œçº¿ç¨‹idï¼Œä¸´æ—¶å¯¹è±¡æ„é€ æ—¶æœºæŠ“æ•</li><li>ä¼ é€’ç±»å¯¹è±¡ã€åªèƒ½æŒ‡é’ˆä½œä¸ºçº¿ç¨‹å‚æ•°</li><li>ç”¨æˆå‘˜å‡½æ•°æŒ‡é’ˆåšçº¿ç¨‹å…¥å£å‡½æ•°</li></ul><h4 id="2-1-å¯èƒ½çš„é™·é˜±"><a class="header-anchor" href="#2-1-å¯èƒ½çš„é™·é˜±">Â¶</a>2.1 å¯èƒ½çš„é™·é˜±</h4><p><strong><code>ä¼ é€’ä¸´æ—¶å¯¹è±¡ä½œä¸ºçº¿ç¨‹å‚æ•°</code></strong> è¦é¿å…çš„<font color="FF0000">é™·é˜±</font></p><p><strong>é™·é˜±ä¸€ï¼š</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">myPrint</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; i, <span class="keyword">char</span>* pmybuf)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å¦‚æœçº¿ç¨‹ä»ä¸»çº¿ç¨‹ detach äº†</span></span><br><span class="line">	<span class="comment">// i ä¸æ˜¯ mvar çœŸæ­£çš„å¼•ç”¨ï¼Œå®é™…ä¸Šå€¼ä¼ é€’ï¼Œå³ä½¿ä¸»çº¿ç¨‹è¿è¡Œå®Œæ¯•äº†ï¼Œ</span></span><br><span class="line">    <span class="comment">// å­çº¿ç¨‹ç”¨ i ä»ç„¶æ˜¯å®‰å…¨çš„ï¼Œä½†ä»ä¸æ¨èä¼ é€’å¼•ç”¨</span></span><br><span class="line">	<span class="comment">// æ¨èæ”¹ä¸º const int i</span></span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; i &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="comment">// pmybufè¿˜æ˜¯æŒ‡å‘åŸæ¥çš„å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥è¿™ä¹ˆå†™æ˜¯ä¸å®‰å…¨çš„</span></span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; pmybuf &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> mvar = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">int</span>&amp; mvary = mvar;</span><br><span class="line">	<span class="keyword">char</span> mybuf[] = <span class="string">"this is a test"</span>;</span><br><span class="line">    <span class="comment">// ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å‡½æ•°åï¼Œåä¸¤ä¸ªå‚æ•°æ˜¯å‡½æ•°çš„å‚æ•°</span></span><br><span class="line">	<span class="function">thread <span class="title">myThread</span><span class="params">(myPrint, mvar, mybuf)</span></span>;</span><br><span class="line">	myThread.join();</span><br><span class="line">	<span class="comment">// myThread.detach();</span></span><br><span class="line">	</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"Hello World!"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>é™·é˜±äºŒï¼š</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">myPrint</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> i, <span class="keyword">const</span> <span class="built_in">string</span>&amp; pmybuf)</span> </span>&#123;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; i &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; pmybuf &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> mvar = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">int</span>&amp; mvary = mvar;</span><br><span class="line">	<span class="keyword">char</span> mybuf[] = <span class="string">"this is a test"</span>;</span><br><span class="line">	<span class="comment">// å¦‚æœ detach äº†ï¼Œè¿™æ ·ä»ç„¶æ˜¯ä¸å®‰å…¨çš„</span></span><br><span class="line">	<span class="comment">// å› ä¸ºå­˜åœ¨ä¸»çº¿ç¨‹è¿è¡Œå®Œäº†ï¼Œmybufè¢«å›æ”¶äº†ï¼Œç³»ç»Ÿé‡‡ç”¨ mybuf éšå¼ç±»å‹è½¬æ¢æˆ string</span></span><br><span class="line">    <span class="comment">// å¯èƒ½è¿˜æ²¡è½¬åŒ–ï¼Œä¸»çº¿ç¨‹å°±å·²ç»ç»“æŸäº†</span></span><br><span class="line">	<span class="function">thread <span class="title">myThread</span><span class="params">(myPrint, mvar, mybuf)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ¨èå…ˆåˆ›å»ºä¸€ä¸ªä¸´æ—¶å¯¹è±¡,å°±ç»å¯¹å®‰å…¨äº†ã€‚ã€‚ã€‚ã€‚</span></span><br><span class="line">    <span class="function">thread <span class="title">myThread</span><span class="params">(myPrint, mvar, <span class="built_in">string</span>(mybuf))</span></span>;</span><br><span class="line">    </span><br><span class="line">	myThread.join();</span><br><span class="line">	<span class="comment">//myThread.detach();</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"Hello World!"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br></pre></td></tr></table></figure><p>æ€»ç»“</p><ul><li>å¦‚æœä¼ é€’<strong>ç®€å•ç±»å‹</strong>ï¼Œå¦‚å†…ç½®ç±»å‹ï¼Œæ¨èä½¿ç”¨å€¼ä¼ é€’ï¼Œ<strong>ä¸è¦ç”¨å¼•ç”¨</strong></li><li>å¦‚æœä¼ é€’<strong>ç±»å¯¹è±¡</strong>ï¼Œ<strong>é¿å…ä½¿ç”¨éšå¼ç±»å‹è½¬æ¢</strong>ï¼Œå…¨éƒ¨éƒ½æ˜¯åˆ›å»ºçº¿ç¨‹è¿™ä¸€è¡Œå°±åˆ›å»ºå‡ºä¸´æ—¶å¯¹è±¡ï¼Œç„¶ååœ¨å‡½æ•°å‚æ•°é‡Œï¼Œç”¨å¼•ç”¨æ¥æ¥ï¼Œå¦åˆ™è¿˜ä¼šåˆ›å»ºå‡ºä¸€ä¸ªå¯¹è±¡</li><li>å»ºè®®ä¸ä½¿ç”¨ detach</li></ul><h4 id="2-2-çº¿ç¨‹-id"><a class="header-anchor" href="#2-2-çº¿ç¨‹-id">Â¶</a>2.2 çº¿ç¨‹ id</h4><p><strong><code>çº¿ç¨‹ Id</code></strong> é€šè¿‡å¦‚ä¸‹è·å–ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">std</span>::this_thread::get_id();</span><br></pre></td></tr></table></figure><h4 id="2-3-ä¼ é€’-ç±»å¯¹è±¡-ã€-æ™ºèƒ½æŒ‡é’ˆ-ä½œä¸ºçº¿ç¨‹å‚æ•°"><a class="header-anchor" href="#2-3-ä¼ é€’-ç±»å¯¹è±¡-ã€-æ™ºèƒ½æŒ‡é’ˆ-ä½œä¸ºçº¿ç¨‹å‚æ•°">Â¶</a>2.3 ä¼ é€’ <strong><code>ç±»å¯¹è±¡</code></strong> ã€ <strong><code>æ™ºèƒ½æŒ‡é’ˆ</code></strong> ä½œä¸ºçº¿ç¨‹å‚æ•°</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="keyword">mutable</span> <span class="keyword">int</span> m_i; <span class="comment">// m_iå³ä½¿æ˜¯åœ¨ const ä¸­ä¹Ÿå¯ä»¥è¢«ä¿®æ”¹</span></span><br><span class="line">	A(<span class="keyword">int</span> i) :m_i(i) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">myPrint</span><span class="params">(<span class="keyword">const</span> A&amp; pmybuf)</span> </span>&#123;</span><br><span class="line">	pmybuf.m_i = <span class="number">199</span>;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"å­çº¿ç¨‹myPrintçš„å‚æ•°åœ°å€æ˜¯"</span> &lt;&lt; &amp;pmybuf &lt;&lt; <span class="string">"thread = "</span> </span><br><span class="line">          &lt;&lt; <span class="built_in">std</span>::this_thread::get_id() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="function">A <span class="title">myObj</span><span class="params">(<span class="number">10</span>)</span></span>;</span><br><span class="line">	<span class="comment">// myPrint(const A&amp; pmybuf)ä¸­å¼•ç”¨ä¸èƒ½å»æ‰ï¼Œå¦‚æœå»æ‰ä¼šå¤šåˆ›å»ºä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">	<span class="comment">// constä¹Ÿä¸èƒ½å»æ‰ï¼Œå»æ‰ä¼šå‡ºé”™</span></span><br><span class="line">    </span><br><span class="line">	<span class="comment">// å³ä½¿æ˜¯ä¼ é€’çš„constå¼•ç”¨ï¼Œä½†åœ¨å­çº¿ç¨‹ä¸­è¿˜æ˜¯ä¼šè°ƒç”¨æ‹·è´æ„é€ å‡½æ•°æ„é€ ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œ</span></span><br><span class="line">	<span class="comment">// æ‰€ä»¥åœ¨å­çº¿ç¨‹ä¸­ä¿®æ”¹m_içš„å€¼ä¸ä¼šå½±å“åˆ°ä¸»çº¿ç¨‹</span></span><br><span class="line">    </span><br><span class="line">	<span class="comment">// å¦‚æœå¸Œæœ›å­çº¿ç¨‹ä¸­ä¿®æ”¹m_içš„å€¼å½±å“åˆ°ä¸»çº¿ç¨‹ï¼Œ</span></span><br><span class="line">    <span class="comment">// å¯ä»¥ç”¨thread myThread(myPrint, std::ref(myObj));</span></span><br><span class="line">	<span class="comment">// è¿™æ ·constå°±æ˜¯çœŸçš„å¼•ç”¨äº†ï¼ŒmyPrintå®šä¹‰ä¸­çš„constå¯ä»¥å»æ‰äº†ï¼Œç±»Aå®šä¹‰ä¸­çš„mutableä¹Ÿå¯ä»¥å»æ‰äº†</span></span><br><span class="line">	<span class="function">thread <span class="title">myThread</span><span class="params">(myPrint, myObj)</span></span>;</span><br><span class="line">	myThread.join();</span><br><span class="line">	<span class="comment">//myThread.detach();</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"Hello World!"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">myPrint</span><span class="params">(<span class="built_in">unique_ptr</span>&lt;<span class="keyword">int</span>&gt; ptn)</span> </span>&#123;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"thread = "</span> &lt;&lt; <span class="built_in">std</span>::this_thread::get_id() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="built_in">unique_ptr</span>&lt;<span class="keyword">int</span>&gt; <span class="title">up</span><span class="params">(<span class="keyword">new</span> <span class="keyword">int</span>(<span class="number">10</span>))</span></span>;</span><br><span class="line">	<span class="comment">//ç‹¬å å¼æŒ‡é’ˆåªèƒ½é€šè¿‡std::move()æ‰å¯ä»¥ä¼ é€’ç»™å¦ä¸€ä¸ªæŒ‡é’ˆ</span></span><br><span class="line">	<span class="comment">//ä¼ é€’å up å°±æŒ‡å‘ç©ºï¼Œæ–°çš„ ptn æŒ‡å‘åŸæ¥çš„å†…å­˜</span></span><br><span class="line">	<span class="comment">//æ‰€ä»¥è¿™æ—¶å°±ä¸èƒ½ç”¨ detach äº†ï¼Œå› ä¸ºå¦‚æœä¸»çº¿ç¨‹å…ˆæ‰§è¡Œå®Œï¼ŒptnæŒ‡å‘çš„å¯¹è±¡å°±è¢«é‡Šæ”¾äº†</span></span><br><span class="line">	<span class="function">thread <span class="title">myThread</span><span class="params">(myPrint, <span class="built_in">std</span>::<span class="built_in">move</span>(up))</span></span>;</span><br><span class="line">	myThread.join();</span><br><span class="line">	<span class="comment">//myThread.detach();</span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸‰ã€åˆ›å»ºå¤šä¸ªè¿›ç¨‹ã€æ•°æ®å…±äº«é—®é¢˜åˆ†æ"><a class="header-anchor" href="#ä¸‰ã€åˆ›å»ºå¤šä¸ªè¿›ç¨‹ã€æ•°æ®å…±äº«é—®é¢˜åˆ†æ">Â¶</a>ä¸‰ã€åˆ›å»ºå¤šä¸ªè¿›ç¨‹ã€æ•°æ®å…±äº«é—®é¢˜åˆ†æ</h3><h4 id="3-1-åˆ›å»ºå’Œç­‰å¾…å¤šä¸ªçº¿ç¨‹"><a class="header-anchor" href="#3-1-åˆ›å»ºå’Œç­‰å¾…å¤šä¸ªçº¿ç¨‹">Â¶</a>3.1 åˆ›å»ºå’Œç­‰å¾…å¤šä¸ªçº¿ç¨‹</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">TextThread</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     <span class="built_in">cout</span> &lt;&lt; <span class="string">"æˆ‘æ˜¯çº¿ç¨‹"</span> &lt;&lt; this_thread::get_id() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">     <span class="comment">/*  â€¦  */</span></span><br><span class="line">     <span class="built_in">cout</span> &lt;&lt; <span class="string">"çº¿ç¨‹"</span> &lt;&lt; this_thread::get_id() &lt;&lt; <span class="string">"æ‰§è¡Œç»“æŸ"</span> &lt;&lt; <span class="built_in">endl</span>; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//mainå‡½æ•°é‡Œ   vector threadagg;</span></span><br><span class="line">	<span class="built_in">vector</span>&lt;thread&gt; threadagg;</span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i) &#123;</span><br><span class="line">         threadagg.push_back(thread(TextThread));</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i) &#123;</span><br><span class="line">         threadagg[i].join();</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure><h4 id="3-2-æ•°æ®å…±äº«é—®é¢˜åˆ†æ"><a class="header-anchor" href="#3-2-æ•°æ®å…±äº«é—®é¢˜åˆ†æ">Â¶</a>3.2 æ•°æ®å…±äº«é—®é¢˜åˆ†æ</h4><ul><li>åªè¯»æ•°æ®æ˜¯å®‰å…¨ç¨³å®šçš„</li><li>å¦‚æœå­˜åœ¨å†™æ“ä½œï¼Œè‹¥ä¸åŠ å¤„ç†å°±ä¼šå‡ºé”™</li></ul><h3 id="å››ã€äº’æ–¥é‡æ¦‚å¿µã€ç”¨æ³•ã€æ­»é”"><a class="header-anchor" href="#å››ã€äº’æ–¥é‡æ¦‚å¿µã€ç”¨æ³•ã€æ­»é”">Â¶</a>å››ã€äº’æ–¥é‡æ¦‚å¿µã€ç”¨æ³•ã€æ­»é”</h3><ul><li>äº’æ–¥é‡ï¼ˆmutexï¼‰çš„åŸºæœ¬æ¦‚å¿µ</li><li>äº’æ–¥é‡çš„ç”¨æ³•ï¼š <strong><code>lock()</code> , <code>unlock()</code> , <code>std::lock_guard</code></strong> ç±»æ¨¡æ¿</li><li>æ­»é”åŠä¸€èˆ¬è§£å†³æ–¹æ¡ˆï¼Œ <strong><code>std::lock()</code></strong> å‡½æ•°æ¨¡æ¿ï¼Œ <strong><code>std::lock_guard</code></strong> çš„ <strong><code>std::adopt_lock</code></strong> å‚æ•°</li></ul><h4 id="4-1-äº’æ–¥é‡çš„åŸºæœ¬æ¦‚å¿µåŠç”¨æ³•"><a class="header-anchor" href="#4-1-äº’æ–¥é‡çš„åŸºæœ¬æ¦‚å¿µåŠç”¨æ³•">Â¶</a>4.1 äº’æ–¥é‡çš„åŸºæœ¬æ¦‚å¿µåŠç”¨æ³•</h4><p><strong>äº’æ–¥é‡</strong>å°±æ˜¯ä¸ª<strong>ç±»å¯¹è±¡</strong>ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€æŠŠé”ï¼Œå¤šä¸ªçº¿ç¨‹å°è¯•ç”¨ <strong><code>lock()</code></strong> æˆå‘˜å‡½æ•°æ¥åŠ é”ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½é”å®šæˆåŠŸï¼Œå¦‚æœæ²¡æœ‰é”æˆåŠŸï¼Œé‚£ä¹ˆæµç¨‹å°†å¡åœ¨ <strong><code>lock()</code></strong> è¿™é‡Œä¸æ–­å°è¯•å»é”å®šã€‚äº’æ–¥é‡ä½¿ç”¨è¦å°å¿ƒï¼Œä¿æŠ¤æ•°æ®ä¸å¤šä¹Ÿä¸å°‘ï¼Œå°‘äº†è¾¾ä¸åˆ°æ•ˆæœï¼Œå¤šäº†å½±å“æ•ˆç‡ã€‚</p><p>åŒ…å« <strong><code>#include&lt;mutex&gt;</code></strong> å¤´æ–‡ä»¶ï¼Œæˆå‘˜å‡½æ•°æœ‰ï¼Œ <strong><code>lock()</code> ï¼Œ <code>unlock()</code></strong> ã€‚åŸºæœ¬ä½¿ç”¨æ­¥éª¤ï¼š</p><ul><li><strong><code>lock()</code></strong></li><li>æ“ä½œå…±äº«æ•°æ®</li><li><strong><code>unlock()</code></strong></li></ul><p><strong><code>lock_guardç±»æ¨¡æ¿</code></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">lock_guard <span class="title">sbguard</span><span class="params">(myMutex)</span></span>;  <span class="comment">// å–ä»£lock() å’Œ unlock()</span></span><br><span class="line"><span class="comment">// lock_guardæ„é€ å‡½æ•°æ‰§è¡Œäº†mutex::lock();</span></span><br><span class="line"><span class="comment">// åœ¨ä½œç”¨åŸŸç»“æŸæ—¶ï¼Œè°ƒç”¨ææ„å‡½æ•°ï¼Œæ‰§è¡Œmutex::unlock()</span></span><br></pre></td></tr></table></figure><h4 id="4-2-æ­»é”"><a class="header-anchor" href="#4-2-æ­»é”">Â¶</a>4.2 æ­»é”</h4><p>ä¸¤ä¸ªä»¥ä¸Šäº’æ–¥é‡ä½¿ç”¨ï¼Œç›¸äº’ç«äº‰ï¼Œéƒ½åœ¨äº‰é”ï¼Œä¸é‡Šæ”¾å·²æœ‰é”ã€‚ä¸»è¦<strong>è§£å†³åŠæ³•</strong>æ˜¯ä¿è¯å¤šä¸ªäº’æ–¥é‡ä¸Šé”çš„é¡ºåºåˆç†ã€‚</p><p><strong><code>std::lock()</code></strong> å‡½æ•°æ¨¡æ¿</p><ul><li><strong><code>std::lock(mutex1, mutex2,...);</code></strong> ä¸€æ¬¡æ€§é”å®šå¤šä¸ªäº’æ–¥é‡ï¼Œç”¨äº<strong>å¤„ç†å¤šä¸ªäº’æ–¥é‡</strong>ã€‚</li><li>å¦‚æœäº’æ–¥é‡ä¸­ä¸€ä¸ªæ²¡é”ä½ï¼Œä»–å°±ç­‰ç€ï¼Œç­‰æ‰€æœ‰äº’æ–¥é‡é”ä½ï¼Œæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚å¦‚æœæœ‰ä¸€ä¸ªæ²¡é”ä½ï¼Œå°±ä¼šæŠŠå·²ç»é”ä½çš„é‡Šæ”¾æ‰ï¼ˆè¦ä¹ˆäº’æ–¥é‡éƒ½é”ä½ï¼Œè¦ä¹ˆéƒ½æ²¡é”ä½ï¼Œé˜²æ­¢æ­»é”ï¼‰</li></ul><p>**<code>std::lock_guard</code> ** ä¸­ <strong><code>std::adopt_lock</code></strong> å‚æ•°</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åŠ å…¥adopt_lockåï¼Œåœ¨è°ƒç”¨lock_guardçš„æ„é€ å‡½æ•°æ—¶ï¼Œä¸å†è¿›è¡Œlock();</span></span><br><span class="line"><span class="function"><span class="built_in">std</span>::lock_guard&lt;<span class="built_in">std</span>::mutex&gt; <span class="title">my_guard</span><span class="params">(my_mutex, <span class="built_in">std</span>::adopt_lock)</span></span>; </span><br><span class="line"><span class="comment">// adopt_guardä¸ºç»“æ„ä½“å¯¹è±¡ï¼Œèµ·ä¸€ä¸ªæ ‡è®°ä½œç”¨ï¼Œè¡¨ç¤ºè¿™ä¸ªäº’æ–¥é‡å·²ç»lock()ï¼Œä¸éœ€è¦åœ¨lock()ã€‚</span></span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;list&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">inMsgRecvQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; ++i) &#123;</span><br><span class="line">			<span class="built_in">cout</span> &lt;&lt; <span class="string">"æ’å…¥ä¸€ä¸ªå…ƒç´ "</span> &lt;&lt; i &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">				<span class="comment">//lock_guard&lt;mutex&gt; sbguard(myMutex1, adopt_lock);</span></span><br><span class="line">				lock(myMutex1, myMutex2);</span><br><span class="line">				<span class="comment">//myMutex2.lock();</span></span><br><span class="line">				<span class="comment">//myMutex1.lock();</span></span><br><span class="line">				msgRecvQueue.push_back(i);</span><br><span class="line">				myMutex1.unlock();</span><br><span class="line">				myMutex2.unlock();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">outMsgLULProc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		myMutex1.lock();</span><br><span class="line">		myMutex2.lock();</span><br><span class="line">		<span class="keyword">if</span> (!msgRecvQueue.empty()) &#123;</span><br><span class="line">			<span class="built_in">cout</span> &lt;&lt; <span class="string">"åˆ é™¤å…ƒç´ "</span> &lt;&lt; msgRecvQueue.front() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">			msgRecvQueue.pop_front();</span><br><span class="line">			myMutex2.unlock();</span><br><span class="line">			myMutex1.unlock();</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		myMutex2.unlock();</span><br><span class="line">		myMutex1.unlock();</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">outMsgRecvQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; ++i) &#123;</span><br><span class="line">			<span class="keyword">if</span> (outMsgLULProc()) &#123;&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="built_in">cout</span> &lt;&lt; <span class="string">"æ•°ç»„ä¸ºç©º"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="built_in">list</span>&lt;<span class="keyword">int</span>&gt; msgRecvQueue;</span><br><span class="line">	mutex myMutex1;</span><br><span class="line">	mutex myMutex2;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	A myobja;</span><br><span class="line">	mutex myMutex;</span><br><span class="line">	<span class="function">thread <span class="title">myOutMsgObj</span><span class="params">(&amp;A::outMsgRecvQueue, &amp;myobja)</span></span>;</span><br><span class="line">	<span class="function">thread <span class="title">myInMsgObj</span><span class="params">(&amp;A::inMsgRecvQueue, &amp;myobja)</span></span>;</span><br><span class="line">	myOutMsgObj.join();</span><br><span class="line">	myInMsgObj.join();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="äº”ã€unique-lock-æ¨¡æ¿ç±»"><a class="header-anchor" href="#äº”ã€unique-lock-æ¨¡æ¿ç±»">Â¶</a>äº”ã€unique_lock æ¨¡æ¿ç±»</h3><ul><li><strong><code>unique_lock</code></strong> å–ä»£ <strong><code>lock_guard</code></strong> ï¼ˆä¼˜ç‚¹ï¼šçµæ´»ï¼Œç¼ºç‚¹ï¼šæ•ˆç‡é™ä½ï¼‰</li><li><strong><code>unique_lock</code></strong> çš„ç¬¬äºŒä¸ªå‚æ•°ï¼š <strong><code>std::adopt_lockï¼Œstd::try_to_lockï¼Œstd::defer_lock</code></strong></li><li><strong><code>unique_lock</code></strong> çš„æˆå‘˜å‡½æ•°ï¼š <strong><code>lock()ï¼Œunlock()ï¼Œtry_lock()ï¼Œrelease()</code></strong></li><li><strong><code>unique_lock</code></strong> æ‰€æœ‰æƒçš„ä¼ é€’</li></ul><h4 id="5-1-unique-lock-çš„ç¬¬äºŒä¸ªå‚æ•°"><a class="header-anchor" href="#5-1-unique-lock-çš„ç¬¬äºŒä¸ªå‚æ•°">Â¶</a>5.1 unique_lock çš„ç¬¬äºŒä¸ªå‚æ•°:</h4><p><strong><code>std::adopt_lock</code></strong></p><ul><li>è¡¨ç¤ºè¿™ä¸ªäº’æ–¥é‡å·²ç»è¢« <strong><code>lock()</code></strong> ï¼Œå³ä¸éœ€è¦åœ¨æ„é€ å‡½æ•°ä¸­ lock è¿™ä¸ªäº’æ–¥é‡</li><li><strong><font color="FF0000">å‰æå¿…é¡»æå‰lock</font></strong>ï¼Œ <strong><code>lock_guard</code></strong> ä¹Ÿå¯ä»¥ç”¨è¿™ä¸ªå‚æ•°</li></ul><p><strong><code>std::try_to_lock</code></strong></p><ul><li>å°è¯•ç”¨ mutex çš„ <strong><code>lock()</code></strong> å»é”å®šè¿™ä¸ª mutexï¼Œå¦‚æœæ²¡æœ‰æˆåŠŸï¼Œä¼šç«‹å³è¿”å›ï¼Œä¸ä¼šé˜»å¡ã€‚</li><li>ä½¿ç”¨ <strong><code>try_to_lock()</code></strong> çš„åŸå› æ˜¯ï¼šé˜²æ­¢å…¶ä»–çš„çº¿ç¨‹é”å®šçš„ mutex å¤ªé•¿æ—¶é—´ï¼Œå¯¼è‡´æœ¬çº¿ç¨‹ä¸€ç›´é˜»å¡åœ¨ lock è¿™ä¸ªåœ°æ–¹</li><li><font color="FF0000"><strong>å‰æä¸èƒ½æå‰ lock()</strong></font></li><li><strong><code>owns_lock()</code></strong> æ–¹æ³•åˆ¤æ–­æ˜¯å¦æ‹¿åˆ°é”ï¼Œå¦‚æœæ‹¿åˆ°è¿”å› true</li></ul><p><strong><code>std::defer_lock</code></strong></p><ul><li>å¦‚æœæ²¡æœ‰ç¬¬äºŒä¸ªå‚æ•°å°±å¯¹ mutex åŠ é”ï¼ŒåŠ ä¸Š <strong><code>defer_lock</code></strong> æ˜¯åˆå§‹åŒ–ä¸€ä¸ªæ²¡æœ‰åŠ é”çš„mutex</li><li>ä¸ç»™ä»–åŠ é”çš„ç›®çš„æ˜¯ä»¥åå¯ä»¥è°ƒç”¨ <strong><code>unique_lock</code></strong> çš„ä¸€äº›æ–¹æ³•</li><li><font color="FF0000"><strong>å‰æä¸èƒ½æå‰ lock()</strong></font></li></ul><p><strong>unique_lockçš„æˆå‘˜å‡½æ•°ï¼ˆå‰ä¸‰ä¸ªä¸ <code>std::defer_lock</code> è”åˆä½¿ç”¨ï¼‰</strong></p><p><strong><code>lock()</code></strong> ï¼šåŠ é”</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">unique_lock&lt;mutex&gt; <span class="title">myUniLock</span><span class="params">(myMutex, defer_lock)</span></span>; <span class="comment">// æœ¬è´¨æ˜¯æ‰€æœ‰æƒçš„è½¬ç§»</span></span><br><span class="line">myUniLock.lock(); <span class="comment">// ä¸ç”¨è‡ªå·± unlock</span></span><br></pre></td></tr></table></figure><p><strong><code>unlock()</code></strong> ï¼šè§£é”</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">unique_lock&lt;mutex&gt; <span class="title">myUniLock</span><span class="params">(myMutex, defer_lock)</span></span>;</span><br><span class="line">myUniLock.lock();</span><br><span class="line"><span class="comment">// .... å¤„ç†ä¸€äº›å…±äº«ä»£ç </span></span><br><span class="line">myUniLock.unlock();</span><br><span class="line"><span class="comment">// .... å¤„ç†ä¸€äº›éå…±äº«ä»£ç </span></span><br><span class="line"><span class="comment">// .... é‡Šæ”¾é”ç»™å…¶ä»–çº¿ç¨‹ï¼Œé˜²æ­¢å…¶ä»–çº¿ç¨‹è¿‡é•¿æ—¶é—´ç­‰å¾…</span></span><br><span class="line">myUniLock.lock();</span><br><span class="line"><span class="comment">// .... å¤„ç†ä¸€äº›å…±äº«ä»£ç </span></span><br></pre></td></tr></table></figure><p><strong><code>try_lock()</code></strong> ï¼šå°è¯•ç»™äº’æ–¥é‡åŠ é”ï¼Œå¦‚æœæ‹¿ä¸åˆ°è¿”å› falseï¼Œå¦åˆ™è¿”å› trueã€‚</p><p><strong><code>release()</code></strong> :</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">unique_lock&lt;mutex&gt; <span class="title">myUniLock</span><span class="params">(myMutex)</span></span>; <span class="comment">// ç›¸å½“äºæŠŠmyMutex å’Œ myUniLockç»‘å®šåœ¨ä¸€èµ·ï¼Œrelease()å°±æ˜¯æ¥è§¦ç»‘å®šï¼Œè¿”å›å®ƒæ‰€ç®¡ç†çš„mutexå¯¹è±¡çš„æŒ‡é’ˆï¼Œå¹¶é‡Šæ”¾æ‰€æœ‰æƒ</span></span><br><span class="line">mutex* ptr = myUniLock.<span class="built_in">release</span>(); <span class="comment">// ç”±åŸæ¥çš„mutexå¯¹è±¡å¤„ç†åŠ é”çŠ¶æ€ï¼Œå°±éœ€è¦ptråœ¨ä»¥åè¿›è¡Œè§£é”ï¼Œä¾‹å¦‚  ptr-&gt;unlock();</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼š</p><ul><li>lock çš„ä»£ç æ®µè¶Šå°‘ï¼Œæ‰§è¡Œè¶Šå¿«ï¼Œæ•´ä¸ªç¨‹åºçš„è¿è¡Œæ•ˆç‡è¶Šé«˜<ul><li>é”ä½çš„ä»£ç å°‘ -&gt; ç»†ç²’åº¦ -&gt; æ‰§è¡Œæ•ˆç‡é«˜</li><li>é”ä½çš„ä»£ç å¤š -&gt; ç²—ç²’åº¦ -&gt; æ‰§è¡Œæ•ˆç‡ä½</li></ul></li></ul><p><strong>unique_lockæ‰€æœ‰æƒçš„ä¼ é€’</strong></p><ul><li>ä½¿ç”¨ move è½¬ç§»</li></ul><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åªèƒ½é€šè¿‡ç§»åŠ¨è¯­å¥è½¬ç§»æ‰€æœ‰æƒï¼Œä¸èƒ½ä½¿ç”¨æ‹·è´</span></span><br><span class="line"><span class="function">unique_lock&lt;mutex&gt; <span class="title">myUniLock1</span><span class="params">(myMutex)</span></span>;</span><br><span class="line"><span class="function">unique_lock&lt;mutex&gt; <span class="title">myUniLock2</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">move</span>(myUniLock1))</span></span>;</span><br></pre></td></tr></table></figure><ul><li>return ä¸€ä¸ªä¸´æ—¶å˜é‡ï¼Œå³å¯å®ç°è½¬ç§»</li></ul><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">unique_lock&lt;mutex&gt; <span class="title">aFuc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">unique_lock&lt;mutex&gt; <span class="title">myUniLock</span><span class="params">(myMutex)</span></span>;</span><br><span class="line">    <span class="comment">// ç³»ç»Ÿä¼šç”Ÿæˆä¸´æ—¶çš„ unique_lock å¯¹è±¡è°ƒç”¨å®ƒçš„ç§»åŠ¨æ„é€ å‡½æ•°ã€‚</span></span><br><span class="line">    <span class="keyword">return</span> myUniLock;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å…­ã€å•ä¾‹è®¾è®¡æ¨¡å¼å…±äº«æ•°æ®é—®é¢˜åˆ†æã€è§£å†³ï¼Œcall-once"><a class="header-anchor" href="#å…­ã€å•ä¾‹è®¾è®¡æ¨¡å¼å…±äº«æ•°æ®é—®é¢˜åˆ†æã€è§£å†³ï¼Œcall-once">Â¶</a>å…­ã€å•ä¾‹è®¾è®¡æ¨¡å¼å…±äº«æ•°æ®é—®é¢˜åˆ†æã€è§£å†³ï¼Œcall_once</h3><ul><li>å•ä¾‹è®¾è®¡æ¨¡å¼ï¼šé¡¹ç›®ä¸­ï¼Œæœ‰æŸä¸ªæˆ–è€…æŸäº›ç‰¹æ®Šçš„ç±»ï¼Œåªèƒ½åˆ›å»ºä¸€ä¸ªå±äºè¯¥ç±»çš„å¯¹è±¡ã€‚</li><li>å•ä¾‹è®¾è®¡æ¨¡å¼å…±äº«æ•°æ®é—®é¢˜åˆ†æã€è§£å†³</li><li><strong><code>std::call_once()</code></strong></li></ul><h4 id="6-1-å•ä¾‹æ¨¡å¼å…±äº«æ•°æ®é—®é¢˜åˆ†æã€è§£å†³"><a class="header-anchor" href="#6-1-å•ä¾‹æ¨¡å¼å…±äº«æ•°æ®é—®é¢˜åˆ†æã€è§£å†³">Â¶</a>6.1 å•ä¾‹æ¨¡å¼å…±äº«æ•°æ®é—®é¢˜åˆ†æã€è§£å†³</h4><p><strong>é¢ä¸´é—®é¢˜</strong>ï¼šéœ€è¦åœ¨è‡ªå·±åˆ›å»ºçš„çº¿ç¨‹ä¸­æ¥åˆ›å»ºå•ä¾‹ç±»çš„å¯¹è±¡ï¼Œè¿™ç§çº¿ç¨‹å¯èƒ½ä¸æ­¢ä¸€ä¸ªï¼Œå¯èƒ½æ“ä½œ <strong><code>GetInstance()</code></strong> è¿™ç§æˆå‘˜å‡½æ•°éœ€è¦äº’æ–¥ã€‚</p><p><strong>æŠ€å·§</strong>ï¼šå¯ä»¥åœ¨åŠ é”å‰åˆ¤æ–­ <strong><code>m_instance</code></strong> æ˜¯å¦ä¸ºç©ºï¼Œå¦åˆ™æ¯æ¬¡è°ƒç”¨ <strong><code>Singlton::getInstance()</code></strong> éƒ½è¦è¿›è¡ŒåŠ é”ï¼Œååˆ†å½±å“æ•ˆç‡ã€‚<strong><font color="FF0000">ï¼ˆåŒé‡é”å®šï¼‰</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;	</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span>	<span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line">mutex myMutex;</span><br><span class="line"><span class="comment">// æ‡’æ±‰æ¨¡å¼ï¼Œåœ¨åˆæ¬¡ä½¿ç”¨çš„æ—¶å€™åˆ›å»ºå¯¹è±¡</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singelton</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">static</span> Singelton * <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//åŒé‡é”å®š æé«˜æ•ˆç‡</span></span><br><span class="line">		<span class="keyword">if</span> (instance == <span class="literal">NULL</span>) &#123;</span><br><span class="line">			<span class="function">lock_guard&lt;mutex&gt; <span class="title">myLockGua</span><span class="params">(myMutex)</span></span>;</span><br><span class="line">			<span class="keyword">if</span> (instance == <span class="literal">NULL</span>) &#123;</span><br><span class="line">				instance = <span class="keyword">new</span> Singelton;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> instance;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	Singelton() &#123;&#125;</span><br><span class="line">	<span class="keyword">static</span> Singelton *instance;</span><br><span class="line">&#125;;</span><br><span class="line">Singelton * Singelton::instance = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é¥¿æ±‰æ¨¡å¼ï¼Œåœ¨ç±»å¤–å…ˆåˆ›å»ºå¯¹è±¡</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singelton2</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">static</span> Singelton2* <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> instance;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	Singelton2() &#123;&#125;</span><br><span class="line">	<span class="keyword">static</span> Singelton2 * instance;</span><br><span class="line">&#125;;</span><br><span class="line">Singelton2 * Singelton2::instance = <span class="keyword">new</span> Singelton2;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	Singelton * singer = Singelton::getInstance();</span><br><span class="line">	Singelton * singer2 = Singelton::getInstance();</span><br><span class="line">	<span class="keyword">if</span> (singer == singer2)</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"äºŒè€…æ˜¯åŒä¸€ä¸ªå®ä¾‹"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"äºŒè€…ä¸æ˜¯åŒä¸€ä¸ªå®ä¾‹"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"----------	ä»¥ä¸‹æ˜¯ é¥¿æ±‰æ¨¡å¼  ------------"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	Singelton2 * singer3 = Singelton2::getInstance();</span><br><span class="line">	Singelton2 * singer4 = Singelton2::getInstance();</span><br><span class="line">	<span class="keyword">if</span> (singer3 == singer4)</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"äºŒè€…æ˜¯åŒä¸€ä¸ªå®ä¾‹"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"äºŒè€…ä¸æ˜¯åŒä¸€ä¸ªå®ä¾‹"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å¦‚æœè§‰å¾—åœ¨å•ä¾‹æ¨¡å¼ä¸­ new äº†ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œæ²¡æœ‰è‡ªå·±delete</strong> ï¼Œä¸åˆç†ï¼Œå¯ä»¥å¢åŠ ä¸€ä¸ªç±»ä¸­ç±» <strong><code>CGarHuiShou</code></strong> ï¼Œ<strong>new</strong> ä¸€ä¸ªå•ä¾‹ç±»æ—¶åˆ›å»ºä¸€ä¸ªé™æ€çš„ <strong><code>CGarhuishou</code></strong> å¯¹è±¡ï¼Œè¿™æ ·åœ¨ç¨‹åºç»“æŸæ—¶ä¼šè°ƒç”¨ <strong><code>CGarhuishou</code></strong> çš„ææ„å‡½æ•°ï¼Œé‡Šæ”¾æ‰ <strong>new</strong> å‡ºæ¥çš„å•ä¾‹å¯¹è±¡ã€‚<strong><font color="FF0000">(æŠ€å·§)</font></strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singelton</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">static</span> Singelton * <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">NULL</span>) &#123;</span><br><span class="line">            <span class="comment">// å®šä¹‰ä¸€ä¸ªé™æ€å¯¹è±¡ï¼Œè¯¥é™æ€å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸéšç¨‹åºç»“æŸæ‰ä¸­æ–­</span></span><br><span class="line">			<span class="keyword">static</span> CGarhuishou huishou;</span><br><span class="line">			instance = <span class="keyword">new</span> Singelton;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">CGarhuishou</span> &#123;</span></span><br><span class="line">	<span class="keyword">public</span>:</span><br><span class="line">        <span class="comment">// å®šä¹‰ææ„å‡½æ•°</span></span><br><span class="line">		~CGarhuishou() &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœææ„çš„æ—¶å€™å†…å­˜è¿˜æœªé‡Šæ”¾ï¼Œä¸»åŠ¨é‡Šæ”¾</span></span><br><span class="line">			<span class="keyword">if</span> (Singelton::instance)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">delete</span> Singelton::instance;</span><br><span class="line">				Singelton::instance = <span class="literal">NULL</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	Singelton() &#123;&#125;</span><br><span class="line">	<span class="keyword">static</span> Singelton *instance;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="6-2-std-call-once"><a class="header-anchor" href="#6-2-std-call-once">Â¶</a>6.2 <strong><code>std::call_once()</code></strong></h4><p>å‡½æ•°æ¨¡æ¿ï¼Œè¯¥å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸º<strong>æ ‡è®°</strong>ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°åï¼ˆå¦‚a()ï¼‰ã€‚<br>åŠŸèƒ½ï¼šèƒ½å¤Ÿä¿è¯å‡½æ•°a()åªè¢«è°ƒç”¨ä¸€æ¬¡ã€‚å…·å¤‡äº’æ–¥é‡çš„èƒ½åŠ›ï¼Œè€Œä¸”æ¯”äº’æ–¥é‡æ¶ˆè€—çš„èµ„æºæ›´å°‘ï¼Œæ›´é«˜æ•ˆã€‚<br><strong><code>call_once()</code></strong> éœ€è¦ä¸ä¸€ä¸ªæ ‡è®°ç»“åˆä½¿ç”¨ï¼Œè¿™ä¸ªæ ‡è®°ä¸º <strong><code>std::once_flag</code></strong> ï¼›å…¶å® <strong><code>once_flag</code></strong> æ˜¯ä¸€ä¸ªç»“æ„ï¼Œ <strong><code>call_once()</code></strong> å°±æ˜¯é€šè¿‡æ ‡è®°æ¥å†³å®šå‡½æ•°æ˜¯å¦æ‰§è¡Œï¼Œè°ƒç”¨æˆåŠŸåï¼Œå°±æŠŠæ ‡è®°è®¾ç½®ä¸ºä¸€ç§å·²è°ƒç”¨çŠ¶æ€ã€‚</p><p>å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œæ—¶ï¼Œä¸€ä¸ªçº¿ç¨‹ä¼šç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹å…ˆæ‰§è¡Œã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">std</span>::once_flag g_flag;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singelton</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">CreateInstance</span><span class="params">()</span> </span>&#123; </span><br><span class="line">        instance = <span class="keyword">new</span> Singelton;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œåˆ°è¿™é‡Œï¼Œå…¶ä¸­ä¸€ä¸ªçº¿ç¨‹è¦ç­‰å¦å¤–ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ¯•</span></span><br><span class="line">	<span class="function"><span class="keyword">static</span> Singelton * <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         <span class="comment">// call_once ä¿è¯å…¶åªè¢«è°ƒç”¨ä¸€æ¬¡</span></span><br><span class="line">         call_once(g_flag, CreateInstance);</span><br><span class="line">         <span class="keyword">return</span> instance;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	Singelton() &#123;&#125;</span><br><span class="line">	<span class="keyword">static</span> Singelton *instance;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// æ‡’æ±‰æ¨¡å¼</span></span><br><span class="line">Singelton * Singelton::instance = <span class="literal">NULL</span>;</span><br></pre></td></tr></table></figure><h3 id="ä¸ƒã€condition-variableã€waitã€notify-oneã€notify-all"><a class="header-anchor" href="#ä¸ƒã€condition-variableã€waitã€notify-oneã€notify-all">Â¶</a>ä¸ƒã€condition_variableã€waitã€notify_oneã€notify_all</h3><ul><li>æ¡ä»¶å˜é‡ <strong><code>std::condition_variable</code>ã€<code>wait()</code>ã€<code>notify_one()</code>ã€<code>notify_all</code></strong></li></ul><p><strong><code>std::condition_variable</code></strong> å®é™…ä¸Šæ˜¯ä¸€ä¸ªç±»ï¼Œæ˜¯ä¸€ä¸ªå’Œæ¡ä»¶ç›¸å…³çš„ç±»ï¼Œå°±æ˜¯ç­‰å¾…ä¸€ä¸ªæ¡ä»¶æˆç«‹ã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">std</span>::mutex mymutex1;</span><br><span class="line"><span class="function"><span class="built_in">std</span>::unique_lock&lt;<span class="built_in">std</span>::mutex&gt; <span class="title">sbguard1</span><span class="params">(mymutex1)</span></span>;</span><br><span class="line"><span class="built_in">std</span>::condition_variable condition;</span><br><span class="line">condition.wait(sbguard1, </span><br><span class="line">               [<span class="keyword">this</span>]()&#123; <span class="keyword">if</span> (!msgRecvQueue.empty()) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                         <span class="keyword">else</span> <span class="keyword">return</span> <span class="literal">false</span>; &#125;);</span><br><span class="line">condition.wait(sbguard1);</span><br></pre></td></tr></table></figure><p><strong><code>wait()</code></strong> ç”¨æ¥ç­‰ä¸€ä¸ªä¸œè¥¿</p><ul><li>å¦‚æœç¬¬äºŒä¸ªå‚æ•°çš„lambdaè¡¨è¾¾å¼è¿”å›å€¼æ˜¯ <strong>false</strong>ï¼Œ <strong><code>wait()</code></strong> å°†è§£é”äº’æ–¥é‡å¹¶é˜»å¡åˆ°æœ¬è¡Œ</li><li>å¦‚æœç¬¬äºŒä¸ªå‚æ•°çš„lambdaè¡¨è¾¾å¼è¿”å›å€¼æ˜¯ <strong>true</strong>ï¼Œ <strong><code>wait()</code></strong> ç›´æ¥è¿”å›å¹¶ç»§ç»­æ‰§è¡Œ</li></ul><p>**é˜»å¡åˆ°ä»€ä¹ˆæ—¶å€™ä¸ºæ­¢å‘¢ï¼Ÿ**é˜»å¡åˆ°å…¶ä»–<u>æŸä¸ªçº¿ç¨‹è°ƒç”¨ <strong><code>notify_one()</code></strong> æˆå‘˜å‡½æ•°</u>ä¸ºæ­¢ï¼›</p><p>å¦‚æœæ²¡æœ‰ç¬¬äºŒä¸ªå‚æ•°ï¼Œé‚£ä¹ˆæ•ˆæœè·Ÿç¬¬äºŒä¸ªå‚æ•°lambdaè¡¨è¾¾å¼è¿”å› <strong>false</strong> æ•ˆæœä¸€æ · <strong><code>wait()</code></strong> å°†è§£é”äº’æ–¥é‡ï¼Œå¹¶é˜»å¡åˆ°æœ¬è¡Œï¼Œé˜»å¡åˆ°å…¶ä»–æŸä¸ªçº¿ç¨‹è°ƒç”¨ <strong><code>notify_one()</code></strong> æˆå‘˜å‡½æ•°ä¸ºæ­¢ã€‚</p><p>å½“å…¶ä»–çº¿ç¨‹ç”¨ <strong><code>notify_one()</code></strong> å°†æœ¬çº¿ç¨‹ <strong><code>wait()</code></strong> å”¤é†’åï¼Œè¿™ä¸ª **<code>wait()</code>**æ¢å¤å<br>1ã€ <strong><code>wait()</code></strong> ä¸æ–­å°è¯•è·å–äº’æ–¥é‡é”ï¼Œå¦‚æœè·å–ä¸åˆ°ï¼Œé‚£ä¹ˆæµç¨‹å°±å¡åœ¨ <strong><code>wait()</code></strong> è¿™é‡Œç­‰å¾…è·å–ï¼›å¦‚æœè·å–åˆ°äº†ï¼Œé‚£ä¹ˆ <strong><code>wait()</code></strong> å°±ç»§ç»­æ‰§è¡Œï¼Œè·å–åˆ°äº†é”ã€‚</p><p>2ã€å¦‚æœ <strong><code>wait()</code></strong> æœ‰ç¬¬äºŒä¸ªå‚æ•°å°±åˆ¤æ–­è¿™ä¸ª lambda è¡¨è¾¾å¼ã€‚</p><p>a) å¦‚æœè¡¨è¾¾å¼ä¸º <strong>false</strong>ï¼Œ<strong>é‚£ wait åˆå¯¹äº’æ–¥é‡è§£é”ï¼Œç„¶ååˆä¼‘çœ </strong>ï¼Œç­‰å¾…å†æ¬¡è¢«**<code>notify_one()</code><strong>å”¤é†’<br>b) å¦‚æœlambdaè¡¨è¾¾å¼ä¸º <strong>true</strong>ï¼Œåˆ™ <strong><code>wait()</code></strong> è¿”å›ï¼Œæµç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œï¼ˆ</strong><font color="FF0000">æ­¤æ—¶äº’æ–¥é‡å·²è¢«é”ä½</font>**ï¼‰ï¼Œå¦‚æœwaitæ²¡æœ‰ç¬¬äºŒä¸ªå‚æ•°ï¼Œåˆ™ **<code>wait()</code>**è¿”å›ï¼Œæµç¨‹èµ°ä¸‹å»ã€‚</p><p>æµç¨‹åªè¦èµ°åˆ°äº† <strong><code>wait()</code></strong> ä¸‹é¢åˆ™äº’æ–¥é‡ä¸€å®šè¢«é”ä½äº†ã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;list&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inMsgRecvQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; ++i) &#123;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; <span class="string">"inMsgRecvQueueæ’å…¥ä¸€ä¸ªå…ƒç´ "</span> &lt;&lt; i &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">            <span class="function"><span class="built_in">std</span>::unique_lock&lt;<span class="built_in">std</span>::mutex&gt; <span class="title">sbguard1</span><span class="params">(mymutex1)</span></span>;</span><br><span class="line">            msgRecvQueue.push_back(i); </span><br><span class="line">            <span class="comment">// å°è¯•æŠŠ wait()çº¿ç¨‹å”¤é†’,æ‰§è¡Œå®Œè¿™è¡Œï¼Œ</span></span><br><span class="line">            <span class="comment">// é‚£ä¹ˆ outMsgRecvQueue()é‡Œçš„ wait()å°±ä¼šè¢«å”¤é†’</span></span><br><span class="line">            <span class="comment">// åªæœ‰å½“å¦å¤–ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨æ‰§è¡Œwait()æ—¶ notify_one() æ‰ä¼šèµ·æ•ˆï¼Œ</span></span><br><span class="line">            <span class="comment">// å¦åˆ™æ²¡æœ‰ä½œç”¨</span></span><br><span class="line">            condition.notify_one();</span><br><span class="line">        &#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">outMsgRecvQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> command = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="function"><span class="built_in">std</span>::unique_lock&lt;<span class="built_in">std</span>::mutex&gt; <span class="title">sbguard2</span><span class="params">(mymutex1)</span></span>;</span><br><span class="line">            <span class="comment">// wait()ç”¨æ¥ç­‰ä¸€ä¸ªä¸œè¥¿</span></span><br><span class="line">            <span class="comment">// å¦‚æœç¬¬äºŒä¸ªå‚æ•°çš„lambdaè¡¨è¾¾å¼è¿”å›å€¼æ˜¯falseï¼Œ</span></span><br><span class="line">            <span class="comment">// é‚£ä¹ˆwait()å°†è§£é”äº’æ–¥é‡ï¼Œå¹¶é˜»å¡åˆ°æœ¬è¡Œ</span></span><br><span class="line">            <span class="comment">// é˜»å¡åˆ°ä»€ä¹ˆæ—¶å€™ä¸ºæ­¢å‘¢ï¼Ÿ</span></span><br><span class="line">            <span class="comment">// é˜»å¡åˆ°å…¶ä»–æŸä¸ªçº¿ç¨‹è°ƒç”¨notify_one()æˆå‘˜å‡½æ•°ä¸ºæ­¢ï¼›</span></span><br><span class="line">            <span class="comment">// å½“ wait() è¢« notify_one()æ¿€æ´»æ—¶ï¼Œ </span></span><br><span class="line">            <span class="comment">// ä¼šå…ˆæ‰§è¡Œå®ƒçš„æ¡ä»¶åˆ¤æ–­è¡¨è¾¾å¼æ˜¯å¦ä¸º trueï¼Œ</span></span><br><span class="line">            <span class="comment">// å¦‚æœä¸ºtrueæ‰ä¼šç»§ç»­å¾€ä¸‹æ‰§è¡Œ</span></span><br><span class="line">            condition.wait(sbguard2, [<span class="keyword">this</span>] &#123;</span><br><span class="line">                <span class="keyword">if</span> (!msgRecvQueue.empty())</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;&#125;);</span><br><span class="line">            command = msgRecvQueue.front();</span><br><span class="line">            msgRecvQueue.pop_front();</span><br><span class="line">            <span class="comment">// å› ä¸ºunique_lockçš„çµæ´»æ€§ï¼Œæˆ‘ä»¬å¯ä»¥éšæ—¶unlockï¼Œä»¥å…é”ä½å¤ªé•¿æ—¶é—´</span></span><br><span class="line">            sbguard2.unlock(); </span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; <span class="string">"outMsgRecvQueue()æ‰§è¡Œï¼Œå–å‡ºç¬¬ä¸€ä¸ªå…ƒç´ "</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        &#125;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">list</span>&lt;<span class="keyword">int</span>&gt; msgRecvQueue;</span><br><span class="line">	<span class="built_in">std</span>::mutex mymutex1;</span><br><span class="line">	<span class="built_in">std</span>::condition_variable condition;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	A myobja;</span><br><span class="line">	<span class="function"><span class="built_in">std</span>::thread <span class="title">myoutobj</span><span class="params">(&amp;A::outMsgRecvQueue, &amp;myobja)</span></span>;</span><br><span class="line">	<span class="function"><span class="built_in">std</span>::thread <span class="title">myinobj</span><span class="params">(&amp;A::inMsgRecvQueue, &amp;myobja)</span></span>;</span><br><span class="line">	myinobj.join();</span><br><span class="line">	myoutobj.join();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ·±å…¥æ€è€ƒ</strong></p><p>ä¸Šé¢çš„ä»£ç å¯èƒ½å¯¼è‡´å‡ºç°ä¸€ç§æƒ…å†µï¼š<br>å› ä¸º <strong><code>outMsgRecvQueue()</code></strong> ä¸ <strong><code>inMsgRecvQueue()</code></strong> å¹¶ä¸æ˜¯ä¸€å¯¹ä¸€æ‰§è¡Œçš„ï¼Œæ‰€ä»¥å½“ç¨‹åºå¾ªç¯æ‰§è¡Œå¾ˆå¤šæ¬¡ä»¥åï¼Œå¯èƒ½åœ¨ <strong><code>msgRecvQueue</code></strong> ä¸­å·²ç»æœ‰äº†å¾ˆå¤šæ¶ˆæ¯ï¼Œä½†æ˜¯ <strong><code>outMsgRecvQueue</code></strong> è¿˜æ˜¯è¢«å”¤é†’ä¸€æ¬¡åªå¤„ç†ä¸€æ¡æ•°æ®ã€‚</p><p>è¿™æ—¶å¯ä»¥è€ƒè™‘æŠŠ <strong><code>outMsgRecvQueue</code></strong> å¤šæ‰§è¡Œå‡ æ¬¡ï¼Œæˆ–è€…å¯¹ <strong><code>inMsgRecvQueue</code></strong> è¿›è¡Œé™æµã€‚</p><p><strong><code>notify_one()</code></strong> ï¼šé€šçŸ¥ä¸€ä¸ªçº¿ç¨‹çš„ <strong><code>wait()</code></strong></p><p><strong><code>notify_all()</code></strong> ï¼šé€šçŸ¥æ‰€æœ‰çº¿ç¨‹çš„ <strong><code>wait()</code></strong></p><h3 id="å…«ã€asyncã€futureã€packaged-taskã€promise"><a class="header-anchor" href="#å…«ã€asyncã€futureã€packaged-taskã€promise">Â¶</a><strong>å…«ã€asyncã€futureã€packaged_taskã€promise</strong></h3><ul><li><strong><code>std::async</code></strong> ã€ <strong><code>std::future</code></strong> åˆ›å»ºåå°ä»»åŠ¡å¹¶è¿”å›å€¼</li><li><strong><code>std::packaged_task</code></strong></li><li><strong><code>std::promise</code></strong></li></ul><h4 id="8-1-std-asyncã€std-future-åˆ›å»ºåå°ä»»åŠ¡å¹¶è¿”å›å€¼"><a class="header-anchor" href="#8-1-std-asyncã€std-future-åˆ›å»ºåå°ä»»åŠ¡å¹¶è¿”å›å€¼">Â¶</a>8.1 <strong><code>std::async</code>ã€<code>std::future</code> åˆ›å»ºåå°ä»»åŠ¡å¹¶è¿”å›å€¼</strong></h4><p>éœ€è¦åŒ…å«å¤´æ–‡ä»¶ <strong><code>#include &lt;future&gt;</code></strong></p><p><strong><code>std::async</code></strong> æ˜¯ä¸€ä¸ªå‡½æ•°æ¨¡æ¿ï¼Œç”¨æ¥å¯åŠ¨ä¸€ä¸ª**<font color="FF0000">å¼‚æ­¥ä»»åŠ¡</font><strong>ï¼Œå¯åŠ¨èµ·æ¥ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ä¹‹åï¼Œå®ƒè¿”å›ä¸€ä¸ª <strong><code>std::future</code></strong> å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æ˜¯ä¸ª</strong>ç±»æ¨¡æ¿**ã€‚</p><p>ä»€ä¹ˆå«â€œå¯åŠ¨ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡â€ï¼Ÿå°±æ˜¯è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œå¹¶å¼€å§‹æ‰§è¡Œå¯¹åº”çš„çº¿ç¨‹å…¥å£å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ª <strong><code>std::future</code></strong> å¯¹è±¡ï¼Œè¿™ä¸ª <strong><code>std::future</code></strong> å¯¹è±¡ä¸­å°±å«æœ‰çº¿ç¨‹å…¥å£å‡½æ•°æ‰€è¿”å›çš„ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨ <strong><code>std::future</code></strong> å¯¹è±¡çš„æˆå‘˜å‡½æ•° **<code>get()</code>**æ¥è·å–ç»“æœã€‚</p><p>â€œfutureâ€å°†æ¥çš„æ„æ€ï¼Œä¹Ÿæœ‰äººç§°å‘¼ <strong><code>std::future</code></strong> æä¾›äº†ä¸€ç§è®¿é—®å¼‚æ­¥æ“ä½œç»“æœçš„æœºåˆ¶ï¼Œå°±æ˜¯è¯´è¿™ä¸ªç»“æœä½ å¯èƒ½æ²¡åŠæ³•é©¬ä¸Šæ‹¿åˆ°ï¼Œä½†åœ¨ä¸ä¹…çš„å°†æ¥ï¼Œè¿™ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ¯•æ—¶ï¼Œä½ å°±èƒ½å¤Ÿæ‹¿åˆ°ç»“æœï¼Œ<strong>æ‰€ä»¥å¯ä»¥ç†è§£ä¸ºï¼šfutureä¸­ä¿å­˜ç€ä¸€ä¸ªå€¼ï¼Œè¿™ä¸ªå€¼æ˜¯åœ¨å°†æ¥çš„æŸä¸ªæ—¶åˆ»èƒ½å¤Ÿæ‹¿åˆ°ã€‚</strong></p><p>**<code>std::future</code>**å¯¹è±¡çš„ **<code>get()</code><strong>æˆå‘˜å‡½æ•°ä¼š</strong><font color="FF0000">ç­‰å¾…çº¿ç¨‹æ‰§è¡Œç»“æŸ</font>**å¹¶è¿”å›ç»“æœï¼Œæ‹¿ä¸åˆ°ç»“æœå®ƒå°±ä¼šä¸€ç›´ç­‰å¾…ï¼Œæ„Ÿè§‰æœ‰ç‚¹åƒ <strong><code>join()</code></strong> ä½†æ˜¯ï¼Œå®ƒæ˜¯å¯ä»¥è·å–ç»“æœçš„ã€‚</p><p>**<code>std::future</code>**å¯¹è±¡çš„ <strong><code>wait()</code></strong> æˆå‘˜å‡½æ•°ï¼Œç”¨äºç­‰å¾…çº¿ç¨‹è¿”å›ï¼Œ<strong>æœ¬èº«å¹¶ä¸è¿”å›ç»“æœ</strong>ï¼Œè¿™ä¸ªæ•ˆæœå’Œ <strong><code>std::thread</code></strong> çš„ <strong><code>join()</code></strong> æ›´åƒã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;future&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">mythread</span><span class="params">(<span class="keyword">int</span> mypar)</span> </span>&#123;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; mypar &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">return</span> mypar;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">mythread</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"mythread() start threadid = "</span> </span><br><span class="line">         &lt;&lt; <span class="built_in">std</span>::this_thread::get_id() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="comment">// å®šä¹‰ç¡çœ æ—¶é—´ 5S</span></span><br><span class="line">	<span class="built_in">std</span>::<span class="function">chrono::milliseconds <span class="title">dura</span><span class="params">(<span class="number">5000</span>)</span></span>;</span><br><span class="line">	<span class="built_in">std</span>::this_thread::sleep_for(dura); <span class="comment">// ç¡çœ </span></span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"mythread() end"</span> &lt;&lt; <span class="string">"threadid = "</span> </span><br><span class="line">         &lt;&lt; <span class="built_in">std</span>::this_thread::get_id() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"mainThreadid = "</span> &lt;&lt; <span class="built_in">std</span>::this_thread::get_id() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="comment">// æ™®é€šçº¿ç¨‹å‡½æ•°</span></span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">future</span>&lt;<span class="keyword">int</span>&gt; result1 = <span class="built_in">std</span>::async(mythread);</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"continue........"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¡åœ¨è¿™é‡Œç­‰å¾…mythread()æ‰§è¡Œå®Œæ¯•ï¼Œæ‹¿åˆ°ç»“æœ</span></span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; result1.<span class="built_in">get</span>() &lt;&lt; <span class="built_in">endl</span>; </span><br><span class="line">	</span><br><span class="line">	<span class="comment">// ç±»æˆå‘˜å‡½æ•°</span></span><br><span class="line">    <span class="comment">// ç¬¬äºŒä¸ªå‚æ•°æ˜¯å¯¹è±¡å¼•ç”¨æ‰èƒ½ä¿è¯çº¿ç¨‹é‡Œæ‰§è¡Œçš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">    A a;</span><br><span class="line">    <span class="keyword">int</span> tmp = <span class="number">12</span>;</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">future</span>&lt;<span class="keyword">int</span>&gt; result2 = <span class="built_in">std</span>::async(&amp;A::mythread, &amp;a, tmp); </span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; result2.<span class="built_in">get</span>() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="comment">// æˆ–è€… result2.wait(); -&gt; æ²¡æœ‰è¿”å›å€¼</span></span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"good luck"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡å‘ <strong><code>std::async()</code></strong> ä¼ é€’ä¸€ä¸ªå‚æ•°ï¼Œæ”¹å‚æ•°æ˜¯ <strong><code>std::launch</code></strong> ç±»å‹ï¼ˆæšä¸¾ç±»å‹ï¼‰ï¼Œæ¥è¾¾åˆ°ä¸€äº›ç‰¹æ®Šçš„ç›®çš„ï¼š</p><ul><li><strong><code>std::lunch::deferred</code></strong> (deferæ¨è¿Ÿï¼Œå»¶æœŸï¼‰</li></ul><p>è¡¨ç¤ºçº¿ç¨‹å…¥å£å‡½æ•°çš„è°ƒç”¨ä¼šè¢«å»¶è¿Ÿï¼Œä¸€ç›´åˆ° <strong><code>std::future</code></strong> çš„ <strong><code>wait()</code></strong> æˆ–è€… <strong><code>get()</code></strong> å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼ˆ<strong>ç”±ä¸»çº¿ç¨‹è°ƒç”¨</strong>ï¼‰æ‰ä¼šæ‰§è¡Œï¼›å¦‚æœ <strong><code>wait()</code></strong> æˆ–è€… <strong><code>get()</code></strong> æ²¡æœ‰è¢«è°ƒç”¨ï¼Œåˆ™ä¸ä¼šæ‰§è¡Œã€‚</p><p><strong><font color="FF0000">å®é™…ä¸Šæ ¹æœ¬å°±æ²¡æœ‰åˆ›å»ºæ–°çº¿ç¨‹</font>ã€‚ <code>std::lunch::deferred</code> æ„æ€æ—¶å»¶è¿Ÿè°ƒç”¨ï¼Œå¹¶æ²¡æœ‰åˆ›å»ºæ–°çº¿ç¨‹ï¼Œæ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨çš„çº¿ç¨‹å…¥å£å‡½æ•°ã€‚</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;future&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">mythread</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"mythread() start"</span> &lt;&lt; <span class="string">"threadid = "</span> </span><br><span class="line">         &lt;&lt; <span class="built_in">std</span>::this_thread::get_id() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="built_in">std</span>::<span class="function">chrono::milliseconds <span class="title">dura</span><span class="params">(<span class="number">5000</span>)</span></span>;</span><br><span class="line">	<span class="built_in">std</span>::this_thread::sleep_for(dura);</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"mythread() end"</span> &lt;&lt; <span class="string">"threadid = "</span> </span><br><span class="line">         &lt;&lt; <span class="built_in">std</span>::this_thread::get_id() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"mainThreadid = "</span> &lt;&lt; <span class="built_in">std</span>::this_thread::get_id() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">future</span>&lt;<span class="keyword">int</span>&gt; result1 = <span class="built_in">std</span>::async(<span class="built_in">std</span>::launch::deferred ,mythread);</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"continue........"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="comment">//å¡åœ¨è¿™é‡Œç­‰å¾…mythread()æ‰§è¡Œå®Œæ¯•ï¼Œæ‹¿åˆ°ç»“æœ</span></span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; result1.<span class="built_in">get</span>() &lt;&lt; <span class="built_in">endl</span>; </span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"good luck"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong><code>std::launch::async</code></strong> ï¼Œåœ¨è°ƒç”¨ async å‡½æ•°çš„æ—¶å€™å°±å¼€å§‹<strong>åˆ›å»ºæ–°çº¿ç¨‹</strong>ã€‚</li></ul><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"mainThreadid = "</span> &lt;&lt; <span class="built_in">std</span>::this_thread::get_id() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">future</span>&lt;<span class="keyword">int</span>&gt; result1 = <span class="built_in">std</span>::async(<span class="built_in">std</span>::launch::async ,mythread);</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"continue........"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; result1.<span class="built_in">get</span>() &lt;&lt; <span class="built_in">endl</span>; </span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"good luck"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="8-2-std-async-ç»­è°ˆ"><a class="header-anchor" href="#8-2-std-async-ç»­è°ˆ">Â¶</a>8.2 <code>std::async</code> ç»­è°ˆ</h4><p><strong><code>std::async</code></strong> å‚æ•°è¯¦è¿°ï¼Œasync ç”¨æ¥åˆ›å»ºä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡</p><ul><li><p><strong><code>std::launch::deferred</code></strong> ã€<strong>å»¶è¿Ÿè°ƒç”¨ï¼Œ(ä¸»çº¿ç¨‹è°ƒç”¨)</strong>ã€‘</p></li><li><p><strong><code>std::launch::async</code></strong> ã€<strong>å¼ºåˆ¶åˆ›å»ºä¸€ä¸ªçº¿ç¨‹</strong>ã€‘</p></li></ul><p><strong><code>std::async()</code></strong> ä¸€èˆ¬ä¸å«åˆ›å»ºçº¿ç¨‹ï¼ˆä»–èƒ½å¤Ÿåˆ›å»ºçº¿ç¨‹ï¼‰ï¼Œä¸€èˆ¬å«å®ƒåˆ›å»ºä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ã€‚</p><p><strong><code>std::async</code></strong> å’Œ <strong><code>std::thread</code></strong> æœ€æ˜æ˜¾çš„**<font color="FF0000">ä¸åŒ</font><strong>ï¼Œå°±æ˜¯ <strong>async</strong> æœ‰æ—¶å€™</strong>å¹¶ä¸åˆ›å»ºæ–°çº¿ç¨‹ã€‚**</p><p><strong>â‘  å¦‚æœç”¨<code>std::launch::deferred</code>æ¥è°ƒç”¨ asyncï¼Ÿ</strong></p><p>å»¶è¿Ÿåˆ°è°ƒç”¨ <strong><code>get()</code></strong> æˆ–è€… <strong><code>wait()</code></strong> æ—¶æ‰§è¡Œï¼Œå¦‚æœä¸è°ƒç”¨å°±ä¸ä¼šæ‰§è¡Œ</p><p><strong>â‘¡ å¦‚æœç”¨<code>std::launch::async</code>æ¥è°ƒç”¨ asyncï¼Ÿ</strong></p><p>å¼ºåˆ¶è¿™ä¸ªå¼‚æ­¥ä»»åŠ¡åœ¨æ–°çº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œè¿™æ„å‘³ç€ï¼Œç³»ç»Ÿå¿…é¡»è¦åˆ›å»ºå‡ºæ–°çº¿ç¨‹æ¥è¿è¡Œå…¥å£å‡½æ•°ã€‚</p><p><strong>â‘¢ å¦‚æœåŒæ—¶ç”¨ <code>std::launch::async | std::launch::deferred</code></strong></p><p>è¿™é‡Œè¿™ä¸ªæˆ–è€…å…³ç³»æ„å‘³ç€ <strong>async</strong> çš„è¡Œä¸ºå¯èƒ½æ˜¯ <strong><code>std::launch::async</code></strong> åˆ›å»ºæ–°çº¿ç¨‹ç«‹å³æ‰§è¡Œï¼Œ ä¹Ÿå¯èƒ½æ˜¯ <strong><code>std::launch::deferred</code></strong> æ²¡æœ‰åˆ›å»ºæ–°çº¿ç¨‹å¹¶ä¸”å»¶è¿Ÿåˆ°è°ƒç”¨ **<code>get()</code>**æ‰§è¡Œï¼Œç”±ç³»ç»Ÿæ ¹æ®å®é™…æƒ…å†µæ¥å†³å®šé‡‡å–å“ªç§æ–¹æ¡ˆã€‚</p><p><strong>â‘£ ä¸å¸¦é¢å¤–å‚æ•° <code>std::async(mythread)</code> ï¼Œåªç»™ async ä¸€ä¸ªå…¥å£å‡½æ•°å</strong></p><p>æ­¤æ—¶çš„ç³»ç»Ÿç»™çš„é»˜è®¤å€¼æ˜¯ <strong><code>std::launch::async | std::launch::deferred</code></strong> å’Œ â‘¢ ä¸€æ ·ï¼Œæœ‰ç³»ç»Ÿè‡ªè¡Œå†³å®šå¼‚æ­¥è¿˜æ˜¯åŒæ­¥è¿è¡Œã€‚</p><p><strong><code>std::async</code>å’Œ<code>std::thread()</code>åŒºåˆ«ï¼š</strong></p><p><strong><code>std::thread()</code></strong> å¦‚æœç³»ç»Ÿèµ„æºç´§å¼ å¯èƒ½å‡ºç°åˆ›å»ºçº¿ç¨‹å¤±è´¥çš„æƒ…å†µï¼Œå¦‚æœåˆ›å»ºçº¿ç¨‹å¤±è´¥é‚£ä¹ˆç¨‹åºå°±<strong>å¯èƒ½å´©æºƒ</strong>ï¼Œè€Œä¸”ä¸å®¹æ˜“æ‹¿åˆ°å‡½æ•°è¿”å›å€¼ï¼ˆä¸æ˜¯æ‹¿ä¸åˆ°ï¼‰<br><strong><code>std::async()</code></strong> åˆ›å»ºå¼‚æ­¥ä»»åŠ¡ã€‚å¯èƒ½åˆ›å»ºçº¿ç¨‹ä¹Ÿå¯èƒ½ä¸åˆ›å»ºçº¿ç¨‹ï¼Œå¹¶ä¸”å®¹æ˜“æ‹¿åˆ°çº¿ç¨‹å…¥å£å‡½æ•°çš„è¿”å›å€¼ï¼›</p><p>ç”±äºç³»ç»Ÿèµ„æºé™åˆ¶ï¼š<br>â‘  å¦‚æœç”¨ <strong><code>std::thread</code></strong> åˆ›å»ºçš„çº¿ç¨‹å¤ªå¤šï¼Œåˆ™å¯èƒ½åˆ›å»ºå¤±è´¥ï¼Œç³»ç»ŸæŠ¥å‘Šå¼‚å¸¸ï¼Œå´©æºƒã€‚</p><p>â‘¡ å¦‚æœç”¨ <strong><code>std::async</code></strong> ï¼Œä¸€èˆ¬å°±ä¸ä¼šæŠ¥å¼‚å¸¸ï¼Œå› ä¸ºå¦‚æœç³»ç»Ÿèµ„æºç´§å¼ ï¼Œæ— æ³•åˆ›å»ºæ–°çº¿ç¨‹çš„æ—¶å€™ï¼Œasync ä¸åŠ é¢å¤–å‚æ•°çš„è°ƒç”¨æ–¹å¼å°±ä¸ä¼šåˆ›å»ºæ–°çº¿ç¨‹ã€‚è€Œæ˜¯åœ¨åç»­è°ƒç”¨ <strong><code>get()</code></strong> è¯·æ±‚ç»“æœæ—¶æ‰§è¡Œåœ¨è¿™ä¸ªè°ƒç”¨ <strong><code>get()</code></strong> çš„çº¿ç¨‹ä¸Šã€‚</p><p>å¦‚æœä½ å¼ºåˆ¶ async ä¸€å®šè¦åˆ›å»ºæ–°çº¿ç¨‹å°±è¦ä½¿ç”¨ <strong><code>std::launch::async</code></strong> æ ‡è®°ã€‚æ‰¿å—çš„ä»£ä»·æ˜¯ï¼Œç³»ç»Ÿèµ„æºç´§å¼ æ—¶å¯èƒ½å´©æºƒã€‚</p><p>â‘¢ æ ¹æ®ç»éªŒï¼Œä¸€ä¸ªç¨‹åºä¸­çº¿ç¨‹æ•°é‡ ä¸å®œè¶…è¿‡100~200 ã€‚</p><p><strong>async ä¸ç¡®å®šæ€§é—®é¢˜çš„è§£å†³</strong><br>ä¸åŠ é¢å¤–å‚æ•°çš„ async è°ƒç”¨æ—¶è®©<strong>ç³»ç»Ÿè‡ªè¡Œå†³å®š</strong>ï¼Œæ˜¯å¦åˆ›å»ºæ–°çº¿ç¨‹ã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">std</span>::<span class="built_in">future</span> result = <span class="built_in">std</span>::async(mythread);</span><br><span class="line"><span class="comment">// é—®é¢˜ç„¦ç‚¹åœ¨äºè¿™ä¸ªå†™æ³•ï¼Œä»»åŠ¡åˆ°åº•æœ‰æ²¡æœ‰è¢«æ¨è¿Ÿæ‰§è¡Œã€‚</span></span><br><span class="line"><span class="comment">// å¯ä»¥é€šè¿‡ wait_for è¿”å›çŠ¶æ€æ¥åˆ¤æ–­ï¼š</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœèµ„æºä¸ç´§å¼ çš„æƒ…å†µä¸‹ï¼š</span></span><br><span class="line"><span class="comment">// - å¦‚æœçº¿ç¨‹è¿è¡Œéœ€è¦5ç§’ï¼Œä¸»çº¿ç¨‹åœ¨è¿™è¦ç­‰å¾… 6 ç§’çš„è¯ï¼Œæ­¤æ—¶ status = ready</span></span><br><span class="line"><span class="comment">// - å¦‚æœçº¿ç¨‹è¿è¡Œéœ€è¦5ç§’ï¼Œä¸»çº¿ç¨‹åœ¨è¿™é‡Œè¦ç­‰å¾… 1 ç§’çš„è¯ï¼Œæ­¤æ—¶ status = timeout</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœèµ„æºç´§å¼ çš„æƒ…å†µä¸‹ï¼š</span></span><br><span class="line"><span class="comment">// å¦‚æœå‡ºç°äº† status = deferredï¼Œåˆ™è¯´æ˜ç³»ç»Ÿé€‰æ‹©äº† std::launch::deferredï¼Œå»¶è¿Ÿè°ƒç”¨</span></span><br><span class="line"><span class="comment">// ä¸€æ—¦ä½¿ç”¨äº†deferredï¼Œå°±ä¸ä¼šåˆ›å»ºçº¿ç¨‹ï¼Œéƒ½æ˜¯åœ¨get()æ‰ä¼šè°ƒç”¨çº¿ç¨‹å…¥å£å‡½æ•°ï¼Œä¸ç®¡wait_forå¤šé•¿æ—¶é—´</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">std</span>::future_status status = result.wait_for(<span class="built_in">std</span>::chrono::seconds(<span class="number">6</span>));</span><br><span class="line"><span class="comment">//std::future_status status = result.wait_for(6s);</span></span><br><span class="line">	<span class="keyword">if</span> (status == <span class="built_in">std</span>::future_status::timeout) &#123;</span><br><span class="line">		<span class="comment">// è¶…æ—¶ï¼šè¡¨ç¤ºçº¿ç¨‹è¿˜æ²¡æœ‰æ‰§è¡Œå®Œ</span></span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"è¶…æ—¶äº†ï¼Œçº¿ç¨‹è¿˜æ²¡æœ‰æ‰§è¡Œå®Œ"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (status == <span class="built_in">std</span>::future_status::<span class="built_in">ready</span>) &#123;</span><br><span class="line">		<span class="comment">// è¡¨ç¤ºçº¿ç¨‹æˆåŠŸè¿”å›</span></span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"çº¿ç¨‹æ‰§è¡ŒæˆåŠŸï¼Œè¿”å›"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; result.<span class="built_in">get</span>() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (status == <span class="built_in">std</span>::future_status::deferred) &#123;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"çº¿ç¨‹å»¶è¿Ÿæ‰§è¡Œ"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; result.<span class="built_in">get</span>() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure><h4 id="8-3-std-packaged-taskï¼šæ‰“åŒ…ä»»åŠ¡ï¼ŒæŠŠä»»åŠ¡åŒ…è£…èµ·æ¥"><a class="header-anchor" href="#8-3-std-packaged-taskï¼šæ‰“åŒ…ä»»åŠ¡ï¼ŒæŠŠä»»åŠ¡åŒ…è£…èµ·æ¥">Â¶</a>8.3 <strong>std::packaged_taskï¼šæ‰“åŒ…ä»»åŠ¡ï¼ŒæŠŠä»»åŠ¡åŒ…è£…èµ·æ¥</strong></h4><p>ç±»æ¨¡æ¿ï¼Œå®ƒçš„æ¨¡æ¿å‚æ•°æ˜¯å„ç§å¯è°ƒç”¨å¯¹è±¡ï¼Œé€šè¿‡ <strong><code>packaged_task</code></strong> æŠŠ<strong>å„ç§å¯è°ƒç”¨å¯¹è±¡</strong>åŒ…è£…èµ·æ¥ï¼Œæ–¹ä¾¿å°†æ¥ä½œä¸ºçº¿ç¨‹å…¥å£å‡½æ•°æ¥è°ƒç”¨ã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;future&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">mythread</span><span class="params">(<span class="keyword">int</span> mypar)</span> </span>&#123;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; mypar &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"mythread() start"</span> &lt;&lt; <span class="string">"threadid = "</span> </span><br><span class="line">         &lt;&lt; <span class="built_in">std</span>::this_thread::get_id() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="built_in">std</span>::<span class="function">chrono::milliseconds <span class="title">dura</span><span class="params">(<span class="number">5000</span>)</span></span>;</span><br><span class="line">	<span class="built_in">std</span>::this_thread::sleep_for(dura);</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"mythread() end"</span> &lt;&lt; <span class="string">"threadid = "</span> </span><br><span class="line">         &lt;&lt; <span class="built_in">std</span>::this_thread::get_id() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"mainThreadid = "</span> &lt;&lt; <span class="built_in">std</span>::this_thread::get_id() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="comment">// æˆ‘ä»¬æŠŠå‡½æ•°mythreadé€šè¿‡packaged_taskåŒ…è£…èµ·æ¥</span></span><br><span class="line">    <span class="comment">// è¿”å›å€¼ç±»å‹æ˜¯int,å‚æ•°æ˜¯ä¸€ä¸ªint:  int mythread(int)</span></span><br><span class="line">    <span class="function"><span class="built_in">std</span>::packaged_task&lt;<span class="title">int</span><span class="params">(<span class="keyword">int</span>)</span>&gt; <span class="title">mypt1</span><span class="params">(mythread)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¹Ÿå¯ä»¥å°è£… lambda å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="built_in">std</span>::packaged_task&lt;<span class="title">int</span><span class="params">(<span class="keyword">int</span>)</span>&gt; <span class="title">mypt2</span><span class="params">([](<span class="keyword">int</span> mypar) &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="built_in">cout</span> &lt;&lt; mypar &lt;&lt; <span class="built_in">endl</span>;</span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"mythread() start"</span> &lt;&lt; <span class="string">"threadid = "</span> </span></span></span><br><span class="line"><span class="function"><span class="params">             &lt;&lt; <span class="built_in">std</span>::this_thread::get_id() &lt;&lt; <span class="built_in">endl</span>;</span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="built_in">std</span>::chrono::milliseconds dura(<span class="number">5000</span>);</span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="built_in">std</span>::this_thread::sleep_for(dura);</span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"mythread() end"</span> &lt;&lt; <span class="string">"threadid = "</span> </span></span></span><br><span class="line"><span class="function"><span class="params">             &lt;&lt; <span class="built_in">std</span>::this_thread::get_id() &lt;&lt; <span class="built_in">endl</span>;</span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="keyword">return</span> <span class="number">5</span>;</span></span></span><br><span class="line"><span class="function"><span class="params">	&#125;)</span></span>; </span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºçº¿ç¨‹ t1ï¼Œä½¿ç”¨packaged_taskå°è£…çš„çº¿ç¨‹å…¥å£å‡½æ•° </span></span><br><span class="line">	<span class="function"><span class="built_in">std</span>::thread <span class="title">t1</span><span class="params">(<span class="built_in">std</span>::ref(mypt1), <span class="number">1</span>)</span></span>;</span><br><span class="line">	t1.join();</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">future</span>&lt;<span class="keyword">int</span>&gt; result = mypt1.get_future(); </span><br><span class="line">	<span class="comment">// std::futureå¯¹è±¡é‡ŒåŒ…å«æœ‰çº¿ç¨‹å…¥å£å‡½æ•°çš„è¿”å›ç»“æœï¼Œé€šè¿‡ get_future()å‡½æ•°</span></span><br><span class="line">    <span class="comment">// è¿™é‡Œ result ä¿å­˜ mythread è¿”å›çš„ç»“æœã€‚</span></span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; result.<span class="built_in">get</span>() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    </span><br><span class="line">	<span class="comment">// packaged_task åŒ…è£…èµ·æ¥çš„å¯è°ƒç”¨å¯¹è±¡è¿˜å¯ä»¥ç›´æ¥è°ƒç”¨ï¼Œä»è¿™ä¸ªè§’åº¦æ¥è®²ï¼Œã€ã€</span></span><br><span class="line">    <span class="comment">// packaged_task å¯¹è±¡ä¹Ÿæ˜¯ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡,lambdaå¯ä»¥ç›´æ¥è°ƒç”¨</span></span><br><span class="line">    mypt2(<span class="number">1</span>);</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">future</span>&lt;<span class="keyword">int</span>&gt; result = mypt2.get_future();</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; result.<span class="built_in">get</span>() &lt;&lt; <span class="built_in">endl</span>; </span><br><span class="line">    <span class="comment">// ä¸Šæ®µç¨‹åºæ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­è¿›è¡Œçš„</span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="8-4-std-promise"><a class="header-anchor" href="#8-4-std-promise">Â¶</a>8.4 <code>std::promise</code></h4><p>æ¨¡æ¿ç±»ï¼Œèƒ½å¤Ÿåœ¨æŸä¸ªçº¿ç¨‹ä¸­ç»™å®ƒèµ‹å€¼ï¼Œå¹¶å¯ä»¥åœ¨å…¶ä»–çº¿ç¨‹ä¸­ï¼ŒæŠŠè¿™ä¸ªå€¼å–å‡ºæ¥</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;future&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mythread</span><span class="params">(<span class="built_in">std</span>::promise&lt;<span class="keyword">int</span>&gt; &amp;tmp, <span class="keyword">int</span> clac)</span> </span>&#123;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"mythread() start"</span> &lt;&lt; <span class="string">"threadid = "</span> </span><br><span class="line">         &lt;&lt; <span class="built_in">std</span>::this_thread::get_id() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="built_in">std</span>::<span class="function">chrono::milliseconds <span class="title">dura</span><span class="params">(<span class="number">5000</span>)</span></span>;</span><br><span class="line">	<span class="built_in">std</span>::this_thread::sleep_for(dura);</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"mythread() end"</span> &lt;&lt; <span class="string">"threadid = "</span> </span><br><span class="line">         &lt;&lt; <span class="built_in">std</span>::this_thread::get_id() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">int</span> result = clac;</span><br><span class="line">	tmp.set_value(result); <span class="comment">// ç»“æœä¿å­˜åˆ°äº†tmpè¿™ä¸ªå¯¹è±¡ä¸­,ä½¿ç”¨ set_val() å‡½æ•°</span></span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="built_in">std</span>::packaged_task&lt;<span class="keyword">int</span>(<span class="keyword">int</span>)&gt;&gt; task_vec;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">std</span>::promise&lt;<span class="keyword">int</span>&gt; myprom;</span><br><span class="line">	<span class="function"><span class="built_in">std</span>::thread <span class="title">t1</span><span class="params">(mythread, <span class="built_in">std</span>::ref(myprom), <span class="number">180</span>)</span></span>;</span><br><span class="line">	t1.join(); <span class="comment">//åœ¨è¿™é‡Œçº¿ç¨‹å·²ç»æ‰§è¡Œå®Œäº†</span></span><br><span class="line">    <span class="comment">// promise å’Œ futureç»‘å®šï¼Œç”¨äºè·å–çº¿ç¨‹è¿”å›å€¼</span></span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">future</span>&lt;<span class="keyword">int</span>&gt; fu1 = myprom.get_future(); </span><br><span class="line">	<span class="keyword">auto</span> result = fu1.<span class="built_in">get</span>();</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"result = "</span> &lt;&lt; result &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ <strong><code>promise</code></strong> ä¿å­˜ä¸€ä¸ªå€¼ï¼Œåœ¨å°†æ¥æŸä¸ªæ—¶åˆ»æˆ‘ä»¬é€šè¿‡æŠŠä¸€ä¸ª**<code>future</code>**ç»‘å®šåˆ°è¿™ä¸ª <strong><code>promise</code></strong> ä¸Šï¼Œæ¥å¾—åˆ°ç»‘å®šçš„å€¼ã€‚æ³¨æ„ï¼Œä½¿ç”¨ thread æ—¶ï¼Œå¿…é¡» **<code>join()</code>**æˆ–è€… <strong><code>detach()</code></strong>ï¼Œ å¦åˆ™ç¨‹åºä¼šæŠ¥å¼‚å¸¸ã€‚</p><h3 id="ä¹ã€future-å…¶ä»–æˆå‘˜å‡½æ•°ã€shared-futureã€atomic"><a class="header-anchor" href="#ä¹ã€future-å…¶ä»–æˆå‘˜å‡½æ•°ã€shared-futureã€atomic">Â¶</a>ä¹ã€future å…¶ä»–æˆå‘˜å‡½æ•°ã€shared_futureã€atomic</h3><ul><li><strong><code>std::future</code></strong> å…¶ä»–æˆå‘˜å‡½æ•°</li><li><strong><code>std::shared_future</code></strong></li><li><strong><code>std::atomic</code></strong></li></ul><h4 id="9-1-std-future-çš„æˆå‘˜å‡½æ•°"><a class="header-anchor" href="#9-1-std-future-çš„æˆå‘˜å‡½æ•°">Â¶</a>9.1 <code>std::future</code> çš„æˆå‘˜å‡½æ•°</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">std</span>::future_status status = result.wait_for(<span class="built_in">std</span>::chrono::seconds(<span class="number">5</span>));</span><br></pre></td></tr></table></figure><p>å¡ä½å½“å‰æµç¨‹ï¼Œç­‰å¾… <strong><code>std::async()</code></strong> çš„å¼‚æ­¥ä»»åŠ¡è¿è¡Œä¸€æ®µæ—¶é—´ï¼Œç„¶åè¿”å›å…¶çŠ¶æ€**<code>std::future_status</code>** ã€‚å¦‚æœ**<code>std::async()</code><strong>çš„å‚æ•°æ˜¯ <strong><code>std::launch::deferred</code></strong> ï¼ˆå»¶è¿Ÿæ‰§è¡Œï¼‰ï¼Œ</strong><font color="FF0000">åˆ™ä¸ä¼šå¡ä½ä¸»æµç¨‹</font>**ï¼Œ<strong>æ²¡æœ‰åˆ›å»ºæ–°çº¿ç¨‹ï¼Œçº¿ç¨‹å…¥å£å‡½æ•°ä»ç„¶åœ¨é‡åˆ° <code>get()</code> çš„æ—¶å€™è°ƒç”¨ï¼Œåªæ˜¯ä¸»çº¿ç¨‹ä¸­çš„æ™®é€šå‡½æ•°è°ƒç”¨ã€‚</strong><br><strong><code>std::future_status</code></strong> æ˜¯æšä¸¾ç±»å‹ï¼Œè¡¨ç¤ºå¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€ã€‚ç±»å‹çš„å–å€¼æœ‰</p><ul><li><strong><code>std::future_status::timeout</code></strong></li><li><strong><code>std::future_status::ready</code></strong></li><li><strong><code>std::future_status::deferred</code></strong></li></ul><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;future&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">mythread</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"mythread() start"</span> &lt;&lt; <span class="string">"threadid = "</span> </span><br><span class="line">         &lt;&lt; <span class="built_in">std</span>::this_thread::get_id() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="built_in">std</span>::<span class="function">chrono::milliseconds <span class="title">dura</span><span class="params">(<span class="number">5000</span>)</span></span>;</span><br><span class="line">	<span class="built_in">std</span>::this_thread::sleep_for(dura);</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"mythread() end"</span> &lt;&lt; <span class="string">"threadid = "</span> </span><br><span class="line">         &lt;&lt; <span class="built_in">std</span>::this_thread::get_id() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"mainThreadid = "</span> &lt;&lt; <span class="built_in">std</span>::this_thread::get_id() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">future</span>&lt;<span class="keyword">int</span>&gt; result = <span class="built_in">std</span>::async(mythread);</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"continue........"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="comment">//å¡åœ¨è¿™é‡Œç­‰å¾…mythread()æ‰§è¡Œå®Œæ¯•ï¼Œæ‹¿åˆ°ç»“æœ</span></span><br><span class="line">	<span class="comment">//cout &lt;&lt; result1.get() &lt;&lt; endl; </span></span><br><span class="line">	<span class="comment">// ç­‰å¾…1ç§’</span></span><br><span class="line">    <span class="built_in">std</span>::future_status status=result.wait_for(<span class="built_in">std</span>::chrono::seconds(<span class="number">1</span>));</span><br><span class="line">	<span class="keyword">if</span> (status == <span class="built_in">std</span>::future_status::timeout) &#123;</span><br><span class="line">		<span class="comment">// è¶…æ—¶ï¼šè¡¨ç¤ºçº¿ç¨‹è¿˜æ²¡æœ‰æ‰§è¡Œå®Œ</span></span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"è¶…æ—¶äº†ï¼Œçº¿ç¨‹è¿˜æ²¡æœ‰æ‰§è¡Œå®Œ"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;future&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">mythread</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"mythread() start"</span> &lt;&lt; <span class="string">"threadid = "</span> &lt;&lt;                                  <span class="built_in">std</span>::this_thread::get_id() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="comment">//std::chrono::milliseconds dura(5000);</span></span><br><span class="line">	<span class="comment">//std::this_thread::sleep_for(dura);</span></span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"mythread() end"</span> &lt;&lt; <span class="string">"threadid = "</span> </span><br><span class="line">         &lt;&lt; <span class="built_in">std</span>::this_thread::get_id() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"mainThreadid = "</span> &lt;&lt; <span class="built_in">std</span>::this_thread::get_id() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">future</span>&lt;<span class="keyword">int</span>&gt; result = <span class="built_in">std</span>::async(<span class="built_in">std</span>::launch::deferred, mythread);</span><br><span class="line">	<span class="comment">//std::future&lt;int&gt; result = std::async(mythread);</span></span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"continue........"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="comment">//å¡åœ¨è¿™é‡Œç­‰å¾…mythread()æ‰§è¡Œå®Œæ¯•ï¼Œæ‹¿åˆ°ç»“æœ</span></span><br><span class="line">	<span class="comment">//cout &lt;&lt; result1.get() &lt;&lt; endl; </span></span><br><span class="line">	<span class="built_in">std</span>::future_status status=result.wait_for(<span class="built_in">std</span>::chrono::seconds(<span class="number">6</span>));</span><br><span class="line">	<span class="keyword">if</span> (status == <span class="built_in">std</span>::future_status::timeout) &#123;</span><br><span class="line">		<span class="comment">// è¶…æ—¶ï¼šè¡¨ç¤ºçº¿ç¨‹è¿˜æ²¡æœ‰æ‰§è¡Œå®Œ</span></span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"è¶…æ—¶äº†ï¼Œçº¿ç¨‹è¿˜æ²¡æœ‰æ‰§è¡Œå®Œ"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (status == <span class="built_in">std</span>::future_status::<span class="built_in">ready</span>) &#123;</span><br><span class="line">		<span class="comment">// è¡¨ç¤ºçº¿ç¨‹æˆåŠŸç»“æŸå¹¶è¿”å›</span></span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"çº¿ç¨‹æ‰§è¡ŒæˆåŠŸï¼Œè¿”å›"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; result.<span class="built_in">get</span>() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (status == <span class="built_in">std</span>::future_status::deferred) &#123;</span><br><span class="line">		<span class="comment">// å¦‚æœè®¾ç½® std::future&lt;int&gt; result = </span></span><br><span class="line">        <span class="comment">// std::async(std::launch::deferred, mythread);ï¼Œåˆ™æœ¬æ¡ä»¶æˆç«‹</span></span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"çº¿ç¨‹å»¶è¿Ÿæ‰§è¡Œ"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; result.<span class="built_in">get</span>() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"good luck"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="9-2-std-shared-future"><a class="header-anchor" href="#9-2-std-shared-future">Â¶</a>9.2 <code>std::shared_future</code></h4><p><strong><code>std::shared_future</code>ï¼šä¹Ÿæ˜¯ä¸ªç±»æ¨¡æ¿</strong></p><ul><li><p>**<code>std::future</code>**çš„ <strong><code>get()</code></strong> æˆå‘˜å‡½æ•°æ˜¯è½¬ç§»æ•°æ®</p></li><li><p><strong><code>std::shared_future</code></strong> çš„ <strong><code>get()</code></strong> æˆå‘˜å‡½æ•°æ˜¯å¤åˆ¶æ•°æ®</p></li></ul><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;future&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">mythread</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"mythread() start"</span> &lt;&lt; <span class="string">"threadid = "</span> </span><br><span class="line">         &lt;&lt; <span class="built_in">std</span>::this_thread::get_id() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="built_in">std</span>::<span class="function">chrono::milliseconds <span class="title">dura</span><span class="params">(<span class="number">5000</span>)</span></span>;</span><br><span class="line">	<span class="built_in">std</span>::this_thread::sleep_for(dura);</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"mythread() end"</span> &lt;&lt; <span class="string">"threadid = "</span> </span><br><span class="line">         &lt;&lt; <span class="built_in">std</span>::this_thread::get_id() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"mainThreadid = "</span> &lt;&lt; <span class="built_in">std</span>::this_thread::get_id() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="function"><span class="built_in">std</span>::packaged_task&lt;<span class="title">int</span><span class="params">()</span>&gt; <span class="title">mypt</span><span class="params">(mythread)</span></span>;</span><br><span class="line">	<span class="function"><span class="built_in">std</span>::thread <span class="title">t1</span><span class="params">(<span class="built_in">std</span>::ref(mypt))</span></span>;</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">future</span>&lt;<span class="keyword">int</span>&gt; result = mypt.get_future();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">bool</span> ifcanget = result.valid(); <span class="comment">//åˆ¤æ–­future ä¸­çš„å€¼æ˜¯ä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆå€¼</span></span><br><span class="line">    <span class="comment">// æ‰§è¡Œå®Œæ¯•åresult_sé‡Œæœ‰å€¼ï¼Œè€Œresulté‡Œç©ºäº†</span></span><br><span class="line">	<span class="function"><span class="built_in">std</span>::shared_future&lt;<span class="keyword">int</span>&gt; <span class="title">result_s</span><span class="params">(result.share())</span></span>;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨ç§»åŠ¨æ„é€ å‡½æ•°æ¥åˆ›å»º shared_futureå¯¹è±¡</span></span><br><span class="line">	<span class="function"><span class="built_in">std</span>::shared_future&lt;<span class="keyword">int</span>&gt; <span class="title">result_s</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">move</span>(result))</span></span>;</span><br><span class="line">    <span class="comment">// é€šè¿‡get_futureè¿”å›å€¼ç›´æ¥æ„é€ ä¸€ä¸ªshared_futureå¯¹è±¡</span></span><br><span class="line">    <span class="function"><span class="built_in">std</span>::shared_future&lt;<span class="keyword">int</span>&gt; <span class="title">result_s</span><span class="params">(mypt.get_future())</span></span>;</span><br><span class="line">    </span><br><span class="line">    t1.join();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">auto</span> myresult1 = result_s.<span class="built_in">get</span>();</span><br><span class="line">	<span class="keyword">auto</span> myresult2 = result_s.<span class="built_in">get</span>();</span><br><span class="line"> </span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"good luck"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="9-3-std-atomic-åŸå­æ“ä½œ"><a class="header-anchor" href="#9-3-std-atomic-åŸå­æ“ä½œ">Â¶</a>9.3 <code>std::atomic</code> åŸå­æ“ä½œ</h4><p>æœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼Œå¯¹ä¸€ä¸ªå˜é‡è¿›è¡Œæ“ä½œï¼Œä¸€ä¸ªçº¿ç¨‹è¯»è¿™ä¸ªå˜é‡çš„å€¼ï¼Œä¸€ä¸ªçº¿ç¨‹å¾€è¿™ä¸ªå˜é‡ä¸­å†™å€¼ã€‚å³ä½¿æ˜¯ä¸€ä¸ªç®€å•å˜é‡çš„è¯»å–å’Œå†™å…¥æ“ä½œï¼Œå¦‚æœä¸åŠ é”ï¼Œä¹Ÿæœ‰å¯èƒ½ä¼šå¯¼è‡´è¯»å†™å€¼æ··ä¹±ï¼ˆä¸€æ¡Cè¯­å¥ä¼šè¢«æ‹†æˆ3ã€4æ¡æ±‡ç¼–è¯­å¥æ¥æ‰§è¡Œï¼Œæ‰€ä»¥ä»ç„¶æœ‰å¯èƒ½æ··ä¹±ï¼‰;</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> g_count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mythread1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000000</span>; i++) &#123;</span><br><span class="line">        <span class="comment">// è¯¥è¯­å¥ä¼šè¢«æ‹†æˆå¤šæ¡æ±‡ç¼–è¯­å¥ï¼Œæ‰€ä»¥å¯èƒ½åœ¨çº¿ç¨‹åˆ‡æ¢çš„è¿‡ç¨‹ä¸­å‡ºç°æ··ä¹±</span></span><br><span class="line">		g_count++; </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="built_in">std</span>::thread <span class="title">t1</span><span class="params">(mythread1)</span></span>;</span><br><span class="line">	<span class="function"><span class="built_in">std</span>::thread <span class="title">t2</span><span class="params">(mythread1)</span></span>;</span><br><span class="line">	t1.join();</span><br><span class="line">	t2.join();</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"æ­£å¸¸æƒ…å†µä¸‹ç»“æœåº”è¯¥æ˜¯200 0000æ¬¡ï¼Œå®é™…æ˜¯"</span> &lt;&lt; g_count &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// !!! æ³¨æ„ï¼šè¾“å‡ºç»“æœå¹¶ä¸ä¸€å®šæ˜¯ 2000000  !!!</span></span><br></pre></td></tr></table></figure><p>äº’æ–¥é‡ï¼šå¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ç”¨äºä¿æŠ¤å…±äº«æ•°æ®ï¼šå…ˆé”ä½ï¼Œ æ“ä½œå…±äº«æ•°æ®ï¼Œ è§£é”ã€‚æ‰€ä»¥é€šè¿‡ mutex å¯ä»¥è§£å†³ï¼Œ<strong>ä½†æ˜¯æ•ˆç‡ä¸é«˜ã€‚</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> g_count = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">std</span>::mutex mymutex;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mythread1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000000</span>; i++) &#123;</span><br><span class="line">		<span class="function"><span class="built_in">std</span>::unique_lock&lt;<span class="built_in">std</span>::mutex&gt; <span class="title">u1</span><span class="params">(mymutex)</span></span>;</span><br><span class="line">        <span class="comment">// std::lock_guard&lt;std::mutex&gt; u1(mymutex);</span></span><br><span class="line">		g_count++;</span><br><span class="line">	&#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="built_in">std</span>::thread <span class="title">t1</span><span class="params">(mythread1)</span></span>;</span><br><span class="line">	<span class="function"><span class="built_in">std</span>::thread <span class="title">t2</span><span class="params">(mythread1)</span></span>;</span><br><span class="line">	t1.join();</span><br><span class="line">	t2.join();</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"æ­£å¸¸æƒ…å†µä¸‹ç»“æœåº”è¯¥æ˜¯200 0000æ¬¡ï¼Œå®é™…æ˜¯"</span> &lt;&lt; g_count &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="9-4-std-atomic-ç”¨æ³•"><a class="header-anchor" href="#9-4-std-atomic-ç”¨æ³•">Â¶</a>9.4 <code>std::atomic</code> ç”¨æ³•</h4><p>åŸå­æ“ä½œï¼šåœ¨å¤šçº¿ç¨‹ä¸­ä¸ä¼šè¢«æ‰“æ–­çš„ç¨‹åºæ‰§è¡Œç‰‡æ®µã€‚åŸå­æ“ä½œå¯ä»¥ç†è§£æˆä¸€ç§ï¼šä¸éœ€è¦ç”¨åˆ°äº’æ–¥é‡åŠ é”ï¼ˆæ— é”ï¼‰æŠ€æœ¯çš„å¤šçº¿ç¨‹å¹¶å‘ç¼–ç¨‹æ–¹å¼ã€‚</p><ul><li><p><strong>ä¼˜åŠ¿</strong>ï¼šä»æ•ˆç‡ä¸Šæ¥è¯´ï¼ŒåŸå­æ“ä½œè¦æ¯”äº’æ–¥é‡çš„æ–¹å¼<strong>æ•ˆç‡è¦é«˜</strong>ã€‚</p></li><li><p><strong>åŒºåˆ«</strong>ï¼šäº’æ–¥é‡çš„åŠ é”ä¸€èˆ¬æ˜¯é’ˆå¯¹<strong>ä¸€ä¸ªä»£ç æ®µ</strong>ï¼Œè€ŒåŸå­æ“ä½œé’ˆå¯¹çš„ä¸€èˆ¬éƒ½æ˜¯<strong>ä¸€ä¸ªå˜é‡</strong>ã€‚</p></li></ul><p>åŸå­æ“ä½œï¼Œä¸€èˆ¬éƒ½æ˜¯æŒ‡â€œä¸å¯åˆ†å‰²çš„æ“ä½œâ€ï¼›ä¹Ÿå°±æ˜¯è¯´è¿™ç§æ“ä½œçŠ¶æ€è¦ä¹ˆæ˜¯å®Œæˆçš„ï¼Œè¦ä¹ˆæ˜¯æ²¡å®Œæˆçš„ï¼Œä¸å¯èƒ½å‡ºç°åŠå®ŒæˆçŠ¶æ€ã€‚</p><p><strong><code>std::atomic</code></strong> æ¥ä»£è¡¨åŸå­æ“ä½œï¼Œæ˜¯ä¸ªç±»æ¨¡æ¿ï¼Œç”¨æ¥å°è£…æŸä¸ªç±»å‹çš„å€¼çš„ã€‚</p><p>éœ€è¦æ·»åŠ å¤´æ–‡ä»¶ <strong><code>#include &lt;atomic&gt;</code></strong>ã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;atomic&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="built_in">std</span>::atomic&lt;<span class="keyword">int</span>&gt; g_count = <span class="number">0</span>;  <span class="comment">// å°è£…äº†ä¸€ä¸ªç±»å‹ä¸ºintçš„ å¯¹è±¡ï¼ˆå€¼ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mythread1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000000</span>; i++) &#123;</span><br><span class="line">		g_count++;</span><br><span class="line">        <span class="comment">// å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼šä¸€èˆ¬atomicåŸå­æ“ä½œ</span></span><br><span class="line">        <span class="comment">// é’ˆå¯¹ ++ï¼Œâ€“ï¼Œ+=ï¼Œ-=ï¼Œ&amp;=ï¼Œ|=ï¼Œ^= æ˜¯æ”¯æŒçš„ï¼Œå…¶ä»–æ“ä½œä¸ä¸€å®šæ”¯æŒã€‚</span></span><br><span class="line">        g_count += <span class="number">1</span>;  <span class="comment">// æ”¯æŒ</span></span><br><span class="line">        g_count = g_count + <span class="number">1</span>; <span class="comment">// ä¸æ”¯æŒ</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="built_in">std</span>::thread <span class="title">t1</span><span class="params">(mythread1)</span></span>;</span><br><span class="line">	<span class="function"><span class="built_in">std</span>::thread <span class="title">t2</span><span class="params">(mythread1)</span></span>;</span><br><span class="line">	t1.join();</span><br><span class="line">	t2.join();</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"æ­£å¸¸æƒ…å†µä¸‹ç»“æœåº”è¯¥æ˜¯200 0000æ¬¡ï¼Œå®é™…æ˜¯"</span> &lt;&lt; g_count &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;atomic&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">std</span>::atomic&lt;<span class="keyword">bool</span>&gt; g_ifEnd = <span class="literal">false</span>; <span class="comment">// å°è£…äº†ä¸€ä¸ªç±»å‹ä¸ºboolçš„ å¯¹è±¡ï¼ˆå€¼ï¼‰</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mythread</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">std</span>::<span class="function">chrono::milliseconds <span class="title">dura</span><span class="params">(<span class="number">1000</span>)</span></span>;</span><br><span class="line">    <span class="comment">// æ¯ 1 ç§’ä¸­åˆ¤æ–­ä¸€æ¬¡ g_ifEnd</span></span><br><span class="line">	<span class="keyword">while</span> (g_ifEnd == <span class="literal">false</span>) &#123;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"th_id = "</span> &lt;&lt; <span class="built_in">std</span>::this_thread::get_id() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">		<span class="built_in">std</span>::this_thread::sleep_for(dura);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"th id = "</span> &lt;&lt; <span class="built_in">std</span>::this_thread::get_id() &lt;&lt; <span class="string">"over"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="built_in">std</span>::thread <span class="title">t1</span><span class="params">(mythread)</span></span>;</span><br><span class="line">	<span class="function"><span class="built_in">std</span>::thread <span class="title">t2</span><span class="params">(mythread)</span></span>;</span><br><span class="line">    <span class="comment">// ä¸»çº¿ç¨‹ ç¡çœ  5s</span></span><br><span class="line">	<span class="built_in">std</span>::<span class="function">chrono::milliseconds <span class="title">dura</span><span class="params">(<span class="number">5000</span>)</span></span>;</span><br><span class="line">	<span class="built_in">std</span>::this_thread::sleep_for(dura);</span><br><span class="line">	g_ifEnd = <span class="literal">true</span>;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"ç¨‹åºæ‰§è¡Œå®Œæ¯•"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	t1.join();</span><br><span class="line">	t2.join();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒèµ„æ–™ï¼š"><a class="header-anchor" href="#å‚è€ƒèµ„æ–™ï¼š">Â¶</a>å‚è€ƒèµ„æ–™ï¼š</h3><blockquote><p><a href="https://www.bilibili.com/video/BV1Yb411L7ak" target="_blank" rel="noopener">https://www.bilibili.com/video/BV1Yb411L7ak</a></p><p><a href="https://blog.csdn.net/qq_38231713/category_10001159.html" target="_blank" rel="noopener">https://blog.csdn.net/qq_38231713/category_10001159.html</a></p></blockquote><!-- rebuild by neat -->]]></content>
      <categories>
        <category>C++_Language</category>
      </categories>
      <tags>
        <tag>C++11_Multithreading</tag>
      </tags>
  </entry>
  <entry>
    <title>GDB å¸¸ç”¨å‘½ä»¤</title>
    <url>/Complie_and_Debug/GDB%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<!-- build time:Tue Jun 22 2021 17:02:33 GMT+0800 (GMT+08:00) --><a id="more"></a><h3 id="GDB-å¸¸ç”¨å‘½ä»¤"><a class="header-anchor" href="#GDB-å¸¸ç”¨å‘½ä»¤">Â¶</a>GDB å¸¸ç”¨å‘½ä»¤</h3><p><strong>åŸºæœ¬æŒ‡ä»¤</strong></p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å…¶ä¸­ -o æŒ‡å®šè¾“å‡ºæ–‡ä»¶å, -g æŒ‡å®šå¯ä»¥è°ƒè¯•  -m64 é€‰é¡¹ç¼–è¯‘ä¸º64ä½</span></span><br><span class="line">gcc bugging.c -o bugging -g -m64</span><br><span class="line">    </span><br><span class="line"><span class="comment">// è¿›å…¥gdb è°ƒè¯• bugging ç¨‹åº</span></span><br><span class="line">gdb bugging</span><br><span class="line"></span><br><span class="line"><span class="comment">// (gdb) -&gt; è¡¨ç¤ºåœ¨gdb å‘½ä»¤è¡Œç•Œé¢ </span></span><br><span class="line"><span class="comment">// æ‰§è¡Œè°ƒè¯•ç¨‹åº </span></span><br><span class="line">(gdb) <span class="built_in">run</span>  </span><br><span class="line">    </span><br><span class="line"><span class="comment">// é€€å‡ºgdb</span></span><br><span class="line">(gdb) quit</span><br></pre></td></tr></table></figure><p><strong>å¸¸ç”¨å‘½ä»¤è¡¨</strong></p><table><thead><tr><th style="text-align:center">å‘½ä»¤</th><th style="text-align:center">ç®€å†™</th><th style="text-align:center">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:center">list</td><td style="text-align:center">l</td><td style="text-align:center">æŸ¥çœ‹æºç ï¼ˆ10è¡Œï¼‰</td></tr><tr><td style="text-align:center">backtrace</td><td style="text-align:center">bt, where</td><td style="text-align:center">æ‰“å°å‡½æ•°æ ˆä¿¡æ¯</td></tr><tr><td style="text-align:center">next</td><td style="text-align:center">n</td><td style="text-align:center">æ‰§è¡Œä¸‹ä¸€è¡Œï¼Œé€è¡Œ</td></tr><tr><td style="text-align:center">step</td><td style="text-align:center">s</td><td style="text-align:center">ä¸€æ¬¡æ‰§è¡Œä¸€è¡Œï¼Œé€è¿‡ç¨‹ï¼Œä¼šæ­¥å…¥</td></tr><tr><td style="text-align:center">finish</td><td style="text-align:center"></td><td style="text-align:center">è¿è¡Œåˆ°å‡½æ•°ç»“æŸ</td></tr><tr><td style="text-align:center">continue</td><td style="text-align:center">c</td><td style="text-align:center">ç»§ç»­è¿è¡Œ</td></tr><tr><td style="text-align:center">break</td><td style="text-align:center">b</td><td style="text-align:center">è®¾ç½®æ–­ç‚¹</td></tr><tr><td style="text-align:center">info breakpoints</td><td style="text-align:center"></td><td style="text-align:center">æ˜¾ç¤ºæ–­ç‚¹ä¿¡æ¯</td></tr><tr><td style="text-align:center">delete</td><td style="text-align:center">d</td><td style="text-align:center">åˆ é™¤æ–­ç‚¹</td></tr><tr><td style="text-align:center">print</td><td style="text-align:center">p</td><td style="text-align:center">æ‰“å°è¡¨è¾¾å¼çš„å€¼</td></tr><tr><td style="text-align:center">run</td><td style="text-align:center">r</td><td style="text-align:center">å¯åŠ¨ç¨‹åº</td></tr><tr><td style="text-align:center">until</td><td style="text-align:center">u</td><td style="text-align:center">æ‰§è¡Œåˆ°æŒ‡å®šè¡Œ</td></tr><tr><td style="text-align:center">info</td><td style="text-align:center">i</td><td style="text-align:center">æ˜¾ç¤ºä¿¡æ¯</td></tr><tr><td style="text-align:center">help</td><td style="text-align:center">h</td><td style="text-align:center">å¸®åŠ©ä¿¡æ¯</td></tr></tbody></table><p><strong>è¡¥å……</strong></p><p><code>list è¡Œå·</code> æ˜¾ç¤ºè¡Œå·é™„è¿‘10 è¡Œ</p><p><code>list å‡½æ•°å</code> æ˜¾ç¤ºå‡½æ•°é™„è¿‘10 è¡Œ</p><p><code>break è¡Œå·</code> åœ¨è¡Œå·ä½ç½®æ‰“æ–­ç‚¹</p><p><code>break æ–‡ä»¶åï¼šè¡Œå·</code> åœ¨æŸæ–‡ä»¶è¡Œå·ä½ç½®æ‰“æ–­ç‚¹</p><p><code>break å‡½æ•°å</code> åœ¨å‡½æ•°å¤„æ‰“æ–­ç‚¹</p><p><code>break æ–‡ä»¶åï¼šå‡½æ•°å</code> åœ¨æŸæ–‡ä»¶å†…å‡½æ•°å¤„æ‰“æ–­ç‚¹</p><p><code>info breakpoints</code> æ˜¾ç¤ºå½“å‰æ–­ç‚¹ä¿¡æ¯</p><ul><li><code>Num</code> ä»£è¡¨æ–­ç‚¹ç¼–å·</li><li><code>Type</code> ä»£è¡¨æ–­ç‚¹ç±»å‹</li><li><code>Disp</code>ä»£è¡¨æ–­ç‚¹è¢«å‘½ä¸­åï¼Œè¯¥æ–­ç‚¹ä¿ç•™(<code>keep</code>)ï¼Œåˆ é™¤(<code>del</code>)ï¼Œå…³é—­(<code>dis</code>)</li><li><code>Enb</code> ä»£è¡¨æ–­ç‚¹ enable(<code>y</code>)ï¼Œdisable(<code>n</code>)</li><li><code>Addreee</code> ä»£è¡¨æ–­ç‚¹å¤„è™šæ‹Ÿå†…å­˜åœ°å€</li><li><code>What</code> ä»£è¡¨æ–­ç‚¹æºæ–‡ä»¶ä¿¡æ¯</li></ul><p><code>delete</code> åˆ é™¤æ‰€æœ‰æ–­ç‚¹</p><p><code>delete Num</code> åˆ é™¤æŒ‡å®šæ–­ç‚¹</p><p><code>enable Num</code> å¼€å¯æŒ‡å®šæ–­ç‚¹</p><p><code>enable once Num</code> æ–­ç‚¹ hit ä¸€æ¬¡ä¹‹åå…³é—­è¯¥æ–­ç‚¹</p><p><code>enable delete Num</code> æ–­ç‚¹ hit ä¸€æ¬¡ä¹‹ååˆ é™¤è¯¥æ–­ç‚¹</p><p><code>disable Num</code> å…³é—­æŒ‡å®šæ–­ç‚¹</p><p><code>info locals</code> æ‰“å°å½“å‰æ–­ç‚¹å¤„æ‰€åœ¨å‡½æ•°çš„æ‰€æœ‰å±€éƒ¨å˜é‡ï¼Œä¸åŒ…æ‹¬å‡½æ•°å‚æ•°</p><p><code>print å˜é‡æˆ–è¡¨è¾¾å¼</code> æ‰“å°è¡¨è¾¾å¼çš„å€¼ï¼Œå¯æ˜¾ç¤ºå½“å‰å‡½æ•°çš„å˜é‡å€¼ï¼Œå…¨å±€å˜é‡çš„å€¼</p><p><code>next (N)</code> å•æ­¥æ‰§è¡Œ (N æ¬¡) --&gt; <em><strong>ä¸ä¼šè¿›å…¥å‡½æ•°å†…éƒ¨</strong></em></p><p><code>step (N)</code> å•æ­¥æ‰§è¡Œ (N æ¬¡) --&gt; <em><strong>ä¼šè¿›å…¥å‡½æ•°å†…éƒ¨</strong></em></p><p><code>continue</code> ç»§ç»­</p><p><code>until N</code> æ‰§è¡Œåˆ°ç¨‹åºç¬¬ N è¡Œ</p><p><code>display varname</code> è¿½è¸ªå˜é‡</p><p><code>undisplay varnum</code> å…³é—­è¿½è¸ªï¼Œ varnum å¯ä»¥ç”± <code>info display</code> æ¥æŸ¥çœ‹</p><p><code>set follow-fork-mode [parent|child]</code> é€‰æ‹©çˆ¶å­è¿›ç¨‹è°ƒè¯•</p><!-- rebuild by neat -->]]></content>
      <categories>
        <category>Complie_and_Debug</category>
      </categories>
      <tags>
        <tag>GDB - Complie_and_Debug</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux è¿›ç¨‹é—´é€šä¿¡</title>
    <url>/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/</url>
    <content><![CDATA[<!-- build time:Tue Jun 22 2021 17:02:33 GMT+0800 (GMT+08:00) --><a id="more"></a><h3 id="ä¸€ã€è¿›ç¨‹é€šä¿¡æ¦‚è¿°"><a class="header-anchor" href="#ä¸€ã€è¿›ç¨‹é€šä¿¡æ¦‚è¿°">Â¶</a>ä¸€ã€è¿›ç¨‹é€šä¿¡æ¦‚è¿°</h3><h4 id="1-è¿›ç¨‹é€šä¿¡ã€çº¿ç¨‹é€šä¿¡"><a class="header-anchor" href="#1-è¿›ç¨‹é€šä¿¡ã€çº¿ç¨‹é€šä¿¡">Â¶</a>1. è¿›ç¨‹é€šä¿¡ã€çº¿ç¨‹é€šä¿¡</h4><p>è¿›ç¨‹é€šä¿¡ï¼šåœ¨ç”¨æˆ·ç©ºé—´å®ç°è¿›ç¨‹é€šä¿¡**<font color="FF0000">ä¸å¯èƒ½</font>**ï¼Œéœ€è¦é€šè¿‡ Linux å†…æ ¸é€šä¿¡</p><p>çº¿ç¨‹é€šä¿¡ï¼šå¯ä»¥åœ¨ç”¨æˆ·ç©ºé—´å®ç°ï¼Œé€šè¿‡<strong>å…¨å±€å˜é‡</strong>å³å¯</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"unistd.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/types.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">pid_t</span> pid;</span><br><span class="line">    <span class="keyword">int</span> process_inter = <span class="number">0</span>;</span><br><span class="line">    pid = fork();</span><br><span class="line">    <span class="keyword">if</span> (pid == <span class="number">0</span>) &#123; <span class="comment">// child process code second</span></span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (process_inter == <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"this is child process i = %d"</span>, i);</span><br><span class="line">            usleep(<span class="number">100</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (pid &gt; <span class="number">0</span>) &#123; <span class="comment">// parent process code first</span></span><br><span class="line">    	<span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"this iparent process i = %d"</span>, i);</span><br><span class="line">            usleep(<span class="number">100</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        process_inter = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ— æ³•é€šè¿‡<strong>ç”¨æˆ·ç©ºé—´</strong>å…¨å±€å˜é‡å®ç°è¿›ç¨‹é—´é€šä¿¡ï¼Œä¸Šæ®µç¨‹åºåªèƒ½è¿è¡Œçˆ¶è¿›ç¨‹ã€‚</p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/å…¨å±€å˜é‡_è¿›ç¨‹é€šä¿¡_error.png" style="zoom:80%"><h4 id="2-è¿›ç¨‹é€šä¿¡æ–¹å¼"><a class="header-anchor" href="#2-è¿›ç¨‹é€šä¿¡æ–¹å¼">Â¶</a>2. è¿›ç¨‹é€šä¿¡æ–¹å¼</h4><p><strong>å•æœºæ¨¡å¼</strong>ä¸‹ï¼šï¼ˆåªæœ‰ä¸€ä¸ª Linux å†…æ ¸ï¼‰</p><ul><li>ç®¡é“é€šä¿¡ï¼šæ— åç®¡é“ã€æœ‰åç®¡é“ï¼ˆæ–‡ä»¶ç³»ç»Ÿä¸­æœ‰åï¼‰</li><li>ä¿¡å·é€šä¿¡ï¼šä¿¡å·çš„å‘é€ã€ä¿¡å·çš„æ¥æ”¶å’Œä¿¡å·çš„å¤„ç†</li><li>IPCï¼ˆInter-Process Communicationï¼‰ï¼šå…±äº«å†…å­˜ã€æ¶ˆæ¯é˜Ÿåˆ—å’Œä¿¡å·ç¯ï¼ˆé‡ï¼‰</li></ul><p>å¤šæœºæ¨¡å¼ä¸‹ï¼šï¼ˆä¸¤ä¸ª Linux å†…æ ¸ï¼‰</p><ul><li>Socket é€šä¿¡ï¼šå­˜åœ¨äºä¸€ä¸ªç½‘ç»œä¸­ä¸¤ä¸ªè¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚</li></ul><h4 id="3-è¿›ç¨‹é€šä¿¡çš„å­¦ä¹ æ€è·¯"><a class="header-anchor" href="#3-è¿›ç¨‹é€šä¿¡çš„å­¦ä¹ æ€è·¯">Â¶</a>3. è¿›ç¨‹é€šä¿¡çš„å­¦ä¹ æ€è·¯</h4><p>è¿›ç¨‹é€šä¿¡çš„å­¦ä¹ æ€è·¯ï¼šæ¯ä¸€ç§é€šä¿¡æ–¹å¼éƒ½æ˜¯åŸºäºæ–‡ä»¶IOçš„æ€æƒ³</p><ul><li><strong><code>open</code></strong> ï¼šåˆ›å»ºæˆ–è€…æ‰“å¼€è¿›ç¨‹é€šä¿¡å¯¹è±¡ã€‚å‡½æ•°å½¢å¼å¯èƒ½ä¸åŒï¼Œå¯èƒ½æœ‰å¤šä¸ªå‡½æ•°å®Œæˆ</li><li><strong><code>write</code></strong> ï¼šå‘è¿›ç¨‹é€šä¿¡å¯¹è±¡ä¸­å†™å…¥å†…å®¹ã€‚å‡½æ•°å½¢å¼å¯èƒ½ä¸åŒã€‚</li><li><strong><code>read</code></strong> ï¼šä»è¿›ç¨‹é€šä¿¡å¯¹è±¡ä¸­è¯»å–å†…å®¹ã€‚å‡½æ•°å½¢å¼å¯èƒ½ä¸åŒã€‚</li><li><strong><code>close</code></strong> ï¼šå…³é—­æˆ–åˆ é™¤è¿›ç¨‹é€šä¿¡å¯¹è±¡ã€‚å‡½æ•°å½¢å¼å¯èƒ½ä¸åŒã€‚</li></ul><h3 id="äºŒã€æ— åç®¡é“"><a class="header-anchor" href="#äºŒã€æ— åç®¡é“">Â¶</a>äºŒã€æ— åç®¡é“</h3><p>é€šä¿¡åŸç†ï¼š</p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/æ— åç®¡é“é€šä¿¡åŸç†.png" style="zoom:50%"><p>ç®¡é“æ–‡ä»¶æ˜¯ä¸€ä¸ªç‰¹æ®Šæ–‡ä»¶ï¼Œæ˜¯æœ‰<strong>é˜Ÿåˆ—</strong>æ¥å®ç°çš„ã€‚</p><h4 id="2-1-æ— åç®¡é“çš„åˆ›å»º"><a class="header-anchor" href="#2-1-æ— åç®¡é“çš„åˆ›å»º">Â¶</a>2.1 æ— åç®¡é“çš„åˆ›å»º</h4><p>åœ¨æ–‡ä»¶IOä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶æˆ–æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æ˜¯ç”± <strong><code>open</code></strong> å‡½æ•°å®ç°çš„ï¼Œå®ƒä¸èƒ½åˆ›å»ºç®¡é“æ–‡ä»¶ã€‚åªèƒ½ç”¨ <strong><code>pipe</code></strong> å‡½æ•°æ¥åˆ›å»ºç®¡é“ã€‚</p><p><strong>å‡½æ•°å½¢å¼</strong>ï¼š <strong><code>int pipe(int fd[2])</code></strong></p><p><strong>åŠŸèƒ½</strong>ï¼šåˆ›å»ºç®¡é“ï¼Œä¸ºç³»ç»Ÿè°ƒç”¨ï¼Œ <strong><code>unistd.h</code></strong></p><p><strong>å‚æ•°</strong>ï¼šå°±æ˜¯å¾—åˆ°çš„æ–‡ä»¶æè¿°ç¬¦ã€‚å¯è§æœ‰ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œ<strong><code>fd[0]</code></strong>ã€<strong><code>fd[1]</code></strong>ï¼Œç®¡é“æœ‰ä¸€ä¸ªè¯»ç«¯ <strong><code>fd[0]</code></strong> ç”¨æ¥è¯»ï¼Œ <strong><code>fd[1]</code></strong> ç”¨æ¥å†™ã€‚</p><p><strong>è¿”å›å€¼</strong>ï¼šæˆåŠŸ 0ï¼Œå¤±è´¥ -1</p><h4 id="2-2-pipe-å‡½æ•°ä½¿ç”¨"><a class="header-anchor" href="#2-2-pipe-å‡½æ•°ä½¿ç”¨">Â¶</a>2.2 <code>pipe</code> å‡½æ•°ä½¿ç”¨</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"unistd.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> fd[<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">int</span> ret;</span><br><span class="line">    <span class="keyword">char</span> writebuf[] = <span class="string">"hello linux!"</span>;</span><br><span class="line">    <span class="keyword">char</span> readbuf[<span class="number">128</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    ret = pipe(fd);</span><br><span class="line">    <span class="keyword">if</span> (ret &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"create pipe failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"create pipe sucess fd[0] = %d, fd[1] = %d\n"</span>, fd[<span class="number">0</span>], fd[<span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">write</span>(fd[<span class="number">1</span>], writebuf, <span class="keyword">sizeof</span>(writebuf));</span><br><span class="line">    <span class="built_in">read</span>(fd[<span class="number">0</span>], readbuf, <span class="number">128</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"readbuf = %s\n"</span>, readbuf);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼š</strong></p><ul><li>ç®¡é“æ˜¯åˆ›å»ºåœ¨å†…å­˜ä¸­çš„ï¼Œ<strong>è¿›ç¨‹ç»“æŸï¼Œç©ºé—´é‡Šæ”¾ï¼Œç®¡é“å°±ä¸å†äº†</strong>ï¼›</li><li>ç®¡é“ä¸­çš„ä¸œè¥¿ï¼Œ<strong>è¯»å®Œäº†å°±åˆ é™¤äº†</strong>ï¼›</li><li>å¦‚æœç®¡é“æ²¡æœ‰ä¸œè¥¿å¯è¯»ï¼Œå°±ä¼š<strong>é˜»å¡</strong>ã€‚</li></ul><h4 id="2-3-éªŒè¯è¯»é˜»å¡"><a class="header-anchor" href="#2-3-éªŒè¯è¯»é˜»å¡">Â¶</a>2.3 éªŒè¯è¯»é˜»å¡</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"unistd.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"string.h"</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> fd[<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">int</span> ret;</span><br><span class="line">    <span class="keyword">char</span> writebuf[] = <span class="string">"hello linux!"</span>;</span><br><span class="line">    <span class="keyword">char</span> readbuf[<span class="number">128</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    ret = pipe(fd);</span><br><span class="line">    <span class="keyword">if</span> (ret &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"create pipe failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"create pipe sucess fd[0] = %d, fd[1] = %d\n"</span>, fd[<span class="number">0</span>], fd[<span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">write</span>(fd[<span class="number">1</span>], writebuf, <span class="keyword">sizeof</span>(writebuf));</span><br><span class="line">    <span class="built_in">read</span>(fd[<span class="number">0</span>], readbuf, <span class="number">128</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"readbuf = %s\n"</span>, readbuf);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// second read from pipe</span></span><br><span class="line">    <span class="comment">// ä¼šé˜»å¡</span></span><br><span class="line">    <span class="built_in">memset</span>(readbuf, <span class="number">0</span>, <span class="number">128</span>);</span><br><span class="line">    <span class="built_in">read</span>(fd[<span class="number">0</span>], readbuf, <span class="number">128</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"readbuf = %s\n"</span>, readbuf);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">close</span>(fd[<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">close</span>(fd[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/%E8%AF%BB%E9%98%BB%E5%A1%9E.png" alt></p><p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/%E9%98%BB%E5%A1%9E_%E7%9D%A1%E7%9C%A0%E7%8A%B6%E6%80%81.png" alt="image-20210422190256281"></p><h4 id="2-4-éªŒè¯å†™é˜»å¡"><a class="header-anchor" href="#2-4-éªŒè¯å†™é˜»å¡">Â¶</a>2.4 éªŒè¯å†™é˜»å¡</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"unistd.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"string.h"</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> fd[<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">int</span> ret;</span><br><span class="line">    <span class="keyword">char</span> writebuf[] = <span class="string">"hello linux!"</span>;</span><br><span class="line">    <span class="keyword">char</span> readbuf[<span class="number">128</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    ret = pipe(fd);</span><br><span class="line">    <span class="keyword">if</span> (ret &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"create pipe failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"create pipe sucess fd[0] = %d, fd[1] = %d\n"</span>, fd[<span class="number">0</span>], fd[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// å¯ä»¥é€šè¿‡ i çš„è®¾å®šï¼Œè®¡ç®—ç®¡é“çš„å¤§å°</span></span><br><span class="line">    <span class="keyword">while</span> (i &lt; <span class="number">5500</span>) &#123;</span><br><span class="line">        <span class="built_in">write</span>(fd[<span class="number">1</span>], writebuf, <span class="keyword">sizeof</span>(writebuf));</span><br><span class="line">        i++;</span><br><span class="line">    &#125;   </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"write pipe end\n"</span>); </span><br><span class="line">    </span><br><span class="line">    <span class="built_in">close</span>(fd[<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">close</span>(fd[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/%E5%86%99%E9%98%BB%E5%A1%9E.png" alt></p><p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/%E5%86%99%E9%98%BB%E5%A1%9E_%E7%9D%A1%E7%9C%A0%E7%8A%B6%E6%80%81.png" alt></p><h4 id="2-5-å®ç°è¿›ç¨‹é€šä¿¡ã€‚"><a class="header-anchor" href="#2-5-å®ç°è¿›ç¨‹é€šä¿¡ã€‚">Â¶</a>2.5 å®ç°è¿›ç¨‹é€šä¿¡ã€‚</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"unistd.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/types.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">pid_t</span> pid;</span><br><span class="line">    <span class="keyword">char</span> process_inter = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> fd[<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">int</span> ret;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ›å»ºç®¡é“</span></span><br><span class="line">    ret = pipe(fd);</span><br><span class="line">    <span class="keyword">if</span> (ret &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"create pipe failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"create pipe success\n"</span>);</span><br><span class="line">    </span><br><span class="line">    pid = fork();</span><br><span class="line">    <span class="keyword">if</span> (pid == <span class="number">0</span>) &#123; <span class="comment">// child process code second</span></span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// if pipe empty  sleep</span></span><br><span class="line">        <span class="comment">//éœ€è¦æ³¨æ„è¯¥processä¸çˆ¶è¿›ç¨‹processåŒåè€Œå·²</span></span><br><span class="line">        <span class="keyword">while</span> (process_inter == <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"this is child process i = %d"</span>, i);</span><br><span class="line">            usleep(<span class="number">100</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (pid &gt; <span class="number">0</span>) &#123; <span class="comment">// parent process code first</span></span><br><span class="line">    	<span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"this iparent process i = %d"</span>, i);</span><br><span class="line">            usleep(<span class="number">100</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        process_inter = <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">write</span>(fd[<span class="number">1</span>], &amp;process_inter, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥å®ç°è¿›ç¨‹é—´é€šä¿¡</p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/ç®¡é“_è¿›ç¨‹é€šä¿¡.png" style="zoom:80%"><h3 id="ä¸‰ã€æœ‰åç®¡é“"><a class="header-anchor" href="#ä¸‰ã€æœ‰åç®¡é“">Â¶</a>ä¸‰ã€æœ‰åç®¡é“</h3><p>æ— åç®¡é“çš„**<font color="FF000">ç¼ºç‚¹</font>**ï¼š<strong>ä¸èƒ½å®ç°ä¸æ˜¯çˆ¶å­è¿›ç¨‹ï¼ˆäº²ç¼˜å…³ç³»ï¼‰ä¹‹é—´çš„é€šä¿¡ã€‚</strong></p><p>æ­£ç”±äºè¿™æ— åç®¡é“çš„ç¼ºç‚¹ï¼Œå¯¹äºæ— åç®¡é“è¿›è¡Œæ”¹è¿›ï¼Œ<strong>æœ‰åç®¡é“ã€‚</strong></p><p>æ‰€è°“çš„<strong>æœ‰å</strong>ï¼Œå³æ–‡ä»¶ç³»ç»Ÿä¸­å­˜åœ¨è¿™ä¸ªä¸€æ ·æ–‡ä»¶èŠ‚ç‚¹ï¼Œæ¯ä¸€ä¸ªæ–‡ä»¶èŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ª <strong><code>inode</code></strong> å·ï¼Œè€Œä¸”è¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ–‡ä»¶ç±»å‹ï¼š <strong><code>p</code></strong> ç®¡é“ç±»å‹ã€‚</p><ol><li><p><strong><font color="FF000">åˆ›å»º</font><strong>è¿™ä¸ªæ–‡ä»¶èŠ‚ç‚¹ï¼Œä¸å¯ä»¥é€šè¿‡ <strong><code>open</code></strong> å‡½æ•°ï¼Œ</strong><code>open</code></strong> å‡½æ•°åªèƒ½åˆ›å»ºæ™®é€šæ–‡ä»¶ï¼Œä¸èƒ½åˆ›å»ºç‰¹æ®Šæ–‡ä»¶ï¼ˆç®¡é“- <strong><code>mkfifo</code></strong> ï¼Œå¥—æ¥å­—- <strong><code>socket</code></strong> ï¼Œå­—ç¬¦è®¾å¤‡æ–‡ä»¶- <strong><code>mknod</code></strong> ï¼Œå—è®¾å¤‡æ–‡ä»¶- <strong><code>mknod</code></strong> ï¼Œç¬¦å·é“¾æ¥æ–‡ä»¶-<strong><code>ln -s</code></strong>ï¼Œç›®å½•æ–‡ä»¶- <strong><code>mkdir</code></strong> ï¼‰</p></li><li><p>ç®¡é“æ–‡ä»¶åªæœ‰ <strong><code>inode</code></strong> å·ï¼Œä¸å ç£ç›˜å—ç©ºé—´ï¼Œå’Œå¥—æ¥å­—ã€å­—ç¬¦è®¾å¤‡æ–‡ä»¶ã€å—è®¾å¤‡æ–‡ä»¶ä¸€æ ·ã€‚æ™®é€šæ–‡ä»¶å’Œç¬¦å·é“¾æ¥æ–‡ä»¶åŠç›®å½•æ–‡ä»¶ï¼Œä¸ä»…æœ‰ <strong><code>inode</code></strong> å·ï¼Œè¿˜å æœ‰ç£ç›˜å—ç©ºé—´</p></li><li><p><strong><code>mkfifo</code></strong> : ç”¨æ¥<strong>åˆ›å»º</strong>ç®¡é“æ–‡ä»¶çš„<strong>èŠ‚ç‚¹</strong>ï¼Œ<strong>æ²¡æœ‰åœ¨å†…æ ¸ä¸­åˆ›å»ºç®¡é“</strong>ã€‚åªæœ‰é€šè¿‡ <strong><code>open</code></strong> å‡½æ•°<strong>æ‰“å¼€è¿™ä¸ªæ–‡ä»¶æ—¶æ‰ä¼šåœ¨å†…æ ¸ç©ºé—´åˆ›å»ºç®¡é“</strong>ã€‚</p></li></ol><h4 id="3-1-æœ‰åç®¡é“çš„åˆ›å»º"><a class="header-anchor" href="#3-1-æœ‰åç®¡é“çš„åˆ›å»º">Â¶</a>3.1 æœ‰åç®¡é“çš„åˆ›å»º</h4><p><strong><code>mkfifo</code> çš„ç”¨æ³•</strong></p><p><strong>å‡½æ•°å½¢å¼: <code>int mkfifo(const char* filename, mode_t mode);</code></strong> åˆ›å»ºç®¡é“æ–‡ä»¶ã€‚</p><p><strong>å‚æ•°</strong>ï¼šç®¡é“æ–‡ä»¶åï¼Œæƒé™ï¼Œåˆ›å»ºçš„æ–‡ä»¶æƒé™ä»»ç„¶å’Œ <strong><code>umask</code></strong> æœ‰å…³ç³»</p><p><strong>è¿”å›å€¼</strong>ï¼šåˆ›å»ºæˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"unistd.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret;</span><br><span class="line">    ret = mkfifo(<span class="string">"./myfifo"</span>, <span class="number">0777</span>); <span class="comment">// æƒé™ 0777</span></span><br><span class="line">    <span class="keyword">if</span> (ret &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"create myfifo failure \n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"create myfifo success \n"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-2-é€šè¿‡ç®¡é“å®ç°æ— äº²ç¼˜å…³ç³»è¿›ç¨‹é—´é€šä¿¡"><a class="header-anchor" href="#3-2-é€šè¿‡ç®¡é“å®ç°æ— äº²ç¼˜å…³ç³»è¿›ç¨‹é—´é€šä¿¡">Â¶</a>3.2 é€šè¿‡ç®¡é“å®ç°æ— äº²ç¼˜å…³ç³»è¿›ç¨‹é—´é€šä¿¡</h4><p><strong><code>first.c</code></strong></p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"unistd.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/types.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"fcntl.h"</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> fd;</span><br><span class="line">    <span class="keyword">char</span> process_inter = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// æ‰“å¼€ä¹‹å‰åˆ›å»ºçš„ç®¡é“ç±»å‹æ–‡ä»¶</span></span><br><span class="line">    fd = <span class="built_in">open</span>(<span class="string">"./myfifo"</span>, O_WRONLY);</span><br><span class="line">    <span class="keyword">if</span> (fd &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"open myfifo failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"open myfifo success \n"</span>);</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"this is first process i = %d\n"</span>, i);</span><br><span class="line">        usleep(<span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    process_inter = <span class="number">1</span>;</span><br><span class="line">    sleep(<span class="number">3</span>);</span><br><span class="line">    <span class="comment">// å‘ç®¡é“ä¸­å†™</span></span><br><span class="line">    <span class="built_in">write</span>(fd, &amp;process_inter, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><code>second.c</code></strong></p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"unistd.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/types.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"fcntl.h"</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> fd;</span><br><span class="line">    <span class="keyword">char</span> process_inter = <span class="number">0</span>;</span><br><span class="line">    fd = <span class="built_in">open</span>(<span class="string">"./myfifo"</span>, O_RDONLY);</span><br><span class="line">    <span class="keyword">if</span> (fd &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"open myfifo failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"open myfifo success \n"</span>);</span><br><span class="line">    <span class="comment">// ä»ç®¡é“ä¸­è¯»</span></span><br><span class="line">    <span class="built_in">read</span>(fd, &amp;process_inter, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">while</span> (process_inter == <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"this is second process i = %d\n"</span>, i);</span><br><span class="line">        usleep(<span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…ˆè¿è¡Œ <strong><code>first</code></strong> <strong>open</strong> ç®¡é“æ–‡ä»¶ï¼š<strong><code>myfifo</code></strong></p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/å¼€å¯first.png" style="zoom:80%"><p>è¿è¡Œ <strong><code>second</code></strong> ï¼Œæ­¤æ—¶ä¸¤ç«¯å¼€å§‹é€šä¿¡ï¼Œ<strong><code>first</code></strong> å…ˆè¿è¡Œï¼Œ<strong><code>second</code></strong> åè¿è¡Œ</p><p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/first_after_second.png" style="zoom:80%"> <img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/second.png" style="zoom:80%"></p><h3 id="å››ã€ä¿¡å·é€šä¿¡"><a class="header-anchor" href="#å››ã€ä¿¡å·é€šä¿¡">Â¶</a>å››ã€ä¿¡å·é€šä¿¡</h3><p>ä¿¡å·é€šä¿¡ï¼Œå…¶å®å°±æ˜¯å†…æ ¸å‘ç”¨æˆ·ç©ºé—´è¿›ç¨‹**<font color="FF0000">å‘é€ä¿¡å·</font><strong>ï¼Œåªæœ‰</strong><font color="FF0000">å†…æ ¸æ‰èƒ½å‘ä¿¡å·</font>**ï¼Œç”¨æˆ·ç©ºé—´è¿›ç¨‹ä¸èƒ½å‘ä¿¡å·ã€‚</p><p>å†…æ ¸å¯ä»¥å‘é€<strong>å¤šå°‘ç§</strong>ä¿¡å·ï¼Ÿ<strong><code>kill -l</code></strong> : <strong>64 ç§</strong>ï¼Œå¸¸è§å‘½ä»¤ï¼š<strong><code>kill 9 pid</code></strong> (æ€æ­»è¿›ç¨‹)</p><p>ä¿¡å·é€šä¿¡çš„æ¡†æ¶</p><ul><li>ä¿¡å·çš„å‘é€ï¼ˆå‘é€ä¿¡å·è¿›ç¨‹ï¼‰ï¼š <strong><code>kill</code> <font color="FF0000"><code>raise</code></font> <code>alarm</code></strong></li><li>ä¿¡å·çš„æ¥æ”¶ï¼ˆæ¥æ”¶ä¿¡å·è¿›ç¨‹ï¼‰ï¼š <strong><code>pause()</code> <code>sleep</code> <code>while(1)</code></strong></li><li>ä¿¡å·çš„å¤„ç†ï¼ˆæ¥æ”¶ä¿¡å·è¿›ç¨‹ï¼‰ï¼š <strong><code>signal</code></strong></li></ul><h4 id="4-1-ä¿¡å·çš„å‘é€ï¼ˆå‘é€ä¿¡å·è¿›ç¨‹ï¼‰"><a class="header-anchor" href="#4-1-ä¿¡å·çš„å‘é€ï¼ˆå‘é€ä¿¡å·è¿›ç¨‹ï¼‰">Â¶</a>4.1 ä¿¡å·çš„å‘é€ï¼ˆå‘é€ä¿¡å·è¿›ç¨‹ï¼‰</h4><h5 id="4-1-1-kill"><a class="header-anchor" href="#4-1-1-kill">Â¶</a>4.1.1 <strong><code>kill</code></strong></h5><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/killæ“ä½œ.png" style="zoom:50%"><p><strong>ä¾‹å­ï¼šç¼–å†™è‡ªå·±çš„killå‡½æ•°</strong></p><p>åˆ›å»ºä¸€ä¸ªç®€å•çš„è¿›ç¨‹ <strong><code>test.c</code></strong></p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æ­»å¾ªç¯</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œåç³»ç»Ÿæ­»å¾ªç¯<br><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/image-20210423171228323.png" alt="image-20210423171228323"></p><p><strong><code>mykill.c</code></strong></p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/types.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"signal.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"unistd.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> sig;</span><br><span class="line">    <span class="keyword">int</span> pid;</span><br><span class="line">    <span class="keyword">if</span> (argc &lt; <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"please input param\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    sig = atoi(argv[<span class="number">1</span>]);</span><br><span class="line">    pid = atoi(argv[<span class="number">2</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"sig = %d, pid = %d \n"</span>, sig, pid);</span><br><span class="line">    <span class="comment">// è°ƒç”¨ç³»ç»Ÿå‡½æ•°</span></span><br><span class="line">    kill(pid, sig);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <strong>9</strong> å·ä¿¡å·é‡ <strong><code>SIGKILL</code></strong> æ¥ <strong>kill</strong> æ‰ <strong><code>./test</code></strong> è¿›ç¨‹</p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/image-20210423171719834.png" alt="image-20210423171719834" style="zoom:80%"> <img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/image-20210423171538416.png" alt="image-20210423171538416" style="zoom:80%"><p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/image-20210423171817097.png" alt="image-20210423171817097"></p><h5 id="4-1-2-raise"><a class="header-anchor" href="#4-1-2-raise">Â¶</a>4.1.2 raise</h5><p><strong><code>raise</code></strong> : å‘ä¿¡å·ç»™è‡ªå·±ï¼Œç­‰ä»·äº <strong><code>kill(getpid(), sig)</code></strong></p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/raiseå‡½æ•°.png" style="zoom:67%"><p><strong>ä¾‹å­ï¼šraise å‡½æ•°</strong></p><p><strong><code>raise.c</code></strong></p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/types.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"signal.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"raise before"</span>);   <span class="comment">// è¾“å‡ºç»“æœè§1å›¾ï¼Œå®ƒåªæ˜¯å°†è¯¥è¯­å¥å†™å…¥åº“å‡½æ•°ç¼“å­˜ï¼Œæ²¡æœ‰å†™å…¥å†…æ ¸</span></span><br><span class="line">    <span class="comment">// printf("raise before\n");  // è¾“å‡ºç»“æœè§2å›¾</span></span><br><span class="line">    raise(<span class="number">9</span>); <span class="comment">// ç›¸å½“äº_exit()ï¼Œè€Œéexit();</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"raise after\n"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/raise_01.png" alt="raise_01"></p><p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/raise_02.png" alt></p><p><strong><code>raise_2.c</code></strong></p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/types.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"signal.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"unistd.h"</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">pid_t</span> pid;</span><br><span class="line">    pid = fork();</span><br><span class="line">    <span class="keyword">if</span> (pid &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        sleep(<span class="number">8</span>);</span><br><span class="line">        <span class="keyword">while</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (pid == <span class="number">0</span>) &#123;</span><br><span class="line">    	<span class="built_in">printf</span>(<span class="string">"raise function before\n"</span>);</span><br><span class="line">        raise(SIGTSTP); <span class="comment">// è¿›ç¨‹è¿›å…¥æš‚åœçŠ¶æ€ï¼ˆTï¼‰</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"raise function after\n"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¨‹åºè¿è¡Œåï¼Œé¦–å…ˆå­è¿›ç¨‹è¾“å‡ºè¯­å¥</p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/raise_05.png" style="zoom:80%"><p>ä¹‹åè°ƒç”¨ <strong><code>raise</code></strong> å‡½æ•°è¿›å…¥æš‚åœçŠ¶æ€ï¼Œæ­¤æ—¶çˆ¶è¿›ç¨‹ç¡çœ çŠ¶æ€ <strong><code>S</code></strong>ï¼Œå­è¿›ç¨‹æš‚åœçŠ¶æ€ <strong><code>T</code></strong></p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/raise_03.png" style="zoom:80%"><p>çˆ¶è¿›ç¨‹ç¡çœ  8 ç§’åï¼Œçˆ¶è¿›ç¨‹è¿›å…¥è¿è¡ŒçŠ¶æ€ <strong><code>R</code></strong> ï¼Œæ­¤æ—¶å­è¿›ç¨‹ä»ç„¶æ˜¯æš‚åœçŠ¶æ€ <strong><code>T</code></strong></p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/raise_04.png" style="zoom:80%"><p>ç¨å¾®ä¿®æ”¹ä¸€ä¸‹ <strong><code>raise_2.c</code></strong></p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/types.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"signal.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"unistd.h"</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">pid_t</span> pid;</span><br><span class="line">    pid = fork();</span><br><span class="line">    <span class="keyword">if</span> (pid &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        sleep(<span class="number">8</span>);</span><br><span class="line">        <span class="keyword">if</span> (waitpid(pid, <span class="literal">NULL</span>, WNOHANG) == <span class="number">0</span>) &#123;</span><br><span class="line">            kill(pid, <span class="number">9</span>); <span class="comment">// æ€æ­»å­è¿›ç¨‹ï¼Œæ­¤æ—¶çˆ¶è¿›ç¨‹æ²¡æœ‰å¯¹å…¶è¿›è¡Œå›æ”¶èµ„æº(wait)</span></span><br><span class="line">            			  <span class="comment">// å­è¿›ç¨‹ä¼šå˜æˆåƒµå°¸è¿›ç¨‹</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// wait(NULL); // åŠ ä¸Š wait å‡½æ•°å›æ”¶å­è¿›ç¨‹èµ„æºï¼Œå­è¿›ç¨‹å°±ä¸ä¼šå˜æˆåƒµå°¸è¿›ç¨‹</span></span><br><span class="line">        <span class="keyword">while</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (pid == <span class="number">0</span>) &#123;</span><br><span class="line">    	<span class="built_in">printf</span>(<span class="string">"raise function before\n"</span>);</span><br><span class="line">        raise(SIGTSTP); <span class="comment">// è¿›ç¨‹è¿›å…¥æš‚åœçŠ¶æ€ï¼ˆTï¼‰</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"raise function after\n"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¨‹åºè¿è¡Œåï¼Œé¦–å…ˆå­è¿›ç¨‹è¾“å‡ºè¯­å¥</p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/raise_05.png" style="zoom:67%"><p>ä¹‹åè°ƒç”¨ <strong><code>raise</code></strong> å‡½æ•°è¿›å…¥æš‚åœçŠ¶æ€ï¼Œæ­¤æ—¶çˆ¶è¿›ç¨‹ç¡çœ çŠ¶æ€ <strong><code>S</code></strong>ï¼Œå­è¿›ç¨‹æš‚åœçŠ¶æ€ <strong><code>T</code></strong></p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/raise_06.png" style="zoom:80%"><p>çˆ¶è¿›ç¨‹ç¡çœ  8 ç§’åï¼Œçˆ¶è¿›ç¨‹è¿›å…¥è¿è¡ŒçŠ¶æ€ <strong><code>R</code></strong> ï¼Œæ­¤æ—¶å­è¿›ç¨‹è¿›å…¥åƒµå°¸çŠ¶æ€ <strong><code>Z</code></strong></p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/raise_07.png" style="zoom:80%"><p>åŠ ä¸Š <strong><code>wait()</code></strong> å­è¿›ç¨‹è¢« <strong><code>kill</code></strong> åä¸ä¼šå˜æˆåƒµå°¸è¿›ç¨‹</p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/raise_08.png" style="zoom:80%"><h5 id="4-1-3-alarm"><a class="header-anchor" href="#4-1-3-alarm">Â¶</a>4.1.3 <code>alarm</code></h5><p><strong><code>alarm</code></strong> ä¸ <strong><code>raise</code></strong> çš„æ¯”è¾ƒï¼š</p><ul><li><p><strong>ç›¸åŒç‚¹</strong>ï¼šè®©å†…æ ¸å‘é€ä¿¡å·ç»™å½“å‰è¿›ç¨‹</p></li><li><p><strong>ä¸åŒç‚¹</strong>ï¼š</p><ul><li><p><strong><code>alarm</code></strong> åªä¼šå‘é€ <strong><code>SIGALARM</code></strong> ä¿¡å· (<strong>14</strong> å·ä¿¡å·)</p></li><li><p><strong><code>alarm</code></strong> ä¼šè®©å†…æ ¸<strong>å®šæ—¶</strong>ä¸€æ®µæ—¶é—´ä¹‹åå‘é€ä¿¡å·ï¼Œ <strong><code>raise</code></strong> ä¼šè®©å†…æ ¸<strong>ç«‹åˆ»</strong>å‘ä¿¡å·</p></li></ul></li></ul><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/alarmå‡½æ•°.png" style="zoom:67%"><p><strong>ä¾‹å­ï¼šalarm</strong></p><p><strong><code>alarm.c</code></strong></p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/types.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"signal.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"unistd.h"</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"alarm before\n"</span>);   </span><br><span class="line">    alarm(<span class="number">9</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"alarm before\n"</span>);</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; <span class="number">20</span>) &#123;</span><br><span class="line">        i++;</span><br><span class="line">        sleep(<span class="number">1</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"process things, i = %d \n"</span>, i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼Œ<strong><code>alarm</code></strong> åœ¨ 9 ç§’åç»ˆæ­¢æ“ä½œ</p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/alarm_01.png" style="zoom:80%"><h4 id="4-2-ä¿¡å·çš„æ¥æ”¶ï¼ˆæ¥æ”¶ä¿¡å·è¿›ç¨‹ï¼‰"><a class="header-anchor" href="#4-2-ä¿¡å·çš„æ¥æ”¶ï¼ˆæ¥æ”¶ä¿¡å·è¿›ç¨‹ï¼‰">Â¶</a>4.2 ä¿¡å·çš„æ¥æ”¶ï¼ˆæ¥æ”¶ä¿¡å·è¿›ç¨‹ï¼‰</h4><p>æ¥æ”¶ä¿¡å·çš„è¿›ç¨‹çš„æ¡ä»¶ï¼šè¦æƒ³ä½¿æ¥æ”¶çš„è¿›ç¨‹èƒ½æ¥æ”¶ä¿¡å·ï¼Œè¿™ä¸ªè¿›ç¨‹ä¸èƒ½ç»“æŸ</p><ul><li><p><strong><code>sleep</code></strong></p></li><li><p><strong><code>while(1)</code></strong></p></li><li><p><strong><code>pause</code></strong> è¿›ç¨‹çŠ¶æ€ä¸º <strong><code>S</code></strong></p></li></ul><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/pauseå‡½æ•°.png" style="zoom:67%"><p><strong><code>pause.c</code></strong></p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/types.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"signal.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"unistd.h"</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"pause before \n"</span>);</span><br><span class="line">    pause();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"pause after \n"</span>);</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; <span class="number">20</span>) &#123;</span><br><span class="line">        i++;</span><br><span class="line">        sleep(<span class="number">1</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"process things, i = %d"</span>, i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç¨‹åºåï¼Œè¿›ç¨‹å¤„äºç¡çœ çŠ¶æ€ <strong><code>S</code></strong></p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/pause_01.png" style="zoom:80%"> <img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/pause_02.png" style="zoom:80%"><h4 id="4-3-ä¿¡å·çš„å¤„ç†ï¼ˆæ¥æ”¶ä¿¡å·è¿›ç¨‹ï¼‰"><a class="header-anchor" href="#4-3-ä¿¡å·çš„å¤„ç†ï¼ˆæ¥æ”¶ä¿¡å·è¿›ç¨‹ï¼‰">Â¶</a>4.3 ä¿¡å·çš„å¤„ç†ï¼ˆæ¥æ”¶ä¿¡å·è¿›ç¨‹ï¼‰</h4><p>æ”¶åˆ°ä¿¡å·çš„è¿›ç¨‹ï¼Œåº”è¯¥æ€æ ·å¤„ç†ï¼Ÿå¤„ç†çš„æ–¹å¼ï¼š</p><p>ï¼ˆ1ï¼‰è¿›ç¨‹çš„<strong>é»˜è®¤</strong>å¤„ç†æ–¹å¼ï¼ˆå†…æ ¸ä¸ºç”¨æˆ·è¿›ç¨‹è®¾ç½®çš„é»˜è®¤å¤„ç†æ–¹å¼ï¼‰ï¼š</p><ul><li>å¿½ç•¥</li><li>ç»ˆæ­¢è¿›ç¨‹</li><li>æš‚åœ</li></ul><p>ï¼ˆ2ï¼‰è‡ªå®šä¹‰çš„å¤„ç†æ–¹å¼ï¼šè‡ªå®šä¹‰å¤„ç†ä¿¡å·çš„æ–¹æ³•å‘Šè¯‰å†…æ ¸ï¼Œè¿™æ ·çº¿ç¨‹æ”¶åˆ°äº†è¿™ä¸ªä¿¡å·å°±ä¼šé‡‡ç”¨è‡ªå®šä¹‰çš„å¤„ç†æ–¹å¼</p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/signalå‡½æ•°.png" style="zoom:67%"><p><strong><code>signal</code></strong> å‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œ</p><ul><li><p>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ•´å½¢å˜é‡ï¼ˆä¿¡å·å€¼ï¼‰ï¼Œ</p></li><li><p>ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œæ˜¯è‡ªå®šä¹‰çš„å¤„ç†å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆã€‚</p></li></ul><h5 id="4-3-1-è‡ªå®šä¹‰å¤„ç†"><a class="header-anchor" href="#4-3-1-è‡ªå®šä¹‰å¤„ç†">Â¶</a>4.3.1 è‡ªå®šä¹‰å¤„ç†</h5><p><strong><code>signal.c</code></strong></p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/types.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"signal.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"unistd.h"</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">myfun</span><span class="params">(<span class="keyword">int</span> signum)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; <span class="number">10</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"process signal signum = %d, i = %d\n"</span>, signum);</span><br><span class="line">        sleep(<span class="number">1</span>);</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>; <span class="comment">// return main</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    signal(<span class="number">14</span>, myfun);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"alarm before \n"</span>);</span><br><span class="line">    alarm(<span class="number">9</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"alarm after \n"</span>);</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; <span class="number">20</span>) &#123;</span><br><span class="line">        i++;</span><br><span class="line">        sleep(<span class="number">1</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"process things, i = %d\n"</span>, i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><code>signal(14, myfun);</code></strong> è¡¨ç¤ºæ¥æ”¶åˆ° 14 å·ä¿¡å·ï¼Œè¿›è¡Œè‡ªå®šä¹‰çš„ä¸€äº›å¤„ç†ï¼ˆ<strong>14å·ä¿¡å· --&gt; alarm</strong>ï¼‰</p><p>ç¨‹åºè¿è¡Œï¼Œ9ç§’åå‘é€ <strong><code>alarm</code></strong> ä¿¡å·ï¼ŒæœŸé—´è¿›ç¨‹ä¸€ç›´è¿è¡Œ</p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/signal_01.png" style="zoom:80%"><p>æ¥æ”¶åˆ° <strong><code>alarm</code></strong> ä¿¡å·åï¼Œå¤„ç† <strong><code>myfun</code></strong></p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/signal_02.png" style="zoom:80%"><p>å¤„ç† <strong><code>myfun</code></strong> ç»“æŸåï¼Œé‡æ–°å›åˆ° <strong><code>main</code></strong> ä¸­ç»§ç»­è¿›è¡Œå‰©ä¸‹çš„æ“ä½œ</p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/signal_03.png" style="zoom:80%"><h5 id="4-3-2-SIG-IGN-SIG-DFL"><a class="header-anchor" href="#4-3-2-SIG-IGN-SIG-DFL">Â¶</a>4.3.2 <code>SIG_IGN</code> , <code>SIG_DFL</code></h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/types.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"signal.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"unistd.h"</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">myfun</span><span class="params">(<span class="keyword">int</span> signum)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; <span class="number">10</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"process signal signum = %d"</span>, signum);</span><br><span class="line">        sleep(<span class="number">1</span>);</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>; <span class="comment">// return main</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    signal(<span class="number">14</span>, myfun);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"alarm before \n"</span>);</span><br><span class="line">    alarm(<span class="number">9</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"alarm after \n"</span>);</span><br><span class="line">    signal(<span class="number">14</span>, SIG_IGN);  <span class="comment">// åˆä¸€æ¬¡æ¥æ”¶åˆ°ä¿¡å·ï¼Œå¿½ç•¥å®ƒï¼Œä¸ä¼šå¤„ç†myfunï¼Œä¹Ÿä¸ä¼šç»ˆæ­¢è¿è¡Œ</span></span><br><span class="line">    <span class="comment">// signal(14, SIG_DFL);  // é»˜è®¤å¤„ç†ï¼Œ9ç§’åç»ˆæ­¢</span></span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; <span class="number">20</span>) &#123;</span><br><span class="line">        i++;</span><br><span class="line">        sleep(<span class="number">1</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"process things, i = %d"</span>, i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><code>SIG_IGN</code></strong> , <strong><code>SIG_DFL</code></strong><br><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/signal_04.png" style="zoom:67%"><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/signal_05.png" style="zoom:80%"></p><h4 id="4-4-signal-å¤„ç†è¿›ç¨‹é—´é€šä¿¡"><a class="header-anchor" href="#4-4-signal-å¤„ç†è¿›ç¨‹é—´é€šä¿¡">Â¶</a>4.4 signal å¤„ç†è¿›ç¨‹é—´é€šä¿¡</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/types.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"signal.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"unistd.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">myfun</span><span class="params">(<span class="keyword">int</span> signum)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; <span class="number">5</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"receive signum = %d, i = %d\n"</span>, signum, i);</span><br><span class="line">        sleep(<span class="number">1</span>);</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">pid_t</span> pid;</span><br><span class="line">    pid = fork();</span><br><span class="line">    <span class="keyword">if</span> (pid &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        signal(<span class="number">10</span>, myfun);</span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"parent process things, i = %d\n"</span>, i);</span><br><span class="line">            sleep(i);</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (pid == <span class="number">0</span>) &#123;</span><br><span class="line">    	sleep(<span class="number">10</span>);</span><br><span class="line">        kill(getppid(), <span class="number">10</span>);    <span class="comment">// SIGUSER1  10 ä¿¡å·</span></span><br><span class="line">        sleep(<span class="number">10</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çˆ¶è¿›ç¨‹æ­»å¾ªç¯æ‰“å°è¾“å‡ºï¼Œå­è¿›ç¨‹ç¡çœ  10 s åå‘é€ 10 å· <strong><code>SIGUSER1</code></strong> ä¿¡å·ï¼Œçˆ¶è¿›ç¨‹æ¥æ”¶åˆ°ä¿¡å·å°±ä¼šè·³å…¥å¤„ç†è‡ªå®šä¹‰å‡½æ•° <strong><code>myfun</code></strong> ï¼Œå¤„ç†ç»“æŸååŸºäºæ­»å¾ªç¯æ‰“å°è¾“å‡ºã€‚ç»“æœå¦‚ä¸‹ï¼š</p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/signal_06.png" style="zoom:67%"><p>æ­¤æ—¶è¿›ç¨‹çŠ¶æ€å¦‚ä¸‹ï¼Œçˆ¶è¿›ç¨‹è¿è¡ŒçŠ¶æ€( <strong><code>R</code></strong> )ï¼Œå­è¿›ç¨‹åƒµå°¸çŠ¶æ€ ( <strong><code>Z</code></strong> ) ï¼Œéœ€è¦çˆ¶è¿›ç¨‹è¿›è¡Œèµ„æºå›æ”¶å¤„ç†ã€‚</p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/signal_07.png" style="zoom:80%"><p>å› ä¸º <strong><code>wait()</code></strong> æ“ä½œä¸ºé˜»å¡æ“ä½œï¼Œä¸èƒ½ç›´æ¥æ”¾åœ¨å¤„ç†å‡½æ•°ä¹‹ä¸Šï¼Œè¿™ä¼šå¯¼è‡´å¤„ç†å‡½æ•°ä¸ä¼šè¿›è¡Œä¸‹å»ã€‚</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (pid &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        signal(<span class="number">10</span>, myfun);</span><br><span class="line">    	wait(<span class="literal">NULL</span>); <span class="comment">// æ”¾åœ¨è¿™é‡Œä¼šé˜»å¡åç»­å¤„ç†ã€‚</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"parent process things, i = %d\n"</span>, i);</span><br><span class="line">            sleep(i);</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ç”±ç»“æœå¯ä»¥çŸ¥é“ï¼Œçˆ¶è¿›ç¨‹å¼€å§‹ä¼šå¤„äº <strong><font color="FF000">é˜»å¡çŠ¶æ€</font></strong> ï¼Œåªæœ‰æ¥æ”¶ 10 å·ä¿¡å·åæ‰ä¼šå¤„ç† <strong><code>myfun</code></strong> ï¼Œä¹‹å**<font color="FF000">ç­‰å­è¿›ç¨‹é€€å‡º</font>**ï¼Œä¹‹åæ‰ä¼šå¤„ç† <strong><code>printf</code></strong> æ“ä½œ</p><p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/signal_08.png" alt></p><p>å› ä¸º <strong><code>exit(0)</code></strong> å‘é€äº† <strong><code>kill SIGCHLD</code></strong> ä¿¡å·ï¼Œ<strong>17 å·ä¿¡å·</strong>ï¼Œæ‰€ä»¥çˆ¶è¿›ç¨‹å¯ä»¥æ¥æ”¶ 17 ä¿¡å·åå¤„ç† <strong><code>wait</code></strong> å³å¯</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">myfun1</span><span class="params">(<span class="keyword">int</span> signum)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"receive signum = %d\n"</span>,signum);</span><br><span class="line">    wait(<span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (pid &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        signal(<span class="number">10</span>, mufun);</span><br><span class="line">    	signal(<span class="number">17</span>, myfun1);</span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"parent process things, i = %d\n"</span>, i);</span><br><span class="line">            sleep(i);</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„è¯ï¼Œåœ¨å­è¿›ç¨‹ç»“æŸä¹‹åï¼Œå°±ä¸ä¼šäº§ç”Ÿåƒµå°¸è¿›ç¨‹</p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/signal_09.png" style="zoom:80%"> <img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/signal_10.png" style="zoom:80%"><h3 id="äº”ã€IPC-é€šä¿¡"><a class="header-anchor" href="#äº”ã€IPC-é€šä¿¡">Â¶</a>äº”ã€IPC é€šä¿¡</h3><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/IPCå¯¹è±¡.png" style="zoom:50%"> <img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/IPCä¸IOå¯¹æ¯”.png" style="zoom:67%"><p>å¸¸ç”¨çš„ IPC ç›¸å…³çš„ <strong><code>shell</code></strong> å‘½ä»¤</p><p>æŸ¥çœ‹ IPC å¯¹è±¡ ï¼š <strong><code>ipcs</code> <code>-m</code></strong> (å…±äº«å†…å­˜) <strong><code>-q</code></strong> (æ¶ˆæ¯é˜Ÿåˆ—) <strong><code>-s</code></strong> (ä¿¡å·ç¯)</p><p>åˆ é™¤ IPC å¯¹è±¡ï¼š<strong><code>ipcrm</code> <code>-m</code></strong> (å…±äº«å†…å­˜) \ <strong><code>-q</code></strong> (æ¶ˆæ¯é˜Ÿåˆ—) \ <strong><code>-s</code></strong> (ä¿¡å·ç¯) <strong><code>id</code></strong></p><p>è¿”å›å€¼ï¼š<strong>å…±äº«å†…å­˜</strong>ï¼Œ<strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼Œ<strong>ä¿¡å·ç¯</strong>æ ‡è¯†ç¬¦ï¼ŒIPC çš„ ID å·</p><p>æ¯æ¬¡ç”¨ <strong><code>IPC_PRIVATE</code></strong> æ“ä½œæ—¶ï¼Œ <strong><code>key</code></strong> éƒ½æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯ 0</p><h3 id="å…­ã€å…±äº«å†…å­˜"><a class="header-anchor" href="#å…­ã€å…±äº«å†…å­˜">Â¶</a>å…­ã€å…±äº«å†…å­˜</h3><h4 id="6-1-åˆ›å»ºå’Œæ‰“å¼€å…±äº«å†…å­˜"><a class="header-anchor" href="#6-1-åˆ›å»ºå’Œæ‰“å¼€å…±äº«å†…å­˜">Â¶</a>6.1 åˆ›å»ºå’Œæ‰“å¼€å…±äº«å†…å­˜</h4><p><strong><code>shmget</code></strong> å‡½æ•°</p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/shmgetå‡½æ•°.png" style="zoom:67%"> å‡ºé”™ï¼šè¿”å› - 1<p><strong><code>shmget.c</code></strong></p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/types.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/shm.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"signal.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"unistd.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> shmid;</span><br><span class="line">    shmid = shmget(IPC_PRIVATE, <span class="number">128</span>, <span class="number">0777</span>);</span><br><span class="line">    <span class="keyword">if</span> (shmid &lt; <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"create share memory failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"creat share memory success shmid = %d\n"</span>, shmid);</span><br><span class="line">    system(<span class="string">"ipcs -m"</span>);</span><br><span class="line">    <span class="comment">// system("ipcrm -m shmid");</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¯æ¬¡è¿è¡Œä¸€æ¬¡ï¼Œåˆ›å»ºä¸€ä¸ªå…±äº«å†…å­˜ï¼Œä¸‹å›¾è¿è¡Œä¸‰æ¬¡åã€‚</p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/shmget_01.png" style="zoom:80%"><p>ä½¿ç”¨ <strong><code>ipcrm -m id</code></strong> åˆ é™¤åä¸¤ä¸ªå…±äº«å†…å­˜</p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/shmget_02.png" style="zoom:80%"><h4 id="6-2-ftok-å‡½æ•°ï¼Œåˆ›å»º-key-å€¼"><a class="header-anchor" href="#6-2-ftok-å‡½æ•°ï¼Œåˆ›å»º-key-å€¼">Â¶</a>6.2 ftok å‡½æ•°ï¼Œåˆ›å»º key å€¼</h4><p><strong><code>char ftok(const char* path, char key)</code></strong></p><ul><li><p><strong>å‚æ•°</strong>ï¼šç¬¬ä¸€ä¸ªå‚æ•°ï¼šæ–‡ä»¶è·¯å¾„å’Œæ–‡ä»¶åï¼›ç¬¬äºŒä¸ªå‚æ•°ï¼šä¸€ä¸ªå­—ç¬¦</p></li><li><p><strong>è¿”å›å€¼</strong>ï¼šæ­£ç¡®è¿”å›ä¸€ä¸ª key å€¼ï¼Œå‡ºé”™è¿”å› -1</p></li></ul><p><strong><code>IPC_PRIVATE</code></strong> æ“ä½œæ—¶ï¼Œå…±äº«å†…å­˜çš„ key å€¼éƒ½æ˜¯ä¸€æ ·ï¼Œéƒ½æ˜¯ <strong>0</strong>ï¼Œ æ‰€ä»¥å¯¹äºéäº²ç¼˜å…³ç³»è¿›ç¨‹ä½¿ç”¨ <strong><code>ftok</code></strong> æ¥åˆ›å»º key å€¼ã€‚åªè¦ key å€¼æ˜¯ä¸€æ ·çš„ï¼Œç”¨æˆ·ç©ºé—´çš„è¿›ç¨‹é€šè¿‡è¿™ä¸ªå‡½æ•°æ‰“å¼€ï¼Œåˆ™ä¼šå¯¹å†…æ ¸çš„åŒä¸€ä¸ª IPC å¯¹è±¡æ“ä½œã€‚</p><p><strong><code>shmget.c</code></strong></p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/types.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/shm.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"signal.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"unistd.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> shmid;</span><br><span class="line">    <span class="keyword">int</span> key;</span><br><span class="line">    key = ftok(<span class="string">"./a.c"</span>, <span class="string">'a'</span>);</span><br><span class="line">    <span class="keyword">if</span> (key &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"create key failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"create key success, key = %X\n"</span>, key);</span><br><span class="line">    shmid = shmget(key, <span class="number">128</span>, IPC_CREAT | <span class="number">0777</span>);  <span class="comment">// éœ€è¦åœ¨æƒé™å¤„åŠ ä¸Šå® TPC_CREAT</span></span><br><span class="line">    <span class="comment">// shmid = shmget(IPC_PRIVATE, 128, 0777); å¯¹æ¯”</span></span><br><span class="line">    <span class="keyword">if</span> (shmid &lt; <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"create share memory failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"creat share memory success shmid = %d\n"</span>, shmid);</span><br><span class="line">    system(<span class="string">"ipcs -m"</span>);</span><br><span class="line">    <span class="comment">// system("ipcrm -m shmid");</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹ï¼šä¹‹å‰ç”¨ <strong><code>IPC_PRIVATE</code></strong> åˆ›å»ºçš„ key = 0ï¼Œç°åœ¨ç”¨è‡ªå®šä¹‰çš„ key</p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/shmget_03.png" style="zoom:80%"><h4 id="6-3-å°†å…±äº«å†…å­˜æ˜ å°„åˆ°ç”¨æˆ·ç©ºé—´ä¸­"><a class="header-anchor" href="#6-3-å°†å…±äº«å†…å­˜æ˜ å°„åˆ°ç”¨æˆ·ç©ºé—´ä¸­">Â¶</a>6.3 å°†å…±äº«å†…å­˜æ˜ å°„åˆ°ç”¨æˆ·ç©ºé—´ä¸­</h4><p>ä¸ºäº†æ–¹ä¾¿ç”¨æˆ·ç©ºé—´å¯¹å…±äº«å†…å­˜çš„æ“ä½œï¼Œä½¿ç”¨åœ°å€æ˜ å°„çš„æ–¹å¼ã€‚åˆ©ç”¨ <strong><code>shmat</code></strong> å‡½æ•°ã€‚</p><p><strong><code>void *shmat (int shmid, const void * shmaddr, int shmflg);</code></strong></p><p><strong>å‚æ•°</strong>ï¼š</p><ul><li><p>ç¬¬ä¸€ä¸ªå‚æ•°ï¼šIDå·ï¼›</p></li><li><p>ç¬¬äºŒä¸ªå‚æ•°ï¼šæ˜ å°„åˆ°çš„åœ°å€ï¼Œ<strong>NULL</strong> ä¸ºç³»ç»Ÿè‡ªåŠ¨å®Œæˆçš„æ˜ å°„ï¼›</p></li><li><p>ç¬¬ä¸‰ä¸ªå‚æ•°ï¼š<code>shmflg</code></p><ul><li>**<code>SHM_RDONLY</code>**å…±äº«å†…å­˜åªè¯»</li><li>é»˜è®¤ 0ï¼Œè¡¨ç¤ºå…±äº«å†…å­˜å¯è¯»å†™</li></ul></li></ul><p>è¿”å›å€¼ï¼š æˆåŠŸï¼šæ˜ å°„åçš„åœ°å€ï¼›å¤±è´¥ï¼š<strong>NULL</strong></p><p><strong><code>shmat.c</code></strong></p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/types.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/shm.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"signal.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"unistd.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> shmid;</span><br><span class="line">    <span class="keyword">int</span> key;</span><br><span class="line">    <span class="keyword">char</span> *p;</span><br><span class="line">    key = ftok(<span class="string">"./a.c"</span>, <span class="string">'a'</span>);</span><br><span class="line">    <span class="keyword">if</span> (key &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"create key failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"create key success, key = %X\n"</span>, key);</span><br><span class="line">    shmid = shmget(key, <span class="number">128</span>, IPC_CREAT | <span class="number">0777</span>); </span><br><span class="line">    <span class="comment">// shmid = shmget(IPC_PRIVATE, 128, 0777); å¯¹æ¯”</span></span><br><span class="line">    <span class="keyword">if</span> (shmid &lt; <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"create share memory failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"creat share memory success shmid = %d\n"</span>, shmid);</span><br><span class="line">    system(<span class="string">"ipcs -m"</span>);</span><br><span class="line">    </span><br><span class="line">    p = (<span class="keyword">char</span> *)shmat(shmid, <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (p == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"shmat function failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// write share memory</span></span><br><span class="line">    <span class="comment">// stdin:é”®ç›˜è¾“å…¥ï¼Œ128å­—èŠ‚ï¼Œå†™å…¥ p ä¸­</span></span><br><span class="line">    fgets(p, <span class="number">128</span>, <span class="built_in">stdin</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// start read share memory</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"share memory data: %s\n"</span>, p);</span><br><span class="line">    <span class="comment">// printf("share memory data: %s\n", p);</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¨‹åºè¿è¡Œåï¼Œé”®ç›˜è¾“å…¥: test è¿›å…±äº«å†…å­˜ï¼Œåè¯»æ•°æ®è¾“å‡º</p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/shmat01.png" style="zoom:80%"><p><strong>ä¸ç®¡é“ä¸åŒ</strong>ï¼Œå…±äº«å†…å­˜ä¸­çš„æ•°æ®åœ¨è¯»å–å<strong>å¹¶æ²¡æœ‰è¢«åˆ é™¤</strong>ï¼Œä¸¤æ¡è¾“å‡ºè¯­å¥çš„ç»“æœå¦‚ä¸‹ï¼š</p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/shmat02.png" style="zoom:80%"><p><strong>å…±äº«å†…å­˜ç‰¹ç‚¹ï¼š</strong></p><ul><li>å…±äº«å†…å­˜åˆ›å»ºåï¼Œä¸€ç›´å­˜åœ¨äºå†…æ ¸ä¸­ï¼ŒçŸ¥é“è¢«åˆ é™¤æˆ–ç³»ç»Ÿå…³é—­ï¼›</li><li>å…±äº«å†…å­˜å’Œç®¡é“ä¸ä¸€æ ·ï¼Œè¯»å–åï¼Œå†…å®¹ä»åœ¨å…¶å…±äº«å†…å­˜ä¸­ã€‚</li></ul><h4 id="6-4-åˆ é™¤è¿›ç¨‹é‡Œçš„åœ°å€æ˜ å°„"><a class="header-anchor" href="#6-4-åˆ é™¤è¿›ç¨‹é‡Œçš„åœ°å€æ˜ å°„">Â¶</a>6.4 åˆ é™¤è¿›ç¨‹é‡Œçš„åœ°å€æ˜ å°„</h4><p>ä½¿ç”¨ <strong><code>shmdt</code></strong> å‡½æ•°ï¼Œåˆ é™¤ç”¨æˆ·ç©ºé—´çš„åœ°å€æ˜ å°„</p><p><strong><code>int shmdt(const void* shmaddr);</code></strong></p><p><strong>å‚æ•°</strong>ï¼š<strong><code>shmaddr</code></strong> ï¼šå…±äº«å†…å­˜æ˜ å°„åçš„åœ°å€ï¼ˆç”¨æˆ·ç©ºé—´ï¼‰</p><p><strong>è¿”å›å€¼</strong>ï¼šæˆåŠŸï¼š0ï¼› å¤±è´¥ï¼š -1</p><p><strong><code>shmdt.c</code></strong></p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/types.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/shm.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"signal.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"unistd.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"string.h"</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> shmid;</span><br><span class="line">    <span class="keyword">int</span> key;</span><br><span class="line">    <span class="keyword">char</span> *p;</span><br><span class="line">    key = ftok(<span class="string">"./a.c"</span>, <span class="string">'a'</span>);</span><br><span class="line">    <span class="keyword">if</span> (key &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"create key failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"create key success, key = %X\n"</span>, key);</span><br><span class="line">    shmid = shmget(key, <span class="number">128</span>, IPC_CREAT | <span class="number">0777</span>); </span><br><span class="line">    <span class="comment">// shmid = shmget(IPC_PRIVATE, 128, 0777); å¯¹æ¯”</span></span><br><span class="line">    <span class="keyword">if</span> (shmid &lt; <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"create share memory failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"creat share memory success shmid = %d\n"</span>, shmid);</span><br><span class="line">    system(<span class="string">"ipcs -m"</span>);</span><br><span class="line">    </span><br><span class="line">    p = (<span class="keyword">char</span> *)shmat(shmid, <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (p == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"shmat function failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// write share memory</span></span><br><span class="line">    <span class="comment">// stdin:é”®ç›˜è¾“å…¥ï¼Œ128å­—èŠ‚ï¼Œå†™å…¥ p ä¸­</span></span><br><span class="line">    fgets(p, <span class="number">128</span>, <span class="built_in">stdin</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// start read share memory</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"share memory data: %s\n"</span>, p);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"share memory data: %s\n"</span>, p);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é‡Šæ”¾ç”¨æˆ·ç©ºé—´å…±äº«å†…å­˜</span></span><br><span class="line">    shmdt(p);</span><br><span class="line">    <span class="built_in">memcpy</span>(p, <span class="string">"abcd"</span>, <span class="number">4</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…±äº«å†…å­˜é‡Šæ”¾åï¼Œä¸èƒ½å†æ¬¡ä½¿ç”¨å®ƒï¼Œæ‰€ä»¥ <strong><code>memcpy</code></strong> å‡½æ•°æ“ä½œä¼šå‡ºç°æ®µé”™è¯¯ã€‚</p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/shmdt_01.png" style="zoom:80%"><h4 id="6-5-shmctlï¼šåˆ é™¤å…±äº«å†…å­˜å¯¹è±¡"><a class="header-anchor" href="#6-5-shmctlï¼šåˆ é™¤å…±äº«å†…å­˜å¯¹è±¡">Â¶</a>6.5 shmctlï¼šåˆ é™¤å…±äº«å†…å­˜å¯¹è±¡</h4><p><strong><code>int shmctl(int shmid, int cmd, struct shmid_ds *buf)</code></strong></p><p><strong>å‚æ•°</strong>ï¼š</p><ul><li><p><strong><code>shmid</code></strong> ï¼šè¦æ“ä½œçš„å…±äº«å†…å­˜æ ‡è¯†ç¬¦</p></li><li><p><strong><code>cmd</code></strong> ï¼š</p><ul><li><strong><code>IPC_STAT</code></strong> (è·å–å¯¹è±¡å±æ€§) â€“ å®ç°äº† <strong><code>ipcs - m</code></strong></li><li><strong><code>IPC_SET</code></strong> ï¼ˆè®¾ç½®å¯¹è±¡å±æ€§ï¼‰</li><li><strong><code>IPC_RMID</code></strong> (åˆ é™¤å¯¹è±¡) â€“ å®ç°äº† <strong><code>ipcrm -m id</code></strong></li></ul></li><li><p><strong><code>buf</code></strong> : æŒ‡å®š <strong><code>IPC_STAT/IPC_SET</code></strong> æ—¶å¯ä»¥ä¿å­˜ / è®¾ç½®å±æ€§ã€‚</p></li></ul><p><strong>è¿”å›å€¼</strong>ï¼šæˆåŠŸï¼š0ï¼› å¤±è´¥ï¼š-1ï¼›</p><p><strong><code>shmctl.c</code></strong></p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/types.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/shm.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"signal.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"unistd.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"string.h"</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> shmid;</span><br><span class="line">    <span class="keyword">int</span> key;</span><br><span class="line">    <span class="keyword">char</span> *p;</span><br><span class="line">    key = ftok(<span class="string">"./a.c"</span>, <span class="string">'a'</span>);</span><br><span class="line">    <span class="keyword">if</span> (key &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"create key failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"create key success, key = %X\n"</span>, key);</span><br><span class="line">    shmid = shmget(key, <span class="number">128</span>, IPC_CREAT | <span class="number">0777</span>); </span><br><span class="line">    <span class="comment">// shmid = shmget(IPC_PRIVATE, 128, 0777); å¯¹æ¯”</span></span><br><span class="line">    <span class="keyword">if</span> (shmid &lt; <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"create share memory failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"creat share memory success shmid = %d\n"</span>, shmid);</span><br><span class="line">    system(<span class="string">"ipcs -m"</span>);</span><br><span class="line">    </span><br><span class="line">    p = (<span class="keyword">char</span> *)shmat(shmid, <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (p == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"shmat function failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// write share memory</span></span><br><span class="line">    <span class="comment">// stdin:é”®ç›˜è¾“å…¥ï¼Œ128å­—èŠ‚ï¼Œå†™å…¥ p ä¸­</span></span><br><span class="line">    fgets(p, <span class="number">128</span>, <span class="built_in">stdin</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// start read share memory</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"share memory data: %s\n"</span>, p);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"share memory data: %s\n"</span>, p);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é‡Šæ”¾ç”¨æˆ·ç©ºé—´å…±äº«å†…å­˜</span></span><br><span class="line">    shmdt(p);</span><br><span class="line">    <span class="built_in">memcpy</span>(p, <span class="string">"abcd"</span>, <span class="number">4</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ é™¤å…±äº«å†…å­˜å¯¹è±¡</span></span><br><span class="line">    shmctl(shmid, IPC_RMID, <span class="literal">NULL</span>);</span><br><span class="line">    </span><br><span class="line">    system(<span class="string">"ipcs -m"</span>);<span class="comment">// æŸ¥çœ‹å…±äº«å†…å­˜è¿˜åœ¨ä¸åœ¨</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç¨‹åºï¼Œé”®ç›˜è¾“å…¥ test ï¼Œç»“æœæ‰“å°ä¸¤éååˆ é™¤å…±äº«å†…å­˜å¯¹è±¡ï¼Œå‘ç° <strong><code>shmid = 3</code></strong> çš„å…±äº«å†…å­˜è¢«åˆ é™¤ã€‚</p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/shmctl_01.png" style="zoom:80%"><p><strong><code>myipcrm.c</code></strong></p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/types.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/shm.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"signal.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"unistd.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"string.h"</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> shmid;</span><br><span class="line">    <span class="keyword">if</span> (argc &lt; <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"please input param\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">"-m"</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"delete share memory\n"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    shmid = atoi(argv[<span class="number">2</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"shmid = %d\n"</span>, shmid);</span><br><span class="line">    shmctl(shmid, IPC_RMID, <span class="literal">NULL</span>);</span><br><span class="line">    system(<span class="string">"ipcs -m"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡ªå·±åˆ›å»ºçš„ <strong><code>ipcrm -m id</code></strong> æ“ä½œï¼ŒæˆåŠŸçš„åˆ é™¤äº† <strong><code>shmid = 0</code></strong> çš„å…±äº«å†…å­˜</p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/shmctl_02.png" style="zoom:80%"><h4 id="6-6-æœ‰äº²ç¼˜å…³ç³»çš„è¿›ç¨‹ï¼ˆIPC-PRIVATEï¼‰"><a class="header-anchor" href="#6-6-æœ‰äº²ç¼˜å…³ç³»çš„è¿›ç¨‹ï¼ˆIPC-PRIVATEï¼‰">Â¶</a>6.6 æœ‰äº²ç¼˜å…³ç³»çš„è¿›ç¨‹ï¼ˆIPC_PRIVATEï¼‰</h4><p><strong><code>shmctl_2.c</code></strong></p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/types.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/shm.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"signal.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"unistd.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"string.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¿¡å·å¤„ç†å‡½æ•°ï¼Œä¸éœ€è¦ä»»ä½•å¤„ç†ï¼Œä¸»è¦ä¸ºäº†å”¤é†’ pause å‡½æ•°ï¼Œä¸”é¿å… sigusr1/2ç»ˆæ­¢å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">myfun</span><span class="params">(<span class="keyword">int</span> signum)</span> </span>&#123;<span class="keyword">return</span>;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> shmid;</span><br><span class="line">    <span class="keyword">int</span> key;</span><br><span class="line">    <span class="keyword">char</span>* p;</span><br><span class="line">    <span class="keyword">int</span> pid;</span><br><span class="line">    shmid = shmget(IPC_PRIVATE, <span class="number">128</span>, IPC_CREAT | <span class="number">0777</span>);</span><br><span class="line">    <span class="keyword">if</span> (shmid &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"creat share memory failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"creat memory success shmid = %d\n"</span>, shmid);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// shmget åœ¨ fork ä¹‹å‰</span></span><br><span class="line">    pid = fork();</span><br><span class="line">    <span class="keyword">if</span> (pid &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        signal(SIGUSR2, myfun);</span><br><span class="line">        p = (<span class="keyword">char</span> *)shmat(shmid, <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (p == <span class="literal">NULL</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"shmat function failure\n"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// write share memory</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"parent process start write share memory: \n"</span>);</span><br><span class="line">            fgets(p, <span class="number">128</span>, <span class="built_in">stdin</span>);</span><br><span class="line">            kill(pid, SIGUSR1); <span class="comment">// é€šçŸ¥å­è¿›ç¨‹å»è¯»</span></span><br><span class="line">            pause(); <span class="comment">// ç­‰å¾…å­è¿›ç¨‹å»è¯»</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (pid == <span class="number">0</span>) &#123;</span><br><span class="line">        signal(SIGUSR1, myfun);</span><br><span class="line">        p = (<span class="keyword">char</span> *) shmat(shmid, <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (p == <span class="literal">NULL</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"shmat function failure\n"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-3</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">            pause(); <span class="comment">// ç­‰å¾…çˆ¶è¿›ç¨‹å»å†™</span></span><br><span class="line">        	<span class="built_in">printf</span>(<span class="string">"share memory data: %s\n"</span>, p);</span><br><span class="line">            kill(getppid(), SIGUSR2);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¨‹åºè¿è¡Œï¼Œçˆ¶è¿›ç¨‹å†™ï¼Œå­è¿›ç¨‹è¯»å–ï¼Œä¸¤ä¸ªè¿›ç¨‹çŠ¶æ€éƒ½æ˜¯ç¡çœ çŠ¶æ€ ï¼ˆ<strong><code>S</code></strong>ï¼‰</p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/shmctl_03.png" style="zoom:80%"> <img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/shmctl_04.png" style="zoom:80%"><h4 id="6-7-æ— äº²ç¼˜å…³ç³»çš„è¿›ç¨‹ï¼ˆkeyï¼‰"><a class="header-anchor" href="#6-7-æ— äº²ç¼˜å…³ç³»çš„è¿›ç¨‹ï¼ˆkeyï¼‰">Â¶</a>6.7 æ— äº²ç¼˜å…³ç³»çš„è¿›ç¨‹ï¼ˆkeyï¼‰</h4><p><strong><code>server.c</code></strong></p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/types.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/shm.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"signal.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"unistd.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"string.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">mybuf</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> pid;</span><br><span class="line">    <span class="keyword">char</span> buf[<span class="number">124</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¿¡å·å¤„ç†å‡½æ•°ï¼Œä¸éœ€è¦ä»»ä½•å¤„ç†ï¼Œä¸»è¦ä¸ºäº†å”¤é†’ pause å‡½æ•°ï¼Œä¸”é¿å… sigusr1/2ç»ˆæ­¢å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">myfun</span><span class="params">(<span class="keyword">int</span> signum)</span> </span>&#123;<span class="keyword">return</span>;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> shmid;</span><br><span class="line">    <span class="keyword">int</span> key;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">mybuf</span>* <span class="title">p</span>;</span></span><br><span class="line">    <span class="keyword">int</span> pid;</span><br><span class="line">    <span class="comment">// åˆ›å»º key</span></span><br><span class="line">    key = ftok(<span class="string">"./a.c"</span>,<span class="string">'c'</span>);</span><br><span class="line">    <span class="keyword">if</span> (key &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"create key failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"create key success, key = %X\n"</span>, key);</span><br><span class="line">    <span class="comment">// åˆ›å»º share memory</span></span><br><span class="line">    shmid = shmget(key, <span class="number">128</span>, IPC_CREAT | <span class="number">0777</span>);</span><br><span class="line">    <span class="keyword">if</span> (shmid &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"creat share memory failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"creat memory success shmid = %d\n"</span>, shmid);</span><br><span class="line">	<span class="comment">// ä¿¡å·å¤„ç†</span></span><br><span class="line">    signal(SIGUSR2, myfun);</span><br><span class="line">    <span class="comment">// åœ°å€æ˜ å°„</span></span><br><span class="line">    p = (struct mybuf*)shmat(shmid, <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (p == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"shmat function failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// get client pid</span></span><br><span class="line">    p-&gt;pid = getpid(); <span class="comment">// write server pid to share memory</span></span><br><span class="line">    pause(); <span class="comment">//wait client read server pid;</span></span><br><span class="line">    pid = p-&gt;pid;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// write share memory</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">" process start write share memory: \n"</span>);</span><br><span class="line">        fgets(p-&gt;buf, <span class="number">128</span>, <span class="built_in">stdin</span>);</span><br><span class="line">        kill(pid, SIGUSR1); <span class="comment">// é€šçŸ¥clientè¿›ç¨‹å»è¯»</span></span><br><span class="line">        pause(); <span class="comment">// ç­‰å¾…client è¿›ç¨‹å»è¯»</span></span><br><span class="line">    &#125;    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><code>client.c</code></strong></p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/types.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/shm.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"signal.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"unistd.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"string.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">mybuf</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> pid;</span><br><span class="line">    <span class="keyword">char</span> buf[<span class="number">124</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¿¡å·å¤„ç†å‡½æ•°ï¼Œä¸éœ€è¦ä»»ä½•å¤„ç†ï¼Œä¸»è¦ä¸ºäº†å”¤é†’ pause å‡½æ•°ï¼Œä¸”é¿å… sigusr1/2ç»ˆæ­¢å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">myfun</span><span class="params">(<span class="keyword">int</span> signum)</span> </span>&#123;<span class="keyword">return</span>;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> shmid;</span><br><span class="line">    <span class="keyword">int</span> key;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">mybuf</span>* <span class="title">p</span>;</span></span><br><span class="line">    <span class="keyword">int</span> pid;</span><br><span class="line">    <span class="comment">// åˆ›å»º key</span></span><br><span class="line">    key = ftok(<span class="string">"./a.c"</span>,<span class="string">'c'</span>);</span><br><span class="line">    <span class="keyword">if</span> (key &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"create key failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"create key success, key = %X\n"</span>, key);</span><br><span class="line">    <span class="comment">// åˆ›å»º share memory</span></span><br><span class="line">    shmid = shmget(key, <span class="number">128</span>, IPC_CREAT | <span class="number">0777</span>);</span><br><span class="line">    <span class="keyword">if</span> (shmid &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"creat share memory failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"creat memory success shmid = %d\n"</span>, shmid);  </span><br><span class="line">    <span class="comment">// ä¿¡å·å¤„ç†</span></span><br><span class="line">    signal(SIGUSR1, myfun);</span><br><span class="line">    <span class="comment">// åœ°å€æ˜ å°„</span></span><br><span class="line">    p = (struct mybuf*)shmat(shmid, <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (p == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"shmat function failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">      </span><br><span class="line">    <span class="comment">// get server pid</span></span><br><span class="line">    <span class="comment">// read share memory</span></span><br><span class="line">    pid = p-&gt;pid;</span><br><span class="line">    <span class="comment">// write client pid to share memory</span></span><br><span class="line">    p-&gt;pid = getpid();</span><br><span class="line">    kill(pid, SIGUSR2);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// client start read data from share memory</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">        pause(); <span class="comment">// wait server write data to share memory;</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"client process receive data from share memory: %s"</span>, p-&gt;buf);</span><br><span class="line">        kill(pid, SIGUSR2); <span class="comment">// server may write share memory</span></span><br><span class="line">    &#125;    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¥ç¨‹åºçš„å…³é”®æ˜¯ï¼šè¦å…ˆé€šè¿‡å…±äº«å†…å­˜äº¤äº’åŒæ–¹çš„ <strong><code>pid</code></strong>;</p><p>è¿è¡ŒæœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯ç¨‹åºï¼Œå¯ä»¥å‘ç°åŒæ–¹éƒ½å¯ä»¥æ“ä½œ <strong><code>shmid = 8</code></strong> çš„å…±äº«å†…å­˜ï¼ŒæœåŠ¡å™¨ç«¯å‘é€å¤šæ¬¡å‘é€æ•°æ®ï¼Œå®¢æˆ·ç«¯å¤šæ¬¡æ¥å—æ•°æ®ï¼›æœåŠ¡å™¨æ¯æ¬¡å‘é€å®Œï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡è¾“å…¥ï¼›å®¢æˆ·ç«¯æ¯æ¬¡æ¥å—ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡æœåŠ¡å™¨çš„æ¶ˆæ¯å‘é€ã€‚</p><p>ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/shm_server.png" alt></p><p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/shm_client.png" alt></p><h3 id="ä¸ƒã€æ¶ˆæ¯é˜Ÿåˆ—"><a class="header-anchor" href="#ä¸ƒã€æ¶ˆæ¯é˜Ÿåˆ—">Â¶</a>ä¸ƒã€æ¶ˆæ¯é˜Ÿåˆ—</h3><p>é“¾å¼é˜Ÿåˆ—</p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/æ¶ˆæ¯é˜Ÿåˆ—æ•°æ®ç»“æ„.png" style="zoom:80%"><p><strong><code>msqid_ds</code></strong> å†…æ ¸ç»´æŠ¤æ¶ˆæ¯é˜Ÿåˆ—çš„ç»“æ„ä½“ï¼Œé˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªæ¶ˆæ¯æŒ‡é’ˆ <strong><code>msg_first</code></strong>ï¼Œæœ€åä¸€ä¸ªæ¶ˆæ¯æŒ‡é’ˆ <strong><code>msg_last</code></strong> ï¼Œæ¶ˆæ¯ä¸­æœ‰ä¸€ä¸ªæˆå‘˜æŒ‡é’ˆ <strong><code>next</code></strong></p><p>æ¯ä¸€ä¸ªæ¶ˆæ¯ä¸­åŒ…å«æœ‰å“ªäº›å†…å®¹ï¼š</p><ul><li>Data ï¼šæ•°æ®</li><li>Lengthï¼šæ•°æ®çš„é•¿åº¦</li><li>Typeï¼šæ•°æ®çš„ç±»å‹</li></ul><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/æ¶ˆæ¯å‡½æ•°.png" style="zoom:80%"><h4 id="7-1-æ¶ˆæ¯é˜Ÿåˆ—çš„åˆ›å»ºå’Œæ‰“å¼€"><a class="header-anchor" href="#7-1-æ¶ˆæ¯é˜Ÿåˆ—çš„åˆ›å»ºå’Œæ‰“å¼€">Â¶</a>7.1 æ¶ˆæ¯é˜Ÿåˆ—çš„åˆ›å»ºå’Œæ‰“å¼€</h4><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/msggetå‡½æ•°.png" style="zoom:80%"><p><strong><code>msgget.c</code></strong></p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/types.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/msg.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"signal.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"unistd.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> msgid;</span><br><span class="line">    msgid = msgget(IPC_PRIVATE,<span class="number">0777</span>);</span><br><span class="line">    <span class="keyword">if</span> (msgid &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"create message queue failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"create message queue success, msgid = %d\n"</span>, msgid);</span><br><span class="line">    system(<span class="string">"ipcs -q"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‰æ¬¡è¿è¡Œç¨‹åºåˆ›å»ºäº†ä¸‰ä¸ªæ¶ˆæ¯é˜Ÿåˆ—</p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/msgget_01.png" style="zoom:80%"><h4 id="7-2-æ¶ˆæ¯é˜Ÿåˆ—æ§åˆ¶"><a class="header-anchor" href="#7-2-æ¶ˆæ¯é˜Ÿåˆ—æ§åˆ¶">Â¶</a>7.2 æ¶ˆæ¯é˜Ÿåˆ—æ§åˆ¶</h4><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/msgctlå‡½æ•°.png" style="zoom:67%"><p><strong><code>msgctl.c</code></strong></p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/types.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/msg.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"signal.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"unistd.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> msgid;</span><br><span class="line">    msgid = msgget(IPC_PRIVATE,<span class="number">0777</span>);</span><br><span class="line">    <span class="keyword">if</span> (msgid &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"create message queue failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"create message queue success, msgid = %d\n"</span>, msgid);</span><br><span class="line">    system(<span class="string">"ipcs -q"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// delete message queue</span></span><br><span class="line">    msgctl(msgid, IPC_RMID, <span class="literal">NULL</span>);</span><br><span class="line">    system(<span class="string">"ipcs -q"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¨‹åºè¿è¡Œï¼Œå…ˆåˆ›å»ºä¸€ä¸ª <strong><code>msgid = 3</code></strong> æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¹‹ååˆ é™¤å®ƒ</p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/msgctl_01.png" style="zoom:80%"><h4 id="7-3-æ¶ˆæ¯å‘é€"><a class="header-anchor" href="#7-3-æ¶ˆæ¯å‘é€">Â¶</a>7.3 æ¶ˆæ¯å‘é€</h4><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/msgsndå‡½æ•°.png" style="zoom:67%"><p><strong><code>msgsnd.c</code></strong></p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/types.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/msg.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"signal.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"unistd.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">msgbuf</span> &#123;</span></span><br><span class="line">    <span class="keyword">long</span> type;</span><br><span class="line">    <span class="keyword">char</span> voltage[<span class="number">124</span>];</span><br><span class="line">    <span class="keyword">char</span> ID[<span class="number">4</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> msgid;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">msgbuf</span> <span class="title">sendbuf</span>;</span></span><br><span class="line">    msgid = msgget(IPC_PRIVATE,<span class="number">0777</span>);</span><br><span class="line">    <span class="keyword">if</span> (msgid &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"create message queue failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"create message queue success, msgid = %d\n"</span>, msgid);</span><br><span class="line">    system(<span class="string">"ipcs -q"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// init sendbuf</span></span><br><span class="line">    sendbuf.type = <span class="number">100</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"please input message:\n"</span>);</span><br><span class="line">    fgets(sendbuf.voltage, <span class="number">124</span>, <span class="built_in">stdin</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// start write message to message queue</span></span><br><span class="line">    msgsnd(msgid, (<span class="keyword">void</span> *)&amp;sendbuf, <span class="built_in">strlen</span>(sendbuf.voltage), <span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// delete message queue</span></span><br><span class="line">    msgctl(msgid, IPC_RMID, <span class="literal">NULL</span>);</span><br><span class="line">    system(<span class="string">"ipcs -q"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="7-4-æ¶ˆæ¯æ¥æ”¶"><a class="header-anchor" href="#7-4-æ¶ˆæ¯æ¥æ”¶">Â¶</a>7.4 æ¶ˆæ¯æ¥æ”¶</h4><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/msgrcvå‡½æ•°.png" style="zoom:67%"><p><strong><code>msgrcv.c</code></strong></p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/types.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/msg.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"signal.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"unistd.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"string.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">msgbuf</span> &#123;</span></span><br><span class="line">    <span class="keyword">long</span> type;</span><br><span class="line">    <span class="keyword">char</span> voltage[<span class="number">124</span>];</span><br><span class="line">    <span class="keyword">char</span> ID[<span class="number">4</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> msgid;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">msgbuf</span> <span class="title">sendbuf</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">msgbuf</span> <span class="title">recvbuf</span>;</span></span><br><span class="line">    <span class="keyword">int</span> readret;</span><br><span class="line">    msgid = msgget(IPC_PRIVATE,<span class="number">0777</span>);</span><br><span class="line">    <span class="keyword">if</span> (msgid &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"create message queue failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"create message queue success, msgid = %d\n"</span>, msgid);</span><br><span class="line">    system(<span class="string">"ipcs -q"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// init sendbuf</span></span><br><span class="line">    sendbuf.type = <span class="number">100</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"please input message:\n"</span>);</span><br><span class="line">    fgets(sendbuf.voltage, <span class="number">124</span>, <span class="built_in">stdin</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// start write message to message queue</span></span><br><span class="line">    msgsnd(msgid, (<span class="keyword">void</span> *)&amp;sendbuf, <span class="built_in">strlen</span>(sendbuf.voltage), <span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// start read message from message queue</span></span><br><span class="line">    <span class="built_in">memset</span>(recvbuf.voltage, <span class="number">0</span>, <span class="number">124</span>);</span><br><span class="line">    readret = msgrcv(msgid, (<span class="keyword">void</span> *)&amp;recvbuf, <span class="number">124</span>, <span class="number">100</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"recv: %s, readret = %d\n"</span>, recvbuf.voltage, readret);</span><br><span class="line">    <span class="comment">// ç¬¬äºŒæ¬¡è¯»</span></span><br><span class="line">    <span class="comment">// msgrcv(msgid, (void *)&amp;recvbuf, 124, 100, 0);</span></span><br><span class="line">    <span class="comment">// printf("recv: %s\n", recvbuf.voltage);</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// delete message queue </span></span><br><span class="line">    msgctl(msgid, IPC_RMID, <span class="literal">NULL</span>);</span><br><span class="line">    system(<span class="string">"ipcs -q"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¨‹åºè¿è¡Œï¼Œé”®ç›˜å†™å…¥æ¶ˆæ¯ï¼Œç„¶ååœ¨è¯»å–æ¶ˆæ¯æ‰“å°è¾“å‡º</p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/msgrcv_01.png" style="zoom:80%"><p>å¦‚æœä¸¤æ¬¡è¯»å–åˆ™ä¼šå‘ç”Ÿé”™è¯¯ï¼Œç¨‹åºæˆ–é˜»å¡ï¼Œå› ä¸ºè¯»å–åæ¶ˆæ¯è¢«åˆ é™¤ï¼Œè¯»å‡½æ•°é˜»å¡ç­‰å¾…</p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/msgrcv_02.png" style="zoom:80%"><h4 id="7-5-å•å‘è¯»å†™æ“ä½œ"><a class="header-anchor" href="#7-5-å•å‘è¯»å†™æ“ä½œ">Â¶</a>7.5 å•å‘è¯»å†™æ“ä½œ</h4><p><strong><code>write.c</code></strong></p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/types.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/msg.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"signal.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"unistd.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"string.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">msgbuf</span> &#123;</span></span><br><span class="line">    <span class="keyword">long</span> type;</span><br><span class="line">    <span class="keyword">char</span> voltage[<span class="number">124</span>];</span><br><span class="line">    <span class="keyword">char</span> ID[<span class="number">4</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> msgid;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">msgbuf</span> <span class="title">sendbuf</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">msgbuf</span> <span class="title">recvbuf</span>;</span></span><br><span class="line">    <span class="keyword">int</span> readret;</span><br><span class="line">    <span class="keyword">int</span> key;</span><br><span class="line">    key = ftok(<span class="string">"./a.c"</span>, <span class="string">'c'</span>);</span><br><span class="line">    <span class="keyword">if</span> (key &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"creat key failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    msgid = msgget(key,IPC_CREAT | <span class="number">0777</span>);</span><br><span class="line">    <span class="keyword">if</span> (msgid &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"create message queue failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"create message queue success, msgid = %d\n"</span>, msgid);</span><br><span class="line">    system(<span class="string">"ipcs -q"</span>);</span><br><span class="line">    </span><br><span class="line">    sendbuf.type = <span class="number">100</span>;</span><br><span class="line">    <span class="comment">// write message queue</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// init sendbuf</span></span><br><span class="line">        <span class="built_in">memset</span>(sendbuf.voltage, <span class="number">0</span>, <span class="number">124</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"please input message:\n"</span>);</span><br><span class="line">        fgets(sendbuf.voltage, <span class="number">124</span>, <span class="built_in">stdin</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// start write message to message queue</span></span><br><span class="line">    	msgsnd(msgid, (<span class="keyword">void</span> *)&amp;sendbuf, <span class="built_in">strlen</span>(sendbuf.voltage), <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// delete message queue </span></span><br><span class="line">    msgctl(msgid, IPC_RMID, <span class="literal">NULL</span>);</span><br><span class="line">    system(<span class="string">"ipcs -q"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><code>read.c</code></strong></p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/types.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/msg.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"signal.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"unistd.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"string.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">msgbuf</span> &#123;</span></span><br><span class="line">    <span class="keyword">long</span> type;</span><br><span class="line">    <span class="keyword">char</span> voltage[<span class="number">124</span>];</span><br><span class="line">    <span class="keyword">char</span> ID[<span class="number">4</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> msgid;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">msgbuf</span> <span class="title">sendbuf</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">msgbuf</span> <span class="title">recvbuf</span>;</span></span><br><span class="line">    <span class="keyword">int</span> readret;</span><br><span class="line">    <span class="keyword">int</span> key;</span><br><span class="line">    key = ftok(<span class="string">"./a.c"</span>, <span class="string">'c'</span>);</span><br><span class="line">    <span class="keyword">if</span> (key &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"creat key failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    msgid = msgget(key,IPC_CREAT | <span class="number">0777</span>);</span><br><span class="line">    <span class="keyword">if</span> (msgid &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"create message queue failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"create message queue success, msgid = %d\n"</span>, msgid);</span><br><span class="line">    system(<span class="string">"ipcs -q"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// read message queue</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// init recvbuf</span></span><br><span class="line">        <span class="built_in">memset</span>(recvbuf.voltage, <span class="number">0</span>, <span class="number">124</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// start read message to message queue</span></span><br><span class="line">    	msgrcv(msgid, (<span class="keyword">void</span> *)&amp;recvbuf, <span class="number">124</span>, <span class="number">100</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"receive data from message queue: %s\n"</span>, recvbuf.voltage);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// delete message queue </span></span><br><span class="line">    msgctl(msgid, IPC_RMID, <span class="literal">NULL</span>);</span><br><span class="line">    system(<span class="string">"ipcs -q"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¨‹åºè¿è¡Œåï¼Œ<strong><code>write.c</code></strong> å†™æ¶ˆæ¯ï¼Œ<strong><code>read.c</code></strong> è¯»æ¶ˆæ¯ (è¯¥ä¾‹å­ä¸ä¸Šä¸€ç« æœ€åä¸€ä¸ªä¾‹å­ç›¸ä¼¼)</p><p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/msgwrite_01.png" alt="msgwrite_01"></p><p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/msgread_01.png" alt></p><h4 id="7-6-åŒå‘é€šä¿¡"><a class="header-anchor" href="#7-6-åŒå‘é€šä¿¡">Â¶</a>7.6 åŒå‘é€šä¿¡</h4><p><strong><code>server.c</code></strong></p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/types.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/msg.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"signal.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"unistd.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"string.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">msgbuf</span> &#123;</span></span><br><span class="line">    <span class="keyword">long</span> type;</span><br><span class="line">    <span class="keyword">char</span> voltage[<span class="number">124</span>];</span><br><span class="line">    <span class="keyword">char</span> ID[<span class="number">4</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> msgid;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">msgbuf</span> <span class="title">sendbuf</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">msgbuf</span> <span class="title">recvbuf</span>;</span></span><br><span class="line">    <span class="keyword">int</span> readret;</span><br><span class="line">    <span class="keyword">int</span> pid;</span><br><span class="line">    <span class="keyword">int</span> key;</span><br><span class="line">    key = ftok(<span class="string">"./b.c"</span>, <span class="string">'c'</span>);</span><br><span class="line">    <span class="keyword">if</span> (key &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"creat key failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    msgid = msgget(key,IPC_CREAT | <span class="number">0777</span>);</span><br><span class="line">    <span class="keyword">if</span> (msgid &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"create message queue failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"create message queue success, msgid = %d\n"</span>, msgid);</span><br><span class="line">    system(<span class="string">"ipcs -q"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åœ¨æ¶ˆæ¯é˜Ÿåˆ—åˆ›å»ºä¹‹åï¼Œä½¿ç”¨ fork å‡½æ•°</span></span><br><span class="line">    pid = fork();</span><br><span class="line">    <span class="comment">// parent process write type:100 Data</span></span><br><span class="line">    <span class="keyword">if</span> (pid &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        sendbuf.type = <span class="number">100</span>;</span><br><span class="line">    	<span class="comment">// write message queue</span></span><br><span class="line">   		<span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        	<span class="comment">// init sendbuf</span></span><br><span class="line">        	<span class="built_in">memset</span>(sendbuf.voltage, <span class="number">0</span>, <span class="number">124</span>);</span><br><span class="line">        </span><br><span class="line">        	<span class="built_in">printf</span>(<span class="string">"please input message:\n"</span>);</span><br><span class="line">        	fgets(sendbuf.voltage, <span class="number">124</span>, <span class="built_in">stdin</span>);</span><br><span class="line">        </span><br><span class="line">        	<span class="comment">// start write message to message queue</span></span><br><span class="line">    		msgsnd(msgid, (<span class="keyword">void</span> *)&amp;sendbuf, <span class="built_in">strlen</span>(sendbuf.voltage), <span class="number">0</span>);</span><br><span class="line">    	&#125;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="comment">// child process read type:200 Data</span></span><br><span class="line">    <span class="keyword">if</span> (pid == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        	<span class="built_in">memset</span>(recvbuf.voltage, <span class="number">0</span>, <span class="number">124</span>);</span><br><span class="line">       	 	msgrcv(msgid, (<span class="keyword">void</span> *)&amp;recvbuf, <span class="number">124</span>, <span class="number">200</span>, <span class="number">0</span>);</span><br><span class="line">        	<span class="built_in">printf</span>(<span class="string">"receive from message queue: %s\n"</span>, recvbuf.voltage); </span><br><span class="line">            <span class="comment">// å¯ä»¥æ‰“å°è¾“å‡ºåï¼Œå½“å‰è¡Œä»ç„¶æç¤ºå¯ä»¥è¾“å…¥æ•°æ®ï¼Œè€Œä¸æ˜¯æ²¡æœ‰æç¤º</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"please input message:\n"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// delete message queue </span></span><br><span class="line">    msgctl(msgid, IPC_RMID, <span class="literal">NULL</span>);</span><br><span class="line">    system(<span class="string">"ipcs -q"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><code>client.c</code></strong></p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/types.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/msg.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"signal.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"unistd.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"string.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">msgbuf</span> &#123;</span></span><br><span class="line">    <span class="keyword">long</span> type;</span><br><span class="line">    <span class="keyword">char</span> voltage[<span class="number">124</span>];</span><br><span class="line">    <span class="keyword">char</span> ID[<span class="number">4</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> msgid;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">msgbuf</span> <span class="title">sendbuf</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">msgbuf</span> <span class="title">recvbuf</span>;</span></span><br><span class="line">    <span class="keyword">int</span> readret;</span><br><span class="line">    <span class="keyword">int</span> pid;</span><br><span class="line">    <span class="keyword">int</span> key;</span><br><span class="line">    key = ftok(<span class="string">"./b.c"</span>, <span class="string">'c'</span>);</span><br><span class="line">    <span class="keyword">if</span> (key &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"creat key failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    msgid = msgget(key,IPC_CREAT | <span class="number">0777</span>);</span><br><span class="line">    <span class="keyword">if</span> (msgid &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"create message queue failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"create message queue success, msgid = %d\n"</span>, msgid);</span><br><span class="line">    system(<span class="string">"ipcs -q"</span>);</span><br><span class="line">       </span><br><span class="line">    <span class="comment">// åœ¨æ¶ˆæ¯é˜Ÿåˆ—åˆ›å»ºä¹‹åï¼Œä½¿ç”¨ fork å‡½æ•°</span></span><br><span class="line">    pid = fork();</span><br><span class="line">    <span class="comment">// parent process read type:100 Data</span></span><br><span class="line">    <span class="keyword">if</span> (pid &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">          	<span class="built_in">memset</span>(recvbuf.voltage, <span class="number">0</span>, <span class="number">124</span>);</span><br><span class="line">        	msgrcv(msgid, (<span class="keyword">void</span> *)&amp;recvbuf, <span class="number">124</span>, <span class="number">100</span>, <span class="number">0</span>);</span><br><span class="line">        	<span class="built_in">printf</span>(<span class="string">"receive data from message queue: %s\n"</span>, recvbuf.voltage); </span><br><span class="line">            <span class="comment">// å¯ä»¥æ‰“å°è¾“å‡ºåï¼Œå½“å‰è¡Œä»ç„¶æç¤ºå¯ä»¥è¾“å…¥æ•°æ®ï¼Œè€Œä¸æ˜¯æ²¡æœ‰æç¤º</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"please input message:\n"</span>);</span><br><span class="line">        &#125;   </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="comment">// child process write type:200 Data</span></span><br><span class="line">    <span class="keyword">if</span> (pid == <span class="number">0</span>) &#123;</span><br><span class="line">        sendbuf.type = <span class="number">200</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="built_in">memset</span>(sendbuf.voltage, <span class="number">0</span>, <span class="number">124</span>);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"please input message:\n"</span>);</span><br><span class="line">            fgets(sendbuf.voltage, <span class="number">124</span>, <span class="built_in">stdin</span>);</span><br><span class="line">            msgsnd(msgid, (<span class="keyword">void</span> *)&amp;sendbuf, <span class="built_in">strlen</span>(sendbuf.voltage), <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// delete message queue </span></span><br><span class="line">    msgctl(msgid, IPC_RMID, <span class="literal">NULL</span>);</span><br><span class="line">    system(<span class="string">"ipcs -q"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç¨‹åºï¼š<strong><code>server</code></strong>ï¼Œ<strong><code>client</code></strong> å¯ä»¥å®ç°åŒæ–¹åŒæ—¶é€šä¿¡ï¼Œçš†å¯ä»¥æ”¶å‘</p><p>æµ‹è¯•å¦‚ä¸‹ï¼ŒåŒæ–¹äº¤æ›¿é€šä¿¡ä¸‰æ¬¡ã€‚</p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/msgserver.png" style="zoom:80%"> <img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/msgclient.png" style="zoom:80%"><h3 id="å…«ã€ä¿¡å·ç¯"><a class="header-anchor" href="#å…«ã€ä¿¡å·ç¯">Â¶</a>å…«ã€ä¿¡å·ç¯</h3><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/ä¿¡å·ç¯ç»“æ„.png" style="zoom:67%"><p>æ‰€æœ‰å‡½æ•°æ˜¯å¯¹ä¸€ä¸ªé›†åˆçš„æ“ä½œï¼š</p><h4 id="8-1-åˆ›å»ºå’Œæ‰“å¼€ä¿¡å·ç¯"><a class="header-anchor" href="#8-1-åˆ›å»ºå’Œæ‰“å¼€ä¿¡å·ç¯">Â¶</a>8.1 åˆ›å»ºå’Œæ‰“å¼€ä¿¡å·ç¯</h4><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/semgetå‡½æ•°.png" style="zoom:67%"><p><strong><code>semget.c</code></strong></p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/types.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/sem.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"signal.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"unistd.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> semid;</span><br><span class="line">    semid = semget(IPC_PRIVATE, <span class="number">3</span>, <span class="number">0777</span>);</span><br><span class="line">    <span class="keyword">if</span> (semid &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"create semaphore failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"create semaphore success, semid = %d\n"</span>, semid);</span><br><span class="line">    system(<span class="string">"ipcs -s"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±å†…æ ¸ç»™æˆ‘ä»¬åˆ›å»ºæ‹¥æœ‰ä¸‰ä¸ªä¿¡å·é‡ï¼Œæƒé™æ˜¯ 777 çš„ä¿¡å·ç¯ï¼Œå› ä¸ºä½¿ç”¨ <strong><code>IPC_PRIVATE</code></strong> keyï¼Œæ‰€ä»¥é”®å€¼æ˜¯ 0</p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/semget_01.png" style="zoom:80%"><h4 id="8-2-ä¿¡å·ç¯çš„æ§åˆ¶"><a class="header-anchor" href="#8-2-ä¿¡å·ç¯çš„æ§åˆ¶">Â¶</a>8.2 ä¿¡å·ç¯çš„æ§åˆ¶</h4><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/semctlå‡½æ•°.png" style="zoom:67%"> <img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/semctl_setval.png" style="zoom:67%"><p><strong><code>semctl.c</code></strong></p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/types.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/sem.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"signal.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"unistd.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> semid;</span><br><span class="line">    semid = semget(IPC_PRIVATE, <span class="number">3</span>, <span class="number">0777</span>);</span><br><span class="line">    <span class="keyword">if</span> (semid &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"create semaphore failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"create semaphore success, semid = %d\n"</span>, semid);</span><br><span class="line">    system(<span class="string">"ipcs -s"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// delete semaphore</span></span><br><span class="line">    semctl(semid, <span class="number">0</span>, IPC_RMID);</span><br><span class="line">    system(<span class="string">"ipcs -s"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°è¢«åˆ›å»ºçš„ <strong><code>semid = 4</code></strong> çš„ä¿¡å·ç¯è¢«åˆ é™¤</p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/semctl.png" style="zoom:80%"><h4 id="8-3-çº¿ç¨‹åŒæ­¥"><a class="header-anchor" href="#8-3-çº¿ç¨‹åŒæ­¥">Â¶</a>8.3 çº¿ç¨‹åŒæ­¥</h4><h5 id="8-3-1-posix-å®ç°æ–¹æ³•"><a class="header-anchor" href="#8-3-1-posix-å®ç°æ–¹æ³•">Â¶</a>8.3.1 posix å®ç°æ–¹æ³•</h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"pthread.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// child thread code</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">fun</span><span class="params">(<span class="keyword">char</span>* var)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> j;</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">10</span>; j++) &#123;  <span class="comment">// second</span></span><br><span class="line">        usleep(<span class="number">100</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"this is fun j = %d\n"</span>, j);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// main thread code</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> str[] = <span class="string">"hello linux\n"</span>;</span><br><span class="line">    <span class="keyword">pthread_t</span> tid;</span><br><span class="line">    <span class="keyword">int</span> ret;</span><br><span class="line">    ret = pthread_create(&amp;tid, <span class="literal">NULL</span>, fun, (<span class="keyword">void</span> *)str);</span><br><span class="line">    <span class="keyword">if</span> (ret &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"create thread failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123; <span class="comment">// first</span></span><br><span class="line">        usleep(<span class="number">100</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"this is main fun, i = %d\n"</span>, i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘ï¼š<strong><code>gcc -o posix posix.c -lpthread</code></strong></p><p>å› ä¸ºæ²¡æœ‰åŠ  <strong><code>PV</code></strong> æ“ä½œï¼Œæ‰€ä»¥æ¯æ¬¡ç¨‹åºè¿›è¡Œçš„é¡ºåºéƒ½æ˜¯ä¹±çš„ã€‚</p><p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/posix_01.png" style="zoom:67%"><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/posix_02.png" style="zoom:67%"></p><p>ä½¿ç”¨ posix ä¿¡å·é‡æ¥å®ç°ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´çš„åŒæ­¥</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"pthread.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"semaphore.h"</span></span></span><br><span class="line"><span class="comment">// å®šä¹‰ä¿¡å·é‡</span></span><br><span class="line"><span class="keyword">sem_t</span> sem;</span><br><span class="line"></span><br><span class="line"><span class="comment">// child thread code</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">fun</span><span class="params">(<span class="keyword">char</span>* var)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> j;</span><br><span class="line">    <span class="comment">// p wait</span></span><br><span class="line">    sem_wait(&amp;sem);</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">10</span>; j++) &#123;  <span class="comment">// second</span></span><br><span class="line">        usleep(<span class="number">100</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"this is fun j = %d\n"</span>, j);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// main thread code</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> str[] = <span class="string">"hello linux\n"</span>;</span><br><span class="line">    <span class="keyword">pthread_t</span> tid;</span><br><span class="line">    <span class="keyword">int</span> ret;</span><br><span class="line">    sem_init(&amp;sem, <span class="number">0</span>, <span class="number">0</span>); <span class="comment">// sem = 0;</span></span><br><span class="line">    ret = pthread_create(&amp;tid, <span class="literal">NULL</span>, fun, (<span class="keyword">void</span> *)str);</span><br><span class="line">    <span class="keyword">if</span> (ret &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"create thread failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123; <span class="comment">// first</span></span><br><span class="line">        usleep(<span class="number">100</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"this is main fun, i = %d\n"</span>, i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// v</span></span><br><span class="line">    sem_post(&amp;sem);</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä½¿ç”¨ä¿¡å·é‡ï¼Œå¯ä»¥å®ç°çº¿ç¨‹ä¹‹é—´çš„åŒæ­¥ï¼Œä¸»çº¿ç¨‹å®Œæˆåå­çº¿ç¨‹æ“ä½œ</p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/posix_03.png" style="zoom:80%"><h5 id="8-3-2-ä¿¡å·ç¯å®ç°æ–¹æ³•"><a class="header-anchor" href="#8-3-2-ä¿¡å·ç¯å®ç°æ–¹æ³•">Â¶</a>8.3.2 ä¿¡å·ç¯å®ç°æ–¹æ³•</h5><p>**<code>semop</code>**å‡½æ•°</p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/semopå‡½æ•°1.png" style="zoom:67%"> <img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/semopå‡½æ•°2.png" style="zoom:67%"><p><strong><code>sem.c</code></strong></p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"pthread.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/ipc.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/sem.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰ä¿¡å·é‡</span></span><br><span class="line"><span class="comment">// sem_t sem;</span></span><br><span class="line"><span class="comment">// å®šäºä¿¡å·ç¯è”åˆä½“</span></span><br><span class="line"><span class="keyword">union</span> semun &#123;</span><br><span class="line">    <span class="keyword">int</span>              val;    <span class="comment">/* Value for SETVAL */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">semid_ds</span> *<span class="title">buf</span>;</span>    <span class="comment">/* Buffer for IPC_STAT, IPC_SET */</span></span><br><span class="line">    <span class="keyword">unsigned</span> short  *<span class="built_in">array</span>;  <span class="comment">/* Array for GETALL, SETALL */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">seminfo</span>  *__<span class="title">buf</span>;</span>  <span class="comment">/* Buffer for IPC_INFO (Linux-specific) */</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> semid;</span><br><span class="line"><span class="keyword">union</span> semun mysemun;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sembuf</span> <span class="title">mysembuf</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// child thread code</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">fun</span><span class="params">(<span class="keyword">char</span>* var)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> j;</span><br><span class="line">    <span class="comment">// p wait</span></span><br><span class="line">    <span class="comment">// sem_wait(&amp;sem);</span></span><br><span class="line">    mysembuf.sem_op = <span class="number">-1</span>;</span><br><span class="line">    semop(semid, &amp;mysembuf, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">10</span>; j++) &#123;  <span class="comment">// second</span></span><br><span class="line">        usleep(<span class="number">100</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"this is fun j = %d\n"</span>, j);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// main thread code</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> str[] = <span class="string">"hello linux\n"</span>;</span><br><span class="line">    <span class="keyword">pthread_t</span> tid;</span><br><span class="line">    <span class="keyword">int</span> ret;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¿¡å·ç¯</span></span><br><span class="line">    semid = semget(IPC_PRIVATE, <span class="number">3</span>, <span class="number">0777</span>);</span><br><span class="line">    <span class="keyword">if</span> (semid &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"create semaphore failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"create semaphore success\n"</span>);</span><br><span class="line">    system(<span class="string">"ipcs -s"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// sem_init(&amp;sem, 0, 0); // sem = 0;</span></span><br><span class="line">    <span class="comment">// ä¿¡å·é‡çš„åˆå§‹åŒ–</span></span><br><span class="line">    mysemun.val = <span class="number">0</span>;</span><br><span class="line">    semctl(semid, <span class="number">0</span>, SETVAL, mysemun);</span><br><span class="line">    mysembuf.sem_num = <span class="number">0</span>;</span><br><span class="line">    mysembuf.sem_flg = <span class="number">0</span>; <span class="comment">// é˜»å¡æ“ä½œ</span></span><br><span class="line">    </span><br><span class="line">    ret = pthread_create(&amp;tid, <span class="literal">NULL</span>, fun, (<span class="keyword">void</span> *)str);</span><br><span class="line">    <span class="keyword">if</span> (ret &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"create thread failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123; <span class="comment">// first</span></span><br><span class="line">        usleep(<span class="number">100</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"this is main fun, i = %d\n"</span>, i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// v</span></span><br><span class="line">    <span class="comment">// sem_post(&amp;sem);</span></span><br><span class="line">    mysembuf.sem_op = <span class="number">1</span>;</span><br><span class="line">    semop(semid, &amp;mysembuf, <span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç°ç»“æœä¸ posix å®ç°æ–¹æ³•ç›¸åŒ</p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/sem_posix.png" style="zoom:80%"><h4 id="8-4-è¿›ç¨‹åŒæ­¥"><a class="header-anchor" href="#8-4-è¿›ç¨‹åŒæ­¥">Â¶</a>8.4 è¿›ç¨‹åŒæ­¥</h4><p><strong><code>server.c</code></strong></p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"pthread.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/ipc.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/sem.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰ä¿¡å·é‡</span></span><br><span class="line"><span class="comment">// sem_t sem;</span></span><br><span class="line"><span class="comment">// å®šäºä¿¡å·ç¯è”åˆä½“</span></span><br><span class="line"><span class="keyword">union</span> semun &#123;</span><br><span class="line">    <span class="keyword">int</span>              val;    <span class="comment">/* Value for SETVAL */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">semid_ds</span> *<span class="title">buf</span>;</span>    <span class="comment">/* Buffer for IPC_STAT, IPC_SET */</span></span><br><span class="line">    <span class="keyword">unsigned</span> short  *<span class="built_in">array</span>;  <span class="comment">/* Array for GETALL, SETALL */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">seminfo</span>  *__<span class="title">buf</span>;</span>  <span class="comment">/* Buffer for IPC_INFO (Linux-specific) */</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> semid;</span><br><span class="line"><span class="keyword">union</span> semun mysemun;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sembuf</span> <span class="title">mysembuf</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// main thread code</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»º key</span></span><br><span class="line">	<span class="keyword">int</span> key;</span><br><span class="line">    key = ftok(<span class="string">"./a.c"</span>, <span class="string">'a'</span>);</span><br><span class="line">    <span class="keyword">if</span> (key &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"create key failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"create key success\n"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ›å»ºä¿¡å·ç¯</span></span><br><span class="line">    semid = semget(key, <span class="number">3</span>, IPC_CREAT | <span class="number">0777</span>);</span><br><span class="line">    <span class="keyword">if</span> (semid &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"create semaphore failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"create semaphore success, semid = %d\n"</span>, semid);</span><br><span class="line">    system(<span class="string">"ipcs -s"</span>);</span><br><span class="line">    </span><br><span class="line">	<span class="comment">// åˆå§‹åŒ–ä¿¡å·  è®©clientå…ˆè¿è¡Œï¼Œè®©clientå®Œæˆåˆå§‹åŒ–å³å¯ï¼Œclient ä¼šä½¿ç”¨ P æ“ä½œ</span></span><br><span class="line">    <span class="comment">// mysemun.val = 0;</span></span><br><span class="line">    <span class="comment">// semctl(semid, 0, SETVAL, mysemun);</span></span><br><span class="line">    mysembuf.sem_num = <span class="number">0</span>;</span><br><span class="line">    mysembuf.sem_flg = <span class="number">0</span>; <span class="comment">// é˜»å¡æ“ä½œ</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123; <span class="comment">// first</span></span><br><span class="line">        usleep(<span class="number">100</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"server fun, i = %d\n"</span>, i);</span><br><span class="line">    &#125;</span><br><span class="line">    sleep(<span class="number">3</span>);</span><br><span class="line">    <span class="comment">// v</span></span><br><span class="line">    mysembuf.sem_op = <span class="number">1</span>;</span><br><span class="line">    semop(semid, &amp;mysembuf, <span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><code>client.c</code></strong></p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"pthread.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/ipc.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sys/sem.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰ä¿¡å·é‡</span></span><br><span class="line"><span class="comment">// sem_t sem;</span></span><br><span class="line"><span class="comment">// å®šäºä¿¡å·ç¯è”åˆä½“</span></span><br><span class="line"><span class="keyword">union</span> semun &#123;</span><br><span class="line">    <span class="keyword">int</span>              val;    <span class="comment">/* Value for SETVAL */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">semid_ds</span> *<span class="title">buf</span>;</span>    <span class="comment">/* Buffer for IPC_STAT, IPC_SET */</span></span><br><span class="line">    <span class="keyword">unsigned</span> short  *<span class="built_in">array</span>;  <span class="comment">/* Array for GETALL, SETALL */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">seminfo</span>  *__<span class="title">buf</span>;</span>  <span class="comment">/* Buffer for IPC_INFO (Linux-specific) */</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> semid;</span><br><span class="line"><span class="keyword">union</span> semun mysemun;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sembuf</span> <span class="title">mysembuf</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// main thread code</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»º key</span></span><br><span class="line">	<span class="keyword">int</span> key;</span><br><span class="line">    key = ftok(<span class="string">"./a.c"</span>, <span class="string">'a'</span>);</span><br><span class="line">    <span class="keyword">if</span> (key &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"create key failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"create key success\n"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ›å»ºä¿¡å·ç¯</span></span><br><span class="line">    semid = semget(key, <span class="number">3</span>, IPC_CREATE | <span class="number">0777</span>);</span><br><span class="line">    <span class="keyword">if</span> (semid &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"create semaphore failure\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"create semaphore success, semid = %d\n"</span>, semid);</span><br><span class="line">    system(<span class="string">"ipcs -s"</span>);</span><br><span class="line">    </span><br><span class="line">	<span class="comment">// åˆå§‹åŒ–ä¿¡å·</span></span><br><span class="line">    mysemun.val = <span class="number">0</span>;</span><br><span class="line">    semctl(semid, <span class="number">0</span>, SETVAL, mysemun);</span><br><span class="line">    mysembuf.sem_num = <span class="number">0</span>;</span><br><span class="line">    mysembuf.sem_flg = <span class="number">0</span>; <span class="comment">// é˜»å¡æ“ä½œ</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// P</span></span><br><span class="line">    mysembuf.sem_op = <span class="number">-1</span>;</span><br><span class="line">    semop(semid, &amp;mysembuf, <span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123; <span class="comment">// first</span></span><br><span class="line">        usleep(<span class="number">100</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"client fun, i = %d\n"</span>, i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸¤ä¸ªè¿›ç¨‹ä¹‹é—´çš„é€»è¾‘å¦‚ä¸‹ï¼š</p><p>é¦–å…ˆæ‰“å¼€ <strong><code>client</code></strong> è¿›ç¨‹ï¼Œåˆ›å»ºä¿¡å·ç¯ï¼Œåˆå§‹åŒ–ä¿¡å·ç¯ï¼Œä¹‹å P æ“ä½œï¼Œå¤„äºé˜»å¡çŠ¶æ€</p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/sem_pv01.png" style="zoom:80%"><p>æ‰“å¼€ <strong><code>server</code></strong> è¿›ç¨‹ï¼Œæ‰“å¼€ä¿¡å·ç¯ï¼Œæ‰§è¡Œç¨‹åºä»£ç ï¼Œæ‰“å°è¾“å‡ºï¼Œç¡çœ  3 ç§’åï¼Œæ‰§è¡Œ V æ“ä½œ</p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/sem_pv02.png" style="zoom:80%"><p><strong><code>client</code></strong> æ‰§è¡Œ P æ“ä½œä¹‹åçš„ä»£ç ï¼Œæ‰“å°è¾“å‡º</p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/sem_pv03.png" style="zoom:80%"><h3 id="å‡½æ•°åˆ†å¸ƒå›¾ï¼š"><a class="header-anchor" href="#å‡½æ•°åˆ†å¸ƒå›¾ï¼š">Â¶</a>å‡½æ•°åˆ†å¸ƒå›¾ï¼š</h3><p><img src="/Server_Programming/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/IPC%E6%B5%81%E7%A8%8B%E5%9B%BE.png" alt></p><h3 id="å‚è€ƒèµ„æ–™ï¼š"><a class="header-anchor" href="#å‚è€ƒèµ„æ–™ï¼š">Â¶</a>å‚è€ƒèµ„æ–™ï¼š</h3><blockquote><p><a href="https://www.bilibili.com/video/BV1tJ41117ty?p=1" target="_blank" rel="noopener">linuxè¿›ç¨‹é—´é€šä¿¡_å“”å“©å“”å“© (ã‚œ-ã‚œ)ã¤ãƒ­ å¹²æ¯~-bilibili</a></p></blockquote><!-- rebuild by neat -->]]></content>
      <categories>
        <category>Server_Programming</category>
      </categories>
      <tags>
        <tag>Inter-Process Communication</tag>
        <tag>Server_Programming</tag>
      </tags>
  </entry>
  <entry>
    <title>makefile æ ¼å¼</title>
    <url>/Complie_and_Debug/makefile%E6%A0%BC%E5%BC%8F/</url>
    <content><![CDATA[<!-- build time:Tue Jun 22 2021 17:02:33 GMT+0800 (GMT+08:00) --><a id="more"></a><h2 id="makefile-æ ¼å¼"><a class="header-anchor" href="#makefile-æ ¼å¼">Â¶</a>makefile æ ¼å¼</h2><h3 id="æ–¹å¼ä¸€"><a class="header-anchor" href="#æ–¹å¼ä¸€">Â¶</a>æ–¹å¼ä¸€</h3><figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ˜¯æ³¨é‡Š</span></span><br><span class="line"><span class="comment"># ç¬¬ä¸€å±‚ï¼šæ˜¾ç¤ºè§„åˆ™</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###   ç›®æ ‡æ–‡ä»¶ï¼šä¾èµ–æ–‡ä»¶</span></span><br><span class="line"><span class="comment">###  ã€Tabã€‘ æŒ‡ä»¤</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¬¬ä¸€ä¸ªç›®æ ‡æ–‡ä»¶æ˜¯æœ€ç»ˆç›®æ ‡</span></span><br><span class="line"><span class="section">hello.exe: hello.o other.o</span></span><br><span class="line">	gcc hello.o other.o -o hello.exe</span><br><span class="line"></span><br><span class="line"><span class="section">hello.o: hello.c</span></span><br><span class="line">	gcc -c hello.c -o hello.o</span><br><span class="line"><span class="section">other.o: other.c</span></span><br><span class="line">	gcc -c other.c -o other.o</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¼ªç›®æ ‡ï¼š.PHONY:</span></span><br><span class="line"><span class="meta"><span class="meta-keyword">.PHONY</span>:</span></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">	rm -rf hello.o other.o hello.exe</span><br></pre></td></tr></table></figure><h3 id="æ–¹å¼äºŒ"><a class="header-anchor" href="#æ–¹å¼äºŒ">Â¶</a>æ–¹å¼äºŒ</h3><figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç¬¬äºŒå±‚</span></span><br><span class="line"><span class="comment"># å˜é‡ =ï¼ˆæ›¿æ¢ï¼‰ +=ï¼ˆè¿½åŠ ï¼‰ :=ï¼ˆæ’ç­‰äºï¼‰</span></span><br><span class="line"></span><br><span class="line">TAR = hello.exe</span><br><span class="line">OBJ = hello.o other.o</span><br><span class="line">CC := gcc</span><br><span class="line">RMRF := rm -rf</span><br><span class="line"></span><br><span class="line"><span class="variable">$(TAR)</span>: <span class="variable">$(OBJ)</span></span><br><span class="line">	CC <span class="variable">$(OBJ)</span> -o <span class="variable">$(TAR)</span></span><br><span class="line"><span class="section">hello.o: hello.c</span></span><br><span class="line">	CC -c hello.c -o hello.o</span><br><span class="line"><span class="section">other.o: other.c</span></span><br><span class="line">	CC -c other.c -o other.o</span><br><span class="line">	</span><br><span class="line"><span class="meta"><span class="meta-keyword">.PHONY</span>:</span></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">	<span class="variable">$(RMRF)</span> <span class="variable">$(OBJ)</span> <span class="variable">$(TAR)</span></span><br></pre></td></tr></table></figure><h3 id="æ–¹å¼ä¸‰"><a class="header-anchor" href="#æ–¹å¼ä¸‰">Â¶</a>æ–¹å¼ä¸‰</h3><figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç¬¬ä¸‰å±‚ éšå«è§„åˆ™ </span></span><br><span class="line"><span class="comment"># %.c %.o *.c *.o  </span></span><br><span class="line"><span class="comment"># %ï¼ˆä»»æ„çš„ï¼‰   </span></span><br><span class="line"><span class="comment"># *ï¼ˆæ‰€æœ‰çš„ï¼‰</span></span><br><span class="line"></span><br><span class="line">TAR = hello.exe</span><br><span class="line">OBJ = hello.o other.o</span><br><span class="line">CC := gcc</span><br><span class="line"></span><br><span class="line"><span class="variable">$(TAR)</span>: <span class="variable">$(OBJ)</span></span><br><span class="line">	<span class="variable">$(CC)</span> <span class="variable">$(OBJ)</span> -o <span class="variable">$(TAR)</span></span><br><span class="line">	</span><br><span class="line"><span class="section">%.o: %.c</span></span><br><span class="line">	<span class="variable">$(CC)</span> -c %.c -o %.o	</span><br><span class="line">	</span><br><span class="line"><span class="meta"><span class="meta-keyword">.PHONY</span>:</span></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">	rm -rf <span class="variable">$(OBJ)</span> <span class="variable">$(TAR)</span></span><br></pre></td></tr></table></figure><h3 id="æ–¹å¼å››"><a class="header-anchor" href="#æ–¹å¼å››">Â¶</a>æ–¹å¼å››</h3><figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç¬¬å››å±‚ é€šé…ç¬¦</span></span><br><span class="line"><span class="comment"># $^ æ‰€æœ‰çš„ä¾èµ–æ–‡ä»¶ </span></span><br><span class="line"><span class="comment"># $@ æ‰€æœ‰çš„ç›®æ ‡æ–‡ä»¶</span></span><br><span class="line"><span class="comment"># $&lt; æ‰€æœ‰ä¾èµ–æ–‡ä»¶çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line">TAR = hello.exe</span><br><span class="line">OBJ = hello.o other.o</span><br><span class="line">CC := gcc</span><br><span class="line"></span><br><span class="line"><span class="variable">$(TAR)</span>: <span class="variable">$(OBJ)</span></span><br><span class="line">	<span class="variable">$(CC)</span> <span class="variable">$^</span> -o <span class="variable">$@</span></span><br><span class="line">	</span><br><span class="line"><span class="section">%.o: %.c</span></span><br><span class="line">	<span class="variable">$(CC)</span> -c <span class="variable">$^</span> -o <span class="variable">$@</span></span><br><span class="line">	</span><br><span class="line"><span class="meta"><span class="meta-keyword">.PHONY</span>:</span></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">	rm -rf <span class="variable">$(OBJ)</span> <span class="variable">$(TAR)</span></span><br></pre></td></tr></table></figure><h3 id="å¤šå¯æ‰§è¡Œæ–‡ä»¶"><a class="header-anchor" href="#å¤šå¯æ‰§è¡Œæ–‡ä»¶">Â¶</a>å¤šå¯æ‰§è¡Œæ–‡ä»¶</h3><figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¤šå¯æ‰§è¡Œæ–‡ä»¶</span></span><br><span class="line"><span class="comment"># all hello.exe hello_1.exe</span></span><br><span class="line"></span><br><span class="line">TAR1 = hello.exe</span><br><span class="line">TAR2 = hello_1.exe</span><br><span class="line"></span><br><span class="line">OBJ1 = hello.o other.o</span><br><span class="line">OBJ2 = hello_1.o other_1.o</span><br><span class="line"></span><br><span class="line">CC := gcc</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…³é”®æ˜¯ all : %.exe %.exe</span></span><br><span class="line"><span class="section">all: hello.exe hello_1.exe</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$(TAR1)</span>: <span class="variable">$(OBJ1)</span></span><br><span class="line">	<span class="variable">$(CC)</span> <span class="variable">$^</span> -o <span class="variable">$@</span></span><br><span class="line">	</span><br><span class="line"><span class="variable">$(TAR2)</span>: <span class="variable">$(OBJ2)</span></span><br><span class="line">	<span class="variable">$(CC)</span> <span class="variable">$^</span> -o <span class="variable">$@</span>  </span><br><span class="line">	</span><br><span class="line"><span class="section">%.o: %.c</span></span><br><span class="line">	<span class="variable">$(CC)</span> -c <span class="variable">$^</span> -o <span class="variable">$@</span></span><br><span class="line">	</span><br><span class="line"><span class="meta"><span class="meta-keyword">.PHONY</span>:</span></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">	rm -rf <span class="variable">$(OBJ1)</span> <span class="variable">$(OBJ2)</span> <span class="variable">$(TAR1)</span> <span class="variable">$(TAR2)</span></span><br></pre></td></tr></table></figure><!-- rebuild by neat -->]]></content>
      <categories>
        <category>Complie_and_Debug</category>
      </categories>
      <tags>
        <tag>Complie_and_Debug - makefile</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLå¸¸ç”¨å‘½ä»¤</title>
    <url>/Database/MySQL%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<!-- build time:Tue Jun 22 2021 17:02:33 GMT+0800 (GMT+08:00) --><a id="more"></a><h3 id="1-æ“ä½œæ•°æ®åº“"><a class="header-anchor" href="#1-æ“ä½œæ•°æ®åº“">Â¶</a>1 æ“ä½œæ•°æ®åº“</h3><h4 id="1-1-åˆ›å»ºæ•°æ®åº“"><a class="header-anchor" href="#1-1-åˆ›å»ºæ•°æ®åº“">Â¶</a>1.1 åˆ›å»ºæ•°æ®åº“</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">CREATE DATABASE mydb1;</span><br><span class="line"></span><br><span class="line">CREATE DATABASE mydb2 CHARACTER SET utf8; # å®šä¹‰ç¼–ç é›†</span><br><span class="line"></span><br><span class="line">CREATE DATABASE mydb3 CHARACTER SET utf8 COLLATE utf8_bin; # å®šä¹‰æ ¡å¯¹è§„åˆ™</span><br></pre></td></tr></table></figure><h4 id="1-2-æŸ¥çœ‹æ•°æ®åº“"><a class="header-anchor" href="#1-2-æŸ¥çœ‹æ•°æ®åº“">Â¶</a>1.2 æŸ¥çœ‹æ•°æ®åº“</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SHOW DATABASES # æŸ¥çœ‹å½“å‰æ•°æ®åº“æœåŠ¡å™¨ä¸­æ‰€æœ‰æ•°æ®åº“</span><br><span class="line"></span><br><span class="line">SHOW CREATE DATABASE mydb1; # æŸ¥çœ‹å‰é¢åˆ›å»ºçš„mydb1æ•°æ®åº“çš„å®šä¹‰ä¿¡æ¯</span><br></pre></td></tr></table></figure><h4 id="1-3-ä¿®æ”¹æ•°æ®åº“"><a class="header-anchor" href="#1-3-ä¿®æ”¹æ•°æ®åº“">Â¶</a>1.3 ä¿®æ”¹æ•°æ®åº“</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ALTER DATABASE mydb1 CHARACTER SET utf8; # ä¿®æ”¹ç¼–ç é›†</span><br><span class="line"></span><br><span class="line">ALTER DATABASE mydb1 COLLATE utf8_bin; # ä¿®æ”¹æ ¡å¯¹è§„åˆ™</span><br></pre></td></tr></table></figure><h4 id="1-4-åˆ é™¤æ•°æ®åº“"><a class="header-anchor" href="#1-4-åˆ é™¤æ•°æ®åº“">Â¶</a>1.4 åˆ é™¤æ•°æ®åº“</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">DROP DATABASE mydb1; # åˆ é™¤</span><br></pre></td></tr></table></figure><h4 id="1-5-é€‰æ‹©æ•°æ®åº“"><a class="header-anchor" href="#1-5-é€‰æ‹©æ•°æ®åº“">Â¶</a>1.5 é€‰æ‹©æ•°æ®åº“</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">use mydb1;  # è¿›å…¥ï¼Œæ²¡æœ‰é€€å‡ºæ“ä½œ</span><br><span class="line"></span><br><span class="line">SELECT DATABASE(); # æŸ¥çœ‹å½“å‰æ‰€é€‰çš„æ•°æ®åº“</span><br></pre></td></tr></table></figure><h3 id="2-è¡¨"><a class="header-anchor" href="#2-è¡¨">Â¶</a>2 è¡¨</h3><h4 id="2-1-å¢åŠ è¡¨"><a class="header-anchor" href="#2-1-å¢åŠ è¡¨">Â¶</a>2.1 å¢åŠ è¡¨</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">CREATE TABLE t1</span><br><span class="line">(</span><br><span class="line">    id INT,</span><br><span class="line">    name VARCHAR(20),</span><br><span class="line">    gender CHAR(1),</span><br><span class="line">    worktime DATE,</span><br><span class="line">    money DOUBLE</span><br><span class="line">) CHARACTER SET utf8 COLLATE utf8_bin;</span><br></pre></td></tr></table></figure><h4 id="2-2-æŸ¥æ‰¾è¡¨"><a class="header-anchor" href="#2-2-æŸ¥æ‰¾è¡¨">Â¶</a>2.2 æŸ¥æ‰¾è¡¨</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SHOW TABLES; # æŸ¥çœ‹è¡¨</span><br><span class="line"></span><br><span class="line">SHOW CREATE TABLE mytableï¼› # æŸ¥çœ‹è¡¨çš„å»ºè¡¨è¯­å¥</span><br><span class="line"></span><br><span class="line">DESC mytable;  # æŸ¥çœ‹è¡¨ç»“æ„</span><br></pre></td></tr></table></figure><h4 id="2-3-ä¿®æ”¹è¡¨"><a class="header-anchor" href="#2-3-ä¿®æ”¹è¡¨">Â¶</a>2.3 ä¿®æ”¹è¡¨</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ALTER TABLE mytable1 ADD image BLOB; # æ–°å¢åˆ—</span><br><span class="line"></span><br><span class="line">ALTER TABLE mytable1 MODIFY name VARCHAR(25); # ä¿®æ”¹åˆ—çš„ç±»å‹</span><br><span class="line"></span><br><span class="line">ALTER TABLE mytable1 DROP gender; # åˆ é™¤æŸåˆ—</span><br><span class="line"></span><br><span class="line">ALTER TABLE mytable1 CHARACTER SET utf8; # ä¿®æ”¹è¡¨çš„å­—ç¬¦é›†</span><br><span class="line"></span><br><span class="line">ALTER TABLE mytable1 CHANGE name username VARCHAR(20); # ä¿®æ”¹åˆ—å</span><br><span class="line"></span><br><span class="line">RENAME TABLE mytable1 TO mytable2; # ä¿®æ”¹è¡¨å mytable1 -&gt; mytable2</span><br></pre></td></tr></table></figure><h4 id="2-4-åˆ é™¤è¡¨"><a class="header-anchor" href="#2-4-åˆ é™¤è¡¨">Â¶</a>2.4 åˆ é™¤è¡¨</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">DROP TABLE mytable1;</span><br></pre></td></tr></table></figure><h4 id="2-5-å„ç§çº¦æŸ"><a class="header-anchor" href="#2-5-å„ç§çº¦æŸ">Â¶</a>2.5 å„ç§çº¦æŸ</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">CREATE TABLE t1</span><br><span class="line">(</span><br><span class="line">    id INT PRIMARY KEY AUTO_INCREMENT, # ä¸»é”®çº¦æŸ,è‡ªåŠ¨å¢é•¿</span><br><span class="line">    name VARCHAR(20) UNIQUE,  # å”¯ä¸€çº¦æŸ   </span><br><span class="line">    gender CHAR(1) NOT NULL,  # éç©ºçº¦æŸ</span><br><span class="line">    worktime DATE,</span><br><span class="line">    money DOUBLE DEFAULT 10000.0  # é»˜è®¤å€¼çº¦æŸ</span><br><span class="line">) CHARACTER SET utf8 COLLATE utf8_bin;</span><br><span class="line"></span><br><span class="line">FOREIGN KEY &#x2F;&#x2F; å¤–é”®çº¦æŸ</span><br></pre></td></tr></table></figure><h4 id="2-6-ç´¢å¼•"><a class="header-anchor" href="#2-6-ç´¢å¼•">Â¶</a>2.6 ç´¢å¼•</h4><h5 id="2-6-1-åˆ›å»ºç´¢å¼•"><a class="header-anchor" href="#2-6-1-åˆ›å»ºç´¢å¼•">Â¶</a>2.6.1 åˆ›å»ºç´¢å¼•</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;</span><br><span class="line">#&#x2F;&#x2F; æ–¹å¼ä¸€ ï¼š å»ºè¡¨æ—¶å€™åˆ›å»ºç´¢å¼•</span><br><span class="line">#&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;</span><br><span class="line"># åˆ›å»ºæ™®é€šç´¢å¼•</span><br><span class="line">CREATE TABLE t1</span><br><span class="line">(</span><br><span class="line">    id INT, </span><br><span class="line">    INDEX bieming(id) </span><br><span class="line">)ï¼›</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºå”¯ä¸€ç´¢å¼•,å‡åº</span><br><span class="line">CREATE TABLE t2</span><br><span class="line">(</span><br><span class="line">    id INT, </span><br><span class="line">    UNIQUE INDEX bieming(id, ASC) </span><br><span class="line">)ï¼›</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºå…¨æ–‡ç´¢å¼•</span><br><span class="line">CREATE TABLE t3</span><br><span class="line">(</span><br><span class="line">    name VARCHAR(20), </span><br><span class="line">    FULLTEXT INDEX bieming(name) </span><br><span class="line">)ENGINE&#x3D;MyISAM; # å¿…é¡»ä½¿ç”¨ myisamå¼•æ“</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºå¤šåˆ—ç´¢å¼•</span><br><span class="line">CREATE TABLE t4</span><br><span class="line">(</span><br><span class="line">    id INT, </span><br><span class="line">    name VARCHAR(20),</span><br><span class="line">    INDEX bieming(id,name(20)) </span><br><span class="line">)ï¼›</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºç©ºé—´ç´¢å¼•</span><br><span class="line">CREATE TABLE t5</span><br><span class="line">(</span><br><span class="line">    a1 GEOMETRY,</span><br><span class="line">    a2 POINT,</span><br><span class="line">    a3 LINESTRING,</span><br><span class="line">    a4 POLYGON</span><br><span class="line">    SPATIAL INDEX bieming(a1) </span><br><span class="line">)ENGINE&#x3D;MyISAM; # å¿…é¡»ä½¿ç”¨ myisamå¼•æ“</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;</span><br><span class="line">#&#x2F;&#x2F; æ–¹å¼äºŒï¼š åœ¨å·²ç»å­˜åœ¨çš„è¡¨ä¸Šåˆ›å»ºç´¢å¼•</span><br><span class="line">#&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CREATE TABLE t1</span><br><span class="line">(</span><br><span class="line">    id INT, &#x2F;&#x2F; ä¸»é”®çº¦æŸ,è‡ªåŠ¨å¢é•¿</span><br><span class="line">    name VARCHAR(20), &#x2F;&#x2F; å”¯ä¸€çº¦æŸ   </span><br><span class="line">    gender CHAR(1),  &#x2F;&#x2F; éç©ºçº¦æŸ</span><br><span class="line">    worktime DATE,</span><br><span class="line">    money DOUBLE  &#x2F;&#x2F; é»˜è®¤å€¼çº¦æŸ</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">CREATE INDEX bieming on t1(id);          	# åˆ›å»ºæ™®é€šç´¢å¼•</span><br><span class="line">CREATE UNIQUE INDEX bieming on t1(id, ASC); # åˆ›å»ºå”¯ä¸€ç´¢å¼•</span><br><span class="line">CREATE FULLTEXT INDEX bieming on t1(id); 	# åˆ›å»ºå…¨æ–‡ç´¢å¼•</span><br><span class="line">CREATE INDEX bieming on t1(id, gender(1));  # åˆ›å»ºå¤šåˆ—ç´¢å¼•</span><br><span class="line">CREATE SPATIAL INDEX bieming on t1(id);  	# åˆ›å»ºç©ºé—´ç´¢å¼•</span><br></pre></td></tr></table></figure><h5 id="2-6-2-åˆ é™¤ç´¢å¼•"><a class="header-anchor" href="#2-6-2-åˆ é™¤ç´¢å¼•">Â¶</a>2.6.2 åˆ é™¤ç´¢å¼•</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ALTER TABLE t1 DROP INDEX bieming;</span><br><span class="line"></span><br><span class="line">DROP INDEX beiming ON t1;</span><br></pre></td></tr></table></figure><h3 id="3-æ“ä½œè¡¨è®°å½•"><a class="header-anchor" href="#3-æ“ä½œè¡¨è®°å½•">Â¶</a>3 æ“ä½œè¡¨è®°å½•</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; desc test2;</span><br><span class="line">#+--------+----------+------+-----+---------+-------+</span><br><span class="line">#| Field  | Type     | Null | Key | Default | Extra |</span><br><span class="line">#+--------+----------+------+-----+---------+-------+</span><br><span class="line">#| id     | int      | YES  |     | NULL    |       |</span><br><span class="line">#| name   | char(50) | YES  |     | NULL    |       |</span><br><span class="line">#| gender | char(1)  | YES  |     | NULL    |       |</span><br><span class="line">#| salary | double   | YES  |     | NULL    |       |</span><br><span class="line">#+--------+----------+------+-----+---------+-------+</span><br></pre></td></tr></table></figure><h4 id="4-1-insert"><a class="header-anchor" href="#4-1-insert">Â¶</a>4.1 insert</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">INSERT INTO test1(id, name, gender) VALUES(10, &#39;JACK&#39;, &#39;M&#39;); # å¯ä»¥ç¼ºçœ</span><br><span class="line"></span><br><span class="line">INSERT INTO test1 VALUES(11, &#39;MAC&#39;, &#39;M&#39;, 123.245); # çœå»field å¿…é¡»æ»¡è¶³åˆ—æ•°ç›¸åŒ</span><br><span class="line">												   # ä¸”å¯ä»¥ä¸€æ¬¡æ€§æ·»åŠ å¤šæ¡</span><br><span class="line">INSERT INTO test1 VALUES(11, &#39;MAC&#39;, &#39;M&#39;, 123.245), (12, &#39;MAcC&#39;, &#39;M&#39;, 123.5245);</span><br></pre></td></tr></table></figure><h4 id="4-2-update"><a class="header-anchor" href="#4-2-update">Â¶</a>4.2 update</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">UPDATE test1 SET salary &#x3D; 5000; # è¡¨å†…æ‰€æœ‰äººå·¥èµ„å˜æˆ 5000</span><br><span class="line"></span><br><span class="line">UPDATE test1 SET salary &#x3D; 3000 WHERE name &#x3D; &#39;A&#39;; # è¡¨å†…åä¸º A çš„å·¥èµ„æ›´æ–°ä¸º 3000</span><br><span class="line"></span><br><span class="line">UPDATE test1 SET salary &#x3D; 4000, gender &#x3D; &#39;f&#39; WHERE &#x3D; &#39;B&#39;; # B æ”¹ä¸º4000ï¼Œ å¥³</span><br><span class="line"></span><br><span class="line">UPDATE test1 SET salary &#x3D; salary + 1000 WHERE name &#x3D; &#39;C&#39;; # æ”¯æŒè¡¨è¾¾å¼è¿ç®—</span><br></pre></td></tr></table></figure><h4 id="4-3-deleteï¼Œtruncate"><a class="header-anchor" href="#4-3-deleteï¼Œtruncate">Â¶</a>4.3 deleteï¼Œtruncate</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">DELETE FROM test1 WHERE name &#x3D; &#39;C&#39;; # åˆ é™¤ C çš„æ•°æ®</span><br><span class="line"></span><br><span class="line">DELETE FROM test1;  # åˆ é™¤è¡¨ä¸­æ‰€æœ‰æ•°æ®</span><br><span class="line"></span><br><span class="line">TRUNCATE test1;     # åˆ é™¤è¡¨ä¸­æ‰€æœ‰æ•°æ® -&gt; æ‘§æ¯è¡¨å¹¶åˆ›å»ºæ–°çš„è¡¨æ ¼</span><br></pre></td></tr></table></figure><h3 id="4-å•è¡¨æŸ¥è¯¢"><a class="header-anchor" href="#4-å•è¡¨æŸ¥è¯¢">Â¶</a>4 å•è¡¨æŸ¥è¯¢</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#+----+-------+--------+--------+-----------+</span><br><span class="line">#| id | name  | gender | salary | allowance |</span><br><span class="line">#+----+-------+--------+--------+-----------+</span><br><span class="line">#|  1 | Alice | M      |   5000 |       500 |</span><br><span class="line">#|  2 | Bob   | M      |   4500 |       400 |</span><br><span class="line">#|  3 | Cc    | F      |   6000 |       600 |</span><br><span class="line">#+----+-------+--------+--------+-----------+</span><br></pre></td></tr></table></figure><h4 id="4-1-ç®€å•æŸ¥è¯¢"><a class="header-anchor" href="#4-1-ç®€å•æŸ¥è¯¢">Â¶</a><strong>4.1 ç®€å•æŸ¥è¯¢</strong></h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SELECT * FROM test2;  # æŸ¥è¯¢æ‰€æœ‰å†…å®¹</span><br><span class="line"></span><br><span class="line">SELECT id, name FROM test2;  # æŸ¥è¯¢ id å’Œ name , æ³¨æ„ é€—å·</span><br><span class="line"></span><br><span class="line">SELECT DISTINCT gender FROM test2;  # è¿‡æ»¤è¡¨ä¸­é‡å¤çš„æ•°æ®</span><br><span class="line"></span><br><span class="line">SELECT name, salary + 1200 FROM test2;  # æŸ¥è¯¢ç¨å‰è–ªæ°´ï¼ˆ+1200ï¼‰ æ•°æ®åº“åº•å±‚æ•°æ®æ²¡æœ‰æ”¹å˜</span><br><span class="line"></span><br><span class="line">SELECT name, salary + allowance FROM test2;  # ç»Ÿè®¡è–ªæ°´ + æ´¥è´´</span><br><span class="line"></span><br><span class="line">SELECT name AS å§“å, salary + allowance AS æ€»å·¥èµ„ FROM test2;  # ä½¿ç”¨åˆ«å</span><br><span class="line">SELECT name åºå·, salary + allowance æ€»å·¥èµ„ FROM test2; 		  # as ç”¨ç©ºæ ¼ä»£æ›¿</span><br></pre></td></tr></table></figure><h4 id="4-2-å¸¦æœ‰è¿‡æ»¤çš„æŸ¥è¯¢"><a class="header-anchor" href="#4-2-å¸¦æœ‰è¿‡æ»¤çš„æŸ¥è¯¢">Â¶</a><strong>4.2 å¸¦æœ‰è¿‡æ»¤çš„æŸ¥è¯¢</strong></h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SELECT * FROM test2 WHERE name &#x3D; &#39;A&#39;;  # æŸ¥è¯¢ A çš„æ‰€æœ‰æ•°æ®</span><br><span class="line"></span><br><span class="line">SELECT * FROM test2 WHERE salary &gt; 5000;  # æŸ¥è¯¢ è–ªæ°´å¤§äº 5000 çš„ç”¨æˆ·</span><br><span class="line"></span><br><span class="line">SELECT * FROM test2 WHERE salary + allowance &gt; 4000;  # æŸ¥è¯¢è–ªæ°´ + æ´¥è´´å¤§äº 4000 çš„ç”¨æˆ· </span><br><span class="line"></span><br><span class="line">SELECT * FROM test2 WHERE salary BETWEEN 3500 AND 6500;  # æŸ¥è¯¢è–ªæ°´åœ¨ 3500- 6500 ä¹‹é—´</span><br><span class="line"></span><br><span class="line">SELECT * FROM test2 WHERE salary IN (4000, 6000);  # æŸ¥è¯¢è–ªæ°´åœ¨ 4000 å’Œ 6000 </span><br><span class="line"></span><br><span class="line">SELECT * FROM test2 WHERE name like &#39;A%&#39;;   # æ¨¡ç³ŠæŸ¥æ‰¾åå­—æœ‰A ï¼ˆ% -&gt; 0-n ä¸ªï¼Œ _ -&gt;0-1ä¸ªï¼‰</span><br><span class="line">SELECT * FROM test2 WHERE name like &#39;A____&#39;;  #&#x2F; _ æ•°é‡å¯¹åº”</span><br><span class="line"></span><br><span class="line">SELECT * FROM test2 WHERE salary &gt; 4000 and allowance &gt; 500;</span><br></pre></td></tr></table></figure><h4 id="4-3-èšåˆå‡½æ•°"><a class="header-anchor" href="#4-3-èšåˆå‡½æ•°">Â¶</a><strong>4.3 èšåˆå‡½æ•°</strong></h4><ol><li>count èšåˆå‡½æ•°ï¼Œç”¨æ¥ç»Ÿè®¡è¡Œæ•°</li></ol><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SELECT COUNT(*) FROM test2;</span><br><span class="line"></span><br><span class="line">SELECT COUNT(*) FROM test2 WHERE salary + allowance &gt; 4000; # æŸ¥è–ªæ°´æ´¥è´´å¤§äº4000çš„ç”¨æˆ·æ•°</span><br></pre></td></tr></table></figure><ol start="2"><li>sum èšåˆå‡½æ•°ï¼Œæ±‚ç¬¦åˆæ¡ä»¶çš„æŸåˆ—çš„å’Œå€¼</li></ol><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SELECT SUM(salary) FROM test1;  # æ‰€æœ‰äººçš„æ€»è–ªæ°´</span><br><span class="line"></span><br><span class="line">SELECT SUM(salary + allowance) FROM test1;  # æ‰€æœ‰äººçš„æ€»æ”¶å…¥ï¼ˆè–ªæ°´+æ´¥è´´ï¼‰</span><br><span class="line"></span><br><span class="line">SELECT SUM(salary + allowance) &#x2F; COUNT(*) FROM test1;  # æ”¶å…¥çš„å¹³å‡æ°´å¹³</span><br></pre></td></tr></table></figure><ol start="3"><li>avg èšåˆå‡½æ•°ï¼Œæ±‚ç¬¦åˆæ¡ä»¶çš„åˆ—çš„å¹³å‡å€¼</li></ol><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SELECT AVG(salary) FROM test1;  # æ±‚è–ªæ°´çš„å¹³å‡å€¼</span><br></pre></td></tr></table></figure><ol start="4"><li>max / min ï¼Œæ±‚ç¬¦åˆæ¡ä»¶çš„åˆ—çš„æœ€å¤§æœ€å°å€¼</li></ol><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SELECT MAX(salary) FROM test1;  # æœ€å¤§å€¼</span><br><span class="line">SELECT MIN(salary) FROM test1;  # æœ€å°å€¼</span><br></pre></td></tr></table></figure><h4 id="4-4-æ’åºæŸ¥è¯¢"><a class="header-anchor" href="#4-4-æ’åºæŸ¥è¯¢">Â¶</a><strong>4.4 æ’åºæŸ¥è¯¢</strong></h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SELECT name, salary FROM test1 ORDER BY salary;  # æŒ‰ç…§è–ªæ°´å¤§å°æ’åº å‡åº</span><br><span class="line">SELECT name, salary FROM test1 ORDER BY salary DESC; # é™åº</span><br><span class="line"></span><br><span class="line">SELECT name å§“å, salary + allowance æ€»æ”¶å…¥ FROM test1 ORDER BY æ€»æ”¶å…¥ DESC;  # æŒ‰ç…§æ€»æ”¶å…¥é™åºæ’åº</span><br><span class="line"></span><br><span class="line">SELECT name å§“å, salary + allowance æ€»æ”¶å…¥ FROM test1 WHERE id &lt; 3 ORDER BY æ€»æ”¶å…¥ DESC;  # æŒ‰ç…§id&lt;3 æ€»æ”¶å…¥é™åºæ’åºï¼ˆä½¿ç”¨åˆ«åï¼‰</span><br></pre></td></tr></table></figure><h4 id="4-5-åˆ†ç»„æŸ¥è¯¢"><a class="header-anchor" href="#4-5-åˆ†ç»„æŸ¥è¯¢">Â¶</a><strong>4.5 åˆ†ç»„æŸ¥è¯¢</strong></h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">CREATE TABLE ORDERS(</span><br><span class="line">	id int,</span><br><span class="line">    product varchar(20),</span><br><span class="line">    price float</span><br><span class="line">);</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SELECT *FROM orders GROUP BY product;  # æŒ‰ç…§å•†å“åˆ†ç»„æŸ¥æ‰¾</span><br><span class="line"></span><br><span class="line">SELECT product, SUM(price) FROM orders GROUP BY product;  # åˆ†ç»„åˆå¹¶ä»·æ ¼æ€»æ•°</span><br><span class="line"></span><br><span class="line"># æŸ¥è¯¢æ€»ä»·å¤§äº100çš„å•†å“åç§°ï¼Œå«ç»„åˆ</span><br><span class="line"></span><br><span class="line"># WHERE åœ¨åˆ†ç»„ä¹‹å‰è¿‡æ»¤ ä¸æ»¡è¶³æ¡ä»¶ ä¸”ä¸å…è®¸ä½¿ç”¨èšåˆè¯­å¥</span><br><span class="line">SELECT product, SUM(price) FROM orders WHERE price &gt; 100 GROUP BY product;  âˆš ä¸€åŠ</span><br><span class="line">SELECT product, SUM(price) FROM orders WHERE SUM(price) &gt; 100 GROUP BY product;  x</span><br><span class="line"></span><br><span class="line"># HAVING åˆ†ç»„ä¹‹å</span><br><span class="line">SELECT product, SUM(price) FROM orders GROUP BY product HAVING SUM(price) &gt; 100;</span><br><span class="line"></span><br><span class="line"># æ€»ä»·å¤§äº100ï¼Œå•ä»·å°äº100</span><br><span class="line">SELECT product, SUM(price) FROM orders WHERE price &lt; 100 GROUP BY product HAVING sum(price) &gt; 100;</span><br></pre></td></tr></table></figure><h4 id="4-6-limit"><a class="header-anchor" href="#4-6-limit">Â¶</a>**4.6 limit **</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SELECT * FROM cast LIMIT 5;    # ä»ç¬¬1æ¡å¼€å§‹å–5æ¡</span><br><span class="line">SELECT * FROM cast LIMIT 5, 5; # ä»ç¬¬6æ¡å¼€å§‹å–5æ¡</span><br></pre></td></tr></table></figure><h4 id="4-7-åˆ«å"><a class="header-anchor" href="#4-7-åˆ«å">Â¶</a><strong>4.7 åˆ«å</strong></h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SELECT * FROM tableName AS otherName;  # ç»™è¡¨æ˜å–åˆ«å  AS å¯ä»¥çœç•¥</span><br><span class="line"></span><br><span class="line">SELECT * FROM student AS s WHERE s.gender &#x3D; &#39;F&#39;;</span><br><span class="line"></span><br><span class="line">SELECT name AS å§“å FROM tablename;  # å­—æ®µåˆ«å</span><br></pre></td></tr></table></figure><h3 id="5-å¤šè¡¨æŸ¥è¯¢"><a class="header-anchor" href="#5-å¤šè¡¨æŸ¥è¯¢">Â¶</a>5 å¤šè¡¨æŸ¥è¯¢</h3><h4 id="5-1-æ·»åŠ å¤–é”®çº¦æŸ"><a class="header-anchor" href="#5-1-æ·»åŠ å¤–é”®çº¦æŸ">Â¶</a><strong>5.1 æ·»åŠ å¤–é”®çº¦æŸ</strong></h4><h5 id="5-1-1-å£°æ˜è¡¨çš„æ—¶å€™æ·»åŠ å¤–é”®"><a class="header-anchor" href="#5-1-1-å£°æ˜è¡¨çš„æ—¶å€™æ·»åŠ å¤–é”®">Â¶</a><strong>5.1.1 å£°æ˜è¡¨çš„æ—¶å€™æ·»åŠ å¤–é”®</strong></h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">FOREIGN KEY(dept_id) REFERENCES dept(id) </span><br><span class="line"></span><br><span class="line">CREATE TABLE dept (</span><br><span class="line">	id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">    name VARCHAR(50)</span><br><span class="line">);</span><br><span class="line">INSERT INTO dept VALUES(NULL,&#39;è´¢åŠ¡éƒ¨&#39;),(NULL,&#39;äººäº‹éƒ¨&#39;),(NULL,&#39;è¡Œæ”¿éƒ¨&#39;),(NULL,&#39;ç§‘æŠ€éƒ¨&#39;);</span><br><span class="line">CREATE TABLE emp (</span><br><span class="line">	id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">    name VARCHAR(50),</span><br><span class="line">    dept_id INT,</span><br><span class="line">    FOREIGN KEY(dept_id) REFERENCES dept(id)  # åˆ›å»ºè¡¨çš„æ—¶å€™æ·»åŠ å¤–é”®çº¦æŸ</span><br><span class="line">);</span><br><span class="line">INSERT INTO emp VALUES(NULL,&#39;å¥¥å·´é©¬&#39;,1),(NULL,&#39;æ‹œç™»&#39;,3),(NULL,&#39;æ—è‚¯&#39;,4),(NULL,&#39;ç‰¹æœ—æ™®&#39;,2);</span><br></pre></td></tr></table></figure><h5 id="5-5-2-è¡¨å·²ç»å­˜åœ¨"><a class="header-anchor" href="#5-5-2-è¡¨å·²ç»å­˜åœ¨">Â¶</a><strong>5.5.2 è¡¨å·²ç»å­˜åœ¨</strong></h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ALTER TALBE è¡¨å ADD CONSTRAINT fk_id FOREIGN KEY (å¤–é”®å­—æ®µå) REFERENCES å¤–è¡¨è¡¨åï¼ˆä¸»é”®å­—æ®µåï¼‰</span><br><span class="line"></span><br><span class="line">ALTER TABLE emp ADD CONSTRAINT aaa_fk FOREIGN KEY (dept_id) REFERENCES dept(id);</span><br></pre></td></tr></table></figure><h5 id="5-5-3-åˆ é™¤å¤–é”®"><a class="header-anchor" href="#5-5-3-åˆ é™¤å¤–é”®">Â¶</a>5.5.3 åˆ é™¤å¤–é”®</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ALTER TABLE emp DROP FOREIGN KEY aaa_fk;  # åˆ é™¤å¤–é”®å</span><br></pre></td></tr></table></figure><h4 id="5-2-æ“ä½œå…³è”è¡¨"><a class="header-anchor" href="#5-2-æ“ä½œå…³è”è¡¨">Â¶</a>5.2 æ“ä½œå…³è”è¡¨</h4><h5 id="5-2-1-æ·»åŠ æ•°æ®"><a class="header-anchor" href="#5-2-1-æ·»åŠ æ•°æ®">Â¶</a>5.2.1 æ·»åŠ æ•°æ®</h5><h5 id="5-2-2-åˆ é™¤æ•°æ®"><a class="header-anchor" href="#5-2-2-åˆ é™¤æ•°æ®">Â¶</a>5.2.2 åˆ é™¤æ•°æ®</h5><h4 id="5-3-è¿æ¥æŸ¥è¯¢"><a class="header-anchor" href="#5-3-è¿æ¥æŸ¥è¯¢">Â¶</a>5.3 è¿æ¥æŸ¥è¯¢</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#+----+--------+</span><br><span class="line">#| id | name   |</span><br><span class="line">#+----+--------+</span><br><span class="line">#|  1 | è´¢åŠ¡éƒ¨ |</span><br><span class="line">#|  2 | äººäº‹éƒ¨ |</span><br><span class="line">#|  3 | è¡Œæ”¿éƒ¨ |</span><br><span class="line">#|  4 | ç§‘æŠ€éƒ¨ |</span><br><span class="line">#|  5 | å•†åŠ¡éƒ¨ |</span><br><span class="line">#+----+--------+</span><br><span class="line">#+----+--------+---------+</span><br><span class="line">#| id | name   | dept_id |</span><br><span class="line">#+----+--------+---------+</span><br><span class="line">#|  1 | å¥¥å·´é©¬ |       1 |</span><br><span class="line">#|  2 | æ‹œç™»   |       3 |</span><br><span class="line">#|  3 | æ—è‚¯   |       4 |</span><br><span class="line">#|  4 | ç‰¹æœ—æ™® |       4 |</span><br><span class="line">#|  5 | å…‹æ—é¡¿ |       6 |</span><br><span class="line">#+----+--------+---------+</span><br><span class="line"></span><br><span class="line"># ç¬›å¡å°”ç§¯æŸ¥è¯¢  -&gt; ä¸¤å¼ è¡¨ç›¸ä¹˜çš„ç»“æœ</span><br><span class="line">SELECT * FROM dept, emp;   </span><br><span class="line"></span><br><span class="line"># å†…è¿æ¥æŸ¥è¯¢    -&gt; æŸ¥è¯¢ä¸¤å¼ è¡¨éƒ½æœ‰çš„è®°å½•</span><br><span class="line">SELECT * FROM dept, emp WHERE dept.id &#x3D; emp.dept_id;</span><br><span class="line">SELECT * FROM dept INNER JOIN emp ON dept.id &#x3D; emp.dept_id;</span><br><span class="line"></span><br><span class="line"># å·¦å¤–è¿æ¥æŸ¥è¯¢  -&gt; åœ¨å†…è¿æ¥çš„åŸºç¡€ä¸Šå¢åŠ å·¦æœ‰å³æ— çš„è®°å½•</span><br><span class="line">SELECT * FROM dept LEFT JOIN emp ON dept.id &#x3D; emp.dept_id;</span><br><span class="line"></span><br><span class="line"># å·¦å¤–è¿æ¥æŸ¥è¯¢  -&gt; åœ¨å†…è¿æ¥çš„åŸºç¡€ä¸Šå¢åŠ å³æœ‰å·¦æ— çš„è®°å½•</span><br><span class="line">SELECT * FROM dept RIGHT JOIN emp ON dept.id &#x3D; emp.dept_id;</span><br><span class="line"></span><br><span class="line"># å…¨å¤–è¿æ¥æŸ¥è¯¢   mysql #ä¸æ”¯æŒ#</span><br><span class="line">SELECT * FROM dept FULL JOIN emp ON dept.id &#x3D; emp.dept_id;</span><br><span class="line"></span><br><span class="line"># å…¨å¤–è¿æ¥æŸ¥è¯¢  mysql æ–¹å¼ åˆ©ç”¨ union æ“ä½œ</span><br><span class="line">SELECT * FROM dept LEFT JOIN emp ON dept.id &#x3D; emp.dept_id</span><br><span class="line">union</span><br><span class="line">SELECT * FROM dept RIGHT JOIN emp ON dept.id &#x3D; emp.dept_id;</span><br><span class="line"></span><br><span class="line"># æŸ¥è¯¢ dept_id &#x3D; 4 çš„éƒ¨é—¨åç§°å’Œå…¶ä¸­çš„å‘˜å·¥çš„å§“åï¼ˆåŒ…å«idï¼‰</span><br><span class="line">SELECT * FROM dept INNER JOIN emp ON dept.id &#x3D; emp.dept_id WHERE dept.id &#x3D; 4;</span><br><span class="line"></span><br><span class="line"># æŸ¥è¯¢ dept_id &#x3D; 4 çš„éƒ¨é—¨åç§°å’Œå…¶ä¸­çš„å‘˜å·¥çš„å§“åï¼ˆä¸åŒ…å«idï¼‰</span><br><span class="line">SELECT dept.name AS éƒ¨é—¨, emp.name AS å§“å FROM dept INNER JOIN emp ON dept.id &#x3D; emp.dept_id WHERE dept.id &#x3D; 4;</span><br></pre></td></tr></table></figure><h4 id="5-4-å­æŸ¥è¯¢"><a class="header-anchor" href="#5-4-å­æŸ¥è¯¢">Â¶</a>5.4 å­æŸ¥è¯¢</h4><h5 id="5-4-1-å¸¦-in-å…³é”®å­—çš„å­æŸ¥è¯¢"><a class="header-anchor" href="#5-4-1-å¸¦-in-å…³é”®å­—çš„å­æŸ¥è¯¢">Â¶</a>5.4.1 å¸¦ in å…³é”®å­—çš„å­æŸ¥è¯¢</h5><p><em>ä½¿ç”¨ in å…³é”®å­—è¿›è¡Œå­æŸ¥è¯¢æ—¶ï¼Œå†…å±‚æŸ¥è¯¢è¯­å¥ä»…ä»…è¿”å›ä¸€ä¸ªæ•°æ®åˆ—ï¼Œè¿™ä¸ªæ•°æ®åˆ—ä¸­çš„å€¼å°†ä¾›å¤–å±‚æŸ¥è¯¢è¯­å¥è¿›è¡Œæ¯”è¾ƒæ“ä½œã€‚</em></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># å»ºç«‹è¡¨æ ¼</span><br><span class="line">CREATE TABLE department (</span><br><span class="line">	did INT,</span><br><span class="line">    dname VARCHAR(50)</span><br><span class="line">);</span><br><span class="line">INSERT INTO department VALUES(1,&#39;ç½‘ç»œéƒ¨&#39;),(2,&#39;åª’ä½“éƒ¨&#39;),(3,&#39;ç ”å‘éƒ¨&#39;),(5,&#39;äººäº‹éƒ¨&#39;);</span><br><span class="line"></span><br><span class="line">#+------+--------+</span><br><span class="line">#| did  | dname  |</span><br><span class="line">#+------+--------+</span><br><span class="line">#|    1 | ç½‘ç»œéƒ¨ |</span><br><span class="line">#|    2 | åª’ä½“éƒ¨ |</span><br><span class="line">#|    3 | ç ”å‘éƒ¨ |</span><br><span class="line">#|    5 | äººäº‹éƒ¨ |</span><br><span class="line">#+------+--------+</span><br><span class="line"></span><br><span class="line">CREATE TABLE employee (</span><br><span class="line">	id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">    name VARCHAR(50),</span><br><span class="line">    age INT,</span><br><span class="line">    did INT</span><br><span class="line">);</span><br><span class="line">INSERT INTO employee VALUES(NULL, &#39;å¼ ä¸‰&#39;, 20, 1),(NULL, &#39;æå››&#39;, 22, 1),(NULL, &#39;ç‹äº”&#39;, 20, 2),(NULL, &#39;åˆ˜å…­&#39;, 20, 4);</span><br><span class="line"></span><br><span class="line">#+----+------+------+------+</span><br><span class="line">#| id | name | age  | did  |</span><br><span class="line">#+----+------+------+------+</span><br><span class="line">#|  1 | å¼ ä¸‰ |   20 |    1 |</span><br><span class="line">#|  2 | æå›› |   22 |    1 |</span><br><span class="line">#|  3 | ç‹äº” |   20 |    2 |</span><br><span class="line">#|  4 | åˆ˜å…­ |   20 |    4 |</span><br><span class="line">#+----+------+------+------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># æŸ¥è¯¢å­˜åœ¨å¹´é¾„ä¸º20çš„å‘˜å·¥çš„éƒ¨é—¨</span><br><span class="line"></span><br><span class="line"># 1. æŸ¥è¯¢å¹´é¾„ä¸º20çš„å‘˜å·¥ä¿¡æ¯</span><br><span class="line">SELECT did FROM employee WHERE age &#x3D; 20;</span><br><span class="line"># 2. æŸ¥è¯¢ä»–ä»¬çš„éƒ¨é—¨,å°† 1 ä½œä¸ºåµŒå¥—è¯­å¥</span><br><span class="line">SELECT dname FROM department WHERE did IN (SELECT did FROM employee WHERE age &#x3D; 20);</span><br></pre></td></tr></table></figure><h5 id="5-4-2-å¸¦-not-in-å…³é”®å­—çš„å­æŸ¥è¯¢"><a class="header-anchor" href="#5-4-2-å¸¦-not-in-å…³é”®å­—çš„å­æŸ¥è¯¢">Â¶</a>5.4.2 å¸¦ not in å…³é”®å­—çš„å­æŸ¥è¯¢</h5><p><em>ä¸ in å…³é”®è¯ ç›¸å</em></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># æŸ¥è¯¢å­˜åœ¨å¹´é¾„ä¸æ˜¯20çš„å‘˜å·¥çš„éƒ¨é—¨</span><br><span class="line"></span><br><span class="line"># 1. æŸ¥è¯¢å¹´é¾„ä¸º20çš„å‘˜å·¥ä¿¡æ¯</span><br><span class="line">SELECT did FROM employee WHERE age &#x3D; 20;</span><br><span class="line"># 2. æŸ¥è¯¢ä»–ä»¬çš„éƒ¨é—¨,å°† 1 ä½œä¸ºåµŒå¥—è¯­å¥</span><br><span class="line">SELECT dname FROM department WHERE did NOT IN (SELECT did FROM employee WHERE age &#x3D; 20);</span><br></pre></td></tr></table></figure><h5 id="5-4-3-å¸¦-exists-å…³é”®å­—çš„å­æŸ¥è¯¢"><a class="header-anchor" href="#5-4-3-å¸¦-exists-å…³é”®å­—çš„å­æŸ¥è¯¢">Â¶</a>5.4.3 å¸¦ exists å…³é”®å­—çš„å­æŸ¥è¯¢</h5><p><em>å…³é”®è¯åé¢çš„å‚æ•°å¯ä»¥æ—¶ä»»æ„ä¸€ä¸ªå­æŸ¥è¯¢ï¼Œè¿™ä¸ªå­æŸ¥è¯¢çš„ä½œç”¨ç›¸å½“äºæµ‹è¯•ï¼Œä»–ä¸äº§ç”Ÿä»»ä½•æ•°æ®ï¼Œåªè¿”å› TRUE , FALSEã€‚</em></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># æŸ¥è¯¢employeeä¸­æ˜¯å¦æœ‰å¹´é¾„å¤§äº20çš„å‘˜å·¥ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™æŸ¥è¯¢departmentè¡¨ä¸­çš„æ‰€æœ‰è®°å½•</span><br><span class="line"></span><br><span class="line"># 1. æŸ¥è¯¢å¹´é¾„å¤§äº20çš„å‘˜å·¥</span><br><span class="line">SELECT * FROM employee WHERE age &gt; 20;</span><br><span class="line"># 2. åµŒå¥—</span><br><span class="line">SELECT * FROM department WHERE EXISTS (SELECT * FROM employee WHERE age &gt; 20);</span><br></pre></td></tr></table></figure><h5 id="5-4-4-å¸¦-any-å…³é”®å­—çš„å­æŸ¥è¯¢"><a class="header-anchor" href="#5-4-4-å¸¦-any-å…³é”®å­—çš„å­æŸ¥è¯¢">Â¶</a>5.4.4 å¸¦ any å…³é”®å­—çš„å­æŸ¥è¯¢</h5><p><em>any å…³é”®å­—è¡¨ç¤ºæ»¡è¶³å…¶ä¸­ä»»æ„ä¸€ä¸ªæ¡ä»¶ï¼Œå®ƒå…è®¸åˆ›å»ºä¸€ä¸ªè¡¨è¾¾å¼å¯¹å­æŸ¥è¯¢çš„è¿”å›å€¼åˆ—è¡¨è¿›è¡Œæ¯”è¾ƒï¼Œåªè¦æ»¡è¶³å†…å±‚å­æŸ¥è¯¢ä¸­çš„ä»»æ„ä¸€ä¸ªæ¯”è¾ƒæ¡ä»¶ï¼Œå°±è¿”å›ä¸€ä¸ªç»“æœä½œä¸ºæŸ¥è¯¢æ¡ä»¶ã€‚</em></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># æŸ¥è¯¢ department.did &gt; employee.did çš„éƒ¨é—¨åç§°</span><br><span class="line"># 1. æŸ¥è¯¢ employee æ‰€æœ‰ did</span><br><span class="line">SELECT did FROM employee;</span><br><span class="line"># 2. åµŒå¥—æ¯”è¾ƒ</span><br><span class="line">SELECT * FROM department WHERE did &gt; ANY(SELECT did FROM employee);</span><br></pre></td></tr></table></figure><h5 id="5-4-5-å¸¦-all-å…³é”®å­—çš„å­æŸ¥è¯¢"><a class="header-anchor" href="#5-4-5-å¸¦-all-å…³é”®å­—çš„å­æŸ¥è¯¢">Â¶</a>5.4.5 å¸¦ all å…³é”®å­—çš„å­æŸ¥è¯¢</h5><p><em>ç›¸è¾ƒäº any éœ€è¦æ»¡è¶³æ‰€æœ‰æ¡ä»¶</em></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># æŸ¥è¯¢ department.did &gt; æ‰€æœ‰ employee.did çš„éƒ¨é—¨åç§°</span><br><span class="line"># 1. æŸ¥è¯¢ employee æ‰€æœ‰ did</span><br><span class="line">SELECT did FROM employee;</span><br><span class="line"># 2. åµŒå¥—æ¯”è¾ƒ</span><br><span class="line">SELECT * FROM department WHERE did &gt; ALL(SELECT did FROM employee);</span><br></pre></td></tr></table></figure><h5 id="5-4-6-å¸¦æ¯”è¾ƒè¿ç®—ç¬¦çš„å­æŸ¥è¯¢"><a class="header-anchor" href="#5-4-6-å¸¦æ¯”è¾ƒè¿ç®—ç¬¦çš„å­æŸ¥è¯¢">Â¶</a>5.4.6 å¸¦æ¯”è¾ƒè¿ç®—ç¬¦çš„å­æŸ¥è¯¢</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># æŸ¥è¯¢ ç‹äº” æ˜¯å“ªä¸ªéƒ¨é—¨</span><br><span class="line"># 1. æŸ¥è¯¢ç‹äº”çš„did</span><br><span class="line">SELECT did FROM employee WHERE name &#x3D; &#39;ç‹äº”&#39;;</span><br><span class="line"># 2. åµŒå¥—æ¯”è¾ƒ</span><br><span class="line">SELECT dname FROM department WHERE did &#x3D; (SELECT did FROM employee WHERE name &#x3D; &#39;ç‹äº”&#39;);</span><br></pre></td></tr></table></figure><h3 id="6-äº‹åŠ¡"><a class="header-anchor" href="#6-äº‹åŠ¡">Â¶</a>6 äº‹åŠ¡</h3><h4 id="6-1-äº‹åŠ¡æ§åˆ¶"><a class="header-anchor" href="#6-1-äº‹åŠ¡æ§åˆ¶">Â¶</a>6.1 äº‹åŠ¡æ§åˆ¶</h4><h5 id="6-1-1-åŸºæœ¬æ¦‚å¿µ"><a class="header-anchor" href="#6-1-1-åŸºæœ¬æ¦‚å¿µ">Â¶</a>6.1.1 åŸºæœ¬æ¦‚å¿µ</h5><p>äº‹åŠ¡ï¼šé€»è¾‘ä¸Šçš„ä¸€ç»„æ“ä½œï¼Œè¦ä¹ˆåŒæ—¶å®Œæˆè¦ä¹ˆåŒæ—¶ä¸å®Œæˆ</p><p>mysql é»˜è®¤å°±è‡ªå¸¦äº‹åŠ¡ï¼Œä½†æ˜¯mysqlè‡ªå¸¦çš„äº‹åŠ¡æ˜¯ä¸€æ¡è¯­å¥ç‹¬å ä¸€ä¸ªäº‹åŠ¡</p><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±æ¥é€šçŸ¥äº‹åŠ¡ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">START TRANSACTION;  #å¼€å¯äº‹åŠ¡</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">COMMIT;   # æäº¤äº‹åŠ¡</span><br><span class="line">ROLLBACK; # å›æ»šäº‹åŠ¡ï¼Œä¹Ÿå°±æ˜¯å–æ¶ˆä¸Šè¿° (æ”¾åœ¨äº‹åŠ¡å†…éƒ¨...åé¢)</span><br><span class="line"></span><br><span class="line">CREATE TABLE account (</span><br><span class="line">	id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">    name VARCHAR(20),</span><br><span class="line">    money DOUBLE</span><br><span class="line">);</span><br><span class="line">INSERT INTO account VALUES(NULL,&#39;A&#39;,1000),(NULL,&#39;B&#39;,1200);</span><br><span class="line"></span><br><span class="line">## è½¬è´¦ ##</span><br><span class="line"># æ–¹å¼ä¸€</span><br><span class="line">UPDATE account SET money &#x3D; money - 100 WHERE name &#x3D; &#39;A&#39;;</span><br><span class="line"># å¦‚æœä¸åœ¨äº‹åŠ¡é‡Œé¢ï¼Œç¬¬ä¸€æ¡è¿è¡Œï¼Œç¬¬äºŒæ¡å¤±è´¥ä¼šå¯¼è‡´è½¬è´¦å‡ºç°é—®é¢˜</span><br><span class="line">UPDATE account SET money &#x3D; money + 100 WHERE name &#x3D; &#39;B&#39;; </span><br><span class="line"></span><br><span class="line"># æ–¹å¼äºŒ</span><br><span class="line"></span><br><span class="line">START TRANSACTION;  #å¼€å¯äº‹åŠ¡</span><br><span class="line">UPDATE account SET money &#x3D; money - 100 WHERE name &#x3D; &#39;A&#39;;</span><br><span class="line">UPDATE account SET money &#x3D; money + 100 WHERE name &#x3D; &#39;B&#39;; </span><br><span class="line">COMMIT;   # æäº¤äº‹åŠ¡</span><br></pre></td></tr></table></figure><h5 id="6-1-2-äº‹åŠ¡çš„ç‰¹æ€§-ACID"><a class="header-anchor" href="#6-1-2-äº‹åŠ¡çš„ç‰¹æ€§-ACID">Â¶</a>6.1.2 äº‹åŠ¡çš„ç‰¹æ€§ ACID</h5><p><strong>åŸå­æ€§ï¼š</strong>(Atomicity)</p><ul><li>äº‹åŠ¡æ˜¯ä¸€ç»„ä¸å¯åˆ†å‰²çš„å•ä½ï¼Œè¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ã€‚</li></ul><p><strong>ä¸€è‡´æ€§ï¼š</strong>(Consistency)</p><ul><li>äº‹åŠ¡å‰åçš„æ•°æ®å®Œæ•´æ€§åº”è¯¥ä¿æŒä¸€è‡´ã€‚ï¼ˆæ•°æ®åº“çš„å®Œæ•´æ€§ï¼šå¦‚æœäº‹åŠ¡åœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸‹ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½ç¬¦åˆæ‰€æœ‰çš„çº¦æŸï¼Œåˆ™ç§°æ•°æ®åº“ä¸ºç¬¦åˆå®Œæ•´æ€§çš„çŠ¶æ€ï¼‰ ä¹Ÿå°±æ˜¯è¯´æ•°æ®åº“ä¸­çš„æ•°æ®å¹¶ä¸ä¼šå› ä¸ºæ‰§è¡Œäº†ä¸€åŠè€Œå¯¼è‡´ä¸åŒã€‚</li></ul><p><strong>éš”ç¦»æ€§ï¼š</strong>(Isolation)</p><ul><li>å¤šä¸ªç”¨æˆ·å¹¶å‘è®¿é—®æ•°æ®åº“æ—¶ï¼Œä¸€ä¸ªç”¨æˆ·çš„äº‹åŠ¡ä¸èƒ½è¢«å…¶ä»–ç”¨æˆ·çš„äº‹ç‰©æ‰€å¹²æ‰°ï¼Œå¤šä¸ªå¹¶å‘äº‹åŠ¡ä¹‹é—´æ•°æ®è¦ç›¸äº’éš”ç¦»ã€‚</li></ul><p><strong>æŒä¹…æ€§ï¼š</strong>(Durability)</p><ul><li>ä¸€ä¸ªäº‹åŠ¡ä¸€æ—¦è¢«æäº¤ï¼Œä»–å¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜å°±æ˜¯æ°¸ä¹…æ€§çš„ï¼Œæ¥ä¸‹æ¥å³ä½¿æ•°æ®åº“å‘ç”Ÿæ•…éšœä¹Ÿä¸åº”è¯¥å¯¹å…¶æœ‰ä»»ä½•å½±å“ã€‚ï¼ˆä¹Ÿå°±æ˜¯ commit å ä¸èƒ½ rollbackï¼‰</li></ul><h5 id="6-1-3-äº‹åŠ¡çš„éš”ç¦»çº§åˆ«"><a class="header-anchor" href="#6-1-3-äº‹åŠ¡çš„éš”ç¦»çº§åˆ«">Â¶</a>6.1.3 äº‹åŠ¡çš„éš”ç¦»çº§åˆ«</h5><p>éš”ç¦»æ€§ï¼šæœ¬è´¨å°±æ˜¯å¤šä¸ªçº¿ç¨‹æ“ä½œåŒä¸€ä¸ªèµ„æºæ—©æˆçš„å¤šçº¿ç¨‹å¹¶å‘å®‰å…¨é—®é¢˜ã€‚åŠ é”å¯ä»¥å®Œç¾ä¿è¯éš”ç¦»æ€§ï¼Œä½†æ˜¯å½±å“æ€§èƒ½ã€‚</p><p><strong>ä¸¤ä¸ªäº‹åŠ¡å¹¶å‘çš„ä¿®æ”¹</strong>ï¼š<em>å¿…é¡»éš”ç¦»</em></p><p><strong>ä¸¤ä¸ªäº‹åŠ¡å¹¶å‘çš„æŸ¥è¯¢</strong>ï¼š<em>å®Œå…¨ä¸ç”¨éš”ç¦»</em></p><p><strong>ä¸€ä¸ªäº‹åŠ¡ä¿®æ”¹ï¼Œä¸€ä¸ªäº‹åŠ¡æŸ¥è¯¢</strong>ï¼šï¼Ÿ</p><p>ï¼ˆè„è¯»ï¼šä¸€ä¸ªäº‹åŠ¡è¯»å–åˆ°å¦ä¸€ä¸ªäº‹åŠ¡<strong>æœªæäº¤</strong>çš„æ•°æ®ï¼‰</p><p>ï¼ˆä¸å¯é‡å¤è¯»ï¼šä¸€ä¸ªäº‹åŠ¡å¤šæ¬¡è¯»å–<strong>åŒä¸€æ¡è®°å½•</strong>ï¼Œè¯»å–çš„ç»“æœä¸ç›¸åŒï¼‰</p><p>ï¼ˆè™šè¯»ï¼Œå¹»è¯»ï¼šä¸€ä¸ªäº‹åŠ¡å¤šæ¬¡æŸ¥è¯¢<strong>æ•´è¡¨çš„æ•°æ®</strong>ï¼Œç”±äºå…¶ä»–äº‹åŠ¡æ–°å¢ï¼ˆåˆ é™¤ï¼‰è®°å½•é€ æˆå¤šæ¬¡æŸ¥è¯¢å‡ºçš„è®°å½•æ¡æ•°ä¸åŒï¼‰</p><p>å››å¤§éš”ç¦»çº§åˆ«ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">READ UNCOMMITTED;   # ä¸åšä»»ä½•éš”ç¦»é—®é¢˜</span><br><span class="line"></span><br><span class="line">READ COMMITTED;		# å¯ä»¥é˜²æ­¢è„è¯»</span><br><span class="line"></span><br><span class="line">REPEATABLE READ;    # å¯ä»¥é˜²æ­¢ è„è¯» ä¸å¯é‡å¤è¯»   mysql é»˜è®¤</span><br><span class="line"></span><br><span class="line">SERIALIZABLE;       # æ•°æ®åº“è¿è¡Œåœ¨ä¸²è¡ŒåŒ–ä¸ºå®ç° è§£å†³æ‰€æœ‰é—®é¢˜ï¼Œå•æ€§èƒ½ä½</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SET [SESSION &#x2F; GLOBAL] TRANSACTION ISOLATION LEVEL ...; # ä¿®æ”¹éš”ç¦»çº§åˆ«</span><br><span class="line">SELECT @@TRANSACTION_ISOLATION;  # æŸ¥è¯¢å½“å‰æ•°æ®åº“çš„éš”ç¦»çº§åˆ«</span><br></pre></td></tr></table></figure><h4 id="6-2-å­˜å‚¨è¿‡ç¨‹çš„åˆ›å»º"><a class="header-anchor" href="#6-2-å­˜å‚¨è¿‡ç¨‹çš„åˆ›å»º">Â¶</a>6.2 å­˜å‚¨è¿‡ç¨‹çš„åˆ›å»º</h4><p>å­˜å‚¨è¿‡ç¨‹ç±»ä¼¼äºä¸€ä¸ªå‡½æ•°ã€‚</p><p>åˆ›å»ºå­˜å‚¨è¿‡ç¨‹</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># åˆ›å»ºè¡¨</span><br><span class="line">CREATE DATABASE chapter06ï¼›</span><br><span class="line">USE chapter06;</span><br><span class="line">CREATE TABLE student(</span><br><span class="line">	id INT(3) PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">    name VARCHAR(20) NOT NULL,</span><br><span class="line">    grade FLOAT,</span><br><span class="line">    gender CHAR(2)</span><br><span class="line">);</span><br><span class="line">INSERT INTO student(name, grade, gender) VALUES(&#39;tom&#39;, 60, &#39;ç”·&#39;),(&#39;jack&#39;, 70, &#39;ç”·&#39;),(&#39;rose&#39;, 90, &#39;å¥³&#39;),(&#39;lucy&#39;, 100, &#39;å¥³&#39;);</span><br><span class="line"></span><br><span class="line">#+----+------+-------+--------+</span><br><span class="line">#| id | name | grade | gender |</span><br><span class="line">#+----+------+-------+--------+</span><br><span class="line">#|  1 | tom  |    60 | ç”·     |</span><br><span class="line">#|  2 | jack |    70 | ç”·     |</span><br><span class="line">#|  3 | rose |    90 | å¥³     |</span><br><span class="line">#|  4 | lucy |   100 | å¥³     |</span><br><span class="line">#+----+------+-------+--------+</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºæŸ¥çœ‹studentè¡¨çš„å­˜å‚¨è¿‡ç¨‹</span><br><span class="line"></span><br><span class="line"># å°† mysql ç»“æŸè¯­å¥æ”¹ä¸º &#x2F;&#x2F;</span><br><span class="line">DELIMITER &#x2F;&#x2F; </span><br><span class="line">CREATE PROCEDURE Proc()</span><br><span class="line">BEGIN</span><br><span class="line">	SELECT * FROM student;</span><br><span class="line">END &#x2F;&#x2F;</span><br><span class="line"># å­˜å‚¨è¿‡ç¨‹ç»“æŸä¹‹åå°†åˆ†å·æ”¹å›æ¥</span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line">CALL Proc; # ä½¿ç”¨</span><br><span class="line"></span><br><span class="line">DROP PROCEDURE Proc; # åˆ é™¤</span><br></pre></td></tr></table></figure><h4 id="6-3-å­˜å‚¨è¿‡ç¨‹çš„ä½¿ç”¨"><a class="header-anchor" href="#6-3-å­˜å‚¨è¿‡ç¨‹çš„ä½¿ç”¨">Â¶</a>6.3 å­˜å‚¨è¿‡ç¨‹çš„ä½¿ç”¨</h4><h5 id="6-3-1-å®šä¹‰ä¸€ä¸ªå˜é‡"><a class="header-anchor" href="#6-3-1-å®šä¹‰ä¸€ä¸ªå˜é‡">Â¶</a>6.3.1 å®šä¹‰ä¸€ä¸ªå˜é‡</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># æ³¨æ„ å˜é‡çš„å£°æ˜ä¸€å®šè¦åœ¨å­˜å‚¨è¿‡ç¨‹ä¸­ï¼Œä¸”ä½œç”¨åŸŸä¸ºå­˜å‚¨è¿‡ç¨‹</span><br><span class="line">DECLARE var_name[, varname]...date_type[DEFAULT value];</span><br><span class="line"></span><br><span class="line"># å®šä¹‰ä¸€ä¸ªåç§°ä¸º myvariable çš„å˜é‡ï¼Œç±»å‹ä¸º INT ç±»å‹ï¼Œé»˜è®¤å€¼ä¸º 100</span><br><span class="line">DECLARE my_name INT DEFAULT 100;  # æ²¡æœ‰åœ¨å­˜å‚¨è¿‡ç¨‹ä¸­</span><br><span class="line"></span><br><span class="line">DELIMITER &#x2F;&#x2F;</span><br><span class="line">CREATE PROCEDURE proc2() </span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE myvariable INT DEFAULT 100;</span><br><span class="line">	SELECT myvariable;</span><br><span class="line">END &#x2F;&#x2F;</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure><h5 id="6-3-2-ä¿®æ”¹ä¸€ä¸ªå˜é‡çš„å€¼"><a class="header-anchor" href="#6-3-2-ä¿®æ”¹ä¸€ä¸ªå˜é‡çš„å€¼">Â¶</a>6.3.2 ä¿®æ”¹ä¸€ä¸ªå˜é‡çš„å€¼</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># æ–¹å¼ä¸€ï¼š</span><br><span class="line">SET var_name &#x3D; expr[, var_name &#x3D; expr]...;</span><br><span class="line"></span><br><span class="line">DELIMITER &#x2F;&#x2F;</span><br><span class="line">CREATE PROCEDURE proc2() </span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE myvariable INT DEFAULT 100;</span><br><span class="line">	SET myvariable &#x3D; myvariavle + 20;</span><br><span class="line">	SELECT myvariable;</span><br><span class="line">END &#x2F;&#x2F;</span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"># æ–¹å¼äºŒï¼š</span><br><span class="line">SELECT col_name[...] INTO var_name[...] table_expr;</span><br><span class="line"></span><br><span class="line"># å®šä¹‰å˜é‡ï¼Œä¿å­˜å­¦ç”Ÿè¡¨ä¸­æŸ¥è¯¢åˆ°çš„ç­çº§ä¿¡æ¯å’Œæ€§åˆ«ä¿¡æ¯</span><br><span class="line">DELIMITER &#x2F;&#x2F;</span><br><span class="line">CREATE PROCEDURE proc2() </span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE s_grade FLOAT;</span><br><span class="line">	DECLARE s_gender CHAR(2);</span><br><span class="line">	SELECT grade, gender INTO s_grade, s_gender FROM student WHERE id &#x3D; 3;</span><br><span class="line">	SELECT s_grade, s_gender;</span><br><span class="line">END &#x2F;&#x2F;</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure><h5 id="6-3-3-å®šä¹‰æ¡ä»¶å’Œå¤„ç†ç¨‹åº"><a class="header-anchor" href="#6-3-3-å®šä¹‰æ¡ä»¶å’Œå¤„ç†ç¨‹åº">Â¶</a>6.3.3 å®šä¹‰æ¡ä»¶å’Œå¤„ç†ç¨‹åº</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># å®šä¹‰ä¸€ä¸ª ERROR1148(42000)é”™è¯¯ï¼Œåç§°ä¸º command_not_allowed</span><br><span class="line"></span><br><span class="line">DECLARE command_not_allowed CONDITION FOR SQLSTATE 42000;</span><br><span class="line"></span><br><span class="line">DECLARE command_not_allowed CONDITION FOR 1148;</span><br><span class="line"></span><br><span class="line"># å®šä¹‰å¤„ç†ç¨‹åº</span><br><span class="line">DECLARE handler_type HANDLER FRO condition_value[,...] sp_statement</span><br><span class="line"># handler_type:</span><br><span class="line">CONTINUE, EXIT, UNDO</span><br><span class="line">#condition_value:</span><br><span class="line">	SQLSTATE[VALUE]</span><br><span class="line">	condition_name</span><br><span class="line">	SQLWARNING   #åŒ¹é…æ‰€æœ‰01å¼€å¤´çš„SQLSTATEé”™è¯¯ä»£ç </span><br><span class="line">	NOT FOUND    #åŒ¹é…æ‰€æœ‰02å¼€å¤´çš„SQLSTATEé”™è¯¯ä»£ç </span><br><span class="line">	SQLEXCEPTION #å…¶ä»–</span><br><span class="line">	mysql_error_code</span><br></pre></td></tr></table></figure><h5 id="6-3-4-å…‰æ ‡ï¼ˆæ¸¸æ ‡ï¼‰çš„ä½¿ç”¨"><a class="header-anchor" href="#6-3-4-å…‰æ ‡ï¼ˆæ¸¸æ ‡ï¼‰çš„ä½¿ç”¨">Â¶</a>6.3.4 å…‰æ ‡ï¼ˆæ¸¸æ ‡ï¼‰çš„ä½¿ç”¨</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">## å…‰æ ‡çš„å£°æ˜ ##</span><br><span class="line">DECLARE cursor_name CURSOR FOR select_statement</span><br><span class="line"># å£°æ˜ä¸€ä¸ªåä¸º cursor_student çš„å…‰æ ‡</span><br><span class="line">DECLARE cursor_student CURSOR FOR SELECT a_name, a_gender FROM student;</span><br><span class="line"></span><br><span class="line">## å…‰æ ‡çš„ä½¿ç”¨ ##</span><br><span class="line"># å…ˆæ‰“å¼€å…‰æ ‡</span><br><span class="line">	 OPEN cursor_name;</span><br><span class="line">	 FETCH cursor_name INTO var_name[...]... # è¿™é‡Œçš„å˜é‡è¦åœ¨æ¸¸æ ‡ä¹‹å‰å®šä¹‰å¥½ã€‚</span><br><span class="line"></span><br><span class="line"># ä½¿ç”¨åç§°ä¸º cursor_student çš„å…‰æ ‡ã€‚å°†æŸ¥è¯¢å‡ºæ¥çš„ä¿¡æ¯å­˜å…¥ s_name, s_gradeä¸­</span><br><span class="line">FETCH cursor_student INTO s_name, s_grade;</span><br><span class="line"></span><br><span class="line">## å…‰æ ‡çš„å…³é—­ ##</span><br><span class="line">CLOSE cursor_name;</span><br><span class="line"># å…³é—­åç§°ä¸º cursor_student çš„å…‰æ ‡ã€‚</span><br><span class="line">CLOSE cursor_student;</span><br></pre></td></tr></table></figure><h5 id="6-3-5-æµç¨‹æ§åˆ¶çš„ä½¿ç”¨"><a class="header-anchor" href="#6-3-5-æµç¨‹æ§åˆ¶çš„ä½¿ç”¨">Â¶</a>6.3.5 æµç¨‹æ§åˆ¶çš„ä½¿ç”¨</h5><h6 id="6-3-5-1-if-è¯­å¥"><a class="header-anchor" href="#6-3-5-1-if-è¯­å¥">Â¶</a>6.3.5.1 if è¯­å¥</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 1. if è¯­å¥</span><br><span class="line">IF expr_condition THEN statemen_list</span><br><span class="line">	[ELSEIF expr_condition THEN statement_list]..</span><br><span class="line">	[ELSE statement_list]</span><br><span class="line">END IF</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºä¸€ä¸ªå­˜å‚¨è¿‡ç¨‹åˆ¤æ–­å˜é‡ v æ˜¯å¦æ˜¯ä¸€ä¸ª null,è¾“å‡ºå¯¹åº”çš„æç¤ºä¿¡æ¯</span><br><span class="line"></span><br><span class="line">DELIMITER &#x2F;&#x2F;</span><br><span class="line">CREATE PROCEDURE proc4()</span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE v VARCHAR(2);</span><br><span class="line">	SET v &#x3D; &#39;a&#39;;</span><br><span class="line">	IF V IS NULL THEN SELECT &#39;IS NULL&#39;;</span><br><span class="line">	ELSE SELECT &#39;NOT NULL&#39;;</span><br><span class="line">	END IF;</span><br><span class="line">END &#x2F;&#x2F;</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure><h6 id="6-3-5-2-case-è¯­å¥"><a class="header-anchor" href="#6-3-5-2-case-è¯­å¥">Â¶</a>6.3.5.2 case è¯­å¥</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 2. case è¯­å¥</span><br><span class="line">CASE case_expr</span><br><span class="line">	WHEN when_value THEN statement_list</span><br><span class="line">	[WHEN when_value THEN statemen_list]...</span><br><span class="line">	[ELSE statement_list]</span><br><span class="line">END CASE;</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºå­˜å‚¨è¿‡ç¨‹</span><br><span class="line">DELIMITER &#x2F;&#x2F;</span><br><span class="line">CREATE PROCEDURE proc5()</span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE v INT;</span><br><span class="line">	SET v &#x3D; 1;</span><br><span class="line">	CASE v</span><br><span class="line">		WHEN 1 THEN SELECT &#39;VALUE IS 1&#39;;</span><br><span class="line">		WHEN 2 THEN SELECT &#39;VALUE IS 1&#39;;</span><br><span class="line">		ELSE SELECT &#39;IS NOT 1 OR 2&#39;;</span><br><span class="line">	END CASE;</span><br><span class="line">END &#x2F;&#x2F;</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure><h6 id="6-3-5-3-loop-è¯­å¥"><a class="header-anchor" href="#6-3-5-3-loop-è¯­å¥">Â¶</a>6.3.5.3 loop è¯­å¥</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 3. loop è¯­å¥</span><br><span class="line">[loop_lable:] LOOP STATEMENT_LIST END [loop_lable]</span><br><span class="line"></span><br><span class="line">DELIMITER &#x2F;&#x2F;</span><br><span class="line">CREATE PROCEDURE proc6()</span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE id INT DEFAULT 0;</span><br><span class="line">	add_loop : LOOP</span><br><span class="line">		SET id &#x3D; id + 1;</span><br><span class="line">		IF id &gt;&#x3D; 10 THEN LEAVE add_loop; &#x2F;&#x2F; è·³å‡ºå¾ªç¯</span><br><span class="line">		END IF;</span><br><span class="line">		SELECT id;</span><br><span class="line">	END LOOP add_loop;</span><br><span class="line">END &#x2F;&#x2F;</span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line">LEAVE # è·³å‡ºå¾ªç¯  break</span><br><span class="line">ITERATE # å†æ¬¡å¾ªç¯ contionue</span><br><span class="line"></span><br><span class="line"># æ¡ˆä¾‹</span><br><span class="line">DELIMITER &#x2F;&#x2F;</span><br><span class="line">CREATE PROCEDURE doiterate()</span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE p1 INT DEFAULT 0;</span><br><span class="line">	my_loop : LOOP</span><br><span class="line">		SET p1 &#x3D; p1 + 1;</span><br><span class="line">		IF p1 &lt; 10 THEN ITERATE my_loop;</span><br><span class="line">		ELSE IF p1 &gt; 20 THEN LEAVE my_loop;</span><br><span class="line">		END IF;</span><br><span class="line">		SELECT &#39;p1 is between 10 and 20&#39;;</span><br><span class="line">	END LOOP my_loop;</span><br><span class="line">END &#x2F;&#x2F;</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure><h6 id="6-3-5-4-repeat-è¯­å¥-while-è¯­å¥"><a class="header-anchor" href="#6-3-5-4-repeat-è¯­å¥-while-è¯­å¥">Â¶</a>6.3.5.4 repeat è¯­å¥ while è¯­å¥</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># æ¡ˆä¾‹ repeat</span><br><span class="line">DELIMITER &#x2F;&#x2F;</span><br><span class="line">CREATE PROCEDURE proc7()</span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE p1 INT DEFAULT 0;</span><br><span class="line">	REPEAT</span><br><span class="line">		SET p1 &#x3D; p1 + 1;</span><br><span class="line">		UNTIL p1 &gt;&#x3D; 10;</span><br><span class="line">	END REPEAT;</span><br><span class="line">END &#x2F;&#x2F;</span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># æ¡ˆä¾‹ while</span><br><span class="line">DELIMITER &#x2F;&#x2F;</span><br><span class="line">CREATE PROCEDURE proc8()</span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE p1 INT DEFAULT 0;</span><br><span class="line">	WHILE P1 &lt; 10 DO</span><br><span class="line">		SET p1 &#x3D; p1 + 1;</span><br><span class="line">		SELECT p1;</span><br><span class="line">	END WHILE;</span><br><span class="line">END &#x2F;&#x2F;</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure><h4 id="6-4-æ“ä½œå­˜å‚¨è¿‡ç¨‹"><a class="header-anchor" href="#6-4-æ“ä½œå­˜å‚¨è¿‡ç¨‹">Â¶</a>6.4 æ“ä½œå­˜å‚¨è¿‡ç¨‹</h4><h5 id="6-4-1-æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹"><a class="header-anchor" href="#6-4-1-æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹">Â¶</a>6.4.1 æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">CALL SP_NAME(parameter...);</span><br><span class="line"></span><br><span class="line"># æ¡ˆä¾‹</span><br><span class="line">DELIMITER &#x2F;&#x2F;</span><br><span class="line">CREATE PROCEDURE proc01(IN s_gender VARCHAR(50), OUT num INT)</span><br><span class="line">BEGIN</span><br><span class="line">	SELECT COUNT(*) INTO num FROM student WHERE gender &#x3D; s_gender;</span><br><span class="line">END &#x2F;&#x2F;</span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"># æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹</span><br><span class="line">CALL proc01(&quot;f&quot;,@num);</span><br><span class="line"># æŸ¥çœ‹ num</span><br><span class="line">SELECT @num</span><br></pre></td></tr></table></figure><h5 id="6-4-2-æŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹"><a class="header-anchor" href="#6-4-2-æŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹">Â¶</a>6.4.2 æŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SHOW PROCEDURE STATUS;</span><br><span class="line">SHOW PROCEDURE STATUS LIKE &#39;%2&#39;;</span><br><span class="line">SHOW CREATE PROCEDURE PROC4;</span><br><span class="line"># æŸ¥è¯¢ information_schema.routines è¡¨ä¸­æŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹çš„ä¿¡æ¯</span><br><span class="line">SELECT * FROM information_schema.Routinesï¼›</span><br></pre></td></tr></table></figure><h4 id="6-5-ä¿®æ”¹å­˜å‚¨è¿‡ç¨‹"><a class="header-anchor" href="#6-5-ä¿®æ”¹å­˜å‚¨è¿‡ç¨‹">Â¶</a>6.5 ä¿®æ”¹å­˜å‚¨è¿‡ç¨‹</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># å¯ä»¥ä¿®æ”¹å­˜å‚¨è¿‡ç¨‹çš„ç‰¹æ€§ï¼Œä½†æ˜¯ä¸èƒ½ä¿®æ”¹å­˜å‚¨è¿‡ç¨‹çš„å†…å®¹</span><br><span class="line"># å¦‚æœè¦ä¿®æ”¹å†…å®¹ï¼Œå…ˆåˆ é™¤åœ¨é‡æ–°åˆ›å»º</span><br></pre></td></tr></table></figure><h4 id="6-6-åˆ é™¤å­˜å‚¨è¿‡ç¨‹"><a class="header-anchor" href="#6-6-åˆ é™¤å­˜å‚¨è¿‡ç¨‹">Â¶</a>6.6 åˆ é™¤å­˜å‚¨è¿‡ç¨‹</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">DROP PROCEDURE sp_name;</span><br></pre></td></tr></table></figure><h3 id="7-è§†å›¾"><a class="header-anchor" href="#7-è§†å›¾">Â¶</a>7 è§†å›¾</h3><h4 id="7-1-åˆ›å»ºè§†å›¾"><a class="header-anchor" href="#7-1-åˆ›å»ºè§†å›¾">Â¶</a>7.1 åˆ›å»ºè§†å›¾</h4><h5 id="7-1-1-åœ¨å•è¡¨ä¸Šåˆ›å»ºè§†å›¾"><a class="header-anchor" href="#7-1-1-åœ¨å•è¡¨ä¸Šåˆ›å»ºè§†å›¾">Â¶</a>7.1.1 åœ¨å•è¡¨ä¸Šåˆ›å»ºè§†å›¾</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># åˆ›å»ºå•è¡¨ in chapter07 æ•°æ®åº“</span><br><span class="line"></span><br><span class="line">CREATE TABLE student(</span><br><span class="line">	s_id INT(3),</span><br><span class="line">    name VARCHAR(20),</span><br><span class="line">    math FLOAT,</span><br><span class="line">    chinese FLOAT</span><br><span class="line">);</span><br><span class="line">INSERT INTO student VALUES(1, &#39;TOM&#39;, 80, 78),(2, &#39;JACK&#39;, 70, 80),(3, &#39;LUCY&#39;, 97, 95);</span><br><span class="line">#+------+------+------+---------+</span><br><span class="line">#| s_id | name | math | chinese |</span><br><span class="line">#+------+------+------+---------+</span><br><span class="line">#|    1 | TOM  |   80 |      78 |</span><br><span class="line">#|    2 | JACK |   70 |      80 |</span><br><span class="line">#|    3 | LUCY |   97 |      95 |</span><br><span class="line">#+------+------+------+---------+</span><br><span class="line"></span><br><span class="line"># åˆ›å»º student è¡¨çš„è§†å›¾ï¼Œä¿å­˜æ•°å­¦æˆç»©ï¼Œè¯­æ–‡æˆç»©ï¼Œæ€»æˆç»©</span><br><span class="line">CREATE VIEW view_stu AS SELECT math, chinese FROM student;</span><br><span class="line"># å¯æ›¿ä»£</span><br><span class="line">CREATE (OR REPLEASE) VIEW view_stu AS SELECT math, chinese, math + chinese FROM student;</span><br><span class="line">SELECT * FORM view_stu;</span><br><span class="line"></span><br><span class="line"># æ·»åŠ åˆ«å (å¯é€‰åˆ—å)</span><br><span class="line">CREATE VIEW view_stu2 (æ•°å­¦,è¯­æ–‡,æ€»åˆ†) AS SELECT math, chinese, math + chinese FROM student;</span><br><span class="line">SELECT * FroM view_stu2;</span><br></pre></td></tr></table></figure><p><strong>7.1.2 åœ¨å¤šè¡¨ä¸Šåˆ›å»ºè§†å›¾</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># åœ¨åˆ›å»ºä¸€å¼ è¡¨æ ¼</span><br><span class="line">CREATE TABLE stu_info(</span><br><span class="line">	s_id INT(3),</span><br><span class="line">    class VARCHAR(50),</span><br><span class="line">	addr VARCHAR(50)</span><br><span class="line">);</span><br><span class="line">INSERT INTO stu_info VALUES(1, &#39;#2&#39;, &#39;202&#39;),(2, &#39;#3&#39;, &#39;203&#39;),(3, &#39;#1&#39;, &#39;201&#39;);</span><br><span class="line"></span><br><span class="line">#+------+-------+------+</span><br><span class="line">#| s_id | class | addr |</span><br><span class="line">#+------+-------+------+</span><br><span class="line">#|    1 | #2    | 202  |</span><br><span class="line">#|    2 | #3    | 203  |</span><br><span class="line">#|    3 | #1    | 201  |</span><br><span class="line">#+------+-------+------+</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºè§†å›¾åŒ…å« å­¦ç”Ÿçš„ç¼–å· å­¦ç”Ÿçš„å§“å ç­çº§åç§°</span><br><span class="line"></span><br><span class="line">CREATE VIEW stu_class (ç¼–å·, å­¦ç”Ÿ, ç­çº§) </span><br><span class="line">AS </span><br><span class="line">SELECT student.s_id,student.name,stu_info.class FROM student,stu_info WHERE student.s_id &#x3D; stu_info.s_id;</span><br></pre></td></tr></table></figure><h4 id="7-2-æŸ¥çœ‹è§†å›¾"><a class="header-anchor" href="#7-2-æŸ¥çœ‹è§†å›¾">Â¶</a>7.2 æŸ¥çœ‹è§†å›¾</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ä½¿ç”¨ describe   --- æŸ¥çœ‹è§†å›¾ç»“æ„</span><br><span class="line">DESCRIBE stu_class;</span><br><span class="line">DESC stu_class;</span><br><span class="line"></span><br><span class="line"># ä½¿ç”¨ SHOW TABLE STATUS LIKE &#39;è§†å›¾å&#39;  --- æŸ¥çœ‹è§†å›¾ä¿¡æ¯</span><br><span class="line">SHOW TABLE STATUS LIKE &#39;stu_class&#39;;</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹è§†å›¾çš„åˆ›å»ºè¯­å¥    --- æŸ¥çœ‹è§†å›¾çš„åˆ›å»ºè¯­å¥</span><br><span class="line">SHOW CREATE VIEW stu_class;</span><br></pre></td></tr></table></figure><h4 id="7-3-ä¿®æ”¹è§†å›¾"><a class="header-anchor" href="#7-3-ä¿®æ”¹è§†å›¾">Â¶</a>7.3 ä¿®æ”¹è§†å›¾</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 1. OR REPLACE è¦†ç›–</span><br><span class="line"># ä¿®æ”¹ view_stu</span><br><span class="line">CREATE OR REPLACE VIEW view_stu AS SELECT * FROM student;</span><br><span class="line"></span><br><span class="line"># 2. ä½¿ç”¨alterè¯­å¥</span><br><span class="line">ALTER VIEW view_stu AS SELECT Chinese FROM student;</span><br></pre></td></tr></table></figure><h4 id="7-4-æ›´æ–°è§†å›¾"><a class="header-anchor" href="#7-4-æ›´æ–°è§†å›¾">Â¶</a>7.4 æ›´æ–°è§†å›¾</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># æ›´æ–°è§†å›¾ä¼šå¯¼è‡´åŸºæœ¬è¡¨ä¸­çš„æ•°æ®ä¹Ÿä¼šä¿®æ”¹</span><br><span class="line"># ä½¿ç”¨ update</span><br><span class="line">UPDATE view_stu SET chinese &#x3D; 100;</span><br><span class="line"></span><br><span class="line"># å˜åŒ–åŸºæœ¬è¡¨ä¸­çš„æ•°æ®åŒæ ·ä¹Ÿä¼šæ”¹å˜è§†å›¾ä¸­çš„æ•°æ®</span><br><span class="line"># ä½¿ç”¨ insert è¯­å¥</span><br><span class="line">INSERT INTO student VALUES(4, &#39;LILY&#39;, 98, 99);</span><br><span class="line"></span><br><span class="line"># ä½¿ç”¨ delete</span><br><span class="line">DELETE FROM view_stu WHERE chinese &#x3D;  99;</span><br></pre></td></tr></table></figure><h4 id="7-5-åˆ é™¤è§†å›¾"><a class="header-anchor" href="#7-5-åˆ é™¤è§†å›¾">Â¶</a>7.5 åˆ é™¤è§†å›¾</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">DROP VIEW view_name;</span><br></pre></td></tr></table></figure><h3 id="8-æ•°æ®åº“çš„é«˜çº§æ“ä½œ"><a class="header-anchor" href="#8-æ•°æ®åº“çš„é«˜çº§æ“ä½œ">Â¶</a>8 æ•°æ®åº“çš„é«˜çº§æ“ä½œ</h3><h4 id="8-1-æ•°æ®å¤‡ä»½ä¸è¿˜åŸ"><a class="header-anchor" href="#8-1-æ•°æ®å¤‡ä»½ä¸è¿˜åŸ">Â¶</a>8.1 æ•°æ®å¤‡ä»½ä¸è¿˜åŸ</h4><h5 id="8-1-1-æ•°æ®çš„å¤‡ä»½"><a class="header-anchor" href="#8-1-1-æ•°æ®çš„å¤‡ä»½">Â¶</a>8.1.1 æ•°æ®çš„å¤‡ä»½</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># å‘½ä»¤è¡Œå†…</span><br><span class="line">mysqldump -u root -p mydb1 &gt; d:\1.sql</span><br></pre></td></tr></table></figure><h5 id="8-1-2-æ•°æ®çš„è¿˜åŸ"><a class="header-anchor" href="#8-1-2-æ•°æ®çš„è¿˜åŸ">Â¶</a>8.1.2 æ•°æ®çš„è¿˜åŸ</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># æ–¹æ³•ä¸€   --- å‘½ä»¤è¡Œå†…</span><br><span class="line">mysql -u root -p mydb1 &lt; d:\1.sql  # å‰ææ˜¯å…ˆåˆ›å»ºç©ºæ•°æ®åº“ mydb1</span><br><span class="line"></span><br><span class="line"># æ–¹æ³•äºŒ   --- mysqlå†…</span><br><span class="line">CREATE DATABASE mydb1;</span><br><span class="line">USE mydb1;</span><br><span class="line">SOURCE D:\1.sql  # è½½å…¥æ•°æ®</span><br></pre></td></tr></table></figure><h4 id="8-2-ç”¨æˆ·ç®¡ç†"><a class="header-anchor" href="#8-2-ç”¨æˆ·ç®¡ç†">Â¶</a>8.2 ç”¨æˆ·ç®¡ç†</h4><h5 id="8-2-1-user-è¡¨"><a class="header-anchor" href="#8-2-1-user-è¡¨">Â¶</a>8.2.1 user è¡¨</h5><h5 id="8-2-1-åˆ›å»ºæ™®é€šç”¨æˆ·"><a class="header-anchor" href="#8-2-1-åˆ›å»ºæ™®é€šç”¨æˆ·">Â¶</a>8.2.1 åˆ›å»ºæ™®é€šç”¨æˆ·</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># grant è¯­å¥</span><br><span class="line"># å¯¹äº localhost ä¸»æœºï¼Œåˆ›å»ºç”¨æˆ· USER01ï¼Œé€‰æ‹© mydb1å†…çš„æ‰€æœ‰æ‰€æœ‰æ•°æ®ï¼Œå¯†ç ä¸º123456</span><br><span class="line">GRANT SELECT ON mydb1.* TO &#39;USER01&#39;@localhost IDENTIFIED BY &#39;abc123&#39;;</span><br><span class="line"></span><br><span class="line"># create è¯­å¥</span><br><span class="line">CREATE USER &#39;USER02&#39;@localhost IDENTIFIED BY &#39;abc123&#39;;</span><br><span class="line"></span><br><span class="line"># insert è¯­å¥</span><br><span class="line">INSERT INTO mysql.user(Host, User, Password, ssl_cipher, x509issuer, x509_subject)</span><br><span class="line">VALUES(local, &#39;USER03&#39;, PASSWORD(&#39;abc123&#39;),&#39;&#39;,&#39;&#39;,&#39;&#39;);</span><br><span class="line">FLUSH PRIVILEGES;  # åˆ·æ–°æƒé™</span><br></pre></td></tr></table></figure><h5 id="8-2-1-åˆ é™¤æ™®é€šç”¨æˆ·"><a class="header-anchor" href="#8-2-1-åˆ é™¤æ™®é€šç”¨æˆ·">Â¶</a>8.2.1 åˆ é™¤æ™®é€šç”¨æˆ·</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># drop è¯­å¥</span><br><span class="line">DROP USER &#39;USER02&#39;@localhost;</span><br><span class="line"></span><br><span class="line"># delete è¯­å¥</span><br><span class="line">DELETE FROM mysql.user WHERE Host &#x3D; &#39;localhost&#39; AND User &#x3D; &#39;USER02&#39;;</span><br><span class="line">FLUSH PRIVILEGES;  # åˆ·æ–°æƒé™</span><br></pre></td></tr></table></figure><h5 id="8-2-1-ä¿®æ”¹ç”¨æˆ·å¯†ç "><a class="header-anchor" href="#8-2-1-ä¿®æ”¹ç”¨æˆ·å¯†ç ">Â¶</a>8.2.1 ä¿®æ”¹ç”¨æˆ·å¯†ç </h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 1. ä¿®æ”¹rootç”¨æˆ·å¯†ç </span><br><span class="line"># å‘½ä»¤è¡Œ</span><br><span class="line">mysqladmin -u root -p password rootroot;</span><br><span class="line"></span><br><span class="line"># update è¯­å¥</span><br><span class="line">UPDATE mysql.user SET PASSWORD &#x3D; PASSWORD(&#39;rootroot&#39;)</span><br><span class="line">WHERE User &#x3D; &#39;username&#39; AND Host &#x3D; &#39;hostname&#39;;</span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line"></span><br><span class="line"># SET è¯­å¥ å¿…é¡» root ç”¨æˆ·æœ¬èº«</span><br><span class="line">SET PASSWORD &#x3D; PASSWORD(&#39;rootroot&#39;);</span><br><span class="line"></span><br><span class="line"># 2. root ç”¨æˆ·ä¿®æ”¹æ™®é€šç”¨æˆ·å¯†ç </span><br><span class="line"># grant è¯­å¥</span><br><span class="line"># update è¯­å¥</span><br><span class="line"># set è¯­å¥</span><br><span class="line"></span><br><span class="line">#3. æ™®é€šç”¨æˆ·ä¿®æ”¹è‡ªå·±å¯†ç </span><br><span class="line"># set è¯­å¥</span><br><span class="line">SET PASSWORD &#x3D; PASSWORD(&#39;password&#39;);</span><br></pre></td></tr></table></figure><h4 id="8-3-æƒé™ç®¡ç†"><a class="header-anchor" href="#8-3-æƒé™ç®¡ç†">Â¶</a>8.3 æƒé™ç®¡ç†</h4><h5 id="8-3-1-Mysql-çš„æƒé™"><a class="header-anchor" href="#8-3-1-Mysql-çš„æƒé™">Â¶</a>8.3.1 Mysql çš„æƒé™</h5><h5 id="8-3-2-æˆäºˆæƒé™"><a class="header-anchor" href="#8-3-2-æˆäºˆæƒé™">Â¶</a>8.3.2 æˆäºˆæƒé™</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># èµ‹äºˆ insert select æƒé™ ç»™ user04 ï¼Œå¯†ç ä¸º 123</span><br><span class="line">GRANT INSERT,SELECT ON *.* TO &#39;USER04&#39;@localhost IDENTIFIED BY &#39;123&#39; WITH GRANT OPTION;</span><br></pre></td></tr></table></figure><h5 id="8-3-3-æŸ¥çœ‹æƒé™"><a class="header-anchor" href="#8-3-3-æŸ¥çœ‹æƒé™">Â¶</a>8.3.3 æŸ¥çœ‹æƒé™</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SHOW GRANTS FOR &#39;root&#39;@localhost;</span><br></pre></td></tr></table></figure><h5 id="8-3-4-æ”¶å›æƒé™"><a class="header-anchor" href="#8-3-4-æ”¶å›æƒé™">Â¶</a>8.3.4 æ”¶å›æƒé™</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">REVOKE insert on *.* FROM &#39;USER04&#39;@localhost; # å›æ”¶ user04 çš„ insert æƒé™</span><br><span class="line">REVOKE ALL PRIVILEGES, GRANT OPTION FROM &#39;USER04&#39;@localhost; # å›æ”¶ user04 çš„æ‰€æœ‰æƒé™</span><br></pre></td></tr></table></figure><!-- rebuild by neat -->]]></content>
      <categories>
        <category>Database</category>
      </categories>
      <tags>
        <tag>Database</tag>
      </tags>
  </entry>
  <entry>
    <title>C++ vscode ç¼–è¯‘ç¯å¢ƒ</title>
    <url>/Complie_and_Debug/cpp_vscode/</url>
    <content><![CDATA[<!-- build time:Tue Jun 22 2021 17:02:33 GMT+0800 (GMT+08:00) --><a id="more"></a><h1>c++ vscode ç¼–è¯‘ç¯å¢ƒ</h1><h2 id="0-è¯´æ˜"><a class="header-anchor" href="#0-è¯´æ˜">Â¶</a>0 è¯´æ˜</h2><p>ä»¥ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜ cpp åœ¨ vscode ï¼ˆwindowï¼‰ä¸‹ç¼–è¯‘ï¼Œå…¶ä¸­éœ€è¦</p><blockquote><p>vscode â€“ IDE</p><p>MinGW64 â€“ g++ï¼Œgdb â€¦</p><p>CMake â€“ cmake</p></blockquote><p>æ³¨ï¼šå…¶ä¸­ MinGW64 ä»¥åŠ CMake éœ€è¦æ·»åŠ åˆ°ç¯å¢ƒå˜é‡path</p><p>vscode éœ€è¦ <strong><code>æ’ä»¶</code></strong> å¦‚ä¸‹ï¼š</p><blockquote><p>c/c++</p><p>CMake</p><p>CMake Tools</p></blockquote><p>ä»¥ä¸‹ä»¥ä¾‹å­è¯´æ˜æ•´ä¸ªç¼–è¯‘è°ƒè¯•è¿‡ç¨‹ï¼Œæ–‡ä»¶å¤¹ exampleï¼Œåˆ›å»º main.cpp å‡½æ•°ï¼Œå…¶ä¸»è¦ä½œç”¨æ˜¯ swap ã€‚å…ˆä»å•æ–‡ä»¶ç¼–è¯‘ï¼Œåˆ°å¤šæ–‡ä»¶ç¼–è¯‘ï¼Œæœ€åé€šè¿‡ cmake æ¥è¿›è¡Œå¤šæ–‡ä»¶çš„ç¼–è¯‘ã€‚</p><h2 id="1-å•æ–‡ä»¶ç¼–è¯‘"><a class="header-anchor" href="#1-å•æ–‡ä»¶ç¼–è¯‘">Â¶</a>1 å•æ–‡ä»¶ç¼–è¯‘</h2><p>æ‰“å¼€ example æ–‡ä»¶ä¸‹ï¼Œåˆ›å»º main.cpp å‡½æ•°ï¼š</p><img src="/Complie_and_Debug/cpp_vscode/example_folder.png" style="zoom:67%"><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span> &amp;a, <span class="keyword">int</span> &amp;b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> temp = a;</span><br><span class="line">    a = b;</span><br><span class="line">    b = temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> val1 = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">int</span> val2 = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"before swap:"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; val1 &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; val2 &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    swap(val1,val2);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"after swap:"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; val1 &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; val2 &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-1-åˆ©ç”¨ç»ˆç«¯å‘½ä»¤è¡Œæ¥ç”Ÿæˆå¯ç¼–è¯‘æ–‡ä»¶"><a class="header-anchor" href="#1-1-åˆ©ç”¨ç»ˆç«¯å‘½ä»¤è¡Œæ¥ç”Ÿæˆå¯ç¼–è¯‘æ–‡ä»¶">Â¶</a>1.1 åˆ©ç”¨ç»ˆç«¯å‘½ä»¤è¡Œæ¥ç”Ÿæˆå¯ç¼–è¯‘æ–‡ä»¶</h3><p>å‘½ä»¤è¡Œå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">g++ -g ./main.cpp -o out1</span><br></pre></td></tr></table></figure><ul><li>g++</li><li>-g ï¼šå¯ç¼–è¯‘è°ƒè¯•</li><li>./main.cpp ï¼šå¾…ç¼–è¯‘æ–‡ä»¶ ï¼ˆå•ï¼‰</li><li>-o out1ï¼šè¾“å‡º out1.exe å¯æ‰§è¡Œæ–‡ä»¶</li></ul><img src="/Complie_and_Debug/cpp_vscode/out1_exe.png" style="zoom:67%"><p>é€šè¿‡å‘½ä»¤è¡Œæ¥æ‰§è¡Œ out1.exeï¼Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./out1</span><br></pre></td></tr></table></figure><img src="/Complie_and_Debug/cpp_vscode/e_out1.png" style="zoom:80%"><h3 id="1-2-è°ƒè¯•"><a class="header-anchor" href="#1-2-è°ƒè¯•">Â¶</a>1.2 è°ƒè¯•</h3><p>åœ¨ main.cpp 19 è¡Œæ‰“ä¸Šæ–­ç‚¹ï¼Œé€šè¿‡æŒ‰ ==F5==ï¼Œåœ¨å¼¹å‡ºçš„çª—å£ä¸­ä¾æ¬¡é€‰æ‹© c++ GDBï¼Œg++ exeï¼Œç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆ ==launch.json==ï¼Œ==tasks.json== å¹¶ç½®äº .vscode æ–‡ä»¶å¤¹ä¸‹ï¼ŒåŒæ—¶è¿˜æœ‰è‡ªåŠ¨ç”Ÿæˆçš„ main.exe æ–‡ä»¶ã€‚</p><img src="/Complie_and_Debug/cpp_vscode/cpp_gdb.png" style="zoom:67%"> <img src="/Complie_and_Debug/cpp_vscode/gpp_exe.png" style="zoom:67%"> <img src="/Complie_and_Debug/cpp_vscode/_vscode_main_exe.png" style="zoom:67%"><p>å¯ä»¥å‘ç°ç¼–è¾‘çª—å£ï¼Œç¨‹åºå·²ç»å‡»ä¸­æ–­ç‚¹ï¼Œå¹¶å¯ä»¥å•æ­¥è°ƒè¯•ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯æ­¤æ—¶çš„è°ƒç”¨çš„ exe æ–‡ä»¶æ˜¯ ==main.exe==ã€‚</p><img src="/Complie_and_Debug/cpp_vscode/hit_break.png" style="zoom:50%"><p><img src="/Complie_and_Debug/cpp_vscode/single_step_debug.png" style="zoom:55%"><img src="/Complie_and_Debug/cpp_vscode/single_step_debug2.png" style="zoom:80%"></p><h3 id="1-2-json-æ–‡ä»¶é…ç½®"><a class="header-anchor" href="#1-2-json-æ–‡ä»¶é…ç½®">Â¶</a>1.2 json æ–‡ä»¶é…ç½®</h3><p>ä¸Šæ–‡ä¸ºä»€ä¹ˆè°ƒç”¨ main.exe æ–‡ä»¶ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ä¹‹å‰ç”Ÿæˆçš„ out1.exe ï¼Œè¿™æ˜¯å› ä¸ºè‡ªåŠ¨ç”Ÿæˆçš„ launch.json å’Œ tasks.json å†³å®šçš„ã€‚</p><ul><li>launch.json ä¸­ program ä½¿ç”¨çš„ main.exe ï¼ˆç”± tasks.json æ¥ç”Ÿæˆï¼‰</li><li>tasks.json <strong>command</strong> ï¼š g++ï¼Œ<strong>args</strong>ï¼š -g ./main.cpp -o main ï¼ˆæ°å¥½ä¸1.1èŠ‚å‘½ä»¤è¡Œç›¸ç±»ä¼¼ï¼‰</li></ul><img src="/Complie_and_Debug/cpp_vscode/launch_json_main.png" style="zoom:50%"> <img src="/Complie_and_Debug/cpp_vscode/tasks_main.png" style="zoom:50%"><p>launch.json ä¹‹æ‰€ä»¥å¯ä»¥ä½¿ç”¨ tasks.json ï¼Œæ˜¯å› ä¸º ==preLauchTask== æ ‡ç­¾å€¼ä¸ tasks.json çš„ label ç›¸åŒã€‚</p><img src="/Complie_and_Debug/cpp_vscode/preLaunchTask.png" style="zoom:67%"><p>å¦‚æœæ³¨é‡Šæ‰ launch.json ä¸­ preLaunchTask å¹¶ä¿®æ”¹ program ä¸º out1.exe ï¼Œå³å¯ä½¿ç”¨ä¹‹å‰ç”Ÿæˆçš„ out1.exe æ¥è°ƒè¯•ã€‚</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">"program": "$&#123;fileDirname&#125;\\out1.exe",</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line"><span class="comment">//"preLaunchTask": "C/C++: g++.exe build active file"</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œè¿™æ ·çš„æ“ä½œä¼šæœ‰ä¸€ä¸ªéå¸¸éº»çƒ¦çš„é—®é¢˜ï¼Œå¦‚æœå¯¹ main.cpp å‡½æ•°è¿›è¡Œä¿®æ”¹ï¼Œåˆ™éœ€è¦é‡æ–°ä½¿ç”¨å‘½ä»¤è¡Œç”Ÿæˆå¯è°ƒå¼ç¼–è¯‘æ–‡ä»¶ï¼Œè¿™æ ·æ‰é‡æ›´æ–°è°ƒè¯•ï¼Œå¦åˆ™åªæ˜¯è°ƒè¯•ä¹‹å‰ç”Ÿæˆçš„ exe è€Œå·²ã€‚</p><p>æ‰€ä»¥ tasks.json çš„ä½œç”¨å°±æ˜¯å¯ä»¥ç®€åŒ–è¿™ä¸ªè¿‡ç¨‹ï¼Œæ¯æ¬¡å¯ä»¥é€šè¿‡è°ƒç”¨ task.json çš„å‚æ•°æ¥é‡æ–°ç”Ÿæˆ exe æ–‡ä»¶ã€‚</p><h2 id="2-å¤šæ–‡ä»¶ç¼–è¯‘"><a class="header-anchor" href="#2-å¤šæ–‡ä»¶ç¼–è¯‘">Â¶</a>2. å¤šæ–‡ä»¶ç¼–è¯‘</h2><p>ä¿®æ”¹ main.cpp å‡½æ•°ï¼Œæ‹†åˆ†æˆ main.cpp swap.cpp swap.hï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p>main.cpp</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> val1 = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">int</span> val2 = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"before swap:"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; val1 &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; val2 &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    swap(val1,val2);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"after swap:"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; val1 &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; val2 &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>swap.cpp</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"swap.h"</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span> &amp;a, <span class="keyword">int</span> &amp;b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> temp = a;</span><br><span class="line">    a = b;</span><br><span class="line">    b = temp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>swap.h</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span> &amp;a, <span class="keyword">int</span> &amp;b)</span></span>;</span><br></pre></td></tr></table></figure><h3 id="2-1-åˆ©ç”¨ç»ˆç«¯å‘½ä»¤è¡Œæ¥ç”Ÿæˆå¯ç¼–è¯‘æ–‡ä»¶"><a class="header-anchor" href="#2-1-åˆ©ç”¨ç»ˆç«¯å‘½ä»¤è¡Œæ¥ç”Ÿæˆå¯ç¼–è¯‘æ–‡ä»¶">Â¶</a>2.1 åˆ©ç”¨ç»ˆç«¯å‘½ä»¤è¡Œæ¥ç”Ÿæˆå¯ç¼–è¯‘æ–‡ä»¶</h3><p>å‘½ä»¤è¡Œå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">g++ -g ./main.cpp ./swap.cpp -o out2.exe</span><br></pre></td></tr></table></figure><ul><li>g++</li><li>-g ï¼šå¯ç¼–è¯‘è°ƒè¯•</li><li>./main.cpp ./swap.cppï¼šå¾…ç¼–è¯‘æ–‡ä»¶ ï¼ˆå¤šï¼‰</li><li>-o out2ï¼šè¾“å‡º out2.exe å¯æ‰§è¡Œæ–‡ä»¶</li></ul><p>é€šè¿‡å‘½ä»¤è¡Œæ¥æ‰§è¡Œ out2.exeï¼Œç»“æœç›¸åŒã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./out2</span><br></pre></td></tr></table></figure><h3 id="2-2-è°ƒè¯•"><a class="header-anchor" href="#2-2-è°ƒè¯•">Â¶</a>2.2 è°ƒè¯•</h3><p>æ­¤æ—¶å¦‚æœæŒ‰ç…§ä¹‹å‰çš„æ­¥éª¤è°ƒè¯•ä¼šæŠ¥é”™ï¼Œéœ€è¦ä¿®æ”¹ tasks.json ï¼Œå°†å…¶æ”¹æˆå¤šæ–‡ä»¶ã€‚</p><figure class="highlight"><table><tr><td class="code"><pre><span class="line">"args": [</span><br><span class="line">    "-g",</span><br><span class="line">    "main.cpp",</span><br><span class="line">    "swap.cpp",</span><br><span class="line">    "-o",</span><br><span class="line">    <span class="string">"out2.exe"</span></span><br><span class="line">],</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œlaunch.json çš„ program ä¹Ÿè¦æ›´æ”¹åˆ° out2.exe çš„è·¯å¾„ã€‚</p><p>ç»è¿‡ä¿®æ”¹ï¼ŒåŒæ ·å¯ä»¥å‡»ä¸­æ–­ç‚¹å¹¶ä¸”å¯ä»¥è°ƒè¯•ã€‚</p><h2 id="3-CMake-ä½¿ç”¨"><a class="header-anchor" href="#3-CMake-ä½¿ç”¨">Â¶</a>3. CMake ä½¿ç”¨</h2><p>ç¼–å†™ CMakeLists.txt</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">project(MYCmake)</span><br><span class="line"></span><br><span class="line">add_executable(out3 main.cpp swap.cpp) &#x2F;&#x2F; ç”Ÿæˆ out3.exe</span><br></pre></td></tr></table></figure><h3 id="3-1-æ–¹æ³•ä¸€"><a class="header-anchor" href="#3-1-æ–¹æ³•ä¸€">Â¶</a>3.1 æ–¹æ³•ä¸€</h3><p>ä¹‹åæŒ‰ shift+ctrl+p æœç´¢ cmake configureï¼Œåç‚¹ GCC 8.1.0 ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆ build æ–‡ä»¶ï¼Œå†…éƒ¨åŒ…å«makefileæ–‡ä»¶ã€‚</p><img src="/Complie_and_Debug/cpp_vscode/cmake_configure.png" style="zoom:67%"> <img src="/Complie_and_Debug/cpp_vscode/GCC810.png" style="zoom:67%"> <img src="/Complie_and_Debug/cpp_vscode/build_folder.png" style="zoom:67%"><p>è¿›å…¥ build æ–‡ä»¶å¤¹ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> build</span><br></pre></td></tr></table></figure><p>åä¾æ¬¡å‘½ä»¤è¡Œè¾“å…¥ï¼Œç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ out3.exeï¼Œç½®äº build æ–‡ä»¶å¤¹ä¸‹ã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cmake ..</span><br><span class="line">mingw32-make.exe</span><br></pre></td></tr></table></figure><img src="/Complie_and_Debug/cpp_vscode/cmake_debug.png" style="zoom:67%"><p>out3.exe ä¸ä¹‹å‰çš„ out1.exeï¼Œout2.exe ç›¸åŒï¼Œéƒ½æ˜¯å¯ä»¥è¿›è¡Œdebugçš„ã€‚</p><h3 id="3-2-æ–¹æ³•äºŒ"><a class="header-anchor" href="#3-2-æ–¹æ³•äºŒ">Â¶</a>3.2 æ–¹æ³•äºŒ</h3><p>æ–¹æ³•äºŒä¸»è¦å°±æ˜¯ä¸ä½¿ç”¨ shift+ctrl+p ç­‰æ“ä½œï¼Œè€Œæ˜¯è‡ªå·±åˆ›å»º build æ–‡ä»¶å¤¹ï¼Œå¹¶ä½¿ç”¨</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cmake ..  </span><br><span class="line">mingw32-make.exe</span><br></pre></td></tr></table></figure><p>å…¶ä¸­å¦‚æœå­˜åœ¨VSçš„æƒ…å†µä¸‹å¯èƒ½ä¼šåœ¨cmake â€¦ é˜¶æ®µæŠ¥é”™ï¼Œéœ€è¦ä½¿ç”¨</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cmake -G <span class="string">"MinGW Makefiles"</span>..</span><br></pre></td></tr></table></figure><p>è¯¥å‘½ä»¤ä»…ç¬¬ä¸€æ¬¡ä½¿ç”¨å³å¯ï¼Œåé¢ç»§ç»­ä½¿ç”¨ cmake â€¦</p><p>å¦‚æœè¿˜æŠ¥é”™ï¼Œå…ˆæ¸…ç©ºæ–‡ä»¶å¤¹åœ¨æ“ä½œä»¥ä¸Šæ­¥éª¤</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rm *</span><br></pre></td></tr></table></figure><h3 id="3-3-æ–¹æ³•ä¸‰"><a class="header-anchor" href="#3-3-æ–¹æ³•ä¸‰">Â¶</a>3.3 æ–¹æ³•ä¸‰</h3><p>ä½¿ç”¨ tasks.json æ¥å®Œæˆä»¥ä¸Šçš„è¿‡ç¨‹ï¼Œå°†å‘½ä»¤å†™å…¥å…¶ä¸­ï¼š</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="comment">// See https://go.microsoft.com/fwlink/?LinkId=733558</span></span><br><span class="line">    <span class="comment">// for the documentation about the tasks.json format</span></span><br><span class="line">    <span class="attr">"version"</span>: <span class="string">"2.0.0"</span>,</span><br><span class="line">    <span class="attr">"options"</span>: &#123;</span><br><span class="line">        <span class="attr">"cwd"</span>: <span class="string">"$&#123;fileDirname&#125;\\build"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"tasks"</span>: [</span><br><span class="line">        &#123;   </span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"shell"</span>,</span><br><span class="line">            <span class="attr">"label"</span>: <span class="string">"cmake"</span>,</span><br><span class="line">            <span class="attr">"command"</span>: <span class="string">"cmake"</span>,</span><br><span class="line">            <span class="attr">"args"</span>: [</span><br><span class="line">                <span class="string">".."</span>,</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"label"</span>: <span class="string">"make"</span>,</span><br><span class="line">            <span class="attr">"group"</span>: &#123;</span><br><span class="line">                <span class="attr">"kind"</span>: <span class="string">"build"</span>,</span><br><span class="line">                <span class="attr">"isDefault"</span>: <span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"command"</span>:<span class="string">"mingw32-make.exe"</span>,</span><br><span class="line">            <span class="attr">"args"</span>: [</span><br><span class="line"></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"label"</span>: <span class="string">"Build"</span>,</span><br><span class="line">            <span class="attr">"dependsOn"</span>:[</span><br><span class="line">                <span class="string">"cmake"</span>,</span><br><span class="line">                <span class="string">"make"</span>,</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŒ‰ç…§CMakeLists.txt</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">project(MYCmake)</span><br><span class="line"></span><br><span class="line">add_executable(out4 main.cpp swap.cpp)</span><br></pre></td></tr></table></figure><p>ç›¸åº”çš„ä¿®æ”¹ launch.json ä¸­å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„ã€‚</p><figure class="highlight"><table><tr><td class="code"><pre><span class="line">"program": "$&#123;fileDirname&#125;\\build\\out4.exe",</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆå¯ä»¥ debug çš„ out4.exe æ–‡ä»¶ã€‚</p><h2 id="é™„å½•"><a class="header-anchor" href="#é™„å½•">Â¶</a>é™„å½•</h2><p>launch.json</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨ IntelliSense äº†è§£ç›¸å…³å±æ€§ã€‚ </span></span><br><span class="line">    <span class="comment">// æ‚¬åœä»¥æŸ¥çœ‹ç°æœ‰å±æ€§çš„æè¿°ã€‚</span></span><br><span class="line">    <span class="comment">// æ¬²äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—®: https://go.microsoft.com/fwlink/?linkid=830387</span></span><br><span class="line">    <span class="attr">"version"</span>: <span class="string">"0.2.0"</span>,</span><br><span class="line">    <span class="attr">"configurations"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"g++.exe - ç”Ÿæˆå’Œè°ƒè¯•æ´»åŠ¨æ–‡ä»¶"</span>,</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"cppdbg"</span>,</span><br><span class="line">            <span class="attr">"request"</span>: <span class="string">"launch"</span>,</span><br><span class="line">            <span class="attr">"program"</span>: <span class="string">"$&#123;fileDirname&#125;\\build\\out4.exe"</span>,</span><br><span class="line">            <span class="attr">"args"</span>: [],</span><br><span class="line">            <span class="attr">"stopAtEntry"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"cwd"</span>: <span class="string">"$&#123;fileDirname&#125;"</span>,</span><br><span class="line">            <span class="attr">"environment"</span>: [],</span><br><span class="line">            <span class="attr">"externalConsole"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"MIMode"</span>: <span class="string">"gdb"</span>,</span><br><span class="line">            <span class="attr">"miDebuggerPath"</span>: <span class="string">"D:\\Productivity\\MinGW\\mingw64\\bin\\gdb.exe"</span>,</span><br><span class="line">            <span class="attr">"setupCommands"</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">"description"</span>: <span class="string">"ä¸º gdb å¯ç”¨æ•´é½æ‰“å°"</span>,</span><br><span class="line">                    <span class="attr">"text"</span>: <span class="string">"-enable-pretty-printing"</span>,</span><br><span class="line">                    <span class="attr">"ignoreFailures"</span>: <span class="literal">true</span></span><br><span class="line">                &#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"preLaunchTask"</span>: <span class="string">"Build"</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>tasks.json</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="comment">// See https://go.microsoft.com/fwlink/?LinkId=733558</span></span><br><span class="line">    <span class="comment">// for the documentation about the tasks.json format</span></span><br><span class="line">    <span class="attr">"version"</span>: <span class="string">"2.0.0"</span>,</span><br><span class="line">    <span class="attr">"options"</span>: &#123;</span><br><span class="line">        <span class="attr">"cwd"</span>: <span class="string">"$&#123;fileDirname&#125;\\build"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"tasks"</span>: [</span><br><span class="line">        &#123;   </span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"shell"</span>,</span><br><span class="line">            <span class="attr">"label"</span>: <span class="string">"cmake"</span>,</span><br><span class="line">            <span class="attr">"command"</span>: <span class="string">"cmake"</span>,</span><br><span class="line">            <span class="attr">"args"</span>: [</span><br><span class="line">                <span class="string">".."</span>,</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"label"</span>: <span class="string">"make"</span>,</span><br><span class="line">            <span class="attr">"group"</span>: &#123;</span><br><span class="line">                <span class="attr">"kind"</span>: <span class="string">"build"</span>,</span><br><span class="line">                <span class="attr">"isDefault"</span>: <span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"command"</span>:<span class="string">"mingw32-make.exe"</span>,</span><br><span class="line">            <span class="attr">"args"</span>: [</span><br><span class="line"></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"label"</span>: <span class="string">"Build"</span>,</span><br><span class="line">            <span class="attr">"dependsOn"</span>:[</span><br><span class="line">                <span class="string">"cmake"</span>,</span><br><span class="line">                <span class="string">"make"</span>,</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>CMakeLists.txt</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">project(MYCmake)</span><br><span class="line"></span><br><span class="line">add_executable(out4 main.cpp swap.cpp)</span><br></pre></td></tr></table></figure><p>main.cpp</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> val1 = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">int</span> val2 = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"before swap:"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; val1 &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; val2 &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    swap(val1,val2);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"after swap:"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; val1 &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; val2 &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>swap.cpp</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"swap.h"</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span> &amp;a, <span class="keyword">int</span> &amp;b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> temp = a;</span><br><span class="line">    a = b;</span><br><span class="line">    b = temp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>swap.h</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span> &amp;a, <span class="keyword">int</span> &amp;b)</span></span>;</span><br></pre></td></tr></table></figure><!-- rebuild by neat -->]]></content>
      <categories>
        <category>Complie_and_Debug</category>
      </categories>
      <tags>
        <tag>C++</tag>
        <tag>Complie_and_Debug</tag>
        <tag>vscode</tag>
      </tags>
  </entry>
  <entry>
    <title>5G-NR-CSI_Report</title>
    <url>/5G_Protocol/5G-NR-CSI-Report/</url>
    <content><![CDATA[<!-- build time:Tue Jun 22 2021 17:02:33 GMT+0800 (GMT+08:00) --><a id="more"></a><h1>CSI Report</h1><h2 id="1-CSI-æµ‹é‡å’Œä¸ŠæŠ¥çš„é…ç½®æ¡†æ¶"><a class="header-anchor" href="#1-CSI-æµ‹é‡å’Œä¸ŠæŠ¥çš„é…ç½®æ¡†æ¶">Â¶</a>1 CSI æµ‹é‡å’Œä¸ŠæŠ¥çš„é…ç½®æ¡†æ¶</h2><h3 id="1-1-æ¡†æ¶"><a class="header-anchor" href="#1-1-æ¡†æ¶">Â¶</a>1.1 æ¡†æ¶</h3><p>CSIï¼ˆchannel state informationï¼‰åŒ…æ‹¬ CQIï¼ŒRIï¼ŒLIï¼ŒPMIï¼ŒCRIï¼ŒSSBRI å’Œ L1-RSRPã€‚ç»ˆç«¯ä¸ŠæŠ¥ CSI ç»™ gNBï¼ŒgNB ä¼šæ ¹æ®ä¸ŠæŠ¥çš„å†…å®¹è¿›è¡Œè°ƒåº¦çš„è°ƒæ•´ä»¥åŠæ³¢æŸç®¡ç†ç›¸å…³çš„å·¥ä½œï¼Œå› æ­¤ CSI çš„ä¸ŠæŠ¥ååˆ†é‡è¦ã€‚<br>CSIçš„å·¥ä½œåŸç†æ˜¯ï¼Œé¦–å…ˆ gNB ç»™ç»ˆç«¯é…ç½®é€‚å½“çš„ CSI-RS èµ„æºï¼Œç„¶åç»ˆç«¯å¯¹ CSI-RS è¿›è¡Œæµ‹é‡å¹¶è®¡ç®—å‡ºæ‰€éœ€è¦çš„çš„ CSIï¼Œæœ€åé€šè¿‡ PUCCH/PUSCH ä¸ŠæŠ¥ç»™ gNBã€‚</p><p>CSI-RSç›¸å…³çš„é…ç½®éƒ½åœ¨RRCå‚æ•° <em>CSI-MeasConfig</em> ä¸­å®šä¹‰ï¼Œè§ä¸‹å›¾ï¼ˆæ‘˜è‡ª38331ï¼‰</p><p><img src="/5G_Protocol/5G-NR-CSI-Report/p1-measConfig1.png" alt><br><img src="/5G_Protocol/5G-NR-CSI-Report/p2-measConfig2.png" alt></p><p>å€Ÿé‰´åšå®¢ä½œè€…æ€»ç»“çš„å›¾ç‰‡ (å…¬ä¼—å·ï¼šGiveMe5G )</p><p><img src="/5G_Protocol/5G-NR-CSI-Report/p3-%E5%85%A8%E5%B1%80.png" alt></p><p>CSIæ¡†æ¶åŸºæœ¬é…ç½®ä¸¤ä¸ªä¸œè¥¿ï¼Œä¸€ä¸ªæ˜¯ç”¨äºé…ç½®CSIæµ‹é‡çš„CSI-RSèµ„æºï¼Œå¦ä¸€ä¸ªæ˜¯é…ç½®CSIå¦‚ä½•ä¸ŠæŠ¥ã€‚</p><p>åˆ†æ <em>CSI-MeasConfig</em> å¯ä»¥ä»ä¸¤ä¸ªé‡è¦çš„ IE ç€äºï¼š<em>csi-ResourceConfig</em>ï¼Œ <em>csi-ReportConfig</em></p><h3 id="1-2-csi-ResourceConfig"><a class="header-anchor" href="#1-2-csi-ResourceConfig">Â¶</a>1.2 <em>csi-ResourceConfig</em></h3><p><em>csi-ResourceConfig</em>: è¿™ä¸ª IE å°±æ˜¯å‘Šè¯‰ä½ é…ç½®çš„CSI-RSèµ„æºçš„ã€‚ä¸€ä¸ª <em>CSI-ResourceConfig</em> ä¸‹é¢ä¼šé…ç½® <em>ResourceSet</em>ï¼Œ<em>ResourceSet</em> é‡Œé¢åŒ…å«æœ€åŸºæœ¬çš„ <em>CSI-RS Resource</em>ã€‚<em>CSI-RS-Resource</em>åŒ…æ‹¬ <em>nzp-CSI-RS</em>ï¼Œ<em>SSB</em> å’Œ <em>csi-IM</em> ä¸‰ç§ã€‚<br>è¿™äº› CSI-RS çš„ resource ç±»å‹å¯ä»¥æ˜¯<font color="#0000FF"><strong>å‘¨æœŸ</strong></font>ï¼Œ <font color="#008000"><strong>åŠæŒç»­</strong></font> å’Œ<font color="#FF0000"><strong>éå‘¨æœŸ</strong></font>ï¼Œä¸‰ç§ç±»å‹ã€‚åè®®é‡Œé¢ç‰¹æ„æ˜ç¡®äº†å¯¹äºå‘¨æœŸå’ŒåŠæŒç»­çš„ <em>CSI-RS resource</em>ï¼Œæ¯ä¸ª <em>csi-ResourceConfig</em> åªèƒ½é…ç½®1ä¸ª <em>csi-RS-ResourceSet</em>ã€‚</p><h3 id="1-3-csi-ReportConfig"><a class="header-anchor" href="#1-3-csi-ReportConfig">Â¶</a>1.3 <em>csi-ReportConfig</em></h3><p><em>csi-ReportConfig</em>: è¿™ä¸ª IE æ˜¯ç”¨äºé…ç½®å¦‚ä½• report çš„ã€‚</p><ul><li><em>resourcesForChannelMeasurement</em> \ <em>csi-IM-ResourcesForInterference</em> \ <em>nzp-CSI-RS-ResourcesForInterference</em>,è¿™ä¸‰ä¸ªå‚æ•°è¡¨ç¤ºç”¨äº Channel Measurement å’Œ Interference Measurement çš„ <em>csi-ResourceConfigId</em>ï¼Œç”¨å¾—åˆ°çš„ Id å’Œ <em>csi-ResourceConfig</em> è¿›è¡Œå…³è”ï¼Œå³å¯è·å–åˆ°ç”¨äºæµ‹é‡çš„CSI-RSèµ„æº</li><li><em>reportConfigType</em>ï¼šè¿™ä¸ªIEç”¨äºé…ç½® <em>CSI report</em>çš„ç±»å‹æ˜¯å‘¨æœŸçš„ï¼Œéå‘¨æœŸçš„ï¼ŒåŠæŒç»­OnPUCCHè¿˜æ˜¯åŠæŒç»­OnPUSCHçš„ã€‚å¯¹äºéå‘¨æœŸå’ŒåŠæŒç»­OnPUSCHè¿˜ä¼šé…ç½® <em>TriggerState</em> å’Œ <em>reportTriggerSize</em>ï¼Œç”¨æ¥é…åˆDCIä¸­çš„ <em>CSI request</em> å­—æ®µæ¥ä½¿ç”¨ã€‚</li></ul><h2 id="2-CSI-æµ‹é‡å’Œä¸ŠæŠ¥çš„è§¦å‘æœºåˆ¶"><a class="header-anchor" href="#2-CSI-æµ‹é‡å’Œä¸ŠæŠ¥çš„è§¦å‘æœºåˆ¶">Â¶</a>2 CSI æµ‹é‡å’Œä¸ŠæŠ¥çš„è§¦å‘æœºåˆ¶</h2><p>é€šè¿‡ä¸Šé¢çš„é…ç½®æ¡†æ¶ï¼Œæˆ‘ä»¬çŸ¥é“CSI-RSçš„ resource å’Œ report éƒ½å„æœ‰ä¸‰ç§ç±»å‹ï¼Œå‘¨æœŸï¼ŒåŠæŒç»­ä»¥åŠéå‘¨æœŸã€‚é‚£ä¹ˆresource å’Œ reportçš„ç±»å‹æ˜¯å¦å¯ä»¥ä»»æ„ä¸¤ä¸¤ç»„åˆå‘¢ï¼Ÿåè®®ç»™å‡ºäº†æ˜ç¡®çš„è¦æ±‚ï¼Œç”± [TS 38.214 Table 5.2.1.4-1] ç»™å‡ºï¼š</p><p><img src="/5G_Protocol/5G-NR-CSI-Report/t1-214-5.2.1.4-1.png" alt></p><p>ç»è¿‡ç®€å•çš„æ€»ç»“ä¸‹ï¼Œåˆç†çš„ç»„åˆå¦‚ä¸‹ï¼š</p><ul><li><p><strong><font color="#0000FF">å‘¨æœŸæ€§ä¸ŠæŠ¥</font></strong>ï¼šåªèƒ½ä½¿ç”¨**<font color="#0000FF">å‘¨æœŸæ€§ CSI-RS</font>**ï¼›</p></li><li><p>**<font color="#008000">åŠæŒç»­æ€§ä¸ŠæŠ¥ </font><strong>On Pucchï¼šå¯ä»¥ä½¿ç”¨</strong><font color="#0000FF">å‘¨æœŸæ€§</font><strong>å’Œ</strong><font color="#008000">åŠæŒç»­æ€§</font>**CSI-RSï¼›</p></li><li><p>**<font color="#008000">åŠæŒç»­æ€§ä¸ŠæŠ¥ </font><strong>On Puschï¼šå¯ä»¥ä½¿ç”¨</strong><font color="#0000FF">å‘¨æœŸæ€§</font><strong>å’Œ</strong><font color="#008000">åŠæŒç»­æ€§</font>**CSI-RSï¼›</p></li><li><p><strong><font color="#FF0000">éå‘¨æœŸæ€§ä¸ŠæŠ¥</font></strong>ï¼šå¯ä»¥ä½¿ç”¨**<font color="#0000FF">å‘¨æœŸæ€§</font><strong>ï¼Œ</strong><font color="#008000">åŠæŒç»­æ€§</font><strong>å’Œ</strong><font color="#FF0000">éå‘¨æœŸæ€§</font>**CSI-RSã€‚</p></li></ul><p>å¾ˆæ˜¾ç„¶ï¼ŒgNB éœ€è¦å…ˆå‘ CSI-RS ï¼Œç„¶åç»ˆç«¯æ‰èƒ½æ¥æ”¶å’Œæµ‹é‡ï¼Œå¹¶ä¸ŠæŠ¥ CSI reportï¼Œä¹Ÿå°±æ˜¯å…ˆå‘å†æŠ¥ã€‚è¿™é‡Œé¢æ¶‰åŠ<strong>ä¸¤ä¸ª</strong>å¤§çš„é—®é¢˜</p><ul><li>é¦–å…ˆå°±æ˜¯å¯¹äºæ¯ç§ç±»å‹çš„ CSI-RSï¼ŒgNB ä»€ä¹ˆæ—¶å€™å‘ï¼Ÿ</li><li>å…¶æ¬¡æµ‹é‡å®Œ CSI-RSï¼ŒUE ä»€ä¹ˆæ—¶å€™æŠ¥ï¼Ÿ</li></ul><h3 id="2-1-CSI-RS-ä½•æ—¶å‘é€ï¼Ÿ"><a class="header-anchor" href="#2-1-CSI-RS-ä½•æ—¶å‘é€ï¼Ÿ">Â¶</a>2.1 CSI-RS ä½•æ—¶å‘é€ï¼Ÿ</h3><p>CSI-RS çš„å‘é€æŒ‰ç…§ CSI-RS çš„ ç§ç±»æ¥åˆ’åˆ†ä¸ºä¸åŒçš„æ“ä½œã€‚</p><p><em>csi-ResourceConfig -&gt; resourceType</em> $\in {Periodic,Semipersistent,Aperiodic}$</p><p>â‘  <em>csi-ResourceConfig -&gt; resourceType</em> $\in {Periodic}$<br>RRC é…ç½®åç«‹å³ç”Ÿæ•ˆï¼Œå‘é€çš„æ—¶é—´æŒ‰ç…§å‚æ•° <em>periodicityAndOffset</em> ä½¿ç”¨åè®®ä¸­çš„å…¬å¼è®¡ç®—ï¼Œå¦‚ä¸‹æè¿°ã€‚</p><p>â‘¡ <em>csi-ResourceConfig -&gt; resourceType</em> $\in {SemiPeriodic}$<br>RRCé…ç½®åéœ€è¦ MAC CE æ¿€æ´»æ‰èƒ½ç”Ÿæ•ˆï¼Œå‘é€æ—¶é—´æŒ‰ç…§å‚æ•° <em>periodicityAndOffset</em> ä½¿ç”¨åè®®ä¸­çš„å…¬å¼è®¡ç®—ï¼ŒåŒ â‘ </p><p>â‘¢ <em>csi-ResourceConfig -&gt; resourceType</em> $\in {Aperiodic}$<br>éå‘¨æœŸçš„ CSI-RS åªç”¨äºéå‘¨æœŸä¸ŠæŠ¥çš„åœºæ™¯ï¼Œä¸éå‘¨æœŸä¸ŠæŠ¥çš„è§¦å‘ç´§å¯†ç›¸è¿ï¼Œä¾é  DCI æ¥è§¦å‘ã€‚</p><p>â‘ â‘¡ ä¸­çš„è®¡ç®—å…¬å¼ï¼š<br>$$<br>(N_{slot}^{frame,\mu}n_f + n_{s,f}^{\mu}-T_{offset})mod T_{CSI-RS} = 0<br>$$<br>å…¶ä¸­ï¼š<br>$T_{CSI-RS}$ å’Œ $T_{offset}$ ç”±é«˜å±‚å‚æ•° <em>CSI-ResourcePeriodicityAndOffset</em> æˆ–è€… <em>slotConfig</em> é…ç½®ã€‚</p><h3 id="2-2-CSI-Report-ä½•æ—¶å‘é€ï¼Ÿ"><a class="header-anchor" href="#2-2-CSI-Report-ä½•æ—¶å‘é€ï¼Ÿ">Â¶</a>2.2 CSI-Report ä½•æ—¶å‘é€ï¼Ÿ</h3><p>CSI-Report çš„å‘é€ä¹Ÿæ˜¯æŒ‰ç…§ CSI-Report çš„ç§ç±»æ¥åˆ’åˆ†ä¸ºä¸åŒçš„æ“ä½œã€‚<br>CSI report åˆ†ä¸ºå››ç§ï¼š</p><ul><li><strong><font color="#0000FF">å‘¨æœŸæ€§ä¸ŠæŠ¥</font></strong></li><li><strong><font color="#00800">åŠæŒç»­ä¸ŠæŠ¥</font></strong> <strong>On PUCCH</strong></li><li><strong><font color="#00800">åŠæŒç»­ä¸ŠæŠ¥</font></strong> <strong>On PUSCH</strong></li><li><strong><font color="#FF0000">éæŒç»­ä¸ŠæŠ¥</font></strong></li></ul><h4 id="2-2-1-å‘¨æœŸæ€§ä¸ŠæŠ¥"><a class="header-anchor" href="#2-2-1-å‘¨æœŸæ€§ä¸ŠæŠ¥">Â¶</a>2.2.1 å‘¨æœŸæ€§ä¸ŠæŠ¥</h4><p>RRC é…ç½®å¥½**<font color="#0000FF">å‘¨æœŸæ€§</font>**çš„ CSI-RS Resource å’Œ Report å‚æ•°åï¼Œå°±ä¼šç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€ MAC-CE / DCI å»æ¿€æ´»æˆ–è€…è§¦å‘ CSI-RS çš„å‘é€å’Œ CSI çš„ä¸ŠæŠ¥ï¼›CSI ä¸ŠæŠ¥çš„å‘¨æœŸå’Œ slotOffset æŒ‰ç…§å‚æ•° <em>reportSlotconfit</em> é…ç½®æ‰§è¡Œï¼Œä½¿ç”¨PUCCHä¸ŠæŠ¥ã€‚</p><h4 id="2-2-2-åŠæŒç»­ä¸ŠæŠ¥"><a class="header-anchor" href="#2-2-2-åŠæŒç»­ä¸ŠæŠ¥">Â¶</a>2.2.2 åŠæŒç»­ä¸ŠæŠ¥</h4><p><strong>åŠæŒç»­ä¸ŠæŠ¥ On PUCCH</strong></p><ul><li>å‡è®¾ RRC é…ç½®äº†**<font color="#008000">åŠæŒç»­ CSI-RS</font>** ï¼Œé¦–å…ˆéœ€è¦ MAC CE 1 æ¿€æ´» CSI-RS çš„å‘é€ï¼Œç„¶åå†é€šè¿‡ MAC CE 2 æ¿€æ´» CSI reportï¼›</li><li>å‡è®¾ RRC é…ç½®çš„æ˜¯ <strong><font color="#0000FF">å‘¨æœŸæ€§ CSI-RS</font></strong> ï¼ŒRRCé…ç½®å¥½åä¼šç«‹å³ç”Ÿæ•ˆï¼Œåˆ™æ— éœ€ MAC CE 1è¿™ä¸€æ­¥ï¼ŒCSI ä¸ŠæŠ¥çš„å‘¨æœŸå’Œ slotOffset æŒ‰ç…§å‚æ•° <em>reportSlotConfig</em> ä¸­çš„é…ç½®æ‰§è¡Œã€‚<br>ï¼ˆæ³¨æ„ï¼šå…¶ä¸­çš„MAC CE 1 å’Œ MAC CE 2 ä»£è¡¨çš„æ˜¯ä¸åŒçš„MAC CEï¼‰</li></ul><p><strong>åŠæŒç»­ä¸ŠæŠ¥ On PUSCH</strong></p><ul><li>å‡è®¾ RRC é…ç½®äº†**<font color="#008000">åŠæŒç»­ CSI-RS</font>**ï¼Œé¦–å…ˆéœ€è¦ MAC CE 1 æ¿€æ´» CSI-RS çš„å‘é€ï¼Œç„¶åé€šè¿‡ DCI è§¦å‘ CSI reportï¼›</li><li>å‡è®¾ RRC é…ç½®çš„æ˜¯**<font color="#0000FF">å‘¨æœŸæ€§ CSI-RS</font>**ï¼ŒRRCé…ç½®å¥½åä¼šç«‹å³ç”Ÿæ•ˆï¼Œåˆ™æ— éœ€ MAC CE 1è¿™ä¸€æ­¥ï¼ŒCSI ä¸ŠæŠ¥çš„å‘¨æœŸå’Œ slotOffset æŒ‰ç…§å‚æ•° <em>CSI-ReportConfig</em> ä¸­çš„é…ç½®æ‰§è¡Œã€‚</li></ul><p>å¯¹äº DCI çš„è§¦å‘ CSI report ç»†èŠ‚å¦‚ä¸‹ï¼š</p><p>æ­¤æ—¶çš„ DCI çš„ç±»å‹ä¸º DCI 0_1ï¼Œä½¿ç”¨ SP-CSI-RNTI åŠ æ‰°ï¼Œå…¶æ¬¡ DCI ä¸­ åœ¨è§¦å‘ä¸­æ¶‰åŠåˆ°äº†ä¸¤ä¸ªå­—æ®µï¼š<em>CSI-request</em> ï¼Œ <em>Time domain resource assignment</em>ã€‚<br><em><strong>CSI-request</strong></em>ï¼Œé€šè¿‡ codepoint çš„è®¾ç½®æ¥å…³è”å¯¹åº”çš„ TriggerState ï¼Œ TriggerState é‡Œé¢ä¼šå®šä¹‰å…³è”çš„ CSI-ReportConfigï¼Œç„¶åé‡Œé¢å¯ä»¥æ‰¾åˆ°è¿™ä¸ª report ç›¸å…³çš„ CSI-RS resource Config ä»¥åŠ report çš„å‘¨æœŸå’Œ OffsetListã€‚å…¶ä¸­å‘¨æœŸæ˜¯é€šè¿‡ reportSlotConfig ç›´æ¥ç»™å‡ºçš„ï¼ŒOffsetListæ˜¯é€šè¿‡ <em>reportSlotOffsetList</em> å‚æ•°( è¿™æ˜¯ä¸€ä¸ª<strong>List</strong> )å®šä¹‰çš„ ã€‚<br><em><strong>Time domain resource assignment</strong></em> å­—æ®µçš„ codepoint å–å€¼å†å»å…³è” List ä¸­çš„å€¼ã€‚ï¼ˆä¾‹å¦‚ï¼šcodepoint = 0ï¼Œå°±å–OffsetListä¸­çš„ç¬¬ä¸€ä¸ªå€¼ï¼›å¦‚æœæ˜¯codepoint = iï¼Œå°±å– OffsetListä¸­çš„ç¬¬ $i+1$ä¸ªå€¼ã€‚å¦‚æœå–å€¼ä¸º Y ï¼Œä¹Ÿå°±æ„å‘³ç€è·ç¦» DCI åé¢ç¬¬ Y ä¸ª slot å‘é€ CSI Reportã€‚</p><p><img src="/5G_Protocol/5G-NR-CSI-Report/p4-%E5%8D%8A%E5%91%A8%E6%9C%9F1.png" alt></p><h4 id="2-2-3-éå‘¨æœŸä¸ŠæŠ¥"><a class="header-anchor" href="#2-2-3-éå‘¨æœŸä¸ŠæŠ¥">Â¶</a>2.2.3 éå‘¨æœŸä¸ŠæŠ¥</h4><ul><li>å‡è®¾ RRC é…ç½®äº†**<font color="#008000">åŠæŒç»­ CSI-RS </font>**ï¼Œé¦–å…ˆéœ€è¦ MAC CE 1 æ¿€æ´» CSI-RS çš„å‘é€ï¼Œç„¶åé€šè¿‡ DCI è§¦å‘ CSI reportï¼›</li><li>å‡è®¾ RRC é…ç½®çš„æ˜¯**<font color="#0000FF">å‘¨æœŸæ€§ CSI-RS</font>**ï¼ŒRRCé…ç½®å¥½åä¼šç«‹å³ç”Ÿæ•ˆï¼Œåˆ™æ— éœ€ MAC CE 1è¿™ä¸€æ­¥ï¼Œç„¶åé€šè¿‡ DCI è§¦å‘ CSI reportï¼›</li><li>å‡è®¾ RRC é…ç½®çš„æ˜¯**<font color="#FF0000">éå‘¨æœŸ CSI-RS</font>**ï¼Œéå‘¨æœŸçš„ CSI-RS å‘é€å’Œéå‘¨æœŸçš„ CSI report å‡ç”± DCI è§¦å‘ã€‚</li></ul><p>å…¶ä¸­ <strong><font color="#FF0000">éå‘¨æœŸ CSI-RS å‘é€ + éå‘¨æœŸ CSI ä¸ŠæŠ¥</font></strong> æœ€ä¸ºå¤æ‚ã€‚</p><ol><li>æ ¹æ® DCI 0_1 ä¸­çš„ <em>CSI request</em> å­—æ®µçš„ codepoint å»å…³è”å¯¹åº”çš„ TriggerState ã€‚(æ³¨æ„ï¼šä¸åŠæŒç»­ DCI è§¦å‘ä¸åŒï¼ŒCSI request å¦‚æœä¸º 0 ï¼Œä»£è¡¨ä¸è¦æ±‚è§¦å‘ CSI-RSï¼Œåªæœ‰é 0ï¼Œæ‰è§¦å‘æœ‰æ•ˆ)</li><li>å…³è”åˆ° TriggerStateï¼Œå¯ä»¥å¾—åˆ°ä¸¤ä¸ªé‡è¦çš„å‚æ•°ï¼Œ<em>CSI-ReportConfig</em> , <em>resourceSet</em>ã€‚<ul><li><em>CSI-ReportConfig</em>ï¼Œç±»ä¼¼äº<u>åŠå‘¨æœŸ On PUSCH</u>ï¼Œå…¶ä¸­çš„ <em>reportSlotOffsetList</em> ç”± DCI ä¸­çš„ <em>time domain resource assignment</em> å­—æ®µæŒ‡å‡º List çš„ç´¢å¼•ï¼ˆå‚è€ƒ <u>åŠå‘¨æœŸ On PUSCH</u>ï¼‰ã€‚</li><li><em>resourceSet</em>ï¼Œå®ƒå¹¶ä¸èƒ½ç›´æ¥å–å¯¹åº” <em>CSI-measConfig</em> ä¸­çš„ resourceSet IDã€‚å®ƒçš„ä½œç”¨ç±»ä¼¼ä¸º List indexã€‚åœ¨ <em>CSI-ReportConfig</em> ä¸­å…³è”äº†å¯¹åº”çš„ <em>CSI-resourceConfigId</em>ï¼Œé€šè¿‡ <em>CSI-resourceConfigId</em> å¯ä»¥å…³è”ä¸€ä¸ª <em>resourceSetList</em> ï¼Œè¿™æ—¶å€™éœ€è¦ç”¨ <em>resourceSet</em> çš„å€¼å»ç¡®å®š List ä¸­å”¯ä¸€çš„ resource Setã€‚</li></ul></li></ol><p>ä»¥ä¸Šçš„æè¿°å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/5G_Protocol/5G-NR-CSI-Report/p5-%E9%9D%9E%E5%91%A8%E6%9C%9F1.png" alt></p><h3 id="2-3-å„ç§åœºæ™¯"><a class="header-anchor" href="#2-3-å„ç§åœºæ™¯">Â¶</a>2.3 å„ç§åœºæ™¯</h3><p>æ ¹æ®ä¹‹å‰æ€»ç»“ä¸‹ï¼š</p><ul><li><p><strong><font color="#0000FF">å‘¨æœŸæ€§ä¸ŠæŠ¥</font></strong>ï¼šåªèƒ½ä½¿ç”¨**<font color="#0000FF">å‘¨æœŸæ€§ CSI-RS</font>**ï¼›</p></li><li><p>**<font color="#008000">åŠæŒç»­æ€§ä¸ŠæŠ¥ </font><strong>On Pucchï¼šå¯ä»¥ä½¿ç”¨</strong><font color="#0000FF">å‘¨æœŸæ€§</font><strong>å’Œ</strong><font color="#008000">åŠæŒç»­æ€§</font>**CSI-RSï¼›</p></li><li><p>**<font color="#008000">åŠæŒç»­æ€§ä¸ŠæŠ¥ </font><strong>On Puschï¼šå¯ä»¥ä½¿ç”¨</strong><font color="#0000FF">å‘¨æœŸæ€§</font><strong>å’Œ</strong><font color="#008000">åŠæŒç»­æ€§</font>**CSI-RSï¼›</p></li><li><p><strong><font color="#FF0000">éå‘¨æœŸæ€§ä¸ŠæŠ¥</font></strong>ï¼šå¯ä»¥ä½¿ç”¨**<font color="#0000FF">å‘¨æœŸæ€§</font><strong>ï¼Œ</strong><font color="#008000">åŠæŒç»­æ€§</font><strong>å’Œ</strong><font color="#FF0000">éå‘¨æœŸæ€§</font>**CSI-RSã€‚</p></li></ul><p>æœ‰å…«ç§å¯èƒ½çš„é€‰æ‹©ã€‚</p><h4 id="2-3-1-å‘¨æœŸä¸ŠæŠ¥"><a class="header-anchor" href="#2-3-1-å‘¨æœŸä¸ŠæŠ¥">Â¶</a>2.3.1 å‘¨æœŸä¸ŠæŠ¥</h4><p><strong><font color="#0000FF">å‘¨æœŸä¸ŠæŠ¥ï¼Œå‘¨æœŸCSI-RS</font></strong>ï¼š</p><p><img src="/5G_Protocol/5G-NR-CSI-Report/p6-%E5%91%A8%E5%91%A8.png" alt></p><h4 id="2-3-2-åŠæŒç»­ä¸ŠæŠ¥"><a class="header-anchor" href="#2-3-2-åŠæŒç»­ä¸ŠæŠ¥">Â¶</a>2.3.2 åŠæŒç»­ä¸ŠæŠ¥</h4><h5 id="2-3-2-1-åŠæŒç»­ä¸ŠæŠ¥-On-PUCCH"><a class="header-anchor" href="#2-3-2-1-åŠæŒç»­ä¸ŠæŠ¥-On-PUCCH">Â¶</a>2.3.2.1 åŠæŒç»­ä¸ŠæŠ¥ On PUCCH</h5><ul><li><strong><font color="#0000FF">å‘¨æœŸ</font></strong> <strong>CSI-RS</strong></li></ul><p><img src="/5G_Protocol/5G-NR-CSI-Report/p6-%E5%8D%8AC%E5%91%A8.png" alt></p><ul><li><strong><font color="#008000">åŠæŒç»­</font></strong> <strong>CSI-RS</strong></li></ul><p><img src="/5G_Protocol/5G-NR-CSI-Report/p9-%E5%8D%8AC%E5%8D%8A.png" alt></p><h6 id="2-3-2-2-åŠæŒç»­ä¸ŠæŠ¥-On-PUSCH"><a class="header-anchor" href="#2-3-2-2-åŠæŒç»­ä¸ŠæŠ¥-On-PUSCH">Â¶</a>2.3.2.2 åŠæŒç»­ä¸ŠæŠ¥ On PUSCH</h6><ul><li><strong><font color="#0000FF">å‘¨æœŸ</font></strong> <strong>CSI-RS</strong></li></ul><p><img src="/5G_Protocol/5G-NR-CSI-Report/p8-%E5%8D%8AS%E5%91%A8.png" alt></p><ul><li><strong><font color="#008000">åŠæŒç»­</font></strong> <strong>CSI-RS</strong></li></ul><p><img src="/5G_Protocol/5G-NR-CSI-Report/p10-%E5%8D%8AS%E5%8D%8A.png" alt></p><h4 id="2-3-3-éå‘¨æœŸä¸ŠæŠ¥"><a class="header-anchor" href="#2-3-3-éå‘¨æœŸä¸ŠæŠ¥">Â¶</a>2.3.3 éå‘¨æœŸä¸ŠæŠ¥</h4><p><strong><font color="#0000FF">å‘¨æœŸ</font></strong> <strong>CSI-RS</strong></p><p><img src="/5G_Protocol/5G-NR-CSI-Report/p11-%E9%9D%9E%E5%91%A8.png" alt></p><p><strong><font color="#008000">åŠæŒç»­</font></strong> <strong>CSI-RS</strong></p><p><img src="/5G_Protocol/5G-NR-CSI-Report/p12-%E9%9D%9E%E5%8D%8A.png" alt></p><p><strong><font color="#FF0000">éå‘¨æœŸ</font></strong> <strong>CSI-RS</strong></p><p><img src="/5G_Protocol/5G-NR-CSI-Report/p13-%E9%9D%9E%E9%9D%9E.png" alt></p><h2 id="3-CSI-Report-é…ç½®"><a class="header-anchor" href="#3-CSI-Report-é…ç½®">Â¶</a>3 CSI Report é…ç½®</h2><p>é…ç½®CSI Reportæ¶‰åŠçš„å†…å®¹è¾ƒå¤šï¼Œä¹Ÿæ¯”è¾ƒå¤æ‚ã€‚ä¸Šé¢é˜è¿°äº†CSI Reporté…ç½®çš„ä¸€éƒ¨åˆ†å†…å®¹ï¼Œå³å¦‚ä½•å…³è”è¦æµ‹é‡çš„ CSI-RS resource ä»¥åŠ CSI ä¸ŠæŠ¥çš„ç±»å‹ï¼ˆ<strong><font color="#0000FF">å‘¨æœŸ</font>ï¼Œ<font color="#FF0000">éå‘¨æœŸ</font>, <font color="#008000">åŠæŒç»­</font></strong>ï¼‰ã€‚ä»¥ä¸‹é˜è¿°å‰©ä¸‹çš„é…ç½®å†…å®¹ï¼Œå¦‚ report quantityï¼Œé¢‘åŸŸçš„ä¸ŠæŠ¥ç²’åº¦ï¼ˆå®½å¸¦/çª„å¸¦ï¼‰ï¼ŒChannel/Interference Measumentæ˜¯å¦æ—¶åŸŸå—é™ï¼Œcqi-tableçš„é€‰æ‹©ï¼ŒsubbandSize çš„é€‰æ‹©ä»¥åŠ codebook çš„é…ç½®ã€‚</p><h3 id="3-1-æµ‹é‡ä¸ä¸ŠæŠ¥"><a class="header-anchor" href="#3-1-æµ‹é‡ä¸ä¸ŠæŠ¥">Â¶</a>3.1 æµ‹é‡ä¸ä¸ŠæŠ¥</h3><p>å‚è€ƒå‰æ–‡</p><h3 id="3-2-ä¸ŠæŠ¥å†…å®¹"><a class="header-anchor" href="#3-2-ä¸ŠæŠ¥å†…å®¹">Â¶</a>3.2 ä¸ŠæŠ¥å†…å®¹</h3><p>ä¸»è¦æ˜¯å…³äº reportQuantity çš„è®¾ç½®ï¼ŒæŒ‡æ˜ UE éœ€è¦ä¸ŠæŠ¥å“ªäº›æµ‹é‡å†…å®¹ï¼Œä¸»è¦åˆ†ä¸ºä¸¤ç±»ï¼š</p><ul><li>CSIï¼šCQIï¼ŒPMIï¼ŒR1ï¼ŒCRIï¼Œi1ï¼Œä¸»è¦ç”¨äºç»™ gNB æä¾›è°ƒåº¦æ–¹é¢çš„è¾…åŠ©ä¿¡æ¯</li><li>L1-RSRPï¼šcri-RSRPï¼ŒSSB-Index-RSRPï¼Œä¸»è¦ä¸º gNB æä¾› Beam ç®¡ç†çš„ä¿¡æ¯</li></ul><h3 id="3-3-é¢‘åŸŸä¸ŠæŠ¥ç²’åº¦é…ç½®"><a class="header-anchor" href="#3-3-é¢‘åŸŸä¸ŠæŠ¥ç²’åº¦é…ç½®">Â¶</a>3.3 é¢‘åŸŸä¸ŠæŠ¥ç²’åº¦é…ç½®</h3><p>é«˜å±‚å‚æ•°ï¼šreportFreqConfiguration</p><ul><li><em>csi-ReportingBand</em> å®šä¹‰ä¸€ä¸ª CSI reporting bandï¼Œè¿™ä¸ª reporting bandæ˜¯ç”±BWPå†…åˆ’åˆ†çš„subband ç»„æˆçš„å­é›†åˆï¼Œè¿™äº› subbandå¯ä»¥è¿ç»­ä¹Ÿå¯ä»¥ä¸è¿ç»­ã€‚ç”±ä¸€ä¸ª bitmap æ¥æŒ‡å®šéœ€è¦ä¸ŠæŠ¥å“ªäº› subbandã€‚æ¯”å¦‚è¿™ä¸ªä¾‹å­ subbands<strong>12</strong> = <strong>11</strong>00<strong>1111</strong>00<strong>11</strong>ã€‚</li></ul><p><img src="/5G_Protocol/5G-NR-CSI-Report/p15-subbands.png" alt></p><ul><li><em>cqi-FormatIndicator</em> ç”¨äºè¡¨æ˜ U Eéœ€è¦ä¸ŠæŠ¥ single(wideband) è¿˜æ˜¯multiple(subband) çš„CQIã€‚CQIæ˜¯é’ˆå¯¹æ¯ä¸ª TBï¼ˆcodewordï¼‰åé¦ˆçš„ã€‚å¦‚æœé…ç½®ä¸º subband çš„CQIåé¦ˆï¼Œæ¯ä¸ªsubbandä¸Šçš„CQIåé¦ˆå…¶å®æ˜¯ä¸€ä¸ªä¸ wideband CQIçš„å·®å€¼ï¼Œå…¬å¼å¦‚ä¸‹ï¼š</li></ul><blockquote><p>Sub-band Offset level (s) = sub-band CQI index (s) - wideband CQI index</p></blockquote><p>ç„¶åå†æŒ‰ç…§[TS 38.214 Table 5.2.2.1-1]] å°†offset levelè½¬æ¢æˆè¦æŠ¥çš„ subband differential CQIå€¼ï¼š</p><p><img src="/5G_Protocol/5G-NR-CSI-Report/t2-214-5.2.2.1-1.png" alt></p><ul><li><em>pmi-FormatIndicator</em> ç”¨äºè¡¨æ˜ UE éœ€è¦ä¸ŠæŠ¥ single(wideband) è¿˜æ˜¯ multiple(subband)çš„ PMIã€‚</li></ul><p>ä¸€ä¸ªCSI Reporté…ç½®åˆ°åº•æ˜¯wideband è¿˜æ˜¯subbandçš„CQI/PMIï¼Œè¿™å–å†³äºå‡ ä¸ªRRCå‚æ•°é…ç½®çš„ç»„åˆï¼Œ TS 38.214å¯¹ wideband å’Œ suband çš„å‚æ•°ç»„åˆæœ‰æ˜ç¡®è§„å®šï¼Œå¯ä»¥æ€»ç»“æˆå¦‚ä¸‹è¡¨æ ¼:</p><p>![](5G-NR-CSI-Report/p16 wideband subband.png)</p><h3 id="3-4-å…¶ä»–"><a class="header-anchor" href="#3-4-å…¶ä»–">Â¶</a>3.4 å…¶ä»–</h3><ul><li><p><em>timeRestrictionForChannelMeasurements</em> å’Œ <em>timeRestrictionForInterferenceMeasurements</em> æ˜¯ç”¨æ¥è§„å®šæ˜¯å¦åœ¨æ—¶åŸŸä¸Šå¯¹ä¿¡é“æµ‹é‡å’Œå¹²æ‰°æµ‹é‡è¿›è¡Œé™åˆ¶ã€‚</p></li><li><p><em>codebookConfig</em>:è¿™ä¸ª IE æ˜¯é‡Œé¢éå¸¸éå¸¸é‡è¦çš„ï¼Œä¹Ÿæ˜¯éå¸¸éå¸¸å¤æ‚çš„ã€‚å®ƒæ˜¯é…ç½®æœ‰å…³MIMO codebookå’ŒPMIç›¸å…³çš„å†…å®¹ã€‚</p></li><li><p><em>cqi-Table</em>: æ˜¯ç”¨æ¥é…ç½® UE åº”è¯¥ä½¿ç”¨å“ªå¼  CQI è¡¨ä½œä¸º CQI åé¦ˆä¾æ®çš„ã€‚38214 é‡Œé¢ä¸€å…±æœ‰ä¸‰å¼  CQIè¡¨ã€‚UE é€šè¿‡ CQI çš„æµ‹é‡å’Œä¸ŠæŠ¥æ¥å½±å“ gNB ä¸‹è¡Œè°ƒåº¦çš„ MCSï¼Œç›®æ ‡æ˜¯æ˜¯é€‚åº”æ— çº¿é“¾è·¯çš„å˜åŒ–ï¼Œä½¿å¾—BLER æ§åˆ¶åœ¨ç›®æ ‡å€¼å†…ã€‚å…¶ä¸­ table1 å’Œ table2 é€‚ç”¨äºeMBBåœºæ™¯ï¼Œç›®æ ‡BLER=0.1ï¼›table3 ç”¨äºURLLC åœºæ™¯ï¼Œç›®æ ‡BLER=0.00001</p></li><li><p><em>subbandSize</em>: åè®®ä¸­è§„å®šå¯ä»¥ä¸ŠæŠ¥ subband CQI/PMIï¼Œé‚£ä¹ˆå°±éœ€è¦è¦çŸ¥é“è¿™äº› subband æ˜¯æ€ä¹ˆåˆ’åˆ†çš„ï¼Œä»–ä»¬çš„<strong>ä½ç½®</strong>å’Œ<strong>å¤§å°</strong>æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚åè®®é‡Œé¢æ˜¯æœ‰è§„å®šçš„ã€‚æ¯ä¸ª subband çš„å¤§å°æ˜¯ä¸BWP çš„å¤§å°ç›¸å…³çš„ï¼Œé™åˆ¶ç»„åˆå¦‚ [TS 38.214 Table 5.2.1.4-2]ã€‚çŸ¥é“äº† subband çš„å¤§å°å’Œ BWP çš„å¤§å°ï¼Œå°±å¯ä»¥ç¡®å®šåˆ’åˆ†äº†å¤šå°‘ä¸ª subbandï¼Œç„¶åå°±å¯ä»¥é…ç½® subband report çš„ bitmapäº†ã€‚</p></li></ul><p><img src="/5G_Protocol/5G-NR-CSI-Report/t3-214-5.2.1.4-2.png" alt></p><h2 id="4-CSI-Report-On-PUCCH-PUSCH"><a class="header-anchor" href="#4-CSI-Report-On-PUCCH-PUSCH">Â¶</a>4 CSI Report On PUCCH / PUSCH</h2><h3 id="4-1-CSI-report-on-PUSCH"><a class="header-anchor" href="#4-1-CSI-report-on-PUSCH">Â¶</a>4.1 CSI report on PUSCH</h3><p>éå‘¨æœŸ CSI report on puschæ”¯æŒ TypeI å’Œ TypeII çš„ wideband and subband CSIï¼›</p><p>åŠæŒç»­ on PUSCHæ”¯æŒ TypeI å’Œ TypeII çš„ wideband and subband CSIï¼›</p><p>å¯¹äºType I å’Œ TypeII CSI on PUSCH, Payloadå¯èƒ½å¾ˆå¤§ï¼ŒCSIé‡‡ç”¨ two parts çš„è§£å†³æ–¹æ¡ˆpart1+part2ï¼ŒPart 1çš„ payload å¤§å°å›ºå®šè€Œä¸”å¯ä»¥ç”¨äºåˆ¤æ–­ part2 çš„ bit æ•°ã€‚Part1 å’Œ Part2 åœ¨ä¸åŒæƒ…å†µä¸‹åŒ…å«çš„å†…å®¹æ˜¯ä¸åŒçš„ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><ul><li><p>Type I<br>Part1ï¼šRI, CRI, CQI for 1st codeword<br>Part2ï¼šPMI and CQI for the 2nd codeword if RI&gt;4</p></li><li><p>Type II<br>Part1ï¼šRI, CQIï¼Œæ¯ä¸ªlayerçš„é0å®½å¸¦å¹…åº¦ç³»æ•°<br>Part2ï¼šPMI</p></li></ul><p>å½“reportQuantity è¢«è®¾ç½®ä¸º â€˜cri-RSRPâ€™ or 'ssb-Index-RSRPâ€™, the CSI feedback consists of a single part.</p><p>ç”±äº PUSCH å¯èƒ½ä¸€æ¬¡æ€§æ— æ³•è£…ä¸‹è¦åé¦ˆçš„ CSIï¼Œå¯èƒ½éœ€è¦åšå–èˆï¼Œä¸¢æ‰ä¸€äº›å†…å®¹ã€‚ä¸¢æ‰å“ªäº›å†…å®¹å‘¢ï¼Œå–å†³äºå„å†…å®¹çš„ä¼˜å…ˆçº§ï¼ˆå¦‚ä¸‹å›¾ï¼‰ï¼š</p><p><img src="/5G_Protocol/5G-NR-CSI-Report/t4-214-5.2.3-1.png" alt></p><h3 id="4-2-CSI-report-on-PUCCH"><a class="header-anchor" href="#4-2-CSI-report-on-PUCCH">Â¶</a>4.2 CSI report on PUCCH</h3><p>å‘¨æœŸæ€§ CSI report å¯ä»¥ä½¿ç”¨PUCCH format2/3/4 æ¥æ”¯æŒtype1 CSI widebandä¸ŠæŠ¥ï¼›</p><p>åŠæŒç»­ CSI on PUCCH æ”¯æŒ typeI CSI å’Œæœ‰é™åˆ¶çš„ Type II</p><ul><li>åŠæŒç»­ CSI on pucch format2 æ”¯æŒ type1 wideband</li><li>åŠæŒç»­ CSI on pucch format 3/4 æ”¯æŒ type1 wideband/subband å’ŒType II CSI part 1</li></ul><p>UE åœ¨ä½¿ç”¨ PUCCH format4ä¸ŠæŠ¥ CSI æ—¶ï¼ŒUCI+CRCbitæ•°åº”è¯¥å°äºç­‰äº115 bit</p><p><strong>æ€»ç»“å¦‚ä¸‹ï¼š</strong></p><p><img src="/5G_Protocol/5G-NR-CSI-Report/%E8%A1%A8%E6%A0%BC.png" alt></p><blockquote><p>å‚è€ƒï¼š<br>å…¬ä¼—å·ï¼šGiveMe5Gï¼Œæ˜¥å¤©å·¥ä½œå®¤<br>åè®®ï¼šTS 38.214</p></blockquote><!-- rebuild by neat -->]]></content>
      <categories>
        <category>5G_Protocol</category>
      </categories>
      <tags>
        <tag>CSI</tag>
      </tags>
  </entry>
  <entry>
    <title>5G-NR-ä¼ è¾“æµç¨‹</title>
    <url>/5G_Protocol/5G-NR-%E4%BC%A0%E8%BE%93%E6%B5%81%E7%A8%8B/</url>
    <content><![CDATA[<!-- build time:Tue Jun 22 2021 17:02:33 GMT+0800 (GMT+08:00) --><a id="more"></a><h1>åŸºäºç æœ¬ä¼ è¾“æµç¨‹</h1><h2 id="æ¦‚è¿°"><a class="header-anchor" href="#æ¦‚è¿°">Â¶</a>æ¦‚è¿°</h2><p>æ‰€è°“çš„ç æœ¬ï¼Œä¸»è¦å†…å®¹æ˜¯é¢„ç¼–ç çŸ©é˜µç´¢å¼• (PMI) å’Œ é¢„ç¼–ç çŸ©é˜µ (precoding matrix) ã€‚<br>åŸºäºç æœ¬çš„ä¼ è¾“æµç¨‹å°±æ˜¯æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­ä½¿ç”¨çš„é¢„ç¼–ç çŸ©é˜µé‡‡ç”¨çš„æ˜¯ç”±ç æœ¬ä¸­è§„å®šçš„é¢„ç¼–ç çŸ©é˜µã€‚</p><p>å¯¹äºä¸Šè¡Œå’Œä¸‹è¡Œç æœ¬çš„ç¡®å®šï¼Œæœ‰ä¸åŒçš„æ–¹å¼ï¼š</p><ul><li>ä¸‹è¡Œï¼šç»ˆç«¯æµ‹é‡CSIåï¼Œå¯¹ PMI çš„åé¦ˆï¼ŒåŸºç«™è·çŸ¥ç»ˆç«¯æ¨èçš„é¢„ç¼–ç çŸ©é˜µ</li><li>ä¸Šè¡Œï¼šåŸºç«™æµ‹é‡SRSåï¼Œé€šè¿‡ DCI è°ƒåº¦ï¼Œå°† TPMI ,TRI å‘é€ç»™ç»ˆç«¯ï¼Œç»ˆç«¯æŒ‰ç…§ç´¢å¼•é€‰å–é¢„ç¼–ç çŸ©é˜µã€‚</li></ul><h2 id="é¢„ç¼–ç çŸ©é˜µçš„ä½¿ç”¨"><a class="header-anchor" href="#é¢„ç¼–ç çŸ©é˜µçš„ä½¿ç”¨">Â¶</a>é¢„ç¼–ç çŸ©é˜µçš„ä½¿ç”¨</h2><p>ä¸‹è¡Œï¼šé‡‡å– Transmission scheme 1ï¼ŒåŸºç«™å°†æ•°æ®å’Œ DMRS ä¸€åŒé¢„ç¼–ç ï¼Œä¹‹åé€šè¿‡æ— çº¿ä¿¡é“ï¼Œå‘é€ç»™ç»ˆç«¯ã€‚ç»ˆç«¯å¯ä»¥ç›´æ¥é€šè¿‡ DMRS ä¼°è®¡å‡ºä¿¡é“ä¿¡é“çŸ©é˜µ Hâ€™ (ç»ˆç«¯è®¤ä¸º)ï¼Œå®é™… ğ»â€²=ğ»âˆ—ğ‘Šï¼Œå› æ­¤é¢„ç¼–ç çŸ©é˜µå¯¹ç»ˆç«¯æ¥è¯´æ˜¯é€æ˜çš„ã€‚</p><p>ä¸Šè¡Œï¼šç»ˆç«¯éœ€è¦çŸ¥é“åŸºç«™é…ç½®ç»™å®ƒçš„é¢„ç¼–ç çŸ©é˜µï¼ŒPUSCHæ•°æ®åœ¨å±‚æ˜ å°„åï¼Œæˆ–å˜æ¢é¢„ç¼–ç  (å¦‚æœä½¿ç”¨) åï¼Œè¿›è¡Œé¢„ç¼–ç æ“ä½œã€‚</p><h2 id="ä¸‹è¡ŒåŸºäºç æœ¬ä¼ è¾“æµç¨‹"><a class="header-anchor" href="#ä¸‹è¡ŒåŸºäºç æœ¬ä¼ è¾“æµç¨‹">Â¶</a>ä¸‹è¡ŒåŸºäºç æœ¬ä¼ è¾“æµç¨‹</h2><p>gNBç¡®å®šä¸‹è¡Œé¢„ç¼–ç çŸ©é˜µä¸»è¦é€šè¿‡ä¸¤ä¸ªé€”å¾„ï¼š</p><ul><li>åŸºäº PMI çš„åé¦ˆ â†’ åŸºäºç æœ¬</li><li>gNB é€šè¿‡ SRS ä¸Šè¡Œå‚è€ƒä¿¡å·çš„æµ‹é‡ï¼ˆåˆ©ç”¨TDDç³»ç»Ÿçš„ä¿¡é“äº’å¼‚æ€§ï¼‰â†’ åŸºäºéç æœ¬</li></ul><h3 id="ç æœ¬åˆ†ç±»"><a class="header-anchor" href="#ç æœ¬åˆ†ç±»">Â¶</a>ç æœ¬åˆ†ç±»</h3><p>Type I codebookï¼šä¸»è¦ç”¨äº SU-MIMO åœºæ™¯ï¼Œå¯ä»¥æä¾›æ¯”è¾ƒé«˜é˜¶çš„ç©ºé—´å¤ç”¨ï¼Œå•ç”¨æˆ·æœ€å¤šå¯ä»¥æ”¯æŒåˆ° 8 ä¸ª layerã€‚TypeI codebook åˆå¯ä»¥åˆ†ä¸º single panelå’Œ multiple panel ä¸¤ç§ç±»å‹ã€‚</p><p>Type II codebook: ä¸»è¦ç”¨äº MU-MIMO åœºæ™¯ï¼Œç”±äºè¦åœ¨åŒä¸€æ—¶é¢‘èµ„æºä¸ŠåŒæ—¶è°ƒåº¦å¤šä¸ªç”¨æˆ·ï¼Œæ¯ä¸ªç”¨æˆ·é™åˆ¶æœ€å¤šæ”¯æŒåˆ° 2 ä¸ª layerã€‚æ¯”è¾ƒå¤æ‚ã€‚</p><p>ç æœ¬ä¸­ä¸»è¦çš„å†…å®¹å°±æ˜¯ PMI index å’Œ precoding matrixï¼Œæ¯ä¸ª PMI å’Œé¢„ç¼–ç çŸ©é˜µä¸€ä¸€å¯¹åº”ã€‚ç»ˆç«¯ä¸ŠæŠ¥ PMIï¼Œå°†è‡ªå·±è®¤ä¸ºæœ€åˆé€‚çš„é¢„ç¼–ç çŸ©é˜µ index å‘é€ç»™åŸºç«™åšå‚è€ƒï¼ŒåŸºç«™å¯ä»¥ä½¿ç”¨ç»ˆç«¯çš„å»ºè®®ï¼Œä¹Ÿå¯ä»¥ä¸ä½¿ç”¨ï¼Œå› ä¸ºåŸºç«™ä¼šç«™åœ¨ä¸€ä¸ªæ›´å…¨å±€çš„ç½‘ç»œæ¥åšä¸€ä¸ªæœ€ä¼˜çš„é€‰æ‹©ï¼Œä¸ä½†è¦è€ƒè™‘ç›®æ ‡ç»ˆç«¯çš„è§£è°ƒæ€§èƒ½ï¼Œè¿˜è¦è€ƒè™‘è¿™ä¸ªå°åŒºå†…å…¶ä»–ç”¨æˆ·çš„æ„Ÿå—ã€‚</p><h2 id="PMI-å¦‚ä½•ç¡®å®šï¼Ÿ"><a class="header-anchor" href="#PMI-å¦‚ä½•ç¡®å®šï¼Ÿ">Â¶</a>PMI å¦‚ä½•ç¡®å®šï¼Ÿ</h2><p>ä»¥ Type I Single-Panelï¼Œä»¥æ­¤ä¸ºä¾‹ï¼Œæ¥çœ‹ç»ˆç«¯æ˜¯å¦‚ä½•é€‰æ‹© precoding matrixï¼Œä»¥åŠå¦‚ä½•ç¡®å®šPMIçš„ã€‚</p><p><strong>â‘  CSI-RS çš„ç«¯å£æ•°é‡ <em>nrofAntennaPorts</em> = 2ï¼š</strong><br>ç»ˆç«¯æ ¹æ®æµ‹é‡å¾—åˆ°çš„ RIï¼Œç¡®å®šé€‰æ‹© 1 or 2 layerï¼Œç„¶åä» [TS 38.214 Table 5.2.2.2.1-1] ä¸­çš„é¢„ç¼–ç çŸ©é˜µä¸­é€‰å–ï¼Œå¹¶å°†å¯¹åº”çš„ index å³ PMI åé¦ˆç»™åŸºç«™ã€‚æ­¤æ—¶å‚æ•° <em>twoTX-CodebookSubsetRestriction</em> æœ‰ 6 bitsï¼Œä¸ 6 ä¸ªå¯ç”¨çš„precoding matrix ä¸€ä¸€å¯¹åº”ï¼Œå¦‚æœè¿™ä¸ª bitmap ä¸­çš„æŸä¸€ä¸ªbitç½®ä¸º0ï¼Œæ„å‘³ç€åŸºç«™ä¸å…è®¸ç»ˆç«¯ä½¿ç”¨è¿™ä¸ªé¢„ç¼–ç çŸ©é˜µã€‚ æ­¤å¤– <em>typeI-SinglePanel-ri-Restriction</em> è¿™ä¸ª IE æ˜¯ç”¨æ¥å¯¹ RI ä¸ŠæŠ¥åšé™åˆ¶çš„ã€‚è¿™æ˜¯ 1 ä¸ª 8 bits çš„ bitmap å¯¹åº”äº type1-singlepanel å¯ä»¥æ”¯æŒæœ€é«˜8ä¸ªlayerã€‚</p><p><img src="/5G_Protocol/5G-NR-%E4%BC%A0%E8%BE%93%E6%B5%81%E7%A8%8B/t1-214-5.2.2.2.1-1.png" alt></p><p><strong>â‘¡ CSI-RS çš„ç«¯å£æ•°é‡ <em>nrofAntennaPorts</em> = {4,8,12,16,24,32}:</strong></p><ul><li><p>å¯¹äº $v \in {2,3,4}$ , PMI åé¦ˆå€¼ä¸º $i_{1,1},i_{1,2},i_{1,3},i_{2}$</p><ul><li>é¦–å…ˆæ ¹æ® RRC å‚æ•°ä¸­çš„ <em>n1-n2</em> çš„é…ç½®ï¼Œå¾—åˆ° N1 å’Œ N2 çš„å€¼ï¼Œç„¶åç»“åˆ CSI-RS çš„ç«¯å£æ•°é‡ï¼Œä»¥åŠ [TS 38.214 Table 5.2.2.2.1-2]ï¼Œå¾—åˆ° O1 å’Œ O2ï¼›</li><li>å‚è€ƒ [TS 38.214 Table 5.2.2.2.1-6~8]ï¼Œç»ˆç«¯åœ¨é€‰å®šé¢„ç¼–ç çŸ©é˜µåå°±å¯ä»¥ç¡®å®šå®ƒçš„ä¸‹æ ‡ï¼Œå¯ä»¥ $i_{1,1}, i_{1,2}, i_2, k_1å’Œk_2$ï¼›</li><li>å‚è€ƒ [TS 38.214 Table 5.2.2.2.1-3~4]ï¼Œå¯ä»¥æ ¹æ® $i_{1,3}$ ä¸ $k_1$ å’Œ $k_2$ çš„å…³ç³»ï¼Œå¾—åˆ° $i_{1, 3}$ï¼›</li><li>æœ€ç»ˆå¾—åˆ°ç»ˆç«¯è¦åé¦ˆçš„ PMI = {$i_{1,1},i_{1,2},i_{1,3},i_{2}$}</li></ul></li><li><p>å¯¹äº $v \notin {2,3,4}$ , PMI åé¦ˆå€¼ä¸º $i_{1,1},i_{1,2},i_{2}$ (ä¸å‰è€…ç±»ä¼¼)</p><ul><li>é¦–å…ˆæ ¹æ® RRC å‚æ•°ä¸­çš„ <em>n1-n2</em> çš„é…ç½®ï¼Œå¾—åˆ° N1 å’Œ N2 çš„å€¼ï¼Œç„¶åç»“åˆ CSI-RS çš„ç«¯å£æ•°é‡ï¼Œä»¥åŠ [TS 38.214 Table 5.2.2.2.1-2]ï¼Œå¾—åˆ° O1 å’Œ O2ï¼›</li><li>å‚è€ƒ [TS 38.214 Table 5.2.2.2.1-5,9~12]ï¼Œç»ˆç«¯åœ¨é€‰å®šé¢„ç¼–ç çŸ©é˜µåå°±å¯ä»¥ç¡®å®šå®ƒçš„ä¸‹æ ‡ï¼Œå¯ä»¥ $i_{1,1}, i_{1,2}, i_2, k_1å’Œk_2$ï¼›</li><li>æœ€ç»ˆå¾—åˆ°ç»ˆç«¯è¦åé¦ˆçš„ PMI = {$i_{1,1},i_{1,2},i_{2}$}</li></ul></li></ul><p><img src="/5G_Protocol/5G-NR-%E4%BC%A0%E8%BE%93%E6%B5%81%E7%A8%8B/t2-214-5.2.2.2.1-2.png" alt></p><p><img src="/5G_Protocol/5G-NR-%E4%BC%A0%E8%BE%93%E6%B5%81%E7%A8%8B/t3-214-5.2.2.2.1-3~4.png" alt></p><p>è¡¨æ ¼å¾ˆå¤šï¼Œé€‰å–äº†ä¸€ä¸ªç¤ºä¾‹ï¼š</p><p><img src="/5G_Protocol/5G-NR-%E4%BC%A0%E8%BE%93%E6%B5%81%E7%A8%8B/t4-214-5.2.2.2.1-6.png" alt></p><h2 id="ä¸Šè¡ŒåŸºäºç æœ¬ä¼ è¾“æµç¨‹"><a class="header-anchor" href="#ä¸Šè¡ŒåŸºäºç æœ¬ä¼ è¾“æµç¨‹">Â¶</a>ä¸Šè¡ŒåŸºäºç æœ¬ä¼ è¾“æµç¨‹</h2><p>åŸºç«™åŸºäº TDD æ¨¡å¼çš„ä¸‹è¡Œé“¾è·¯æµ‹é‡ï¼Œæˆ–æ¢æµ‹å‚è€ƒä¿¡å·çš„ä¸Šè¡Œé“¾è·¯æµ‹é‡æ¥ç¡®å®šé¢„ç¼–ç çŸ©é˜µã€‚ç„¶ååŸºç«™åœ¨ DCI ä¸­æŒ‡ç¤ºé¢„ç¼–ç ä¿¡æ¯ (TMPI , TRI) å‘é€ç»™ UEï¼ŒUE é€šè¿‡æœç´¢ä¸€ç³»åˆ—é¢„å®šä¹‰çš„è¡¨æ ¼æ•°æ®å¾—åˆ°é¢„ç¼–ç çŸ©é˜µã€‚[TS 38.211 Table 6.3.1.5-1~7]</p><p>è¡¨æ ¼å¾ˆå¤šï¼Œé€‰å–äº†ä¸€ä¸ªç¤ºä¾‹ï¼š</p><p><img src="/5G_Protocol/5G-NR-%E4%BC%A0%E8%BE%93%E6%B5%81%E7%A8%8B/t5-211-6.3.1.5-1.png" alt></p><p><img src="/5G_Protocol/5G-NR-%E4%BC%A0%E8%BE%93%E6%B5%81%E7%A8%8B/t6-211-6.3.1.5-2.png" alt></p><h1>åŸºäºéç æœ¬çš„ä¼ è¾“æµç¨‹</h1><h2 id="æ¦‚è¿°-v2"><a class="header-anchor" href="#æ¦‚è¿°-v2">Â¶</a>æ¦‚è¿°</h2><p>ä¸‹è¡Œï¼šgNB é€šè¿‡SRSä¸Šè¡Œå‚è€ƒä¿¡å·çš„æµ‹é‡ï¼ˆåˆ©ç”¨TDDç³»ç»Ÿçš„ä¿¡é“äº’å¼‚æ€§ï¼‰ï¼ŒåŸºç«™é€šè¿‡å¥‡å¼‚å€¼åˆ†è§£ï¼Œè·å¾—é¢„ç¼–ç çŸ©é˜µã€‚<br>ä¸Šè¡Œï¼šUE é€šè¿‡æµ‹é‡ CSI-RS ä¿¡å·æ¥ç¡®å®šåˆé€‚çš„é¢„ç¼–ç çŸ©é˜µï¼Œç„¶åæŠŠä½¿ç”¨è¿™ä¸ªé¢„ç¼–ç çŸ©é˜µç”¨äºå‘å°„SRSä¿¡å·ã€‚ä¹‹åï¼ŒgNB é€šçŸ¥ UE ä½¿ç”¨æ³¢æŸèµ‹å½¢çŸ¢é‡çš„å“ªä¸ªå­é›†ã€‚æœ€åï¼ŒUEå¯ä»¥å°†é€‰æ‹©çš„æ³¢æŸèµ‹å½¢çŸ¢é‡ç”¨äºPUSCHä¼ è¾“ï¼‰ã€‚</p><!-- rebuild by neat -->]]></content>
      <categories>
        <category>5G_Protocol</category>
      </categories>
      <tags>
        <tag>CSI</tag>
        <tag>SRS</tag>
        <tag>codebook / non-codebook</tag>
      </tags>
  </entry>
  <entry>
    <title>5G-NR-214åè®®è¡¥å……</title>
    <url>/5G_Protocol/5G-NR-214%E5%8D%8F%E8%AE%AE%E8%A1%A5%E5%85%85/</url>
    <content><![CDATA[<!-- build time:Tue Jun 22 2021 17:02:33 GMT+0800 (GMT+08:00) --><a id="more"></a><h1>ä¸Šè¡Œä¼ è¾“æ¨¡å¼</h1><h2 id="æ¦‚è¿°"><a class="header-anchor" href="#æ¦‚è¿°">Â¶</a>æ¦‚è¿°</h2><p>ä¸‹è¡Œæ–¹å‘ï¼šNRä¸­ä»…æ”¯æŒä¸€ç§ä¸‹è¡Œä¼ è¾“æ¨¡å¼ï¼Œå³åŸºäºé—­ç¯ DMRS çš„ç©ºåˆ†å¤ç”¨ PDSCHä¼ è¾“ã€‚å• UE æœ€å¤šæ”¯æŒ 8 ä¸ªæ­£äº¤ç«¯å£ï¼Œ8å±‚ä¼ è¾“ (1-4ï¼šå•ç å­—/5-8å±‚ï¼šä¸¤ç å­—)ã€‚PDSCH çš„ DMRS å’Œ PDSCH é‡‡ç”¨ç›¸åŒçš„é¢„ç¼–ç çŸ©é˜µï¼›åŸºç«™è°ƒåº¦ PDSCH èµ„æºæ—¶ï¼Œæ— éœ€æŒ‡ç¤ºç æœ¬ä¿¡æ¯ï¼Œä¹Ÿç§°ä¸ºéç æœ¬ <em>Non-Codebook</em> ä¼ è¾“ã€‚<br>ä¸Šè¡Œæ–¹å‘ï¼šNR æ”¯æŒä¸¤ç§ä¼ è¾“æ¨¡å¼ï¼šåŸºäºç æœ¬å’Œéç æœ¬çš„ PUSCH ä¼ è¾“ã€‚å•å±‚ UE æœ€å¤š 4 å±‚ä¼ è¾“ï¼Œå•ç å­— (Transform Precodingï¼Œå³DFT-S-OFDMï¼Œä»…æ”¯æŒå•å±‚ä¼ è¾“)ã€‚</p><ul><li>åŸºäºç æœ¬ä¼ è¾“æ—¶ï¼ŒåŸºç«™åœ¨ DCI ä¸­æŒ‡ç¤ºé¢„ç¼–ç çŸ©é˜µä¸­çš„ç´¢å¼•</li><li>åŸºäºéç æœ¬ä¼ è¾“æ—¶ï¼ŒåŸºç«™åœ¨ DCI ä¸­é€šè¿‡ SRI (SRS èµ„æºç´¢å¼•) æ¥è¡¨ç¤º PUSCH çš„é¢„ç¼–ç ç å­—</li></ul><p>PUSCH ä¼ è¾“æ¨¡å¼ï¼šç æœ¬å’Œéç æœ¬<br>åœ¨RRCé«˜å±‚ä¿¡ä»¤ä¸­ <em>PUSCH-Config</em> é…ç½® (UE-Specific)</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">txconfig	ENUMERATED &#123;codebook,nonCodebook&#125;	OPTIONAL, -- Need S</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸é…ç½® <em>txConfig</em> çš„æƒ…å†µä¸‹ï¼Œä¸èƒ½ä½¿ç”¨ DCI 0_1 æ ¼å¼è°ƒåº¦ (å•å¤©çº¿ç«¯å£ï¼Œåœ¨ä½¿ç”¨DCI 0_0 è°ƒåº¦æ—¶ï¼ŒPUSCH åªèƒ½åŸºäºå•å¤©çº¿ç«¯å£ä¼ è¾“)ï¼›<br>å½“é…ç½®ä¸º <em>codebook</em> ä¼ è¾“æ—¶ï¼ŒNR ç³»ç»Ÿå…è®¸åŸºç«™ä¸º UE æœ€å¤šé…ç½®ä¸€ä¸ªç”¨äºåŸºäºç æœ¬ä¸Šè¡Œä¼ è¾“ CSI è·å–çš„ SRS èµ„æºé›†ï¼Œè¯¥ SRS èµ„æºé›†å†…æœ€å¤šå¯é…ç½®ä¸¤ä¸ª SRS èµ„æºåŒ…å«ç›¸åŒçš„ SRS å¤©çº¿ç«¯å£æ•°ã€‚SRIçš„å­—æ®µé•¿åº¦ä¸º $\lceil log_2 (N_{SRS}) \rceil$ã€‚</p><h2 id="åŸºäºç æœ¬ä¼ è¾“"><a class="header-anchor" href="#åŸºäºç æœ¬ä¼ è¾“">Â¶</a>åŸºäºç æœ¬ä¼ è¾“</h2><p>ä¸Šè¡Œ PUSCH ï¼ŒåŸºäºç æœ¬ä¼ è¾“çš„æ€»ä½“æµç¨‹ç¤ºæ„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><ol><li>åŸºç«™ç»™UEé…ç½® 1 æˆ– 2 ä¸ª (æ ¹æ®UEèƒ½åŠ›) SRS èµ„æºï¼ŒUE å‘åŸºç«™å‘é€ç”¨äºåŸºäºç æœ¬çš„ä¸Šè¡Œä¼ è¾“æ–¹æ¡ˆ CSI è·å– çš„ SRS ï¼ŒåŸºç«™è¿›è¡Œä¸Šè¡Œ CSI æµ‹é‡ï¼›</li><li>åŸºç«™æ ¹æ®æµ‹é‡ç»“æœï¼Œç¡®å®š CSI å‚æ•°ï¼ŒåŒ…æ‹¬é€‰æ‹©çš„ SRS èµ„æº (SRI, SRS Resource Indicator) ï¼Œä¼ è¾“çš„é¢„ç¼–ç çŸ©é˜µç´¢å¼• (TPMI, Transmit Precoding Marrix Indicator) å’Œä¼ è¾“ Rank (TRI, Transmit Rank Indicator)ï¼Œå³ä¸Šè¡Œä¼ è¾“çš„å±‚æ•°ï¼›è¿›ä¸€æ­¥æ ¹æ®é¢„ç¼–ç çŸ©é˜µå’Œä¿¡é“ä¿¡æ¯ï¼Œç¡®å®šå‡ºä¸Šè¡Œä¼ è¾“çš„ MCS ç­‰çº§ã€‚</li><li>åŸºç«™é€šè¿‡ DCI ä¿¡ä»¤ï¼ŒæŒ‡ç¤º UE çš„CSI å‚æ•°ï¼Œä»¥åŠç›¸åº”çš„ MCS ã€‚</li><li>UE æ ¹æ®åŸºç«™æŒ‡ç¤ºçš„ MCS å¯¹æ•°æ®è¿›è¡Œè°ƒåˆ¶ç¼–ç ï¼Œå¹¶åˆ©ç”¨æ‰€æŒ‡ç¤ºçš„ SRIã€TPMI å’Œ TRI ç¡®å®šå‘é€æ—¶ä½¿ç”¨çš„é¢„ç¼–ç çŸ©é˜µå’Œä¼ è¾“å±‚æ•°ï¼Œè¿›è€Œå¯¹æ•°æ®è¿›è¡Œé¢„ç¼–ç åŠå‘é€ã€‚PUSCH çš„è§£è°ƒå‚è€ƒä¿¡å·ä¸PUSCH çš„æ•°æ®é‡‡ç”¨ç›¸åŒçš„é¢„ç¼–ç æ–¹å¼ã€‚</li><li>åŸºç«™æ ¹æ®è§£è°ƒå‚è€ƒä¿¡å·ä¼°è®¡ä¸Šè¡Œä¿¡é“ï¼Œå¹¶è¿›è¡Œæ•°æ®æ£€æµ‹ã€‚</li></ol><p><img src="/5G_Protocol/5G-NR-214%E5%8D%8F%E8%AE%AE%E8%A1%A5%E5%85%85/p2-%E7%A0%81%E6%9C%AC%E4%BC%A0%E8%BE%93.png" alt></p><h2 id="åŸºäºéç æœ¬ä¼ è¾“"><a class="header-anchor" href="#åŸºäºéç æœ¬ä¼ è¾“">Â¶</a>åŸºäºéç æœ¬ä¼ è¾“</h2><p>éç æœ¬ä¼ è¾“æ–¹æ¡ˆä¸åŸºäºç æœ¬çš„ä¸Šè¡Œä¼ è¾“æ–¹æ¡ˆçš„åŒºåˆ«åœ¨äºå…¶é¢„ç¼–ç ä¸åœ¨é™å®šäºåŸºäºå›ºå®šç æœ¬çš„æœ‰é™å€™é€‰é›†ï¼ŒUE åŸºäºä¿¡é“äº’æ˜“æ€§ç¡®å®šä¸Šè¡Œé¢„ç¼–ç çŸ©é˜µã€‚è‹¥ä¿¡é“äº’æ˜“æ€§è¶³å¤Ÿå¥½ï¼ŒUE å¯ä»¥è·å¾—è¾ƒä¼˜çš„ä¸Šè¡Œé¢„ç¼–ç ï¼Œç›¸å¯¹äºåŸºäºç æœ¬çš„ä¼ è¾“æ–¹æ¡ˆï¼Œå¯ä»¥èŠ‚çœé¢„ç¼–ç æŒ‡ç¤ºçš„å¼€é”€ï¼ŒåŒæ—¶è·å¾—æ›´å¥½çš„æ€§èƒ½ã€‚</p><p>ä¸Šè¡Œ PUSCH ï¼ŒåŸºäºéç æœ¬ä¼ è¾“çš„æ€»ä½“æµç¨‹ç¤ºæ„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><ol><li>UEæµ‹é‡ä¸‹è¡Œå‚è€ƒä¿¡å·ï¼Œè·å¾—å€™é€‰çš„ä¸Šè¡Œé¢„ç¼–ç çŸ©é˜µï¼Œåˆ©ç”¨ä»–ä»¬å¯¹ç”¨äºéç æœ¬ä¸Šè¡Œä¼ è¾“æ–¹æ¡ˆçš„ SRS è¿›è¡Œé¢„ç¼–ç åå°†å…¶å‘é€ç»™åŸºç«™ã€‚</li><li>åŸºç«™æ ¹æ® UE å‘é€ çš„SRS è¿›è¡Œä¸Šè¡Œä¿¡é“æ£€æµ‹ï¼Œå¯¹ UE è¿›è¡Œèµ„æºè°ƒåº¦ï¼Œç¡®å®šå‡ºä¸Šè¡Œä¼ è¾“å¯¹åº”çš„ SRS èµ„æºå’Œä¸Šè¡Œä¼ è¾“çš„ MCS ç­‰çº§ç­‰ï¼Œå¹¶é€šçŸ¥ UEã€‚å…¶ä¸­ä¸Šè¡Œä¼ è¾“å¯¹åº”çš„ SRS èµ„æºé€šè¿‡ SRI æŒ‡ç¤ºç»™ UEã€‚</li><li>UE æ ¹æ®åŸºç«™å‘é€çš„ MSC å¯¹æ•°æ®è¿›è¡Œè°ƒåˆ¶ç¼–ç ï¼Œå¹¶åˆ©ç”¨ SRI ç¡®å®šæ•°æ®çš„é¢„ç¼–ç å’Œä¼ è¾“å±‚æ•°ï¼Œå¯¹æ•°æ®è¿›è¡Œé¢„ç¼–ç åè¿›è¡Œæ•°æ®çš„å‘é€ã€‚éç æœ¬ä¸Šè¡Œä¼ è¾“æ–¹æ¡ˆä¸‹çš„ PUSCH è§£è°ƒæƒ¨è€ä¿¡å· äºPUSCH çš„æ•°æ®é‡‡ç”¨ç›¸åŒçš„é¢„ç¼–ç æ–¹å¼ã€‚</li><li>åŸºç«™æ ¹æ®è§£è°ƒå‚è€ƒä¿¡å·ä¼°è®¡ä¸Šè¡Œä¿¡é“ï¼Œè¿›è¡Œæ•°æ®æ£€æµ‹ã€‚</li></ol><p><img src="/5G_Protocol/5G-NR-214%E5%8D%8F%E8%AE%AE%E8%A1%A5%E5%85%85/p3-%E9%9D%9E%E7%A0%81%E6%9C%AC%E4%BC%A0%E8%BE%93.png" alt></p><p>å¯¹äºéç æœ¬ä¸Šè¡Œä¼ è¾“æ–¹æ¡ˆï¼ŒåŸºç«™å¯ä»¥ä¸º UE é…ç½® 1 ä¸ªç”¨äºä¸Šè¡Œ CSI è·å–çš„ SRS èµ„æºé›†ï¼ŒåŒ…å« 1~4 ä¸ª SRS èµ„æºï¼Œæ¯ä¸ª SRS èµ„æºåŒ…å« 1 ä¸ªSRS ç«¯å£ã€‚SRI å¯ä»¥æŒ‡ç¤ºä¸€ä¸ªæˆ–å¤šä¸ª SRS èµ„æºï¼Œç”¨äº PUSCH é¢„ç¼–ç çš„ç¡®å®šã€‚SRI æŒ‡ç¤ºçš„ SRS èµ„æºæ•°å³ä¸º PUSCH ä¼ è¾“çš„æµæ•°ï¼ŒPUSCH çš„ä¼ è¾“å±‚äº SRI æŒ‡ç¤ºçš„ SRS èµ„æºä¸€ä¸€å¯¹åº”ã€‚<br>SRS èµ„æºé›†é…ç½®ä¸­ï¼Œå…³è”ä¸€ä¸ª NZP CSI-RS èµ„æºçš„ IDã€‚</p><h2 id="PUSCH-ä¿¡é“é¢„ç¼–ç "><a class="header-anchor" href="#PUSCH-ä¿¡é“é¢„ç¼–ç ">Â¶</a>PUSCH ä¿¡é“é¢„ç¼–ç </h2><p>æ ¹æ®å¦‚ä¸‹å…¬å¼å¯¹å‘é‡å—$[y<sup>{(0)}(i),â€¦,y</sup>{(v-1)}(i)]^{T},i = 0,1,â€¦,M_{symb}^{layer}-1$ è¿›è¡Œé¢„ç¼–ç å¤„ç†ï¼š<br>$$<br>\left[\begin{matrix} z^{(0)}(i)\ \vdots\ z^{(p-1)}(i) \end{matrix} \right]=W\left[\begin{matrix} y^{(0)}(i)\ \vdots \ y^{(p-1)}(i) \end{matrix} \right]<br>$$</p><p>å…¶ä¸­ $i = 0,1,â€¦,M_{symb}^{ap} -1, M_{symb}^{ap} =M_{symb}^{layer}$ ã€‚</p><p>RRC å‚æ•°å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">txConfig				ENUMERATED &#123;codebook,nonCodebook&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºåŸºäºéç æœ¬çš„ä¼ è¾“ï¼Œé¢„ç¼–ç çŸ©é˜µ<strong>W</strong> ä¸ºå•ä½çŸ©é˜µã€‚<br>å¯¹äºåŸºäºç æœ¬çš„ä¼ è¾“ï¼Œé¢„ç¼–ç çŸ©é˜µ<strong>W</strong>ï¼š</p><ul><li><p>When number of layer = 1, number of antenna port = 1ï¼Œ<strong>W</strong> = 1ã€‚</p></li><li><p>When number of layer $\geq$ 1 and number of antenna port $\geq$ 2 ï¼Œ</p><p>æ ¹æ®DCI 0-1ä¸­çš„ â€œPrecoding information and number of layersâ€ ç¡®å®šé¢„ç¼–ç çŸ©é˜µ<strong>W</strong>(å‚è€ƒå¦‚ä¸‹è¡¨æ ¼)ï¼š</p></li></ul><blockquote><p>[TS 38.211 Table 6.3.1.5-1]<br>[TS 38.211 Table 6.3.1.5-2]<br>[TS 38.211 Table 6.3.1.5-3]<br>[TS 38.211 Table 6.3.1.5-4]<br>[TS 38.211 Table 6.3.1.5-5]<br>[TS 38.211 Table 6.3.1.5-6]<br>[TS 38.211 Table 6.3.1.5-7]</p></blockquote><p>æŒ‰ç…§å±‚æ•°ï¼Œå¤©çº¿ç«¯å£æ•°ï¼Œæ˜¯å¦é…ç½®å˜æ¢é¢„ç¼–ç ï¼Œä¸‰è€…çš„å‚æ•°ï¼Œé€‰å–é¢„ç¼–ç çŸ©é˜µï¼Œæ€»ç»“æˆå¦‚ä¸‹è¡¨æ ¼ï¼š</p><table><thead><tr><th>Number of Layers</th><th>Number of Antenna</th><th>Transform Precoding</th><th>Precoding Matrix</th></tr></thead><tbody><tr><td>1</td><td>2</td><td></td><td>211 Table 6.3.1.5-1</td></tr><tr><td>1</td><td>4</td><td>enabled</td><td>211 Table 6.3.1.5-2</td></tr><tr><td>1</td><td>4</td><td>disabled</td><td>211 Table 6.3.1.5-3</td></tr><tr><td>2</td><td>2</td><td>disabled</td><td>211 Table 6.3.1.5-4</td></tr><tr><td>2</td><td>4</td><td>disabled</td><td>211 Table 6.3.1.5-5</td></tr><tr><td>3</td><td>4</td><td>disabled</td><td>211 Table 6.3.1.5-6</td></tr><tr><td>4</td><td>4</td><td>disabled</td><td>211 Table 6.3.1.5-7</td></tr></tbody></table><h1>TS 38.214åè®®è¡¥å……</h1><h2 id="1-ä¸‹è¡Œé“¾è·¯çš„åŠŸç‡åˆ†é…"><a class="header-anchor" href="#1-ä¸‹è¡Œé“¾è·¯çš„åŠŸç‡åˆ†é…">Â¶</a>1 ä¸‹è¡Œé“¾è·¯çš„åŠŸç‡åˆ†é…</h2><p>ä¸‹è¡Œä¼ è¾“çš„EPRE (Energy per resource element) ç”±åŸºç«™ç¡®å®šã€‚</p><ul><li>å¯¹äºæµ‹é‡SS-RSRPï¼ŒSS-RSRQï¼ŒSS-SINRæ¥è¯´ï¼ŒUEä¼šå‡å®šæ•´ä¸ªå¸¦å®½ä¸Šçš„EPREæ˜¯æ’å®šçš„ã€‚</li><li>å¯¹äºæµ‹é‡SS-RSRPï¼ŒSS-RSRQï¼ŒSS-SINRæ¥è¯´ï¼ŒUEä¼šå‡å®šä¸åŒçš„SS/PBCHæ‰¿è½½çš„SSSä¸Šçš„EPREä¹Ÿæ˜¯æ’å®šçš„ã€‚</li><li>å¯¹äºæµ‹é‡SS-RSRPï¼ŒSS-RSRQï¼ŒSS-SINRæ¥è¯´ï¼ŒUEä¼šå‡å®šSSSä¸Šçš„EPREå’Œ PBCH-DMRSä¸Šçš„EPREä¹‹æ¯”ä¸º0 dBã€‚</li><li>å¯¹äºCSI-RSRPï¼ŒCSI-RSRQï¼ŒCSI-SINRæµ‹é‡æ¥è¯´ï¼ŒUEä¼šå‡å®šåŒä¸€ç«¯å£ä¸‹ç»™CSIæ‰€é…ç½®çš„æ‰€æœ‰ä¸‹è¡Œå¸¦å®½çš„EPREæ˜¯æ’å®šçš„ï¼›æ‰€é…ç½®æ‰€æœ‰OFDMä¸Šçš„EPREä¹Ÿæ˜¯æ’å®šçš„ã€‚</li></ul><p>ä¸‹è¡ŒSS/PBCHå—ä¸ŠSSS çš„EPREå¯ä»¥ä»é«˜å±‚é…ç½®çš„SS/PBCHä¸‹è¡Œå‘é€åŠŸç‡å‚æ•°ï¼ˆ<em>SS-PBCH-BlockPower</em>ï¼‰å¾—åˆ°ã€‚ä¸‹è¡ŒSSSä¼ è¾“åŠŸç‡è¢«å®šä¹‰ä¸ºç³»ç»Ÿå¸¦å®½å†…æ‰€æœ‰æ‰¿è½½äº†SSSçš„REä¸Šçš„åŠŸç‡çš„çº¿æ€§å¹³å‡å€¼ï¼ˆå•ä½[W]ï¼‰ã€‚å¯¹äºä¸€ä¸ªå°åŒºæ¥è®²ï¼ŒUEå‡å®šPSS EPREä¸SSS EPREæ¯”ä¸º0dBæˆ–è€…3dBã€‚</p><p>ä¸‹è¡ŒCSI-RSçš„EPREå¯ä»¥ä»é«˜å±‚é…ç½®çš„SS/PBCHä¸‹è¡Œå‘é€åŠŸç‡å‚æ•°ï¼ˆ<em>SS-PBCH-BlockPower</em>ï¼‰ä»¥åŠCSI-RSåŠŸç‡åç§»å‚æ•°ï¼ˆ<em>powerControlOffsetSS</em>ï¼‰å¾—åˆ°ã€‚ä¸‹è¡Œå‚è€ƒä¿¡å·ä¼ è¾“åŠŸç‡è¢«å®šä¹‰ä¸ºç³»ç»Ÿå¸¦å®½å†…æ‰€æœ‰æ‰¿è½½äº†CSI-RSçš„REä¸Šçš„åŠŸç‡çš„çº¿æ€§å¹³å‡å€¼ï¼ˆå•ä½[W]ï¼‰ã€‚</p><p>å¯¹äºPDSCHçš„è§£è°ƒå‚è€ƒä¿¡DMRSè€Œè¨€ï¼ŒUEä¼šæ ¹æ®DCIé…ç½®çš„DMRS CDMç»„æ•°é‡ï¼ˆé™¤å»æ•°æ®ï¼‰åœ¨ä¸‹è¡¨ä¸­æŸ¥æ‰¾PDSCH EPREä¸DMRS EPREæ¯”ã€‚DMRSçš„ç¼©æ”¾å› å­ $\beta_{PDSCH}^{DMRS}$ ç”± [4, TS 38.211] ç»™å‡ºï¼š$\beta_{PDSCH}<sup>{DMRS}=10</sup>{-\frac{\beta_{DMRS}}{20}}$ã€‚</p><p><img src="/5G_Protocol/5G-NR-214%E5%8D%8F%E8%AE%AE%E8%A1%A5%E5%85%85/t1-214-4.1-1.png" alt></p><p>å½“ä½¿ç”¨ä¸PDSCHå…³è”çš„PT-RSç«¯å£è°ƒåº¦UEæ—¶ï¼Œ</p><ul><li>å¦‚æœUEé…ç½®äº†é«˜å±‚å‚æ•° <em>epro-Ratio</em>ï¼Œæ ¹æ®epre-Ratioï¼Œè¡¨4.1-2ç»™å‡ºäº†PT-RSç«¯å£çš„æ¯ä¸ªREçš„æ¯å±‚PT-RS EPREä¸PDSCH EPREçš„æ¯”ç‡ï¼ˆ$Ï_{PTRS}$ï¼‰ï¼ŒPTRSçš„ç¼©æ”¾å› å­ç”± [4, TS 38.211] ç»™å‡ºï¼š$\beta_{PTRS}=10^{\frac{\rho_{PTRS}}{20}}$ï¼›</li><li>å¦åˆ™ï¼Œå¦‚æœæ²¡æœ‰åœ¨è¡¨4.1-2é…ç½®ï¼Œåˆ™UEå°†å‡å®š<em>epro-Ratio</em> è®¾ç½®ä¸ºçŠ¶æ€ 0 ï¼›</li></ul><p><img src="/5G_Protocol/5G-NR-214%E5%8D%8F%E8%AE%AE%E8%A1%A5%E5%85%85/t2-214-4.1-2.png" alt></p><h2 id="2-ç‰©ç†ä¸‹è¡Œé“¾è·¯å…±äº«ä¿¡é“ç›¸å…³æµç¨‹"><a class="header-anchor" href="#2-ç‰©ç†ä¸‹è¡Œé“¾è·¯å…±äº«ä¿¡é“ç›¸å…³æµç¨‹">Â¶</a>2 ç‰©ç†ä¸‹è¡Œé“¾è·¯å…±äº«ä¿¡é“ç›¸å…³æµç¨‹</h2><h3 id="2-1-UE-ç”¨äºæ¥æ”¶ç‰©ç†ä¸‹è¡Œé“¾è·¯å…±äº«ä¿¡é“çš„è¿‡ç¨‹"><a class="header-anchor" href="#2-1-UE-ç”¨äºæ¥æ”¶ç‰©ç†ä¸‹è¡Œé“¾è·¯å…±äº«ä¿¡é“çš„è¿‡ç¨‹">Â¶</a>2.1 UE ç”¨äºæ¥æ”¶ç‰©ç†ä¸‹è¡Œé“¾è·¯å…±äº«ä¿¡é“çš„è¿‡ç¨‹</h3><p>å¯¹äºä¸‹è¡Œé“¾è·¯ï¼ŒUE æ”¯æŒæ¯ä¸ªå°åŒºæœ€å¤š16 ä¸ªHARQ è¿›ç¨‹ã€‚UE å¯ä»¥å‡è®¾çš„è¿›ç¨‹çš„æ•°é‡æœ€å¤šå°†ç”¨äºä¸‹è¡Œé“¾è·¯ï¼Œé€šè¿‡æ›´é«˜å±‚å‚æ•° <em>nrofHARQ-processesForPDSCH</em> åˆ†åˆ«ä¸ºæ¯ä¸ªå°åŒºé…ç½®ç»™UEï¼Œå¹¶ä¸”å½“æ²¡æœ‰æä¾›é…ç½®æ—¶ï¼ŒUE é»˜è®¤çš„8 ä¸ªè¿›ç¨‹ã€‚</p><h4 id="2-1-1-ä¼ è¾“æ–¹æ¡ˆ"><a class="header-anchor" href="#2-1-1-ä¼ è¾“æ–¹æ¡ˆ">Â¶</a>2.1.1 ä¼ è¾“æ–¹æ¡ˆ</h4><p>PDSCHä»…å®šä¹‰äº†ä¸€ç§ä¼ è¾“æ–¹æ¡ˆï¼Œå¹¶ä¸”ç”¨äºæ‰€æœ‰çš„PDSCHä¼ è¾“ã€‚<br>å¯¹äºPDSCHä¼ è¾“æ–¹æ¡ˆ1ï¼ŒUEå¯ä»¥å‡è®¾å°†åœ¨å¤©çº¿ç«¯å£ 1000-1011 ä¸Šå¤šå¤§ 8 ä¸ªä¼ è¾“å±‚æ‰§è¡ŒPDSCH ä¸Šçš„ gNB ä¼ è¾“ [å‚è€ƒ TS 38.211]</p><h3 id="2-1-2-èµ„æºåˆ†é…"><a class="header-anchor" href="#2-1-2-èµ„æºåˆ†é…">Â¶</a>2.1.2 èµ„æºåˆ†é…</h3><h4 id="2-1-2-1-æ—¶åŸŸèµ„æº"><a class="header-anchor" href="#2-1-2-1-æ—¶åŸŸèµ„æº">Â¶</a>2.1.2.1 æ—¶åŸŸèµ„æº</h4><p>PDSCHæ—¶åŸŸèµ„æºçš„ä½ç½®å‚è€ƒå¦‚ä¸‹è¡¨æ ¼ï¼Œåˆ†ä¸ºmapping Type A å’Œmapping Type B ä¸¤ç§ï¼š</p><p><img src="/5G_Protocol/5G-NR-214%E5%8D%8F%E8%AE%AE%E8%A1%A5%E5%85%85/t3-214-5.1.2.1-1.png" alt></p><p>å…¶ä¸­ï¼š</p><ul><li><em>S</em> ä¸ºPDSCHåœ¨æ—¶éš™ä¸­çš„å¼€å§‹ç¬¦å·</li><li><em>L</em> ä¸ºPDSCHåœ¨æ—¶éš™ä¸­çš„æŒç»­æ—¶é—´</li></ul><p><strong>PDSCH ä¿¡é“é‡å¤å‘é€</strong>ï¼š</p><p>å½“ UE é…ç½®ä¸º aggregationFactorDL &gt; 1 æ—¶ï¼Œåœ¨ aggregationFactotDL è¿ç»­æ—¶éš™ä¸Šåº”ç”¨ç›¸åŒçš„ç¬¦å·åˆ†é…ã€‚UE å¯ä»¥é¢„æœŸåœ¨æ¯ä¸ª aggregationFactorDL è¿ç»­æ—¶éš™ä¸­çš„æ¯ä¸ªåˆ†é…ç¬¦å·å†…é‡å¤å‘é€ TB ï¼Œå¹¶ä¸” PDSCH é™äºå•å±‚ä¼ è¾“ï¼Œæ ¹æ® [TS 38.214 Table 5.1.2.1-2] ç¡®å®šè¦åº”ç”¨äº TB çš„ $n^{th}$ ä¼ è¾“æ—¶åˆ»çš„å†—ä½™ç‰ˆæœ¬ã€‚</p><p><img src="/5G_Protocol/5G-NR-214%E5%8D%8F%E8%AE%AE%E8%A1%A5%E5%85%85/t4-214-5.1.2.1-2.png" alt></p><p>å¦‚æœè°ƒåº¦ PDSCH çš„ PDCCH åœ¨åŒä¸€ä¸ªæ—¶éš™å†…è¢«æ¥å—ï¼Œå¹¶ä¸”ä¸åœ¨æ—¶éš™çš„å‰ä¸‰ä¸ªç¬¦å·å†…ï¼Œåˆ™ä¸æœŸæœ› UE åœ¨æ—¶éš™ä¸­æ¥æ”¶ mapping Type A çš„ PDSCHã€‚<br>å¦‚æœè°ƒåº¦PDSCH çš„ PDCCH çš„ç¬¬ä¸€ç¬¦å·æ˜¯åœ¨æ¯” PDSCH æ—¶åŸŸèµ„æºåˆ†é…ä¸­æŒ‡ç¤ºçš„ç¬¬ä¸€ç¬¦å·æ™šçš„ç¬¦å·ä¸­æ¥æ”¶åˆ°çš„ï¼Œåˆ™ä¸æœŸæœ›UEåœ¨æ—¶éš™ä¸­æ¥æ”¶ mapping Type A çš„ PDSCHã€‚</p><h5 id="2-1-2-1-1-ç¡®å®šç”¨äºPDSCHçš„èµ„æºåˆ†é…è¡¨"><a class="header-anchor" href="#2-1-2-1-1-ç¡®å®šç”¨äºPDSCHçš„èµ„æºåˆ†é…è¡¨">Â¶</a>2.1.2.1.1 ç¡®å®šç”¨äºPDSCHçš„èµ„æºåˆ†é…è¡¨</h5><p>[Table 5.1.2.1.1-1~1A] ä¸­å®šä¹‰äº†è¦åº”ç”¨çš„ PDSCH æ—¶åŸŸèµ„æºåˆ†é…é…ç½®ã€‚å¦‚æœä¸Šå±‚å‚æ•° <em>pdsch-TimeDomainAllocationList or Pdsch-TimeDomainAllocationList-ForDCIFormat1_2</em> é…ç½®äº†ï¼Œåˆ™ä½¿ç”¨ç›¸åº”çš„èµ„æºåˆ†é…é…ç½®ï¼›å¦‚æœä¸ºé…ç½®åˆ™ä½¿ç”¨[Table 5.1.2.1.1-2~5] ä¸­é»˜è®¤çš„A B C ä¸‰ç§è¡¨æ ¼ã€‚</p><p><img src="/5G_Protocol/5G-NR-214%E5%8D%8F%E8%AE%AE%E8%A1%A5%E5%85%85/t5-214-5.1.2.1.1-1.png" alt></p><p><img src="/5G_Protocol/5G-NR-214%E5%8D%8F%E8%AE%AE%E8%A1%A5%E5%85%85/t6-214-5.1.2.1.1-2.png" alt></p><p><img src="/5G_Protocol/5G-NR-214%E5%8D%8F%E8%AE%AE%E8%A1%A5%E5%85%85/t7-214-5.1.2.1.1-3.png" alt></p><p><img src="/5G_Protocol/5G-NR-214%E5%8D%8F%E8%AE%AE%E8%A1%A5%E5%85%85/t8-214-5.1.2.1.1-4.png" alt></p><p><img src="/5G_Protocol/5G-NR-214%E5%8D%8F%E8%AE%AE%E8%A1%A5%E5%85%85/t9-214-5.1.2.1.1-4.png" alt></p><h4 id="5-1-2-2-é¢‘åŸŸèµ„æºåˆ†é…"><a class="header-anchor" href="#5-1-2-2-é¢‘åŸŸèµ„æºåˆ†é…">Â¶</a>5.1.2.2 é¢‘åŸŸèµ„æºåˆ†é…</h4><p>å’Œ LTE ç±»ä¼¼ï¼ŒNR çš„ PDSCH ä¿¡é“é¢‘åŸŸèµ„æºåˆ†é…ï¼Œæ”¯æŒåŸºäºä½å›¾åˆ†é…å’ŒåŸºäºRIVçš„åˆ†é… (Type 0 å’Œ Type 1)ï¼Œä¸å†æ”¯æŒæ¯”è¾ƒå¤æ‚çš„ LTE Type 1 å‹æ”¯æŒåˆ†é…ã€‚</p><p>UE åº”å½“å‡è®¾å½“æ¥æ”¶åˆ°å…·æœ‰ DCI æ ¼å¼ 1_0 çš„è°ƒåº¦çš„ PDSCHï¼Œåˆ™ä½¿ç”¨ä¸‹è¡Œé“¾è·¯èµ„æºåˆ†é… Type 1ã€‚</p><p>å¦‚æœè°ƒåº¦DCI è¢«é…ç½®ä¸ºé€šè¿‡å°†pdsch-Config ä¸­çš„æ›´é«˜å±‚å‚æ•° <em>resourceAllocation</em> è®¾ç½®ä¸º*'dynamicswitchâ€™<em>æ¥æŒ‡ç¤ºä¸‹è¡Œé“¾è·¯èµ„æºåˆ†é…ç±»å‹ä½œä¸ºé¢‘åŸŸèµ„æºåˆ†é…å­—æ®µçš„ä¸€éƒ¨åˆ†ï¼Œåˆ™UE å°†æ ¹æ®æ­¤DCI å­—æ®µå®šä¹‰é…ç½®ä½¿ç”¨ä¸‹è¡Œé“¾è·¯èµ„æºåˆ†é… Type 0 æˆ– Type 1ã€‚å¦åˆ™ï¼ŒUE å°†ä½¿ç”¨ç”±æ›´é«˜å±‚å‚æ•°</em>resourceAllocation* å®šä¹‰çš„ä¸‹è¡Œé“¾è·¯é¢‘ç‡èµ„æºåˆ†é…ç±»å‹ã€‚</p><p>å¯¹äºåœ¨ä»»ä½•ç±»å‹çš„ PDCCH å…¬å…±æœç´¢ç©ºé—´ä¸­ä»¥DCI format 1_0 è°ƒåº¦çš„PDSCHï¼Œæ— è®ºå“ªä¸ªBWPæ˜¯active BWPï¼ŒRB ç¼–å·ä»å…¶ä¸­æ¥æ”¶ DCI çš„CORESET çš„æœ€ä½ RB å¼€å§‹ã€‚</p><p>å¯¹äºå…¶ä»–è°ƒåº¦çš„PDSCHï¼š</p><ul><li>å¦‚æœåœ¨è°ƒåº¦DCI ä¸­<strong>æœªé…ç½®</strong>å¸¦å®½éƒ¨åˆ†æŒ‡ç¤ºç¬¦å­—æ®µï¼Œåˆ™åœ¨ UE çš„æœ‰æ•ˆå¸¦å®½éƒ¨åˆ†å†…ç¡®å®šç”¨äºä¸‹è¡Œé“¾è·¯ Type 0 å’Œ Type 1 èµ„æºåˆ†é…çš„RB ç´¢å¼•ã€‚</li><li>å¦‚æœåœ¨è°ƒåº¦DCI ä¸­<strong>é…ç½®</strong>å¸¦å®½éƒ¨åˆ†æŒ‡ç¤ºç¬¦å­—æ®µï¼Œåˆ™åœ¨DCI ä¸­ç”±å¸¦å®½éƒ¨åˆ†æŒ‡ç¤ºç¬¦å­—æ®µå€¼æŒ‡ç¤ºçš„UE çš„å¸¦å®½éƒ¨åˆ†å†…ç¡®å®šç”¨äºä¸‹è¡Œé“¾è·¯Type 0 å’Œ Type 1 èµ„æºåˆ†é…çš„RB ç´¢å¼•ã€‚</li></ul><p>UE åœ¨æ£€æµ‹åˆ°é¢„æœŸç”¨äºUE çš„PDCCH æ—¶å°†é¦–å…ˆç¡®å®šä¸‹è¡Œé“¾è·¯è½½æ³¢å¸¦å®½éƒ¨åˆ†ï¼Œç„¶åç¡®å®šå¸¦å®½éƒ¨åˆ†å†…çš„èµ„æºåˆ†é…ã€‚</p><h5 id="2-1-2-2-1-ä¸‹è¡Œé“¾è·¯èµ„æºåˆ†é…-Type-0-bitmap"><a class="header-anchor" href="#2-1-2-2-1-ä¸‹è¡Œé“¾è·¯èµ„æºåˆ†é…-Type-0-bitmap">Â¶</a>2.1.2.2.1 ä¸‹è¡Œé“¾è·¯èµ„æºåˆ†é… Type 0 (bitmap)</h5><p>åœ¨ Type 0 çš„ä¸‹è¡Œé“¾è·¯èµ„æºåˆ†é…ä¸­ï¼Œèµ„æºå—åˆ†é…ä¿¡æ¯åŒ…æ‹¬æŒ‡ç¤ºåˆ†é…ç»™è°ƒåº¦çš„UEçš„èµ„æºå—ç»„ (RBG , Resource Block Groups )çš„bitmapï¼Œå…¶ä¸­RBGæ˜¯ç”±è¾ƒé«˜å±‚å‚æ•° <em>rbg-Size</em> å®šä¹‰çš„ä¸€ç»„è¿ç»­çš„è™šæ‹Ÿèµ„æºå—ã€‚ ç”±<em>PDSCH-Config</em>é…ç½®ï¼ŒBWPçš„å¤§å°å¦‚ [Table 5.1.2.2.1-1] ä¸­æ‰€å®šä¹‰ã€‚</p><p><img src="/5G_Protocol/5G-NR-214%E5%8D%8F%E8%AE%AE%E8%A1%A5%E5%85%85/t10-214-5.1.2.2.1-1.png" alt></p><p>RBG æ€»æ•° ($N_{RBG}$) å¯¹äºå¤§å°ä¸º $N_{BWP,i}^{size}$ ä¸ªPRB çš„ä¸‹è¡ŒBWP i ï¼Œç”±ä¸‹å¼ç»™å‡ºï¼š<br>$$<br>N_{RBG}=\lceil (N_{BWP,i}<sup>{size}+(N_{BWP,i}</sup>{start}modP))/p \rceil<br>$$<br>å…¶ä¸­ï¼š</p><ul><li>ç¬¬ä¸€ä¸ª RBG çš„å¤§å°æ˜¯ $RBG_{0}^{size} = P- N_{BWP,i}^{start} mod P$ï¼›</li><li>æœ€åä¸€ä¸ª RBG çš„å¤§å°æ˜¯ $RBG_{last}^{size} = (N_{BWP,i}<sup>{size}+N_{BWP,i}</sup>{start} )mod P$ï¼Œæˆ–è€…å°±æ˜¯æ°å¥½ä¸º $P$ ;</li><li>å…¶ä»–çš„RBGçš„å¤§å°æ˜¯ <em>P</em> ã€‚</li></ul><p>bitmap çš„å¤§å°æ˜¯ $N_{RBG}$ bitsï¼Œå¹¶ä¸”æ¯ä¸€ä¸ª RBG éƒ½æœ‰ä¸€ä¸ªbitmap ä½ï¼Œå› æ­¤æ¯ä¸ª RBG éƒ½æ˜¯å¯å¯»å€çš„ã€‚RBG åº”è¯¥æ˜¯æŒ‰ç…§é¢‘ç‡å¢åŠ çš„é¡ºåºæ’åºç´¢å¼•çš„ï¼Œå¹¶ä» BWP çš„ æœ€ä½é¢‘ç‡å¼€å§‹ã€‚RBG bitmap çš„æ˜ å°„é¡ºåºä¸ºï¼šRBG 0 åˆ° $RBG_{N_{RBG}}-1$ï¼ŒæŒ‰ç…§é¡ºåºæ˜ å°„ä» bitmap çš„ MSB åˆ° LSBã€‚å¦‚æœ å¯¹åº”çš„ bitmap æ¯”ç‰¹ä½æ˜¯ 1 ï¼Œåˆ™ä»£è¡¨è¯¥ RBG åˆ†é…ç»™ UEï¼Œå¦åˆ™åä¹‹ã€‚</p><h5 id="2-1-2-2-2-ä¸‹è¡Œé“¾è·¯èµ„æºåˆ†é…-Type-1-RIV"><a class="header-anchor" href="#2-1-2-2-2-ä¸‹è¡Œé“¾è·¯èµ„æºåˆ†é…-Type-1-RIV">Â¶</a>2.1.2.2.2 ä¸‹è¡Œé“¾è·¯èµ„æºåˆ†é… Type 1 (RIV)</h5><p>åœ¨ Type 1 çš„ä¸‹è¡Œé“¾è·¯èµ„æºåˆ†é…ä¸­ï¼Œèµ„æºå—æŒ‡æ´¾ä¿¡æ¯å‘è°ƒåº¦çš„ UE æŒ‡ç¤ºåœ¨æœ‰æ•ˆå¸¦å®½éƒ¨åˆ†å¤§å° (ä¸‰è€…ä¸­çš„ä¸€ç§æƒ…å†µ$N_{BWP}<sup>{size},N_{CORESET}</sup>{size},N_{BWP,initial}^{size}$) å†…çš„ä¸€ç»„è¿ç»­åˆ†é…çš„éäº¤ç»‡æˆ–äº¤ç»‡çš„è™šæ‹Ÿèµ„æºå—ã€‚</p><p>ä¸‹è¡Œé“¾è·¯ Type 1 èµ„æºåˆ†é…å­—æ®µåŒ…æ‹¬ä¸èµ·å§‹è™šæ‹Ÿèµ„æºå— ($RB_{start}$) ç›¸å¯¹åº”çš„èµ„æºæŒ‡ç¤ºå€¼ (RIV , Resource Indication Value)ï¼Œä»¥åŠè¿ç»­åˆ†é…çš„èµ„æºå—çš„é•¿åº¦ $L_{RBs}$ã€‚RIV çš„æœ€å¤§é•¿åº¦å’ŒBWPå¸¦å®½ç›¸å…³ï¼Œç”±ä¸‹å¼ç»™å‡ºï¼š</p><p>$if\quad (L_{RBs}-1)\leq \lfloor N_{BWP}^{size}/2 \rfloor \quad then$<br>$\quad RIV=N_{BWP}^{size}(L_{RBs}-1)+RB_{start}$<br>$else$<br>$\quad RIV=N_{BWP}<sup>{size}(N_{BWP}</sup>{size}-L_{RBs}+1)+(N_{BWP}^{size}-1-RB_{start})$</p><p>å…¶ä¸­ $L_{RBs} \geq 1$ å¹¶ä¸” ä¸åº”è¯¥è¶…è¿‡ $N_{BWP}^{size} - RB_{start}$</p><p>ä¸¤ç§é¢‘åŸŸèµ„æºåˆ†é…æ–¹å¼æ¯”è¾ƒï¼šå’Œ Type 0 ç›¸æ¯”ï¼ŒType 1 åˆ†é…çš„é¢‘åŸŸèµ„æºæ¯”è¾ƒ â€œç²¾ç¡®â€ ï¼Œæœ€å°ç²’åº¦è¾¾åˆ°äº† RB çº§ï¼Œç¼ºç‚¹æ˜¯åªèƒ½åˆ†é…è¿ç»­çš„ RB èµ„æºï¼Œä¸åˆ©äºåŸºäºé¢‘é€‰èµ„æºè°ƒåº¦ã€‚</p><p><strong>DCI size å¯¹é½åçš„è°ƒåº¦</strong></p><p>å½“å‡ºç° DCI size å¯¹é½æ“ä½œåï¼Œåœ¨ USS ä¸­ä½¿ç”¨DCI 1_0 è°ƒåº¦çš„é¢‘åŸŸèµ„æº (å½“å‰æ¿€æ´»BWPä¸­)ï¼Œä½†DCI 1_0 é•¿åº¦æ¥è‡ªäº CORESET 0 ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœå½“å‰æ¿€æ´»BWPå¸¦å®½å¤§äºCORESET 0 ï¼Œè°ƒåº¦çš„é¢‘åŸŸèµ„æºè¦è¿›è¡Œç­‰æ¯”ä¾‹ â€œæ”¾å¤§â€ï¼Œæ”¾å¤§ç³»æ•° <em>K</em> ã€‚</p><p><img src="/5G_Protocol/5G-NR-214%E5%8D%8F%E8%AE%AE%E8%A1%A5%E5%85%85/p1-%E6%91%98%E6%8A%841.png" alt></p><p>RIV æœ‰å¦‚ä¸‹å¼å­è·å¾—ï¼š</p><p>$if\quad (Lâ€™<em>{RBs}-1)\leq \lfloor N</em>{BWP}^{initial}/2 \rfloor \quad then$<br>$\quad RIV=N_{BWP}^{initial}(Lâ€™<em>{RBs}-1)+RBâ€™</em>{start}$<br>$else$<br>$\quad RIV=N_{BWP}<sup>{initial}(N_{BWP}</sup>{initial}-Lâ€™<em>{RBs}+1)+(N</em>{BWP}^{initial}-1-RBâ€™_{start})$</p><p>å…¶ä¸­ï¼š$Lâ€™<em>{RBs}=L</em>{RBs}/K,RB;<em>{start}=RB</em>{start}/k,Lâ€™<em>{RBs} \leq N</em>{BWP}^{initial}-RBâ€™_{start}$</p><p>å®é™…åˆ†é… RB èµ„æºä¹˜ä»¥ç³»æ•° <em>K</em> ï¼š<br>$$<br>RB_{start}=0,K,2\cdot K,â€¦,(N_{BWP}^{initial}-1)\cdot K \L_{RBs} = K,2\cdot K,â€¦,N_{BWP}^{initial}\cdot K<br>$$</p><h4 id="2-1-2-3-PDSCHä¿¡é“PRB-bundling"><a class="header-anchor" href="#2-1-2-3-PDSCHä¿¡é“PRB-bundling">Â¶</a>2.1.2.3 PDSCHä¿¡é“PRB bundling</h4><p>LTEä¸­ï¼Œä¸‹è¡Œ PDSCH ä¿¡é“åœ¨åˆ†é…çš„å…¨éƒ¨é¢‘åŸŸä¸Šä½¿ç”¨ç›¸åŒçš„é¢„ç¼–ç ï¼›NR ä¸­ ï¼ŒPDSCH ä¿¡é“åœ¨é¢‘åŸŸå¸¦å®½å¾ˆå¤§ï¼Œæ”¯æŒé¢‘åŸŸé€‰æ‹©çš„é¢„ç¼–ç ï¼Œå³é¢‘åŸŸä¸Šä¸åŒçš„ PRB èŒƒå›´å¯ä»¥é‡‡ç”¨ä¸åŒçš„é¢„ç¼–ç çŸ©é˜µã€‚<br>é‡‡ç”¨ç›¸åŒé¢„ç¼–ç çŸ©é˜µçš„ä¸€ç»„ PRB ç§°ä¸ºä¸€ä¸ª PRG (Precoding Resource Block Group)ï¼ŒPRGçš„å¤§å°ä¹Ÿæˆä¸º precoding granularityï¼Œç¬¬ <em>i</em> ä¸ª BWP å†…ï¼Œé¢„ç¼–ç ç²’åº¦ç”¨ $Pâ€™<em>{BWP,i}$ è¡¨ç¤ºï¼›<br>$Pâ€™</em>{BWP,i}$ é€šè¿‡é«˜å±‚ä¿¡ä»¤é…ç½®ï¼ŒèŒƒå›´ä¸º {2ï¼Œ4ï¼Œwideband}</p><ul><li>$Pâ€™_{BWP,i}$ é…ç½®ä¸º wideband æ—¶ï¼ŒUEåªèƒ½æ¥å—è¿ç»­RBåˆ†é…ï¼Œæ‰€æœ‰èµ„æºä½¿ç”¨ç›¸åŒé¢„ç¼–ç ï¼›</li><li>$Pâ€™<em>{BWP,i}$ é…ç½®ä¸º 2 / 4 æ—¶ï¼ŒBWPå†…æŒ‰ç…§ $Pâ€™</em>{BWP,i}$ è¿›è¡Œ RB ç»„åˆ†æ®µï¼Œç±»ä¼¼ BWPå†…çš„ RBG åˆ†æ®µ</li></ul><p>DCI 1_0 è°ƒåº¦æ—¶ï¼Œ$Pâ€™<em>{BWP,i} = 2$<br>DCI 1_1 è°ƒåº¦æ—¶ï¼Œ$Pâ€™</em>{BWP,i}$ å’Œé«˜å±‚é…ç½®ä»¥åŠ DCI å­—æ®µç›¸å…³ï¼Œå‚è€ƒæˆ‘ä¹‹å‰PDSCH çš„ PRB bundling ç¬”è®°ã€‚</p><h3 id="2-1-3-è°ƒåˆ¶é˜¶æ•°ï¼Œç›®æ ‡ç ç‡ï¼Œå†—ä½™ç‰ˆæœ¬ï¼Œä¼ è¾“å—å¤§å°ç¡®å®š"><a class="header-anchor" href="#2-1-3-è°ƒåˆ¶é˜¶æ•°ï¼Œç›®æ ‡ç ç‡ï¼Œå†—ä½™ç‰ˆæœ¬ï¼Œä¼ è¾“å—å¤§å°ç¡®å®š">Â¶</a>2.1.3 è°ƒåˆ¶é˜¶æ•°ï¼Œç›®æ ‡ç ç‡ï¼Œå†—ä½™ç‰ˆæœ¬ï¼Œä¼ è¾“å—å¤§å°ç¡®å®š</h3><p>ä¸ºäº†ç¡®å®š PDSCH çš„è°ƒåˆ¶é˜¶æ•°ï¼Œç›®æ ‡ç ç‡å’Œä¼ è¾“å—çš„å¤§å°ï¼ŒUE åº”è¯¥<br>é¦–å…ˆ</p><ul><li>è¯»å– DCI ä¸­ 5 bits MCS å­—æ®µ ($I_{MCS}$)ï¼Œæ ¹æ® [TS 38.214 5.1.3.1] ä¸­å®šä¹‰çš„è¿‡ç¨‹ç¡®å®šè°ƒåˆ¶é˜¶æ•° ($Q_m$) å’Œ ç›®æ ‡ç ç‡ Â®</li><li>è¯»å– DCI ä¸­çš„å†—ä½™ç‰ˆæœ¬å­—æ®µ (rv) ä»¥ç¡®å®šå†—ä½™ç‰ˆæœ¬ã€‚<br>å…¶æ¬¡</li><li>UE åº”ä½¿ç”¨å±‚æ•° (<em>v</em>)ï¼Œé€Ÿç‡åŒ¹é…ä¹‹å‰åˆ†é…çš„ PRB æ€»æ•° ($n_{PRB}$) ï¼Œä»¥æ ¹æ® [TS 38.214 5.1.3.2] ä¸­å®šä¹‰çš„è¿‡ç¨‹ç¡®å®šä¼ è¾“å—çš„å¤§å°</li></ul><p>å¦‚æœæœ‰æ•ˆä¿¡é“ç ç‡é«˜äº 0.95ï¼Œåˆ™ UE å¯ä»¥åœ¨åˆå§‹ä¼ è¾“ä¸­è·³è¿‡è§£ç ä¼ è¾“å—ï¼Œå…¶ä¸­æœ‰æ•ˆä¿¡é“ç ç‡è¢«å®šä¹‰ä¸ºä¸‹è¡Œé“¾è·¯ä¿¡æ¯æ¯”ç‰¹ (åŒ…æ‹¬CRC) çš„æ•°é‡é™¤ä»¥PDSCHä¸Šç‰©ç†ä¿¡é“æ¯”ç‰¹æ•°ã€‚</p><h4 id="2-1-3-1-è°ƒåˆ¶é˜¶æ•°å’Œç›®æ ‡ç ç‡ç¡®å®š"><a class="header-anchor" href="#2-1-3-1-è°ƒåˆ¶é˜¶æ•°å’Œç›®æ ‡ç ç‡ç¡®å®š">Â¶</a>2.1.3.1 è°ƒåˆ¶é˜¶æ•°å’Œç›®æ ‡ç ç‡ç¡®å®š</h4><p>å¯¹äºç”±C-RNTI, MCS-C-RNTI, TC-RNTI, CS-RNTI, SI-RNTI, RA-RNTI, MsgB-RNTI, or P-RNTI åŠ æ‰°çš„ DCI format 1_0 1_1 1_2 PDCCH è°ƒåº¦çš„PDSCHï¼Œæˆ–è€…å¯¹äºä½¿ç”¨æ›´é«˜å±‚æä¾›çš„PDSCHé…ç½® <em>SPS-Config</em> è¿›è¡Œè°ƒåº¦è€Œæ²¡æœ‰ç›¸åº”çš„PDCCHä¼ è¾“çš„PDSCHã€‚</p><p>å¦‚æœ <em>PDSCH-Config</em> ç»™å‡ºçš„é«˜å±‚å‚æ•° <em>mcs-Table-ForDCIFormal1_2</em> è®¾ç½®ä¸º â€˜<em>qam256</em>â€™ï¼Œåˆ™PDSCH ç”± DCI format 1_2 çš„PDCCH è°ƒåº¦ï¼Œå¹¶ä¸” CRC ç”± C-RNTI åŠ æ‰°</p><ul><li>UE åº”ä½¿ç”¨ <em>$I_{MCS}$</em> å’Œ [Table 5.1.3.1-2] æ¥ç¡®å®šPDSCHä¸­ä½¿ç”¨çš„è°ƒåˆ¶é˜¶æ•° ($Q_m$) å’Œç›®æ ‡ç ç‡ Â®ã€‚</li></ul><p><img src="/5G_Protocol/5G-NR-214%E5%8D%8F%E8%AE%AE%E8%A1%A5%E5%85%85/t11-214-5.1.3.1-2.png" alt></p><p>å†å¦‚æœ UE æ²¡æœ‰é…ç½® MCS-C-RNTIï¼ŒPDSCH-Config ç»™å‡ºçš„é«˜å±‚å‚æ•° <em>mcs-Table-ForDCIFormal1_2</em> è®¾ç½®ä¸º '<em>qam64LowSE</em>â€˜ï¼Œä¸” PDSCH ç”± DCI format 1_2 çš„PDCCH è°ƒåº¦ï¼Œå¹¶ä¸” CRC ç”± C-RNTI åŠ æ‰°</p><ul><li>UE åº”ä½¿ç”¨ <em>$I_{MCS}$</em> å’Œ [Table 5.1.3.1-3] æ¥ç¡®å®šPDSCHä¸­ä½¿ç”¨çš„è°ƒåˆ¶é˜¶æ•° ($Q_m$) å’Œç›®æ ‡ç ç‡ Â®ã€‚</li></ul><p><img src="/5G_Protocol/5G-NR-214%E5%8D%8F%E8%AE%AE%E8%A1%A5%E5%85%85/t12-214-5.1.3.1-3.png" alt></p><p>å¦‚æœ <em>PDSCH-Config</em> ç»™å‡ºçš„é«˜å±‚å‚æ•° <em>mcs-Table</em> è®¾ç½®ä¸º â€˜qam256â€™ï¼Œåˆ™PDSCH ç”± DCI format 1_1 çš„PDCCH è°ƒåº¦ï¼Œå¹¶ä¸” CRC ç”± C-RNTI åŠ æ‰°</p><ul><li>UE åº”ä½¿ç”¨ <em>$I_{MCS}$</em> å’Œ [Table 5.1.3.1-2] æ¥ç¡®å®šPDSCHä¸­ä½¿ç”¨çš„è°ƒåˆ¶é˜¶æ•° ($Q_m$) å’Œç›®æ ‡ç ç‡ Â®ã€‚</li></ul><p>å†å¦‚æœ UE æ²¡æœ‰é…ç½® MCS-C-RNTIï¼ŒPDSCH-Config ç»™å‡ºçš„é«˜å±‚å‚æ•° <em>mcs-Table</em> è®¾ç½®ä¸º '<em>qam64LowSE</em>â€˜ï¼Œä¸” PDSCH ç”± DCI format 1_2 (UE-specific search space) çš„PDCCH è°ƒåº¦ï¼Œå¹¶ä¸” CRC ç”± C-RNTI åŠ æ‰°</p><ul><li>UE åº”ä½¿ç”¨ <em>$I_{MCS}$</em> å’Œ [Table 5.1.3.1-3] æ¥ç¡®å®šPDSCHä¸­ä½¿ç”¨çš„è°ƒåˆ¶é˜¶æ•° ($Q_m$) å’Œç›®æ ‡ç ç‡ Â®ã€‚</li></ul><p>å†å¦‚æœ UE é…ç½® MCS-C-RNTIï¼Œä¸” PDSCH ç”± PDCCH è°ƒåº¦ï¼Œå¹¶ä¸” CRC ç”± MCS-C-RNTI åŠ æ‰°</p><ul><li>UE åº”ä½¿ç”¨ <em>$I_{MCS}$</em> å’Œ [Table 5.1.3.1-3] æ¥ç¡®å®šPDSCHä¸­ä½¿ç”¨çš„è°ƒåˆ¶é˜¶æ•° ($Q_m$) å’Œç›®æ ‡ç ç‡ Â®ã€‚</li></ul><p>å†å¦‚æœ UE æœªé…ç½®ç”±<em>SPS-config</em> ç»™å‡ºçš„é«˜å±‚å‚æ•° <em>mcs-Table</em> ï¼Œç”±<em>PDSCH-Config</em> ç»™å‡ºçš„é«˜å±‚å‚æ•° <em>mcs-Table-ForDCIFormal1_2</em> è®¾ç½®ä¸º â€˜qam256â€™ï¼Œåˆ™PDSCH ç”± DCI format 1_2 çš„PDCCH è°ƒåº¦ï¼Œå¹¶ä¸” CRC ç”± CS-RNTI åŠ æ‰°</p><ul><li>UE åº”ä½¿ç”¨ <em>$I_{MCS}$</em> å’Œ [Table 5.1.3.1-2] æ¥ç¡®å®šPDSCHä¸­ä½¿ç”¨çš„è°ƒåˆ¶é˜¶æ•° ($Q_m$) å’Œç›®æ ‡ç ç‡ Â®ã€‚</li></ul><p>å†å¦‚æœ UE æœªé…ç½®ç”±<em>SPS-config</em> ç»™å‡ºçš„é«˜å±‚å‚æ•° <em>mcs-Table</em> ï¼Œç”±<em>PDSCH-Config</em> ç»™å‡ºçš„é«˜å±‚å‚æ•° <em>mcs-Table</em> è®¾ç½®ä¸º â€˜qam256â€™ï¼Œ</p><ul><li>å¦‚æœ PDSCH ç”± DCI format 1_1 (CS-RNTI åŠ æ‰°) çš„PDCCH è°ƒåº¦ï¼Œæˆ–è€…</li><li>PDSCH è°ƒåº¦çš„æ²¡æœ‰ç›¸å…³çš„ä½¿ç”¨ <em>SPS-Config</em> çš„PDSCH ä¼ è¾“<ul><li>UE åº”ä½¿ç”¨ <em>$I_{MCS}$</em> å’Œ [Table 5.1.3.1-2] æ¥ç¡®å®šPDSCHä¸­ä½¿ç”¨çš„è°ƒåˆ¶é˜¶æ•° ($Q_m$) å’Œç›®æ ‡ç ç‡ Â®ã€‚</li></ul></li></ul><p>å†å¦‚æœ UE é…ç½®ç”±<em>SPS-config</em> ç»™å‡ºçš„é«˜å±‚å‚æ•° <em>mcs-Table</em> ï¼Œå¹¶ä¸” è®¾ç½®ä¸º â€˜<em>qam64LowSE</em>â€™</p><ul><li>å¦‚æœ PDSCH ç”± (CS-RNTI åŠ æ‰°) çš„PDCCHè°ƒåº¦ï¼Œæˆ–è€…</li><li>PDSCH è°ƒåº¦çš„æ²¡æœ‰ç›¸å…³çš„ä½¿ç”¨ <em>SPS-Config</em> çš„PDSCH ä¼ è¾“<ul><li>UE åº”ä½¿ç”¨ <em>$I_{MCS}$</em> å’Œ [Table 5.1.3.1-3] æ¥ç¡®å®šPDSCHä¸­ä½¿ç”¨çš„è°ƒåˆ¶é˜¶æ•° ($Q_m$) å’Œç›®æ ‡ç ç‡ Â®ã€‚</li></ul></li></ul><p>å¦åˆ™ï¼Œ</p><ul><li>UE åº”ä½¿ç”¨ <em>$I_{MCS}$</em> å’Œ [Table 5.1.3.1-1] æ¥ç¡®å®šPDSCHä¸­ä½¿ç”¨çš„è°ƒåˆ¶é˜¶æ•° ($Q_m$) å’Œç›®æ ‡ç ç‡ Â®ã€‚</li></ul><p><img src="/5G_Protocol/5G-NR-214%E5%8D%8F%E8%AE%AE%E8%A1%A5%E5%85%85/t13-214-5.1.3.1-1.png" alt></p><p>ä¸æœŸæœ›UE è§£ç ç”¨ P-RNTIï¼ŒRA-RNTIï¼ŒSI-RNTI å’Œ $Q_m&gt; 2$ è°ƒåº¦çš„PDSCHã€‚</p><h4 id="2-1-3-2-ä¼ è¾“å—å¤§å°ç¡®å®š"><a class="header-anchor" href="#2-1-3-2-ä¼ è¾“å—å¤§å°ç¡®å®š">Â¶</a>2.1.3.2 ä¼ è¾“å—å¤§å°ç¡®å®š</h4><p>åœ¨é«˜å±‚å‚æ•° <em>maxNroCodeWordsScheduledByDCI</em> æŒ‡ç¤ºå¯ç”¨ä¸¤ä¸ªç å­—ä¼ è¾“çš„æƒ…å†µä¸‹ï¼Œå¦‚æœ $I_{MSC}=26ï¼Œrv_{id}=1$ï¼Œåˆ™DCI format 1_1 ç¦ç”¨ä¼ è¾“å—ï¼Œå¦åˆ™ä¼ è¾“å—å¯ç”¨ã€‚å¦‚æœä¸¤ä¸ªä¼ è¾“å—éƒ½è¢«å¯ç”¨ï¼Œåˆ™ä¼ è¾“å—1/2ï¼Œåˆ†åˆ«æ˜ å°„åˆ°ç å­— 0/1ã€‚å¦‚æœä»…å¯ç”¨ä¸€ä¸ªä¼ è¾“å—ï¼Œåˆ™å¯ç”¨çš„ä¼ è¾“å—æ˜ å°„åˆ°ç¬¬ä¸€ä¸ªç å­—ã€‚</p><!-- rebuild by neat -->]]></content>
      <categories>
        <category>5G_Protocol</category>
      </categories>
      <tags>
        <tag>TS 38.214</tag>
      </tags>
  </entry>
  <entry>
    <title>5G-NR-213åè®®è¡¥å……</title>
    <url>/5G_Protocol/5G-NR-213%E5%8D%8F%E8%AE%AE%E8%A1%A5%E5%85%85/</url>
    <content><![CDATA[<!-- build time:Tue Jun 22 2021 17:02:33 GMT+0800 (GMT+08:00) --><a id="more"></a><h1>TS 38.213 éƒ¨åˆ†è¡¥å……</h1><h2 id="1-ä¸Šè¡ŒåŠŸç‡æ§åˆ¶"><a class="header-anchor" href="#1-ä¸Šè¡ŒåŠŸç‡æ§åˆ¶">Â¶</a>1. ä¸Šè¡ŒåŠŸç‡æ§åˆ¶</h2><p>ä¸Šè¡Œçš„ä¸»è¦å‡ ä¸ªä¿¡é“/ä¿¡å·</p><ol><li>PUSCH</li><li>PUCCH</li><li>SRS</li><li>PRACH</li></ol><h3 id="1-1-PUSCH"><a class="header-anchor" href="#1-1-PUSCH">Â¶</a>1.1 PUSCH</h3><p>UEé¦–å…ˆéœ€è¦åŸºäº$P_{PUSCH,b,f,c}(i,j,q_{d},l)$ çº¿æ€§æ˜ å°„ä¸€ä¸ªå€¼ $Pâ€˜<em>{PUSCH,b,f,c}(i,j,q</em>{d},l)$</p><ul><li><em>b</em>ï¼šBWP</li><li><em>f</em>ï¼šcarrier</li><li><em>c</em>ï¼šserving</li><li><em>j</em>ï¼šparameter configuration index</li><li><em>i</em> ï¼štransmission occasion</li></ul><p>$P_{PUSCH,b,f,c}(i,j,q_{d},l)$ å–ä¸‹åˆ—ä¸¤é¡¹è¾ƒå°çš„å€¼</p><ul><li>$P_{CMAX,f,c}(i)$ï¼ŒUE çš„æœ€å¤§ä¼ è¾“åŠŸç‡ï¼Œç”± [8-1, TS 38.101-1~2] å®šä¹‰ï¼›</li><li>$P_{O_PUSCH,b,f,c}(j)+10log_{10}(2<sup>{\mu}M_{RB,b,f,c}</sup>{PUSCH}(i))+\alpha_{b,f,c}(j)PL_{b,f,c}(q_d)+\Delta_{TF,b,f,c}(i)+f_{b,f,c}(i,l)$</li></ul><p>å‚æ•°è¯´æ˜ï¼š</p><ul><li>$P_{O_PUSCH,b,f,c}(j)$ æ˜¯ $P_{O_NOMINAL_PUSCH,f,c}(j)$ å’Œ $P_{O_UE_PUSCH,b,f,c}(j)$ä¹‹å’Œï¼Œç”±é«˜å±‚é…ç½®ï¼Œå…·ä½“è§åè®®(ä¸‹åŒ)ï¼›</li><li>$\alpha_{b,f,c}(j)$ éœ€è¦é«˜å±‚é…ç½®ï¼Œå¦åˆ™ä¸º1ï¼›</li><li>$M_{RB,b,f,c}^{PUSCH}(i))$ æ˜¯PUSCHèµ„æºçš„å¸¦å®½ï¼Œå³RBæ•°ç›®[4,TS 38.211]</li><li>$PL_{b,f,c}(q_d)$ æ˜¯ä¸‹è¡Œè·¯å¾„æŸè€—ä¼°è®¡ï¼›</li><li>$\Delta_{TF,b,f,c}(i)$ ç”±é«˜å±‚é…ç½®ã€‚</li></ul><h3 id="1-2-PUCCH"><a class="header-anchor" href="#1-2-PUCCH">Â¶</a>1.2 PUCCH</h3><p>$P_{PUCCH,b,f,c}(i,q_u,q_{d},l)$ å–ä¸‹åˆ—ä¸¤é¡¹è¾ƒå°çš„å€¼ï¼š</p><ul><li>$P_{CMAX,f,c}(i)$ï¼ŒUEçš„æœ€å¤§ä¼ è¾“åŠŸç‡ï¼Œç”± [8-1, TS 38.101-1~2] å®šä¹‰ï¼›</li><li>$P_{O_PUCCH,b,f,c}(q_u)+10log_{10}(2<sup>{\mu}M_{RB,b,f,c}</sup>{PUCCH}(i))+PL_{b,f,c}(q_d)+\Delta_{F_PUCCH(F)}+\Delta_{TF,b,f,c}(i)+g_{b,f,c}(i,l)$</li></ul><p>PUCCHçš„å‚æ•°ç±»ä¼¼äºPUSCHï¼Œå…·ä½“çš„é…ç½®å–å†³åè®®ã€‚</p><h3 id="1-3-SRS"><a class="header-anchor" href="#1-3-SRS">Â¶</a>1.3 SRS</h3><p>$P_{SRS,b,f,c}(i,q_s,l)$ å–ä¸‹åˆ—ä¸¤é¡¹è¾ƒå°çš„å€¼ï¼š</p><ul><li>$P_{CMAX,f,c}(i)$ï¼ŒUEçš„æœ€å¤§ä¼ è¾“åŠŸç‡ï¼Œç”± [8-1, TS 38.101-1~2] å®šä¹‰ï¼›</li><li>$P_{O_SRS,b,f,c}(q_s)+10log_{10}(2<sup>{\mu}M_{RB,b,f,c}</sup>{SRS}(i))+\alpha_{b,f,c}(q_s)PL_{b,f,c}(q_d)+h_{b,f,c}(i,l)$</li></ul><p>åŒä¸Šï¼Œå…·ä½“çš„é…ç½®å–å†³åè®®ã€‚</p><h3 id="1-4-PRACH"><a class="header-anchor" href="#1-4-PRACH">Â¶</a>1.4 PRACH</h3><p>$P_{PRACH,b,f,c}(i)=min{P_{CMAX,f,c}(i),P_{PRACH,target,f,c}+PL_{b,f,c}}$</p><p>å…¶ä¸­ï¼š</p><ul><li>$P_{CMAX,f,c}(i)$ æ˜¯UEé…ç½®çš„æœ€å¤§è¾“å‡ºåŠŸç‡ï¼Œç”± [8-1. TS 38.101-1~2]ç»™å‡ºã€‚</li><li>$P_{PRACH,target,f,c}$ ä¸ºPRACH ç›®æ ‡æ¥æ”¶åŠŸç‡ <em>PREAMBLE_RECEIVED_TARGET_POWER</em> ç”±[11. TS 38.321] ç»™å‡ºè®¡ç®—å…¬å¼ï¼š<em>PREAMBLE_RECEIVED_TARGET_POWER</em> = <em>preambleReceivedTargetPower</em> + <em>DELTA_PREAMBLE</em> + <em>(PREAMBLE_POWER_RAMPING_COUNTER -1)</em> * <em>PREAMBLE_POWER_RAMPING_STEP</em><ul><li><em>preambleReceivedTargetPower</em> ç”±å‚æ•° <em>preambleReceivedTargetPower</em> ç»™å‡º</li><li><em>DELTA_PREAMBLE</em>å¯ç”±[TS 38.321 Table 7.3-1~2] è·å¾—</li><li><em>PREAMBLE_POWER_RAMPING_COUNTER</em> å¯¹åˆå§‹ä¼ è¾“ä¸º1ï¼Œä¾æ®é‡ä¼ æ¬¡æ•°è‡ªå¢ä¸€</li><li><em>PREAMBLE_POWER_RAMPING_STEP</em> ç”±å‚æ•° <em>powerRampingStep</em> ç»™å‡º<br>ï¼ˆä»¥ä¸Šä¸¤æ¡æ˜¯ä¸ºäº†åŠŸç‡æ”€å‡è€Œè®¾å®šçš„å‚æ•°ï¼‰</li></ul></li></ul><h2 id="2-ç”¨äºç›‘æ§-Type0-PDCCH-å…¬å…±æœç´¢ç©ºé—´çš„UEè¿‡ç¨‹"><a class="header-anchor" href="#2-ç”¨äºç›‘æ§-Type0-PDCCH-å…¬å…±æœç´¢ç©ºé—´çš„UEè¿‡ç¨‹">Â¶</a>2 ç”¨äºç›‘æ§ Type0-PDCCH å…¬å…±æœç´¢ç©ºé—´çš„UEè¿‡ç¨‹</h2><p>å…¶å¤§éƒ¨åˆ†çš„å†…å®¹SSBä¸­æè¿°è¿‡ï¼Œä»¥ä¸‹è¡¥å……ä¸€äº›å†…å®¹ã€‚</p><h3 id="2-1-ç®€è¿°"><a class="header-anchor" href="#2-1-ç®€è¿°">Â¶</a>2.1 ç®€è¿°</h3><p>UEè·å¾—äº†SSBä¿¡æ¯åï¼ŒMIBä¿¡æ¯æœ‰é™ï¼Œè¿˜ä¸è¶³ä»¥é©»ç•™å°åŒºå’Œè¿›ä¸€æ­¥å‘èµ·åˆå§‹æ¥å…¥ï¼ŒUEè¿˜éœ€è¦å¾—åˆ°ä¸€äº›â€œå¿…å¤‡â€çš„ç³»ç»Ÿä¿¡æ¯SIBï¼Œè¿™ä¸ªç³»ç»Ÿä¿¡æ¯åœ¨NRä¸­è¢«ç§°ä¸ºRMSIï¼Œå¯ä»¥è®¤ä¸ºSIB1ã€‚<br>NRä¸­çš„SIB1ä¿¡æ¯ï¼Œé€šè¿‡ä¸‹è¡ŒPDCCHä¿¡é“å‘é€ï¼Œè€ŒPDSCHä¿¡é“éœ€è¦PDCCHä¿¡é“çš„DCIæ¥è°ƒåº¦ã€‚UEéœ€è¦åœ¨MIBä¸­å¾—åˆ°è°ƒåº¦RMSIçš„PDCCHä¿¡é“ä¿¡æ¯ï¼Œåœ¨PDCCHä¸Šè¿›è¡Œç›²æ£€ï¼Œè·å¾—RMSIã€‚MIBä¸­é€šè¿‡8bitçš„<em>pdcch-ConfigSIB1</em>å­—æ®µï¼ŒæŒ‡ç¤ºUEè·å–RMSIè°ƒåº¦çš„PDCCHçš„ä¿¡æ¯ã€‚</p><p>å¤§è‡´çš„è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€æè¿°ï¼š</p><p><img src="/5G_Protocol/5G-NR-213%E5%8D%8F%E8%AE%AE%E8%A1%A5%E5%85%85/p1-RMSI.png" alt></p><h3 id="2-2-k-SSB-å­—æ®µ"><a class="header-anchor" href="#2-2-k-SSB-å­—æ®µ">Â¶</a>2.2 $k_{SSB}$ å­—æ®µ</h3><p>SSBéƒ¨åˆ†å­¦ä¹ çš„æè¿°äº†$k_{SSB}$ï¼Œä»–çš„ä¸»è¦ä½œç”¨å°±æ˜¯æ ‡è®° SSB #0å­è½½æ³¢ä¸æœ€è¿‘çš„CRB n #0 å­è½½æ³¢çš„åç§»é‡ã€‚<br>$k_{SSB}$çš„4bits LSB ç”± MIBå‚æ•°ä¸­çš„ ssb-SubcarrerOffset ç»™å‡ºã€‚<br>å¯¹äºSSBç±»å‹B (FR2)ï¼Œå³ï¼ˆÎ¼= 3 or 4ï¼‰æ¥è¯´, $k_{SSB}$ = {0,â€¦,11}, 4 bitsè¶³å¤Ÿã€‚<br>å¯¹äºSSBç±»å‹A (FR1)ï¼Œå³ï¼ˆÎ¼= 0 or 1ï¼‰æ¥è¯´, $ k_{SSB}$ = {0,â€¦,23}, 4 bitsä¸å¤Ÿï¼Œéœ€è¦5 bitsæ¥è¡¨ç¤ºï¼Œå› æ­¤ä½¿ç”¨PBCH payloadä¸­$a_{\overline A+5}$æ¥è¡¨ç¤ºé«˜æ¯”ç‰¹ä½ã€‚</p><p><img src="/5G_Protocol/5G-NR-213%E5%8D%8F%E8%AE%AE%E8%A1%A5%E5%85%85/p2-%E9%A2%91%E7%A7%BB.png" alt></p><p>NRå°åŒºä¸­ï¼Œå¯ä»¥åœ¨ä¸åŒé¢‘åŸŸä½ç½®æœ‰å¤šä¸ª SSB (ç”¨äºç»ˆç«¯æµ‹é‡)ï¼Œè€Œå¹¶ä¸éœ€è¦æ¯ä¸ªSSBéƒ½æœ‰å…¶æŒ‡å‘çš„ CORESET 0 ã€‚</p><p>å¦‚æœå†ç©ºé—²çŠ¶æ€ä¸‹ï¼Œå½“UEæœç´¢åˆ°çš„SSB (æ²¡æœ‰æŒ‡å‘CORESET 0)ï¼ŒUEæœŸæœ›åŸºç«™æœ€å¥½èƒ½å¤Ÿé€šçŸ¥UEä¸‹ä¸€ä¸ªçš„SSB(æœ‰æŒ‡å‘CORESET 0 )ï¼Œä»¥ä¾¿äºUEå¿«é€Ÿç›‘å¬åˆ°ã€‚$K_{ssb}$ å­—æ®µä¸åªæ˜¯æè¿°äº†REçº§åˆ«çš„åç§»ï¼Œä¹Ÿèµ·åˆ°äº†è¿™ä¸ªä½œç”¨ã€‚</p><p>UEæ ¹æ® $K_{ssb}$ åˆ¤å®š Type0-PDCCH å…¬å…±æœç´¢ç©ºé—´æ˜¯å¦å­˜åœ¨ã€‚è‹¥ï¼š</p><ul><li>$K_{ssb} &gt; 23,FR1$</li><li>$K_{ssb} &gt; 11,FR1$</li></ul><p>åˆ™ï¼šå½“å‰ SSBå¯¹åº”çš„Type0-PDCCHå…¬å…±æœç´¢ç©ºé—´ä¸å­˜åœ¨</p><p>UEé€šè¿‡ $K_{ssb}$ å‘ç°å½“å‰Type0-PDCCHå…¬å…±æœç´¢ç©ºé—´ä¸å­˜åœ¨æ—¶ï¼Œå¯ä»¥é€šè¿‡ $K_{ssb}$çš„å€¼ï¼Œåœ¨æœ€è¿‘çš„GSCNä¸Šæ‰¾ä¸‹ä¸€ä¸ªSSB ä¸Šçš„ RMSI çš„æœç´¢ç©ºé—´ã€‚å½“ï¼š<br>$$<br>24\leq k_{SSB} \leq 29 \quad FR1\quad 12\leq k_{SSB} \leq 13 \quad FR2<br>$$<br>åˆ™ä¸‹ä¸€ä¸ª SSB å¯¹åº”çš„GSCNä¸Šé¢‘ç‚¹ $N_{GSCN}<sup>{Reference}+N_{GSCN}</sup>{Offect}$</p><p>å…¶ä¸­ï¼š<br>$N_{GSCN}^{Reference}$ï¼šå½“å‰SSBçš„GSCNä¸Šçš„é¢‘ç‚¹<br>$N_{GSCN}^{Offect}$ï¼šä¸‹ä¸€ä¸ªSSBçš„GSCNé¢‘ç‚¹åç§»ï¼Œæ ¹æ® $k_{SSB}$ å’ŒMIB ä¸­çš„ <em>pdcch-ConfigSIB1</em>ï¼Œå…±åŒç¡®å®šã€‚å‚è€ƒä»¥ä¸‹è¡¨æ ¼ï¼š</p><p><img src="/5G_Protocol/5G-NR-213%E5%8D%8F%E8%AE%AE%E8%A1%A5%E5%85%85/T1-213-13.16.png" alt></p><p><img src="/5G_Protocol/5G-NR-213%E5%8D%8F%E8%AE%AE%E8%A1%A5%E5%85%85/T2-213-13.17.png" alt></p><p>å¦‚æœåœ¨ç¬¬äºŒä¸ªSSB ä¸Šè¿˜æ˜¯æ²¡æœ‰æä¾› RMSI CORESET 0ï¼Œåˆ™UEå¿½ç•¥æ‰§è¡Œå°åŒºæœç´¢çš„GSCNä¿¡æ¯ã€‚</p><p>å½“ $k_{SSB}=31\quad FR1\quad k_{SSB}=15\quad FR2$ ï¼Œåˆ™è¡¨ç¤ºSSBæ‰€åœ¨çš„GSCNä¸€æ®µé¢‘ç‚¹èŒƒå›´(è§ä¸‹)å†…çš„SSBï¼Œéƒ½æ²¡æœ‰ CORESET 0ï¼›<br>$$<br>[N_{GSCN}<sup>{Reference}-N_{GSCN}</sup>{Start},N_{GSCN}<sup>{Reference}+N_{GSCN}</sup>{End}]<br>$$<br>å…¶ä¸­ï¼š<br>$N_{GSCN}^{Start}$ å’Œ $N_{GSCN}^{End}$ åˆ†åˆ«ä¸º <em>pdcch-ConfigSIB1</em> ä¸­çš„<em>controlResourceSetZero</em> å’Œ <em>searchSpaceZero</em> å†³å®šï¼Œä¹Ÿå°±æ˜¯å…¶ 4 bits MSB å’Œ 4 bits LSBã€‚</p><p>UE åœ¨ä¸€ä¸ªæ—¶é—´å‘¨æœŸå†…ï¼Œéƒ½æ²¡æœ‰æœç´¢åˆ°å¸¦ RMSI çš„ CORESET 0 çš„SSBï¼Œåˆ™UEå¿½ç•¥æ‰§è¡Œå°åŒºæœç´¢çš„GSCNä¿¡æ¯ã€‚</p><h3 id="2-3-CORESET-0"><a class="header-anchor" href="#2-3-CORESET-0">Â¶</a>2.3 CORESET 0</h3><h4 id="2-3-1-CORESET-0-çš„æ—¶é¢‘åŸŸèµ„æº"><a class="header-anchor" href="#2-3-1-CORESET-0-çš„æ—¶é¢‘åŸŸèµ„æº">Â¶</a>2.3.1 CORESET 0 çš„æ—¶é¢‘åŸŸèµ„æº</h4><p>CORESET 0çš„ç‰©ç†æ—¶é¢‘åŸŸèµ„æºå’ŒSSBä¹‹é—´å­˜åœ¨ä¸‰ç§å¤ç”¨æ¨¡å¼ï¼š Pattern1/2/3ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º (æ‘˜æŠ„è‡ªæ˜¥å¤©å·¥ä½œå®¤)ï¼š</p><p><img src="/5G_Protocol/5G-NR-213%E5%8D%8F%E8%AE%AE%E8%A1%A5%E5%85%85/P4-%E5%A4%8D%E7%94%A8%E6%A8%A1%E5%BC%8F.png" alt></p><p>ä¸Šå›¾ä»…ä¸ºç¤ºä¾‹ï¼Œå›¾ä¸­çš„æ—¶é¢‘åŸŸèµ„æºæœªå¿…å®Œå…¨å¯¹å…¶ã€‚</p><h4 id="2-3-2-CORESET-0-çš„é¢‘åŸŸèµ„æº"><a class="header-anchor" href="#2-3-2-CORESET-0-çš„é¢‘åŸŸèµ„æº">Â¶</a>2.3.2 CORESET 0 çš„é¢‘åŸŸèµ„æº</h4><p>SSBå—å’ŒType0-PDCCH å…¬å…±æœç´¢ç©ºé—´çš„CORESET 0åœ¨æ—¶é¢‘åŸŸèµ„æºéƒ½æœ‰è¾ƒå¤§çµæ´»æ€§ï¼Œä¸¤è€…ä¹‹é—´çš„å¯¹åº”å…³ç³»ä¹Ÿæ¯”è¾ƒå¤æ‚ï¼Œè€Œè¦ç”¨MIBä¸­æœ‰é™çš„ 8bits ä¿¡æ¯è¡¨ç¤ºä¸¤è€…å…³ç³»ï¼Œå¿…é¡»å¯¹ä¸¤è€…æ˜ å°„å…³ç³»åšä¸€å®šçº¦æŸã€‚åè®®ä¸­å®šä¹‰äº†å¤šç§æ—¶é¢‘åŸŸæ˜ å°„ç»„åˆå…³ç³»ã€‚</p><p>pdcch-ConfigSIB1:</p><ul><li>4 bits MSBï¼ŒSSBå’ŒCORESET 0 çš„SCSï¼Œç¬¦å·æ•°ï¼ŒPRB offseté…ç½®ï¼Œå¯¹åº” [TS 38.213 Table 13-1~10]</li><li>4 bits LSBï¼ŒCORESET 0 çš„SFNï¼Œæ—¶éš™ç´¢å¼•ç­‰ï¼Œæ—¶åŸŸç›¸å…³é…ç½®ï¼Œå¯¹åº” [TS 38.213 Table 13-11~15]</li></ul><p>CORESET 0 çš„é¢‘åŸŸèµ„æºï¼šPattern1/2/3</p><ul><li>Pattern 1</li></ul><p><img src="/5G_Protocol/5G-NR-213%E5%8D%8F%E8%AE%AE%E8%A1%A5%E5%85%85/p5-pattern1%E4%BE%8B%E5%AD%90%E4%B8%80.png" alt></p><p>è‹¥ index = 0ï¼›</p><p><img src="/5G_Protocol/5G-NR-213%E5%8D%8F%E8%AE%AE%E8%A1%A5%E5%85%85/p8-pattern1%E4%BE%8B%E5%AD%90%E4%BA%8C.png" alt></p><p>è‹¥ index = 1;</p><p><img src="/5G_Protocol/5G-NR-213%E5%8D%8F%E8%AE%AE%E8%A1%A5%E5%85%85/p9-pattern1%E4%BE%8B%E5%AD%90%E4%B8%89.png" alt></p><ul><li>pattern 2</li></ul><p><img src="/5G_Protocol/5G-NR-213%E5%8D%8F%E8%AE%AE%E8%A1%A5%E5%85%85/p6-pattern2%E4%BE%8B%E5%AD%90%E4%B8%80.png" alt></p><p>è‹¥ index = 6ï¼Œindex = 7;</p><p>$k_{SSB} = 0$</p><p><img src="/5G_Protocol/5G-NR-213%E5%8D%8F%E8%AE%AE%E8%A1%A5%E5%85%85/p10-pattern2%E4%BE%8B%E5%AD%90%E4%BA%8C.png" alt></p><p>$k_{SSB} &gt; 0$</p><p><img src="/5G_Protocol/5G-NR-213%E5%8D%8F%E8%AE%AE%E8%A1%A5%E5%85%85/p11-pattern2%E4%BE%8B%E5%AD%90%E4%B8%89.png" alt></p><ul><li>pattern 3</li></ul><p><img src="/5G_Protocol/5G-NR-213%E5%8D%8F%E8%AE%AE%E8%A1%A5%E5%85%85/p7-pattern3%E4%BE%8B%E5%AD%90%E4%B8%80.png" alt></p><p>è‹¥ index = 6ï¼Œindex = 7;</p><p>$k_{SSB} = 0$</p><p><img src="/5G_Protocol/5G-NR-213%E5%8D%8F%E8%AE%AE%E8%A1%A5%E5%85%85/p12-pattern3%E4%BE%8B%E5%AD%90%E4%BA%8C.png" alt></p><p>$k_{SSB} &gt; 0$</p><p><img src="/5G_Protocol/5G-NR-213%E5%8D%8F%E8%AE%AE%E8%A1%A5%E5%85%85/p13-pattern3%E4%BE%8B%E5%AD%90%E4%B8%89.png" alt></p><h4 id="2-3-2-CORESET-0-çš„æ—¶åŸŸèµ„æº"><a class="header-anchor" href="#2-3-2-CORESET-0-çš„æ—¶åŸŸèµ„æº">Â¶</a>2.3.2 CORESET 0 çš„æ—¶åŸŸèµ„æº</h4><p>å¯¹äºå¤ç”¨pattern 2/3ï¼ŒCNRESET 0çš„æ—¶åŸŸåˆ†å¸ƒç›¸å¯¹ç®€å•æ˜ï¼š</p><ol><li>CORESET 0ï¼Œå³Type 0 å…¬å…±æœç´¢ç©ºé—´å‘¨æœŸç­‰äºSSBçš„å‘¨æœŸ</li><li>CORESET 0 å’Œ SSBåœ¨åŒä¸€ä¸ªæ—¶éš™å†…</li><li>æ—¶éš™å· $n_c$ å’Œå¸§å· $SFN_c$ åœ¨ [TS 38.213 Table 13-13~15] ä¸­å®šä¹‰</li></ol><p>å¯¹äºå¤ç”¨pattern 1ï¼ŒSSB å’Œ CORESET 0 æ—¶åˆ†å¤ç”¨ï¼Œå¹¶ä¸” SSB åœ¨æ—¶åŸŸä¸Šæœ‰å¤šä¸ªå‘é€æ—¶åˆ»ï¼Œå› æ­¤CORESET 0 å’ŒSSBä¹‹é—´çš„æ—¶åŸŸå¯¹åº”å…³ç³»è¡¨è¾¾ç›¸å¯¹å¤æ‚ï¼Œåœ¨[TS 38.213] ä¸­å®šä¹‰ï¼šå¯¹äºå¤ç”¨ pattern 1ï¼Œç»ˆç«¯ç›‘å¬ $n_0$ å¼€å§‹çš„è¿ç»­2ä¸ªæ—¶éš™ã€‚<br>$$<br>n_0=(O\cdot 2^{\mu}+\lfloor i\cdot M \rfloor)mod N_{slot}^{frame,\mu}\quad \mu\in {0,1,2,3}<br>$$<br>CORESET 0 å¼€å§‹å¸§å·ï¼ŒSFNæ»¡è¶³<br>$$<br>å½“\quad \lfloor(O\cdot 2^{\mu}+\lfloor i\cdot M \rfloor)/N_{slot}^{frame,\mu}\rfloor mod 2 = 0 \quad æ—¶\quad SFN_c mod2=0\å½“\quad \lfloor(O\cdot 2^{\mu}+\lfloor i\cdot M \rfloor)/N_{slot}^{frame,\mu}\rfloor mod 2 = 1 \quad æ—¶\quad SFN_c mod2=1<br>$$<br>å…¶ä¸­ï¼š<br><em>i</em> ä¸º SSBçš„ indexï¼Œ<em>O</em>ï¼Œ<em>M</em>ï¼Œåœ¨è§„èŒƒä¸­13-11 (FR 1) åˆ° 13-12 (FR2) è¡¨æ ¼å®šä¹‰ã€‚</p><ul><li>$O\cdot 2^{\mu}$ï¼Œå¯ä»¥ç†è§£ä¸º <em>O</em> ms (ç»å¯¹æ—¶é—´)ï¼Œå½“ $i=0$ æ—¶ (ç¬¬ä¸€ä¸ªSSB) æ‰€å¯¹åº”çš„CORESET 0 æœç´¢ç©ºé—´ï¼Œç›¸å¯¹äºå¶æ•°å¸§çš„å¼€å§‹æ—¶åˆ»åç§»äº† <em>O</em> ms<ul><li>FR1æ—¶ï¼Œ<em>O</em> å–å€¼ä¸º 0ï¼Œ2ï¼Œ5ï¼Œ7</li><li>FR2æ—¶ï¼Œ<em>O</em> å–å€¼ä¸º 0ï¼Œ2.5ï¼Œ5ï¼Œ7.5</li></ul></li><li><em>N</em>ï¼Œ[TS 38.213 Table 13-11~12] è¡¨ä¸­çš„ Number of search space sets per slotï¼Œæ¯ä¸ªæ—¶éš™ä¸­çš„æœç´¢ç©ºé—´ä¸ªæ•°</li><li><em>M</em>ï¼Œ[TS 38.213 Table 13-11~12] è¡¨ä¸­çš„ <em>M</em> ï¼Œå¯ä»¥ç†è§£ä¸ºå‰åä¸¤ä¸ªSSBå¯¹åº”çš„CORESET 0 æœç´¢ç©ºé—´çš„é—´éš”ï¼Œå•ä½ä¸º slot</li></ul><p>ä»¥ä¸‹å¯¹åº”çš„ä¸‰ç§æƒ…å†µ (å›¾ç‰‡æ‘˜è‡ªæ˜¥å¤©å·¥ä½œå®¤)</p><ul><li>æƒ…å½¢ä¸€</li></ul><p><img src="/5G_Protocol/5G-NR-213%E5%8D%8F%E8%AE%AE%E8%A1%A5%E5%85%85/p14-%E6%97%B6%E5%9F%9F1.png" alt></p><ul><li>æƒ…å½¢äºŒ</li></ul><p><img src="/5G_Protocol/5G-NR-213%E5%8D%8F%E8%AE%AE%E8%A1%A5%E5%85%85/p15-%E6%97%B6%E5%9F%9F2.png" alt></p><ul><li>æƒ…å½¢ä¸‰</li></ul><p><img src="/5G_Protocol/5G-NR-213%E5%8D%8F%E8%AE%AE%E8%A1%A5%E5%85%85/p16-%E6%97%B6%E5%9F%9F3.png" alt></p><h2 id="3-RMSI-çš„è·å–"><a class="header-anchor" href="#3-RMSI-çš„è·å–">Â¶</a>3. RMSI çš„è·å–</h2><p>é€šè¿‡ä»¥ä¸‹æ­¥éª¤ï¼ŒUEè·å¾—äº†RMSI çš„CORESETï¼çš„æ—¶é¢‘åŸŸèµ„æºï¼Œå¯ä»¥åœ¨CORESET 0 ç‰©ç†èµ„æºå¯¹åº”çš„Type 0 Common Search Space ä½¿ç”¨ SI-RNTI ç›²æ£€RMSIçš„è°ƒåº¦ä¿¡æ¯ (PDCCHä¿¡é“ä¸Šå‘é€ SI-RNTI åŠ æ‰°çš„DCI 1_0)ã€‚</p><h2 id="4-initial-DL-BWP"><a class="header-anchor" href="#4-initial-DL-BWP">Â¶</a>4. initial DL BWP</h2><p>å’ŒLTEä¸åŒï¼ŒNRä¸­ç”±äºä¿¡é“å¸¦å®½å¯èƒ½ä¼šéå¸¸å¤§ï¼Œè€ŒUEæ²¡æœ‰å¿…è¦æ”¯æŒå…¨éƒ¨ä¿¡é“å¸¦å®½èŒƒå›´ã€‚å› æ­¤ï¼ŒNRä¸­é¢‘åŸŸä¸Šå¼•å…¥äº† Bandwidth part (BWP) çš„æ¦‚å¿µï¼ŒUEå¯ä»¥è¢«é…ç½®å¤šä¸ªDL/UL BWP (BWP æ ¹æ®UEèƒ½åŠ›é…ç½®ï¼Œå°äºç­‰äºä¿¡é“å¸¦å®½)ï¼ŒUEåŒæ—¶åªèƒ½å·¥ä½œåœ¨ä¸€ä¸ªæ¿€æ´»BWPä¸­ã€‚NRä¸­ï¼Œé¢‘åŸŸèµ„æºçš„åˆ†é…åŸºäºBWPå†…ã€‚</p><p>BWPçš„é…ç½®åŒ…æ‹¬ï¼šå­è½½æ³¢é—´éš”ï¼Œé¢‘åŸŸèµ·å§‹ä½ç½®ï¼Œå¸¦å®½ï¼ŒCPç±»å‹;</p><p>UEè¦æ ¹æ® CORESET 0 PDCCH è°ƒåº¦ DCI 1_0 å¾—åˆ° RMSI çš„PDSCHçš„é¢‘åŸŸèµ„æºä¿¡æ¯ï¼Œé¦–å…ˆè¦ç¡®å®šåˆå§‹ä¸‹è¡Œ BWP (Initial DL BWP)ï¼Œ[TS 38.213] è§„å®šï¼šInitial DL BWP å°±æ˜¯ CORESET 0 çš„é¢‘åŸŸå¤§å° (å­è½½æ³¢é—´éš”ï¼Œé¢‘åŸŸä½ç½®ï¼Œè¿ç»­RBï¼ŒCP)ã€‚</p><h2 id="5-ç”¨äºæŠ¥å‘Šæ§åˆ¶ä¿¡æ¯çš„UEè¿‡ç¨‹"><a class="header-anchor" href="#5-ç”¨äºæŠ¥å‘Šæ§åˆ¶ä¿¡æ¯çš„UEè¿‡ç¨‹">Â¶</a>5. ç”¨äºæŠ¥å‘Šæ§åˆ¶ä¿¡æ¯çš„UEè¿‡ç¨‹</h2><p>å¯¹åº”äºåè®®çš„ç¬¬ä¹ç«  è¿˜æ²¡æœ‰çœ‹</p><h2 id="6-ç”¨äºæ¥æ”¶æ§åˆ¶ä¿¡æ¯çš„UEè¿‡ç¨‹"><a class="header-anchor" href="#6-ç”¨äºæ¥æ”¶æ§åˆ¶ä¿¡æ¯çš„UEè¿‡ç¨‹">Â¶</a>6. ç”¨äºæ¥æ”¶æ§åˆ¶ä¿¡æ¯çš„UEè¿‡ç¨‹</h2><p>å¯¹åº”äºåè®®çš„ç¬¬åç«  è¿˜æ²¡æœ‰çœ‹</p><blockquote><p>å‚è€ƒæ–‡çŒ®<br>å…¬ä¼—å·ï¼š5Gèœé¸Ÿæˆé•¿æ—¥è®°ï¼Œæ˜¥å¤©å·¥ä½œå®¤<br>ç½‘é¡µï¼š<a href="https://mp.weixin.qq.com/s/pYBUorrVeYUedqGJxVi9Xg" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/pYBUorrVeYUedqGJxVi9Xg</a><br>åšå®¢ï¼š<a href="https://blog.csdn.net/milkbusy/article/details/81536306" target="_blank" rel="noopener">https://blog.csdn.net/milkbusy/article/details/81536306</a><br>åè®®ï¼šTS 38.213</p></blockquote><!-- rebuild by neat -->]]></content>
      <categories>
        <category>5G_Protocol</category>
      </categories>
      <tags>
        <tag>TS 38.213</tag>
      </tags>
  </entry>
  <entry>
    <title>5G-NR-å‚è€ƒä¿¡å·å­¦ä¹ </title>
    <url>/5G_Protocol/5G-NR-%E5%8F%82%E8%80%83%E4%BF%A1%E5%8F%B7%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<!-- build time:Tue Jun 22 2021 17:02:33 GMT+0800 (GMT+08:00) --><a id="more"></a><h1>1 CSI</h1><p>ä¸LTEä¸­çš„CSI-RSç±»ä¼¼ï¼Œåœ¨NRä¸­å¼•å…¥CSI-RS(Channel-state information RS)çš„ç›®çš„æ˜¯å¯¹ä¿¡é“çŠ¶æ€è¿›è¡Œè¯„ä¼°ï¼ŒUEåŸºäºä¿¡ä»¤é…ç½®çš„CSI-RSå‚æ•°å¯¹CSI-RSè¿›è¡Œæµ‹é‡è¯„ä¼°ä»è€Œå¾—åˆ°ä¸‹è¡Œä¿¡é“çŠ¶æ€ä¿¡æ¯å¹¶åé¦ˆç»™åŸºç«™å¹¶åº”ç”¨äºé“¾è·¯è‡ªé€‚åº”ç®—æ³•ä¸­ã€‚<br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒLTEä¸­å­˜åœ¨Cell-specific RSï¼Œæ‰€æœ‰å±äºæŸä¸ªcellçš„UEéƒ½å¯ä»¥é€šè¿‡æµ‹é‡CRSæ¥è·å–ä¸‹è¡Œä¿¡é“è´¨é‡ï¼›è€Œåœ¨NRä¸­ï¼Œæ²¡æœ‰äº†CRSçš„æ¦‚å¿µï¼Œå¯¹ä¸‹è¡Œä¿¡é“çš„æµ‹é‡åªèƒ½é€šè¿‡CSI-RSè¿›è¡Œã€‚</p><p>CSI-RSåˆ†ä¸º zero-power(ZP)å’Œnon-zero-power(NZP) ä¸¤ç§CSI-RSï¼š</p><ul><li>NZP CSI-RS ç”¨äºUEä¸“æœ‰çš„ä¸‹è¡Œä¿¡é“æµ‹é‡</li><li>ZP CSI-RSä½¿ç”¨ä¸å¤šä¸ªå°åŒºä¹‹é—´CSI-RSçš„åä½œä¼ è¾“ï¼Œç®€å•ç‚¹è¯´å°±æ˜¯ä¸ºäº†é¿å…ä¸å…¶ä»–å°åŒºçš„CSI-RS ä¼ è¾“çš„å†²æ’ï¼Œå°†ä¸€ä¸ªå°åŒºçš„ä¸‹è¡Œæ•°æ®ä¼ è¾“ä¸­çš„ä¸€äº›REè®¾ç½®ä¸ºZP CSI-RS(å³è¯¥REä¸Šä¸º0åŠŸç‡ä¼ è¾“)ï¼Œè¿™æ ·å°±é¿å¼€äº†CSI-RSä¼ è¾“çš„ç›¸äº’å¹²æ‰°ï¼Œæé«˜äº†å¯¹ä¸‹è¡Œä¿¡é“è¯„ä¼°çš„å‡†ç¡®æ€§ã€‚</li></ul><h2 id="1-1-CSI-é…ç½®"><a class="header-anchor" href="#1-1-CSI-é…ç½®">Â¶</a>1.1 CSI é…ç½®</h2><p>ä¸€äº›é‡è¦çš„é…ç½®å¦‚ä¸‹ï¼š</p><p><img src="/5G_Protocol/5G-NR-%E5%8F%82%E8%80%83%E4%BF%A1%E5%8F%B7%E5%AD%A6%E4%B9%A0/p2-NZP-CSI-resource.png" alt></p><p><img src="/5G_Protocol/5G-NR-%E5%8F%82%E8%80%83%E4%BF%A1%E5%8F%B7%E5%AD%A6%E4%B9%A0/p3-RS-ResourceMapping.png" alt></p><p><img src="/5G_Protocol/5G-NR-%E5%8F%82%E8%80%83%E4%BF%A1%E5%8F%B7%E5%AD%A6%E4%B9%A0/p1-CSI-FrequencyOccuption.png" alt></p><h2 id="1-2-åºåˆ—ç”Ÿæˆ"><a class="header-anchor" href="#1-2-åºåˆ—ç”Ÿæˆ">Â¶</a>1.2 åºåˆ—ç”Ÿæˆ</h2><p>CSI-RS åºåˆ— $r(m)$ ç”±ä»¥ä¸‹å…¬å¼å®šä¹‰ï¼š<br>$$<br>r(m) = \frac{1}{\sqrt{2}}(1-2\cdot c(2m)+j\frac{1}{\sqrt{2}}(1-2\cdot c(2m+1))\c_{init}=(2<sup>{10}(N_{symb}</sup>{slot}n_{s,f}<sup>{\mu}+l+1)(2n_{ID}+1)+n_{ID})mod2</sup>{31}<br>$$</p><p>å…¶ä¸­ï¼š</p><ul><li>$N_{symb}^{slot}$ ä¸ºä¸€ä¸ªæ—¶éš™ä¸­ OFDM ç¬¦å·çš„ä¸ªæ•°</li><li>$n_{s,f}^{\mu}$ ä¸ºåœ¨å­è½½æ³¢é—´è· $\mu$ ä¸­ï¼Œå½“å‰æ—¶éš™åœ¨ç³»ç»Ÿå¸§ä¸­çš„åºå·</li><li>$l$ ä¸º OFDM ç¬¦å· $l$ åœ¨å½“å‰æ—¶éš™ä¸­çš„åºå·</li><li>$n_{ID}$ ç”± <em>NZP-CSI-RS-Resource -&gt; scramblingID</em> æˆ–è€… <em>CSI-RS-ResourceConfigMobility -&gt; sequenceGenerationConfig</em> èµ‹å€¼</li></ul><h2 id="1-3-æ˜ å°„"><a class="header-anchor" href="#1-3-æ˜ å°„">Â¶</a>1.3 æ˜ å°„</h2><h3 id="1-3-1-åŸç†"><a class="header-anchor" href="#1-3-1-åŸç†">Â¶</a>1.3.1 åŸç†</h3><p>å¯¹äºé…ç½®çš„æ¯ä¸€ä¸ªCSI-RSï¼Œ$r(m)$ è¢«æ˜ å°„åˆ°èµ„æºå•å…ƒ $(k,l)<em>{p,\mu}$ ï¼Œæ ¹æ®ï¼š<br>$$<br>\alpha</em>{k,l}^{(p,\mu)}=\beta_{CSIRS}w_f(kâ€™)\cdot w_t(lâ€™)\cdot r_{l,n_{s,f}}(mâ€™)\mâ€™= \lfloor n\alpha \rfloor +kâ€™ + \lfloor \frac{\overline k\rho}{N_{sc}^{RB}} \rfloor\k=nN_{sc}^{RB}+\overline k +kâ€™\l = \overline l+lâ€™\ \alpha = \begin{cases} \rho \quad\quad for\quad X=1 \ 2\rho \quad\quad for \quad X&gt;1 \end{cases}\n = 0,1,â€¦<br>$$</p><p>å…¶ä¸­ï¼š</p><ul><li>$\beta_{CSIRS}$ï¼Œå¯¹äºNZP-CSI-RSï¼Œç”± <em>NZP-CSI-RS-Resource -&gt; powerContorlOffsetSS</em> å†³å®šï¼Œå¯¹äºZP-CSI-RSï¼Œ $\beta_{CSIRS} = 0$ ï¼›</li><li>$\rho$ ç”± <em>CSI-RS-ResourceMapping -&gt; density</em> æˆ–è€… <em>CSI-RS-cellMobility -&gt; density</em> å†³å®šï¼›</li><li>$X$ ç”± <em>CSI-RS-ResourceMapping -&gt; nrofPorts</em> å†³å®šï¼ŒCSI-RSç«¯å£ä¸ªæ•°ï¼›</li><li>CSI-RS çš„èµ„æºå—çš„èµ·å§‹ä½ç½®å’Œæ•°é‡ç”± <em>CSI-RS-ResourceMapping -&gt; freqBand</em> å†³å®šï¼Œ<em>freqBand</em> æŒ‡å‘äº† <em>CSI-FrequencyOccupation</em>ï¼Œåˆ†åˆ«ç”±å…¶ä¸­çš„ <em>startingRB , nrofRBs</em> å†³å®šï¼›</li><li>$k$ ä¸ºé¢‘åŸŸä¸Šå­è½½æ³¢ç´¢å¼•ï¼Œ$k$ çš„å‚è€ƒç‚¹ $k = 0$ æ˜¯æŒ‡ CRB#0 çš„å­è½½æ³¢0çš„ä½ç½® ;</li><li>$kâ€™,lâ€™,w_f{kâ€™},w_t{lâ€™}$ ç”±è¡¨[TS 38.211 7.4.1.5.3-1-7.4.1.5.3-6] ç»™å‡ºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</li></ul><p><img src="/5G_Protocol/5G-NR-%E5%8F%82%E8%80%83%E4%BF%A1%E5%8F%B7%E5%AD%A6%E4%B9%A0/t1-211-7.4.1.5.3-1.png" alt></p><p><img src="/5G_Protocol/5G-NR-%E5%8F%82%E8%80%83%E4%BF%A1%E5%8F%B7%E5%AD%A6%E4%B9%A0/t2-211-7.4.1.5.3-2~5.png" alt></p><p>å…¶ä¸­ï¼š</p><ul><li>$l_0,l_1$ ä¸ºæ—¶åŸŸä½ç½®ï¼Œ$l_0 \in {0,â€¦,13}$ å’Œ $l_1 \in {2,â€¦,12}$ ç”± <em>CSI-RS-ResourceMapping -&gt; firstOFDMSysmbolInTimeDomain, firstOFDMSysmbolInTimeDomain2</em> å†³å®šã€‚</li><li>$k_i$ ä¸ºé¢‘åŸŸä½ç½®ï¼Œ$k_i$ ç”±<em>CSI-RS-ResourceMapping -&gt; frequencyDomainAllocation</em> å†³å®šã€‚å…¶ä¸­ $k_i$ ç”± [TS 38.211 7.4.1.5.3-1]ä¸­æ‰€åœ¨rowï¼Œä»¥åŠä¸‹é¢å…¬å¼å†³å®šï¼š<ul><li>$[b_3 \cdots b_0],k_i=f(i)$ï¼Œå¯¹äº [TS 38.211 7.4.1.5.3-1] ä¸­ row = 1</li><li>$[b_{11} \cdots b_0],k_i=f(i)$ï¼Œå¯¹äº [TS 38.211 7.4.1.5.3-1] ä¸­ row = 2</li><li>$[b_2 \cdots b_0],k_i=4f(i)$ï¼Œå¯¹äº [TS 38.211 7.4.1.5.3-1] ä¸­ row = 4</li><li>$[b_5 \cdots b_0],k_i=2f(i)$ï¼Œå¯¹äº [TS 38.211 7.4.1.5.3-1] ä¸­ row = other</li></ul></li></ul><p>ä¸Šé¢å†…å®¹è§£é‡Šï¼š$f(i)$ ä¸­çš„ $i$ ä»£è¡¨çš„æ˜¯ <em>bitmap</em> ç¬¬ $i$ æ¬¡1çš„å‡ºç°çš„ä½ç½®æ˜¯äºŒè¿›åˆ¶çš„æƒå€¼ã€‚<br>è‹¥row1_FrequencyDomainBitmap=[0001]ï¼Œåˆ™$k_0 = f(1) = 0$ï¼›<br>è‹¥row2_FrequencyDomainBitmap=[000000000010]ï¼Œåˆ™$k_0=f(1)=1$<br>è‹¥row4_FrequencyDomainBitmap=[100]ï¼Œåˆ™$k_0 = 4f(1) = 4\times 2=8$ï¼›<br>è‹¥row10_FrequencyDomainBitmap=[001110]ï¼Œåˆ™$k_0 =2 f(1) = 2ï¼Œk_1=2f(2)=2\times 2 = 4,k_2=2f(3)=2\times 4=8$</p><ul><li>$p$ ä¸ºå‘é€CSI-RSçš„å¤©çº¿ç«¯å£ï¼Œæ ¹æ®ä¸‹å¼å¾—å‡ºï¼š</li></ul><p>$$<br>p=3000+s+jL\j=0,1,â€¦,N/L-1\s=0,1,â€¦,L-1<br>$$</p><ul><li>å…¶ä¸­ï¼š</li><li>$s$ ç”±[TS 38.211 7.4.1.5.3-2~5] ä¸­åºåˆ—ç´¢å¼•ç»™å‡ºï¼›</li><li>$L \in {1,2,4,8}$ æ˜¯CDM group çš„å¤§å°ï¼›</li><li>$N$ æ˜¯CSI-RSç«¯å£æ•°é‡ï¼›</li><li>$j$ æ˜¯CDM group indexï¼Œç”±[TS 38.211 7.4.1.5.3-1]ä¸­ç»™å‡º, CDM group æŒ‰ç…§å…ˆé¢‘åŸŸåæ—¶åŸŸé¡ºåºåˆ†é…ç¼–å·ã€‚</li></ul><h3 id="1-3-2-ä¾‹å­"><a class="header-anchor" href="#1-3-2-ä¾‹å­">Â¶</a>1.3.2 ä¾‹å­</h3><h4 id="1-3-2-1-RBå†…"><a class="header-anchor" href="#1-3-2-1-RBå†…">Â¶</a>1.3.2.1 RBå†…</h4><p>é‡‡ç”¨1.2.1æ‰€ç”¨çš„å››ä¸ªä¾‹å­ï¼Œæ›´è¯¦ç»†çš„è¯´æ˜æ˜ å°„çš„æ—¶é¢‘åŸŸä½ç½®ï¼Œä»¥åŠå¤©çº¿ç«¯å£ã€‚<br>(1) è‹¥row1_FrequencyDomainBitmap=[0001]ï¼ŒfirstOFDMSysmbolInTimeDomain = 4<br>(2) è‹¥row2_FrequencyDomainBitmap=[000000000010]ï¼ŒfirstOFDMSysmbolInTimeDomain = 4<br>(3) è‹¥row4_FrequencyDomainBitmap=[100]ï¼ŒfirstOFDMSysmbolInTimeDomain = 2<br>(4) è‹¥row10_FrequencyDomainBitmap=[001110]ï¼ŒfirstOFDMSysmbolInTimeDomain = 2<br>é¦–å…ˆå…ˆåœ¨ [TS 38.211 7.4.1.5.3-1] ä¸­é€‰æ‹©éœ€è¦çš„å‚æ•°ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/5G_Protocol/5G-NR-%E5%8F%82%E8%80%83%E4%BF%A1%E5%8F%B7%E5%AD%A6%E4%B9%A0/p4-CSI%E6%98%A0%E5%B0%84%E4%BE%8B%E5%AD%90.png" alt></p><p><strong>(1) è‹¥row1_FrequencyDomainBitmap=[0001]ï¼ŒfirstOFDMSysmbolInTimeDomain = 4</strong></p><ul><li>Density = 3ï¼Œä¸€ä¸ªRBå†…ï¼ŒCSI-RS å‡ºç°ä¸‰æ¬¡ï¼Œæ¯ä¸ªä½ç½®é—´éš”4ä¸ªå­è½½æ³¢ï¼›</li><li>FrequencyDomainBitmap = [0001]ï¼Œ$k_0 = f(1) = 0$ï¼›</li><li>No-CDMï¼Œæ²¡æœ‰é‡‡ç”¨CDMï¼Œåªå¯¹åº”ä¸€ä¸ªå¤©çº¿ç«¯å£3000ã€‚</li></ul><p><img src="/5G_Protocol/5G-NR-%E5%8F%82%E8%80%83%E4%BF%A1%E5%8F%B7%E5%AD%A6%E4%B9%A0/p5-CSI%E6%98%A0%E5%B0%841.png" alt></p><p><strong>(2) è‹¥row2_FrequencyDomainBitmap=[000000000010]ï¼ŒfirstOFDMSysmbolInTimeDomain = 4</strong></p><ul><li>Density = 1 or 0.5ï¼Œâ‘ ä¸€ä¸ªRBå†…ï¼ŒCSI-RS å‡ºç°ä¸€æ¬¡ï¼›â‘¡å¥‡æ•°RBï¼Œæˆ–å¶æ•°RBå‡ºç°ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸¤ä¸ªRBå‡ºç°ä¸€æ¬¡ã€‚</li><li>FrequencyDomainBitmap =[000000000010]ï¼Œ$k_0 = f(1) = 1$ï¼›</li><li>No-CDMï¼Œæ²¡æœ‰é‡‡ç”¨CDMï¼Œåªå¯¹åº”ä¸€ä¸ªå¤©çº¿ç«¯å£3000ã€‚</li></ul><p><img src="/5G_Protocol/5G-NR-%E5%8F%82%E8%80%83%E4%BF%A1%E5%8F%B7%E5%AD%A6%E4%B9%A0/p6-CSI%E6%98%A0%E5%B0%842.png" alt></p><p><strong>(3) è‹¥row4_FrequencyDomainBitmap=[100]ï¼ŒfirstOFDMSysmbolInTimeDomain = 2</strong></p><ul><li>Density = 1ï¼Œä¸€ä¸ªRBå†…ï¼Œä¸€ç»„ CSI-RS CDMç å‡ºç°ä¸€æ¬¡ï¼›</li><li>FrequencyDomainBitmap = [100]ï¼Œ$k_0 = 4f(1) = 4\times2=8$ï¼›</li><li>fd-CDM2ï¼šä¸€ç»„CDMç å ä¸€ä¸ªç¬¦å· $(lâ€™=0)$ï¼Œä¸¤ä¸ªå­è½½æ³¢ $(kâ€™=0,1)$<ul><li>å¤©çº¿ç«¯å£3000ï¼Œ3001ä½äºç¬¦å· 2 çš„ #8-#9 å­è½½æ³¢</li><li>å¤©çº¿ç«¯å£3002ï¼Œ3003ä½äºç¬¦å· 2 çš„ #10-#11 å­è½½æ³¢</li></ul></li></ul><p><img src="/5G_Protocol/5G-NR-%E5%8F%82%E8%80%83%E4%BF%A1%E5%8F%B7%E5%AD%A6%E4%B9%A0/p7-CSI%E6%98%A0%E5%B0%843.png" alt></p><p><strong>(4) è‹¥row10_FrequencyDomainBitmap=[001110]ï¼ŒfirstOFDMSysmbolInTimeDomain = 2</strong></p><ul><li>Density = 1ï¼Œä¸€ä¸ªRBå†…ï¼Œä¸€ç»„ CSI-RS CDM ç  å‡ºç°ä¸€æ¬¡ï¼›</li><li>FrequencyDomainBitmap = [001110]ï¼Œ$k_0 =2 f(1) = 2ï¼Œk_1=2f(2)=2\times 2 = 4,k_2=2f(3)=2\times 4=8$ï¼›</li><li>cdm4-FD2-TD2ï¼šä¸€ç»„CDMç å ä¸¤ä¸ªç¬¦å· $(lâ€™=0,1)$ï¼Œä¸¤ä¸ªå­è½½æ³¢ $(kâ€™=0,1)$<ul><li>å¤©çº¿ç«¯å£3000ï¼Œ3001ä½äºç¬¦å· 2 çš„ #2 - #3 å­è½½æ³¢</li><li>å¤©çº¿ç«¯å£3002ï¼Œ3003ä½äºç¬¦å· 3 çš„ #2 - #3 å­è½½æ³¢</li><li>å¤©çº¿ç«¯å£3004ï¼Œ3005ä½äºç¬¦å· 2 çš„ #4 - #5 å­è½½æ³¢</li><li>å¤©çº¿ç«¯å£3006ï¼Œ3007ä½äºç¬¦å· 3 çš„ #4 - #5 å­è½½æ³¢</li><li>å¤©çº¿ç«¯å£3008ï¼Œ3009ä½äºç¬¦å· 2 çš„ #8 - #9 å­è½½æ³¢</li><li>å¤©çº¿ç«¯å£3010ï¼Œ3011ä½äºç¬¦å· 3 çš„ #8 - #9 å­è½½æ³¢</li></ul></li></ul><p><img src="/5G_Protocol/5G-NR-%E5%8F%82%E8%80%83%E4%BF%A1%E5%8F%B7%E5%AD%A6%E4%B9%A0/p8-CSI%E6%98%A0%E5%B0%844.png" alt></p><h4 id="1-3-2-2-BWPå†…"><a class="header-anchor" href="#1-3-2-2-BWPå†…">Â¶</a>1.3.2.2 BWPå†…</h4><p>åœ¨CSI-RSæ‰€å…³è”çš„BWPå†…ï¼Œä¸»è¦è€ƒè™‘ <em>CSI-Frequency Occupation</em> å‚æ•°ï¼Œéœ€è¦ç¡®å®šèµ·å§‹RBä»¥åŠRBä¸ªæ•°ã€‚åˆ†åˆ«ç”± <em>CSI-Frequency Occupation -&gt; startingRB</em> å’Œ <em>CSI-Frequency Occupation -&gt; nrofRBs</em> å†³å®šã€‚<br>ä»¥ä¸‹å†ä¸€æ¬¡å¼•å…¥ä¸Šé¢ä¾‹å­(1)(2)ï¼ŒBWPå†…æ˜ å°„æƒ…å†µå¦‚ä¸‹ï¼š</p><ul><li>è‹¥row1_FrequencyDomainBitmap=[0001]ï¼Œåˆ™$k_0 = f(1) = 0$ï¼›</li></ul><p><img src="/5G_Protocol/5G-NR-%E5%8F%82%E8%80%83%E4%BF%A1%E5%8F%B7%E5%AD%A6%E4%B9%A0/p9-CSI%E6%98%A0%E5%B0%84BWP1.png" alt></p><ul><li>è‹¥row2_FrequencyDomainBitmap=[000000000010]ï¼Œåˆ™$k_0=f(1)=1$</li></ul><p><img src="/5G_Protocol/5G-NR-%E5%8F%82%E8%80%83%E4%BF%A1%E5%8F%B7%E5%AD%A6%E4%B9%A0/p10-CSI%E6%98%A0%E5%B0%84BWP2.png" alt></p><h2 id="1-4-CSI-RS-çš„å‘é€æ—¶éš™"><a class="header-anchor" href="#1-4-CSI-RS-çš„å‘é€æ—¶éš™">Â¶</a>1.4 CSI-RS çš„å‘é€æ—¶éš™</h2><p>å½“<em>CSI-ResourceSet</em> é…ç½®ä¸ºå‘¨æœŸæˆ–åŠæŒç»­é…ç½®æ—¶ï¼ŒCSI-RSçš„å‘é€æ—¶éš™æ»¡è¶³ä»¥ä¸‹å…¬å¼ï¼š<br>$$<br>(N_{slot}<sup>{frame,\mu}n_f+n_{s,f}</sup>{\mu}-T_{offset})modT_{CSI-RS} = 0<br>$$<br>å…¶ä¸­ï¼š</p><ul><li>$N_{slot}^{frame,\mu}$ä¸ºå­è½½æ³¢é—´éš”é…ç½® $\mu$ ä¸‹ï¼Œä¸€ä¸ªç³»ç»Ÿå¸§çš„æ—¶éš™çš„ä¸ªæ•°</li><li>$n_f$ ä¸ºç³»ç»Ÿå¸§å·</li><li>$n_{s,f}^{\mu}$ ä¸ºå­è½½æ³¢é—´éš”é…ç½® $\mu$ ä¸‹ï¼Œä¸€ä¸ªç³»ç»Ÿå¸§ä¸­è«æ ¼æ—¶éš™çš„åºå·</li><li>$T_{CSI-RS}ï¼ŒT_{offest}$ï¼Œåˆ†åˆ«ä¸ºCSI-RSçš„å‘¨æœŸ(å•ä½ï¼šms)å’Œæ¯ä¸ªå‘¨æœŸçš„åç§»é‡(å•ä½ï¼šslot)ã€‚ç”±â‘ <em>NZP-CSI-RS-Resource -&gt; periodicityAndOffset</em> æˆ– <em>ZP-CSI-RS-Resource -&gt; periodicityAndOffset</em> ï¼›â‘¡CSI-RS-Resource-Mobility -&gt; slotConfig è·å–ã€‚</li></ul><p><strong>ä»¥ä¸‹ç®€å•æè¿° ZP CSI-RSï¼ŒCSI-IM (interference measurement)ï¼ŒCSI-RS for Trackingï¼ŒCSI-RS for L1-RSRPï¼ŒCSI-RS for mobilityã€‚</strong></p><h2 id="1-5-ZP-CSI-RS"><a class="header-anchor" href="#1-5-ZP-CSI-RS">Â¶</a>1.5 ZP CSI-RS</h2><p>åœ¨ ZP CSI-RS ä¸Šï¼ŒåŸºç«™ä¸å‘é€CSI-RSå‚è€ƒä¿¡å·ï¼ŒåŠŸç‡ä¸º0ï¼Œç›®çš„ç”¨äºPDSCHé€Ÿç‡é€‚é…ï¼Œå³PDSCHçš„å‘é€ä¸ä½¿ç”¨ZP CSI-RSå ç”¨çš„REç¬¦å·ã€‚åœ¨<em>PDSCH-Comfig</em>é…ç½®äº†ä¸‰ç§ZP CSI-RS Resource Set ï¼ˆå‘¨æœŸ/åŠæŒç»­/éå‘¨æœŸï¼‰ã€‚<br>åœ¨PDSCHä¸­ï¼Œæœ€å¤šé…ç½®32ä¸ªZP CSI-RS Resource Setï¼Œæ¯ä¸ªResource Set ä¸­ï¼ŒåŒ…å«æœ€å¤š16ä¸ª Resourceã€‚<br>å¯¹äºZP CSI-RSé…ç½®çš„ <em>CSI-RS-ResourceMapping</em>ï¼Œå‚æ•°å«ä¹‰å’ŒNZP CSI-RS ä¸€è‡´</p><h2 id="1-6-CSI-RS-é…ç½®æ¡†æ¶"><a class="header-anchor" href="#1-6-CSI-RS-é…ç½®æ¡†æ¶">Â¶</a>1.6 CSI-RS é…ç½®æ¡†æ¶</h2><p>æ¯ä¸€ä¸ªCSI Report Setting ï¼ˆ<em>CSI-ReportConfig</em>ï¼‰ å…³è”ä¸€ä¸ªResource Settingï¼ˆ<em>CSI-ResourceCofig</em>ï¼‰ï¼›ä¸€ä¸ª Resource Setting å½’å±åˆ°ä¸€ä¸ªBWPï¼Œç±»å‹ä¸ºéå‘¨æœŸï¼Œå‘¨æœŸæˆ–è€…åŠæŒç»­ã€‚Resource Setting ä¸­åŒ…æ‹¬ S ä¸ªResource Setï¼Œå¯¹äºå‘¨æœŸæˆ–è€…åŠæŒç»­Resource Settingï¼ŒS=1ï¼Œå³åªæœ‰ä¸€ä¸ªèµ„æºé›†ï¼›<br>åŸºç«™é€‰æ‹©ä¸€ä¸ªResource Set ç”¨äºUEæµ‹é‡ï¼›ä¸€ä¸ªResource Setä¸­åŒ…å«äº†å‚è€ƒä¿¡å·åˆ—è¡¨ï¼Œå¯ä»¥æ˜¯NZP CSI-RS æˆ–è€…CSI-SSBï¼ŒCSI-IMï¼Œç”¨<em>ResourceID</em> æ ‡è¯†ã€‚UE åœ¨Resource Set ä¸­å¯¹ä¸€ä¸ªResource è¿›è¡Œæµ‹é‡å’ŒæŠ¥å‘Šã€‚</p><h2 id="1-7-CSI-IMåŠå…¶èµ„æºæ˜ å°„"><a class="header-anchor" href="#1-7-CSI-IMåŠå…¶èµ„æºæ˜ å°„">Â¶</a>1.7 CSI-IMåŠå…¶èµ„æºæ˜ å°„</h2><p>CSI-IMç”¨äºè¿›è¡Œå¹²æ‰°ä¼°è®¡ã€‚UE å¯ä»¥é…ç½®1ä¸ªæˆ–è€…å¤šä¸ªCSI-IM ResourceSetï¼Œæ¯ä¸ªSetåŒ…å« $K\geq 1$ ä¸ªèµ„æºã€‚CSI-IMçš„èµ„æºæ˜ å°„ç›¸å¯¹ç®€å•ï¼ŒCSI-IMä¹Ÿå¯ä»¥æ˜¯éå‘¨æœŸï¼Œå‘¨æœŸå’ŒåŠæŒç»­ç±»å‹ã€‚</p><h3 id="1-7-1-Pattern-0"><a class="header-anchor" href="#1-7-1-Pattern-0">Â¶</a>1.7.1 Pattern 0</h3><p>å½“èµ„æºæ˜ å°„æ–¹å¼é…ç½®ä¸ºPattern 0 æ—¶ï¼ŒCSI-IMçš„èµ„æºæ˜ å°„åˆ°å¦‚ä¸‹REï¼š<br>$$<br>(k_{CSI-IM},l_{CSI-IM}),(k_{CSI-IM},l_{CSI-IM}+1),(k_{CSI-IM}+1,l_{CSI-IM}),(k_{CSI-IM}+1,l_{CSI-IM}+1)<br>$$</p><p><img src="/5G_Protocol/5G-NR-%E5%8F%82%E8%80%83%E4%BF%A1%E5%8F%B7%E5%AD%A6%E4%B9%A0/p27-CSI-IM-p0.png" alt></p><h3 id="1-7-2-Pattern-1"><a class="header-anchor" href="#1-7-2-Pattern-1">Â¶</a>1.7.2 Pattern 1</h3><p>å½“èµ„æºæ˜ å°„æ–¹å¼é…ç½®ä¸ºPattern 1 æ—¶ï¼ŒCSI-IMçš„èµ„æºæ˜ å°„åˆ°å¦‚ä¸‹REï¼š<br>$$<br>(k_{CSI-IM},l_{CSI-IM}),(k_{CSI-IM}+1,l_{CSI-IM}),(k_{CSI-IM}+2,l_{CSI-IM}),(k_{CSI-IM}+3,l_{CSI-IM})<br>$$</p><p><img src="/5G_Protocol/5G-NR-%E5%8F%82%E8%80%83%E4%BF%A1%E5%8F%B7%E5%AD%A6%E4%B9%A0/p28-CSI-IM-p1.png" alt></p><h3 id="1-7-3-å¹²æ‰°æµ‹é‡"><a class="header-anchor" href="#1-7-3-å¹²æ‰°æµ‹é‡">Â¶</a>1.7.3 å¹²æ‰°æµ‹é‡</h3><p>å¯¹äºCSI-IMé…ç½®çš„èµ„æºï¼ŒåŸºç«™ä¸å‘é€ä»»ä½•ä¿¡å·ï¼Œä¹Ÿå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ç§ZP CSI-RSã€‚UEåœ¨CSI-IM ä¸Šæµ‹é‡çš„å¹²æ‰°ä¿¡å·ï¼Œæ¥è‡ªäºé‚»åŒºæˆ–è€…ä¸ºåº•å™ªï¼Œç”¨æ¥è¿›è¡Œå¹²æ‰°ä¼°è®¡ã€‚</p><h2 id="1-8-CSI-RS-for-Tracking"><a class="header-anchor" href="#1-8-CSI-RS-for-Tracking">Â¶</a>1.8 CSI-RS for Tracking</h2><p>CSI-RS for Trackingï¼Œä¹Ÿç§°ä¸ºTRS(tracking reference signal)ï¼Œæ˜¯ä¸€ç§æ¯”è¾ƒç‰¹æ®Šçš„å‚è€ƒä¿¡å·ï¼ŒUEç”¨æ¥è¿›è¡Œç²¾ç¡®çš„æ—¶é¢‘åŸŸåŒæ­¥ï¼ˆç²¾åº¦é«˜äºSSBï¼‰ã€‚<br>åœ¨ResourceSetè®¾ç½®trs-info ä¸º trueï¼ŒResourceSet ä¸­çš„TRSä½¿ç”¨ç›¸åŒç«¯å£ï¼›åœ¨RRCé“¾æ¥æ€ä¸‹ï¼Œå¿…é¡»é…ç½®TRSã€‚<br>TRSæ—¶åŸŸç‰¹æ€§ï¼š</p><ul><li>å¯¹äºFR1ï¼ŒUEå¯ä»¥é…ç½®1ä¸ªæˆ–è€…å¤šä¸ªSetï¼Œæ¯ä¸ªSetåŒ…å«è¿ç»­ä¸¤ä¸ªæ—¶éš™ï¼Œä¸€å…±4ä¸ªèµ„æºResourceï¼Œæ¯ä¸ªæ—¶éš™2ä¸ªèµ„æºResource;</li><li>å¯¹äºFR2ï¼Œå¯ä»¥é…ç½®4ä¸ªèµ„æºï¼ˆFR1ï¼‰ï¼Œä¹Ÿå¯ä»¥é…ç½®ä¸¤ä¸ªèµ„æºï¼ˆä¸€ä¸ªæ—¶éš™ï¼‰</li></ul><p>ç¬¦å·ä½ç½®ï¼š</p><ul><li>FR1/FR2ï¼š$l\in {4,8},l\in {5,9},or,l\in {6,10}$</li><li>FR2ï¼š$l\in {0,4},l\in {1,5},l\in {2,6},l\in {3,7},l\in {7,11},l\in {8,12},l\in {9,13}$</li></ul><h2 id="1-9-CSI-RS-for-L1-RSRP"><a class="header-anchor" href="#1-9-CSI-RS-for-L1-RSRP">Â¶</a>1.9 CSI-RS for L1-RSRP:</h2><p>ç”¨äºL1 å±‚RSRPæµ‹é‡ä¸æ³¢æŸç®¡ç†ã€‚<br>åœ¨ResourceSetè®¾ç½®Repetionå­—æ®µï¼Œè¡¨ç¤ºç”¨äºL1-RSRPæµ‹é‡</p><ul><li>On è¡¨ç¤ºResourceSetä¸­çš„å¤šä¸ªResourceä½¿ç”¨ç›¸åŒçš„ä¸‹è¡Œæ³¢æŸå‘é€</li><li>Off è¡¨ç¤ºResourceSetä¸­çš„å¤šä¸ªResourceä½¿ç”¨ä¸åŒçš„ä¸‹è¡Œæ³¢æŸå‘é€</li></ul><h2 id="1-10-CSI-RS-for-mobility"><a class="header-anchor" href="#1-10-CSI-RS-for-mobility">Â¶</a>1.10 CSI-RS for mobility</h2><p>CSI-RSå¯ä»¥ç”¨æ¥è¿›è¡ŒRRå—æµ‹é‡ï¼Œç”¨äºç§»åŠ¨æ€§ç®¡ç†ï¼ˆåˆ‡æ¢ï¼‰ã€‚</p><h1>2 SRS</h1><p>LTEä¸­å·²ç»æ”¯æŒ SRS ï¼ŒåŸºç«™å¯ä»¥åˆ©ç”¨SRSè¯„ä¼°ä¸Šè¡Œä¿¡é“å‚æ•°ï¼Œå¯¹äºTDDç³»ç»Ÿï¼Œåˆ©ç”¨ä¿¡é“äº’å¼‚æ€§ï¼Œä¹Ÿå¯ä»¥è¯„ä¼°ä¸‹è¡Œä¿¡é“å‚æ•°ã€‚<br>NRä¸­ä¹Ÿæ”¯æŒSRSï¼ŒåŸºç«™å¯ä»¥åˆ©ç”¨SRSè¯„ä¼°ä¸Šè¡Œ(ä¸‹è¡Œ)ä¿¡é“è´¨é‡ä»¥å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨SRSè¿›è¡Œä¸Šè¡Œæ³¢æŸçš„ç®¡ç†ï¼ŒåŒ…æ‹¬æ³¢æŸè®­ç»ƒï¼Œæ³¢æŸåˆ‡æ¢ç­‰ã€‚</p><h2 id="2-1-SRS-é…ç½®"><a class="header-anchor" href="#2-1-SRS-é…ç½®">Â¶</a>2.1 SRS é…ç½®</h2><p>ä¸€äº›é‡è¦å‚æ•°é…ç½®å¦‚ä¸‹ï¼š</p><p><img src="/5G_Protocol/5G-NR-%E5%8F%82%E8%80%83%E4%BF%A1%E5%8F%B7%E5%AD%A6%E4%B9%A0/p26-SRS%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE.png" alt></p><h2 id="2-2-SRS-å‘é€æ¢³é…ç½®"><a class="header-anchor" href="#2-2-SRS-å‘é€æ¢³é…ç½®">Â¶</a>2.2 SRS å‘é€æ¢³é…ç½®</h2><p>å’ŒLETç±»ä¼¼ï¼ŒNRä¸­çš„SRSåœ¨é¢‘åŸŸä¸Šï¼Œä¹Ÿé‡‡ç”¨äº† â€œæ¢³çŠ¶â€ Comb å‘é€çš„æ–¹å¼ï¼Œå³å¯¹äºå•UEï¼Œåœ¨é¢‘åŸŸä¸Šï¼Œæ¯Nä¸ªå­è½½æ³¢å‘é€SRSï¼›NRä¸­ï¼Œå‘é€æ¢³ <em>transmissionComb</em> æ”¯æŒ N=2 æˆ– N=4é…ç½®ï¼Œå…¶ä¸­çš„ $K_{TC}$ å‚æ•°è¡¨ç¤º Nï¼Œå…¶ä¸­ <em>combOffset</em> ä¸ºå‘é€æ¢³åç½®ï¼Œå¯¹äºN=2 æˆ– N=4ï¼Œåˆ†æ¯”ä¸º {0,1}ï¼Œ{0,1,2,3}ã€‚ä¸åŒUEå¯ä»¥é…ç½®ä¸åŒå­è½½æ³¢ä¸Šçš„é¢‘åˆ†å¤ç”¨ã€‚</p><h2 id="2-3-åºåˆ—ç”Ÿæˆ"><a class="header-anchor" href="#2-3-åºåˆ—ç”Ÿæˆ">Â¶</a>2.3 åºåˆ—ç”Ÿæˆ</h2><p>SRS åºåˆ—é•¿åº¦å®šä¹‰ $M_{sc,b}^{RS} = m_{SRS,b}N_{sc}^{RB}/K_{TC}$ã€‚SRS çš„åºåˆ—é•¿åº¦ä¸ºSRSåœ¨é¢‘åŸŸä¸Šçš„å­è½½æ³¢ä¸ªæ•°ã€‚å…¶ä¸­$m_{SRS,b}$ ç”± [TS 38.211 6.4.1.4.3-1] ç»™å‡ºï¼Œè§ä¸‹æ–‡ã€‚<br>SRSèµ„æºçš„åºåˆ—æŒ‰ç…§å¦‚ä¸‹å…¬å¼ç”Ÿæˆï¼š<br>$$<br>r<sup>{p_i}(n,lâ€™)=r_{u,v}</sup>{(\alpha_i,\delta)}(n)\0\leq n \leq M_{sc,b}^{RS}-1\lâ€™\in {0,1,â€¦,N_{symb}<sup>{SRS}-1}\N_{symb}</sup>{SRS}\in {1,2,4}<br>$$<br>å…¶ä¸­ï¼š</p><ul><li>$\alpha_i$ï¼Œç”± <em>cyclic shift</em> $\alpha_i$ ç»™å‡ºï¼Œè§ä¸‹æ–‡ï¼›</li><li>$\delta = log_2(K_{TC})$</li><li>$r_{u,v}^{(\alpha,\delta)}(n)$ï¼Œä¸ºä½å³°å‡æ¯”åºåˆ—ï¼Œç”± [TS 38.211 5.2.2] å®šä¹‰ï¼Œ$r_{u,v}<sup>{(\alpha,\delta)}(n)=e</sup>{j\alpha n}\overline r_{u,v}(n),0\leq n\leq M_{ZC}$ï¼Œ$M_{ZC}$ ä¸ºåºåˆ—é•¿åº¦,æŒ‰ç…§SRSåºåˆ—æ¥è¯´å°±æ˜¯ $M_{sc,b}^{RS}$ ã€‚</li></ul><h2 id="2-4-SRSå¾ªç¯ç§»ä½"><a class="header-anchor" href="#2-4-SRSå¾ªç¯ç§»ä½">Â¶</a>2.4 SRSå¾ªç¯ç§»ä½</h2><p>ä¸åŒçš„UEå¯ä»¥ä½¿ç”¨ç›¸åŒçš„SRSç‰©ç†èµ„æºï¼Œæ­¤æ—¶ä¸åŒUEçš„ä¸åŒSRSç«¯å£ï¼Œé€šè¿‡ä¸åŒçš„å¾ªç¯ç§»ä½ <em>cyclic shift</em> $\alpha_i$ å¤ç”¨ã€‚æ ¹æ®ä¸åŒå‘é€æ¢³é…ç½®ï¼Œæ”¯æŒçš„æœ€å¤§å¾ªç¯ç§»ä½ä¸ªæ•°ä¸ç›¸åŒï¼š</p><ul><li>$K_{TC}=2$ï¼Œ$n_{SRS}^{CS,max} = 8$</li><li>$K_{TC}=4$ï¼Œ$n_{SRS}^{CS,max} = 12$</li></ul><p>å¯¹äºå¤©çº¿ç«¯å£ $p_i$ï¼Œå¾ªç¯ç§»ä½ $\alpha_i$ æ ¹æ®ä»¥ä¸‹å…¬å¼ç¡®å®šï¼š<br>$$<br>\alpha_i = 2\pi\frac{n_{SRS}<sup>{CS,i}}{n_{SRS}</sup>{CS,max}}\n_{SRS}^{CS,i}=\left( n_{SRS}<sup>{CS}+\frac{n_{SRS}</sup>{CS,max}(p_i-100)}{N_{ap}^{SRS}}\right) modn_{SRS}<sup>{CS,max}\n_{SRS}</sup>{CS} \in {0,1,â€¦,n_{SRS}<sup>{CS,max}-1}\N_{ap}</sup>{SRS}\in{1,2,4}<br>$$</p><h2 id="2-4-æ˜ å°„"><a class="header-anchor" href="#2-4-æ˜ å°„">Â¶</a>2.4 æ˜ å°„</h2><h3 id="2-4-1-æ—¶åŸŸèµ„æºé…ç½®"><a class="header-anchor" href="#2-4-1-æ—¶åŸŸèµ„æºé…ç½®">Â¶</a>2.4.1 æ—¶åŸŸèµ„æºé…ç½®</h3><p>ç”±ä¸¤ä¸ªå‚æ•°å†³å®šï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nrofSymbols		ENUMERATED &#123;n1,n2,n4&#125;</span><br><span class="line">startPosition	ENuMERATED &#123;0..5&#125;</span><br></pre></td></tr></table></figure><p>åˆ†åˆ«è¡¨ç¤º $N_{symb}^{SRS} \in {1,2,4}$ ä¸ªOFDM ç¬¦å·ï¼Œ$l_{offset}\in {0,1,â€¦,5}$ã€‚<br>SRS çš„æ—¶åŸŸå¼€å§‹ç¬¦å· $l_0=N_{symb}^{slot}-1-l_{offset}ï¼Œl_{offset} \geq N_{symb}^{SRS}-1$ã€‚å³ä»æ—¶éš™çš„æœ€åä¸€ä¸ªç¬¦å·å¼€å§‹å€’æ•°è®¡æ•°ï¼ˆSRSä¸èƒ½è¶…è¿‡æ—¶éš™çš„è¾¹ç•Œï¼‰</p><p>ä¸¾ä¾‹</p><ul><li>$N_{symb}^{SRS} =1ï¼Œl_{offset} =2 ï¼Œl_0 = 11$</li></ul><p><img src="/5G_Protocol/5G-NR-%E5%8F%82%E8%80%83%E4%BF%A1%E5%8F%B7%E5%AD%A6%E4%B9%A0/p10-SRS%E6%97%B6%E9%9A%99%E9%85%8D%E7%BD%AE1.png" alt></p><ul><li>$N_{symb}^{SRS} =4ï¼Œl_{offset} =3 ï¼Œl_0 = 10$</li></ul><p><img src="/5G_Protocol/5G-NR-%E5%8F%82%E8%80%83%E4%BF%A1%E5%8F%B7%E5%AD%A6%E4%B9%A0/p11-SRS%E6%97%B6%E9%9A%99%E9%85%8D%E7%BD%AE.png" alt></p><h3 id="2-4-2-é¢‘åŸŸèµ„æº"><a class="header-anchor" href="#2-4-2-é¢‘åŸŸèµ„æº">Â¶</a>2.4.2 é¢‘åŸŸèµ„æº</h3><p>SRSé¢‘åŸŸèµ„æºé…ç½®å’Œæ˜ å°„ç›¸å¯¹å¤æ‚ï¼Œä½†å½’æ ¹ç»“åº•æ˜¯éœ€è¦ç¡®å®šSRSåœ¨é¢‘åŸŸçš„èµ·å§‹å­è½½æ³¢ä½ç½®å’Œé¢‘åŸŸä¸Šçš„å¸¦å®½åˆ†å¸ƒã€‚ä¸»è¦åœ¨SRS-Resourceä¸‹è¿™å‡ ä¸ªå‚æ•°é…ç½®ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">freqDomainPosition	INTEGER (0..67);	&#x2F;&#x2F; é¢‘åŸŸä½ç½®</span><br><span class="line">freqDomainShifft	INTEGER (0..268);	&#x2F;&#x2F; é¢‘åŸŸåç§»</span><br><span class="line">freqHopping		SEQUENCE &#123;				&#x2F;&#x2F; è·³é¢‘ç›¸å…³é…ç½®</span><br><span class="line">	c-SRS			INTEGER (0..63);</span><br><span class="line">	b-SRS			INTEGER (0..3);</span><br><span class="line">	b-hop			INTEGER (0..3);</span><br></pre></td></tr></table></figure><p>å‚æ•°åˆ†åˆ«å¯¹åº”çš„ç‰©ç†å±‚å˜é‡åä¸ºï¼š</p><ul><li>$n_{RRC}$</li><li>$n_{shift}$</li><li>$C_{SRS}\in{0,1,â€¦,63}$</li><li>$B_{SRS}\in {0,1,2,3}$</li><li>$b_{hop}\in {0,1,2,3}$</li></ul><p>å‚æ•° $m_{SRS,b}$ ä¸ºSRS åœ¨é¢‘åŸŸä¸Šåˆ†å¸ƒçš„RBä¸ªæ•°ï¼Œæ ¹æ® $C_{SRS}ï¼ŒB_{SRS}$ é…ç½®ï¼Œç”±[TS 38.211 Table 6.4.1.4.3-1] ç¡®å®šï¼š</p><p><img src="/5G_Protocol/5G-NR-%E5%8F%82%E8%80%83%E4%BF%A1%E5%8F%B7%E5%AD%A6%E4%B9%A0/t3-211-6.4.1..4.3-11.png" alt><br><img src="/5G_Protocol/5G-NR-%E5%8F%82%E8%80%83%E4%BF%A1%E5%8F%B7%E5%AD%A6%E4%B9%A0/t4-211-6.4.1..4.3-12.png" alt><br><img src="/5G_Protocol/5G-NR-%E5%8F%82%E8%80%83%E4%BF%A1%E5%8F%B7%E5%AD%A6%E4%B9%A0/t5-211-6.4.1..4.3-13.png" alt></p><h3 id="2-4-3-é¢‘åŸŸèµ„æºç‰¹æ€§"><a class="header-anchor" href="#2-4-3-é¢‘åŸŸèµ„æºç‰¹æ€§">Â¶</a>2.4.3 é¢‘åŸŸèµ„æºç‰¹æ€§</h3><p>SRSçš„é¢‘åŸŸèµ·å§‹ä½ç½®å®šä¹‰å¦‚ä¸‹ï¼š<br>$$<br>k_0^{p_i}=\overline k_0^{(p_i)}+ \sum_{b=0}<sup>{B_{SRS}}K_{TC}M_{sc,b}</sup>{SRS}n_b\ \overline k_0<sup>{(p_i)}=n_{shift}N_{sc}</sup>{RB}+k_{TC}<sup>{(p_i)}\k_{TC}</sup>{(p_i)}=\begin{cases} (\overline k_{TC}+K_{TC}/2)modK_{TC}\quad \quad if\quad n_{SRS}^{CS}\in {n_{SRS}<sup>{cs,max}/2,â€¦,n_{SRS}</sup>{cs,max}-1}\ \quad\quad \quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\cdots\quad and\quad N_{ap}^{SRS}=4,p_i \in {1001,1003}\ \overline k_{TC} \quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad otherwise \end{cases}<br>$$</p><p>å…¶ä¸­ï¼š</p><ul><li>$\overline k_{TC} \in {0,1,â€¦,K_{TC}-1}$ ï¼Œä¸ºå‘é€æ¢³åç½® <em>combOffset</em>ï¼›</li><li>$K_{TC}$ ä¸ºå‘é€æ¢³é…ç½®ï¼Œç”±<em>transmissionComb</em>é…ç½®ï¼›</li><li>$n_{shift}$ ç”± <em>freqDomainShift</em> é…ç½®ï¼›</li><li>å½“ $b_{hop} \geq B_{SRS}$ ï¼Œå³ä¸è·³é¢‘ï¼Œæ­¤æ—¶$n_b = \lfloor 4n_{RRC}/m_{SRS,b} \rfloor mod N_b$<ul><li>$n_{RRC}$ ç”± <em>freqDomainPosition</em> é…ç½®ï¼›</li><li>$b_{hop}$ ç”± <em>freqHopping -&gt; b-hop</em> é…ç½®ã€‚</li></ul></li></ul><h3 id="2-4-4-é¢‘åŸŸèµ„æºé…ç½®"><a class="header-anchor" href="#2-4-4-é¢‘åŸŸèµ„æºé…ç½®">Â¶</a>2.4.4 é¢‘åŸŸèµ„æºé…ç½®</h3><h4 id="2-4-4-1-é¢‘åŸŸèµ„æºé…ç½®ï¼ˆéè·³é¢‘ï¼‰"><a class="header-anchor" href="#2-4-4-1-é¢‘åŸŸèµ„æºé…ç½®ï¼ˆéè·³é¢‘ï¼‰">Â¶</a>2.4.4.1 é¢‘åŸŸèµ„æºé…ç½®ï¼ˆéè·³é¢‘ï¼‰</h4><p>å½“ $b_{hop} \geq B_{SRS}$ï¼Œ$n_b=\lfloor 4n_{RRC}/m_{SRS,b} \rfloor mod N_b$ã€‚<br>ä»¥ä¸‹ç›´æ¥ç”¨4ä¸ªä¾‹å­è¯´æ˜ï¼Œéƒ½è®¾å®šå‚æ•° $C_{RS} = 63ï¼ŒK_{TC} = 2$ï¼Œ$n_{RRC}$ ç”± <em>freqDomainPosition</em> é…ç½®ï¼Œä¸ºäº†æ–¹ä¾¿ä½œå›¾ï¼Œå‡å®šé¢‘åŸŸåˆå§‹RBçº§åç§»ä¸º0ã€‚</p><ul><li><ol><li>$B_{SRS} = 0$</li></ol></li></ul><p><img src="/5G_Protocol/5G-NR-%E5%8F%82%E8%80%83%E4%BF%A1%E5%8F%B7%E5%AD%A6%E4%B9%A0/p13-%E9%9D%9E%E8%B0%83%E9%A2%911.png" alt></p><p>æ­¤æ—¶ï¼Œ$N_0=1,m_{SRS,0}=272,n_0=\lfloor 4n_{RRC}/m_{SRS,0} \rfloor mod N_0 = 0$<br>$$<br>k_0^{p_i}=\overline k_0^{(p_i)}+ \sum_{b=0}<sup>{B_{SRS}}K_{TC}M_{sc,b}</sup>{SRS}n_b = \overline k_0^{(p_i)} \ \overline k_0<sup>{(p_i)}=n_{shift}N_{sc}</sup>{RB}+k_{TC}^{(p_i)}<br>$$</p><p>æ­¤æ—¶ $n_{shift}$ é…ç½®ä¸º 0/1ï¼Œæ­¤ç§æƒ…å†µ SRSåˆ†å¸ƒåœ¨å…¨éƒ¨é…ç½®çš„RBä¸Šï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/5G_Protocol/5G-NR-%E5%8F%82%E8%80%83%E4%BF%A1%E5%8F%B7%E5%AD%A6%E4%B9%A0/p17-%E9%9D%9E%E8%B0%83%E9%A2%9111.png" alt></p><ul><li><ol start="2"><li>$B_{SRS} = 1$</li></ol></li></ul><p><img src="/5G_Protocol/5G-NR-%E5%8F%82%E8%80%83%E4%BF%A1%E5%8F%B7%E5%AD%A6%E4%B9%A0/p14-%E9%9D%9E%E8%B0%83%E9%A2%912.png" alt></p><p>æ­¤æ—¶ï¼š<br>$$<br>N_0=1,m_{SRS,0}=272,n_0=\lfloor 4n_{RRC}/m_{SRS,0} \rfloor mod N_0 = 0\N_1=17,m_{SRS,1}=16,n_1=\lfloor 4n_{RRC}/m_{SRS,1} \rfloor mod N_1 \in {0,1,â€¦,16}<br>$$<br>$$<br>k_0^{p_i}=\overline k_0^{(p_i)}+ \sum_{b=0}<sup>{B_{SRS}}K_{TC}M_{sc,b}</sup>{SRS}n_b = \overline k_0^{(p_i)} +K_{TC}M_{sc,1}^{SRS}n_1 \ \overline k_0<sup>{(p_i)}=n_{shift}N_{sc}</sup>{RB}+k_{TC}^{(p_i)}<br>$$</p><p>æ­¤ç§æƒ…å†µå°±æ˜¯æŠŠSRSæ€»å¸¦å®½åˆ†ä¸ºäº† $N_1$ ä¸ªç­‰ä»½ï¼Œæ¯ä¸ªç­‰ä»½çš„RBä¸ªæ•°ä¸º $m_{SRS,1}$ï¼Œé€šè¿‡ $n_{RRC}$ æ¥é…ç½®å–å“ªä¸ªç­‰ä»½çš„ç´¢å¼•ï¼Œæœ¬ä¾‹å­é‡‡ç”¨ $n_1 = 1$ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/5G_Protocol/5G-NR-%E5%8F%82%E8%80%83%E4%BF%A1%E5%8F%B7%E5%AD%A6%E4%B9%A0/p18-%E9%9D%9E%E8%B0%83%E9%A2%9122.png" alt></p><ul><li><ol start="3"><li>$B_{SRS} = 2$</li></ol></li></ul><p><img src="/5G_Protocol/5G-NR-%E5%8F%82%E8%80%83%E4%BF%A1%E5%8F%B7%E5%AD%A6%E4%B9%A0/p15-%E9%9D%9E%E8%B0%83%E9%A2%913.png" alt></p><p>æ­¤æ—¶ï¼š<br>$$<br>N_0=1,m_{SRS,0}=272,n_0=\lfloor 4n_{RRC}/m_{SRS,0} \rfloor mod N_0 = 0\N_1=17,m_{SRS,1}=16,n_1=\lfloor 4n_{RRC}/m_{SRS,1} \rfloor mod N_1 \in {0,1,â€¦,16}\N_2=2,m_{SRS,2}=8,n_2=\lfloor 4n_{RRC}/m_{SRS,2} \rfloor mod N_2 \in {0,1 }<br>$$<br>$$<br>k_0^{p_i}=\overline k_0^{(p_i)}+ \sum_{b=0}<sup>{B_{SRS}}K_{TC}M_{sc,b}</sup>{SRS}n_b = \overline k_0^{(p_i)} +K_{TC}M_{sc,1}<sup>{SRS}n_1+K_{TC}M_{sc,2}</sup>{SRS}n_2 \ \overline k_0<sup>{(p_i)}=n_{shift}N_{sc}</sup>{RB}+k_{TC}^{(p_i)}<br>$$<br>æ­¤ç§æƒ…å†µå°±æ˜¯æŠŠSRSæ€»å¸¦å®½åˆ†ä¸ºäº† $N_1$ ä¸ªå¤§ç­‰ä»½ï¼Œæ¯ä¸ªå¤§ç­‰ä»½çš„RBä¸ªæ•°ä¸º $m_{SRS,1}$ï¼Œé€šè¿‡ $n_{RRC}$ æ¥é…ç½®å–å“ªä¸ªå¤§ç­‰ä»½çš„ç´¢å¼•ï¼Œæœ¬ä¾‹å­é‡‡ç”¨ $n_1 = 1$ã€‚æ¥ç€ç»§ç»­å°†æ¯ä¸ªå¤§ç­‰ä»½ç»§ç»­åˆ’åˆ†ä¸º $N_2$ ä¸ªä¸­ç­‰ä»½ï¼Œæ¯ä¸ªä¸­ç­‰ä»½çš„RBæ•°ä¸º m_{SRS,2}ï¼Œé€šè¿‡$n _{RRC}$æ¥ç¡®å®šä¸­ç­‰ä»½çš„ç´¢å¼•ï¼Œæœ¬ä¾‹å­é‡‡ç”¨ $n_2 = 0$ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/5G_Protocol/5G-NR-%E5%8F%82%E8%80%83%E4%BF%A1%E5%8F%B7%E5%AD%A6%E4%B9%A0/p19-%E9%9D%9E%E8%B0%83%E9%A2%9133.png" alt></p><ul><li><ol start="4"><li>$B_{SRS} = 2$</li></ol></li></ul><p><img src="/5G_Protocol/5G-NR-%E5%8F%82%E8%80%83%E4%BF%A1%E5%8F%B7%E5%AD%A6%E4%B9%A0/p16-%E9%9D%9E%E8%B0%83%E9%A2%914.png" alt></p><p>æ­¤æ—¶ï¼š<br>$$<br>N_0=1,m_{SRS,0}=272,n_0=\lfloor 4n_{RRC}/m_{SRS,0} \rfloor mod N_0 = 0\N_1=17,m_{SRS,1}=16,n_1=\lfloor 4n_{RRC}/m_{SRS,1} \rfloor mod N_1 \in {0,1,â€¦,16}\N_2=2,m_{SRS,2}=8,n_2=\lfloor 4n_{RRC}/m_{SRS,2} \rfloor mod N_2 \in {0,1 }\N_3=2,m_{SRS,3}=4,n_3=\lfloor 4n_{RRC}/m_{SRS,3} \rfloor mod N_3 \in {0,1}<br>$$<br>$$<br>k_0^{p_i}=\overline k_0^{(p_i)}+ \sum_{b=0}<sup>{B_{SRS}}K_{TC}M_{sc,b}</sup>{SRS}n_b = \overline k_0^{(p_i)} +K_{TC}M_{sc,1}<sup>{SRS}n_1+K_{TC}M_{sc,2}</sup>{SRS}n_2+K_{TC}M_{sc,3}^{SRS}n_3 \ \overline k_0<sup>{(p_i)}=n_{shift}N_{sc}</sup>{RB}+k_{TC}^{(p_i)}<br>$$</p><p>æ­¤ç§æƒ…å†µå°±æ˜¯æŠŠSRSæ€»å¸¦å®½åˆ†ä¸ºäº†$ N_1 $ä¸ªå¤§ç­‰ä»½ï¼Œæ¯ä¸ªå¤§ç­‰ä»½çš„RBä¸ªæ•°ä¸º $m_{SRS,1}$ï¼Œé€šè¿‡ $n_{RRC}$ æ¥é…ç½®å–å“ªä¸ªå¤§ç­‰ä»½çš„ç´¢å¼•ï¼Œæœ¬ä¾‹å­é‡‡ç”¨ $ n_1 = 1$ï¼›æ¥ç€ç»§ç»­å°†æ¯ä¸ªå¤§ç­‰ä»½ç»§ç»­åˆ’åˆ†ä¸º $N_2 $ ä¸ªä¸­ç­‰ä»½ï¼Œæ¯ä¸ªä¸­ç­‰ä»½çš„RBæ•°ä¸º $m_{SRS,2}$ï¼Œé€šè¿‡ $n _{RRC}$ æ¥ç¡®å®šä¸­ç­‰ä»½çš„ç´¢å¼•ï¼Œæœ¬ä¾‹å­é‡‡ç”¨ $n_2 = 0$ï¼›æœ€åå†å°†ä¸­ç­‰ä»½åˆ’åˆ†ä¸º $N_3$ ä¸ªå°ç­‰ä»½ï¼Œæ¯ä¸ªå°ç­‰ä»½çš„RBæ•°ä¸º $m _{SRS,3}$ ï¼Œé€šè¿‡ $n _{RRC}$ æ¥ç¡®å®šå°ç­‰ä»½çš„ç´¢å¼•ï¼Œæœ¬ä¾‹å­é‡‡ç”¨çš„ $n _3 = 0$ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/5G_Protocol/5G-NR-%E5%8F%82%E8%80%83%E4%BF%A1%E5%8F%B7%E5%AD%A6%E4%B9%A0/p20-%E9%9D%9E%E8%B0%83%E9%A2%9144.png" alt></p><h4 id="2-4-4-2-é¢‘åŸŸèµ„æºé…ç½®ï¼ˆè·³é¢‘ï¼‰"><a class="header-anchor" href="#2-4-4-2-é¢‘åŸŸèµ„æºé…ç½®ï¼ˆè·³é¢‘ï¼‰">Â¶</a>2.4.4.2 é¢‘åŸŸèµ„æºé…ç½®ï¼ˆè·³é¢‘ï¼‰</h4><p>SRSå¯ä»¥æ”¯æŒè·³é¢‘ï¼Œç”±æ—¶åŸŸå’Œé¢‘åŸŸä¸¤æ–¹é¢çš„å‚æ•°å…±åŒç¡®å®šè·³é¢‘ç‰¹æ€§ã€‚<br>æ—¶åŸŸä¸Šï¼šSRSå†æ—¶éš™å†…å ç”¨ $N_s$ ä¸ªç¬¦å·ï¼ˆ1,2,4ï¼‰; <em>Repetition Factor</em>ï¼Œ$R \in {R \leq N_s}$ ï¼Œå³å†æ¯ä¸ªç¬¦å·ä¸Šé‡å¤ R æ¬¡ï¼Œæ˜¾ç„¶ï¼š</p><ul><li>å½“ $R = N_s$ æ—¶ï¼Œä¸æ”¯æŒæ—¶éš™å†…è·³é¢‘ï¼›</li><li>å½“ $R = 1,N_s=2,4$ æ—¶ï¼Œæ—¶éš™å†…è¿›è¡Œè·³é¢‘ï¼Œä»¥ä¸€ä¸ªOFDMç¬¦å·ä¸ºå•ä½è·³é¢‘ï¼›</li><li>å½“ $R = 2,N_S = 4$ æ—¶ï¼Œæ—¶éš™å†…è¿›è¡Œè·³é¢‘ï¼Œä»¥ä¸¤ä¸ªOFDMç¬¦å·ä½å•ä½è·³é¢‘ï¼›</li></ul><p>SRSæ”¯æŒä¸‰ç§ç±»å‹çš„ Resource Typeï¼š</p><ul><li>éå‘¨æœŸï¼šåªèƒ½å†æ—¶éš™å†…è¿›è¡Œï¼ˆå³è§¦å‘ä¸€æ¬¡å°±å®Œå…¨è·³å®Œï¼‰</li><li>å‘¨æœŸå’ŒåŠæŒç»­å¯ä»¥åœ¨æ—¶éš™å†…è·³é¢‘ï¼Œä¹Ÿæ”¯æŒæ—¶éš™é—´ï¼ˆå‘¨æœŸï¼‰è·³é¢‘</li></ul><p>å½“ $b_{hop} &lt; B_{SRS}$ æ—¶ï¼Œè¡¨ç¤ºè·³é¢‘ç”Ÿæ•ˆï¼Œæ­¤æ—¶é¢‘ç‡ä½ç½®å‚æ•° $n_b$ ï¼Œç”±ä»¥ä¸‹å…¬å¼ç»™å‡ºï¼š<br>$$<br>n_b=\begin{cases} \quad\quad \lfloor 4n_{RRC}/m_{SRS,b} \rfloor mod N_b\quad\quad\quad\quad\quad\quad\quad b\leq b_{hop}\ { F_b(n_SRS)+\lfloor 4n_{RRC}/m_{SRS,b} \rfloor } mod N_b\quad\quad otherwise \end{cases}\F_b(n_{SRS})=\begin{cases} (N_b/2)\lfloor \frac{n_{SRS}mod\prod_{bâ€™=b_{hop}}<sup>{b}N_{bâ€™}}{\prod_{bâ€™=b_{hop}}</sup>{b}N_{bâ€™}}+\frac{n_{SRS}mod\prod_{bâ€™=b_{hop}}<sup>{b}N_{bâ€™}}{2\prod_{bâ€™=b_{hop}}</sup>{b}N_{bâ€™}} \rfloor \quad if\quad N_b\quad even\ \quad\quad\quad\lfloor N_b/2 \rfloor\lfloor n_{SRS}/\prod_{bâ€™=b_{hop}}^{b-1}N_{bâ€™} \rfloor\quad\quad\quad\quad\quad\quad if\quad N_b\quad odd \end{cases}<br>$$</p><h5 id="2-4-4-2-1-éå‘¨æœŸ"><a class="header-anchor" href="#2-4-4-2-1-éå‘¨æœŸ">Â¶</a>2.4.4.2.1 éå‘¨æœŸ</h5><p>éå‘¨æœŸSRSï¼Œä»…æ”¯æŒæ—¶éš™å†…è·³é¢‘ï¼ˆå³ä¾æ¬¡å®Œæˆï¼‰</p><ul><li>å½“ $R = 1,N_S=2$æ—¶ï¼Œæ—¶éš™å†…è·³é¢‘ï¼Œ2ä¸ªOFDMç¬¦å·è·³é¢‘ï¼Œéœ€è¦è¦†ç›–åˆ°æ•´ä¸ªSRSå¸¦å®½ï¼Œå³æŠŠSRSå¸¦å®½åˆ†ä¸ºä¸¤ä¸ªå­å¸¦ï¼Œé€šè¿‡2ä¸ªç¬¦å·è·³é¢‘å®ç°ï¼›</li><li>å½“ $R = 1,N_S=4$æ—¶ï¼Œæ—¶éš™å†…è·³é¢‘ï¼Œ4ä¸ªOFDMç¬¦å·è·³é¢‘ï¼Œéœ€è¦è¦†ç›–åˆ°æ•´ä¸ªSRSå¸¦å®½ï¼Œå³æŠŠSRSå¸¦å®½åˆ†ä¸ºå››ä¸ªå­å¸¦ï¼Œé€šè¿‡4ä¸ªç¬¦å·è·³é¢‘å®ç°ï¼›</li><li>å½“ $R = 2,N_S=4$æ—¶ï¼Œæ—¶éš™å†…è·³é¢‘ï¼Œ4ä¸ªOFDMç¬¦å·è·³é¢‘ï¼Œéœ€è¦è¦†ç›–åˆ°æ•´ä¸ªSRSå¸¦å®½ï¼Œå³æŠŠSRSå¸¦å®½åˆ†ä¸ºä¸¤ä¸ªå­å¸¦ï¼Œé€šè¿‡2ä¸ªç¬¦å·å¯¹è·³é¢‘å®ç°ï¼›<br>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</li></ul><p><img src="/5G_Protocol/5G-NR-%E5%8F%82%E8%80%83%E4%BF%A1%E5%8F%B7%E5%AD%A6%E4%B9%A0/p21-%E8%B7%B3%E9%A2%91%E9%9D%9E%E5%91%A8%E6%9C%9F1.png" alt></p><p><img src="/5G_Protocol/5G-NR-%E5%8F%82%E8%80%83%E4%BF%A1%E5%8F%B7%E5%AD%A6%E4%B9%A0/p22-%E8%B7%B3%E9%A2%91%E9%9D%9E%E5%91%A8%E6%9C%9F2.png" alt></p><p><img src="/5G_Protocol/5G-NR-%E5%8F%82%E8%80%83%E4%BF%A1%E5%8F%B7%E5%AD%A6%E4%B9%A0/p23-%E8%B7%B3%E9%A2%91%E9%9D%9E%E5%91%A8%E6%9C%9F3.png" alt></p><p>ä»¥ä¸‹æœ‰ä¸€ä¸ªæ‘˜è‡ªæ˜¥å¤©å·¥ä½œå®¤çš„ä¾‹å­ï¼Œæ¥è¯´æ˜å¦‚ä½•ä½¿ç”¨ä¸Šæ–‡æ‰€æè¿°è·³é¢‘çš„å…¬å¼ï¼š</p><p><img src="/5G_Protocol/5G-NR-%E5%8F%82%E8%80%83%E4%BF%A1%E5%8F%B7%E5%AD%A6%E4%B9%A0/p24-%E6%98%A5%E5%A4%A9%E5%B7%A5%E4%BD%9C%E5%AE%A4%E4%BE%8B%E5%AD%901.png" alt></p><p><img src="/5G_Protocol/5G-NR-%E5%8F%82%E8%80%83%E4%BF%A1%E5%8F%B7%E5%AD%A6%E4%B9%A0/p25-%E6%98%A5%E5%A4%A9%E5%B7%A5%E4%BD%9C%E5%AE%A4%E4%BE%8B%E5%AD%902.png" alt></p><h5 id="2-4-4-2-2-å‘¨æœŸå’ŒåŠæŒç»­"><a class="header-anchor" href="#2-4-4-2-2-å‘¨æœŸå’ŒåŠæŒç»­">Â¶</a>2.4.4.2.2 å‘¨æœŸå’ŒåŠæŒç»­</h5><p>å¯¹äºå‘¨æœŸå’ŒåŠæŒç»­SRSï¼š</p><ul><li>å½“ $N_s=1$ æ—¶ï¼Œå¯ä»¥è¿›è¡Œæ—¶éš™é—´è·³é¢‘</li><li>å½“ $N_s=2 or 4$ æ—¶ï¼Œå¯ä»¥è¿›è¡Œæ—¶éš™å†…å’Œæ—¶éš™é—´è·³é¢‘</li><li>å½“ $N_s=R$ æ—¶ï¼Œå¯ä»¥è¿›è¡Œæ—¶éš™é—´è·³é¢‘</li></ul><p>å’Œéå‘¨æœŸç›¸æ¯”ï¼Œå‘¨æœŸå’ŒåŠæŒç»­ SRS è·³é¢‘å‡½æ•°ç›¸åŒï¼ŒSRSå‘é€è®¡æ•°å®šä¹‰ä¸åŒ $n_{SRS}$:<br>$$<br>n_{SRS} = ( \frac{N_{slot}<sup>{frame,\mu}n_f+n_{s,f}</sup>{\mu}-T_{offset}}{T_{SRS}})(\frac{N_{symb}^{SRS}}{R})+ \lfloor \frac{lâ€™}{R} \rfloor<br>$$<br>å³æ ¹æ®å‘¨æœŸå‘é€ï¼Œ$n_{SRS}$ è¿›è¡Œç´¯åŠ è®¡æ•°ï¼Œå®ç°äº†æ—¶éš™é—´è·³é¢‘ã€‚</p><h3 id="2-4-5-ç‰©ç†èµ„æºæ˜ å°„"><a class="header-anchor" href="#2-4-5-ç‰©ç†èµ„æºæ˜ å°„">Â¶</a>2.4.5 ç‰©ç†èµ„æºæ˜ å°„</h3><p>æœ€ç»ˆï¼Œæ ¹æ®å‰æ–‡çš„åŸºç¡€ï¼Œå½“SRSåœ¨ç»™å®šçš„SRSèµ„æºä¸Šä¼ è¾“æ—¶ï¼Œåºåˆ—$r^{(p_i)}(n,lâ€™)$ ä» $r^{(p_i)}(0,lâ€™)$ å¼€å§‹åœ¨å¤©çº¿ç«¯å£ $p_i$ ä¸Šçš„æ—¶éš™ä¸Šä¾æ¬¡æ˜ å°„åˆ°èµ„æºå•å…ƒ $(k,l)$ ä¸Šï¼Œå…¬å¼å¦‚ä¸‹ï¼š<br>$$<br>\alpha_{K_{TC}kâ€™+k_0<sup>{(p_i)},lâ€™+l_0}</sup>{(p_i)}=\begin{cases} \frac{1}{\sqrt{N_{ap}}}\beta_{SRS}r^{(p_i)}(kâ€™,lâ€™)\quad kâ€™=0,1,â€¦,M_{sc,b}^{SRS}\quad lâ€™=0,1,â€¦,N_{symb}^{SRS}-1\\quad 0\quad\quad\quad\quad\quad\quad\quad\quad\quad othersize \end{cases}<br>$$</p><h2 id="SRS-è¡¥å……"><a class="header-anchor" href="#SRS-è¡¥å……">Â¶</a>SRS è¡¥å……</h2><p>NR ç³»ç»Ÿä¸­ï¼ŒåŸºç«™å¯ä»¥ä¸º UE é…ç½®å¤šä¸ª SRS èµ„æºé›†ï¼Œæ¯ä¸ª SRS èµ„æºé›†åŒ…å« 1 åˆ° å¤šä¸ª SRS èµ„æºï¼Œæ¯ä¸ª SRS èµ„æºåŒ…å«1ã€2 æˆ– 4 ä¸ª SRS ç«¯å£ã€‚æ¯ä¸ª SRS èµ„æºå¯ä»¥é…ç½®åœ¨ä¸€ä¸ªæ—¶éš™çš„æœ€å 6 ä¸ªOFDM ç¬¦å·ä¸­é”‹1ã€2æˆ– 4 ä¸ªè¿ç»­çš„ç¬¦å·ã€‚å½“SRS ä¸ PUSCH å‘é€åœ¨åŒä¸€ä¸ªæ—¶éš™æ—¶ï¼ŒSRS åªèƒ½åœ¨ PUSCH åŠå…¶å¯¹åº” çš„ DMRS ä¹‹åå‘é€ã€‚<br>SRS èµ„æºå†…çš„ SRS ç«¯å£æ‰€å æœ‰çš„å­è½½æ³¢æ•°åœ¨ä¸€ä¸ª RB ä¸­çš„åç§»é€šè¿‡é«˜å±‚ä¿¡ä»¤é…ç½®ã€‚ SRS èµ„æºçš„æ—¶é¢‘åŸŸèµ„æºæ˜ å°„æ˜¯é’ˆå¯¹æ¯ä¸ª SRS èµ„æºè¿›è¡Œé…ç½®çš„ï¼ŒåŒä¸€ä¸ª SRS èµ„æºå†…çš„ä¸åŒ SRS ç«¯å£å ç”¨å®Œå…¨ç›¸åŒçš„ç¬¦å·ï¼Œäº’ç›¸é—´é€šè¿‡é¢‘åˆ† (å ç”¨ä¸åŒçš„å­è½½æ³¢) æˆ–è€…ç åˆ† (åˆ©ç”¨ä¸åŒçš„ ZC åºåˆ—æˆ–è€…ç›¸åŒçš„ ZC åºåˆ—çš„ä¸åŒå¾ªç¯ç§»ä½) çš„æ–¹å¼è¿›è¡Œå¤ç”¨ã€‚<br>NR ç³»ç»Ÿç§ æ”¯æŒ 64 ç§ SRS è´·æ¬¾é…ç½®æ–¹å¼ï¼Œä¸€ä¸ª SRS èµ„æºå¯é…ç½®çš„æœ€å°å¸¦å®½ä¸º 4 ä¸ª RBï¼Œæœ€å¤§å¸¦å®½ ä¸º 272 ä¸ª RBã€‚</p><p>NRç³»ç»Ÿæ”¯æŒå‘¨æœŸã€åŠå‘¨æœŸå’Œéå‘¨æœŸçš„ SRSçš„å‘é€æ–¹å¼ã€‚SRS çš„å‘é€æ–¹å¼é€šè¿‡ä¸º SRS èµ„æºé›†å’Œ SRS èµ„æºé…ç½®å…³äºæ—¶åŸŸç±»å‹çš„é«˜å±‚å‚æ•°ç±»å‹æ¥å®ç°ã€‚ä¸€ä¸ª SRSèµ„æºé›†å†…çš„æ‰€æœ‰ SRS èµ„æºéƒ½ä¸è¯¥ SRS èµ„æºé›†å…·æœ‰ç›¸åŒçš„æ—¶åŸŸç±»å‹ã€‚</p><ul><li>å‘¨æœŸæ€§å‘é€ã€‚æ—¶åŸŸç±»å‹è¢«é…ç½®ä¸ºå‘¨æœŸçš„ SRS èµ„æºçš„æ‰€æœ‰å‚æ•°ç”±é«˜å±‚ä¿¡ä»¤é…ç½®ï¼ŒUEæ ¹æ®æ‰€é…ç½®çš„å‚æ•°è¿›è¡Œå‘¨æœŸæ€§çš„å‘é€ã€‚åŒä¸€ä¸ª SRS èµ„æºé›†å†…çš„æ‰€æœ‰ SRS èµ„æºå…·æœ‰ç›¸åŒçš„å‘¨æœŸæ€§ã€‚</li><li>åŠæŒç»­å‘é€ã€‚æ—¶åŸŸç±»å‹è¢«é…ç½®ä¸ºåŠæŒç»­çš„ SRS èµ„æºåœ¨æ¿€æ´»æœŸé—´ä¹Ÿæ˜¯å‘¨æœŸå‘é€çš„ã€‚å®ƒä¸å‘¨æœŸæ€§ SRS çš„åŒºåˆ«åœ¨äº UE åœ¨æ¥æ”¶åˆ°å…³äºåŠæŒç»­ SRS èµ„æºçš„é«˜å±‚ä¿¡ä»¤é…ç½®åä¸å‘é€ SRSï¼Œåªæœ‰åœ¨æ¥æ”¶åˆ° MAC å±‚å‘é€çš„å…³äºåŠæŒç»­ SRS èµ„æºçš„æ¿€æ´»ä¿¡ä»¤åæ‰å¼€å§‹å‘¨æœŸæ€§åœ°å‘é€åŠæŒç»­ SRS èµ„æºå¯¹åº”çš„ SRS ï¼Œåœ¨æ¥æ”¶ MAC å±‚å‘é€çš„åŠæŒç»­ SRS èµ„æºçš„å»æ¿€æ´»å‘½ä»¤ååœæ­¢å‘é€ SRSã€‚å› æ­¤ï¼Œç›¸å¯¹äºå‘¨æœŸæ€§ SRS èµ„æºï¼ŒåŠæŒç»­ SRS èµ„æºçš„é…ç½®ä»¥åŠæ¿€æ´»ï¼Œå»æ¿€æ´»ç›¸æ¯”é«˜å±‚ä¿¡ä»¤ (RRC ä¿¡ä»¤) æ›´å¿«ï¼Œæ›´çµæ´»ï¼Œé€‚åº”äºè¦æ±‚æ—¶å»¶è¾ƒä½çš„ä¸šåŠ¡å¿«é€Ÿä¼ è¾“ã€‚</li><li>éå‘¨æœŸæ€§å‘é€ã€‚æ—¶åŸŸç±»å‹è¢«é…ç½®ä¸ºéå‘¨æœŸçš„ SRS èµ„æºé€šè¿‡ DCI ä¿¡ä»¤æ¿€æ´»ã€‚ UE æ¯æ¥æ”¶åˆ°ä¸€æ¬¡è§¦å‘éå‘¨æœŸ SRS èµ„æºçš„ SRS è§¦å‘ä¿¡ä»¤ï¼ŒUE è¿›è¡Œä¸€æ¬¡æ‰€è§¦å‘çš„ SRS èµ„æºå¯¹åº”çš„ SRS å‘é€ã€‚</li></ul><h1>3 CSI æŠ¥å‘Š</h1><p>è¿˜æ²¡çœ‹å®Œã€‚</p><blockquote><p>å‚è€ƒæ–‡çŒ®<br>å¾®ä¿¡å…¬ä¼—å·ï¼šæ˜¥å¤©å·¥ä½œå®¤<br>ç½‘é¡µï¼š<a href="https://mp.weixin.qq.com/s/nJIEE5B4wV3xirAqJZHfZA" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/nJIEE5B4wV3xirAqJZHfZA</a><br>ç½‘é¡µï¼š<a href="https://mp.weixin.qq.com/s/-15pUXt8BN4ZbxaiKJ-jgQ" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/-15pUXt8BN4ZbxaiKJ-jgQ</a><br>ç½‘é¡µï¼š<a href="https://mp.weixin.qq.com/s/WDpxnX6BqqOHzv9iJokS8w" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/WDpxnX6BqqOHzv9iJokS8w</a><br>ç½‘é¡µï¼š<a href="http://www.sharetechnote.com/html/5G/5G_CSI_RS.html" target="_blank" rel="noopener">http://www.sharetechnote.com/html/5G/5G_CSI_RS.html</a><br>åšå®¢ï¼š<a href="http://blog.sina.com.cn/s/blog_3c3393b00102yne0.html" target="_blank" rel="noopener">http://blog.sina.com.cn/s/blog_3c3393b00102yne0.html</a><br>åšå®¢ï¼š<a href="http://blog.sina.com.cn/s/blog_3c3393b00102yqs4.html" target="_blank" rel="noopener">http://blog.sina.com.cn/s/blog_3c3393b00102yqs4.html</a></p></blockquote><!-- rebuild by neat -->]]></content>
      <categories>
        <category>5G_Protocol</category>
      </categories>
      <tags>
        <tag>CSI</tag>
        <tag>SRS</tag>
      </tags>
  </entry>
  <entry>
    <title>5G-NR-PUSCHå­¦ä¹ </title>
    <url>/5G_Protocol/5G-NR-PUSCH%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<!-- build time:Tue Jun 22 2021 17:02:33 GMT+0800 (GMT+08:00) --><a id="more"></a><h1>1 PUSCHä¿¡é“å¤„ç†æµç¨‹</h1><h2 id="1-1-TS-38-212å¯¹åº”å¤„ç†è¿‡ç¨‹"><a class="header-anchor" href="#1-1-TS-38-212å¯¹åº”å¤„ç†è¿‡ç¨‹">Â¶</a>1.1 TS 38.212å¯¹åº”å¤„ç†è¿‡ç¨‹</h2><h3 id="1-1-1-å¢åŠ CRCæ ¡éªŒ"><a class="header-anchor" href="#1-1-1-å¢åŠ CRCæ ¡éªŒ">Â¶</a>1.1.1 å¢åŠ CRCæ ¡éªŒ</h3><p>PUSCHæ•°æ®$a_0,a_1,â€¦,a_{A-1}$ï¼Œé¦–å…ˆåˆ¤æ–­ä¼ è¾“å—é•¿åº¦ A çš„å¤§å°ï¼Œæ¥ç¡®å®šé€‰æ‹©çš„ CRCæ–¹æ³•ï¼š<br>$if$ $A &gt; 3824$<br>â€‹ $g_{CRC24(D)}$ \\ L = 24<br>$else$<br>â€‹ $g_{CRC16(D)}$	\\ L = 16</p><p>éšåï¼Œ$a_0,a_1,â€¦,a_{A-1}$ é€šè¿‡ $g_{CRC24(D)}$ æˆ– $g_{CRC16(D)}$ æ¥ç”Ÿæˆæ ¡éªŒä½ $p_0,p_1,â€¦,p_{L-1}$</p><p>æœ€åï¼Œå°†æ ¡éªŒä½$p_0,p_1,â€¦,p_{L-1}$ï¼Œé™„åœ¨ $a_0,a_1,â€¦,a_{A-1}$ åï¼Œå½¢æˆæ·»åŠ CRCçš„æ•°æ®ï¼Œ$a_0,â€¦,a_{A-1},p_0,â€¦,p_{L-1}$ã€‚å³$b_0,b_1,â€¦,b_{B-1}$ï¼Œå…¶ä¸­ $B = A+L$</p><h3 id="1-1-2-LDPC-base-graph-selection"><a class="header-anchor" href="#1-1-2-LDPC-base-graph-selection">Â¶</a>1.1.2 LDPC base graph selection</h3><p>base graph çš„é€‰æ‹©æœ‰å¦‚ä¸‹çš„è§„åˆ™ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">A â‰¤ 292 â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â†’ LDPC base graph 2</span><br><span class="line">A â‰¤ 3824 and R â‰¤ 0.67 â€”â€”â€”â€”â€”â€”â€”â€”â†’ LDPC base graph 2</span><br><span class="line">R â‰¤ 0.25 â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â†’ LDPC base graph 2</span><br><span class="line">else  â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â†’ LDPC base graph 1</span><br></pre></td></tr></table></figure><p>å³ï¼š<br>![](D:/blog/source/_posts/5Gåè®®/5G-NR-PUSCHå­¦ä¹ /p1-base graphé€‰æ‹©.png)</p><p>å¯ä»¥è¿‘ä¼¼ç†è§£ä¸ºï¼š<br>ä½ç ç‡/å°TBSé€‰æ‹©BG2ï¼›é«˜ç ç‡/å¤§TBSé€‰æ‹©BG1ã€‚</p><h3 id="1-1-3-Code-block-ç å—åˆ†å‰²å’Œå¢åŠ CRC"><a class="header-anchor" href="#1-1-3-Code-block-ç å—åˆ†å‰²å’Œå¢åŠ CRC">Â¶</a>1.1.3 Code block ç å—åˆ†å‰²å’Œå¢åŠ CRC</h3><p>NRä¸­LDPCç¼–ç ï¼Œæœ€å¤§ç å—é•¿åº¦é™å®šä¸ºï¼š<br>LDPC base graph 1 $K_{cb} = 8448$ ;<br>LDPC base graph 2 $K_{cb} = 3840$;</p><p>å› æ­¤TBå—(å«CRC)è¦æ ¹æ®LDPCç å—é•¿åº¦åˆ†ä¸ºå¤šä¸ªç å—ã€‚<br>å¾…ç¼–ç bit $b_0,b_1,â€¦,b_{B-1}$</p><ul><li>å½“ $B\leq K_{cb}$ï¼Œ ç å—ä¸ªæ•° $C = 1$</li><li>å½“$B&gt; k_{cb}$ï¼Œç å—ä¸ªæ•° $C = \lceil B/(K_{cb}-L)\rceil$ï¼Œå…¶ä¸­ $L = 24$ ä¸ºæ¯ä¸ªç å—å¢åŠ çš„CRCæ ¡éªŒbitä½æ•°<br>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</li></ul><p><img src="/5G_Protocol/5G-NR-PUSCH%E5%AD%A6%E4%B9%A0/blog/source/_posts/5G%E5%8D%8F%E8%AE%AE/5G-NR-PUSCH%E5%AD%A6%E4%B9%A0/p2-%E7%A0%81%E5%9D%97%E5%88%86%E5%89%B2.png" alt></p><p>ä»¥ä¸Šæ¯ä¸ªç å—å†…å«æœ‰çš„æ¯”ç‰¹æ•°ä¸º $Kâ€™ = Bâ€™/C$ï¼Œå³$B/C + L$ï¼Œå› ä¸º $Bâ€™ = B + C\cdot L$</p><p>ç®€å•çš„è¯´å°±æ˜¯æ¯ä¸ªåˆ†ç»„çš„çš„ç å—é•¿åº¦æ˜¯ Kâ€™ æœ‰ä¸‰ç§æƒ…å†µï¼š</p><ul><li>å¦‚æœ$B$ â‰¤ $K_{cb}$ï¼Œ$Kâ€™ = B$ï¼›</li><li>å¦‚æœ$B$ &gt; $K_{cb}$ï¼Œé™¤äº†æœ€åä¸€ä¸ªå¯èƒ½å–æ•´å¤šä½™å‡ºæ¥åˆ†ç»„å¤–ï¼Œ$Kâ€™ = K_{cb}$;</li><li>å°±ä¸Šè¿°æœ€åä¸€ä¸ªåˆ†ç»„ï¼Œ$Kâ€™ = B - (C-1)\cdot(K_{cb}-L) + L$;</li></ul><p>ç å—é•¿åº¦ç¡®å®šåï¼Œè¦æ ¹æ®ä¸åŒBGï¼Œç”Ÿæˆç¼–ç çŸ©é˜µï¼Œé¦–å…ˆè¦ç¡®å®šç¼–ç çŸ©é˜µçš„<strong>åˆ—æ•°</strong>ã€‚</p><ul><li>å¯¹äºBG1ï¼Œ$K_b = 22$ï¼Œå³åŸºç¡€çŸ©é˜µçš„æœ€å¤§ç³»ç»Ÿåˆ—æ•°22åˆ—</li><li>å¯¹äºBG2ï¼š<br>$if\quad B&gt;640\quad K_b = 10;$<br>$elseif\quad B&gt;560\quad K_b = 9;$<br>$elseif\quad B&gt;192\quad K_b = 8;$<br>$else\quad K_b = 6$</li></ul><p>**lifting size $Z_c$ **ï¼šæ»¡è¶³ $K_b\cdot Z_c \leq Kâ€™$ï¼Œä¸”æ˜¯è¡¨æ ¼ä¸­çš„æœ€å°å€¼ã€‚è®¾ï¼ŒBG1ï¼š$K = 22Z_c$ï¼›BG2ï¼š$K = 10Z_c$ã€‚</p><p>![](D:/blog/source/_posts/5Gåè®®/5G-NR-PUSCHå­¦ä¹ /t3-38.212 5.3.2-1.png)</p><p>é€šè¿‡ä¸Šå›¾ $Z_c$ æ‰€å¤„åœ¨çš„é›†åˆï¼Œå¯ä»¥ç¡®å®š Set Index ($i_{LS}$)ã€‚</p><h3 id="1-1-4-ä¿¡é“ç¼–ç "><a class="header-anchor" href="#1-1-4-ä¿¡é“ç¼–ç ">Â¶</a>1.1.4 ä¿¡é“ç¼–ç </h3><p>ç¼–ç å‰ï¼Œ$c_0,c_1,c_2,â€¦,c_{K-1}$ï¼ŒKç”±ä¸Šæ–‡ç»™å‡ºã€‚<br>LDPCç¼–ç åï¼Œ$d_0,d_1,d_2,â€¦,d_{N-1}$ï¼ŒBG1ï¼š$N = 66Z_c$ï¼›BG2ï¼š$N = 50Z_c$ã€‚<br><strong>åŸºçŸ©é˜µ</strong>ï¼š</p><ul><li>å¯¹äºBG1ï¼š$H_{BG}$ ä¸º 46$\times$68 çš„çŸ©é˜µ</li><li>å¯¹äºBG2ï¼š$H_{BG}$ ä¸º 42$\times$52 çš„çŸ©é˜µ</li></ul><p>$H_{BG}$ ä¸­çš„å…ƒç´ é€šè¿‡ Set Index ($i_{LS}$) æŸ¥è¡¨è·å¾—ï¼š</p><blockquote><p>BG1ï¼š[TS 38.212 Table 5.3.2-2]<br>BG2ï¼š[TS 38.212 Table 5.3.2-3]</p></blockquote><p><strong>æ³¨</strong>ï¼šé€šè¿‡æŸ¥è¡¨ä¸­çš„å‰ä¸¤åˆ—å¯çŸ¥ $H_{BG}$ä¸­å¯¹åº”çš„è¡Œåˆ—æ•°å…ƒç´ å€¼ä¸º1ï¼Œå…¶ä¸­æ²¡æœ‰çš„è¡Œåˆ—æ•°å¯¹åº”çš„å€¼ä¸º0ï¼Œå…¨éƒ¨è®¾ç½®ä¸º0ã€‚è¡¨ä¸­ $V_{i,j}$ åˆ™ä»£è¡¨å…¶å¥‡å¶æ ¡éªŒçŸ©é˜µå¯¹åº”çš„å…ƒç´ æ•°å€¼ã€‚</p><p>å†åˆ©ç”¨Set Index ($i_{LS}$) ç¡®å®š$V_{i,j}$åï¼Œæ ¹æ®$P_{i,j} = mod(V_{i,j},Z_c)$ï¼Œè·å¾—ç¼–ç çŸ©é˜µçš„å¾ªç¯ç§»ä½å€¼ï¼Œæ ¹æ® $H_{BG}$ ç”Ÿæˆç¼–ç æ ¡éªŒçŸ©é˜µ <strong>H</strong>ï¼Œç”Ÿæˆæ–¹å¼å†åè®®ä¸­çš„æè¿°å¦‚ä¸‹ï¼š</p><p><img src="/5G_Protocol/5G-NR-PUSCH%E5%AD%A6%E4%B9%A0/blog/source/_posts/5G%E5%8D%8F%E8%AE%AE/5G-NR-PUSCH%E5%AD%A6%E4%B9%A0/p3-%E7%BC%96%E7%A0%81%E7%9F%A9%E9%98%B5%E7%94%9F%E6%88%90.png" alt></p><p>ç®€å•æ¥è¯´å°±æ˜¯å°†$H_{BG}$ä¸­çš„æ¯ä¸ªå…ƒç´ ç”¨å¤§å°ä¸º $Z_c\times Z_c$ çš„çŸ©é˜µä»£æ›¿ã€‚</p><ul><li>å¦‚æœå…ƒç´ å€¼ä¸º0ï¼Œåˆ™ç”¨å¤§å°ä¸º $Z_c\times Z_c$ çš„é›¶çŸ©é˜µä»£æ›¿ã€‚</li><li>å¦‚æœå…ƒç´ å€¼ä¸º1ï¼Œåˆ™ç”¨å¤§å°ä¸º $Z_c\times Z_c$ çš„å•ä½çŸ©é˜µç»è¿‡å¾ªç¯ç§»ä½åçš„çŸ©é˜µ $I(P_{i,j})$ æ¥æ›¿æ¢ã€‚å…¶ä¸­å¾ªç¯ç§»ä½å€¼ç”±ä¹‹å‰çš„$P_{i,j} = mod(V_{i,j},Z_c)$ ç»™å‡ºã€‚</li></ul><p>æ€»ç»“ï¼Œè‹¥ï¼š<br>å¾…ç¼–ç çš„ä¿¡æ¯æ¯”ç‰¹ï¼Œ<strong>c</strong> $=[ c_0,c_1,c_2,â€¦,c_{K-1}]^T$<br>å…¶æ ¡éªŒæ¯”ç‰¹ï¼Œ <strong>w</strong> $=[w_0,w_1,â€¦,w_{N+2Z_c-K-1}]^T$ï¼Œå¯ä»¥å¾—åˆ° $H\times \left[ \begin{matrix} c\w \end{matrix}\right]=0$</p><p><strong>ç–‘é—®</strong>ï¼šç”¨æ¥ç”Ÿæˆ**[<em>c|W</em>]<strong>çš„ç”ŸæˆçŸ©é˜µåˆ°åº•æ˜¯ä»€ä¹ˆ? æŒ‰ç†æ¥è¯´ä½¿ç”¨ä¿¡æ¯æ¯”ç‰¹ä¸ç”ŸæˆçŸ©é˜µç›¸ä¹˜ï¼Œäº§ç”Ÿä¿¡æ¯æ¯”ç‰¹å’Œæ ¡éªŒæ¯”ç‰¹ <strong>[<em>c|W</em>]</strong>ï¼Œè¿™ä¸ªç”ŸæˆçŸ©é˜µåˆ°åº•æ˜¯ä¸Šé¢çš„é‚£ä¸ª</strong>$H_{BG}$**åˆä¸æ˜¯å•Šï¼Œ<em><strong>H</strong></em>åˆæ˜¯æ ¡éªŒçŸ©é˜µã€‚</p><h3 id="1-1-5-é€Ÿç‡åŒ¹é…"><a class="header-anchor" href="#1-1-5-é€Ÿç‡åŒ¹é…">Â¶</a>1.1.5 é€Ÿç‡åŒ¹é…</h3><p>å®ŒæˆLDPCç¼–ç åï¼Œå¾—åˆ° $d_0,d_1,d_2,â€¦,d_{N-1}$ã€‚éœ€è¦å¯¹å…¶è¿›è¡Œ Rate matching é€Ÿç‡é€‚é…ï¼ŒåŒ…æ‹¬</p><ul><li>Bit selection</li><li>Bit interleaving</li></ul><p><img src="/5G_Protocol/5G-NR-PUSCH%E5%AD%A6%E4%B9%A0/blog/source/_posts/5G%E5%8D%8F%E8%AE%AE/5G-NR-PUSCH%E5%AD%A6%E4%B9%A0/p4-%E9%80%9F%E7%8E%87%E5%8C%B9%E9%85%8D.png" alt></p><h3 id="1-1-6-ç å—ä¸²è”"><a class="header-anchor" href="#1-1-6-ç å—ä¸²è”">Â¶</a>1.1.6 ç å—ä¸²è”</h3><p>å°†é€Ÿç‡åŒ¹é…å®Œæˆåçš„æ•°æ®ç å—æŒ‰åºé‡ç»„ã€‚</p><p><img src="/5G_Protocol/5G-NR-PUSCH%E5%AD%A6%E4%B9%A0/blog/source/_posts/5G%E5%8D%8F%E8%AE%AE/5G-NR-PUSCH%E5%AD%A6%E4%B9%A0/p5-%E7%A0%81%E5%9D%97%E9%87%8D%E7%BB%84.png" alt></p><h2 id="1-2-TS-38-211å¯¹åº”å¤„ç†è¿‡ç¨‹"><a class="header-anchor" href="#1-2-TS-38-211å¯¹åº”å¤„ç†è¿‡ç¨‹">Â¶</a>1.2 TS 38.211å¯¹åº”å¤„ç†è¿‡ç¨‹</h2><h3 id="1-2-1-åŠ æ‰°"><a class="header-anchor" href="#1-2-1-åŠ æ‰°">Â¶</a>1.2.1 åŠ æ‰°</h3><p>å¯¹äºå•ç å­—ä¼ è¾“æ—¶ï¼Œ$q = 0$ã€‚[TS 38.211 7.3.1.1]ï¼Œæ¯ä¸€ä¸ªç å­—å¯¹åº”çš„åŸå§‹æ•°æ® $b<sup>{(q)}(0),â€¦,b</sup>{(q)}(M_{bit}^{(q)}-1)$ ,ç»è¿‡åŠ æ‰°å¤„ç†ç”ŸæˆåŠ æ‰°åçš„æ•°æ®ä¸º $\widetilde b^{(q)}(0),â€¦,\widetilde b<sup>{(q)}(M_{bit}</sup>{(q)}-1)$ ã€‚åŠ æ‰°å¤„ç†å¦‚ä¸‹ä¼ªä»£ç æ‰€ç¤ºï¼š</p><p>$while$ $i$ &lt; $M_{bit}^{(q)}$</p><p>â€‹	$if$ $b^{(q)}(i) = x$ // UCI placeholder bits</p><p>â€‹ $\widetilde b^{(q)}(i) = 1$</p><p>$else$<br>$if$ $b^{(q)}(i)=y$ // UCI placeholder bits</p><p>â€‹ $\widetilde b^{(q)}(i) = \widetilde b^{(q)}(i-1)$</p><p>â€‹ $else$</p><p>â€‹ $\widetilde b^{(q)}(i) = (b^{(q)}(i) + c^{(q)}(i))mod2$</p><p>â€‹ $end$ $if$</p><p>â€‹	$end$ $if$</p><p>â€‹	$i=i+1$</p><p>$end$ $ while$</p><p>å…¶ä¸­åŠ æ‰°åºåˆ—$c^{(q)}(i)$æ˜¯ä¸€ä¸ªä¼ªéšæœºåºåˆ—ï¼Œç”±[TS 38.211 5.2.1]ç»™å‡ºï¼ŒåŠ æ‰°åºåˆ—çš„åˆå§‹ä¸ºï¼š<br>$$<br>C_{init} = n_{RNTI}\cdot2^{15}+n_{ID}<br>$$</p><p>å…¶ä¸­</p><ul><li>$n_{RNTI}$ = C-RNTI or CS-RNTI , å¹¶ä¸”åœ¨å…¬å…±æœç´¢ç©ºé—´ä¸­ä¸ä½¿ç”¨DCI forrmat 0_0è°ƒåº¦ä¼ è¾“</li><li>$n_{ID}\in {0,1,â€¦,1023}$ , å…¶å€¼ç­‰äº<em>dataScramblingIdentityPUSCH</em>(å¦‚æœé…ç½®)ï¼Œå¦åˆ™ $n_{ID} = N_{ID}^{cell}$</li></ul><h3 id="1-2-2-è°ƒåˆ¶"><a class="header-anchor" href="#1-2-2-è°ƒåˆ¶">Â¶</a>1.2.2 è°ƒåˆ¶</h3><p>æ¯ä¸€ä¸ªç å­—åŠ æ‰°åçš„æ¯”ç‰¹å— $\widetilde b^{(q)}(0),â€¦,\widetilde b<sup>{(q)}(M_{bit}</sup>{(q)}-1)$ é‡‡ç”¨ä¸‹è¡¨ä¸­çš„ä¸€ç§è°ƒåˆ¶æ–¹å¼è¿›è¡Œè°ƒåˆ¶ï¼Œå¾—åˆ°ä¸€ä¸ªå¤å€¼è°ƒåˆ¶ç¬¦å·å—$d<sup>{(q)}(0),â€¦,d</sup>{(q)}(M_{symb}^{(q)}-1)$ã€‚[TS 38.211 6.3.1.2-1]</p><table><tr><th colspan="2"><center>Transform precoding disabled</center></th><th colspan="2"><center>Transform precoding enabled</center></th></tr><tr><td><center>Modulation scheme</center></td><td><center>Modulation order</center></td><td><center>Modulation scheme</center></td><td><center>Modulation order</center></td></tr><tr><td><center></center></td><td><center></center></td><td><center>Ï€/2-BPSK</center></td><td><center>1</center></td></tr><tr><td><center>QPSK</center></td><td><center>2</center></td><td><center>QPSK</center></td><td><center>2</center></td></tr><tr><td><center>16QAM</center></td><td><center>4</center></td><td><center>16QAM</center></td><td><center>4</center></td></tr><tr><td><center>64QAM</center></td><td><center>6</center></td><td><center>64QAM</center></td><td><center>6</center></td></tr><tr><td><center>256QAM</center></td><td><center>8</center></td><td><center>256QAM</center></td><td><center>8</center></td></tr></table><h3 id="1-2-3-å±‚æ˜ å°„"><a class="header-anchor" href="#1-2-3-å±‚æ˜ å°„">Â¶</a>1.2.3 å±‚æ˜ å°„</h3><p>å¯¹äºå•ä¸ªç å­—$q = 0$ , æ¯ä¸€ä¸ªç å­—ç”Ÿæˆçš„è°ƒåˆ¶ä¿¡å· $d<sup>{(q)}(0),â€¦,d</sup>{(q)}(M_{symb}^{(q)}-1)$ æ ¹æ®è¡¨[TS 38.211 7.3.1.3-1] æ˜ å°„åˆ°4å±‚$x(i)=[x^0{i} \cdots x<sup>{v-1}(i)]</sup>T$ï¼Œ$i = 0,1,â€¦,M_{symb}^{layer}-1$ï¼Œå…·ä½“çš„çŸ©é˜µå½¢å¼å¦‚ä¸‹æ‰€ç¤º , $M_{symb}^{layer}$ è¡¨ç¤ºæ¯å±‚è°ƒåˆ¶ç¬¦å·çš„æ•°é‡ï¼Œå…¶ä¸­$v$è¡¨ç¤ºå±‚æ•°ã€‚,éœ€è¦æ³¨æ„çš„æ˜¯PUSCHæœ€å¤šæ˜ å°„4å±‚ï¼ŒPDSCHæœ€å¤š8å±‚ã€‚</p><p>$$<br>x(i)=[x^0{i} \cdots x<sup>{v-1}(i)]</sup>T\quad i = 0,1,â€¦,M_{symb}^{layer}-1\=\left[ \begin{matrix} x<sup>{(0)}(0)&amp;x</sup>{(0)}(1)&amp;\cdots&amp;x<sup>{(0)}(M_{sysmb}</sup>{layer}-1)\x<sup>{(1)}(0)&amp;x</sup>{(1)}(1)&amp;\cdots&amp;x<sup>{(1)}(M_{sysmb}</sup>{layer}-1)\ \vdots&amp;\vdots&amp;\ddots&amp;\vdots \x<sup>{(p-1)}(0)&amp;x</sup>{(p-1)}(1)&amp;\cdots&amp;x<sup>{(p-1)}(M_{sysmb}</sup>{layer}-1)\end{matrix} \right]<br>$$</p><table><thead><tr><th style="text-align:center">å±‚æ•°</th><th style="text-align:center">ç å­—æ•°</th><th>ç å­—åˆ°å±‚æ˜ å°„<br>$i = 0,1,â€¦,M_{symb}^{layer}-1$</th></tr></thead><tbody><tr><td style="text-align:center">1</td><td style="text-align:center">1</td><td>$x^{(0)}(i) = d^{(0)}(i)$ $M_{symb}^{layer} = M_{symb}^{(0)}$</td></tr><tr><td style="text-align:center">2</td><td style="text-align:center">1</td><td>$x^{(0)}(i) = d^{(0)}(2i)$<br>$x^{(1)}(i) = d^{(0)}(2i+1)$ $M_{symb}^{layer} = M_{symb}^{(0)}/2$</td></tr><tr><td style="text-align:center">3</td><td style="text-align:center">1</td><td>$x^{(0)}(i) = d^{(0)}(3i)$<br>$x^{(1)}(i) = d^{(0)}(3i+1)$ $M_{symb}^{layer} = M_{symb}^{(0)}/3$<br>$x^{(2)}(i) = d^{(0)}(3i+2)$</td></tr><tr><td style="text-align:center">4</td><td style="text-align:center">1</td><td>$x^{(0)}(i) = d^{(0)}(4i)$<br>$x^{(1)}(i) = d^{(0)}(4i+1)$<br>$x^{(2)}(i) = d^{(0)}(4i+2)$ $M_{symb}^{layer} = M_{symb}<sup>{(0)}/4$&lt;br/&gt;$x</sup>{(3)}(i) = d^{(0)}(4i+3)$</td></tr><tr><td style="text-align:center">5</td><td style="text-align:center">2</td><td>$x^{(0)}(i) = d^{(0)}(2i)$<br>$x^{(1)}(i) = d^{(0)}(2i+1)$<br>$x^{(2)}(i) = d^{(1)}(3i)$ $M_{symb}^{layer} = M_{symb}^{(0)}/2 = M_{symb}<sup>{(1)}/3$&lt;br/&gt;$x</sup>{(3)}(i) = d<sup>{(1)}(3i+1)$&lt;br/&gt;$x</sup>{(4)}(i) = d^{(1)}(3i+2)$</td></tr><tr><td style="text-align:center">6</td><td style="text-align:center">2</td><td>$x^{(0)}(i) = d^{(0)}(3i)$<br>$x^{(1)}(i) = d^{(0)}(3i+1)$<br>$x^{(2)}(i) = d<sup>{(0)}(3i+2)$&lt;br/&gt;$x</sup>{(3)}(i) = d^{(1)}(3i)$ $M_{symb}^{layer} = M_{symb}^{(0)}/3 = M_{symb}<sup>{(1)}/3$&lt;br/&gt;$x</sup>{(4)}(i) = d<sup>{(1)}(3i+1)$&lt;br/&gt;$x</sup>{(5)}(i) = d^{(1)}(3i+2)$</td></tr><tr><td style="text-align:center">7</td><td style="text-align:center">2</td><td>$x^{(0)}(i) = d^{(0)}(3i)$<br>$x^{(1)}(i) = d^{(0)}(3i+1)$<br>$x^{(2)}(i) = d<sup>{(0)}(3i+2)$&lt;br/&gt;$x</sup>{(3)}(i) = d^{(1)}(4i)$ $M_{symb}^{layer} = M_{symb}^{(0)}/3 = M_{symb}<sup>{(1)}/4$&lt;br/&gt;$x</sup>{(4)}(i) = d<sup>{(1)}(4i+1)$&lt;br/&gt;$x</sup>{(5)}(i) = d<sup>{(1)}(4i+2)$&lt;br/&gt;$x</sup>{(6)}(i)=d^{(1)}(4i+3)$</td></tr><tr><td style="text-align:center">8</td><td style="text-align:center">2</td><td>$x^{(0)}(i) = d^{(0)}(4i)$<br>$x^{(1)}(i) = d^{(0)}(4i+1)$<br>$x^{(2)}(i) = d<sup>{(0)}(4i+2)$&lt;br/&gt;$x</sup>{(3)}(i)=d<sup>{(0)}(4i+3)$&lt;br/&gt;$x</sup>{(4)}(i) = d^{(1)}(4i)$ $M_{symb}^{layer} = M_{symb}^{(0)}/4 = M_{symb}<sup>{(1)}/4$&lt;br/&gt;$x</sup>{(5)}(i) = d<sup>{(1)}(4i+1)$&lt;br/&gt;$x</sup>{(6)}(i) = d<sup>{(1)}(4i+2)$&lt;br/&gt;$x</sup>{(7)}(i)=d^{(1)}(4i+3)$</td></tr></tbody></table><h3 id="1-2-4-å˜æ¢é¢„ç¼–ç "><a class="header-anchor" href="#1-2-4-å˜æ¢é¢„ç¼–ç ">Â¶</a>1.2.4 å˜æ¢é¢„ç¼–ç </h3><p>ä¸ºäº†é™ä½PAPRå³°å‡æ¯”ï¼Œä¸Šè¡ŒPUSCHå¯ä»¥æ”¯æŒTransform Precoding , å³é‡‡ç”¨DFT-s-OFDMçš„å½¢å¼ï¼Œé€šè¿‡RRCå±‚å‚æ•°å’ŒDCIæŒ‡ç¤ºã€‚</p><p>ä»…å½“<em>PUSCH-Config -&gt; transformprecoder</em> é…ç½® æˆ–è€…<em>RACH-configCommon -&gt; msg3-transformPrecoding</em> é…ç½®æ—¶ä½¿ç”¨ã€‚</p><ul><li>å¦‚æœå˜æ¢é¢„ç¼–ç ä¸å¯ç”¨ï¼Œå¯¹äºå±‚$\lambda = 0,1,â€¦,v-1$ï¼Œæœ‰ $y^{(\lambda)}(i) = x^{(\lambda)}(i)$ã€‚</li><li>å¦‚æœå˜æ¢é¢„ç¼–ç å¯ç”¨ï¼Œ$v = 1$ , ä¸”å¤å€¼ç¬¦å·å—$x<sup>{(0)}(0),â€¦,x</sup>{(0)}(M_{symb}^{layer}-1)$ è¢«åˆ†ä¸º$M_{symb}<sup>{layer}/M_{sc}</sup>{PUSCH}$ä¸ªé›†åˆï¼Œæ¯ä¸ªé›†åˆå¯¹åº”äºä¸€ä¸ªOFDMç¬¦å·ã€‚å˜æ¢é¢„ç¼–ç æ ¹æ®å¦‚ä¸‹å…¬å¼è¿›è¡Œï¼š<br>$$<br>y^{(0)}(l \cdot M_{sc}<sup>{PUSCH}+k)=\frac{1}{\sqrt{M_{sc}</sup>{PUSCH}}}\sum_{i=0}<sup>{M_{sc}</sup>{PUSCH}-1}\widetilde x^{(0)}(l \cdot M_{sc}<sup>{PUSCH}+i)e</sup>{-j\frac{2\pi ik}{M_{sc}^{PUSCH}}}\k =0,1,â€¦,M_{sc}<sup>{PUSCH}-1\l=0,1,â€¦,M_{symb}</sup>{layer}/M_{sc}^{PUSCH}-1<br>$$</li></ul><p>å¾—åˆ°å¤å€¼ç¬¦å·å— $y<sup>{(0)}(0),â€¦,y</sup>{(0)}(M_{symb}^{layer}-1)$ ã€‚$M_{sc}^{PUSCH} = M_{RB}^{PUSCH}\cdot M_{sc}<sup>{RB}$ï¼Œå…¶ä¸­$M_{RB}</sup>{PUSCH}$ å°±æ˜¯RBè€Œè¨€çš„å¸¦å®½ï¼Œå¹¶ä¸”æ»¡è¶³</p><p>$$<br>M_{RB}^{PUSCH} = 2^{\alpha_2}\cdot 3^{\alpha_3}\cdot 5^{\alpha_5}\leq N_{RB}^{UL}<br>$$<br>å…¶ä¸­ $\alpha_2,\alpha_3,\alpha_5$ æ˜¯éè´Ÿæ•´æ•°é›†åˆã€‚</p><h3 id="1-2-5-é¢„ç¼–ç "><a class="header-anchor" href="#1-2-5-é¢„ç¼–ç ">Â¶</a>1.2.5 é¢„ç¼–ç </h3><p>æ ¹æ®å¦‚ä¸‹å…¬å¼å¯¹å‘é‡å—$[y<sup>{(0)}(i),â€¦,y</sup>{(v-1)}(i)]^{T},i = 0,1,â€¦,M_{symb}^{layer}-1$ è¿›è¡Œé¢„ç¼–ç å¤„ç†ï¼š<br>$$<br>\left[\begin{matrix} z^{(0)}(i)\ \vdots\ z^{(p-1)}(i) \end{matrix} \right]=W\left[\begin{matrix} y^{(0)}(i)\ \vdots \ y^{(p-1)}(i) \end{matrix} \right]<br>$$</p><p>å…¶ä¸­ $i = 0,1,â€¦,M_{symb}^{ap} -1, M_{symb}^{ap} =M_{symb}^{layer}$ ã€‚</p><p>RRC å‚æ•°å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">txConfig				ENUMERATED &#123;codebook,nonCodebook&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºåŸºäºéç æœ¬çš„ä¼ è¾“ï¼Œé¢„ç¼–ç çŸ©é˜µ <strong>W</strong> ä¸ºå•ä½çŸ©é˜µã€‚<br>å¯¹äºåŸºäºç æœ¬çš„ä¼ è¾“ï¼Œé¢„ç¼–ç çŸ©é˜µ <strong>W</strong>ï¼š</p><ul><li><p>When number of layer = 1, number of antenna port = 1ï¼Œ<strong>W</strong> = 1ã€‚</p></li><li><p>When number of layer $\geq$ 1 and number of antenna port $\geq$ 2 ï¼Œ</p><p>æ ¹æ®DCI 0-1ä¸­çš„ â€œPrecoding information and number of layersâ€ ç¡®å®šé¢„ç¼–ç çŸ©é˜µ<strong>W</strong>(å‚è€ƒå¦‚ä¸‹è¡¨æ ¼)ï¼š</p></li></ul><blockquote><p>[TS 38.211 Table 6.3.1.5-1]<br>[TS 38.211 Table 6.3.1.5-2]<br>[TS 38.211 Table 6.3.1.5-3]<br>[TS 38.211 Table 6.3.1.5-4]<br>[TS 38.211 Table 6.3.1.5-5]<br>[TS 38.211 Table 6.3.1.5-6]<br>[TS 38.211 Table 6.3.1.5-7]</p></blockquote><p>æŒ‰ç…§å±‚æ•°ï¼Œå¤©çº¿ç«¯å£æ•°ï¼Œæ˜¯å¦é…ç½®å˜æ¢é¢„ç¼–ç ï¼Œä¸‰è€…çš„å‚æ•°ï¼Œé€‰å–é¢„ç¼–ç çŸ©é˜µï¼Œæ€»ç»“æˆå¦‚ä¸‹è¡¨æ ¼ï¼š</p><table><thead><tr><th>Number of Layers</th><th>Number of Antenna</th><th>Transform Precoding</th><th>Precoding Matrix</th></tr></thead><tbody><tr><td>1</td><td>2</td><td></td><td>211 Table 6.3.1.5-1</td></tr><tr><td>1</td><td>4</td><td>enabled</td><td>211 Table 6.3.1.5-2</td></tr><tr><td>1</td><td>4</td><td>disabled</td><td>211 Table 6.3.1.5-3</td></tr><tr><td>2</td><td>2</td><td>disabled</td><td>211 Table 6.3.1.5-4</td></tr><tr><td>2</td><td>4</td><td>disabled</td><td>211 Table 6.3.1.5-5</td></tr><tr><td>3</td><td>4</td><td>disabled</td><td>211 Table 6.3.1.5-6</td></tr><tr><td>4</td><td>4</td><td>disabled</td><td>211 Table 6.3.1.5-7</td></tr></tbody></table><h3 id="1-2-6-æ˜ å°„åˆ°VRB"><a class="header-anchor" href="#1-2-6-æ˜ å°„åˆ°VRB">Â¶</a>1.2.6 æ˜ å°„åˆ°VRB</h3><p>å¯¹äºç”¨äºä¼ è¾“PUSCHçš„æ¯ä¸ªå¤©çº¿ç«¯å£ï¼Œå¤å€¼ç¬¦å·å— $z<sup>{Â§}(0),â€¦,z</sup>{Â§}(M_{symb}^{ap}-1)$ åº”ä¸å¹…åº¦ç¼©æ”¾å› å­$\beta_{PUSCH}$ç›¸ä¹˜ï¼Œä»¥æ»¡è¶³[5,TS 38.213]ä¸­è§„å®šçš„å‘å°„åŠŸç‡ã€‚<br>å¯¹äºæ¯ä¸ªå¤©çº¿æ­¥éª¤ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿèµ„æºç½‘æ ¼ã€‚åœ¨èµ„æºç½‘æ ¼å†…ï¼Œä»REçš„æœ€ä½é¢‘ç‡åˆ°è¾ƒé«˜é¢‘ç‡çš„æ¥è‡ªæ¥å¡«å……PUSCHæ•°æ®åˆ°æ¯ä¸ªREä¸­ã€‚ä¸€æ—¦å®ƒä»¥åˆ†é…çš„PUSCHèµ„æºå—çš„æœ€é«˜é¢‘ç‡åˆ°è¾¾REï¼Œåˆ™ç§»è‡³ä¸‹ä¸€ä¸ªOFDMç¬¦å·çš„æœ€ä½é¢‘ç‡çš„REã€‚</p><h3 id="1-2-7-æ˜ å°„åˆ°PRB"><a class="header-anchor" href="#1-2-7-æ˜ å°„åˆ°PRB">Â¶</a>1.2.7 æ˜ å°„åˆ°PRB</h3><p>æŒ‰ç…§ä¹‹å‰çš„åè®®ï¼šæœ‰äº¤ç»‡å’Œéäº¤ç»‡ä¸¤ç§æ¨¡å¼ï¼Œå’ŒPDSCHä¸€æ ·ã€‚å‚è€ƒPDSCHæ˜ å°„è§„åˆ™ã€‚<br>æŒ‰ç…§ç°åœ¨<strong>æœ€æ–°ç‰ˆæœ¬</strong>çš„åè®®ï¼Œåªæœ‰<strong>éäº¤ç»‡</strong>çš„æ¨¡å¼ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="/5G_Protocol/5G-NR-PUSCH%E5%AD%A6%E4%B9%A0/blog/source/_posts/5G%E5%8D%8F%E8%AE%AE/5G-NR-PUSCH%E5%AD%A6%E4%B9%A0/p6-VRB%E6%98%A0%E5%B0%841.png" alt><br><img src="/5G_Protocol/5G-NR-PUSCH%E5%AD%A6%E4%B9%A0/blog/source/_posts/5G%E5%8D%8F%E8%AE%AE/5G-NR-PUSCH%E5%AD%A6%E4%B9%A0/p7-VRB%E6%98%A0%E5%B0%842.png" alt></p><h1>2 PUSCH DMRS</h1><h2 id="2-1-åºåˆ—ç”Ÿæˆ"><a class="header-anchor" href="#2-1-åºåˆ—ç”Ÿæˆ">Â¶</a>2.1 åºåˆ—ç”Ÿæˆ</h2><p>æœ‰ä¸¤ç§æ¡ä»¶ä¸‹DMRSåºåˆ—ç”Ÿæˆæ–¹å¼ï¼ŒTransform Precoding disabledï¼ŒTransform Precoding enabledã€‚</p><h3 id="2-1-1-Transform-Precoding-disabled"><a class="header-anchor" href="#2-1-1-Transform-Precoding-disabled">Â¶</a>2.1.1 Transform Precoding disabled</h3><p>è¿™ç§æƒ…å†µçš„ç”Ÿæˆæ–¹å¼æ˜¯ä¸PDSCH DMRSä¸€æ ·çš„ï¼š<br>PUSCH DMRSåºåˆ—æœ‰å¦‚ä¸‹å…¬å¼ç”Ÿæˆï¼š<br>$$<br>r(n) = \frac{1}{\sqrt{2}}(1-2\cdot c(2n))+j\frac{1}{\sqrt{2}}(1-2\cdot c(2n+1))<br>$$<br>åŠ æ‰°åºåˆ—é‡‡ç”¨31é˜¶Goldåºåˆ—ç”Ÿæˆï¼ŒåŠ æ‰°åºåˆ—çš„åˆå§‹åºåˆ—$c_{init}$å¦‚ä¸‹å¼æ‰€ç¤º:<br>$$<br>c_{init} = (2<sup>{17}(N_{symb}</sup>{slot}n_{s,f}<sup>{\mu}+l+1)(2N_{ID}</sup>{\overline n_{SCID}^{\overline \lambda}}+1)+2^{17}\lfloor\frac{\overline \lambda}{2} \rfloor+2N_{ID}^{\overline n_{SCID}^{\overline \lambda}}+\overline n_{SCID}^{\overline \lambda})mod2^{31}<br>$$<br>å…¶ä¸­ï¼š $l$ ä¸ºæ—¶éš™ä¸­çš„ç¬¦å·ç´¢å¼•ï¼Œ $n_{s,f}$ ä¸ºæ—¶éš™ç´¢å¼•ï¼Œ $N_{symb}^{slot}$ ä¸ºä¸€ä¸ªæ—¶éš™å†…çš„ç¬¦å·æ•°é‡ã€‚</p><ul><li>$N_{ID}<sup>0,N_{ID}</sup>1\in{0,1,â€¦,65535}$ï¼šåˆ†åˆ«ç”±é«˜å±‚å‚æ•° <em>scramblingID0</em> å’Œ <em>scramblingID1</em> ç»™å‡º ï¼ˆå¦‚æœé…ç½®çš„è¯ï¼Œä¸”PUSCHç”± DCI format 0_1,0_2è°ƒåº¦ï¼Œæˆ–è€…æ˜¯å…·æœ‰é…ç½®çš„æˆæƒçš„PUSCHä¼ è¾“ï¼‰ï¼›</li><li>$N_{ID}^0\in{0,1,â€¦,65535}$ï¼šç”± <em>DMRS-UplinkConfig -&gt; scramblingID0</em> ç»™å‡ºï¼ˆå¦‚æœé…ç½®çš„è¯ï¼Œä¸”PUSCHç”±è¢« C-RNTIï¼ŒMSC-C-RNTIï¼Œæˆ–è€… CSï¼RNTI åŠ æ‰°çš„ DCI format 0_0 è°ƒåº¦ï¼‰ï¼›</li><li>$N_{ID}<sup>0,N_{ID}</sup>1\in{0,1,â€¦,65535}$ï¼šå¯¹äºæ¯ä¸ªmsgA PUSCH é…ç½®ï¼Œåˆ†åˆ«ç”±é«˜å±‚å‚æ•° <em>msgA-DMRS-Configuration</em> -&gt; <em>msgA-scramblingID0</em> , <em>msgA-scramblingID1</em>ç»™å‡ºï¼ˆå¦‚æœé…ç½®çš„è¯ï¼Œä¸”PUSCHä¼ è¾“æ˜¯ç”±Type-2éšæœºæ¥å…¥è¿‡ç¨‹è§¦å‘çš„ï¼‰ï¼›</li><li>$N_{ID}^{\overline n_{SCID}^{\overline \lambda}}=N_{ID}^{cell}$ otherwiseï¼›</li><li>$\overline n_{SCID}^{\overline \lambda}$ and $\overline \lambda$ ç”±é«˜å±‚å‚æ•° <em>DMRS-UplinkConfig -&gt; dmrs-Uplink-r16</em>ç»™å‡ºï¼Œå…¶ä¸­ $\lambda$ æ˜¯CDM groupï¼š<br>$$<br>N_{ID}^{\overline n_{SCID}^{\overline \lambda}}=\begin{cases}n_{SCID}\quad\quad\quad \lambda=0\quad or\quad\lambda = 2\1-n_{SCID}\quad\quad \lambda=1 \end{cases}\\overline \lambda = \lambda<br>$$<br>å¦åˆ™<br>$$<br>N_{ID}^{\overline n_{SCID}^{\overline \lambda}}=n_{SCID}\ \overline \lambda = 0<br>$$<br>å…¶ä¸­ $n_{SCID}\in {0,1}$ï¼š</li><li>å¦‚æœä½¿ç”¨DCI format 0_1 æˆ–è€… 0_2ï¼Œåˆ™åœ¨ä¸PUSCHä¼ è¾“ç›¸å…³çš„DCIä¸­ä½¿ç”¨ DM-RSåˆå§‹åŒ–å­—æ®µï¼ˆå¦‚æœå­˜åœ¨ï¼‰</li><li>ç”±é«˜å±‚å‚æ•° <em>dmrs-SeqInitialization</em> ç»™å‡ºï¼ˆå¦‚æœå­˜åœ¨ï¼Œä¸”æ˜¯å…·æœ‰é…ç½®çš„æˆæƒçš„Type 1 PUSCHä¼ è¾“ï¼Œæˆ–è€…PUSCHä¼ è¾“æ˜¯ç”±Type-2éšæœºæ¥å…¥è¿‡ç¨‹è§¦å‘çš„ï¼‰ï¼›</li><li>å¦åˆ™ $n_{SCID} = 0$ï¼›</li></ul><h3 id="2-1-2-Transform-Precoding-enabled"><a class="header-anchor" href="#2-1-2-Transform-Precoding-enabled">Â¶</a>2.1.2 Transform Precoding enabled</h3><p>ç”Ÿæˆå…¬å¼å¦‚ä¸‹ï¼š<br>$$<br>r(n)=r_{u,v}<sup>{(\alpha,\delta)}(n)\n=0,1,â€¦,M_{sc}</sup>{PUSCH}/2^{\delta}-1<br>$$<br>å…¶ä¸­ $r_{u,v}^{(\alpha,\delta)}(n)$ ä¸­ $\delta = 1,\alpha =0$</p><ul><li>å¦‚æœé«˜å±‚å‚æ•° <em>dmrsUplinkTransformPrecoding-r16</em> å·²é…ç½®ï¼ŒPUSCHä½¿ç”¨ $\pi/3-BPSK$ è°ƒåˆ¶ ï¼Œä¸”æ­¤æ¬¡PUSCHä¼ è¾“ä¸æ˜¯ msg3ï¼Œå¹¶ä¸”è¿™æ¬¡ä¼ è¾“åœ¨CCSä¸­å¹¶æ²¡æœ‰ä½¿ç”¨ DCI format 0_0 è°ƒåº¦ï¼Œ$r_{u,v}^{(\alpha,\delta)}(n)$ ä¸ºä½å‡å³°æ¯”åºåˆ—ï¼Œè§[TS 38.211 5.2.2~3]ã€‚</li></ul><p>åºåˆ—ç»„ $u = (f_{gh}+n_{ID}<sup>{RS})mod30$ï¼Œå…¶ä¸­$n_{ID}</sup>{RS}$ç”±ä¸‹é¢ç»™å‡ºï¼š</p><ul><li><p>$n_{ID}<sup>{RS}=n_{ID}</sup>{PUSCH}$ï¼Œå¦‚æœ $n_{ID}^{PUSCH}$ ç”±é«˜å±‚å‚æ•°<em>DMRS-UplinkConfig</em> -&gt; <em>nPUSCH-Identity</em> é…ç½®ï¼Œè€Œé«˜å±‚å‚æ•°<em>dmrsUplinkTransformPrecoding-r16</em> ä¸ºé…ç½®ï¼Œè€Œä¸”PUSCHæ—¢ä¸æ˜¯ç”±RAR ULè°ƒåº¦ï¼Œä¹Ÿä¸æ˜¯ç”±åˆ©ç”¨TC-RNTIåŠ æ‰°çš„DCI format 0_0 è°ƒåº¦çš„ï¼›</p></li><li><p>$n_{ID}<sup>{RS}=n_{ID}</sup>{PUSCH}$ï¼Œå¦‚æœ $n_{ID}^{PUSCH}$ ç”±é«˜å±‚å‚æ•°<em>dmrs-UplinkTransformPrecoding-r16</em>é…ç½®ï¼ŒPUSCH ä½¿ç”¨ $\pi/2-BPSK$ è°ƒåˆ¶ï¼Œä¸”æ­¤æ¬¡PUSCHä¼ è¾“ä¸æ˜¯ msg3ï¼Œå¹¶ä¸”è¿™æ¬¡ä¼ è¾“åœ¨ CCSä¸­å¹¶æ²¡æœ‰ä½¿ç”¨ DCI format 0_0 è°ƒåº¦ã€‚</p></li><li><p>$n_{ID}^{RS} = N_{ID}^{cell}$ otherwiseï¼›</p></li></ul><p>å…¶ä¸­ $f_{gh}$ å’Œ åºåˆ—æ•° $v$ ç”±ä¸‹é¢ç»™å‡ºï¼š</p><ul><li>å¦‚æœæ—¢æ²¡æœ‰ç»„è·³å˜ä¹Ÿæ²¡æœ‰åºåˆ—è·³å˜<br>$$<br>f_{gh}=0\v-0<br>$$</li><li>å¦‚æœé…ç½®äº†ç»„è·³å˜ï¼Œæœªé…ç½®åºåˆ—è·³å˜<br>$$<br>f_{gh} = (\sum_{m = 0}<sup>{7}2</sup>mc(8(N_{symb}<sup>{slot}n_{s,f}</sup>{\mu}+l)+m))mod30\v=0\c_{init}=\lfloor n_{ID}^{RS}/30 \rfloor<br>$$</li><li>å¦‚æœåºåˆ—è·³å˜é…ç½®ï¼Œç»„è·³å˜æœªé…ç½®<br>$$<br>f_{gs} = 0\v=\begin{cases}v = c(N_{symb}<sup>{slot}n_{s,f}</sup>{\mu}+l) \quad if\quad M_{ZC}\geq 6N_{sc}^{RB}\0\quad\quad\quad\quad\quad\quad\quad\quad\quad otherwise \end{cases}\c_{init}=n_{ID}^{RS}<br>$$</li></ul><p>è·³å˜æ¨¡å¼(hopping mode)ç”±é«˜å±‚å‚æ•°æ§åˆ¶ï¼š</p><ul><li>å¦‚æœPUSCHä¼ è¾“æ˜¯ç”±RAR UL è°ƒåº¦çš„ï¼Œæˆ–è€…æ˜¯ç”±ç”±TC-RNTI åŠ æ‰°çš„ DCI format 0_0 è°ƒåº¦çš„ï¼Œæ­¤æ—¶åºåˆ—è·³å˜ç¦ç”¨ï¼Œç»„è·³å˜ç¦ç”¨å¯ç”¨äºå¦ç”±é«˜å±‚å‚æ•° <em>groupHoppingEnabledTransformPrecoding</em> å†³å®šï¼›</li><li>å…¶ä»–ä¼ è¾“æ—¶ï¼Œåºåˆ—è·³å˜å’Œç»„è·³å˜çš„ç¦ç”¨å¯ç”¨ä¸å¦åˆ†åˆ«ç”±é«˜å±‚å‚æ•° <em>sequenceHopping , sequenceGroupHopping</em> å†³å®šï¼ˆå¦‚æœè¿™äº›å‚æ•°é…ç½®çš„è¯ï¼Œå¦åˆ™å°†é‡‡ç”¨å’ŒMsg3ä¸€æ ·çš„hopping modeï¼‰ã€‚</li></ul><p>UE æ˜¯å¹¶ä¸æœŸå¾…åŒæ—¶å¤„ç†åºåˆ—è·³å˜å’Œç»„è·³å˜çš„ã€‚</p><h2 id="2-2-èµ„æºæ˜ å°„"><a class="header-anchor" href="#2-2-èµ„æºæ˜ å°„">Â¶</a>2.2 èµ„æºæ˜ å°„</h2><p>åºåˆ— $r(m)$ è¢« æ˜ å°„ä¸­é—´å€¼ä¸º $\widetilde \alpha_{k,l}^{(\widetilde p_j,\mu)}$ ï¼Œæ ¹æ®å¦‚ä¸‹ï¼š</p><ul><li>â‘ if transform precoding is not enable,<br>$$<br>\widetilde \alpha_{k,l}^{(\widetilde p_j,\mu)}=w_f(kâ€™)w_t(lâ€™)r(2n+kâ€™)\k = \begin{cases}4n+2kâ€™+\Delta \quad \quad Configuration\quad type\quad1\6n+kâ€™+\Delta\quad \quad Configuration\quad type\quad 2 \end{cases}\kâ€™=0,1\l=\overline{l}+lâ€™\n = 0,1,â€¦\j=0,1,â€¦,v-1<br>$$</li><li>â‘¡if transform precoding is enable<br>$$<br>\widetilde \alpha_{k,l}^{(\widetilde p_j,\mu)}=w_f(kâ€™)w_t(lâ€™)r(2n+kâ€™)\k=4n+2kâ€™+\Delta\kâ€™=0,1\l=\overline l+lâ€™\n=0,1,â€¦<br>$$<br>ä¸­é—´å€¼ $\widetilde \alpha_{k,l}^{(\widetilde p_j,\mu)}$ ä¼šç»è¿‡é¢„ç¼–ç çŸ©é˜µ <em><strong>W</strong></em> å’Œç¼©æ”¾å› å­ $\beta_{PUSCH}^{DMRS}$ , æœ€ç»ˆæ˜ å°„ä¸º $\alpha_{k,l}^{( p_j,\mu)}$ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br>$$<br>\left[ \begin{matrix}\alpha_{k,l}^{( p_0,\mu)}\ \vdots\\alpha_{k,l}^{( p_{\rho-1},\mu)} \end{matrix}\right]=\beta_{PUSCH}^{DMRS}W\left[ \begin{matrix}\widetilde \alpha_{k,l}^{( \widetilde p_0,\mu)}\ \vdots\ \widetilde \alpha_{k,l}^{(\widetilde p_{\rho-1},\mu)} \end{matrix} \right]<br>$$</li></ul><h3 id="2-2-1-é¢‘åŸŸç´¢å¼•"><a class="header-anchor" href="#2-2-1-é¢‘åŸŸç´¢å¼•">Â¶</a>2.2.1 é¢‘åŸŸç´¢å¼•</h3><p>ç”±ä»¥ä¸Šå¯çŸ¥</p><ul><li>â‘  æƒ…å½¢æ—¶ï¼ŒDMRSçš„æ˜ å°„æƒ…å†µå’ŒPUSCH DMRS ä¸€è‡´</li><li>â‘¡ æƒ…å½¢æ—¶ï¼Œå…¶é¢‘åŸŸæ˜ å°„è§„åˆ™åªæœ‰Configuration Type 1</li></ul><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºä¸¤ç§æƒ…å†µçš„å‚è€ƒç‚¹</p><ul><li>â‘ æƒ…å½¢æ—¶ï¼Œå…¶å‚è€ƒç‚¹æ˜¯PUSCH RB#0</li><li>â‘¡æƒ…å½¢æ—¶ï¼Œå…¶å‚è€ƒç‚¹æ˜¯CRB#0</li></ul><h3 id="2-2-2-æ—¶åŸŸç´¢å¼•"><a class="header-anchor" href="#2-2-2-æ—¶åŸŸç´¢å¼•">Â¶</a>2.2.2 æ—¶åŸŸç´¢å¼•</h3><p>DMRSçš„ç¬¦å·ä½ç½®å–å†³äºPDSCHçš„mapping typeï¼Œåˆ†ä¸ºmapping type A å’Œ mapping type Bï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p><p>![](D:/blog/source/_posts/5Gåè®®/5G-NR-PUSCHå­¦ä¹ /t2-38.214 6.1.2.1-1.png)</p><p>PUSCH ä¸ PDSCH çš„å·®åˆ«é™¤äº†åˆå§‹ç¬¦å·ä½ç½®å’Œç¬¦å·é•¿åº¦çš„äº›è®¸åŒºåˆ«å¤–ï¼Œè¿˜åœ¨äºPUSCH è¿˜ä¼šé…ç½® <em>frequency intra-slot hopping</em> æ–¹å¼ï¼Œæ˜¯å¦hopping çš„ä¸¤ç§æ–¹å¼ä¸‹DMRSç¬¦å·ä¼šæœ‰äº›å·®å¼‚ã€‚æ‰€ä»¥DMRSä¹Ÿä¼šç•¥æœ‰ä¸åŒã€‚<br>ä½†æ˜¯PUSCHå’ŒPDSCå’Œçš„DMRSç±»ä¼¼ï¼ŒPUSCH DMRSä¹Ÿæ”¯æŒï¼š</p><ul><li><em>Front-loaded DM-RS</em>ï¼šæ”¯æŒå•å‰ç½®ï¼ŒåŒå‰ç½®</li><li><em>Additional DM-RS</em>ï¼šæ”¯æŒå•ç¬¦å·å’ŒåŒç¬¦å·</li></ul><p>ä¸¤ç§hoppingä¸‹çš„DMRSï¼š</p><ul><li>å¯¹äºä¸è·³é¢‘ï¼šå…¶æ—¶åŸŸæ˜ å°„å’ŒPDSCH DMRS æœºåˆ¶ä¸€æ ·ï¼Œå‚è€ƒè¡¨[TS 38.211 6.4.1.1.3-3~4]</li></ul><p>![](D:/blog/source/_posts/5Gåè®®/5G-NR-PUSCHå­¦ä¹ /t9-211 6.4.1.1.3-3.png)</p><p><img src="/5G_Protocol/5G-NR-PUSCH%E5%AD%A6%E4%B9%A0/blog/source/_posts/5G%E5%8D%8F%E8%AE%AE/5G-NR-PUSCH%E5%AD%A6%E4%B9%A0/t12-211.png" alt><br>![](D:/blog/source/_posts/5Gåè®®/5G-NR-PUSCHå­¦ä¹ /t10-211 6.4.1.1.3-4.png)</p><ul><li>å¯¹äºè·³é¢‘ï¼šå…¶æ—¶åŸŸæ˜ å°„,å‚è€ƒè¡¨[TS 38.211 6.4.1.1.3-6],æ³¨æ„æ­¤æ—¶<strong>ä»…æ”¯æŒ</strong>å•å‰ç½®+additional DMRSã€‚</li></ul><p>![](D:/blog/source/_posts/5Gåè®®/5G-NR-PUSCHå­¦ä¹ /t13-211 6.4.1.1.3-6.png)</p><h2 id="2-3-å¤©çº¿ç«¯å£é—®é¢˜"><a class="header-anchor" href="#2-3-å¤©çº¿ç«¯å£é—®é¢˜">Â¶</a>2.3 å¤©çº¿ç«¯å£é—®é¢˜</h2><p>PUSCH DMRS Type 1 å’Œ Type 2 å¤šå¤©çº¿ç«¯å£CDM group å®šä¹‰å’ŒPDSCH DMRSç›¸åŒï¼Œä»…ä»…æ˜¯å¤©çº¿ç«¯å£çš„ç¼–å·å·®å¼‚ã€‚å‚è€ƒè¡¨æ ¼[TS 38.211 6.1.1.3-1,2,5]å¦‚ä¸‹ï¼š</p><p>![](D:/blog/source/_posts/5Gåè®®/5G-NR-PUSCHå­¦ä¹ /t7-211 6.4.1.1.3-1.png)</p><p>![](D:/blog/source/_posts/5Gåè®®/5G-NR-PUSCHå­¦ä¹ /t8-211 6.4.1.1.3-2.png)</p><p>![](D:/blog/source/_posts/5Gåè®®/5G-NR-PUSCHå­¦ä¹ /t14-211 6.4.1.1.3-5.png)</p><ul><li>type 1ï¼Œsingle symbolæƒ…å†µä¸‹ï¼Œæœ€å¤šæ”¯æŒ4ä¸ªç«¯å£ï¼Œç«¯å£0ï¼Œ1å’Œ2ï¼Œ3åˆ†åˆ«åœ¨ä¸åŒçš„CDM groupï¼Œæ¯ä¸ªCDM groupå†…ï¼Œæ¯”å¦‚ç«¯å£0å’Œ1ï¼Œåˆé€šè¿‡é¢‘åŸŸçš„OCCæ¥å®ç°æ­£äº¤ï¼Œä»è€Œå®ç°4ä¸ªç«¯å£çš„æ­£äº¤ã€‚</li><li>type 1ï¼Œdouble symbolæƒ…å†µä¸‹ï¼Œæœ€å¤šæ”¯æŒ8ä¸ªç«¯å£ï¼Œé™¤äº†é¢‘åŸŸOCCå¤–ï¼Œè¿˜å¯ä»¥æ—¶åŸŸOCCæ¥å®ç°æ­£äº¤ï¼Œæ‰€ä»¥å¯ä»¥æ”¯æŒæ›´å¤šçš„ç«¯å£ã€‚</li><li>type 2ï¼Œsingle symbolæƒ…å†µä¸‹ï¼Œæœ€å¤šæ”¯æŒ6ä¸ªç«¯å£ï¼Œå…±ä¸‰ä¸ªCDM groupï¼Œæ¯ä¸ªgroupå†…åˆé€šè¿‡é¢‘åŸŸOCCå®ç°æ­£äº¤ã€‚</li><li>type 2ï¼Œdouble symbolæƒ…å†µä¸‹ï¼Œæœ€å¤šæ”¯æŒ12ä¸ªç«¯å£ï¼Œä¸ç±»å‹1åŒç¬¦å·æƒ…å†µåŒç†ï¼Œé™¤äº†é¢‘åŸŸOCCå¤–ï¼Œè¿˜å¯ä»¥æ—¶åŸŸOCCï¼Œä»è€Œæ”¯æŒæ›´å¤šçš„ç«¯å£ã€‚</li></ul><h1>3 PUSCH PTRS</h1><h2 id="3-1-åºåˆ—ç”Ÿæˆ"><a class="header-anchor" href="#3-1-åºåˆ—ç”Ÿæˆ">Â¶</a>3.1 åºåˆ—ç”Ÿæˆ</h2><p>æœ‰ä¸¤ç§æ¡ä»¶ä¸‹PTRSåºåˆ—ç”Ÿæˆæ–¹å¼ï¼ŒTransform Precoding disabledï¼ŒTransform Precoding enabledã€‚</p><h3 id="3-1-1-Transform-Precoding-disabled"><a class="header-anchor" href="#3-1-1-Transform-Precoding-disabled">Â¶</a>3.1.1 Transform Precoding disabled</h3><p>å¦‚æœæœªä½¿ç”¨å˜æ¢é¢„ç¼–ç ï¼Œå±‚jä¸Šå­è½½æ³¢kä¸Šçš„PTRSç”±ä¸‹å¼ç»™å‡ºï¼š<br>$$<br>r^{(\widetilde p_j)}(m) = \begin{cases}r(m)\quad\quad if\quad j=jâ€™||j = jâ€™'\0\quad\quad\quad\quad otherwise \end{cases}<br>$$</p><ul><li>åºåˆ—$r(m)$ä¸å¯¹åº”çš„PUSCHçš„DMRSç›¸åŒ</li><li>ä¸è®ºæ˜¯å¦è·³é¢‘ï¼ŒPTRSçš„æ—¶åŸŸä½ç½®éƒ½åœ¨æ‰€åœ¨å­è½½æ³¢çš„ç¬¬ä¸€ä¸ªDMRSç¬¦å·ä¸Šã€‚</li><li></li></ul><h3 id="3-1-2-Transform-Precoding-enabled"><a class="header-anchor" href="#3-1-2-Transform-Precoding-enabled">Â¶</a>3.1.2 Transform Precoding enabled</h3><p>å¦‚æœæœªä½¿ç”¨å˜æ¢é¢„ç¼–ç ï¼ŒPTRSå†DFTä¹‹å‰æ’å…¥ï¼Œæ­¤æ—¶PTRSæ˜ å°„ä½ç½®må–å†³äºPTRS groupæ•°é‡å’Œæ¯ä¸ªgroupå†…sampleçš„æ•°é‡ä»¥åŠPUSCHæ€»å…±æ‰€å çš„å­è½½æ³¢çš„æ•°é‡ã€‚åºåˆ—ç”Ÿæˆå…¬å¼å¦‚ä¸‹æ‰€ç¤ºï¼š<br>$$<br>r_{m}(mâ€™)=w(kâ€™)\frac{e<sup>{j\frac{\pi}{2}(mmod2)}}{\sqrt{2}}[(1-2c(mâ€™))+j(1-2c(mâ€™))]\mâ€™=N_{samp}</sup>{group}sâ€™+kâ€™\sâ€™=0,1,â€¦N_{group}^{PT-RS}-1\kâ€™ = 0,1,N_{samp}<sup>{group}-1\c_{init}=(2</sup>{17}(N_{symb}<sup>{slot}n_{s,f}</sup>{\mu}+l+1)(2N_{ID}+1)+2N_{ID})mod2^{31}<br>$$<br>$w(i)$ ç”±ä¸‹è¡¨ç»™å‡ºï¼š</p><p>![](D:/blog/source/_posts/5Gåè®®/5G-NR-PUSCHå­¦ä¹ /t4-211 6.4.1.2.1.2-1.png)</p><h2 id="3-2-èµ„æºæ˜ å°„"><a class="header-anchor" href="#3-2-èµ„æºæ˜ å°„">Â¶</a>3.2 èµ„æºæ˜ å°„</h2><p>åŒæ ·å¯¹åº”ç€æœ‰ä¸¤ç§æ¡ä»¶ä¸‹PTRSåºåˆ—æ˜ å°„æ–¹å¼ï¼ŒTransform Precoding disabledï¼ŒTransform Precoding enabledã€‚</p><h3 id="3-2-1-Transform-Precoding-disabled"><a class="header-anchor" href="#3-2-1-Transform-Precoding-disabled">Â¶</a>3.2.1 Transform Precoding disabled</h3><p>UEåªåœ¨é«˜å±‚ä¿¡ä»¤æŒ‡ç¤ºPTRSä¼ è¾“ä¸‹æ‰ä¼ è¾“ï¼Œä¸”åªåœ¨PUSCHå†…ä¼ è¾“PTRSï¼Œæ˜ å°„åˆ°REçš„å…¬å¼å¦‚ä¸‹<br>$$<br>\left[ \begin{matrix}a_{k.l}^{(p_0,\mu)}\ \vdots\ a_{k.l}^{(p_{\rho-1},\mu)} \end{matrix} \right]=\beta_{PT-RS}W\left[ \begin{matrix}r^{(\widetilde p_0)}(2n+kâ€™)\ \vdots\ r^{(\widetilde p_v-1{})}(2n+kâ€™) \end{matrix} \right]\k=\begin{cases}4n+2kâ€™+\Delta\quad\quad configuration\quad type1\6n+kâ€™+\Delta\quad\quad\quad configuration\quad type2 \end{cases}<br>$$<br>å…¶ä¸­ï¼š</p><ul><li>$l$ æ˜¯PUSCHæ‰€å OFDMç¬¦å·æ•°ï¼›</li><li>REæœªè¢«DMRSå ç”¨ï¼›</li><li>$kâ€™$ and $\Delta$ å¯¹åº” $\widetilde p_0,â€¦,\widetilde p_{v-1}$</li><li>Wæ˜¯é¢„ç¼–ç çŸ©é˜µ</li><li>$\beta_{PT-RS}$ æ˜¯åŠŸç‡å› å­</li></ul><h4 id="3-2-1-1-æ—¶åŸŸç´¢å¼•"><a class="header-anchor" href="#3-2-1-1-æ—¶åŸŸç´¢å¼•">Â¶</a>3.2.1.1 æ—¶åŸŸç´¢å¼•</h4><p>ç¡®å®šæ—¶åŸŸç´¢å¼•$l$çš„æ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1. set i&#x3D;0 and l_&#123;ref&#125; &#x3D; 0 </span><br><span class="line">2. if any symbol in the interval max(l_&#123;ref&#125;+(i-1)L_&#123;PT-RS&#125; + 1,l_&#123;ref&#125;),â€¦,l_&#123;ref&#125; + iL_&#123;PT-RS&#125; overlaps with a symbol used for DM-RS according to clause 6.4.1.1.3</span><br><span class="line">-	set i&#x3D;1</span><br><span class="line">-	set l_&#123;ref&#125; to the symbol index of the DM-RS symbol in case of a single-symbol DM-RS or to the symbol index of the second DM-RS symbol in case of a double-symbol DM-RS</span><br><span class="line">-	repeat from step 2 as long as l_&#123;ref&#125; +iL_&#123;PT-RS&#125; is inside the PUSCH allocation</span><br><span class="line">3. add l_&#123;ref&#125; + iL_&#123;PT-RS&#125; to the set of time indices for PT-RS</span><br><span class="line">4. increment i by one</span><br><span class="line">5. repeat from step 2 above as long as l_&#123;ref&#125; +iL_&#123;PT-RS&#125; is inside the PUSCH allocation</span><br><span class="line">where L_&#123;PT-RS&#125;âˆˆ&#123;1ï¼Œ2ï¼Œ4&#125; is defined in Table 6.2.3.1-1 of [6,TS 38.214].</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šæ­¥éª¤ç®€å•æè¿°å¦‚ä¸‹ï¼š<br>$L_{PT-RS}$ è¡¨ç¤ºPTRSå†æ—¶åŸŸä¸Šçš„å¯†åº¦ï¼Œä¹Ÿå°±æ˜¯æ¯ $L_{PT-RS}$ ä¸ªç¬¦å·æœ‰ä¸€ä¸ªPTRSç¬¦å·ã€‚é…ç½®æ–¹å¼ä¸ºï¼šä»PUSCHå¼€å§‹è°ƒåº¦çš„ä½ç½®å¼€å§‹ï¼Œç›´åˆ°PUSCHç»“æŸï¼Œæ¯ä¸ªLç¬¦å·é…ç½®PTRSï¼Œå¦‚æœç¢°åˆ°äº†DMRSï¼Œåˆ™é‡æ–°å¼€å§‹è®¡æ•°ã€‚ä¾‹å¦‚ï¼ŒPUSCHåœ¨ä¸€ä¸ªslotå†…è°ƒåº¦ï¼Œå³ä»$i = 0$ å¼€å§‹ï¼Œ$i = 13$ ç»“æŸï¼Œ$L_{PT-RS} = 4$ï¼ŒDMRSåœ¨ $l = 2$ çš„ç¬¦å·ä¸Šï¼Œåˆ™PTRSæ—¶åŸŸé…ç½®æƒ…å½¢å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/5G_Protocol/5G-NR-PUSCH%E5%AD%A6%E4%B9%A0/blog/source/_posts/5G%E5%8D%8F%E8%AE%AE/5G-NR-PUSCH%E5%AD%A6%E4%B9%A0/p8-PTRS1.png" alt></p><h4 id="3-2-1-2-é¢‘åŸŸç´¢å¼•"><a class="header-anchor" href="#3-2-1-2-é¢‘åŸŸç´¢å¼•">Â¶</a>3.2.1.2 é¢‘åŸŸç´¢å¼•</h4><p>(ä¸PDSCH PTRS å‡ ä¹ä¸€æ ·)<br>é¦–å…ˆï¼Œå‡å®šåˆ†é…ç»™PUSCHçš„RBä¸ºä»0åˆ°$N_{RB}-1$ï¼Œé‚£ä¹ˆåˆ†é…ç»™PUSCHçš„å­è½½æ³¢èŒƒå›´å°±æ˜¯0-$N_{sc}^{RB}N_{RB}-1$ã€‚æœ€ç»ˆPTRSé¢‘åŸŸç´¢å¼•$k$ï¼Œç”±ä¸‹é¢å…¬å¼å¾—åˆ°ï¼š<br>$$<br>k=k_{ref}<sup>{RE}+(iK_{PT-RS}+k_{ref}</sup>{RB})N_{sc}<sup>{RB}\k_{ref}</sup>{RB}= \begin{cases}n_{RNTI}modK_{PT-RS} \quad \quad \quad if N_{RB}modK_{PT-RS} = 0 \n_{RNTI}mod(N_{RB}modK_{PT-RS})\quad \quad otherwise\end{cases}<br>$$</p><p>$k_{ref}^{RE}$ ç”±ä¸‹è¡¨è·å¾—[TS 38.211-Table 6.4.1.2.2-1]ï¼š</p><p>![](D:/blog/source/_posts/5Gåè®®/5G-NR-PUSCHå­¦ä¹ /t5-211 6.4.1.2.2.1-1.png)</p><p>ç”±ä¸Šå¯çŸ¥ï¼Œ$K_{PT-RS}$ä¸ºç›¸é‚» PTRSä¹‹é—´é—´éš”çš„RBæ•°ï¼Œå³ç›¸é‚» PTRSä¹‹é—´ç›¸å·®$K_{PT-RS}\cdot N_{sc}^{RB}$ ä¸ªå­è½½æ³¢ï¼Œç¬¬ä¸€ä¸ªPTRS å­è½½æ³¢å®šä½æ˜¯ $k_{ref}<sup>{RE}+ï¼ˆ0K_{PT-RS}+k_{ref}</sup>{RB}ï¼‰N_{sc}^{RB}$ ã€‚å¤§æ¦‚çš„å›¾æ ·å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/5G_Protocol/5G-NR-PUSCH%E5%AD%A6%E4%B9%A0/blog/source/_posts/5G%E5%8D%8F%E8%AE%AE/5G-NR-PUSCH%E5%AD%A6%E4%B9%A0/PTRS%E9%A2%91%E5%9F%9F%E5%9B%BE.png" alt></p><h3 id="3-2-2-Transform-Precoding-enabled"><a class="header-anchor" href="#3-2-2-Transform-Precoding-enabled">Â¶</a>3.2.2 Transform Precoding enabled</h3><p>æ­¤ç§æƒ…å†µPTRSæ˜¯åœ¨DFTä¹‹å‰æ’å…¥ï¼Œæ’å…¥çš„ä½ç½®mä¸ä¸‰ä¸ªå‚æ•°æœ‰å…³ï¼šPTRSçš„groupæ•°é‡ï¼Œæ¯ä¸ªgroupå†…çš„sampleæ•°é‡å’ŒPUSCHæ‰€å å­è½½æ³¢çš„æ•°é‡ï¼Œä¸åŒæƒ…å†µä¸‹çš„å…·ä½“å…¬å¼åœ¨ä¸‹è¡¨ä¸­ç»™å‡ºï¼š</p><p>![](D:/blog/source/_posts/5Gåè®®/5G-NR-PUSCHå­¦ä¹ /t6-211 6.4.1.2.2.2-1.png)</p><blockquote><p>å‚è€ƒç›®å½•<br>å¾®ä¿¡å…¬ä¼—å·ï¼šæ˜¥å¤©å·¥ä½œå®¤ï¼Œ5Gèœé¸Ÿæˆé•¿æ—¥è®°<br>ç½‘é¡µï¼š<a href="https://mp.weixin.qq.com/s/83D25ABb2YURSbLQ3fOYsg" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/83D25ABb2YURSbLQ3fOYsg</a><br>ç½‘é¡µï¼š<a href="https://mp.weixin.qq.com/s/SZwf4bJEzWa8RfJDiCC-CA" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/SZwf4bJEzWa8RfJDiCC-CA</a><br>ç½‘é¡µï¼š<a href="http://www.sharetechnote.com/html/5G/5G_PUSCH.html" target="_blank" rel="noopener">http://www.sharetechnote.com/html/5G/5G_PUSCH.html</a><br>ç½‘é¡µï¼š<a href="http://www.sharetechnote.com/html/5G/5G_PUSCH_TxMode.html" target="_blank" rel="noopener">http://www.sharetechnote.com/html/5G/5G_PUSCH_TxMode.html</a><br>åšå®¢ï¼š<a href="https://blog.csdn.net/kakamilan/article/details/104759214/" target="_blank" rel="noopener">https://blog.csdn.net/kakamilan/article/details/104759214/</a> ï¼ˆDMRSï¼‰<br>åšå®¢ï¼š<a href="https://blog.csdn.net/m0_45416816/article/details/105097130" target="_blank" rel="noopener">https://blog.csdn.net/m0_45416816/article/details/105097130</a> ï¼ˆPTRSï¼‰</p></blockquote><!-- rebuild by neat -->]]></content>
      <categories>
        <category>5G_Protocol</category>
      </categories>
      <tags>
        <tag>PUSCH</tag>
      </tags>
  </entry>
  <entry>
    <title>5G-NR-PUCCHå­¦ä¹ </title>
    <url>/5G_Protocol/5G-NR-PUCCH%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<!-- build time:Tue Jun 22 2021 17:02:33 GMT+0800 (GMT+08:00) --><a id="more"></a><h1>1 PUCCH ä¿¡é“</h1><h2 id="1-1-æ¦‚è¿°"><a class="header-anchor" href="#1-1-æ¦‚è¿°">Â¶</a>1.1 æ¦‚è¿°</h2><p>NR ä¸­PUCCHç‰©ç†ä¿¡é“æ˜¯ç”¨æ¥å‘é€ä¸Šè¡Œæ§åˆ¶ä¿¡æ¯ Uplink Control information (UCI) (UCI ä¹Ÿå¯ä»¥åœ¨PUSCHä¿¡é“ä¸Šå‘é€)ï¼ŒUCIçš„å†…å®¹åŒ…æ‹¬ï¼šä¿¡é“çŠ¶æ€ä¿¡æ¯CSIï¼ŒHARQçš„ACK/NACKï¼Œè°ƒåº¦è¯·æ±‚Scheduling Requestï¼ˆSRï¼‰åŠç»„åˆä¿¡æ¯ã€‚</p><h2 id="1-2-ä½PAPRåºåˆ—"><a class="header-anchor" href="#1-2-ä½PAPRåºåˆ—">Â¶</a>1.2 ä½PAPRåºåˆ—</h2><p>PUCCHçš„åºåˆ—ç”ŸæˆåŠPUCCH DMRSéƒ½æ¶‰åŠä½PAPRåºåˆ—ã€‚å…¶ä¸­é™¤äº†format 2ä¹‹å¤–å…¶ä»–çš„æ ¼å¼éƒ½è¦æ¶‰åŠä½PAPRåºåˆ—ã€‚</p><p>$$<br>r_{u,v}^{(\alpha,\delta)}(n) = e^{j \alpha n}\overline r_{u,v}(n) , \quad 0 \leq n \leq M_{ZC}-1\M_{ZC} = mN_{sc}<sup>{RB}/2</sup>{\delta}\u \in {0,1,â€¦,29}\(v=0)\quad1/2\leq m/2^\delta \leq 5\(v=0,1)\quad 6\leq m/2^\delta \quad\quad<br>$$</p><h3 id="1-2-1-åŸºåºåˆ—ç”Ÿæˆ"><a class="header-anchor" href="#1-2-1-åŸºåºåˆ—ç”Ÿæˆ">Â¶</a>1.2.1 åŸºåºåˆ—ç”Ÿæˆ</h3><p>åŸºåºåˆ—çš„ç”Ÿæˆæ–¹å¼ä¸åºåˆ—é•¿åº¦æœ‰å…³ï¼š<br>$36 \leq M_{ZC}$:<br>$$<br>\overline r_{u,v}(n)=x_q(n\cdot modN_{ZC})\x_q(m) = e^{-j\frac{\pi qm(m+1)}{N_{ZC}}}\q = \lfloor \overline q +1/2\rfloor+v\cdot(-1)^{\lfloor 2\overline q \rfloor}\\overline q = N_{ZC}\cdot (u+1)/31\ max\quad prime\quad number\quad N_{ZC}&lt;M_{ZC}<br>$$</p><p>$M_{ZC} \in {6,12,18,24}$ ï¼šå¯æŸ¥è¡¨[TS 38.211 Table 5.2.2.2-1~4]ï¼Œæ¥ç¡®å®š$\varphi(n)$<br>$$<br>\overline r_{u,v}(n) = e^{j \varphi(n) \pi /4} , \quad 0 \leq n \leq M_{ZC}-1<br>$$</p><p>$M_{ZC} = 30$:<br>$$<br>\overline r_{u,v}(n) = e^{-j\frac{\pi(u+1)(n+1)(n+2)}{31}},0\leq n\leq M_{ZC}-1<br>$$</p><h3 id="1-2-2-Group-and-sequence-hopping"><a class="header-anchor" href="#1-2-2-Group-and-sequence-hopping">Â¶</a>1.2.2 Group and sequence hopping</h3><p>å¯¹äºPUCCH format 0/1/3/4ä½¿ç”¨Low PAPR sequenceï¼Œå…¶ä¸­çš„uå’Œvå–å†³äºé…ç½®pucch-GroupHoppingã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pucch-GroupHopping			ENUMERATED&#123;neither,enable,disable&#125;,</span><br><span class="line">hoppingId					INTEGER(0...1024)</span><br></pre></td></tr></table></figure><p>å…¶ä¸­çš„ hoppingId é…ç½®çš„æ˜¯ $n_{ID}$ , å¦‚æœæœªé…ç½®ï¼Œåˆ™ $n_{ID} = N_{ID}^{cell}$</p><p>$u=(f_{gh}+f_{ss})mod30$</p><p>å½“ <em>pucch-GroupHopping = neither</em>ï¼š<br>$$<br>f_{gh} = 0,f_{ss} = n_{ID} mod 30,v = 0<br>$$</p><p>å½“ <em>pucch-GroupHopping = enable</em>ï¼š<br>$$<br>f_{gh} = (\sum_{m = 0}<sup>{7}2</sup>mc(8(2n_{s,f}^\mu+n_{hop})+m))mod30\f_{ss} = n_{ID} mod 30\v = 0\c_{init} = \lfloor n_{ID}/30 \rfloor<br>$$</p><p>å½“ <em>pucch-GroupHopping = disabled</em>ï¼š<br>$$<br>f_{gh} = 0\f_{ss} = n_{ID} mod 30\v = c(2n_{s,f}<sup>{\mu}+n_{hop})\c_{init}=2</sup>5\lfloor n_{ID}/30 \rfloor+(n_{ID}mod30)<br>$$</p><p>å…¶ä¸­ï¼š$n_{s,f}^{\mu}$ ä¸ºæ— çº¿å¸§æ—¶éš™å·ï¼Œè·³å˜ä¸å¦è¦çœ‹åºåˆ—é•¿åº¦å†³å®šï¼ŒçŸ­åºåˆ—$: v = 0$ ï¼› é•¿åºåˆ—$:v=0,1$</p><p>æ³¨æ„ï¼šPUCCHGroupHoppingæ„å‘³ç€åŸºåºåˆ—ç»„å’Œåºåˆ—çš„è·³å˜ï¼Œè€Œéè·³é¢‘ã€‚</p><h3 id="1-2-3-å¾ªç¯ç§»ä½-alpha"><a class="header-anchor" href="#1-2-3-å¾ªç¯ç§»ä½-alpha">Â¶</a>1.2.3 å¾ªç¯ç§»ä½ $\alpha$</h3><p>$$<br>r_{u,v}<sup>{(\alpha,\delta)}(n)=e</sup>{j \alpha n}\overline r_{u,v}(n)\\alpha_l=\frac{2\pi}{N_{sc}<sup>{RB}}((m_0+m_{cs}+n_{cs}(n_{s,f}</sup>{\mu},l+lâ€™))modN_{sc}<sup>{RB})\n_{cs}(n_{s,f}</sup>{\mu},l) = \sum_{m = 0}<sup>{7}2</sup>m c(14 \cdot 8n_{s,f}^{\mu}+8l+m)\c_{init} = n_{ID}<br>$$</p><p>å…¶ä¸­</p><ul><li>$m_0$ - PUCCH format 0/1ï¼šç”± <em>initialCyclicShift</em> ç»™å‡ºï¼ŒPUCCH format 3 : $m_0 = 0$ï¼ŒPUCCH format 4 ç”±38.211 Table 6.4.1.3.3.1-1ç¡®å®šã€‚</li><li>$m_{cs}$ - PUCCH format 0ï¼šæ ¹æ®HARQåº”ç­”ä¿¡æ¯ç¡®å®šï¼ŒPUCCH format 1/3/4 ï¼š$m_{cs} = 0$</li></ul><h3 id="1-2-4-åº”ç”¨"><a class="header-anchor" href="#1-2-4-åº”ç”¨">Â¶</a>1.2.4 åº”ç”¨</h3><p>åœ¨PUCCHåº”ç”¨ä¸­çš„å¤§è‡´æµç¨‹å¦‚ä¸‹ï¼Œé€šè¿‡å‚æ•°ç”Ÿæˆä½PAPRåºåˆ—ï¼Œå…¶é•¿åº¦å–å†³äºPUCCHæ˜ å°„åˆ°é¢‘åŸŸçš„PRBæ•°ï¼Œä¸åŒæ—¶åŸŸåº”ç”¨çš„æ˜¯ä¸åŒå¾ªç¯ç§»ä½çš„ä½PAPRåºåˆ—ã€‚</p><h2 id="1-3-PUCCH-format"><a class="header-anchor" href="#1-3-PUCCH-format">Â¶</a>1.3 PUCCH format</h2><p>NRä¸­æ”¯æŒ5ç§æ ¼å¼PUCCHï¼Œæ ¹æ®PUCCHä¿¡é“å ç”¨æ—¶åŸŸç¬¦å·é•¿åº¦åˆ†ä¸º</p><ul><li>çŸ­PUCCHï¼š1-2ä¸ªç¬¦å·ï¼ŒPUCCH format 0ï¼ŒPUCCH format 2 èƒ½å¤Ÿæ”¯æŒæ›´å¿«æ·çš„HARQ åº”ç­”/ä¿¡é“çŠ¶æ€åé¦ˆï¼Œå¯ç”¨äºè¶…ä½æ—¶å»¶åœºæ™¯</li><li>é•¿PUCCHï¼š4-14ä¸ªç¬¦å·ï¼ŒPUCCH format 1ï¼ŒPUCCH format 3ï¼ŒPUCCH format 4</li></ul><p>PUCCH ä¿¡é“æ ¼å¼å®šä¹‰</p><table><thead><tr><th>PUCCH format</th><th>length in OFDM sysbols<br>$N_{symb}^{PUCCH}$</th><th>Number of bits</th></tr></thead><tbody><tr><td>0</td><td>1 - 2</td><td>$\leq 2$</td></tr><tr><td>1</td><td>4 - 14</td><td>$\leq 2$</td></tr><tr><td>2</td><td>1 - 2</td><td>$&gt; 2$</td></tr><tr><td>3</td><td>4 - 14</td><td>$&gt; 2$</td></tr><tr><td>4</td><td>4 - 14</td><td>$&gt; 2$</td></tr></tbody></table><ul><li><p>é•¿æ ¼å¼ PUCCH format 1ï¼Œ3ï¼Œ4 å¯ä»¥æ”¯æŒ<strong>æ—¶éš™å†…</strong>å’Œ<strong>æ—¶éš™é—´</strong>è·³é¢‘</p></li><li><p>çŸ­æ ¼å¼ PUCCH format 0ï¼Œ2 å¯ä»¥æ”¯æŒ<strong>æ—¶éš™å†…</strong>è·³é¢‘ï¼ˆ2ä¸ªç¬¦å·æ—¶ï¼‰</p></li></ul><p>å½“ä½¿ç”¨æ—¶éš™å†…è·³é¢‘æ—¶ï¼Œç¬¬ä¸€è·³($1^{st}hop$)å‘é€çš„ç¬¦å·çš„æ•°ä½$\lfloor N_{symb}^{PUCCH}/2 \rfloor$ï¼Œå…¶ä½™çš„ä¸ºç¬¬äºŒè·³ã€‚</p><p>åœ¨ä¸€ä¸ªæ—¶éš™å†…ï¼Œå¯ä»¥å‘1 - 2 ä¸ªPUCCHï¼Œè‡³å°‘æœ‰ä¸€ä¸ªPUCCH 0 æˆ–è€…PUCCH 2</p><h3 id="1-3-1-format-0"><a class="header-anchor" href="#1-3-1-format-0">Â¶</a>1.3.1 format 0</h3><h4 id="1-3-1-1-åºåˆ—ç”Ÿæˆ"><a class="header-anchor" href="#1-3-1-1-åºåˆ—ç”Ÿæˆ">Â¶</a>1.3.1.1 åºåˆ—ç”Ÿæˆ</h4><p>PUCCH 0 ç”¨äºå‘é€HARQçš„ACK/NACKåé¦ˆï¼Œä¹Ÿå¯ä»¥æºå¸¦SRä¿¡æ¯ã€‚<br>PUCCH 0 å‘é€çš„ä¿¡æ¯bitä¸º1æˆ–è€…2ï¼ˆå¯¹åº”è°ƒåº¦çš„PDSCHä¿¡é“çš„ä¸¤ä¸ªCodewordæ—¶ï¼Œä¹Ÿå°±æ˜¯å¯¹åº”ä¸¤ä¸ªç‹¬ç«‹çš„å¯è°ƒåˆ¶çš„æ•°æ®å—æµï¼‰ã€‚<br>PUCCH 0 åœ¨é¢‘åŸŸä¸Šå ç”¨ä¸€ä¸ªRBï¼Œåœ¨æ—¶åŸŸä¸Šå ç”¨1-2ä¸ªç¬¦å·ã€‚æ²¡æœ‰DMRSã€‚<br>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/5G_Protocol/5G-NR-PUCCH%E5%AD%A6%E4%B9%A0/p1-format0.png" alt></p><p>PUCCH 0 é«˜å±‚ç›¸å…³é…ç½®å‚æ•°ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PUCCH-format0 ::&#x3D;		SEQUENCE&#123;</span><br><span class="line">	initialCyclicShift		INTEGER(0..11),  &#x2F;&#x2F;åˆå§‹å¾ªç¯ç§»ä½</span><br><span class="line">	nrofSymbols				INTEGER(1..2),	&#x2F;&#x2F;ç¬¦å·ä¸ªæ•°</span><br><span class="line">	startingSymbolIndex		INTEGER(0..13)	 &#x2F;&#x2F;å¼€å§‹ç¬¦å·ç´¢å¼•ï¼Œæ—¶éš™å†…ä»»æ„ä½ç½®</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>NRä¸­ï¼Œä½¿ç”¨PUCCH 0 å‘é€ACK/NACKåé¦ˆï¼ˆ0-NACKï¼Œ1-ACKï¼‰æ—¶ï¼Œä¿¡æ¯bitä¸éœ€è¦ç»è¿‡ç¼–ç â†’è°ƒåˆ¶â†’æ˜ å°„åˆ°ç‰©ç†èµ„æºçš„è¿‡ç¨‹ã€‚<br>é€šè¿‡ACKå’ŒNACKä¿¡æ¯æ¥é€‰æ‹©PUCCHåºåˆ—å¾ªç¯ç§»ä½è¡¨ç¤º, è§[TS 38.213 Table 9.2.3-3(4)]:</p><table><thead><tr><th>HARQ-ACK Value</th><th>0</th><th>1</th></tr></thead><tbody><tr><td>Sequence cyclic shift</td><td>$m_{cs}=0$</td><td>$m_{cs}=6$</td></tr></tbody></table><table><thead><tr><th>HARQ-ACK Value</th><th>{0,0}</th><th>{0,1}</th><th>{1,1}</th><th>{1,0}</th></tr></thead><tbody><tr><td>Sequence cyclic shift</td><td>$m_{cs}=0$</td><td>$m_{cs}=3$</td><td>$m_{cs}=6$</td><td>$m_{cs}=9$</td></tr></tbody></table><p>å½“PUCCH format 0,å¦‚æœåœ¨ä¸€ä¸ªæ—¶éš™å†…ï¼ŒåŒæ—¶ä¼ è¾“HARQ-ACKä¸SRè¯·æ±‚æ—¶å€™$m_{cs}$ä¹Ÿç”±HARQ-ACK bitçš„å†…å®¹ç¡®å®šï¼Œä½†æ˜¯å…¶å–å€¼å’Œä¸Šè¿°è¡¨æ ¼ä¸åŒï¼Œé€šè¿‡$m_{cs}$çš„å–å€¼ï¼Œç½‘ç»œå°±èƒ½è¯†åˆ«PUCCH format 0ä¸Šæ˜¯å¦åŒæ—¶åŒ…å«äº†SRè¯·æ±‚ã€‚</p><table><thead><tr><th>HARQ-ACK Value</th><th>0</th><th>1</th></tr></thead><tbody><tr><td>Sequence cyclic shift</td><td>$m_{cs}=3$</td><td>$m_{cs} = 9$</td></tr></tbody></table><table><thead><tr><th>HARQ-ACK Value</th><th>{0,0}</th><th>{0,1}</th><th>{1,1}</th><th>{1,0}</th></tr></thead><tbody><tr><td>Sequence cyclic shift</td><td>$m_{cs}=1$</td><td>$m_{cs}=4$</td><td>$m_{cs}=7$</td><td>$m_{cs}=10$</td></tr></tbody></table><p><em>initialCyclicShift</em> å†³å®šå‚æ•° $m_0$ã€‚</p><h4 id="1-3-1-2-èµ„æºæ˜ å°„"><a class="header-anchor" href="#1-3-1-2-èµ„æºæ˜ å°„">Â¶</a>1.3.1.2 èµ„æºæ˜ å°„</h4><p>$$<br>x(l\cdot N_{sc}<sup>{RB}+n)=r_{u,v}</sup>{(\alpha,\delta)(n)}\n = 0,1,â€¦,N_{sc}^{RB}-1\l = \begin{cases} 0 \quad\quad for\quad single\quad symbol\quad PUCCH\quad transmision\0,1 \quad for\quad double\quad symbol\quad PUCCH\quad transmision \end{cases}<br>$$</p><p>æ˜ å°„é¡ºåºå…ˆé¢‘åŸŸ $k$ï¼Œåœ¨æ—¶åŸŸ $l$ã€‚<br>PUCCH 0/1/2/3/4 ä½¿ç”¨çš„å¤©çº¿ç«¯å£éƒ½æ˜¯ $p = 2000$</p><h3 id="1-3-2-format-1"><a class="header-anchor" href="#1-3-2-format-1">Â¶</a>1.3.2 format 1</h3><h4 id="1-3-2-1-åºåˆ—ç”Ÿæˆ"><a class="header-anchor" href="#1-3-2-1-åºåˆ—ç”Ÿæˆ">Â¶</a>1.3.2.1 åºåˆ—ç”Ÿæˆ</h4><p>PUCCH 1 å±äºé•¿PUCCHï¼Œåœ¨æ—¶åŸŸå ç”¨ç¬¦å·ä¸ªæ•°4-14ä¸ªï¼Œ<u>æ‰¿è½½çš„ä¿¡æ¯bitæœ€å¤š2ä¸ª</u>ï¼Œç”¨äºHARQçš„ACK/NACKåé¦ˆï¼Œä¹Ÿå¯ä»¥æºå¸¦SRï¼ˆScheduling Rquestï¼Œè°ƒåº¦è¯·æ±‚æœºåˆ¶ï¼‰ä¿¡æ¯ã€‚PUCCH 1 åœ¨é¢‘åŸŸä¸Šå ç”¨1ä¸ªRBã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/5G_Protocol/5G-NR-PUCCH%E5%AD%A6%E4%B9%A0/p2-format1.png" alt></p><p>PUCCH 1 é«˜å±‚ç›¸å…³é…ç½®å‚æ•°</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PUCCH-format 1::&#x3D;			SEQUENCE&#123;</span><br><span class="line">	initialCyclicShift		INTEGER(0..11),	 &#x2F;&#x2F;åˆå§‹å¾ªç¯ç§»ä½</span><br><span class="line">	nrofSymbols				INTEGER(4..14),	 &#x2F;&#x2F;ç¬¦å·ä¸ªæ•°</span><br><span class="line">	startingSymbolIndex		INTEGER(0..10),  &#x2F;&#x2F;å¼€å§‹ç¬¦å·ç´¢å¼•</span><br><span class="line">	timeDomainOCC			INTEGER(0..6)    &#x2F;&#x2F;æ—¶åŸŸOCCé…ç½®</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>PUCCH 1 çš„ACK/NACKåé¦ˆä¿¡æ¯ 1æˆ–è€…2 bits --1 è¡¨ç¤ºACKï¼Œ0è¡¨ç¤ºNACKï¼›åˆ†åˆ«é‡‡ç”¨ $\pi / 2$ BPSK (1 bit) å’Œ QPSK ï¼ˆ2 bitsï¼‰è°ƒåˆ¶ï¼Œè°ƒåˆ¶åä¸ºä¸€ä¸ªå¤å€¼ç¬¦å·ã€‚<br>PUCCH 1 ä½¿ç”¨çš„åºåˆ—å’ŒPUCCH 0 ä¸€æ · $r_{u,v}^{(\alpha , \delta)}(n) = e^{j \alpha n} \cdot \overline r_{u,v}(n),0 \leq n &lt; M_{ZC}$ï¼ŒåŒæ ·æ”¯æŒpucch-GroupHopping é…ç½®ã€‚<br>è°ƒåˆ¶åçš„å¤å€¼ç¬¦å·ï¼Œæ˜ å°„åˆ°åºåˆ—å $y(n) = d(0)\cdot r_{u,v}^{(\alpha , \delta)}(n)$ã€‚</p><h4 id="1-3-2-2-æ­£äº¤åºåˆ—åŠèµ„æºæ˜ å°„"><a class="header-anchor" href="#1-3-2-2-æ­£äº¤åºåˆ—åŠèµ„æºæ˜ å°„">Â¶</a>1.3.2.2 æ­£äº¤åºåˆ—åŠèµ„æºæ˜ å°„</h4><p>å’Œ PUCCH 0ä¸åŒçš„æ˜¯ï¼ŒPUCCH 1æ”¯æŒåŸºäºæ—¶åŸŸæ­£äº¤åºåˆ—çš„å¤ç”¨ã€‚<br>$$<br>z(mâ€™N_{sc}<sup>{RB}N_{SF,0}</sup>{PUCCH,1}+mN_{sc}^{RB}+n)=w_i(m)\cdot y(n)\n = 0,1,â€¦,N_{sc}^{RB}-1\m = 0,1â€¦,N_{SF,mâ€™}^{PUCCH,1}-1\mâ€™=\begin{cases} 0 \quad\quad no\quad intra-slot\quad frequencyhopping\0,1 \quad intra-slot\quad frequencyhopping\quad enabled \end{cases}<br>$$<br>å…¶ä¸­ï¼š</p><ul><li>$z(n)$æ˜ å°„åˆ°ç‰©ç†èµ„æº</li><li>æ­£äº¤åºåˆ—$w_i(m)$ å–å†³äº[TS 38.211 Table 6.3.2.4.1-1~2]ï¼Œä¸‹æ ‡$i$ ç”± <em>timeDomainOCC</em> å†³å®šã€‚</li></ul><p>![](5G-NR-PUCCHå­¦ä¹ /t1-211 6.3.2.4.1-1.png)</p><p>![](5G-NR-PUCCHå­¦ä¹ /t2-211 6.3.2.4.1-2.png)</p><h4 id="1-3-2-3-DMRS"><a class="header-anchor" href="#1-3-2-3-DMRS">Â¶</a>1.3.2.3 DMRS</h4><p>$$<br>z(mâ€™N_{sc}<sup>{RB}N_{SF,0}</sup>{PUCCH,1}+mN_{sc}^{RB}+n)=w_i(m)\cdot r_{u,v}^{(\alpha,\delta)}(n)\n = 0,1,â€¦,N_{sc}^{RB}-1\m = 0,1â€¦,N_{SF,mâ€™}^{PUCCH,1}-1\mâ€™=\begin{cases} 0 \quad\quad no\quad intra-slot\quad frequencyhopping\0,1 \quad intra-slot\quad frequencyhopping\quad enabled \end{cases}<br>$$<br>DMRSç”Ÿæˆæ–¹å¼å’Œformat 1 åŸºæœ¬ç›¸åŒï¼Œä½†æœ‰ä¸¤å¤„å·®åˆ«ï¼š</p><ul><li>æ­£äº¤åºåˆ—åä¹˜çš„ç›´æ¥æ˜¯ä½PAPRåºåˆ—ï¼Œè€Œä¸æ˜¯å¤å€¼å—d(0)</li><li>$N_{SF,mâ€™}^{PUCCH,1}$ å®šä¹‰çš„è¡¨æ ¼ç•¥æœ‰ä¸åŒï¼ŒDMRSé‡‡ç”¨çš„æ˜¯[TS 38.211 Table 6.4.1.3.1.1-1]</li></ul><p>![](5G-NR-PUCCHå­¦ä¹ /t2-211 6.4.1.3.1.1-1.png)</p><p>DMRSèµ„æºæ˜ å°„ï¼š<br>$$<br>\alpha_{k,l}^{p,\mu} = \beta_{PUCCH,1}Z(m)\l=0,2,4â€¦<br>$$<br>ç”±æ­¤å¯çŸ¥ï¼Œformat 1 DMRSæ˜ å°„åœ¨å¶æ•°ç¬¦å·ä½ç½®ï¼Œä»ç¬¦å·0å¼€å§‹ï¼Œç»“æŸä½ç½®å’Œé…ç½®çš„PUCCH 1ç¬¦å·ä¸ªæ•°ç›¸å…³ã€‚</p><h4 id="1-3-2-4-åº”ç”¨ä¸¾ä¾‹"><a class="header-anchor" href="#1-3-2-4-åº”ç”¨ä¸¾ä¾‹">Â¶</a>1.3.2.4 åº”ç”¨ä¸¾ä¾‹</h4><p>å‚æ•°é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nrofSymbols &#x3D; 8ï¼›</span><br><span class="line">no intra-slot frequencyhopping;</span><br><span class="line">intra-slot frequencyhopping enabled;</span><br><span class="line">timeDomainOCC &#x3D; i (å…·ä½“çœ‹è¡¨æ ¼é€‰å–)</span><br></pre></td></tr></table></figure><ol><li>éæ—¶éš™å†…è·³é¢‘</li></ol><p><img src="/5G_Protocol/5G-NR-PUCCH%E5%AD%A6%E4%B9%A0/p3-format1-%E4%BE%8B%E5%AD%901.png" alt></p><ol start="2"><li>æ—¶éš™å†…è·³é¢‘</li></ol><p><img src="/5G_Protocol/5G-NR-PUCCH%E5%AD%A6%E4%B9%A0/p4-format1-%E4%BE%8B%E5%AD%902.png" alt></p><h3 id="1-3-3-format-2"><a class="header-anchor" href="#1-3-3-format-2">Â¶</a>1.3.3 format 2</h3><p>PUCCH 2 åœ¨æ—¶åŸŸä¸Šå ç”¨1-2ä¸ªç¬¦å·ï¼Œåœ¨é¢‘åŸŸä¸Šå¯ä»¥å 1-16ä¸ªRBã€‚PUCCH 2æ—¶åŸŸç¬¦å·å°‘ï¼Œé€‚åˆç”¨äºä½æ—¶å»¶åœºæ™¯ï¼Œæ”¯æŒè¾ƒå¤§ä¿¡æ¯é‡çš„UCIï¼Œå…¶æ—¶é¢‘åŸŸèµ„æºå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/5G_Protocol/5G-NR-PUCCH%E5%AD%A6%E4%B9%A0/p5-format2.png" alt></p><p>format 2 é«˜å±‚ç›¸å…³é…ç½®å‚æ•°å¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PUCCH-format 2::&#x3D;			SEQUENCE&#123;</span><br><span class="line">	nrofPRBs				INTEGER(1..16)	 &#x2F;&#x2F;PRBæ•°</span><br><span class="line">	nrofSymbols				INTEGER(1..2),	 &#x2F;&#x2F;ç¬¦å·ä¸ªæ•°</span><br><span class="line">	startingSymbolIndex		INTEGER(0..13),  &#x2F;&#x2F;å¼€å§‹ç¬¦å·ç´¢å¼•</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="1-3-3-1-æ•°æ®å¤„ç†"><a class="header-anchor" href="#1-3-3-1-æ•°æ®å¤„ç†">Â¶</a>1.3.3.1 æ•°æ®å¤„ç†</h4><p>PUCCH format 2æ•°æ®åœ¨[TS 38.211]çš„å¤„ç†è¿‡ç¨‹ï¼Œå…ˆè¿›è¡ŒåŠ æ‰°ï¼Œè°ƒåˆ¶ï¼Œç„¶åè¿›è¡Œæ—¶é¢‘æ˜ å°„ã€‚<br><strong>1. åŠ æ‰°</strong><br>ç¼–ç åçš„bitsæµï¼š $b(0),â€¦,b(M_{bit}-1)$ï¼Œ$M_{bit}$ ä¸ºç¼–ç åbitsé•¿åº¦<br>åŠ æ‰°å…¬å¼å®šä¹‰å¦‚ä¸‹ï¼š<br>$$<br>\widetilde b(i) = (b(i)+c(i))mod2\c_{init} = n_{RNTI}\cdot 2^{15}+n_{ID}<br>$$<br>å…¶ä¸­$n_{ID}\in {0,1,â€¦,1023}$</p><ul><li>ç”± <em>dataScramblingIdentityPUSCH</em> é…ç½®</li><li>å¦åˆ™ï¼Œ$n_{ID}=N_{ID}^{cell}$</li></ul><p>åŠ æ‰°åçš„è¾“å‡ºbitsæµ ï¼š$\widetilde b(0),â€¦,\widetilde b(M_{bit}-1)$</p><p><strong>2. è°ƒåˆ¶</strong><br>åŠ æ‰°åçš„è¾“å‡ºbitsæµï¼š$\widetilde b(0),â€¦,\widetilde b(M_{bit}-1)$ï¼Œè¿›è¡ŒQPSKè°ƒåˆ¶ã€‚<br>è¾“å‡ºå¤å€¼ç¬¦å·ï¼š$d(0),â€¦,d(M_{symb}-1),M_{symb} = M_{bit}/2$</p><p><strong>3. æ˜ å°„</strong><br>æ˜ å°„åˆ°ç‰©ç†èµ„æºï¼ŒæŒ‰ç…§å…ˆé¢‘åŸŸ$k$ï¼Œåœ¨æ—¶åŸŸ$l$ çš„é¡ºåºï¼Œä¸èƒ½ä½¿ç”¨DMRSèµ„æºã€‚å‚è€ƒä¸‹æ–‡DMRSçš„æ˜ å°„å›¾ç¤ºã€‚</p><h4 id="1-3-3-2-DMRS"><a class="header-anchor" href="#1-3-3-2-DMRS">Â¶</a>1.3.3.2 DMRS</h4><p>PUCCH format 2 DMRSåºåˆ—ä½¿ç”¨çš„ä¸æ˜¯ä½PAPRåºåˆ—ï¼Œæ‰€ä»¥PUCCH format 2ä¸­çš„DMRSåºåˆ—ä¸å…¶ä»–format ä¸­ç›¸å…³çš„$m_0,m_{cs}$ å‚æ•°æ— å…³ã€‚<br>ç”±å¦‚ä¸‹å…¬å¼ç”Ÿæˆåºåˆ—ï¼š<br>$$<br>r_l(m)=\frac{1}{\sqrt{2}}(1-2c(2m))+j\frac{1}{\sqrt{2}}(1-2c(2m+1))\m = 0,1,â€¦\c_{init}=(2<sup>{17}(N_{symb}</sup>{slot}n_{s,f}<sup>{\mu}+l+1)(2N_{ID}</sup>0+1)+2N_{ID}<sup>0)mod2</sup>{31}<br>$$<br>å…¶ä¸­$N_{ID}^0 \in {0,1,â€¦,65535}$ï¼š</p><ul><li>ç”±<em>scramblingID0 in the DMRS-UplinkConfig</em> é…ç½®</li><li>å¦åˆ™ï¼Œ$N_{ID}^0 = N_{ID}^{cell}$</li></ul><p>DMRSåœ¨é¢‘åŸŸçš„æ˜ å°„æ–¹å¼æ˜¯ä¸æ•°æ®åœ¨é¢‘åŸŸè¿›è¡Œå¤ç”¨ã€‚<br>$$<br>\alpha_{k,l}^{(p,\mu)}=\beta_{PUCCH,2}r(m)\k = 3m+1<br>$$<br>è‹¥1RBï¼Œ2 OFDM symbolæƒ…å†µï¼Œåˆ™å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/5G_Protocol/5G-NR-PUCCH%E5%AD%A6%E4%B9%A0/p6-format2-%E4%BE%8B%E5%AD%901.png" alt></p><h3 id="1-3-4-format-3-4"><a class="header-anchor" href="#1-3-4-format-3-4">Â¶</a>1.3.4 format 3/4</h3><p>PUCCH 3 åœ¨æ—¶åŸŸä¸Šå ç”¨4-14ä¸ªç¬¦å·ï¼Œåœ¨é¢‘åŸŸä¸Šå¯ä»¥å ç”¨1-16ä¸ªRBï¼ˆ2/3/5çš„å€æ•°ï¼‰,ç‰©ç†èµ„æºä½ç½®å›¾ç•¥ã€‚<br>PUCCH 4 åœ¨æ—¶åŸŸä¸Šå ç”¨4-14ä¸ªç¬¦å·ï¼Œåœ¨é¢‘åŸŸåªå ç”¨1ä¸ªRBï¼Œç‰©ç†èµ„æºä½ç½®å›¾ç•¥ã€‚<br>$$<br>M_{RB}^{PUCCH,s} = \begin{cases} 2^{\alpha_2}\cdot 3^{\alpha_3}\cdot 5^{\alpha_5}\quad PUCCH\quad format\quad 3\1\quad\quad\quad\quad\quad\quad PUCCH\quad format\quad4 \end{cases}\s \in {3,4}<br>$$<br>PUCCH 3 é«˜å±‚ç›¸å…³é…ç½®å‚æ•°</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PUCCH-format 3::&#x3D;			SEQUENCE&#123;</span><br><span class="line">	nrofPRBs				INTEGER(1..16)	 &#x2F;&#x2F;PRBæ•°</span><br><span class="line">	nrofSymbols				INTEGER(4..14),	 &#x2F;&#x2F;ç¬¦å·ä¸ªæ•°</span><br><span class="line">	startingSymbolIndex		INTEGER(0..10),  &#x2F;&#x2F;å¼€å§‹ç¬¦å·ç´¢å¼•</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“åˆä¸Šé¢çš„å…¬å¼å¯çŸ¥ nrofPRBs $\in {1,2,3,4,5,6,8,9,10,12,15,16}$</p><p>PUCCH 4 é«˜å±‚ç›¸å…³é…ç½®å‚æ•°</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PUCCH-format 4::&#x3D;			SEQUENCE&#123;</span><br><span class="line">	nrofSymbols				INTEGER(4..14),	         &#x2F;&#x2F;ç¬¦å·ä¸ªæ•°</span><br><span class="line">	occ-Length				ENUMERATED&#123;n2,n4&#125;,       &#x2F;&#x2F;æ­£äº¤ç ä¸ªæ•°</span><br><span class="line">	occ-Index				ENUMERATED&#123;n0,n1,n2,n3&#125;, &#x2F;&#x2F;æ­£äº¤ç ç´¢å¼•</span><br><span class="line">	startingSymbolIndex		INTEGER(0..10),          &#x2F;&#x2F;å¼€å§‹ç¬¦å·ç´¢å¼•</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="1-3-4-1-æ•°æ®å¤„ç†"><a class="header-anchor" href="#1-3-4-1-æ•°æ®å¤„ç†">Â¶</a>1.3.4.1 æ•°æ®å¤„ç†</h4><p>PUCCH 3/4 çš„æ•°æ®å¤„ç†éƒ¨åˆ†ï¼Œä¸»è¦æ˜¯[TS 38.211]ä¸­çš„å¤„ç†è¿‡ç¨‹ã€‚<br>PUCCH 3/4 UCIç»è¿‡ç¼–ç ï¼ŒåŠ æ‰°ï¼Œè°ƒåˆ¶ï¼Œåˆ†å—ä¼ æ’­ ï¼Œå˜æ¢é¢„ç¼–ç ï¼Œæ˜ å°„ã€‚ï¼ˆformat 3 æ²¡æœ‰ç»è¿‡Block-wise spreading æµç¨‹ï¼Œä¹Ÿå°±æ˜¯ä¸æ”¯æŒOCCï¼Œformat 4 æ”¯æŒï¼‰</p><p><strong>1. åŠ æ‰°</strong><br>ç¼–ç åçš„bitsæµï¼š $b(0),â€¦,b(M_{bit}-1)$ï¼Œ$M_{bit}$ ä¸ºç¼–ç åbitsé•¿åº¦<br>åŠ æ‰°å…¬å¼å®šä¹‰å¦‚ä¸‹ï¼š<br>$$<br>\widetilde b(i) = (b(i)+c(i))mod2\c_{init} = n_{RNTI}\cdot 2^{15}+n_{ID}<br>$$<br>å…¶ä¸­$n_{ID}\in {0,1,â€¦,1023}$</p><ul><li>ç”± <em>dataScramblingIdentityPUSCH</em> é…ç½®</li><li>å¦åˆ™ï¼Œ$n_{ID}=N_{ID}^{cell}$</li></ul><p>åŠ æ‰°åçš„è¾“å‡ºbitsæµ ï¼š$\widetilde b(0),â€¦,\widetilde b(M_{bit}-1)$</p><p><strong>2. è°ƒåˆ¶</strong><br>åŠ æ‰°åçš„è¾“å‡ºbitsæµï¼š$\widetilde b(0),â€¦,\widetilde b(M_{bit}-1)$ï¼Œé»˜è®¤QPSKè°ƒåˆ¶ï¼Œè‹¥é…ç½®$\pi /2$-BPSKï¼Œåˆ™ä½¿ç”¨$\pi /2$-BPSKã€‚<br>è¾“å‡ºå¤å€¼ç¬¦å·ï¼š$d(0),â€¦,d(M_{symb}-1)$ï¼Œå¯¹äºQPSKï¼š $M_{symb} = M_{bit}/2$ï¼Œå¯¹äº$\pi /2$-BPSKï¼š$M_{symb} = M_{bit}$</p><p><strong>3. åˆ†å—ä¼ æ’­</strong><br>å¯¹äºformat 3 ï¼Œä¸åº”ç”¨Block-wise spreading ï¼š<br>$$<br>y(lM_{sc}<sup>{PUCCH,3}+k)=d(lM_{sc}</sup>{PUCCH,3}+k)\k =0,1,â€¦,M_{sc}<sup>{PUCCH,3}-1\l=0,1,â€¦,(M_{symb}/M_{sc}</sup>{PUCCH,3})-1\N_{SF}^{PUCCH,3} = 1<br>$$<br>å¯¹äºformat 4ï¼Œåº”æ ¹æ®æ•°æ®åº”ç”¨ Block-wise spreading ï¼š<br>$$<br>y(lM_{sc}^{PUCCH,4}+k)=w_{n}(k)\cdot d(l\frac{M_{sc}<sup>{PUCCH,4}}{N_{SF}</sup>{PUCCH,4}}+kmod\frac{M_{sc}<sup>{PUCCH,4}}{N_{SF}</sup>{PUCCH,4}})\k =0,1,â€¦,M_{sc}<sup>{PUCCH,4}-1\l=0,1,â€¦,(N_{SF}</sup>{PUCCH,4}M_{symb}/M_{sc}^{PUCCH,4})-1<br>$$<br>å…¶ä¸­ï¼š</p><ul><li>$M_{RB}^{PUCCH,4} = 1,N_{SF}^{PUCCH,4} \in {2,4}$</li><li>$w_n$ ç”±[TS 38.211 Table 6.3.2.6.3-1~2]ç»™å‡º</li><li>n ç”± <em>occ-Index</em> ç»™å‡ºï¼Œå½“<em>occ-Length</em> = 2æ—¶ï¼Œ<em>occ-Index</em>å¯ä»¥é…ç½®0ï¼Œ1ï¼›å½“<em>occ-Length</em> = 4æ—¶ï¼Œocc-Indexå¯ä»¥é…ç½®0ï¼Œ1ï¼Œ2ï¼Œ3ã€‚</li></ul><p>![](5G-NR-PUCCHå­¦ä¹ /t4-211 6.3.2.6.3-1~2.png)</p><p><strong>4. å˜æ¢é¢„ç¼–ç </strong><br>å› ä¸ºformat 3 åœ¨é¢‘åŸŸå¯èƒ½æ”¯æŒæœ‰å¤šä¸ªPRBåˆ†é…ï¼Œä¸ºäº†é™ä½PAPRï¼Œéœ€è¦è¿›è¡ŒTransform precodingï¼Œå³é‡‡ç”¨DFT-s-OFDM<br>å¤å€¼ç¬¦å·å—ï¼š$y(0),â€¦,y(N_{SF}^{PUCCH ,s}M_{symb}-1)$ ï¼Œæ ¹æ®å¦‚ä¸‹å…¬å¼è¿›è¡Œé¢„ç¼–ç ï¼š<br>$$<br>z(l \cdot M_{sc}<sup>{PUCCH,s}+k)=\frac{1}{\sqrt{M_{sc}</sup>{PUCCH,s}}}\sum_{m=0}<sup>{M_{sc}</sup>{PUCCH,s}-1}y(l \cdot M_{sc}<sup>{PUCCH,s}+m)e</sup>{-j\frac{2\pi mk}{M_{sc}^{PUCCH,s}}}\k =0,1,â€¦,M_{sc}<sup>{PUCCH,4}-1\l=0,1,â€¦,(N_{SF}</sup>{PUCCH,s}M_{symb}/M_{sc}^{PUCCH,s})-1<br>$$<br>å˜æ¢é¢„ç¼–ç åè¾“å‡ºï¼š$z(0),â€¦,z(N_{SF}^{PUCCH,s}M_{sybm}-1)$</p><p><strong>5. æ˜ å°„</strong><br>å˜æ¢é¢„ç¼–ç åçš„å¤å€¼ç¬¦å·æ˜ å°„åˆ°ç‰©ç†èµ„æºï¼Œ$\alpha_{k,l}^{(p,\mu)}=\beta_{PUCCH,s}r(m)$ï¼ŒæŒ‰ç…§å…ˆé¢‘åŸŸ $k$ï¼Œåœ¨æ—¶åŸŸ $l$ çš„é¡ºåºï¼Œä¸èƒ½ä½¿ç”¨DMRSèµ„æºã€‚å…·ä½“æ˜ å°„å›¾å‚è€ƒä¸‹æ–‡DMRSæ˜ å°„éƒ¨åˆ†ã€‚<br>PUCCH 3ï¼Œ4 éƒ½æ”¯æŒæ—¶éš™å†…è·³é¢‘ã€‚</p><h4 id="1-3-4-2-DMRS"><a class="header-anchor" href="#1-3-4-2-DMRS">Â¶</a>1.3.4.2 DMRS</h4><p>PUCCH 4 DMRSä½¿ç”¨ä½PAPRåºåˆ— $r_{u,v}^{(\alpha , \delta)}(n) = e^{j \alpha n} \cdot \overline r_{u,v}(n),0 \leq n &lt; M_{ZC}$ã€‚<br>PUCCH 3 DMRS ä¹Ÿä½¿ç”¨ä½PAPRåºåˆ— $r_{u,v}^{(\alpha , \delta)}(n) = e^{j \alpha n} \cdot \overline r_{u,v}(n),0 \leq n &lt; M_{ZC}$ï¼Œä½†ä¸ format 0/1/4 ä¸åŒçš„æ˜¯ï¼Œformat 3 åœ¨é¢‘åŸŸå¯ä»¥é…ç½®å¤šä¸ªPRBï¼Œæ‰€ä»¥åºåˆ—é•¿åº¦ $M_{ZC}$ å¯å˜ã€‚å…·ä½“æƒ…å†µå‚è€ƒå‰æ–‡ä½PAPRåºåˆ—æè¿°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºPUCCH 3ï¼š$m_0 = 0,m_{cs} = 0$ã€‚å¯¹äºPUCCH 4ï¼Œå…¶$m_{cs}=0ï¼Œm_0$ å–å†³äº[TS 38.311 Table 6.4.1.3.3.1-1]ä¸­ï¼Œå¦‚ä¸‹ã€‚</p><p>![](5G-NR-PUCCHå­¦ä¹ /t5-211 6.4.1.3.3.1-1.png)</p><p><strong>1. format 3/4 çš„DMRSåºåˆ—</strong><br>$$<br>r_l(m) = r_{u,v}^{(\alpha , \delta)}(m)\m=0,1,â€¦,M_{sc}^{PUCCH,s}-1<br>$$<br><strong>2. æ˜ å°„åˆ°ç‰©ç†èµ„æº</strong><br>$$<br>\alpha_{k,l}^{(p,\mu)}=\beta_{PUCCH,s}r(m)\m = 0,1,â€¦,M_{sc}^{PUCCH,s}-1<br>$$<br>$l$ çš„ä½ç½®å®šä¹‰å¦‚ä¸‹ï¼šadditional DM-RS ç”±é«˜å±‚å‚æ•°é…ç½®ï¼Œå‚è€ƒ[TS 38.211 Table 6.4.1.3.3.2-1]ï¼Œå¦‚ä¸‹ï¼š</p><p>![](5G-NR-PUCCHå­¦ä¹ /t6.211 6.4.1.3.3.2-1.png)</p><p>è‹¥ï¼Œformat 4ï¼ŒPUCCH length = 14 ï¼›èµ„æºæ˜ å°„å¦‚ä¸‹å›¾ï¼š</p><p><img src="/5G_Protocol/5G-NR-PUCCH%E5%AD%A6%E4%B9%A0/p7-format34.png" alt></p><h3 id="1-4-æ ¼å¼æ€»ç»“"><a class="header-anchor" href="#1-4-æ ¼å¼æ€»ç»“">Â¶</a>1.4 æ ¼å¼æ€»ç»“</h3><p>å„ç§æ ¼å¼çš„é…ç½®æƒ…å†µæ€»ç»“å¦‚ä¸‹å›¾æ‰€ç¤ºï¼šå›¾ç‰‡æ‘˜è‡ª ShareTechnote</p><p><img src="/5G_Protocol/5G-NR-PUCCH%E5%AD%A6%E4%B9%A0/p8-%E6%A0%BC%E5%BC%8F%E6%80%BB%E7%BB%93.png" alt></p><h1>2 PUCCH èµ„æº</h1><h2 id="2-1-PUCCH-èµ„æºç¡®å®š"><a class="header-anchor" href="#2-1-PUCCH-èµ„æºç¡®å®š">Â¶</a>2.1 PUCCH èµ„æºç¡®å®š</h2><h2 id="2-2-PUCCH-èµ„æºé›†é€‰æ‹©"><a class="header-anchor" href="#2-2-PUCCH-èµ„æºé›†é€‰æ‹©">Â¶</a>2.2 PUCCH èµ„æºé›†é€‰æ‹©</h2><p>è¿˜æ²¡çœ‹å®Œï¼Œæ²¡æ¥å¾—åŠæ€»ç»“</p><blockquote><p>å‚è€ƒæ–‡çŒ®<br>å…¬ä¼—å·ï¼šæ˜¥å¤©å·¥ä½œå®¤ï¼Œ5Gèœé¸Ÿæˆé•¿æ—¥è®°<br>ç½‘é¡µï¼š<a href="https://mp.weixin.qq.com/s/83D25ABb2YURSbLQ3fOYsg" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/83D25ABb2YURSbLQ3fOYsg</a><br>ç½‘é¡µï¼š<a href="http://www.sharetechnote.com/html/5G/5G_PUCCH.html" target="_blank" rel="noopener">http://www.sharetechnote.com/html/5G/5G_PUCCH.html</a><br>åšå®¢ï¼š<a href="https://blog.csdn.net/bluewhu/article/details/104196665" target="_blank" rel="noopener">https://blog.csdn.net/bluewhu/article/details/104196665</a><br>åšå®¢ï¼š<a href="https://blog.csdn.net/m0_45416816/article/details/104968797" target="_blank" rel="noopener">https://blog.csdn.net/m0_45416816/article/details/104968797</a></p></blockquote><!-- rebuild by neat -->]]></content>
      <categories>
        <category>5G_Protocol</category>
      </categories>
      <tags>
        <tag>PUCCH</tag>
      </tags>
  </entry>
  <entry>
    <title>5G-NR-PRACHå­¦ä¹ </title>
    <url>/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<!-- build time:Tue Jun 22 2021 17:02:33 GMT+0800 (GMT+08:00) --><a id="more"></a><h1>1 PRACH ä¿¡é“</h1><h2 id="1-1-PRACH-preamble-ç”Ÿæˆ"><a class="header-anchor" href="#1-1-PRACH-preamble-ç”Ÿæˆ">Â¶</a>1.1 PRACH preamble ç”Ÿæˆ</h2><p>LTEç³»ç»Ÿä¸­ä½¿ç”¨Zaddof-Chu (ZC) åºåˆ—ä½œä¸ºPRACHä¿¡é“çš„ä¸Šè¡ŒåŒæ­¥åºåˆ—ï¼Œå› ä¸ºå…¶å…·æœ‰è‰¯å¥½çš„<strong>è‡ªç›¸å…³</strong>å’Œ<strong>äº’ç›¸å…³æ€§</strong>ï¼Œ<strong>æ’å¹…ä½å³°å‡æ¯”</strong>ç­‰ç‰¹æ€§ã€‚</p><p>â‘ <strong>è‡ªç›¸å…³</strong>ï¼šå¯¹äºä»»æ„ZCåŸå§‹åºåˆ—ä¸å…¶å¾ªç¯ç§»ä½nä½åæ‰€å¾—åˆ°çš„åºåˆ—äº’ä¸ç›¸å…³ï¼›<br>â‘¡<strong>äº’ç›¸å…³</strong>ï¼šäº’ç›¸å…³å’Œéƒ¨åˆ†ç›¸å…³å€¼æ¥è¿‘é›¶ï¼Œä¾¿äºæ¥æ”¶ç«¯å‡†ç¡®åœ°æŠŠæ‰€éœ€çš„ä¿¡å·æ£€æµ‹å‡ºæ¥ï¼›<br>â‘¢<strong>æ’å¹…ä½å³°å‡æ¯”</strong>ï¼šä¿è¯ç›¸åº”å¸¦å®½å†…çš„æ¯ä¸ªé¢‘ç‚¹ç»ç†ç›¸åŒçš„æ¿€åŠ±ï¼Œä¾¿äºå®ç°æƒ³å¹²æ£€æµ‹ä¸­çš„æ— åä¼°è®¡ï¼›<br>åœ¨PRACHä¿¡é“ä¸Šå‘é€çš„ZCåºåˆ—ï¼Œä¹Ÿè¢«ç§°ä¸ºPRACH Preambleï¼Œå‰å¯¼ç ã€‚LTEæ”¯æŒä¸¤ç§é•¿åº¦çš„ZCåºåˆ—ï¼Œæ ¹æ®æ ¹ç´¢å¼•åºåˆ—ï¼Œé€šè¿‡å¾ªç¯ç§»ä½ç”Ÿæˆå¤šä¸ªåºåˆ—<br>$$<br>N_{ZC} = 839\N_{ZC} = 139<br>$$<br>NR ä¸­çš„PRACHä¿¡é“æ²¿ç”¨äº†LTEçš„ZCåºåˆ—è®¾è®¡ï¼Œæ”¯æŒä¸¤ç§é•¿åº¦ZCåºåˆ—ï¼Œå’ŒLTEä¸€è‡´ï¼Œä¹Ÿé€šè¿‡å¾ªç¯ç§»ä½ç”Ÿæˆå¤šä¸ªåºåˆ—ï¼Œåªæ˜¯ç¬¦å·åç§°ä¸åŒï¼Œå«ä¹‰éƒ½æ˜¯ç›¸åŒçš„ã€‚<br>$$<br>L_{RA} = 839\L_{RA} = 139<br>$$</p><p>ZC åºåˆ—å®šä¹‰ï¼š$x_u(i) = e^{-j \frac{\pi u(i+1)}{L_{RA}}},i = 0,1,â€¦,L_{RA}-1$</p><p>ç»è¿‡å¾ªç¯ç§»ä½åï¼ŒZCåºåˆ—é›†åˆä¸ºï¼š$x_{u,v}(n)=x_u((n+C_v)modL_{RA})$</p><p>å…·ä½“çš„ç”Ÿæˆæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤º:<br><br><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p1-preamble%E7%94%9F%E6%88%90.png" alt></p><p>ä¸¾ä¾‹è¯´æ˜ï¼Œå‚æ•°å¦‚ä¸‹ï¼š<br><em>prach-ConfigurationIndex</em> 2<br><em>zeroCorrelationZoneConfig</em> = 6<br><em>restrictedSetConfig</em> <em>unrestrictedSet</em><br><em>prach-RootSequenceIndex</em> l839 : 20</p><p>é¦–å…ˆæ ¹æ® <em>prach-ConfigurationIndex 2</em> ï¼ŒæŸ¥è¡¨[TS 38.211 Table 6.3.3.2-2] å¯çŸ¥ Format 0 å³long symbol ç±»å‹ï¼Œä¹Ÿå°±æ˜¯$L_{RA} = 839$, ä¹‹åæŸ¥è¡¨[TS 38.211 Table 6.3.3.1-3]<br>æ ¹æ® <em>prach-RootSequenceIndex</em> l839 : 20 å¯çŸ¥ï¼š$u = 2$ , å¹¶é€šè¿‡ZCåºåˆ—å®šä¹‰å…¬å¼ç”Ÿæˆ$x_2(n)$åºåˆ—ã€‚</p><p><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T4-38.211-6.3.3.1-3(4)%E5%89%AF%E6%9C%AC.png" alt></p><p>ç”± <em>zeroCorrelationZoneConfig</em> = 6ï¼›<em>restrictedSetConfig unrestrictedSet</em>ã€‚<br>æŸ¥è¡¨[TS 38.211 Table 6.3.3.1-1]å¯çŸ¥$\Delta f_{RA} = 1.25$KHz<br>å†æŸ¥è¡¨[TS 38.211 6.3.3.1-5]å¯çŸ¥$N_{CS} = 32$ã€‚</p><p><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/Inked38.211-6.3.3.1-5_LI.jpg" alt></p><p>æ ¹æ®å…¬å¼å¯çŸ¥$v = 0,1,â€¦,\lfloor L_{RA}/N_{CS} \rfloor - 1 = 0,1,â€¦,\lfloor 839/32 \rfloor -1 = 0,1,â€¦,25$ï¼Œæ‰€ä»¥$C_v = v \cdot N_{CS} = v \cdot 32 = [0,32,64,â€¦,800]$ï¼Œè¿™æ ·å¯ä»¥è·å¾— $x_2(n)$ çš„26ç§å¾ªç¯ç§»ä½åçš„åºåˆ—ï¼Œä¹Ÿå°±æ˜¯è·å¾—äº†26ä¸ªpreamble åºåˆ—ã€‚</p><p>å› ä¸º 26 &lt; 64ï¼Œæ‰€ä»¥æ ¹ç´¢å¼•ä¼šé€’å¢ä¸º <em>prach-RootSequenceIndex</em> l839 : 21ï¼Œå¯¹åº”çš„$u = 837$ï¼Œæ“ä½œä¸ä¸Šæ–‡ç›¸åŒï¼Œåˆå¯ä»¥ç”Ÿæˆ26ä¸ªpreambleåºåˆ—ã€‚<br>å› ä¸º 52 &lt; 64ï¼Œæ‰€ä»¥æ ¹ç´¢å¼•ä¼šé€’å¢ä¸º <em>prach-RootSequenceIndex</em> l839 : 22ï¼Œå¯¹åº”çš„$u = 1$ï¼Œæ“ä½œä¸ä¸Šæ–‡ç›¸åŒï¼Œè¿™æ¬¡åªç”¨ç”Ÿæˆ12ä¸ªpreambleåºåˆ—å³å¯ã€‚</p><p>ç»è¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œå°±è·å¾—äº†64ä¸ªpreambleåºåˆ—ï¼Œå¯¹å…¶åšDFTå°±æ˜¯å…¶é¢‘åŸŸè¡¨è¾¾ã€‚</p><h2 id="1-2-PRACH-preamble-æ ¼å¼"><a class="header-anchor" href="#1-2-PRACH-preamble-æ ¼å¼">Â¶</a>1.2 PRACH preamble æ ¼å¼</h2><p>Preambleæ€»ä½“ä¸Šåˆ†ä¸ºä¸¤å¤§ç±»ï¼Œlong preambleå’Œshort preambleï¼Œåˆ†åˆ«å¯¹åº”$L_{RA} = 839,L_{RA} = 139$ã€‚å…¶ä¸­long preambleåˆ†ä¸ºå››ç§Format,åˆ†åˆ«ä¸ºFormat 0/1/2/3ï¼Œshort preambleåˆ†ä¸ºä¹ç§A1/A2/A3/B1/B2/B3/B4/C0/C2ã€‚é…ç½®å¦‚ä¸‹è¡¨æ‰€ç¤º:</p><p><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T1-38.211-6.3.3.1-1.png" alt></p><p><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T2-38.211-6.3.3.1-2.png" alt></p><p>éœ€è¦çš„ä¸€äº›åŸºç¡€å‚æ•°å¦‚ä¸‹ï¼š<br>$$<br>T_c = 1/(\Delta f_{max}\cdot N_f) = 1/(480\times 10^3\cdot 4096) = 0.509ns = 0.509\times10^{-6}ms\T_s = 1/(\Delta f_{ref}\cdot N_{f,ref}) = 1/(15\times 10^3\cdot 2048) = 32.552ns = 32.552\times10^{-6}ms\K = \frac{T_s}{T_c} = 64<br>$$</p><p>Preambleç»“æ„ä¸€èˆ¬ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šCyclic Prefix(CP) + Preamble Sequence (é‡å¤) + Guard Period(GP)ï¼Œå…¶ä¸­æ ¸å¿ƒéƒ¨åˆ†preamble sequenceå¯èƒ½é‡å¤å¤šæ¬¡ï¼Œå–å†³äºä¸åŒçš„Formatã€‚</p><table><tr><td><center></center></td><td><center>PRACH preamble æ ¼å¼</center></td><td><center>ç‰¹ç‚¹</center></td></tr><tr><th rowspan="4"><center>long preamble</center></th><td><center>Format 0</center></td><td><center>æ—¶é•¿1ms; ç”¨äºæ™®é€šåœºæ™¯</center></td></tr><tr><td><center>Format 1</center></td><td><center>æ—¶é•¿3ms; ç”¨äºè¶…è¿œè·ç¦»è¦†ç›–åœºæ™¯</center></td></tr><tr><td><center>Format 2</center></td><td><center>æ—¶é•¿3.5ms; å…¶ä¸­sequenceé‡å¤å‘é€4æ¬¡,ç”¨äºéœ€è¦è¦†ç›–å¢å¼ºåœºæ™¯(å¦‚å®¤å†…)</center></td></tr><tr><td><center>Format 3</center></td><td><center>æ—¶é•¿1ms; ç”¨äºé«˜é€Ÿç§»åŠ¨åœºæ™¯</center></td></tr><tr><th rowspan="3"><center>short preamble</center></th><td><center>Format A1/A2/A3</center></td><td><center>æ—¶é•¿å’Œ2,4,6ä¸ªOFDMç¬¦å·å¯¹é½; æ²¡æœ‰GAP; ç”¨äºè¦†ç›–è·ç¦»è¾ƒè¿‘,UEä½ç½®é›†ä¸­çš„åœºæ™¯</center></td></tr><tr><td><center>Format B1/B2/B3/B4</center></td><td><center>æ—¶é•¿å’Œ2,4,6,12ä¸ªOFDMç¬¦å·å¯¹é½; æœ‰GAP</center></td></tr><tr><td><center>Format C0/C2</center></td><td><center>æ—¶é•¿å’Œ2,6ä¸ªOFDMç¬¦å·å¯¹é½; æœ‰GAP,ä¸”ç›¸å¯¹äºå…¶ä»–ç±»å‹è¾ƒé•¿; ç”¨äºè¾ƒè¿œè·ç¦»åœºæ™¯</center></td></tr></table><p>ä»¥ä¸‹ä¸ºå„ç§æ ¼å¼çš„ç»†èŠ‚:<strong>å›¾ç‰‡æ‘˜è‡ªShareTechnote</strong></p><p><strong>long preamble åˆ†ä¸ºå››ç§ Format , åˆ†åˆ«ä¸º Format 0/1/2/3</strong></p><p>Format 0:</p><p>![](5G-NR-PRACHå­¦ä¹ /p2-Format 0.png)</p><p>Format 1:</p><p>![](5G-NR-PRACHå­¦ä¹ /p3-format 1.png)</p><p>Format 2:</p><p><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/format2.png" alt></p><p>Format 3:</p><p>![](5G-NR-PRACHå­¦ä¹ /p5-format 3.png)</p><p><strong>short preamble åˆ†ä¸ºä¹ç§ Format A1/A2/A3/B1/B2/B3/B4/C0/C2</strong></p><p>æ ¼å¼ A æ²¡æœ‰å®šä¹‰GAPï¼Œé€‚ç”¨äºè¦†ç›–è·ç¦»è¾ƒè¿‘ï¼ŒUEä½ç½®é›†ä¸­çš„åœºæ™¯</p><p>Format A1: PRACHæ—¶é•¿å’Œ <strong>2 OFDM symbol</strong> å¯¹é½</p><p>![](5G-NR-PRACHå­¦ä¹ /p6-format A1.png)</p><p>Format A2: PRACHæ—¶é•¿å’Œ <strong>4 OFDM symbol</strong> å¯¹é½</p><p>![](5G-NR-PRACHå­¦ä¹ /p7-format A2.png)</p><p>Format A3: PRACHæ—¶é•¿å’Œ <strong>6 OFDM symbol</strong> å¯¹é½</p><p>![](5G-NR-PRACHå­¦ä¹ /p8-format A3.png)</p><p>æ ¼å¼B å®šä¹‰äº†GAP</p><p>Format B1: PRACHæ—¶é•¿å’Œ **2 OFDM symbol **å¯¹é½</p><p>![](5G-NR-PRACHå­¦ä¹ /p9-format B1.png)</p><p>Format B2: PRACHæ—¶é•¿å’Œ **4 OFDM symbol **å¯¹é½</p><p>![](5G-NR-PRACHå­¦ä¹ /p10-format B2.png)</p><p>Format B3: PRACHæ—¶é•¿å’Œ <strong>6 OFDM symbol</strong> å¯¹é½</p><p>![](5G-NR-PRACHå­¦ä¹ /p11-format B3.png)</p><p>Format B4: PRACHæ—¶é•¿å’Œ <strong>12 OFDM symbol</strong> å¯¹é½</p><p>![](5G-NR-PRACHå­¦ä¹ /p12-format B4.png)</p><p>æ ¼å¼C å®šä¹‰äº†GAPï¼Œä¸”GAPä¿æŠ¤æ—¶é•¿è¾ƒå¤§ï¼Œé€‚ç”¨äºè¦†ç›–è·ç¦»è¾ƒè¿œçš„åœºæ™¯</p><p>Format C0: PRACHæ—¶é•¿å’Œ <strong>2 OFDM symbol</strong> å¯¹é½</p><p>![](5G-NR-PRACHå­¦ä¹ /p-13format C0.png)</p><p>Format C2: PRACHæ—¶é•¿å’Œ <strong>6 OFDM symbol</strong> å¯¹é½</p><p>![](5G-NR-PRACHå­¦ä¹ /p14-format C2.png)</p><p>è¡¥å……ï¼š å¦‚æœPRACH FormatæŒ‡ç¤ºä¸º A1/B1ï¼ŒA2/B2ï¼ŒA3/B3ï¼ˆæ··åˆæ ¼å¼ï¼‰æ—¶ï¼Œåˆ™ä¸€ä¸ªPRACHæ—¶éš™ä¸­æœ€åä¸€ä¸ªPRACH Occasion ä¸ºFormat B1/B2/B3ï¼Œä¸€ä¸ªPRACHæ—¶éš™ä¸­ï¼Œå‰é¢ä½ç½®çš„PRACH Occasionä¸ºFormat A1/A2/A3ã€‚ï¼ˆFormat A1/2/3ï¼ŒB1/2/3æ—¶é•¿ä¸€è‡´(2/4/6 OFDM ç¬¦å·)ï¼Œå·®åˆ«åœ¨äºCPå’ŒGAPé•¿åº¦ï¼ŒFormat A æ— GAPï¼‰</p><h2 id="1-3-æ˜ å°„åˆ°ç‰©ç†èµ„æº"><a class="header-anchor" href="#1-3-æ˜ å°„åˆ°ç‰©ç†èµ„æº">Â¶</a>1.3 æ˜ å°„åˆ°ç‰©ç†èµ„æº</h2><p>PRACHä¿¡é“æ—¶åŸŸä¿¡å·å®šä¹‰å¦‚ä¸‹ï¼š<br>$$<br>s_l<sup>{(p,\mu)}(t)=\sum_{k=0}</sup>{L_{RA}-1}{a_k}^{(p,RA)}\cdot e^{j2\pi(k+Kk_1+\overline k)\Delta f_{RA}(t-N_{CP,l}<sup>{RA}T_c-t_{start}</sup>{RA})}\K = \Delta f/\Delta f_{RA}\k_1 = k_0<sup>\mu+N_{BWP,i}</sup>{start}N_{sc}<sup>{RB}+n_{RA}N_{RB}</sup>{RA}N_{sc}<sup>{RB}-N_{grid}</sup>{size,\mu}N_{sc}<sup>{RB}/2\k_0</sup>\mu = (N_{grid}<sup>{start,\mu}+N_{grid}</sup>{size,\mu}/2)N_{sc}<sup>{RB}-(N_{grid}</sup>{start,\mu_0}+N_{grid}<sup>{size,\mu_0}/2)N_{sc}</sup>{RB}2^{\mu_0-\mu}<br>$$</p><p>å…¶ä¸­ $t_{start}^{RA}\leq t &lt;t_{start}<sup>{RA}+(N_u+N_{CP,l}</sup>{RA})T_c$<br>$\alpha_k^{(p,RA)} = \beta_{PRACH}\cdot y_{u,v}(k)$</p><p>$t_{start}^{RA}$ è¡¨ç¤ºPRACH preamble</p><ul><li>åœ¨ä¸€ä¸ªå­å¸§ä¸­çš„å¼€å§‹ä½ç½® â€” ï¼ˆ $\Delta f_{RA} \in {1.25,5,15,30}$KHz ï¼‰</li><li>æˆ–è€…åœ¨ä¸€ä¸ª60 KHzçš„æ—¶éš™ä¸­çš„ä½ç½® â€” ï¼ˆ $\Delta f_{RA} \in {60ï¼Œ120}$KHz ï¼‰</li></ul><h3 id="1-3-1-æ—¶åŸŸèµ„æºæ˜ å°„"><a class="header-anchor" href="#1-3-1-æ—¶åŸŸèµ„æºæ˜ å°„">Â¶</a>1.3.1 æ—¶åŸŸèµ„æºæ˜ å°„</h3><p>ä»å…¬å¼ç€æ‰‹ï¼š<br>$$<br>t_{start}^{RA} = t_{start,l}^\mu \t_{start,l}^{\mu} = \begin {cases} 0 \quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad l = 0\ t_{start,l-1}^\mu +(N_u^\mu + N_{CP,l-1}^{\mu})T_c \quad \quad otherwise \end{cases}<br>$$</p><p>ç¬¦å·ä½ç½®$l$ , $l = l_0+n_t<sup>{RA}N_{dur}</sup>{RA}+14n_{slot}^{RA}$</p><p>å…¶ä¸­ï¼š</p><ul><li>$l_0$ ä¸ºèµ·å§‹ç¬¦å·ä½ç½®ï¼Œæ ¹æ®é…ç½®è¡¨æ ¼è·å¾—</li><li>$n_t^{RA}$ ä¸ºä¸€ä¸ªPRACHæ—¶éš™å†…çš„PRACHå‘é€æ—¶åˆ»ï¼Œ$n_t^{RA} \in {0,â€¦,N_t^{RA,slot}-1}$, $L_{RA}= 839$ æ—¶å›ºå®šä¸º1, $L_{RA} = 139$ æ—¶æ ¹æ®é…ç½®è¡¨æ ¼å¾—åˆ°</li><li>$N_{dur}^{RA}$ æ ¹æ®PRACHé…ç½®ç´¢å¼•è¡¨æ ¼å¾—åˆ°ï¼Œå’Œå„è‡ªæ ¼å¼å¯¹åº”</li><li>$\Delta f_{RA} \in {1.25,5}$KHz $\mu = 0$ , å…¶ä»–æƒ…å†µä¸‹ï¼Œ$\mu$æŒ‰ç…§å­è½½æ³¢é—´éš”é…ç½®</li><li>$n_{slot}^{RA}$ : â‘  $\Delta f_{RA} \in {1.25,5,15,60}$KHz æ—¶ï¼Œ$n_{slot}^{RA} = 0$ ã€‚â‘¡ $\Delta f_{RA} \in {30,120}$KHz æ—¶ï¼Œæ ¹æ®é…ç½®è¡¨æ ¼å¾—åˆ°(å€’æ•°ç¬¬ä¸‰åˆ—)ï¼Œå¦‚æœé…ç½®ä¸º1ï¼Œåˆ™$n_{slot}^{RA} = 1$ ã€‚â‘¢ å…¶ä»–æƒ…å†µï¼Œ$n_{slot}^{RA}\in {0,1}$</li></ul><p>ä»¥ä¸Šé…ç½®è¡¨æ ¼å‚è€ƒåè®®ä¸­çš„è¡¨æ ¼ï¼Œè§é™„å½•</p><blockquote><p>[TS 38.211 Table 6.3.3.2-2]<br>[TS 38.211 Table 6.3.3.2-3]<br>[TS 38.211 Table 6.3.3.2-4]</p></blockquote><p>å¯¹äºæ—¶åŸŸèµ„æºçš„æ˜ å°„ï¼Œåªéœ€è¦çŸ¥é“åˆå§‹ç¬¦å·ä½ç½®å³å¯ï¼Œåº”ä¸ºç‰¹å®šçš„Formatå¯¹åº”çš„preambleæ—¶åŸŸæ—¶é•¿æ—¶ç¡®å®šçš„ã€‚</p><p>ç¤ºä¾‹è¯´æ˜ï¼š<em>prach-ConfigurationIndex</em> = 103ï¼ŒæŸ¥è¡¨å¯çŸ¥å‚æ•°å¦‚ä¸‹ï¼š</p><p>![](5G-NR-PRACHå­¦ä¹ /p15-æ—¶åŸŸä¸¾ä¾‹1-1 (1).png)<br><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p16-%E6%97%B6%E5%9F%9F%E4%B8%BE%E4%BE%8B1-2.png" alt></p><p>åˆ©ç”¨ä¸Šæ–‡å…¬å¼å¯çŸ¥ï¼Œæ—¶åŸŸèµ„æºæ˜ å°„ä½ç½®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p17-%E6%97%B6%E5%9F%9F%E4%B8%BE%E4%BE%8B1-3.png" alt><br><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p18-%E6%97%B6%E5%9F%9F%E4%B8%BE%E4%BE%8B1-4.png" alt></p><h3 id="1-3-2-é¢‘åŸŸèµ„æºæ˜ å°„"><a class="header-anchor" href="#1-3-2-é¢‘åŸŸèµ„æºæ˜ å°„">Â¶</a>1.3.2 é¢‘åŸŸèµ„æºæ˜ å°„</h3><p>PRACHçš„é¢‘åŸŸèµ„æºä¸»è¦ç”±ä¸¤ä¸ªå‚æ•°â€œ<em><strong>msg1-FrequencyStart</strong></em>â€å’Œâ€œ<em><strong>msg1-FDM</strong></em>â€å†³å®šã€‚é¢‘åŸŸèµ„æºæ˜ å°„ä¸»è¦è¦ç¡®å®šPRACHé¢‘åŸŸèµ„æºçš„èµ·å§‹ä½ç½®ï¼Œä»¥åŠPRACHé¢‘åŸŸå å¤šå°‘ä¸ªRBã€‚</p><ul><li>PRACHå­è½½æ³¢é—´éš”ï¼Œ1.25 5 15 30 60 120 KHz</li><li>PRACHèµ„æºåœ¨é¢‘åŸŸä¸Šçš„ä¸ªæ•°ï¼Œå³é¢‘åŸŸä¸Šçš„PRACH transmission Occasions, ä¹Ÿç§°ä¸ºFDMä¸ªæ•°ï¼Œé…ç½®èŒƒå›´(1/2/4/8)ä¸ªï¼Œå¯¹åº”é«˜å±‚å‚æ•°ä¸º <em><strong>msg1-FDM</strong></em></li><li>PRACH ç¬¬ä¸€ä¸ªé¢‘åŸŸèµ„æºï¼Œåœ¨é¢‘åŸŸçš„èµ·å§‹ä½ç½®ï¼Œç›¸å¯¹äºä¸Šè¡Œæ¿€æ´»BWPï¼ˆä¸Šè¡Œåˆå§‹BWPï¼‰ä¸­PRB 0çš„åç§»ä½ç½®ï¼Œå¯¹åº”é«˜å±‚å‚æ•°ä¸º <em><strong>msg1-FrequencyStart</strong></em></li></ul><p>å¤šä¸ªPRACH transmission occasions åœ¨é¢‘åŸŸä¸Šè¿ç»­æ”¾ç½®ã€‚</p><p>PRACHé¢‘åŸŸèµ„æºå…·ä½“æƒ…å†µï¼Œåœ¨[TS 38.211 Table 6.3.3.2-1]æè¿°</p><p><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T3-38.211-6.3.3.2-1.png" alt></p><p>å…¶ä¸­$\overline k $ ä¸ºä¸‹è¾¹ç¼˜å­è½½æ³¢ä¿æŠ¤ä¸ªæ•°ã€‚åˆ†æè¡¨æ ¼å¯çŸ¥ï¼Œ$(\Delta f/\Delta f^{RA}) \cdot N_{RB}^{RA} \cdot N_{sc}^{RB} $ ä¸º PRACH å ç”¨çš„å­è½½æ³¢æ•°ï¼Œå®é™…å‘é€ä½¿ç”¨$L_{RA}$ ä¸ªå­è½½æ³¢ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¯¹äºç¬¬ä¸€è¡Œï¼šPRACHå ç”¨çš„å­è½½æ³¢æ•° = $(15/1.25)<em>6</em>12 = 864$ ä¸ªå­è½½æ³¢ï¼Œå®é™…å‘é€ä½¿ç”¨ <em><strong>839</strong></em> ä¸ªå­è½½æ³¢ã€‚</p><p>æ ¹æ®1.3èŠ‚ä¸ŠPRACHä¿¡é“æ—¶åŸŸä¿¡å·</p><p>å…¶ä¸­ï¼š</p><ul><li>$\mu_0$ ä¸ºUEé…ç½®çš„å­è½½æ³¢ä¸­æœ€å¤§çš„ $\mu$ å€¼</li><li>$N_{BWP,i}^{start}$ ä¸ºé…ç½®çš„ä¸Šè¡Œåˆå§‹BWPï¼ˆæˆ–è€…æ¿€æ´»ä¸Šè¡ŒBWPï¼‰çš„æœ€ä½RBç´¢å¼•</li><li>$n_{RA}^{start}$ ä¸ºé…ç½®çš„PRACHé¢‘åŸŸèµ„æºåœ¨BWPï¼ˆåˆå§‹æˆ–æ¿€æ´»ï¼‰ä¸­çš„æœ€ä½RBç´¢å¼•ï¼Œå¯¹åº”é«˜å±‚å‚æ•°<em>msg1-FrequencyStar</em></li><li>$n_{RA} \in {0,1,â€¦,M-1}$ è¡¨ç¤ºPRACH transmission occasion çš„ç´¢å¼•ï¼Œä»0åˆ°Mï¼ŒMä¸ºé…ç½®çš„PRACHé¢‘åŸŸèµ„æºçš„PRACHé¢‘åŸŸèµ„æºä¸ªæ•°å¯¹åº”çš„é«˜å±‚å‚æ•° <em>msg1-FDM</em> å…¶å–å€¼èŒƒå›´æ˜¯1ï¼Œ2ï¼Œ4ï¼Œ8</li></ul><p>é¢‘åŸŸèµ„æºä½ç½®å‚è€ƒå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p19-%E9%A2%91%E5%9F%9F%E6%98%A0%E5%B0%84.png" alt></p><h2 id="1-4-SSBå’ŒRACHä¿¡é“é…ç½®"><a class="header-anchor" href="#1-4-SSBå’ŒRACHä¿¡é“é…ç½®">Â¶</a>1.4 SSBå’ŒRACHä¿¡é“é…ç½®</h2><h3 id="1-4-1-æ¦‚è¿°"><a class="header-anchor" href="#1-4-1-æ¦‚è¿°">Â¶</a>1.4.1 æ¦‚è¿°</h3><p>åŸºç«™æŒ‰ç…§å‰æ–‡æ­¥éª¤ç”Ÿæˆäº† preambleï¼Œå¹¶é€šè¿‡å¹¿æ’­å‘é€ç»™UEï¼ŒUEä¹ŸçŸ¥é“äº†PRACHçš„æ—¶é¢‘åŸŸèµ„æºä½ç½®ï¼Œåœ¨æŠŠpreambleæ”¾åœ¨æŸä¸ªPRACHä¸Šå‘å‡ºå»ä¹‹å‰ï¼Œè¿˜å·®æœ€å…³é”®çš„ä¸€æ­¥ï¼Œé‚£å°±æ˜¯åŸºç«™è¦ç¡®å®šPRACHä¸SSBçš„æ˜ å°„å…³ç³»ã€‚<br>5Gé‡Œé¢å‡¡äº‹éƒ½ä¼šæ¶‰åŠåˆ°Beamè¿™ä¸ªæ¦‚å¿µï¼ŒRACHæµç¨‹ä¹Ÿä¸ä¾‹å¤–ã€‚ä¸€ä¸ª5Gå°åŒºä¼šå‘å°„å¤šä¸ªSSBï¼Œä¹Ÿå°±æ˜¯è¯´æœ‰å¾ˆå¤šä¸ªä¸‹è¡Œçš„beamã€‚ç»ˆç«¯ä¼šmonitorå’Œæµ‹é‡è¿™äº›beamï¼ŒæŒ‘é€‰ä¸€ä¸ªä¿¡å·æœ€å¥½çš„SSBæˆ–è€…beamè¿›è¡Œé©»ç•™ã€‚å¾ˆæ˜æ˜¾ï¼Œç»ˆç«¯è¦è·å¾—æ¯”è¾ƒå¥½çš„ä¸Šä¸‹è¡Œä¼ è¾“æ€§èƒ½ï¼Œéœ€è¦ä¸åŸºç«™å»ºç«‹ä¸€ä¸ªbeam pair(å‘é€beamå’Œæ¥æ”¶beam)ã€‚è¿™é‡Œè¦å¼ºè°ƒä¸€ç‚¹ï¼Œbeamæ˜¯åˆ†å‘é€å’Œæ¥æ”¶çš„ï¼Œå¹¶ä¸æ˜¯åªæœ‰å‘é€æœ‰beamï¼Œæ¥æ”¶ä¹Ÿæœ‰ã€‚å¦å¤–ï¼Œè¯´åˆ°å‘é€beamå’Œæ¥æ”¶beamï¼Œè¿™é‡Œè¦åŒºåˆ†ä¸Šä¸‹è¡Œã€‚</p><ul><li>ä¸Šè¡Œï¼ˆUE -&gt; gNBï¼‰: beam pairæŒ‡åŸºç«™æ¥æ”¶beamï¼Œç»ˆç«¯å‘é€beam</li><li>ä¸‹è¡Œï¼ˆgNB -&gt; UEï¼‰: beam pairæŒ‡ç»ˆç«¯æ¥æ”¶beamï¼ŒåŸºç«™å‘é€beam</li></ul><p><strong>å¤§è‡´çš„æµç¨‹</strong>å¦‚ä¸‹ï¼š</p><ol><li>åŸºç«™ï¼šæ ¹æ®é€»è¾‘æ ¹ç´¢å¼•é…ç½®ç”Ÿæˆ64ä¸ªpreambleï¼Œé€šè¿‡å¤šç»„beamå¹¿æ’­ç”Ÿæˆä¿¡æ¯ç»™UEã€‚</li><li>UEï¼šæ¥æ”¶ï¼Œå¹¶æµ‹é‡å‡ºæœ€ä½³çš„æ³¢æŸæ–¹å‘ï¼Œéšæœºé€‰å–preamble indexï¼Œé€‰æ‹©ä¸€ä¸ªCB preambleï¼Œç„¶åä»¥æœ€ä½³çš„æ³¢æŸæ–¹å‘åå‘å‘é€PRACHç»™åŸºç«™ã€‚</li><li>åŸºç«™ï¼šæ¥æ”¶åˆ°UEçš„PRACHï¼Œå¹¶é€šè¿‡SSBä¸PRACHä¹‹é—´çš„å…³è”ï¼ˆSSBä»…ä¸CB preambleç›¸å…³è”ï¼‰ç¡®å®šåŸºç«™ä¸UEä¹‹é—´çš„æœ€ä½³æ³¢æŸæ–¹å‘ï¼Œä»¥åé€šè¿‡è¯¥æ³¢æŸæ–¹å‘å‘UEå‘é€åç»­æ•°æ®ã€‚</li></ol><p>ç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯PRACHçš„å‘é€æ—¶åˆ»ï¼ˆROï¼ŒRACH occasionï¼ŒPRACH occasionï¼‰éœ€è¦å’ŒSSBå‘é€çš„æ—¶åˆ»ï¼ˆSSB indexï¼‰å»ºç«‹æ˜ å°„å…³ç³»ã€‚åŸºç«™æ ¹æ®UEä¸Šè¡ŒPRACHçš„èµ„æºä½ç½®ï¼Œå†³å®šä¸‹è¡ŒRARï¼ˆRA responseï¼‰å‘é€çš„æ³¢æŸã€‚</p><h3 id="1-4-2-SSBä¸ROæ˜ å°„é¡ºåº"><a class="header-anchor" href="#1-4-2-SSBä¸ROæ˜ å°„é¡ºåº">Â¶</a>1.4.2 SSBä¸ROæ˜ å°„é¡ºåº</h3><p>RACHå‚æ•°é…ç½®ä¸­<em><strong>ssb-perRACH-OccasionAndCB-PreamblesPerSSB</strong></em>ç”¨äºé…ç½®ï¼š</p><ul><li>æ¯ä¸ªRACHæ—¶åˆ»å¯¹åº”çš„SSBä¸ªæ•° N ï¼Œå–å€¼å¯ä»¥ä¸º 1/8 1/4 1/2 1 2 4 8 16</li><li>æ¯ä¸ªSSBåœ¨ä¸€ä¸ªROå†…æ‰€èƒ½ä½¿ç”¨çš„åŸºäºç«äº‰çš„Preambleä¸ªæ•°ï¼ŒRï¼ˆå…¶å®å°±æ˜¯æŒ‰SSBæ•°å¹³åˆ†CB-preamblesï¼‰</li></ul><p>â‘  <em><strong>ssb-perRACH-Occasion</strong></em> &gt;=1,å³ N &gt; = 1æ—¶ï¼Œè¡¨ç¤ºä¸€ä¸ªRACH Occasion å¯¹åº”å¤šä¸ªSSB<br>â‘¡ <em><strong>ssb-perRACH-Occasion</strong></em> &lt;1 , è¡¨ç¤ºä¸€ä¸ªSSBå¯¹åº”å¤šä¸ªRACH Occasion</p><p>SSBå’ŒROçš„æ˜ å°„éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š</p><ul><li>é¦–å…ˆï¼Œåœ¨ä¸€ä¸ªROå†…æŒ‰ç…§preamble indexçš„å‡åºæ˜ å°„</li><li>å…¶æ¬¡ï¼ŒæŒ‰ç…§é¢‘åŸŸROå‡åºæ˜ å°„</li><li>ç„¶åï¼ŒæŒ‰ç…§ä¸€ä¸ªPRACH slotå†…æ—¶åŸŸROå‡åºæ˜ å°„</li><li>æœ€åï¼ŒæŒ‰ç…§PRACH slotå‡åºæ˜ å°„</li></ul><p>ä»¥ä¸‹ä¸¾4ä¸ªä¾‹å­è¯´æ˜ä¸€ä¸‹:<br>(1) <em>ssb-perRACH-Occasion</em> = 1/4 , <em>msg1-FDM</em> = 4 $L_{max} = 4$ (ä¹Ÿå³ SSBä¸ªæ•°), SSB ä¸PRACH occasionæ˜ å°„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p20-SSB-PRACH%E4%BE%8B%E5%AD%901.png" alt></p><p>(2) <em>ssb-perRACH-Occasion</em> = 1/2 , <em>msg1-FDM</em> = 4 $L_{max} = 8$ , SSB ä¸PRACH occasionæ˜ å°„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p21-SSB-PRACH%E4%BE%8B%E5%AD%902.png" alt></p><p>(3) <em>ssb-perRACH-Occasion</em> = 1 , <em>msg1-FDM</em> = 4 $L_{max} = 8$ , SSB ä¸PRACH occasionæ˜ å°„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p22-SSB-PRACH%E4%BE%8B%E5%AD%903.png" alt></p><p>(4) <em>ssb-perRACH-Occasion</em> = 2 , <em>msg1-FDM</em> = 2 $L_{max} = 16$ , SSB ä¸PRACH occasionæ˜ å°„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p23-SSB-PRACH%E4%BE%8B%E5%AD%904.png" alt></p><h3 id="1-4-3-SSB-å’Œ-RACH-æ˜ å°„å‘¨æœŸ"><a class="header-anchor" href="#1-4-3-SSB-å’Œ-RACH-æ˜ å°„å‘¨æœŸ">Â¶</a>1.4.3 SSB å’Œ RACH æ˜ å°„å‘¨æœŸ</h3><p>PRACHåœ¨æ—¶åŸŸå’Œé¢‘åŸŸä¸Šæœ‰å¤šä¸ªå‘é€æ—¶åˆ»ï¼Œæ¯ä¸ªSSBå—è¦å’ŒPRACHå‘é€æ—¶åˆ»å»ºç«‹æ˜ å°„å…³ç³»ã€‚åŒæ—¶å¼•å…¥ä¸€ä¸ª<em><strong>association period</strong></em> æ˜ å°„å‘¨æœŸçš„æ¦‚å¿µï¼Œå³è¡¨ç¤ºæ‰€æœ‰çš„SSBå—å…¨éƒ¨æ˜ å°„åˆ°ROåï¼Œéœ€è¦åœ¨æ—¶åŸŸä¸Šå¤šå°‘ä¸ªPRACHå‘¨æœŸã€‚<br>æ˜ å°„å‘¨æœŸä»å¸§å·0å¼€å§‹ã€‚æ‰€æœ‰SSBè‡³å°‘æ˜ å°„ä¸€æ¬¡åï¼Œâ€œå¤šä½™â€çš„ROï¼Œæ²¡æœ‰SSBæ˜ å°„çš„è¯ï¼Œè¿™äº›ROä¸ç”¨ã€‚<br><em><strong>Association pattern period</strong></em> â€“ æ˜ å°„å›¾æ ·å‘¨æœŸï¼ŒåŒ…å«1ä¸ªæˆ–è€…å¤šä¸ªæ˜ å°„å‘¨æœŸ<em><strong>association periods</strong></em>ï¼Œä¸º160 ms ,æ¯éš”160 ms é‡å¤è¿›è¡ŒPRACHå’ŒSSBçš„æ˜ å°„ã€‚</p><p>ä¸¾ä¾‹è¯´æ˜:<br>è‹¥<em><strong>ssb-perRACH-Occasion</strong></em> = 1/2 , <em><strong>msg1-FDM</strong></em> = 4 $L_{max} = 4$ , PRACH å‘¨æœŸä¸º 1 Frame = 10 msï¼Œæ¯ä¸€ä¸ª Frame ä¸­åªæœ‰ä¸€ä¸ªsubFrame æœ‰æ—¶åŸŸ Occasion ,æ¯ä¸€ä¸ª subFrame ä¸­ åªæœ‰ä¸€ä¸ª æ—¶åŸŸ occasion ã€‚</p><p><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p24-SSB%E5%91%A8%E6%9C%9F.png" alt></p><h1>2 éšæœºæ¥å…¥è¿‡ç¨‹</h1><h2 id="2-1-æ¦‚è¿°"><a class="header-anchor" href="#2-1-æ¦‚è¿°">Â¶</a>2.1 æ¦‚è¿°</h2><p>ç»ˆç«¯æˆåŠŸè§£å‡ºSSBåä¾¿è·å¾—äº†NRç³»ç»Ÿçš„ä¸‹è¡ŒåŒæ­¥ï¼Œè¦æƒ³å®Œæˆä¸Šè¡ŒåŒæ­¥ä»¥å¹¶ä¸NRç½‘ç»œå»ºç«‹RRCè¿æ¥ï¼Œé‚£ä¹ˆéšæœºæ¥å…¥RACHæµç¨‹å¿…ä¸å¯å°‘ã€‚</p><h3 id="2-1-1-éšæœºæ¥å…¥è§¦å‘åœºæ™¯"><a class="header-anchor" href="#2-1-1-éšæœºæ¥å…¥è§¦å‘åœºæ™¯">Â¶</a>2.1.1 éšæœºæ¥å…¥è§¦å‘åœºæ™¯</h3><p>ä¸‹é¢è¿™10æ¡RACHè§¦å‘åŸå› æ‘˜è‡ªåè®®38.300ã€‚å…¶ä¸­ç¬¬7ã€9å’Œ10æ¡æ˜¯NRç³»ç»Ÿæ–°å‡ºç°çš„ï¼Œä¹Ÿæ˜¯åœ¨ä»¥å¾€LTEä¸­æ²¡æœ‰çš„ã€‚å…¶ä¸­ç¬¬7æ¡æ˜¯æŒ‡ç”±RRC_InactiveçŠ¶æ€å‘RRC_ConnectedçŠ¶æ€è½¬æ¢ï¼ŒRRC_InactiveçŠ¶æ€æ˜¯NRä¸­æ–°å¼•å…¥çš„ä¸€ç§RRCçŠ¶æ€ï¼›ç¬¬9æ¡æ˜¯æŒ‡å¯¹äºNRç³»ç»Ÿä¸­ä¸€äº›ä¸å¹¿æ’­çš„ç³»ç»Ÿæ¶ˆæ¯Other SIï¼ŒUEé‡‡ç”¨éšæœºæ¥å…¥æµç¨‹â€œæŒ‰éœ€ç´¢è¦â€è¿™äº›ä¸å¹¿æ’­çš„ç³»ç»Ÿæ¶ˆæ¯ï¼›ç¬¬10æ¡æ˜¯æŒ‡beam failureåçš„æ¢å¤æµç¨‹ã€‚</p><blockquote><p>1ï¼‰Initial access from RRC_IDLE;<br>2ï¼‰RRC Connection Re-establishment procedure;<br>3ï¼‰DL or UL data arrival during RRC_CONNECTED when UL synchronisation status is â€œnon-synchronisedâ€;<br>4ï¼‰UL data arrival during RRC_CONNECTED when there are no PUCCH resources for SR available;<br>5ï¼‰SR failure;<br>6ï¼‰Request by RRC upon synchronous reconfiguration (e.g. handover);<br>7ï¼‰Transition from RRC_INACTIVE;<br>8ï¼‰To establish time alignment for a secondary TAG;<br>9ï¼‰Request for Other SI;<br>10ï¼‰Beam failure recovery.</p></blockquote><h3 id="2-1-2-éšæœºæ¥å…¥æµç¨‹"><a class="header-anchor" href="#2-1-2-éšæœºæ¥å…¥æµç¨‹">Â¶</a>2.1.2 éšæœºæ¥å…¥æµç¨‹</h3><p>éšæœºæ¥å…¥è¿‡ç¨‹å¯ä»¥åˆ†ä¸ºç«äº‰æ€§éšæœºæ¥å…¥è¿‡ç¨‹ï¼ˆCBRAï¼‰å’Œéç«äº‰æ€§éšæœºæ¥å…¥ï¼ˆCFRAï¼‰ã€‚éç«äº‰æ€§éšæœºæ¥å…¥æ˜¯ç½‘ç»œå°†ç‰¹å®šçš„éšæœºæ¥å…¥èµ„æºæ˜¯åˆ†é…ç»™UEçš„ï¼Œé€šè¿‡Random Access Preambleç½‘ç»œå°±èƒ½è¯†åˆ«ç‰¹å®šçš„UEã€‚å…·ä½“çš„æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆæ‘˜è‡ªShareTechnoteï¼‰ï¼š</p><p><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p26-contention-Based.png" alt></p><p><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p27-contention-free.png" alt></p><p>ä»¥CBRAçš„4æ­¥(ä¸Šå›¾CDEFæ­¥éª¤)ä¸ºä¾‹ï¼š</p><ul><li>Msg1: UEåœ¨åˆé€‚çš„PRACHä¸Šå‘gNBå‘é€Preambleï¼›</li><li>Msg2: gNBå‘UEå‘é€RARï¼Œå¹¶åŒ…å«TC-RNTIã€UL timingå’Œå¯¹Msg3çš„è°ƒåº¦ç­‰ä¿¡æ¯ï¼›</li><li>Msg3/4: ç”¨äºç«äº‰å†²çªè§£å†³ï¼ˆå¤šä¸ªUEæ°å·§åœ¨åŒä¸€PRACHæ—¶é¢‘èµ„æºä¸Šé‡‡ç”¨äº†åŒä¸€ä¸ªpreambleåšRACHï¼‰ã€‚</li></ul><h2 id="2-2-Msg1"><a class="header-anchor" href="#2-2-Msg1">Â¶</a>2.2 Msg1</h2><p>å‰æ–‡æè¿°çš„å†…å®¹ä¹Ÿå°±æ˜¯Msg1çš„å¤§éƒ¨åˆ†å†…å®¹ã€‚åœ¨å‘é€Msg1ç»™åŸºç«™ä¹‹å‰, â‘  è¦ç¡®å®šå¤šå¤§çš„åŠŸç‡å‘é€Msg1çš„preambleï¼›â‘¡è¦ç¡®å®šRARæ˜¯å‘ç»™è‡ªå·±çš„ï¼Œå³éœ€è¦ä¸€ä¸ªèº«ä»½è®¤è¯ï¼Œå› æ­¤ç”¨åˆ°äº†RA-RNTIå¯ä»¥å”¯ä¸€æ ‡è¯†Msg1å‘é€çš„æ—¶é¢‘èµ„æºè¿™ä¸€ç‰¹æ€§ã€‚</p><h3 id="2-2-1-Msg1çš„å‘å°„åŠŸç‡"><a class="header-anchor" href="#2-2-1-Msg1çš„å‘å°„åŠŸç‡">Â¶</a>2.2.1 Msg1çš„å‘å°„åŠŸç‡</h3><p>æ ¹æ®[TS 38.213 7.4]ï¼ŒUEé…ç½®PRACHä¿¡é“çš„å‘é€åŠŸç‡ä¸º $P_{PRACH,b,f,c}(i) $ï¼Œå…¶æ„ä¹‰æ˜¯åŸºäºæœåŠ¡å°åŒºC çš„ DL RS åœ¨ä¸Šè¡Œæ¿€æ´»å¸¦å®½ b è½½æ³¢ fä¸Šï¼Œåœ¨å‘é€æ—¶åˆ» ä¸º i æ—¶çš„å‘å°„åŠŸç‡ã€‚</p><p>$$<br>P_{PRACH,b,f,c}(i) = min{P_{CMAX,f,c}(i),P_{PRACH,target,f,c}+PL_{b,f,c}}[dBm]<br>$$<br>å…¶ä¸­ï¼š</p><ul><li>$P_{CMAX,f,c}(i)$ æ˜¯UEé…ç½®çš„æœ€å¤§è¾“å‡ºåŠŸç‡ï¼Œç”± [8-1. TS 38.101-1]å’Œ [8-2. TS 38.101-2]ç»™å‡ºã€‚</li><li>$P_{PRACH,target,f,c}$ ä¸ºPRACH ç›®æ ‡æ¥æ”¶åŠŸç‡ <em>PREAMBLE_RECEIVED_TARGET_POWER</em> ç”±[11. TS 38.321] ç»™å‡ºè®¡ç®—å…¬å¼ï¼š<em>PREAMBLE_RECEIVED_TARGET_POWER</em> = <em>preambleReceivedTargetPower</em> + <em>DELTA_PREAMBLE</em> + <em>(PREAMBLE_POWER_RAMPING_COUNTER -1)</em> * <em>PREAMBLE_POWER_RAMPING_STEP</em><ul><li><em>preambleReceivedTargetPower</em> ç”±å‚æ•° <em>preambleReceivedTargetPower</em> ç»™å‡º</li><li><em>DELTA_PREAMBLE</em>å¯ç”±[TS 38.321 Table 7.3-1~2] è·å¾—</li><li><em>PREAMBLE_POWER_RAMPING_COUNTER</em> å¯¹åˆå§‹ä¼ è¾“ä¸º1ï¼Œä¾æ®é‡ä¼ æ¬¡æ•°è‡ªå¢ä¸€</li><li><em>PREAMBLE_POWER_RAMPING_STEP</em> ç”±å‚æ•° <em>powerRampingStep</em> ç»™å‡º<br>ï¼ˆä»¥ä¸Šä¸¤æ¡æ˜¯ä¸ºäº†åŠŸç‡æ”€å‡è€Œè®¾å®šçš„å‚æ•°ï¼‰</li></ul></li></ul><p>![](5G-NR-PRACHå­¦ä¹ /T13-213 7.3-1.png)</p><p>![](5G-NR-PRACHå­¦ä¹ /T14-213 7.3.1-2.png)</p><ul><li>$PL_{b,f,c}$ ä¸ºè·¯å¾„æŸè€—ã€‚ç”±å‚æ•° <em>referenceSignalPower</em> â€“ <em>higher layer filtered RSRP</em> (in dBm) è·å¾—ã€‚<ul><li><em>referenceSignalPower</em> æ ¹æ®PRACH å…³è”çš„SSBæˆ–è€…CSI-RSï¼Œç”±å‚æ•° <em>ss-PBCH_BlockPowe</em>r å’Œ <em>powerControlOffsetSS</em> å†³å®šã€‚</li><li><em>higher layer filtered RSRP</em> æ˜¯å‘é€PRACHæ—¶æµ‹å¾—çš„ RSRP (Reference Signal Receiving Power)ã€‚</li></ul></li></ul><p>ç¤ºä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rach-ConfigGeneric</span><br><span class="line">&#123;</span><br><span class="line">prach-ConfigurationIndex 2,			\\ å¯ä»¥ç¡®å®šformat 0</span><br><span class="line">msg1-FDM one,</span><br><span class="line">msg1-FrequencyStart 2,</span><br><span class="line">zeroCorrelationZoneConfig 6,</span><br><span class="line">preambleReceivedTargetPower -100,	\\ -100</span><br><span class="line">preambleTransMax n10,				\\ æœ€å¤§é‡ä¼ æ¬¡æ•°</span><br><span class="line">powerRampingStep dB4,				\\ 4</span><br><span class="line">ra-ResponseWindow sl20</span><br><span class="line">&#125;,</span><br><span class="line">ss-PBCH-BlockPower -8				\\ referenceSignalPower&#x3D;-8</span><br><span class="line">å‡è®¾æ­¤æ—¶çš„RSRPä¸º-94dBm</span><br></pre></td></tr></table></figure><p>åˆ™æ­¤æ—¶çš„Msg1çš„åˆå§‹å‘å°„åŠŸç‡ä¸ºï¼š<br>$$<br>P = -100 + 0 + (1-1)*4 + [-8-(-94)] = -14dBm<br>$$</p><p>å¦‚æœå‘ç”ŸMsg2æˆ–è€…Msg4å¤±è´¥ï¼Œåˆ™ä¼šè§¦å‘Msg1é‡ä¼ ï¼ŒMsg1çš„æœ€å¤§é‡ä¼ æ¬¡æ•°ç”±å‚æ•°<em>preambleTransMax</em>å®šä¹‰ã€‚å¦‚æœå‘ç”ŸMsg1çš„é‡ä¼ ï¼Œæ¯æ¬¡é‡ä¼ åŠŸç‡ä¼šä»¥<em>powerRampingStep</em>è¿™ä¸ªæ­¥é•¿å¢å¤§(åŠŸç‡æ”€å‡ï¼ŒRamping)ï¼Œç›´åˆ°æœ€åè¾¾åˆ°UEçš„æœ€å¤§åŠŸç‡æˆ–è€…é‡ä¼ è¾¾åˆ°æœ€å¤§æ¬¡æ•°ä¸ºæ­¢ã€‚<br>æ³¨æ„ï¼š</p><ul><li>å½“UE<strong>ç»§ç»­ä½¿ç”¨</strong>ä¸Šæ¬¡å‘é€SSBæ³¢æŸé‡å‘Msg1æ—¶ï¼Œéœ€è¦åŠŸç‡æ”€å‡ã€‚</li><li>å½“UE<strong>æ›´æ¢</strong>SSBæ³¢æŸå‘é€Msg1æ—¶ï¼Œä¸éœ€è¦è¿›è¡ŒåŠŸç‡æ”€å‡ã€‚</li></ul><h3 id="2-2-2-RA-RNTIçš„è®¡ç®—å’Œä½¿ç”¨"><a class="header-anchor" href="#2-2-2-RA-RNTIçš„è®¡ç®—å’Œä½¿ç”¨">Â¶</a>2.2.2 RA-RNTIçš„è®¡ç®—å’Œä½¿ç”¨</h3><p>RA-RNTIå¯ä»¥è¡¨å¾Msg1å‘é€æ—¶ä½¿ç”¨çš„æ—¶é¢‘èµ„æºï¼ŒUEå‘é€Msg1æ—¶ä¼šè®¡ç®—RA-RNTIå¹¶ä¿å­˜ï¼›gNBæ”¶åˆ°è¯¥Msg1åï¼ŒåŒæ ·ä¼šè®¡ç®—RA-RNTIï¼Œå¹¶ä½¿ç”¨è¯¥RA-RNTIå¯¹Msg2çš„PDCCH DCI format 1_0çš„CRCè¿›è¡Œæ‰°ç ã€‚</p><p>RA-RNTI=1 + s_id + 14 $\times$ t_id +14$\times80\times$ f_id + $14\times80\times8\times$ ul_carrier_id</p><p>å…¶ä¸­ï¼š</p><ul><li>s_id æ˜¯PRACHçš„èµ·å§‹ç¬¦å·ç´¢å¼• (0$\leq$ s_id &lt;14)</li><li>t_id æ˜¯ç³»ç»Ÿå¸§å†…PRACHçš„èµ·å§‹æ—¶éš™ç´¢å¼• (0$\leq$ t_id &lt;50)</li><li>f_id æ˜¯PRACH é¢‘åŸŸä½ç½®ç´¢å¼• (0$\leq$ f_id &lt;8)</li><li>ul_carrier_id æ˜¯Msg1å‘é€ä¸Šè¡Œè½½æ³¢æŒ‡ç¤º (0 for NUL carrier, and 1 for SUL carrier)</li></ul><h2 id="2-2-Msg2"><a class="header-anchor" href="#2-2-Msg2">Â¶</a>2.2 Msg2</h2><h3 id="2-2-1-UEæ¥æ”¶Msg2"><a class="header-anchor" href="#2-2-1-UEæ¥æ”¶Msg2">Â¶</a>2.2.1 UEæ¥æ”¶Msg2</h3><ol><li>UEé¦–å…ˆéœ€è¦å»è§£æå‡ºç”¨äºMsg2çš„ä¸‹è¡Œè°ƒåº¦çš„PDCCH DCIã€‚å®šä¹‰äº†ä¸€ä¸ªwindowçš„æ¦‚å¿µï¼ŒUEåœ¨è¿™ä¸ªçª—å£å†…å»ç›‘å¬PDCCHã€‚windowçš„é•¿åº¦ç”±å‚æ•° <em>ra-ResponseWindow</em> è§„å®šï¼ˆä¸èƒ½è¶…è¿‡10msï¼‰ï¼Œå•ä½æ˜¯slotã€‚windowçš„èµ·ç‚¹æ˜¯è·ç¦»PRACHå‘é€ä¹‹åè‡³å°‘é—´éš”1ä¸ªsymbolçš„ç”¨äºTyp1-PDCCH CSSçš„CORESETçš„é¦–ä¸ªsymbolã€‚ä¸€èˆ¬æƒ…å†µéƒ½æ˜¯PRACHå‘é€å®Œä¹‹åçš„é‚£ä¸ªä¸‹è¡Œslotä½œä¸ºèµ·ç‚¹ã€‚</li><li>è¦ç›‘å¬çš„DCIçš„æ ¼å¼æ˜¯format 1_0ã€‚è¿™ä¸ªDCIéœ€è¦å»Type 1 PDCCH Common Search Spaceå»æ‰¾ï¼Œç”±å‚æ•° <em>ra-SearchSpace</em> å®šä¹‰ã€‚</li><li>åŸºç«™å¯¹è¿™ä¸ªPDCCH DCIçš„CRCä½¿ç”¨äº†RA-RNTIè¿›è¡Œäº†æ‰°ç ï¼Œæ‰€ä»¥ç»ˆç«¯éœ€è¦åœ¨ <em>ra-searchspace</em>ä¸Šé¢å°è¯•ä½¿ç”¨RA-RNTIå»è§£æPDCCH DCIã€‚</li><li>å¦‚æœUEæˆåŠŸçš„ä½¿ç”¨RA-RNTIè§£è°ƒäº†DCIï¼ˆçŸ¥é“è¿™ä¸ªæ¶ˆæ¯æ˜¯å‘é€ç»™è‡ªå·±çš„ï¼‰ã€‚æ¥ç€å®ƒä¼šå»è§£PDSCH payloadã€‚</li><li>å¦‚æœUEç»§ç»­æˆåŠŸçš„è§£å‡ºäº†PDSCHï¼ŒUEä¼šæ£€æŸ¥å…¶ä¸­ RAPIDï¼ˆrandom access preamble identityï¼‰æ˜¯å¦ä¸è‡ªå·±å½“æ—¶å‘é€Msg1æ—¶ä½¿ç”¨çš„RACH preamble IDç›¸åŒã€‚å¦‚æœç›¸åŒï¼ŒUEè®¤ä¸ºMsg2è§£è°ƒæˆåŠŸã€‚</li><li>å¦‚æœUEåœ¨<em>ra-ResponseWindow</em> å†…æ²¡æœ‰ä½¿ç”¨RA-RNTIè§£å‡ºDCIï¼Œæˆ–è€…æ²¡æœ‰æˆåŠŸè§£å‡ºPDSCH payloadï¼Œæˆ–è€…è§£å‡ºäº†PDSCHä½†æ˜¯RAPIDä¸åŒ¹é…ï¼ŒUEéƒ½ä¼šè®¤ä¸ºMsg2æ¥æ”¶å¤±è´¥ï¼Œä¼šè§¦å‘Msg1é‡å‘ã€‚</li></ol><h3 id="2-2-2-Msg2å†…å®¹"><a class="header-anchor" href="#2-2-2-Msg2å†…å®¹">Â¶</a>2.2.2 Msg2å†…å®¹</h3><blockquote><p><strong>6.1.5 MAC PDU (Random Access Response)</strong><br>A MAC PDU consists of one or more MAC subPDUs and optionally padding. Each MAC subPDU consists one of the following:</p><ul><li>a MAC subheader with Backoff Indicator only;</li><li>a MAC subheader with RAPID only (i.e. acknowledgment for SI request);</li><li>a MAC subheader with RAPID and MAC RAR.</li></ul></blockquote><p><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p28-Figure6.1.5-3.png" alt></p><p><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p31-MAC-PDU.png" alt></p><p>ä¸Šé¢çš„æè¿°åŠå›¾ç‰‡æ‘˜è‡ª [TS 38.213]ï¼Œç»“æ„å›¾æ‘˜è‡ªShareTechnoteï¼Œè¯´æ˜Msg2è¿™ä¸ªMAC PDU è‚¯èƒ½åŒ…å«BIï¼ŒRAPID å’Œ MAC RARä¸‰éƒ¨åˆ†ã€‚</p><ul><li>BIï¼ˆBackoff Indicatorï¼‰ç”¨äºå½“Msg1é‡å‘çš„æ—¶å€™äº§ç”Ÿä¸€ä¸ªéšæœºé€€é¿æ—¶é—´ï¼ˆ0 - PREAMBLE_BACKOFFï¼‰ï¼Œå½“è¿™ä¸ªé€€é¿æ—¶é—´ç»“æŸåï¼Œç»ˆç«¯æ‰èƒ½é‡å‘Msg1ã€‚Msg2é‡Œé¢çš„BI fieldå¯¹åº”çš„é€€é¿æ—¶é—´å¦‚ä¸‹è¡¨[TS 38.321 Table 7.2-1]ã€‚å¦‚æœä¸åŒ…å«ç”¨äºBIçš„MAC subPDUï¼Œé‚£ä¹ˆé‡å‘Msg1æ—¶é€€é¿æ—¶é—´ä¸º0msã€‚</li></ul><p><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p30-7.2-1.png" alt></p><ul><li>RAPIDï¼Œç”¨äºæºå¸¦random access preamble IDï¼Œå¦‚ä¸Šæè¿°ã€‚</li><li>RARï¼Œè¿™ä¸ªsubPDUæ˜¯Msg2é‡Œé¢æœ€é‡è¦çš„éƒ¨åˆ†ã€‚ä¸»è¦åŒ…æ‹¬TAï¼ŒUL GRANTä¿¡æ¯å’ŒTC-RNTIï¼Œå…¶ä¸­UL GRANTæ˜¯ç”¨äºåé¢çš„Msg3ï¼ŒåŒ…æ‹¬PUSCHçš„æ—¶åŸŸï¼Œé¢‘åŸŸçš„èµ„æºåˆ†é…ï¼Œæ˜¯å¦è·³é¢‘ï¼ŒMCSï¼ŒMsg3çš„åŠŸæ§(å‚è€ƒ[TS 38.213 Table 8.2-2])å’ŒCSI requestã€‚å…·ä½“ç»“æ„å¦‚ä¸‹å›¾[TS 38.321 6.2.2-3]ï¼ŒUL_GRANTä¸­çš„å†…å®¹å¦‚ä¸‹è¡¨[TS 38.213 Table 8.2-1]ã€‚</li></ul><p>![](5G-NR-PRACHå­¦ä¹ /p29-Figure 6.2.3-1.png)</p><p><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T-15-8.2-1.png" alt></p><p><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T15-213-8.2-2.png" alt></p><h2 id="2-3-Msg3"><a class="header-anchor" href="#2-3-Msg3">Â¶</a>2.3 Msg3</h2><p>æ ¹æ®å‰æ–‡æè¿°UEåœ¨Msg2ä¸­è§£æåˆ°MAC RARï¼ŒMAC RARä¸­åŒ…å«ç€27 bit çš„UL Grantï¼Œè¯¥UL GrantæŒ‡ç¤ºäº†PUSCHçš„æ—¶åŸŸï¼Œé¢‘åŸŸçš„èµ„æºåˆ†é…ï¼Œæ˜¯å¦è·³é¢‘ï¼ŒMCSï¼ŒMsg3çš„åŠŸæ§å’ŒCSI request ç­‰æ¶ˆæ¯ã€‚</p><h3 id="2-3-1-Msg3çš„ä¼ è¾“å†…å®¹"><a class="header-anchor" href="#2-3-1-Msg3çš„ä¼ è¾“å†…å®¹">Â¶</a>2.3.1 Msg3çš„ä¼ è¾“å†…å®¹</h3><p>Msg3ä¼ è¾“çš„å†…å®¹å–å†³äºéšæœºæ¥å…¥çš„åœºæ™¯ã€‚</p><ul><li>UEå·²ç»æ‹¥æœ‰äº†åˆæ³•çš„C-RNTIï¼šUEåœ¨Mdg3ä¸Šå‘é€C-RNTI MAC CE (ç”±LCID index 58)ã€‚</li><li>UEæ²¡æœ‰åˆæ³•çš„C-RNTIï¼šUEåœ¨Msg3ä¸Šå‘é€CCCH SDU (ç”±LCIDæŒ‡ç¤º)ï¼Œè¿™äº›CCCH SDUé‡Œé¢åŒ…å«ç«äº‰è§£å†³èº«ä»½identityã€‚</li></ul><h3 id="2-3-2-Msg3çš„å‘é€æ—¶åˆ»"><a class="header-anchor" href="#2-3-2-Msg3çš„å‘é€æ—¶åˆ»">Â¶</a>2.3.2 Msg3çš„å‘é€æ—¶åˆ»</h3><p>å‡è®¾æ¥æ”¶Msg2æœ«å°¾æ¶ˆæ¯åœ¨slot $n$ , åˆ™UEå‘é€Msg3çš„ solt $n+k_2+\Delta$ , å…¶ä¸­çš„ $k_2, \Delta$ ç”± [6. TS 38.214] ç»™å‡ºï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p32-K2.png" alt></p><p>Msg3çš„å‘é€æ—¶åˆ»ä¸Msg2çš„æœ€åä¸€ä¸ªsymbolè‡³å°‘ç›¸éš” $N_{T,1}+N_{T,2}+0.5$ msecï¼Œå…¶ä¸­ $N_{T,1}ï¼ŒN_{T,2}$ æ˜¯Nä¸ªç¬¦å·çš„æŒç»­æ—¶é—´ï¼Œè¯¥æ—¶é—´ä¸å½“é…ç½® additional PDSCH DMRSæ—¶ç”¨äºUEå¤„ç†èƒ½åŠ›1,2 çš„PDSCHå¤„ç†æ—¶é—´ç›¸å¯¹åº”ã€‚N çš„å¯¹åº”å–å€¼ç”±ä¸‹è¡¨ç»™å‡ºï¼š</p><p><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T20-214-6.4-1.png" alt></p><p><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T21-214-6.4-2.png" alt></p><h2 id="2-4-Msg4"><a class="header-anchor" href="#2-4-Msg4">Â¶</a>2.4 Msg4</h2><p>Msg4 æ˜¯ Contention Resolution ç¯èŠ‚ã€‚ç«äº‰è§£å†³çš„æ–¹å¼å–å†³äº Msg3 ä¸­æ˜¯ä¼ è¾“äº†CCCH SDU è¿˜æ˜¯ C-RNTI MAC CEã€‚</p><ul><li><p>Msg3 ä¸­ä¼ è¾“CCCH SDU</p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒMsg3å‘é€å¯¹åº”PUSCHç¬¦å·ç»“æŸä¹‹åï¼Œåˆ™å¼€å¯ <em>re-ContentionResolutionTimer</em> ï¼Œåœ¨TImerä¸ºæœªè¶…æ—¶ä¹‹å‰ï¼Œåœ¨<em>ra-SearchSpace</em> ä¸Šæ£€æµ‹ Temporay C-RNTI çš„DCI format 1_0ï¼Œåœ¨è°ƒåº¦çš„PDSCHè¯‘ç æ­£ç¡®çš„æƒ…å†µä¸‹ï¼Œå¦‚æœè§£æåˆ°UE Contention Resolution Identity MAC CEï¼Œä¸”å…¶å†…å®¹ä¸å‘é€çš„CCCH SDU ä¸¤è€…å†…å®¹ä¸€è‡´ï¼Œåˆ™è®¤ä¸ºéšæœºè¿‡ç¨‹æ¥å…¥æˆåŠŸï¼Œä¹‹ååœæ­¢ <em>ra-ContentionResolutionTimer</em>ï¼Œå¹¶å°†TC-RNTIæ­£å¼è½¬åŒ–ä¸ºC-RNTIã€‚</p></li><li><p>Msg3 ä¸­ä¼ è¾“ C-RNTI MAC CE</p><p>æ­¤ç§æƒ…å†µä¸‹ï¼Œå†²çªè§£å†³çš„åŸç†ä¸ä¼ è¾“CCCH SDUæ—¶ç›¸åŒï¼Œåªæ˜¯é€šè¿‡æ¥æ”¶C-RNTIè°ƒåº¦çš„DCIæ¥åˆ¤æ–­ç«äº‰è§£å†³æ˜¯å¦æˆåŠŸã€‚</p></li></ul><h2 id="2-5-HARQ-ACK-for-Msg4"><a class="header-anchor" href="#2-5-HARQ-ACK-for-Msg4">Â¶</a>2.5 HARQ ACK for Msg4</h2><p>ä¸€æ—¦UEæˆåŠŸè§£æå‡ºMsg4ï¼ŒUEåœ¨PUCCHä¸­å‘é€HARQ-ACKä¿¡æ¯ã€‚åé¦ˆæ—¶é—´è·ç¦»Msg4çš„æœ€åä¸€ä¸ªsymbolè‡³å°‘ç›¸éš”$N_{T,1}+0.5$ msec (å‚è€ƒMsg3çš„å‡†å¤‡æ—¶é—´)ã€‚</p><h2 id="2-6-æµç¨‹æ—¶åºå›¾æ€»ç»“"><a class="header-anchor" href="#2-6-æµç¨‹æ—¶åºå›¾æ€»ç»“">Â¶</a>2.6 æµç¨‹æ—¶åºå›¾æ€»ç»“</h2><p>æµç¨‹æ—¶åºå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p33-%E6%97%B6%E5%BA%8F%E5%9B%BE.png" alt></p><p>å…¶ä¸­ï¼š</p><ul><li><ol><li>gNB â†’ UEï¼šSystem informationã€‚</li></ol><ul><li>Configuration of PRACH transmission Parameters<ul><li>PRACH Preamble Format</li><li>Time Resources</li><li>Frequency Resources</li></ul></li><li>Parameters for determining the root sequences and their cyclic shifts in the PRACH Preamble sequence set<ul><li>index to logical root sequence table</li><li>Cyclic Shift(Ncs)</li><li>Set Type (unrestricted, restricted set A or restricted set B)</li></ul></li></ul></li><li><ol start="2"><li>UE â†’ gNBï¼šMsg1- PRACH Preambleã€‚PRACH Preamble é¢‘åŸŸèµ„æºç”±å‚æ•° <em>msg1-FDM</em> å’Œ <em>msg1-FrequencyStart</em> å†³å®šï¼›PRACH Preamble æ—¶åŸŸèµ„æºç”±å‚æ•° <em>prach-ConfigurationIndex</em> å†³å®šï¼›</li></ol></li><li><ol start="3"><li>gNB â†’ UEï¼šMsg2ã€‚Msg2éœ€è¦åœ¨ra-ResponseWindowå†…è¢«UEæ¥æ”¶ã€‚</li></ol></li><li><ol start="4"><li>UE â†’ gNBï¼šMsg3ã€‚Msg3å‘é€æ—¶éš™ï¼Œä¸Msg2æœ€åæ—¶éš™ç›¸å·® $k_2+\Delta$ ; æ—¶é—´ä¸Šè‡³å°‘ç›¸éš” $N_{T,1}+N_{T,2}+0.5$ ms ã€‚</li></ol></li><li><ol start="5"><li>gNB â†’ UEï¼šMsg4ã€‚å†²çªè§£å†³ç¯èŠ‚ï¼Œå¯¹åº”Msg3æ‰€ä¼ è¾“çš„ä¸åŒå†…å®¹åšå‡ºå›åº”ã€‚Msg4éœ€è¦åœ¨<em>ra-ContentionResolutionTimer</em> å†…è¢«UEæ¥æ”¶ã€‚</li></ol></li><li><ol start="6"><li>UE â†’ gNBï¼šHARQ ACKã€‚åé¦ˆæ—¶é—´è·ç¦»Msg4çš„æœ€åä¸€ä¸ªsymbolè‡³å°‘ç›¸éš”$N_{T,1}+0.5$ ms ã€‚</li></ol></li></ul><h1>3 æ‰©å±•</h1><blockquote><p>ä¸»è¦å‚è€ƒï¼š<a href="https://blog.csdn.net/GiveMe5G/article/details/103847118" target="_blank" rel="noopener">https://blog.csdn.net/GiveMe5G/article/details/103847118</a></p></blockquote><p>ä¸»è¦æ˜¯åˆ†æéšæœºæ¥å…¥è¿‡ç¨‹ä¸­çš„æ¶ˆæ¯å¦‚ä½•ç»„åˆèµ·æ¥åº”ç”¨åˆ°å®é™…çš„åœºæ™¯ä¸­å»ã€‚å‚è€ƒä¸­ä¸»è¦æ˜¯å½’çº³æ€»ç»“äº†éšæœºæ¥å…¥çš„è§¦å‘åœºæ™¯ï¼Œå¹¶å¯¹ä¸‰ä¸ªé‡è¦åœºæ™¯ä¸‹çš„RACHæµç¨‹è¿›è¡Œè¿›ä¸€æ­¥çš„åˆ†æã€‚</p><h2 id="3-1-RACHè§¦å‘ç±»å‹-åœºæ™¯-åˆ†ç±»"><a class="header-anchor" href="#3-1-RACHè§¦å‘ç±»å‹-åœºæ™¯-åˆ†ç±»">Â¶</a>3.1 RACHè§¦å‘ç±»å‹(åœºæ™¯)åˆ†ç±»</h2><p>RACHæµç¨‹ä¸»è¦ç”±ä¸‰ç§è§¦å‘ç±»å‹ï¼š</p><ul><li>PDCCH orderè§¦å‘</li><li>MACå±‚è§¦å‘</li><li>RRCå±‚è§¦å‘</li></ul><blockquote><p>The Random Access procedure described in this clause is initiated by a PDCCH order, by the MAC entity itself, or by RRC for the events in accordance with TS 38.300</p></blockquote><p>ä»¥ä¸‹æ˜¯å‚è€ƒæ–‡ç« ä½œè€…æ ¹æ® TS 38.300 ç³»åˆ—æ•´ç†çš„è¡¨æ ¼ï¼Œå½’çº³äº†å„ä¸ªåœºæ™¯ä»¥åŠå…¶å¯¹åº”çš„è§¦å‘ç±»å‹ï¼š</p><p><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p34-RACH%E5%9C%BA%E6%99%AF.png" alt></p><h2 id="3-2-PDCCH-Order-RACH"><a class="header-anchor" href="#3-2-PDCCH-Order-RACH">Â¶</a>3.2 PDCCH Order RACH</h2><p>PDCCH Order å‘èµ·çš„éšæœºæ¥å…¥ä¸»è¦ç”¨äºä¸Šè¡Œå¤±æ­¥åï¼Œå½“gNBæœ‰ä¸‹è¡Œæ•°æ®è¦å‘é€æ—¶ï¼Œä¼šä½¿ç”¨PDCCH Order å¼ºåˆ¶UEå‘èµ· RACH ä»¥é‡æ–°å®Œæˆä¸Šè¡Œæ—¶é—´åŒæ­¥ã€‚PDCCH Orderä½¿ç”¨PDCCH DCI 1_0é…ç½®ç»™UEã€‚å…¶å­—æ®µçš„è®¾ç½®å¦‚ä¸‹ï¼š</p><ul><li>Random Access Preamble index â€“ 6 bits</li><li>UL/SUL indicator â€“ 1 bit</li><li>SS/PBCH index â€“ 6 bits</li><li>PRACH Mask index â€“ 4 bits</li><li>Reserved bits â€“ 10 bits</li></ul><p>ä»ä¸Šè¿°æè¿°ä¸­å¯ä»¥çœ‹å‡ºï¼ŒDCI 1_0ä¸­ä¼šå‘Šè¯‰UE ç”¨äºRACHçš„preamble index ä»¥ä¾¿UEå‘èµ·éç«äº‰çš„éšæœºæ¥å…¥ï¼Œä½†æ˜¯è¦æ³¨æ„è¿™æ˜¯æœ‰æ¡ä»¶çš„ï¼Œè¦æ±‚DCI 1_0ä¸­æŒ‡ç¤ºçš„preamble indexé0ï¼Œå¦åˆ™éœ€è¦ä½¿ç”¨åŸºäºç«äº‰çš„éšæœºæ¥å…¥ã€‚</p><p>åŸºäºç«äº‰å’Œéç«äº‰çš„PDCCH Orderè§¦å‘çš„RACHæµç¨‹å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p35-%E5%9C%BA%E6%99%AF1.png" alt></p><h2 id="3-3-Beam-Failure-Recovery-RACH"><a class="header-anchor" href="#3-3-Beam-Failure-Recovery-RACH">Â¶</a>3.3 Beam Failure Recovery RACH</h2><p>åœ¨5Gå½“ä¸­å¼•å…¥äº†ä¸€ä¸ªbeam çº§åˆ«çš„é“¾è·¯æ¢å¤æœºåˆ¶ï¼ŒBeam failure recoveryï¼Œåé¢ç®€ç§°ä¸ºBFRã€‚BFRåˆ†ä¸ºåŸºäºç«äº‰å’ŒåŸºäºéç«äº‰ä¸¤ç§ã€‚æŒ‰ç…§38321ä¸­çš„æè¿°ï¼Œå¦‚æœRRCé…ç½®äº†ç”¨äºBFRçš„RACHèµ„æºå¹¶ä¸”ç”¨äºbeamæ¢å¤çš„candidate beamï¼ˆSSB/CSI-RSï¼‰ä¸­è‡³å°‘æœ‰ä¸€ä¸ªbeamçš„RSRPé«˜äºä¸€å®šçš„é—¨é™ï¼Œè€Œä¸”beamFailureRecoveryTimeræ²¡æœ‰è¶…æ—¶ï¼Œè¿™æ—¶æ‰èƒ½ä½¿ç”¨åŸºäºéç«äº‰çš„BFRï¼›å¦åˆ™éœ€è¦ä½¿ç”¨åŸºäºç«äº‰çš„BFRã€‚<br>ä¸‹é¢çš„ä¸¤å¹…å›¾æ˜¯åŸºäºç«äº‰å’Œéç«äº‰çš„BFR RACHæµç¨‹ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºåŸºäºéç«äº‰çš„BFRæµç¨‹çš„Msg2ï¼Œå…¶PDCCHæ˜¯ä½¿ç”¨C-RNTIæ‰°ç çš„ï¼Œè€Œä¸æ˜¯RA-RNTIã€‚</p><p><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p36-%E5%9C%BA%E6%99%AF2.png" alt></p><h2 id="3-4-OSI-Other-System-Information-Request-RACH"><a class="header-anchor" href="#3-4-OSI-Other-System-Information-Request-RACH">Â¶</a>3.4 OSI (Other System Information) Request RACH</h2><p>5G SAç»„ç½‘å½“ä¸­MIBå’ŒSIB1è¿™ä¸¤ä¸ªç³»ç»Ÿæ¶ˆæ¯ä¸€å®šæ˜¯é€šè¿‡å¹¿æ’­çš„æ–¹å¼é€šçŸ¥UEçš„ï¼Œä½†æ˜¯å…¶ä»–çš„ç³»ç»Ÿæ¶ˆæ¯ï¼ˆOSI-Other System Informationï¼‰å¯ä»¥é‡‡ç”¨åƒLTEçš„å¹¿æ’­æ–¹å¼ï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨5Gå½“ä¸­æ–°å¼•å…¥çš„æŒ‰éœ€ç´¢è¦çš„æ–¹å¼ï¼ˆOn Demond Requestï¼‰ã€‚<br>å¯¹äºæŒ‰éœ€ç´¢è¦çš„ç³»ç»Ÿæ¶ˆæ¯ï¼Œä¼šç”¨åˆ°RACH æµç¨‹ï¼Œå…·ä½“åˆ†ä¸ºMsg1 basedå’ŒMsg3 basedçš„ä¸¤ç§RACHæµç¨‹ã€‚æ³¨æ„ï¼ŒMsg1 basedçš„è¯·æ±‚éœ€è¦åŸºç«™åœ¨SIB1é‡Œé¢çš„SI-SchedulingInfoä¸­é…ç½®ä¸“é—¨ç”¨äºOSIè¯·æ±‚çš„RACHèµ„æºå’ŒPreambleï¼Œè€Œä¸”å®ƒçš„Msg2æ˜¯ä¸€ä¸ªåªå«æœ‰RAPIDçš„MAC subPDUï¼›è€ŒMsg3 basedçš„å…¶å®æ˜¯ä¸€ç§æ™®é€šçš„åŸºäºç«äº‰çš„RACHæ–¹å¼ï¼Œåªæ˜¯è¿™é‡Œé¢çš„Msg3å¼•å…¥äº†ä¸€ä¸ªæ–°çš„UL-CCCHæ¶ˆæ¯ï¼ŒRRCSystemInfoRequestï¼Œç”¨äºè¯·æ±‚UEæƒ³è¦çš„OSIã€‚</p><p><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p37-%E5%9C%BA%E6%99%AF3.png" alt></p><h1>é™„å½•</h1><h2 id="é™„å½•A-ç›¸å…³è¡¨æ ¼"><a class="header-anchor" href="#é™„å½•A-ç›¸å…³è¡¨æ ¼">Â¶</a>é™„å½•A ç›¸å…³è¡¨æ ¼</h2><p><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T1-38.211-6.3.3.1-1.png" alt></p><p><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T2-38.211-6.3.3.1-2.png" alt></p><p><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T3-38.211-6.3.3.2-1.png" alt></p><p><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T5-38.211-6.3.3.1-3(4).png" alt></p><p><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T6-38.211-6.3.3.1-5.png" alt></p><p><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T7-38.211-6.3.3.1-6.png" alt></p><p><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T8-38.211-6.3.3.1-7.png" alt></p><p><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T9-38.211-6.3.3.2-2.png" alt></p><p><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T10-38.211-6.3.3.2-3.png" alt></p><p><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T11-38.211-6.3.3.2-4.png" alt></p><h2 id="é™„å½•B-ç›¸å…³é…ç½®"><a class="header-anchor" href="#é™„å½•B-ç›¸å…³é…ç½®">Â¶</a>é™„å½•B ç›¸å…³é…ç½®</h2><p><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/C1-RACH-Configuration.png" alt><br><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/C2-RACH-Configuration2.png" alt></p><p><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/C3-RACH-ConfigDedicated1.png" alt><br><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/C4-RACH-ConfigDedicated2.png" alt></p><p><img src="/5G_Protocol/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/C5-RACH-ConfigGeneric.png" alt></p><blockquote><p>å‚è€ƒæ–‡çŒ®<br>å…¬ä¼—å·ï¼š5Gèœé¸Ÿæˆé•¿æ—¥è®°ï¼Œæ˜¥å¤©å·¥ä½œå®¤<br>ç½‘é¡µï¼š<a href="https://mp.weixin.qq.com/s/LRpnHwaAmYmpUlhF6wcmZg" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/LRpnHwaAmYmpUlhF6wcmZg</a><br>ç½‘é¡µï¼š<a href="http://www.sharetechnote.com/html/5G/5G_RACH.html" target="_blank" rel="noopener">http://www.sharetechnote.com/html/5G/5G_RACH.html</a><br>åšå®¢ï¼š<a href="https://blog.csdn.net/qq_33206497/article/details/89980529" target="_blank" rel="noopener">https://blog.csdn.net/qq_33206497/article/details/89980529</a><br>åšå®¢ï¼š<a href="https://blog.csdn.net/GiveMe5G/article/details/102634057" target="_blank" rel="noopener">https://blog.csdn.net/GiveMe5G/article/details/102634057</a><br>åšå®¢ï¼š<a href="https://blog.csdn.net/GiveMe5G/article/details/102633678" target="_blank" rel="noopener">https://blog.csdn.net/GiveMe5G/article/details/102633678</a><br>åšå®¢ï¼š<a href="https://blog.csdn.net/GiveMe5G/article/details/102633541" target="_blank" rel="noopener">https://blog.csdn.net/GiveMe5G/article/details/102633541</a><br>åšå®¢ï¼š<a href="https://blog.csdn.net/GiveMe5G/article/details/103219499" target="_blank" rel="noopener">https://blog.csdn.net/GiveMe5G/article/details/103219499</a><br>åšå®¢ï¼š<a href="https://blog.csdn.net/GiveMe5G/article/details/103413805" target="_blank" rel="noopener">https://blog.csdn.net/GiveMe5G/article/details/103413805</a><br>åšå®¢ï¼š<a href="https://blog.csdn.net/GiveMe5G/article/details/103606304" target="_blank" rel="noopener">https://blog.csdn.net/GiveMe5G/article/details/103606304</a><br>åšå®¢ï¼š<a href="https://blog.csdn.net/GiveMe5G/article/details/103847118" target="_blank" rel="noopener">https://blog.csdn.net/GiveMe5G/article/details/103847118</a></p></blockquote><!-- rebuild by neat -->]]></content>
      <categories>
        <category>5G_Protocol</category>
      </categories>
      <tags>
        <tag>PRACH</tag>
        <tag>éšæœºæ¥å…¥</tag>
      </tags>
  </entry>
  <entry>
    <title>5G-NR-PDSCHå­¦ä¹ </title>
    <url>/5G_Protocol/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<!-- build time:Tue Jun 22 2021 17:02:33 GMT+0800 (GMT+08:00) --><a id="more"></a><h1>1 PDSCH ç‰©ç†æµç¨‹</h1><h2 id="1-1-åŠ æ‰°"><a class="header-anchor" href="#1-1-åŠ æ‰°">Â¶</a>1.1 åŠ æ‰°</h2><p>åŒç å­—ä¼ è¾“æ—¶ï¼Œ$q \in {0,1}$ï¼›å•ç å­—ä¼ è¾“æ—¶ï¼Œ$q = 0$ã€‚[TS 38.211 7.3.1.1]<br>æ¯ä¸€ä¸ªç å­—å¯¹åº”çš„åŸå§‹æ•°æ® $b<sup>{(q)}(0),â€¦,b</sup>{(q)}(M_{bit}^{(q)}-1)$ ,ç»è¿‡åŠ æ‰°å¤„ç†ç”ŸæˆåŠ æ‰°åçš„æ•°æ®ä¸º $\widetilde b^{(q)}(0),â€¦,\widetilde b<sup>{(q)}(M_{bit}</sup>{(q)}-1)$ ã€‚åŠ æ‰°å¤„ç†å¦‚ä¸‹æ‰€ç¤ºï¼š<br>$$<br>\widetilde b^{(q)}(i) = (b^{(q)}(i) + c^{(q)}(i))mod2<br>$$<br>åŠ æ‰°åºåˆ—æ˜¯ä¸€ä¸ªä¼ªéšæœºåºåˆ—ï¼Œç”±[TS 38.211 5.2.1]ç»™å‡ºï¼ŒåŠ æ‰°åºåˆ—çš„åˆå§‹ä¸ºï¼š<br>$$<br>C_{init} = n_{RNTI}\cdot2<sup>{15}+q\cdot2</sup>{14}+n_{ID}<br>$$</p><p>å…¶ä¸­ï¼š</p><ul><li>$n_{ID}$ = dataScramblingIdentityPDSCH(å¦‚æœé…ç½®)ï¼Œå¹¶ä¸”RNTI = C-RNTI or CS-RNTIï¼Œåœ¨å…¬å…±æœç´¢ç©ºé—´ä¸­ä¸ä½¿ç”¨DCIæ ¼å¼1_0è°ƒåº¦ä¼ è¾“ã€‚</li><li>é™¤æ­¤ä¹‹å¤– $n_{ID} = N_{ID}^{cell}$</li><li>$n_{RNTI}$ å°±æ˜¯PDSCHå½“å‰ä¼ è¾“æ—¶ç›¸å…³è”çš„RNTI</li></ul><h2 id="1-2-è°ƒåˆ¶"><a class="header-anchor" href="#1-2-è°ƒåˆ¶">Â¶</a>1.2 è°ƒåˆ¶</h2><p>æ¯ä¸€ä¸ªç å­—åŠ æ‰°åçš„æ¯”ç‰¹å— $\widetilde b^{(q)}(0),â€¦,\widetilde b<sup>{(q)}(M_{bit}</sup>{(q)}-1)$ é‡‡ç”¨ä¸‹è¡¨ä¸­çš„ä¸€ç§è°ƒåˆ¶æ–¹å¼è¿›è¡Œè°ƒåˆ¶ï¼Œå¾—åˆ°ä¸€ä¸ªå¤å€¼è°ƒåˆ¶ç¬¦å·å—$d<sup>{(q)}(0),â€¦,d</sup>{(q)}(M_{symb}^{(q)}-1)$ã€‚[TS 38.211 7.3.1.2]</p><table><tr><td><center>Modulation scheme</center></td><td><center>Modulation order</center></td></tr><tr><td><center>QPSK</center></td><td><center>2</center></td></tr><tr><td><center>16QAM</center></td><td><center>4</center></td></tr><tr><td><center>64QAM</center></td><td><center>6</center></td></tr><tr><td><center>256QAM</center></td><td><center>8</center></td></tr></table><h2 id="1-3-å±‚æ˜ å°„"><a class="header-anchor" href="#1-3-å±‚æ˜ å°„">Â¶</a>1.3 å±‚æ˜ å°„</h2><p>æ¯ä¸€ä¸ªç å­—ç”Ÿæˆçš„è°ƒåˆ¶ä¿¡å· $d<sup>{(q)}(0),â€¦,d</sup>{(q)}(M_{symb}^{(q)}-1)$ æ ¹æ®ä¸‹è¡¨æ˜ å°„åˆ°å¤šä¸ªå±‚$x(i)=[x^0{i} \cdots x<sup>{v-1}(i)]</sup>T$ï¼Œ$i = 0,1,â€¦,M_{symb}<sup>{layer}-1$ï¼Œå…¶ä¸­$v$è¡¨ç¤ºå±‚æ•°ï¼Œ$M_{symb}</sup>{layer}$ è¡¨ç¤ºæ¯å±‚è°ƒåˆ¶ç¬¦å·çš„æ•°é‡ã€‚[TS 38.211 7.3.1.3]</p><table><thead><tr><th style="text-align:center">å±‚æ•°</th><th style="text-align:center">ç å­—æ•°</th><th>ç å­—åˆ°å±‚æ˜ å°„<br>$i = 0,1,â€¦,M_{symb}^{layer}-1$</th></tr></thead><tbody><tr><td style="text-align:center">1</td><td style="text-align:center">1</td><td>$x^{(0)}(i) = d^{(0)}(i)$ $M_{symb}^{layer} = M_{symb}^{(0)}$</td></tr><tr><td style="text-align:center">2</td><td style="text-align:center">1</td><td>$x^{(0)}(i) = d^{(0)}(2i)$<br>$x^{(1)}(i) = d^{(0)}(2i+1)$ $M_{symb}^{layer} = M_{symb}^{(0)}/2$</td></tr><tr><td style="text-align:center">3</td><td style="text-align:center">1</td><td>$x^{(0)}(i) = d^{(0)}(3i)$<br>$x^{(1)}(i) = d^{(0)}(3i+1)$ $M_{symb}^{layer} = M_{symb}^{(0)}/3$<br>$x^{(2)}(i) = d^{(0)}(3i+2)$</td></tr><tr><td style="text-align:center">4</td><td style="text-align:center">1</td><td>$x^{(0)}(i) = d^{(0)}(4i)$<br>$x^{(1)}(i) = d^{(0)}(4i+1)$<br>$x^{(2)}(i) = d^{(0)}(4i+2)$ $M_{symb}^{layer} = M_{symb}<sup>{(0)}/4$&lt;br/&gt;$x</sup>{(3)}(i) = d^{(0)}(4i+3)$</td></tr><tr><td style="text-align:center">5</td><td style="text-align:center">2</td><td>$x^{(0)}(i) = d^{(0)}(2i)$<br>$x^{(1)}(i) = d^{(0)}(2i+1)$<br>$x^{(2)}(i) = d^{(1)}(3i)$ $M_{symb}^{layer} = M_{symb}^{(0)}/2 = M_{symb}<sup>{(1)}/3$&lt;br/&gt;$x</sup>{(3)}(i) = d<sup>{(1)}(3i+1)$&lt;br/&gt;$x</sup>{(4)}(i) = d^{(1)}(3i+2)$</td></tr><tr><td style="text-align:center">6</td><td style="text-align:center">2</td><td>$x^{(0)}(i) = d^{(0)}(3i)$<br>$x^{(1)}(i) = d^{(0)}(3i+1)$<br>$x^{(2)}(i) = d<sup>{(0)}(3i+2)$&lt;br/&gt;$x</sup>{(3)}(i) = d^{(1)}(3i)$ $M_{symb}^{layer} = M_{symb}^{(0)}/3 = M_{symb}<sup>{(1)}/3$&lt;br/&gt;$x</sup>{(4)}(i) = d<sup>{(1)}(3i+1)$&lt;br/&gt;$x</sup>{(5)}(i) = d^{(1)}(3i+2)$</td></tr><tr><td style="text-align:center">7</td><td style="text-align:center">2</td><td>$x^{(0)}(i) = d^{(0)}(3i)$<br>$x^{(1)}(i) = d^{(0)}(3i+1)$<br>$x^{(2)}(i) = d<sup>{(0)}(3i+2)$&lt;br/&gt;$x</sup>{(3)}(i) = d^{(1)}(4i)$ $M_{symb}^{layer} = M_{symb}^{(0)}/3 = M_{symb}<sup>{(1)}/4$&lt;br/&gt;$x</sup>{(4)}(i) = d<sup>{(1)}(4i+1)$&lt;br/&gt;$x</sup>{(5)}(i) = d<sup>{(1)}(4i+2)$&lt;br/&gt;$x</sup>{(6)}(i)=d^{(1)}(4i+3)$</td></tr><tr><td style="text-align:center">8</td><td style="text-align:center">2</td><td>$x^{(0)}(i) = d^{(0)}(4i)$<br>$x^{(1)}(i) = d^{(0)}(4i+1)$<br>$x^{(2)}(i) = d<sup>{(0)}(4i+2)$&lt;br/&gt;$x</sup>{(3)}(i)=d<sup>{(0)}(4i+3)$&lt;br/&gt;$x</sup>{(4)}(i) = d^{(1)}(4i)$ $M_{symb}^{layer} = M_{symb}^{(0)}/4 = M_{symb}<sup>{(1)}/4$&lt;br/&gt;$x</sup>{(5)}(i) = d<sup>{(1)}(4i+1)$&lt;br/&gt;$x</sup>{(6)}(i) = d<sup>{(1)}(4i+2)$&lt;br/&gt;$x</sup>{(7)}(i)=d^{(1)}(4i+3)$</td></tr></tbody></table><p>å¯ä»¥çœ‹åˆ°ï¼Œå•ç å­—æ˜ å°„åˆ°1-4å±‚ï¼ŒåŒç å­—æ˜ å°„åˆ°5-8å±‚ã€‚</p><h2 id="1-4-å¤©çº¿ç«¯å£æ˜ å°„"><a class="header-anchor" href="#1-4-å¤©çº¿ç«¯å£æ˜ å°„">Â¶</a>1.4 å¤©çº¿ç«¯å£æ˜ å°„</h2><p>ç»è¿‡å±‚æ˜ å°„ä¹‹åçš„æ•°æ®æŒ‰ç…§å¦‚ä¸‹æ–¹å¼æ˜ å°„åˆ°å¤©çº¿ç«¯å£ã€‚[TS 38.211 7.3.1.4]<br>$$<br>\left[<br>\begin{matrix}<br>y^{(p_0)}(i)\<br>\vdots\<br>y^{(p_{v-1})}(i)\<br>\end{matrix}<br>\right]= \left[<br>\begin{matrix}<br>x^{(0)}(i)\<br>\vdots\<br>x^{(v-1)}(i)<br>\end{matrix}<br>\right]<br>$$</p><p>å…¶ä¸­ $i=0,1,â€¦,M_{symb}<sup>{ap}-1$ï¼Œ$M_{symb}</sup>{ap}=M_{symb}^{layer}$</p><h2 id="1-5-æ˜ å°„åˆ°è™šæ‹Ÿèµ„æºå¿«"><a class="header-anchor" href="#1-5-æ˜ å°„åˆ°è™šæ‹Ÿèµ„æºå¿«">Â¶</a>1.5 æ˜ å°„åˆ°è™šæ‹Ÿèµ„æºå¿«</h2><p>å¯¹äºæ¯ä¸ªå¤©çº¿æ­¥éª¤ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿèµ„æºç½‘æ ¼ã€‚åœ¨èµ„æºç½‘æ ¼å†…ï¼Œä»REçš„æœ€ä½é¢‘ç‡åˆ°è¾ƒé«˜é¢‘ç‡çš„æ¥è‡ªæ¥å¡«å……PDSCHæ•°æ®åˆ°æ¯ä¸ªREä¸­ã€‚ä¸€æ—¦å®ƒä»¥åˆ†é…çš„PDSCHèµ„æºå—çš„æœ€é«˜é¢‘ç‡åˆ°è¾¾REï¼Œåˆ™ç§»è‡³ä¸‹ä¸€ä¸ªOFDMç¬¦å·çš„æœ€ä½é¢‘ç‡çš„REã€‚[TS 38.211 7.3.1.5]<br>ä½†ä¸åº”ä½¿ç”¨ä¸ºä»¥ä¸‹ç›®çš„è€Œåˆ†é…çš„REï¼š</p><ul><li>åˆ†é…ç»™ä¸è¦å‘é€çš„PDSCHç›¸å…³çš„DMRSçš„RE</li><li>ä¸ºDMRSåˆ†é…ç»™ç”¨äºå…¶ä»–å…±åŒè°ƒåº¦UEçš„RE</li><li>éé›¶åŠŸç‡CSI-RSçš„REï¼Œç”±MeasObjectNR IEä¸­è¾ƒé«˜å±‚å‚æ•°CSI-RS-Resource-Mobilityé…ç½®çš„éé›¶åŠŸç‡CSI-RSé™¤å¤–ã€‚</li><li>PTRSçš„RE</li><li>å£°æ˜ä¸ºâ€œä¸é€‚ç”¨äºPDSCHçš„REâ€</li></ul><h2 id="1-6-ä»è™šæ‹Ÿèµ„æºå—æ˜ å°„åˆ°ç‰©ç†èµ„æºå—"><a class="header-anchor" href="#1-6-ä»è™šæ‹Ÿèµ„æºå—æ˜ å°„åˆ°ç‰©ç†èµ„æºå—">Â¶</a>1.6 ä»è™šæ‹Ÿèµ„æºå—æ˜ å°„åˆ°ç‰©ç†èµ„æºå—</h2><p>ä»VRBåˆ°PRBçš„æ˜ å°„æœ‰äº¤ç»‡å’Œéäº¤ç»‡ä¸¤ç§ã€‚[TS 38.211 7.3.1.6]</p><h3 id="1-6-1-éäº¤ç»‡"><a class="header-anchor" href="#1-6-1-éäº¤ç»‡">Â¶</a>1.6.1 éäº¤ç»‡</h3><p>åœ¨å…¬å…±æœç´¢ç©ºé—´ç”¨DCI Format 1_0è°ƒåº¦çš„PDSCHä¼ è¾“è¿™ç§æƒ…å†µä¸‹,è™šæ‹Ÿèµ„æºå—$n$æ˜ å°„åˆ°ç‰©ç†èµ„æºå— $n + N_{start}^{CORESET}$ ä¸Šï¼Œå…¶ä¸­$N_{start}^{CORESET}$æ˜¯æ¥å—ç›¸åº”DCIçš„æ§åˆ¶èµ„æºé›†ä¸­ç¼–å·æœ€å°çš„ç‰©ç†èµ„æºå—ï¼›<br>é™¤æ­¤æƒ…å†µä¹‹å¤–ï¼Œè™šæ‹Ÿèµ„æºå—$n$å°±æ˜ å°„åˆ°ç‰©ç†èµ„æºå—$n$ä¸Šã€‚<br>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/5G_Protocol/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/non-interleave.png" alt></p><h3 id="1-6-2-äº¤ç»‡"><a class="header-anchor" href="#1-6-2-äº¤ç»‡">Â¶</a>1.6.2 äº¤ç»‡</h3><p>äº¤ç»‡æ˜ å°„æ¨¡å¼ï¼Œä»¥èµ„æºå—æŸ(RB bundle)æ¥å®šä¹‰ï¼Œä¸PDCCHçš„RB bundle ç›¸æ¯”PDSCHçš„èµ„æºå—æŸæœ‰äº›ä¸åŒï¼Œä¸»è¦åˆ†ä¸‰ç§æƒ…å†µï¼š<br><strong>ç±»å‹ä¸€</strong>ï¼š<br>åœ¨CORESET#0çš„Type0-PDCCHå…¬å…±æœç´¢ç©ºé—´ï¼Œç”±SI-RNTIåŠ æ‰°ï¼Œç”¨DCI Format 1_0 è°ƒåº¦çš„PDSCHä¼ è¾“ã€‚<br>ä¸‹è¡Œåˆå§‹æ¿€æ´»çš„BWPï¼Œå¤§å°$N_{BWP,init}^{size}$ï¼Œåˆ†ä¸º$N_{bundle} = \lceil N_{BWP,init}^{size}/L \rceil$ ä¸ªRB bundleï¼ŒæŒ‰ç…§RBç¼–å·å’ŒæŸç¼–å·å‡åºæ’åºã€‚å…¶ä¸­$L$æ˜¯bundleçš„å¤§å°ï¼Œå–å€¼ä¸ºï¼’ã€‚å¦‚æœ$N_{BWP,init}^{size}$ä¸èƒ½æ•´æ•°Lï¼Œæœ€åä¸€ä¸ªRB bundleåŒ…å« $N_{BWP,init}^{size}modL$ä¸ªRBï¼Œå…¶å®ç”±äº$L = 2$æ‰€ä»¥æœ€åä¸€ä¸ªä¸èƒ½æ•´æ•°çš„è¯é‚£å°±å‰©ä¸‹ä¸€ä¸ªRBï¼Œèƒ½æ•´æ•°é™¤æœ€åä¸€ä¸ªRB bundleå°±æ˜¯2ä¸ªRBã€‚<br>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><br><img src="/5G_Protocol/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/interleaver1.png" alt></p><p><strong>ç±»å‹äºŒ</strong>ï¼š<br>é™¤ä¸Šè¿°æƒ…å†µå¤–ï¼Œåœ¨å…¬å…±æœç´¢ç©ºé—´ç”±DCI Format 1_0è°ƒåº¦çš„PDSCHä¼ è¾“ã€‚<br>BWPèµ·å§‹ä½ç½®$N_{BWP,i}<sup>{start}$ï¼Œå¤§å°ä¸º$N_{BWP,init}</sup>{size}$ çš„VRBé›†åˆ${0,1,â€¦,N_{BWP,init}^{size}-1}$ åˆ†ä¸º$N_{bundle}$ ä¸ªè™šæ‹ŸRB bundleï¼Œç›¸åº”çš„$N_{BWP,init}^{size}$ ä¸ªPRBé›†åˆ${N_{start}<sup>{CORESET},N_{start}</sup>{CORESET}+1,â€¦,N_{start}<sup>{CORESET}+N_{BWP,init}</sup>{size}}$ åˆ†ä¸º$N_{bundle}$ ä¸ªç‰©ç†RB bundleï¼Œå…¶ä¸­$N_{bundle}=\lceil (N_{BWP,init}<sup>{size}+(N_{BWP.i}</sup>{start}+N_{start}^{CORESET})modL)/L \rceil$ ï¼ŒLæ˜¯bundleçš„å¤§å°ï¼Œå–å€¼ä¸º2ï¼Œ$N_{start}^{CORESET}$æ˜¯æ¥å—ç›¸åº”DCIçš„æ§åˆ¶èµ„æºé›†ä¸­ç¼–å·æœ€å°çš„ç‰©ç†èµ„æºå—ã€‚</p><p><img src="/5G_Protocol/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/interleave2.png" alt></p><p>å…¶RB bundle åŒ…å«çš„RBæ•°å¦‚ä¸‹æè¿°ï¼š</p><ul><li>0å·RB bundle åŒ…å«äº†$L-((N_{BWP,i}<sup>{start}+N_{start}</sup>{CONRESET})modL)$ä¸ªRBï¼›</li><li>å¦‚æœ$(N_{BWP,init}<sup>{size}+N_{BWP,i}</sup>{start}+N_{start}^{CONRESET})modL&gt;0$ï¼Œåˆ™æœ€åä¸€ä¸ªRB bundleåŒ…å«äº†$(N_{BWP,init}<sup>{size}+N_{BWP,i}</sup>{start}+N_{start}^{CONRESET})modL$ ä¸ªRBï¼Œå¦åˆ™åŒ…å«$L$ä¸ªRBï¼›</li><li>å…¶ä½™RB bundle åŒ…å«$L$ ä¸ªRBï¼›<br>ä¹‹æ‰€ä»¥è¦è€ƒè™‘è¿›$N_{start}^{CONRESET}$ï¼Œæ˜¯å› ä¸º38.214ä¸­è§„å®šï¼Œå¯¹äºä»»ä½•åœ¨PDCCHå…¬å…±æœç´¢ç©ºé—´ä¸­ä»¥DCI format 1_0è°ƒåº¦çš„PDSCHä¼ è¾“ï¼Œå…¶RBç¼–å·ä»æ¥å—DCIçš„CORESETçš„æœ€ä½RBå¼€å§‹ã€‚</li></ul><p><strong>ç±»å‹ä¸‰</strong>ï¼š<br>å…¶ä»–PDSCHä¼ è¾“ã€‚<br>BWPï¼Œiçš„èµ·å§‹ä½ç½®$N_{BWP,i}<sup>{start}$ï¼Œå¤§å°$N_{BWP,i}</sup>{size}$ï¼Œåˆ†ä¸º$N_{bundle}$ ä¸ªRB bundle ä¸”æŒ‰ç…§RBç¼–å·å’ŒæŸç¼–å·çš„å‡åºæ’åˆ—ï¼Œå…¶ä¸­$N_bundle = \lceil(N_{BWP,init}<sup>{size}+(N_{BWP,i}</sup>{start}modL_i))/L_i \rceil$ï¼Œ$L_i$ æ˜¯bundleçš„å¤§å°ï¼Œç”±é«˜å±‚å‚æ•°vrb- ToPRB-Interleaveré…ç½®ã€‚<br><br><img src="/5G_Protocol/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/interleave3.png" alt></p><p>å…¶RB bundle åŒ…å«çš„RBæ•°å¦‚ä¸‹æè¿°ï¼š</p><ul><li>0å·RB bundleåŒ…å«äº†$L_i-(N_{BWP,i}^{start}modL_i)$ä¸ªRBï¼Œç›®çš„æ˜¯ä¸ºäº†ä»ä¸‹ä¸€ä¸ªbundleå¼€å§‹ï¼Œæ¯ä¸ªbundleçš„èµ·å§‹ä½ç½®éƒ½æ˜¯$L_i $çš„æ•´æ•°å€ï¼›</li><li>å¦‚æœ$(N_{BWP,i}<sup>{start}+N_{BWP,i}</sup>{size})modL_i&gt;0$ï¼Œæœ€åä¸€ä¸ªRB bundleåŒ…å«äº†$(N_{BWP,i}<sup>{start}+N_{BWP,i}</sup>{size})modL_i$ ä¸ªRBï¼Œå¦åˆ™åŒ…å«$L_i$ ä¸ªRBï¼›</li><li>å…¶ä½™RB bundle åŒ…å«$L_i$ ä¸ªRBã€‚</li></ul><p>ä¸¾ä¸ªä¾‹å­æ¥æè¿°ç±»å‹ä¸‰ï¼š<br>ä¾‹å­ï¼šå‡è®¾$N_{BWP,i}^{start} = 5,N_{BWP,i}^{size} = 21$</p><ol><li>$L_i=5$<br>$N_{bundle} = \lceil(N_{BWP,init}<sup>{size}+(N_{BWP,i}</sup>{start}modL_i))/L_i \rceil = \lceil(21+(5mod5))/5 \rceil = 5$<br>$N_{bundle,0} = L_i-(N_{BWP,i}^{start}modL_i) = 5-(5mod5) =5$<br>$N_{bundle,end} = (N_{BWP,i}<sup>{start}+N_{BWP,i}</sup>{size})modL_i = (5+21)mod5 = 1$<br>$N_{bundle,other} = L_i = 5$<br>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</li></ol><p><img src="/5G_Protocol/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/case1.png" alt></p><ol start="2"><li>$L_i=4$<br>$N_bundle = \lceil(N_{BWP,init}<sup>{size}+(N_{BWP,i}</sup>{start}modL_i))/L_i \rceil = \lceil(21+(5mod4))/4 \rceil = 6$<br>$N_{bundle,0} = L_i-(N_{BWP,i}^{start}modL_i) = 4-(5mod4) =3$<br>$N_{bundle,end} = (N_{BWP,i}<sup>{start}+N_{BWP,i}</sup>{size})modL_i = (5+21)mod4 = 2$<br>$N_{bundle,other} = L_i = 4$<br>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</li></ol><p><img src="/5G_Protocol/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/case2.png" alt></p><h3 id="1-6-3-VRB-bundle-åˆ°-PRB-bundle-çš„æ˜ å°„"><a class="header-anchor" href="#1-6-3-VRB-bundle-åˆ°-PRB-bundle-çš„æ˜ å°„">Â¶</a>1.6.3 VRB bundle åˆ° PRB bundle çš„æ˜ å°„</h3><p>æœ¬èŠ‚æ¥çœ‹å±äº$j\in {0,1,â€¦,N_{bundle}-1}$ åŒºé—´å†…çš„è™šæ‹ŸRBå‘ç‰©ç†RBçš„æ˜ å°„ï¼š</p><ul><li>$N_bundle - 1$å·è™šæ‹ŸRB bundleæ˜ å°„åˆ°$N_{bundle}-1$å·ç‰©ç†RB bundleï¼›</li><li>å…¶ä½™$j\in {0,1,â€¦,N_{bundle}-2}$ çš„è™šæ‹ŸRB bundle éµå¾ª$f(j)$ å‡½æ•°æ˜ å°„åˆ°ç‰©ç†RB bundle<br>$$<br>f(j) = rC+c\j = cR+r\r = 0,1,â€¦,R-1\c = 0,1,â€¦,C-1\R = 2\C = \lfloor N_{bundle}/R \rfloor<br>$$</li></ul><p>ä¸¾ä¸ªä¾‹å­è¯´æ˜ï¼Œè¿ç”¨ä¸Šé¢çš„ä¾‹å­æ•°æ®:</p><ol><li>$R = 2; \quad C = \lfloor N_{bundle}/R \rfloor = \lfloor 5/2 \rfloor = 2;\quad r = 0,1,2;\quad c = 0,1,2$ã€‚</li></ol><table><thead><tr><th>c</th><th>r</th><th>j: VRB bundle</th><th>$f(j)$: PRB bundle</th></tr></thead><tbody><tr><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><td>0</td><td>1</td><td>1</td><td>2</td></tr><tr><td>1</td><td>0</td><td>2</td><td>1</td></tr><tr><td>1</td><td>1</td><td>3</td><td>3</td></tr></tbody></table><p>æ˜ å°„ç»“æœå¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="/5G_Protocol/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/case31.png" alt></p><ol start="2"><li>$R = 2; \quad C = \lfloor N_{bundle}/R \rfloor = \lfloor 6/2 \rfloor = 3;\quad r = 0,1;\quad c = 0,1,2$ã€‚</li></ol><table><thead><tr><th>c</th><th>r</th><th>j: VRB bundle</th><th>$f(j)$: PRB bundle</th></tr></thead><tbody><tr><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><td>0</td><td>1</td><td>1</td><td>3</td></tr><tr><td>1</td><td>0</td><td>2</td><td>1</td></tr><tr><td>1</td><td>1</td><td>3</td><td>4</td></tr><tr><td>2</td><td>0</td><td>4</td><td>2</td></tr><tr><td>2</td><td>1</td><td>5</td><td>5</td></tr></tbody></table><p>æ˜ å°„ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/5G_Protocol/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/case32.png" alt></p><h1>2 PDSCH DMRS</h1><h2 id="2-1-åºåˆ—ç”Ÿæˆ"><a class="header-anchor" href="#2-1-åºåˆ—ç”Ÿæˆ">Â¶</a>2.1 åºåˆ—ç”Ÿæˆ</h2><p>PDSCH DMRSåºåˆ—æœ‰å¦‚ä¸‹å…¬å¼ç”Ÿæˆï¼š<br>$$<br>r(n) = \frac{1}{\sqrt{2}}(1-2\cdot c(2n))+j\frac{1}{\sqrt{2}}(1-2\cdot c(2n+1))<br>$$<br>åŠ æ‰°åºåˆ—é‡‡ç”¨31é˜¶Goldåºåˆ—ç”Ÿæˆï¼ŒåŠ æ‰°åºåˆ—çš„åˆå§‹åºåˆ—$c_{init}$å¦‚ä¸‹å¼æ‰€ç¤º:<br>$$<br>c_{init} = (2<sup>{17}(N_{symb}</sup>{slot}n_{s,f}<sup>{\mu}+l+1)(2N_{ID}</sup>{n_{SCID}}+1)+2N_{ID}<sup>{n_{SCID}}+n_{SCID})mod2</sup>{31}<br>$$</p><p>å…¶ä¸­ï¼š</p><ul><li>$l$ ä¸ºæ—¶éš™ä¸­çš„ç¬¦å·ç´¢å¼•</li><li>$n_{s,f}$ ä¸ºæ—¶éš™ç´¢å¼•</li><li>$N_{symb}^{slot}$ ä¸ºä¸€ä¸ªæ—¶éš™å†…çš„ç¬¦å·æ•°é‡</li><li>$n_{SCID},N_{ID}^{n_{SCID}}$ :<br><strong>1) å¯¹äºC-RNTI/MCS-C-RNTI/CS-RNTI</strong><br>â‘  DCI format 1_1 , $n_{SCID}$ å¯ç”±DMRS-DownlinkConfig IEä¸­scramblingID0,scramblingID1é…ç½®,å¯ä»¥åœ¨$N_{ID}<sup>0,N_{ID}</sup>1$ä¹‹é—´é€‰æ‹©,$N_{ID}<sup>{0},N_{ID}</sup>{1}\in {0,1,â€¦,65535}$ã€‚<br>â‘¡ DCI format 1_1 , $n_{SCID}$ å¯ç”±DMRS-DownlinkConfig IEä¸­scramblingID0é…ç½®,å¯ä»¥åœ¨$N_{ID}<sup>0$ä¹‹é—´é€‰æ‹©,$N_{ID}</sup>{0}\in {0,1,â€¦,65535}$ã€‚<br>â‘¢ å¦‚æœâ‘ DMRS-DownlinkConfig IEä¸­scramblingID0,scramblingID1éƒ½æœªé…ç½®,åˆ™$n_{SCID}=0,N_{ID}<sup>{n_{SCID}}=N_{ID}</sup>{cell}$ã€‚<br>â‘£ å¦‚æœâ‘¡DMRS-DownlinkConfig IEä¸­scramblingID0æœªé…ç½®ï¼Œåˆ™$n_{SCID}=0,N_{ID}<sup>{n_{SCID}}=N_{ID}</sup>{cell}$ã€‚<br><strong>ï¼’) å¯¹äºSI-RNTI/P-RNTI/RA-RNTI</strong><br>$n_{SCID}=0,N_{ID}<sup>{n_{SCID}}=N_{ID}</sup>{cell}$ã€‚</li></ul><p>é«˜å±‚é…ç½®å‚æ•°DMRS-DownlinkConfigå†…å®¹å¦‚ä¸‹ï¼š</p><p><img src="/5G_Protocol/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/DMRS-DLconfig.png" alt></p><h2 id="2-2-PDSCH-DMRS-é¢‘åŸŸä½ç½®"><a class="header-anchor" href="#2-2-PDSCH-DMRS-é¢‘åŸŸä½ç½®">Â¶</a>2.2 PDSCH DMRS é¢‘åŸŸä½ç½®</h2><p>DMRSæ˜ å°„æ–¹å¼åˆ†ä¸ºConfiguration type 1 å’Œconfiguration type 2 ä¸¤ç§ï¼Œæœ‰DMRS-DownlinkConfigä¸­çš„drms-typeæŒ‡ç¤ºï¼Œå¦‚æœæœªé…ç½®ï¼Œåˆ™é»˜è®¤ä¸ºConfiguration type 1ã€‚<br>åºåˆ—æ˜ å°„åˆ°REçš„å…¬å¼å¦‚ä¸‹æ‰€ç¤ºï¼š<br>$$<br>\alpha_{k,l}<sup>{p,\mu}=\beta_{PDSCH}</sup>{DMRS}w_f(kâ€™)w_t(lâ€™)r(2n+kâ€™)\k = \begin{cases}4n+2kâ€™+\Delta \quad \quad Configuration\quad type\quad1\6n+kâ€™+\Delta\quad \quad Configuration\quad type\quad 2 \end{cases}\kâ€™=0,1\l=\overline{l}+lâ€™\n = 0,1,â€¦<br>$$</p><p>$k$ä¸ºé¢‘åŸŸæŒ‡ç¤ºï¼Œ$l$ä¸ºæ—¶åŸŸæŒ‡ç¤ºã€‚Configuration type 1 å’Œconfiguration type 2ï¼Œåˆ†åˆ«ç”¨äºæ”¯æŒå•ç”¨æˆ·MIMOå’Œå¤šç”¨æˆ·MIMOã€‚é™¤æ­¤ä¹‹å¤–ï¼Œç”±äºç±»å‹1å’Œç±»å‹2å¹³å‡æ¯ä¸ªç«¯å£å ç”¨çš„REæ•°é‡ä¸åŒï¼Œå³æ¯ä¸ªç«¯å£çš„REå¯†åº¦ä¸åŒï¼Œæ‰€ä»¥å„è‡ªæœ‰ä¸åŒçš„é€‚ç”¨åœºæ™¯ã€‚ç±»å‹1æ›´é€‚åˆä½ä¿¡å™ªæ¯”ã€é¢‘åŸŸé€‰æ‹©æ€§è¾ƒé«˜çš„åœºæ™¯ï¼Œç±»å‹2æ›´é€‚åˆé«˜ä¿¡å™ªæ¯”ã€æ—¶å»¶æ‰©å±•è¾ƒå°çš„åœºæ™¯ã€‚</p><p>é¢‘åŸŸæŒ‡ç¤º$k$çš„å‚è€ƒç‚¹åˆ†ä¸¤ç§æƒ…å†µï¼š</p><ul><li>æ‰¿è½½SIB1çš„PDSCHçš„DMRSï¼Œ$k$çš„å‚è€ƒç‚¹ä¸ºCORESET#0çš„RE0ï¼›</li><li>å…¶ä½™æƒ…å†µå‚è€ƒç‚¹ä¸ºCRB#0çš„RE0å³point Aã€‚</li></ul><p>ä»¥ä¸‹å›¾ç¤ºåˆ†åˆ«å±•ç¤ºäº†Configuration type 1 å’Œconfiguration type 2ä¸¤ç§æƒ…å†µä¸‹çš„DMRSé¢‘åŸŸä½ç½®ï¼Œä¸ºäº†æ–¹ä¾¿åªé€‰å–äº†1RBå·¦å³å¤§å°ï¼Œéƒ½æ˜¯single symbolã€‚<br>Configuration type 1ï¼š</p><p><img src="/5G_Protocol/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/DMRS%E9%A2%91%E5%9F%9F%E5%88%86%E6%9E%901.png" alt></p><p></p><p>Configuration type 2:</p><p><img src="/5G_Protocol/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/DMRS%E9%A2%91%E5%9F%9F%E5%88%86%E6%9E%902.png" alt></p><h2 id="2-3-PDSCH-DMRS-çš„ç¬¦å·ä½ç½®"><a class="header-anchor" href="#2-3-PDSCH-DMRS-çš„ç¬¦å·ä½ç½®">Â¶</a>2.3 PDSCH DMRS çš„ç¬¦å·ä½ç½®</h2><p>DMRSçš„ç¬¦å·ä½ç½®å–å†³äºPDSCHçš„mapping typeï¼Œåˆ†ä¸ºmapping type Aå’Œmapping type Bï¼Œå‚è€ƒè¡¨æ ¼æˆ–è€…é…ç½®å¯ä»¥è·å¾—PDSCHçš„mapping typeï¼Œä»¥åŠå¯¹åº”çš„$k_0,S,L$ã€‚[TS 38.214 5.1.2.1]<br><br><img src="/5G_Protocol/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/Table5.1.2.1-1.png" alt><br><br>æ—¶åŸŸæŒ‡ç¤º$l$çš„å‚è€ƒç‚¹åˆ†ä¸¤ç§æƒ…å†µï¼š</p><ul><li>PDSCH mapping type Aï¼šæ—¶åŸŸæŒ‡ç¤º$l$çš„å‚è€ƒç‚¹ä¸ºæ—¶éš™çš„èµ·å§‹symbolï¼Œä¸”DM-RSçš„ç¬¬ä¸€ä¸ªç¬¦å·ä½ç½®ä¸º3æˆ–4(è¡¨ä¸­S = 2ï¼Œ3)ï¼Œç”±MIBä¸­å‚æ•°dmrs-TypeA-PositionæŒ‡ç¤ºï¼Œä¸»è¦è€ƒè™‘PDCCHçš„å…·ä½“é…ç½®ã€‚</li><li>PDSCH mapping type Bæ—¶ï¼Œ$l$çš„å‚è€ƒç‚¹ä¸ºPDSCHçš„èµ·å§‹symbolï¼ŒDM-RSä»PDSCHè°ƒåº¦åŒºåŸŸçš„ç¬¬ä¸€ä¸ªç¬¦å·å¼€å§‹ä¼ è¾“ã€‚<br>ä¸¤ç§æƒ…å†µå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br>ä¾‹å­ä¸€ï¼štype Aï¼Œ$S = 3 , L = 7$, $l_0$ çš„å¤§å°æ˜¯ä¸å‚è€ƒç‚¹çš„å·®å€¼ï¼Œè¡¨ç¤ºDMRSçš„åˆå§‹ç¬¦å·ã€‚</li></ul><p><img src="/5G_Protocol/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/DMRS%E6%97%B6%E5%9F%9F1.png" alt></p><p>ä¾‹å­äºŒï¼štype Bï¼Œ$S = 6 , L = 4$, $l_0$ çš„å¤§å°æ˜¯ä¸å‚è€ƒç‚¹çš„å·®å€¼ï¼Œè¡¨ç¤ºDMRSçš„åˆå§‹ç¬¦å·ã€‚</p><p><img src="/5G_Protocol/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/DMRS%E6%97%B6%E5%9F%9F2.png" alt></p><h2 id="2-4-DMRS-ç¬¦å·ç±»å‹"><a class="header-anchor" href="#2-4-DMRS-ç¬¦å·ç±»å‹">Â¶</a>2.4 DMRS ç¬¦å·ç±»å‹</h2><p>DMRSä¸¤ä¸ªsymbolç±»å‹ï¼Œsingle symbol å’Œ double symbolã€‚å–å†³äºDMRS-DownlinkConfigä¸­çš„maxLengthå‚æ•°çš„é…ç½®ï¼ŒmaxLengthé…ç½®ä¸ºlen1ï¼Œåˆ™å–å€¼ä¸ºlen1ï¼ˆsingle-symbolï¼‰ï¼›å¦‚æœé…ç½®ä¸ºlen2ï¼ˆdouble-symbolï¼‰ã€‚å¦‚æœé«˜å±‚å‚æ•°maxLengthæ²¡æœ‰é…ç½®ï¼Œåˆ™ä¸ºsingleç±»å‹ã€‚</p><h2 id="2-5-æ·»åŠ å¯¼é¢‘"><a class="header-anchor" href="#2-5-æ·»åŠ å¯¼é¢‘">Â¶</a>2.5 æ·»åŠ å¯¼é¢‘</h2><p>åœ¨NRä¸­çš„ä¸­/é«˜é€Ÿåœºæ™¯ä¸­ï¼Œä¸ºäº†ä¿è¯ä¼°è®¡ç²¾åº¦ï¼Œé™¤äº†å‰ç½®å¯¼é¢‘(å‰æ–‡æ‰€æè¿°çš„DMRS)å¤–ï¼ŒåŠ å…¥äº†ä¸å‰ç½®å¯¼é¢‘TDMçš„é™„åŠ å¯¼é¢‘ï¼Œé™„åŠ DM-RSç»“æ„ä¸å‰ç½®DM-RSçš„å›¾æ ·ç›¸åŒï¼Œåœ¨double symbol DM-RSæƒ…å†µä¸‹ï¼Œæœ€å¤šå¯ä»¥é…ç½®1ç»„é™„åŠ å¯¼é¢‘ï¼Œåœ¨single symbolå‰ç½®DM-RSæƒ…å†µä¸‹æœ€å¤šå¯ä»¥é…ç½®3ç»„é™„åŠ å¯¼é¢‘ã€‚é™„åŠ å¯¼é¢‘çš„æ•°é‡ä¸è°ƒåº¦æ—¶é•¿æœ‰å…³ï¼Œæ—¶åŸŸä½ç½®ç”±é«˜å±‚å‚æ•°dmrs-AdditionalPositionæŒ‡ç¤º,å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p><p><img src="/5G_Protocol/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/%E6%B7%BB%E5%8A%A0%E5%AF%BC%E9%A2%91%E5%8D%95%E7%AC%A6%E5%8F%B7.png" alt></p><p><img src="/5G_Protocol/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/%E6%B7%BB%E5%8A%A0%E5%AF%BC%E9%A2%91%E5%8F%8C%E7%AC%A6%E5%8F%B7.png" alt></p><p>å½“PDSCH mapping type Bæ—¶ï¼Œå¦‚æœPDSCHçš„èµ„æºå’ŒCORESETç›¸é‡å ï¼Œåˆ™PDSCH DM-RSè¦å¾€åé¡ºå»¶åˆ°ç´§æŒ¨CORESETçš„åé¢ï¼Œæ­¤æ—¶ï¼Œå¦‚æœPDSCHçš„durationä¸º2æ—¶ï¼ŒDM-RSçš„èµ·å§‹ä½ç½®ä¸èƒ½è¶…è¿‡PDSCHçš„ç¬¬äºŒä¸ªsymbolï¼Œå½“PDSCHçš„durationä¸º4æ—¶ï¼ŒDM-RSçš„èµ·å§‹ä½ç½®ä¸èƒ½è¶…è¿‡PDSCHçš„ç¬¬3ä¸ªsymbolï¼Œå½“PDSCHçš„durationä¸º7æ—¶ï¼ŒDM-RSçš„ç¬¬ä¸€ä¸ªsymbolä¸èƒ½è¶…è¿‡PDSCHçš„ç¬¬4ä¸ªsymbolã€‚<br>(Note: ä»¥ä¸Šæ‰€è¯´çš„PDSCHçš„durationï¼Œä¹Ÿå°±æ˜¯$L$ï¼ŒåŒæ—¶ä¹Ÿæ˜¯$l_d$ ï¼Œéƒ½æ˜¯ä¸€ä¸ªæ„æ€)<br><br>ä¸¾ä¸ªä¾‹å­æ¥è¯´æ˜ä¸Šé¢ä¸¤ä¸ªè¡¨çš„æ„æ€ï¼š<br>$S = 2,L=11$,maxLengthé…ç½®ä¸ºlen1ï¼Œå³ä¸ºsingle symbol ,æŒ‰ç…§ç¬¬ä¸€ä¸ª è¡¨æ ¼ï¼Œå¦‚æœæ­¤æ—¶$l_d = 11$ PDSCH mapping type A , dmrs-AdditionalPositionæŒ‡ç¤ºä¸º2ï¼Œåˆ™ä»£è¡¨åœ¨DMRSå¯¼é¢‘ä½ç½®åˆ†åˆ«åœ¨DMRSåˆå§‹ä½ç½®$l_0$(è‹¥ä¸º$l_0=2$),#6,#9ç¬¦å·ä¸Šã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/5G_Protocol/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/%E6%B7%BB%E5%8A%A0%E5%AF%BC%E9%A2%91%E4%BE%8B%E5%AD%90.png" alt></p><h2 id="2-6-ç«¯å£æ˜ å°„"><a class="header-anchor" href="#2-6-ç«¯å£æ˜ å°„">Â¶</a>2.6 ç«¯å£æ˜ å°„</h2><p>ç»“åˆPDSCH DMRSåºåˆ—ç”ŸæˆåŠæ˜ å°„å…¬å¼ï¼Œä»¥åŠä¸‹è¡¨å¯çŸ¥ï¼š</p><p><img src="/5G_Protocol/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/Table7.4.1.1.2-12.png" alt></p><p><img src="/5G_Protocol/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/Table7.4.1.1.2-5.png" alt></p><ul><li>type 1ï¼Œsingle symbolæƒ…å†µä¸‹ï¼Œæœ€å¤šæ”¯æŒ4ä¸ªç«¯å£ï¼Œç«¯å£0ï¼Œ1å’Œ2ï¼Œ3åˆ†åˆ«åœ¨ä¸åŒçš„CDM groupï¼Œæ¯ä¸ªCDM groupå†…ï¼Œæ¯”å¦‚ç«¯å£0å’Œ1ï¼Œåˆé€šè¿‡é¢‘åŸŸçš„OCCæ¥å®ç°æ­£äº¤ï¼Œä»è€Œå®ç°4ä¸ªç«¯å£çš„æ­£äº¤ã€‚</li><li>type 1ï¼Œdouble symbolæƒ…å†µä¸‹ï¼Œæœ€å¤šæ”¯æŒ8ä¸ªç«¯å£ï¼Œé™¤äº†é¢‘åŸŸOCCå¤–ï¼Œè¿˜å¯ä»¥æ—¶åŸŸOCCæ¥å®ç°æ­£äº¤ï¼Œæ‰€ä»¥å¯ä»¥æ”¯æŒæ›´å¤šçš„ç«¯å£ã€‚</li><li>type 2ï¼Œsingle symbolæƒ…å†µä¸‹ï¼Œæœ€å¤šæ”¯æŒ6ä¸ªç«¯å£ï¼Œå…±ä¸‰ä¸ªCDM groupï¼Œæ¯ä¸ªgroupå†…åˆé€šè¿‡é¢‘åŸŸOCCå®ç°æ­£äº¤ã€‚</li><li>type 2ï¼Œdouble symbolæƒ…å†µä¸‹ï¼Œæœ€å¤šæ”¯æŒ12ä¸ªç«¯å£ï¼Œä¸ç±»å‹1åŒç¬¦å·æƒ…å†µåŒç†ï¼Œé™¤äº†é¢‘åŸŸOCCå¤–ï¼Œè¿˜å¯ä»¥æ—¶åŸŸOCCï¼Œä»è€Œæ”¯æŒæ›´å¤šçš„ç«¯å£ã€‚</li></ul><p>é—®é¢˜ï¼šç«¯å£ï¼Œå±‚æ–¹é¢</p><h1>3 PDSCH PTRS</h1><h2 id="3-1-ç›¸ä½å™ªå£°"><a class="header-anchor" href="#3-1-ç›¸ä½å™ªå£°">Â¶</a>3.1 ç›¸ä½å™ªå£°</h2><p>ç›¸ä½å™ªå£°æŒ‡å°„é¢‘å™¨ä»¶åœ¨å„ç§å™ªå£°ï¼ˆå¦‚éšæœºæ€§ç™½å™ªå£°ã€é—ªçƒå™ªå£°ï¼‰çš„ä½œç”¨ä¸‹å¼•èµ·çš„ç³»ç»Ÿè¾“å‡ºä¿¡å·ç›¸ä½çš„éšæœºå˜åŒ–ã€‚ç›¸ä½å™ªå£°ä¼šæ¶åŒ–æ¥æ”¶ç«¯çš„SNRï¼ˆSignal-Noise Ratioä¿¡å™ªæ¯”ï¼‰æˆ–EVMï¼ˆError Vector Magnitudeè¯¯å·®å‘é‡å¹…åº¦ï¼‰ï¼Œé€ æˆå¤§é‡çš„è¯¯ç ï¼Œè¿™æ ·å°±é™åˆ¶äº†é«˜é˜¶è°ƒåˆ¶çš„ä½¿ç”¨ï¼Œä¼šä¸¥é‡å½±å“ç³»ç»Ÿçš„å®¹é‡ã€‚<br>ç›¸å¯¹æ¥è¯´ï¼Œç›¸ä½å™ªå£°å¯¹ä½é¢‘æ®µï¼Œä¹Ÿå°±æ˜¯sub6Gé¢‘æ®µçš„å½±å“è¾ƒå°ä¸€äº›ã€‚è€Œé«˜é¢‘æ®µï¼ˆæ¯«ç±³æ³¢ï¼‰ä¸‹ï¼Œç”±äºå‚è€ƒæ—¶é’Ÿæºçš„å€é¢‘æ¬¡æ•°å¤§å¹…å¢åŠ ä»¥åŠå™¨ä»¶çš„å·¥è‰ºæ°´å¹³å’ŒåŠŸè€—ç­‰å„æ–¹é¢çš„åŸå› ï¼Œç›¸ä½å™ªå£°çš„å½±å“ä¹Ÿæ˜¯å¤§å¹…å¢åŠ ã€‚<br>ä¸ºäº†åº”å¯¹é«˜é¢‘æ®µä¸‹çš„ç›¸ä½å™ªå£°ï¼Œé™¤äº†å¢å¤§å­è½½æ³¢é—´éš”ã€æé«˜å™¨ä»¶è´¨é‡ä¹‹å¤–ï¼Œ5G NRå¼•å…¥äº†PT-RSï¼ˆPhase Tracking Reference Signalï¼‰ä¿¡å·ä»¥åŠç›¸ä½ä¼°è®¡è¡¥å¿ç®—æ³•ã€‚</p><h2 id="3-2-åºåˆ—ç”Ÿæˆ"><a class="header-anchor" href="#3-2-åºåˆ—ç”Ÿæˆ">Â¶</a>3.2 åºåˆ—ç”Ÿæˆ</h2><p>ç”Ÿæˆåºåˆ—æ–¹å¼ä¸PDSCH DMRSç›¸åŒã€‚</p><h2 id="3-3-é«˜å±‚é…ç½®"><a class="header-anchor" href="#3-3-é«˜å±‚é…ç½®">Â¶</a>3.3 é«˜å±‚é…ç½®</h2><p>ä¸‹è¡Œæ˜¯å¦é…ç½®äº†PT-RSï¼Œç”±DMRS-DownlinkConfigä¸­çš„å­—æ®µphaseTrackingRSæ¥å†³å®šï¼Œå¦‚æœè¯¥å­—æ®µç¼ºçœæˆ–é…ç½®ä¸ºreleasedï¼Œåˆ™è¡¨ç¤ºä¸‹è¡Œæ²¡æœ‰PT-RSä¿¡å·ã€‚PT-RSçš„å…·ä½“é…ç½®åœ¨PTRS-DownlinkConfigä¸­ï¼š</p><p><img src="/5G_Protocol/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/PTRS.png" alt></p><p><strong>frequencyDensity</strong><br>frequencyDensityæä¾›äº†ä¸¤ä¸ªå€¼ï¼Œè¿™ä¸¤ä¸ªå€¼éƒ½åœ¨ï¼ˆ1,276ï¼‰çš„èŒƒå›´å†…ï¼Œåˆ†åˆ«å¯¹åº”äº†[TS 38.214-Table5.1.6.3-2]ä¸­çš„$N_{RB0},N_{RB1}$ï¼ŒUEå†é€šè¿‡DCIä¸­çš„è°ƒåº¦RBæ•°æŸ¥è¯¢è¯¥è¡¨ï¼Œå°±å¯ä»¥ç¡®å®šPT-RSçš„é¢‘åŸŸå¯†åº¦$K_{PTâˆ’RSK}$ ã€‚å¦‚æœè°ƒåº¦RBæ•°è¿‡å°‘ï¼Œå³$N_{RB}&lt;N_{RB0}$ æ—¶ï¼ŒPT-RSçš„ç³»ç»Ÿå¼€é”€ç›¸å¯¹æ¥è¯´å°±å¤ªå¤§äº†ï¼Œè¿™ä¸ªæ—¶å€™ä¸‹è¡Œæ²¡æœ‰PT-RSä¿¡å·ã€‚</p><table><thead><tr><th style="text-align:center">scheduled bandwidth</th><th style="text-align:center">Frequency density ($K_{PT-RS}$)</th></tr></thead><tbody><tr><td style="text-align:center">$N_{RB}&lt;N_{RB0}$</td><td style="text-align:center">PT-RS is not present</td></tr><tr><td style="text-align:center">$N_{RB0}&lt;N_{RB}&lt;N_{RB1}$</td><td style="text-align:center">2</td></tr><tr><td style="text-align:center">$N_{RB1}&lt;N_{RB}$</td><td style="text-align:center">4</td></tr></tbody></table><p><strong>timeDensity</strong><br>timeDensityæä¾›äº†ä¸‰ä¸ªèŒƒå›´åœ¨ï¼ˆ0,29ï¼‰çš„å€¼ï¼Œåˆ†åˆ«å¯¹åº”[TS 38.214-Table5.1.6.3-1]ä¸­çš„ptrs-MCS1ã€ptrs-MCS2ã€ptrs-MCS3ï¼ŒUEå†é€šè¿‡DCIä¸­çš„è°ƒåº¦MCSä¿¡æ¯å°±å¯ä»¥ç¡®å®šPT-RSçš„æ—¶åŸŸå¯†åº¦(é—´éš”)$L_{PTâˆ’RS}$ï¼Œè¡¨ä¸­çš„ptrs-MCS4æ²¡æœ‰åœ¨é«˜å±‚å‚æ•°ä¸­æ˜ç¡®é…ç½®ï¼ŒUEå¯ä»¥å‡å®šè¯¥å€¼ä¸ºå½“å‰å¯ä½¿ç”¨çš„æœ€å¤§MCS+1ã€‚</p><table><thead><tr><th style="text-align:center">scheduled MCS</th><th style="text-align:center">Time density ($L_{PT-RS}$)</th></tr></thead><tbody><tr><td style="text-align:center">$ptrs-MCS1\leq l_{MCS}&lt;ptrs-MCS2$</td><td style="text-align:center">4</td></tr><tr><td style="text-align:center">$ptrs-MCS2\leq l_{MCS}&lt;ptrs-MCS3$</td><td style="text-align:center">2</td></tr><tr><td style="text-align:center">$ptrs-MCS3\leq l_{MCS}&lt;ptrs-MCS4$</td><td style="text-align:center">1</td></tr></tbody></table><p><strong>epre-Ratio</strong><br>epre-Ratioé€šè¿‡[TS 38.214-Table4.1-2] ç¡®å®šäº†PT-RSç«¯å£æ¯å±‚æ¯ä¸ªREä¸ŠPT-RS EPREä¸PDSCH EPREçš„æ¯”ä¾‹ï¼Œè¿™ä¸ªæ¯”ä¾‹å«$\rho <em>{PTRS}$, å®ƒä¸$\beta</em>{PTRS}$ çš„å…³ç³»ä¸ºï¼š$\beta_{PTRS}=10^{\frac {\rho_{PTRS}}{20}}$ã€‚</p><p><img src="/5G_Protocol/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/PTRS%E5%8F%82%E6%95%B0.png" alt></p><p><strong>resourceElementOffset</strong> è§ä¸‹æ–‡è¡¨æ ¼ä¸­å‚æ•°ï¼Œå–å€¼ä¸º{00,01,10,11}ã€‚</p><h2 id="3-4-èµ„æºæ˜ å°„"><a class="header-anchor" href="#3-4-èµ„æºæ˜ å°„">Â¶</a>3.4 èµ„æºæ˜ å°„</h2><p>å¦‚æœPTRSå­˜åœ¨ï¼ŒUEå°†æŒ‰ç…§æŒ‰$\beta_{PT_RS}$ç¼©æ”¾ï¼Œå¹¶æ˜ å°„åˆ°èµ„æºå•å…ƒä¸­ï¼š<br>$$<br>\alpha_{k,l}^{p,\mu} = \beta_{PT-RS}\cdot r_k<br>$$</p><h3 id="3-4-1-æ—¶åŸŸç´¢å¼•"><a class="header-anchor" href="#3-4-1-æ—¶åŸŸç´¢å¼•">Â¶</a>3.4.1 æ—¶åŸŸç´¢å¼•</h3><p>ç¡®å®šæ—¶åŸŸç´¢å¼•$l$çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">set i &#x3D; 0 and l_&#123;ref&#125;&#x3D;0  </span><br><span class="line">if l_&#123;ref&#125;+iL_&#123;PTRS&#125;  overlaps with a symbol used for DM-RS according to clause 7.4.1.1.2</span><br><span class="line">- set i &#x3D; 1 </span><br><span class="line">- set l_&#123;ref&#125; to the number of the last DM-RS symbol in a sequence of time-contiguous DM-RS occasions</span><br><span class="line">add l_&#123;ref&#125; + iL_&#123;PTRS&#125; to the set of time indices for PT-RS</span><br><span class="line">increment  i by one</span><br><span class="line">repeat from step 2 above as long as l_&#123;ref&#125;+iL_&#123;PTRS&#125; is inside the PDSCH allocation</span><br></pre></td></tr></table></figure><p>ç®€è€Œè¨€ä¹‹ï¼ŒPT-RSæ—¶åŸŸçš„çš„èŒƒå›´ï¼Œä»è°ƒåº¦çš„PDSCHçš„ç¬¬ä¸€ä¸ªç¬¦å·å¼€å§‹ï¼Œé¿å¼€DMRSæ‰€åœ¨çš„ä½ç½®ï¼Œä»¥$L_{PTâˆ’RS}$ä¸ºé—´éš”ï¼Œä¸€ç›´åˆ°PDSCHç»“æŸã€‚$L_{PT-RS}$ä¸ä»…æ˜¯PT-RSä¹‹é—´çš„é—´éš”ï¼Œè¿˜æ˜¯ä¸DMRSæœ€åä¸€ä¸ªç¬¦å·ä¹‹é—´çš„é—´éš”ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br>å›¾ä¸­ ä»…é€‰å–äº†$1 RB*14 symbol$ èµ„æºå•å…ƒ ï¼Œ $l_0 = 2 , L_{PT-RS} = 2$ , single symbolç±»å‹ã€‚</p><p><img src="/5G_Protocol/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/PTRS%E6%97%B6%E5%9F%9F%E5%9B%BE.png" alt></p><h3 id="3-4-2-é¢‘åŸŸç´¢å¼•"><a class="header-anchor" href="#3-4-2-é¢‘åŸŸç´¢å¼•">Â¶</a>3.4.2 é¢‘åŸŸç´¢å¼•</h3><p>é¦–å…ˆï¼Œå‡å®šåˆ†é…ç»™PDSCHçš„RBä¸ºä»0åˆ°$N_{RB}-1$ï¼Œé‚£ä¹ˆåˆ†é…ç»™PDSCHçš„å­è½½æ³¢èŒƒå›´å°±æ˜¯0-$N_{sc}^{RB}N_{RB}-1$ã€‚æœ€ç»ˆPTRSé¢‘åŸŸç´¢å¼•$k$ï¼Œç”±ä¸‹é¢å…¬å¼å¾—åˆ°ï¼š<br>$$<br>k=k_{ref}<sup>{RE}+(iK_{PT-RS}+k_{ref}</sup>{RB})N_{sc}<sup>{RB}\k_{ref}</sup>{RB}= \begin{cases}n_{RNTI}modK_{PT-RS} \quad \quad \quad if N_{RB}modK_{PT-RS} = 0 \n_{RNTI}mod(N_{RB}modK_{PT-RS})\quad \quad otherwise\end{cases}<br>$$</p><p>$k_{ref}^{RE}$ ç”±ä¸‹è¡¨è·å¾—[TS 38.311-Table 7.4.1.2.2-1]ï¼š</p><p><img src="/5G_Protocol/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/%E9%A2%91%E5%9F%9F%E7%B4%A2%E5%BC%95.png" alt></p><p>ç”±ä¸Šå¯çŸ¥ï¼Œ$K_{PT-RS}$ä¸ºç›¸é‚» PTRSä¹‹é—´é—´éš”çš„RBæ•°ï¼Œå³ç›¸é‚» PTRSä¹‹é—´ç›¸å·®$K_{PT-RS}\cdot N_{sc}^{RB}$ ä¸ªå­è½½æ³¢ï¼Œç¬¬ä¸€ä¸ªPTRS å­è½½æ³¢å®šä½æ˜¯ $k_{ref}<sup>{RE}+ï¼ˆ0K_{PT-RS}+k_{ref}</sup>{RB}ï¼‰N_{sc}^{RB}$ ã€‚å¤§æ¦‚çš„å›¾æ ·å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/5G_Protocol/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/PTRS%E9%A2%91%E5%9F%9F%E5%9B%BE.png" alt></p><blockquote><p>ä¸»è¦å‚è€ƒï¼š<br>åšå®¢ï¼š<a href="https://blog.csdn.net/littleBird_2/article/details/89408575" target="_blank" rel="noopener">https://blog.csdn.net/littleBird_2/article/details/89408575</a> (PDSCH)<br>åšå®¢ï¼š<a href="https://blog.csdn.net/kakamilan/article/details/104535554" target="_blank" rel="noopener">https://blog.csdn.net/kakamilan/article/details/104535554</a> (PDSCH-DMRS)<br>åšå®¢ï¼š<a href="https://blog.csdn.net/m0_45416816/article/details/103807853" target="_blank" rel="noopener">https://blog.csdn.net/m0_45416816/article/details/103807853</a> (PDSCH-DMRS)<br>åšå®¢ï¼š<a href="https://blog.csdn.net/littleBird_2/article/details/89683712" target="_blank" rel="noopener">https://blog.csdn.net/littleBird_2/article/details/89683712</a> (PDSCH-PTRS)<br>ç½‘é¡µï¼š<a href="http://www.sharetechnote.com" target="_blank" rel="noopener">http://www.sharetechnote.com</a></p></blockquote><!-- rebuild by neat -->]]></content>
      <categories>
        <category>5G_Protocol</category>
      </categories>
      <tags>
        <tag>PDSCH</tag>
      </tags>
  </entry>
  <entry>
    <title>5G-NR-PDCCHå­¦ä¹ </title>
    <url>/5G_Protocol/5G-NR-PDCCH%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<!-- build time:Tue Jun 22 2021 17:02:33 GMT+0800 (GMT+08:00) --><a id="more"></a><h1>1 Introduction</h1><p>PDCCHä¿¡é“ä¸»è¦æ‰¿è½½çš„æ˜¯DCIä¿¡æ¯ã€‚ä¸åŒçš„è°ƒåº¦ä¿¡æ¯ä»¥DCI formatåŒºåˆ†ï¼ŒDCI formatç§ç±»åŒ…æ‹¬ä»¥ä¸‹å‡ ç§ï¼Œç”¨äºè°ƒåº¦PUSCHã€PDSCHã€TPCã€SFIç­‰ [TS 38.212 7.3.1]ã€‚</p><p><img src="/5G_Protocol/5G-NR-PDCCH%E5%AD%A6%E4%B9%A0/DCI%E8%A1%A8%E6%A0%BC.png" alt></p><p>PDCCHä¼ è¾“è¿‡ç¨‹ä¸»è¦å¦‚ä¸‹å›¾æ‰€ç¤º:</p><p><img src="/5G_Protocol/5G-NR-PDCCH%E5%AD%A6%E4%B9%A0/NR_PDCCH_01.png" alt></p><p>[TS 38.212 7.3] ä¸­DCIçš„ä¸»è¦å¤„ç†è¿‡ç¨‹å¦‚ä¸‹ã€‚</p><blockquote><ol><li>Information Element Multiplexing</li><li>CRC Attachment</li><li>Polar Coding</li><li>Rate Matching</li><li>Scrambling</li><li>Modulation</li><li>Resource Element Mapping</li></ol></blockquote><p>ä¸‹å›¾æ˜¯ä¸€ä¸ªæ›´åŠ è¯¦ç»†çš„è¿‡ç¨‹ï¼š</p><p><img src="/5G_Protocol/5G-NR-PDCCH%E5%AD%A6%E4%B9%A0/NR_PDCCH_02.png" alt></p><h1>2 PDCCH Transport Process</h1><h2 id="2-1-Information-Element-Multiplexing"><a class="header-anchor" href="#2-1-Information-Element-Multiplexing">Â¶</a>2.1 Information Element Multiplexing</h2><p>ä¿¡æ¯å…ƒç´ å¤šè·¯å¤ç”¨è¿™æ˜¯ç”Ÿæˆæ‰¿è½½å„ç§æ§åˆ¶å’Œè°ƒåº¦ä¿¡æ¯çš„DCIçš„ä½ä¸²çš„è¿‡ç¨‹[TS 38.212 7.3]ã€‚å¦‚æœDCIæ•°æ®é•¿åº¦å°äº12æ¯”ç‰¹ï¼Œåˆ™å¡«å……æ¯”ç‰¹0ä½œä¸ºpaddingã€‚<br>æ¯ä¸ªå­—æ®µéƒ½æŒ‰ç…§å…¶åœ¨è¯´æ˜ä¸­å‡ºç°çš„é¡ºåºè¿›è¡Œæ˜ å°„ï¼ŒåŒ…æ‹¬é›¶å¡«å……ä½ï¼ˆå¦‚æœæœ‰ï¼‰ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå­—æ®µæ˜ å°„åˆ°æœ€ä½é¡ºåºä¿¡æ¯ä½ï¼Œæ¯ä¸ªè¿ç»­å­—æ®µæ˜ å°„åˆ°è¾ƒé«˜é¡ºåºä¿¡æ¯ä½ã€‚ æ¯ä¸ªå­—æ®µçš„æœ€é«˜æœ‰æ•ˆä½æ˜ å°„åˆ°è¯¥å­—æ®µçš„æœ€ä½é¡ºåºä¿¡æ¯ä½ï¼Œä¾‹å¦‚ç¬¬ä¸€ä¸ªå­—æ®µçš„æœ€é«˜æœ‰æ•ˆä½æ˜ å°„åˆ°$a_0$ã€‚</p><h2 id="2-2-CRC-Attachment"><a class="header-anchor" href="#2-2-CRC-Attachment">Â¶</a>2.2 CRC Attachment</h2><h3 id="2-2-1-CRC-Attach"><a class="header-anchor" href="#2-2-1-CRC-Attach">Â¶</a>2.2.1 CRC Attach</h3><p>é€šè¿‡å¾ªç¯å†—ä½™æ ¡éªŒï¼ˆCRCï¼‰åœ¨DCI ä¼ è¾“ä¸Šæä¾›é”™è¯¯æ£€æµ‹ [TS 38.212 7.3.2] ï¼Œæ“ä½œæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå…¶ä¸­æœ€å¼€å§‹æ·»åŠ çš„24ä½æ•°æ®å…¨æ˜¯1ã€‚</p><p><img src="/5G_Protocol/5G-NR-PDCCH%E5%AD%A6%E4%B9%A0/NR_PDCCH_CRC_01.png" alt></p><h3 id="2-2-2-Masking-with-RNTI"><a class="header-anchor" href="#2-2-2-Masking-with-RNTI">Â¶</a>2.2.2 Masking with RNTI</h3><p>åœ¨æ·»åŠ CRCåï¼Œæœ€å16ä½è¢«ç‰¹å®šçš„RNTIåŠ æ‰°ã€‚ä½¿ç”¨è¯¥RNTIï¼ŒUEå¯ä»¥ç¡®å®šDCIæ˜¯é’ˆå¯¹å“ªä¸ªUEä»¥åŠDCIçš„ç”¨é€”ã€‚ [TS 38.212 7.3.2]ï¼Œæ“ä½œæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/5G_Protocol/5G-NR-PDCCH%E5%AD%A6%E4%B9%A0/NR_PDCCH_RNTI_Masking_01.png" alt></p><h2 id="2-3-Polar-Coding"><a class="header-anchor" href="#2-3-Polar-Coding">Â¶</a>2.3 Polar Coding</h2><p>ä¿¡æ¯æ¯”ç‰¹è¢«ä¼ é€åˆ°ä¿¡é“ç¼–ç å—<br>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/5G_Protocol/5G-NR-PDCCH%E5%AD%A6%E4%B9%A0/NR_PDCCH_ChannelCoding_01.png" alt></p><h2 id="2-4-Rate-Matching"><a class="header-anchor" href="#2-4-Rate-Matching">Â¶</a>2.4 Rate Matching</h2><p>é€Ÿç‡åŒ¹é…çš„è¾“å…¥æ¯”ç‰¹åºåˆ—æ˜¯ $d_0,â€¦,d_{N-1}$ï¼Œé€šè¿‡è®¾ç½®æ ¹æ® [TS 38.212 5.4.1] æ‰§è¡Œé€Ÿç‡åŒ¹é… $I_{BIL} = 0$ï¼Œé€Ÿç‡åŒ¹é…åçš„è¾“å‡ºæ¯”ç‰¹åºåˆ—è¡¨ç¤ºä¸º $f_0,â€¦,f_{E-1}$ã€‚<br>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/5G_Protocol/5G-NR-PDCCH%E5%AD%A6%E4%B9%A0/NR_PDCCH_RateMatching_01.png" alt></p><h2 id="2-5-Scrambling"><a class="header-anchor" href="#2-5-Scrambling">Â¶</a>2.5 Scrambling</h2><h3 id="2-5-1-CCE"><a class="header-anchor" href="#2-5-1-CCE">Â¶</a>2.5.1 CCE</h3><p>Rate matchingæ ¹æ®åˆ†é…ç»™PDCCHçš„èµ„æºè¿›è¡Œé€Ÿç‡åŒ¹é…ï¼ŒPDCCHåˆ†é…çš„åŸºæœ¬å•ä½ä¸º<strong>CCE</strong>(Control Channel Element)ï¼Œ(1 CCE = 6 REG = 72 REï¼Œ1 REG = 1 OFDM symbol * 12 subcarrier = 12 RE)ï¼Œå¯¹äºä¸€ä¸ªPDCCHè€Œè¨€ï¼Œå…¶ç”±ä¸€ä¸ªæˆ–å¤šä¸ªCCEsç»„æˆï¼Œè€Œæ‰€åˆ†é…çš„CCEæ•°é‡æ ¹æ®èšåˆç­‰çº§çš„ä¸åŒè€Œä¸åŒï¼Œæ¢ä¸€å¥è¯è¯´ï¼Œä¹Ÿå°±æ˜¯è‹¥å¹²ä¸ªCCEä¼šèšåˆæˆPDCCHï¼ŒèšåˆæˆPDCCHçš„CCEä¸ªæ•°å°±æ˜¯èšåˆåº¦ï¼ŒPDCCHæ‰€æ”¯æŒçš„èšåˆç­‰çº§ä¸‹è¡¨æ‰€ç¤ºã€‚ [TS 38.211 7.3.1]</p><p><img src="/5G_Protocol/5G-NR-PDCCH%E5%AD%A6%E4%B9%A0/CCE.png" alt></p><h3 id="2-5-2-CORESET"><a class="header-anchor" href="#2-5-2-CORESET">Â¶</a>2.5.2 CORESET</h3><p>UEå¯è¢«é…ç½®å¤šä¸ª<strong>CORESET</strong>(Control-resource set, æ§åˆ¶èµ„æºé›†)ï¼Œå…¶ä½äºBWPå†…ï¼Œå¯¹äºæ¯ä¸ªBWPæœ€å¤šè¢«é…ç½®3ä¸ªCORESET(åŒ…æ‹¬commonå’ŒUE-specific CORESETs)ã€‚<br>å¯¹äºPDCCHè€Œè¨€ï¼Œæ‰€ä¼ è¾“æ§åˆ¶ä¿¡æ¯çš„æ—¶é¢‘ä½ç½®ä½äºCORESETå†…ï¼Œè€Œä¸€ä¸ªCORESETæ—¶é¢‘ä½ç½®çš„ç»„æˆï¼š<strong>é¢‘åŸŸ</strong>ç”±$N_{RB}<sup>{CORESET}$ä¸ªRBç»„æˆï¼Œ**æ—¶åŸŸ**ç”±$N_{symb}</sup>{CORESET} \in {1,2,3}$ä¸ªç¬¦å·ç»„æˆã€‚å…¶ä¸­$N_{symb}^{CORESET} = 3$ ä»…å½“é«˜å±‚å‚æ•° $dmrs-TypeA-Position = 3 $ æ—¶æ‰æ”¯æŒã€‚<br>æ¯ä¸ªCORESETä¸­æœ‰<strong>äº¤ç»‡</strong>(åˆ†å¸ƒå¼)å’Œ<strong>éäº¤ç»‡</strong>(é›†ä¸­å¼)ä¸¤ç§CCE-to-REGæ˜ å°„å¯é€‰ï¼ˆç”±ControlResourceSet IE ä¸­çš„é«˜å±‚å‚æ•°cce-REGMappingTypeé…ç½®ï¼‰ï¼Œä½†æ˜¯æ¯ä¸ªCORESETä»…èƒ½å…³è”å…¶ä¸­ä¸€ç§ï¼Œå…¶CCE-to-REGæ˜ å°„é€šè¿‡REG bundlesæè¿°ï¼š</p><p>- REG bundle è¢«å®šä¹‰ä¸ºREG${iL,iL+1,â€¦,iL+Lâˆ’1}$ï¼Œå…¶ä¸­Læ˜¯REG bundleå¤§å°(ç”±é«˜å±‚å‚æ•°reg-BundleSizeæŒ‡å®š)ï¼Œi = 0,1,â€¦,$N_{REG}^{CORESET}/L-1$æ˜¯ï¼Œ $N_{REG}<sup>{CORESET}$æ˜¯CORESETä¸­REGæ•°ï¼Œ$N_{REG}</sup>{CORESET} = N_{RB}^{CORESET}\cdot N_{symb}^{CORESET}$ï¼›<br>- æœ€ç»ˆCCE-REGçš„æ˜ å°„ï¼Œæ˜¯æŒ‰ç…§REGæŸæ¥è¡¨ç¤ºçš„ï¼ŒCCE $j$ ä¸­åŒ…å«äº†REG bundle ${f(6j/L),f(6j/L+1),â€¦,f(6j/L+6/Lâˆ’1)}$ã€‚</p><p>å¯¹äºä¸¤ç§ä¸åŒçš„æ˜ å°„æ–¹å¼ï¼Œæœ‰å¦‚ä¸‹æè¿°ï¼š<br>- éäº¤ç»‡çš„ CCE to REG æ˜ å°„ ï¼Œ $L = 6\quad and\quad f(j) = j$<br>- äº¤ç»‡çš„ CCE to REG æ˜ å°„ ï¼Œå¯¹äº $N_{symb}^{CORESET} = 1$ , $L\in \lbrace 2,6 \rbrace$ï¼›å¯¹äº$N_{symb}^{CORESET} \in \lbrace 2 ,3 \rbrace$ , $L\in \lbrace N_{symb}^{CORESET} ,6 \rbrace$ï¼›$l$ç”±é«˜å±‚å‚æ•°reg-BundleSizeé…ç½®ã€‚<br>äº¤ç»‡å™¨å®šä¹‰å¦‚ä¸‹ï¼š</p><p>$$<br>f(j) = (rC+c+n_{shift})mod(N_{REG}^{CORESET}/L)\j = cR+r\r = 0,1,â€¦,R-1\c = 0,1,â€¦,C-1\C = N_{REG}^{CORESET}/(LR)<br>$$</p><p>å…¶ä¸­ $R\in {2,3,6 }$ç”±é«˜å±‚å‚æ•°interleaverSizeç»™å‡ºã€‚å¯¹äº$n_{shift}$:</p><ul><li>å¯¹äºPBCHæˆ–SIB1é…ç½®çš„CORESETä¸­å‘é€çš„PDCCHï¼Œ$n_{shift} = N_{ID}^{cell}$</li><li>é™¤æ­¤ä¹‹å¤–ï¼Œ$n_{shift}\in{ 0,1,â€¦,274 }$ ç”±é«˜å±‚å‚æ•°shiftIndexç»™å‡ºã€‚</li></ul><p>å¯¹äºäº¤ç»‡å’Œéäº¤ç»‡æ–¹å¼ï¼Œåˆ©ç”¨ç›´è§‚çš„ä¾‹å­è¯´æ˜æ“ä½œè¿‡ç¨‹ï¼Œä¾‹å­å‚è€ƒæ–‡çŒ®ä¸­æ‘˜æŠ„ã€‚</p><p><img src="/5G_Protocol/5G-NR-PDCCH%E5%AD%A6%E4%B9%A0/%E4%BE%8B%E5%AD%901.png" alt></p><p><img src="/5G_Protocol/5G-NR-PDCCH%E5%AD%A6%E4%B9%A0/%E4%BE%8B%E5%AD%902.png" alt></p><ul><li>å¦‚æœé«˜å±‚å‚æ•°precoderGranularity = sameAsREG-bundleï¼Œåˆ™åœ¨REG bundleå†…ä½¿ç”¨ç›¸åŒçš„é¢„ç¼–ç </li><li>å¦‚æœé«˜å±‚å‚æ•°precoderEranularity = allContiguousRBsï¼Œåˆ™åœ¨CORESETä¸­çš„è¿ç»­èµ„æºå—é›†åˆä¸­çš„æ‰€æœ‰èµ„æºå•å…ƒç»„ä¸­ä½¿ç”¨ç›¸åŒçš„é¢„ç¼–ç </li></ul><p>å¯¹äºç”± PBCHé…ç½®çš„ CORESETï¼ŒUEå¯ä»¥å‡è®¾äº¤ç»‡æ˜ å°„ï¼Œ$ L = 6 , R = 2$ ï¼Œä»¥åŠåœ¨ REG bundleä¸­ä½¿ç”¨çš„ç›¸åŒé¢„ç¼–ç ã€‚ [TS 38.211 7.3.2.1]</p><h3 id="2-5-3-Scrambling"><a class="header-anchor" href="#2-5-3-Scrambling">Â¶</a>2.5.3 Scrambling</h3><p>UEåº”é‡‡ç”¨æ¯”ç‰¹å— $b(0),â€¦,b(M_{bit} -1)$ ($M_{bit}$ æ˜¯åœ¨ç‰©ç†ä¿¡é“ä¸Šå‘é€çš„æ¯”ç‰¹æ•°)ï¼Œåœ¨è°ƒåˆ¶ä¹‹å‰è¢«åŠ æ‰°ï¼Œäº§ç”Ÿä¸€ä¸ªåŠ æ‰°æ¯”ç‰¹å— $\widetilde b(0),â€¦,\widetilde b(M_{bit})$ ï¼Œæ ¹æ®å¦‚ä¸‹æ–¹å¼åŠ æ‰°ï¼š<br>$$<br>\widetilde b(i) = (b(i)+c(i))mod2<br>$$</p><p>å…¶ä¸­åŠ æ‰°åºåˆ— $c(i)$ åœ¨[TS 38.211 5.2.1]ç»™å‡ºï¼Œç”±$Gold$ åºåˆ—ç”Ÿæˆï¼Œæ­¤æ—¶åˆå§‹åŒ–ä¸º $c_{init} $ç”±ä»¥ä¸‹å¾—å‡ºï¼š<br>$$<br>c_{init} = (n_{RNTI}\cdot 2^{16} + n_{ID})mod2^{31}<br>$$</p><p>å¯¹äº$n_{ID}$ï¼š<br>- $n_{ID}\in {0,2,â€¦,65535}$ = $pdcch-DMRS-ScramnlingID$ (å¦‚æœå·²é…ç½®) ï¼›<br>- é™¤æ­¤ä¹‹å¤– $n_{ID} = N_{ID}^{cell}$ã€‚ [TS 38.213]</p><p>å¯¹äº$n_{RNTI}$ï¼š<br>- å¦‚æœé…ç½®äº†é«˜å±‚å‚æ•° pdcch-DMRS-ScramnlingIDï¼Œåˆ™ç”±C-RNTIç»™å‡º$UE$ç‰¹å®šæœç´¢ç©ºé—´ï¼›<br>- é™¤æ­¤ä¹‹å¤–$n_{RNTI} = 0$ã€‚</p><p>æ•´ä½“çš„æµç¨‹å¦‚ä¸‹å›¾æ‰€å±•ç¤ºï¼š</p><p><img src="/5G_Protocol/5G-NR-PDCCH%E5%AD%A6%E4%B9%A0/NR_PDCCH_Scrambling_01.png" alt></p><h2 id="2-6-Modulation"><a class="header-anchor" href="#2-6-Modulation">Â¶</a>2.6 Modulation</h2><p>UEåº”é‡‡ç”¨æ¯”ç‰¹å— $\widetilde b(0),â€¦,\widetilde b(M_{bit})$æŒ‰ç…§å¦‚[TS 38.211 5.1.3]æ‰€è¿°è¿›è¡Œ QPSKè°ƒåˆ¶ï¼Œå¾—åˆ°ä¸€ä¸ªå¤å€¼è°ƒåˆ¶ç¬¦å·å— $d(0),â€¦,d(M_{bit} -1)$ã€‚</p><p><img src="/5G_Protocol/5G-NR-PDCCH%E5%AD%A6%E4%B9%A0/NR_PDCCH_Modulation_01.png" alt></p><h2 id="2-7-Resource-Element-Mapping"><a class="header-anchor" href="#2-7-Resource-Element-Mapping">Â¶</a>2.7 Resource Element Mapping</h2><p>åœ¨ç”¨äºè¢«ç›‘è§†PDCCHçš„èµ„æºå…ƒç´ ç»„ä¸­ï¼ŒUEå°†å‡å®šå¤æ•°å€¼ç¬¦å·å—${d(0),â€¦,d(M_{symb}-1))}$å°†æŒ‰æ¯”ä¾‹å› å­$\beta_{PDCCH}$ç¼©æ”¾å¹¶æ˜ å°„åˆ°èµ„æºå•å…ƒ$(k,l)_{p,\mu}$ä¸­ï¼Œå…¶é¡ºåºä¸ºå…ˆæ˜¯æ—¶åŸŸï¼Œç„¶åæ˜¯é¢‘åŸŸï¼Œå¤©çº¿ç«¯å£å·$p = 2000$ã€‚</p><h2 id="2-8-PDCCH-DMRS"><a class="header-anchor" href="#2-8-PDCCH-DMRS">Â¶</a>2.8 PDCCH DMRS</h2><h3 id="2-8-1-Sequence-generation"><a class="header-anchor" href="#2-8-1-Sequence-generation">Â¶</a>2.8.1 Sequence generation</h3><p>UEåº”é‡‡ç”¨å¦‚ä¸‹æ–¹å¼å®šä¹‰å‚è€ƒä¿¡å·åºåˆ—$r_l(m)$ï¼š<br>$$<br>r_l(m) = \frac{1}{\sqrt{2} }(1-2<em>c(2m)) + j\frac{1}{\sqrt{2} }(1-2</em>c(2m+1))<br>$$</p><p>åŠ æ‰°åºåˆ— $c(i)$ åœ¨[TS 38.211 5.2.1]ç»™å‡ºï¼Œç”±$Gold$ åºåˆ—ç”Ÿæˆï¼Œæ­¤æ—¶åˆå§‹åŒ–ä¸º $c_{init} $ç”±ä»¥ä¸‹å¾—å‡ºï¼š</p><p>$$<br>c_{init} = (2<sup>{17}(14n_{s,f}</sup>\mu+l+1)(2N_{ID}+1)+2N_{ID})mod2^{31}<br>$$</p><p>å…¶ä¸­ï¼š$l$ æ˜¯$slot$ å†…OFDMç¬¦å·ç¼–å·ï¼Œ$n_{s,f}^\mu$ æ˜¯å¸§å†…çš„ $slot$ å·</p><p>å¯¹äº$n_{ID}$ï¼š<br>- $n_{ID}\in {0,2,â€¦,65535}$ = $pdcch-DMRS-ScramnlingID$ (å¦‚æœå·²é…ç½®)ï¼›<br>- é™¤æ­¤ä¹‹å¤– $n_{ID} = N_{ID}^{cell}$ã€‚ [TS 38.213]</p><h3 id="2-8-2-Resource-Element-Mapping"><a class="header-anchor" href="#2-8-2-Resource-Element-Mapping">Â¶</a>2.8.2 Resource Element Mapping</h3><p>$UE$ å°†$r_l(m)$ æ˜ å°„åˆ°èµ„æºå•å…ƒ$(k,l)_{p,\mu}$ ï¼Œæ ¹æ®å¦‚ä¸‹ï¼š</p><p>$$<br>\alpha_{k,l}^{p,\mu} = \beta_{DMRS}^{PDCCH}\cdot r_l(3n+kâ€™)\ k = nN_{sc}^{RB}+4kâ€™+1\ kâ€™ = 0 ,1,2\ n = 0,2,â€¦<br>$$</p><p>å¯ä»¥çœ‹å‡ºï¼Œæ¯ä¸ªRBä¸Šæœ‰3ä¸ªDMRS REï¼Œåˆ†åˆ«ä½äº$4kâ€™+1$ çš„ä½ç½®ï¼Œå³1ã€5ã€9å·å­è½½æ³¢ã€‚<br>$l$ æŒ‡åœ¨ä¸€ä¸ªæ—¶éš™å†…çš„OFDMç¬¦å·ï¼›å¤©çº¿ç«¯å£ $p$ å›ºå®šä¸º2000ã€‚</p><p>å¯¹äºprecoderGranularityï¼š<br>- å¦‚æœé…ç½®ä¸º sameAsREG-bundleï¼Œé‚£ä¹ˆè¯¥CORESETå¯¹åº”çš„DMRSä»…åœ¨UEéœ€è¦æ£€æµ‹PDCCHçš„REGä¸Šï¼›<br>- å¦‚æœé…ç½®ä¸ºallContiguousRBsï¼Œåˆ™åœ¨ç»„æˆCORESETçš„REGä¸Šéƒ½æœ‰DMRSæ˜ å°„ã€‚</p><p>å¯¹äºå‚è€ƒç‚¹$k$ï¼š<br>- å¦‚æœCORCHETç”±PBCHæˆ–SIB1é…ç½®ï¼Œåˆ™ä¸ºCORESETä¸­ç¼–å·æœ€å°çš„èµ„æºå—çš„å­è½½æ³¢0ï¼Œ<br>- å¦åˆ™ï¼Œä¸ºå…¬å…±èµ„æºå—0ä¸­çš„å­è½½æ³¢0</p><p>ä¸Šè¿°æè¿°ç”±ä¸‹å›¾å¯ç›´è§‚è¡¨ç¤ºï¼š</p><p><img src="/5G_Protocol/5G-NR-PDCCH%E5%AD%A6%E4%B9%A0/DMRS%E5%8F%82%E8%80%83%E7%82%B9.png" alt></p><blockquote><p>ä¸»è¦å‚è€ƒï¼š<br>å¾®ä¿¡å…¬ä¼—å·ï¼š5Gèœé¸Ÿæˆé•¿æ—¥è®°<br>æ–‡ç« ï¼šUnderstanding the Heart of the 5G Air Interface: An Overview of Physical Downlink Control Channel for 5G New Radio (NR)<br>åšå®¢ï¼š<a href="https://blog.csdn.net/qq_33206497/article/details/89645976" target="_blank" rel="noopener">https://blog.csdn.net/qq_33206497/article/details/89645976</a><br>åšå®¢ï¼š<a href="https://blog.csdn.net/littleBird_2/article/details/88372875" target="_blank" rel="noopener">https://blog.csdn.net/littleBird_2/article/details/88372875</a><br>ç½‘é¡µï¼š<a href="http://www.sharetechnote.com/html/5G/5G_PDCCH.html#Ref_01" target="_blank" rel="noopener">http://www.sharetechnote.com/html/5G/5G_PDCCH.html#Ref_01</a></p></blockquote><!-- rebuild by neat -->]]></content>
      <categories>
        <category>5G_Protocol</category>
      </categories>
      <tags>
        <tag>PDCCH</tag>
      </tags>
  </entry>
  <entry>
    <title>5G-NR-SSBå­¦ä¹ </title>
    <url>/5G_Protocol/5G-NR-SSB%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<!-- build time:Tue Jun 22 2021 17:02:33 GMT+0800 (GMT+08:00) --><a id="more"></a><h1>ä¸€ã€æ¦‚è¿°</h1><p>SS/PBCU Blockç®€ç§°SSBï¼Œä¸»è¦åŒ…å«PSSã€SSSä»¥åŠPBCHã€‚å¯¹äºSSBçš„å­¦ä¹ ï¼Œä¸»è¦é‡‡ç”¨å¦‚ä¸‹æ­¥éª¤æ¥å­¦ä¹ ï¼Œå¹¶åŠ æ·±ç†è§£çš„ï¼š</p><blockquote><ol><li>NR SSB æ—¶åŸŸé¢‘åŸŸåˆ†æ</li><li>PSS/SSSåºåˆ—</li><li>PBCH payload ç”ŸæˆåŠå¤„ç†</li><li>PBCHåŠ æ‰°/è°ƒåˆ¶/REæ˜ å°„</li><li>PBCH DMRS</li><li>UE SSBå¤„ç†è¿‡ç¨‹</li><li>åŒæ­¥è¿‡ç¨‹ç†è§£</li></ol></blockquote><h1>äºŒã€å­¦ä¹ è¿›ç¨‹</h1><h2 id="2-1-NR-SSB-æ—¶åŸŸé¢‘åŸŸåˆ†æ"><a class="header-anchor" href="#2-1-NR-SSB-æ—¶åŸŸé¢‘åŸŸåˆ†æ">Â¶</a>2.1 NR SSB æ—¶åŸŸé¢‘åŸŸåˆ†æ</h2><p>PSSå’ŒSSSä¸»è¦ç”¨äºUEè·å¾—æ—¶é—´åŒæ­¥å’Œé¢‘ç‡åŒæ­¥ï¼Œè·å–å°åŒºIDï¼›PBCHç”¨äºæ— çº¿å¸§å·åŒæ­¥ä»¥åŠSIB1çš„é…ç½®ã€‚ä¸LTEçš„å·®å¼‚ä¸»è¦åœ¨äºSSSåºåˆ—éƒ½ä¸€æ ·ï¼Œä¸å­˜åœ¨å‰å5 msçš„å·®å¼‚ä¸”SSBçš„å‘¨æœŸæ˜¯å¯é…ç½®çš„ï¼Œä»¥åŠå¼•å…¥äº†beam indexçš„æ¦‚å¿µã€‚</p><h3 id="2-1-1-SSBæ—¶åŸŸåˆ†æ"><a class="header-anchor" href="#2-1-1-SSBæ—¶åŸŸåˆ†æ">Â¶</a>2.1.1 SSBæ—¶åŸŸåˆ†æ</h3><p>åœ¨5Gä¸­ï¼Œæ¯ä¸ªSSBå¯¹åº”ä¸€ä¸ªbeamï¼Œ SSBçš„æœ€çŸ­æ—¶é—´è·¨åº¦ä¸º5 msï¼Œä¹Ÿå°±æ˜¯åŠå¸§ã€‚ä¸€ä¸ªåŠå¸§ä¸­å¯èƒ½å­˜åœ¨å¤šä¸ªSSBï¼Œæˆ‘ä»¬å°†ä¸€ä¸ªåŠå¸§ä¸­å­˜åœ¨çš„ä¸€ä¸ªæˆ–å¤šä¸ªSSBç§°ä¸ºSS Burst Setï¼Œä¸€ä¸ªSS Burst Setä¸­çš„SSBåŒ…å«çš„ä¿¡æ¯ç›¸åŒã€‚ä¸¤ä¸ªSS Burst Setå‡ºç°çš„æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯å­˜åœ¨SSBçš„åŠå¸§å‡ºç°çš„æ—¶é—´æ˜¯å¯ä»¥é…ç½®çš„ï¼Œæˆä¸ºSS Burst Set Periodicityï¼Œ5 msâ€“160 msèŒƒå›´ã€‚é»˜è®¤ä¸º20 msã€‚<br>æ ¹æ®[TS 38.213]ä¸­çš„SSBçš„æ—¶é—´åˆ†å¸ƒæè¿°ï¼Œæ€»ç»“æˆå¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚ä»è¡¨ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒSSBç¬¦å·çš„èµ·å§‹ä½ç½®å–å†³äºCaseç±»å‹ä»¥åŠæ‰€å¤„é¢‘æ®µï¼Œä¸€ä¸ªSSBåœ¨æ—¶åŸŸä¸Šå æ®4ä¸ªç¬¦å·ã€‚Numä¸ºSSBçš„æ€»æ•°ã€‚</p><p><img src="/5G_Protocol/5G-NR-SSB%E5%AD%A6%E4%B9%A0/1.png" alt></p><p>ä»¥Case Aï¼Œå°äºç­‰äº3 GHzä¸ºä¾‹ï¼Œå…¶ç¬¦å·ä½ç½®å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒSSBæ€»æ•°ä¸º4ï¼Œå„ä¸ªSSBä»£è¡¨äº†ä¸åŒçš„æ³¢æŸæ–¹å‘ã€‚</p><p><img src="/5G_Protocol/5G-NR-SSB%E5%AD%A6%E4%B9%A0/2.png" alt></p><p>SSBçš„Caseç”±Bandå†³å®šï¼Œ[TS 38.104]ä¸­è§„å®š</p><p><img src="/5G_Protocol/5G-NR-SSB%E5%AD%A6%E4%B9%A0/3.jpg" alt></p><h3 id="2-1-2-SSBé¢‘åŸŸåˆ†æ"><a class="header-anchor" href="#2-1-2-SSBé¢‘åŸŸåˆ†æ">Â¶</a>2.1.2 SSBé¢‘åŸŸåˆ†æ</h3><p>ç”±ä¸Šä¸€èŠ‚å¯çŸ¥SSBæ—¶åŸŸæ˜¯ç”±4ä¸ªsymbolç»„æˆï¼Œè€Œé¢‘åŸŸæ˜¯ç”±20ä¸ªRBï¼Œä¹Ÿå³240ä¸ªå­è½½æ³¢æ„æˆï¼Œå®ƒåŒ…å«ç€set 0 ,PSS,SSS,PBCH,DMRS,ç»“æ„å¦‚ä¸‹è¡¨æ‰€ç¤º</p><p><img src="/5G_Protocol/5G-NR-SSB%E5%AD%A6%E4%B9%A0/4.png" alt></p><p>ç»¼åˆä»¥ä¸Šï¼Œä¸‹å›¾æ›´ç›´è§‚çš„æ˜¾ç¤ºSSBæ—¶åŸŸé¢‘åŸŸåˆ†å¸ƒï¼Œæ¨ªè½´ä¸ºé¢‘åŸŸï¼Œçºµè½´ä¸ºæ—¶åŸŸã€‚</p><p><img src="/5G_Protocol/5G-NR-SSB%E5%AD%A6%E4%B9%A0/5.png" alt></p><p>ä¸LTEä¸­PSSå’ŒSSSå›ºå®šåœ¨å¸¦å®½çš„ä¸­é—´73ä¸ªå­è½½æ³¢ä¸åŒï¼ŒNRä¸­SSBå¯èƒ½çš„é¢‘åŸŸä½ç½®æœ‰å¾ˆå¤šã€‚NRä¸­æœ‰ä¸€ç³»åˆ—å…¨å±€åŒæ­¥ä¿¡é“å·GSCNï¼Œæ¯ä¸ªGSCNéƒ½ä¼šå¯¹åº”ä¸€ä¸ªç¡®å®šçš„ã€ç»å¯¹çš„é¢‘ç‡ä½ç½®ï¼Œç³»ç»Ÿä¼šæŠŠSSBæ”¾åœ¨è¿™äº›GSCNä¸Šï¼Œå¯¹é½æ–¹å¼ä¸ºSSBçš„10å·RBçš„0å·å­è½½æ³¢ä¸GSCNå¯¹é½ï¼ŒUEå°±ä¼šåœ¨è¿™äº›GSCNä¸ŠæŒ¨ä¸ªç›²æ£€SSBã€‚</p><p><img src="/5G_Protocol/5G-NR-SSB%E5%AD%A6%E4%B9%A0/GSCN.png" alt></p><p>ä¸åŒçš„operating bandæ˜¯åˆ†é…ç»™ä¸åŒè¿è¥å•†çš„ï¼Œæ‰€ä»¥UEæ˜¯çŸ¥é“è‡ªå·±å¤„åœ¨å“ªä¸ªoperating bandä¸Šçš„ï¼Œæ¯”å¦‚n28åˆ†é…ç»™å¹¿ç”µçš„ï¼Œé‚£ä¹ˆæ¥å…¥å¹¿ç”µç½‘ç»œçš„UEåœ¨æœç´¢SSBçš„æ—¶å€™ï¼Œå°±ç›²æ£€1901 â€“ $&lt;$1$&gt;$ â€“ 2002è¿™ä¸ªèŒƒå›´å†…çš„GSCN(å‚è€ƒ2.1.1è¡¨æ ¼)ï¼Œå¹¶ä¸”åªæœç´¢15kHzå­è½½æ³¢é—´éš”ã€case Aä¸‹çš„SSBã€‚</p><p>ç¡®å®šæ•´ä¸ªCRBä¸­SSBæ‰€å¤„äºçš„ä½ç½®ï¼Œéœ€è¦é€šè¿‡$K_{ssb}$å’ŒCORESET#0ç›¸åº”çš„offsetRBæ¥ç¡®å®šã€‚[TS 38.211]ä¸­$K_{ssb}$æ¥è¡¨ç¤ºå…¬å…±èµ„æºå¿«$N_{CRB}^{SSB}$å­è½½æ³¢0ç›¸å¯¹SSBå­è½½æ³¢0çš„åç§»ã€‚$K_{SSB}$çš„ä½4bitç”±MIBå‚æ•°ä¸­çš„ssb-SubcarrerOffsetç»™å‡ºã€‚<br>å¯¹äºSSBç±»å‹Bï¼Œå³ï¼ˆÎ¼= 3 or 4ï¼‰æ¥è¯´,$K_{SSB}$={0,â€¦,11}, 4 bitè¶³å¤Ÿã€‚<br>å¯¹äºSSBç±»å‹Aï¼Œå³ï¼ˆÎ¼= 0 or 1ï¼‰æ¥è¯´, $K_{SSB}$={0,â€¦,23}, 4 bitä¸å¤Ÿï¼Œéœ€è¦5 bitæ¥è¡¨ç¤ºï¼Œå› æ­¤ä½¿ç”¨PBCH payloadä¸­$a_{\overline A+5}$æ¥è¡¨ç¤ºé«˜æ¯”ç‰¹ä½ã€‚ä¸‹æ–‡ä¼šè¯´æ˜ã€‚<br>æœ€ç»ˆSSBåœ¨æ•´ä¸ªCRBä¸­çš„ä½ç½®å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/5G_Protocol/5G-NR-SSB%E5%AD%A6%E4%B9%A0/6.png" alt></p><h2 id="2-2-PSS-SSSåºåˆ—"><a class="header-anchor" href="#2-2-PSS-SSSåºåˆ—">Â¶</a>2.2 PSS/SSSåºåˆ—</h2><h3 id="2-2-1-PCI"><a class="header-anchor" href="#2-2-1-PCI">Â¶</a>2.2.1 PCI</h3><p>PCI(Physical Cell Identifier)ï¼Œç‰©ç†å°åŒºæ ‡è¯†ï¼Œ$N_{ID}^{cell}$å®šä¹‰å¦‚ä¸‹ï¼š</p><p>$$<br>N_{ID}^{cell} = 3N_{ID}^{(1)} + N_{ID}<sup>{(2)}\N_{ID}</sup>{cell}\in\lbrace 0,1,â€¦,1007\rbrace\N_{ID}^{(1)}\in\lbrace 0,1,â€¦,355\rbrace\N_{ID}^{(2)}\in \lbrace 0,1,2\rbrace<br>$$</p><h3 id="2-2-2-PSS"><a class="header-anchor" href="#2-2-2-PSS">Â¶</a>2.2.2 PSS</h3><p>PSS(Primary Synchronization Signal)ï¼Œä¸»åŒæ­¥ä¿¡å·ï¼Œåºåˆ—å®šä¹‰å¦‚ä¸‹ï¼š<br>$$<br>d_{pss}(n) = 1 - 2x(m)\m = (n + 43N_{ID}^{(2)})mod127\0 â‰¤ n &lt; 127<br>$$</p><p>$x(m)$ç”±å¦‚ä¸‹åºåˆ—å¾—å‡ºï¼š<br>$$<br>x(i+7) = (x(i+4)+x(i))mod2\ [x(6)\quad x(5)\quad x(4)\quad x(3)\quad x(2)\quad x(1)\quad x(0)] = [1\quad 1\quad 1\quad 0\quad 1\quad 1\quad 0]<br>$$</p><p>PSSéƒ¨åˆ†æ˜ å°„åœ¨SSBä¸­é—´12ä¸ªRBä¸Š,å ç”¨144ä¸ªå­è½½æ³¢ï¼ŒPSSåºåˆ—æ˜ å°„åœ¨56-182ï¼Œå‰8ä¸ªå’Œå9ä¸ªä¸ºä¿æŠ¤é—´éš”(guard band)ã€‚</p><h3 id="2-2-3-SSS"><a class="header-anchor" href="#2-2-3-SSS">Â¶</a>2.2.3 SSS</h3><p>SSS(Secondary Synchronization Signal)ï¼Œè¾…åŒæ­¥ä¿¡å·ï¼Œåºåˆ—å®šä¹‰å¦‚ä¸‹ï¼š<br>$$<br>d_{sss}(n) = [1 - 2x_0((n + m_0)mod127)][1 - 2x_1((n + m_1)mod127)]\m_0 = 15[\frac{N_{ID}^{(1)}}{112}] + 5N_{ID}^{(2)}\m_1 = N_{ID}^{(1)}mod112\0\quad \leq n &lt; 127<br>$$<br>$x_1(m)$å’Œ$x_2(m)$ç”±å¦‚ä¸‹åºåˆ—å¾—å‡ºï¼š<br>$$<br>x_0(i+7) = (x_0(i+4)+x_0(i))mod2\ x_1(i+7) = (x_1(i+1)+x_1(i))mod2\ [x_0(6)\quad x_0(5)\quad x_0(4)\quad x_0(3)\quad x_0(2)\quad x_0(1)\quad x_0(0)] = [0\quad 0\quad 0\quad 0\quad 0\quad 0\quad 1]\ [x_1(6)\quad x_1(5)\quad x_1(4)\quad x_1(3)\quad x_1(2)\quad x_1(1)\quad x_1(0)] = [0\quad 0\quad 0\quad 0\quad 0\quad 0\quad 1]<br>$$<br>SSSä¸PSSç›¸åŒï¼Œæ˜ å°„åœ¨SSBä¸­é—´12ä¸ªRBä¸Š,å ç”¨144ä¸ªå­è½½æ³¢ï¼ŒPSSåºåˆ—æ˜ å°„åœ¨56-182ï¼Œå‰8ä¸ªå’Œå9ä¸ªä¸ºä¿æŠ¤é—´éš”(guard band)ã€‚</p><h2 id="2-3-PBCH-payload-ç”ŸæˆåŠå¤„ç†"><a class="header-anchor" href="#2-3-PBCH-payload-ç”ŸæˆåŠå¤„ç†">Â¶</a>2.3 PBCH payload ç”ŸæˆåŠå¤„ç†</h2><p>PBCH payload ç»„æˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/5G_Protocol/5G-NR-SSB%E5%AD%A6%E4%B9%A0/7.png" alt></p><h3 id="2-3-1-BCCH"><a class="header-anchor" href="#2-3-1-BCCH">Â¶</a>2.3.1 BCCH</h3><p>BCCHå…±24æ¯”ç‰¹ï¼Œå…¶ä¸­Bå¦‚æœæŒ‡ç¤ºçš„æ˜¯MIBä¿¡æ¯ï¼Œå…¶ä¸­MIBä¿¡æ¯åªæœ‰23æ¯”ç‰¹ã€‚çœ‹[TS 38.311 ]ä¸­çš„BCCH-BCH-Messageç»“æ„ï¼Œå…¶ä¸­æœ‰1æ¯”ç‰¹ChoiceæŒ‡ç¤ºï¼ŒæŒ‡ç¤ºæ˜¯mibè¿˜æ˜¯messageClassExtensionã€‚<br>MIBçš„å†…å®¹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/5G_Protocol/5G-NR-SSB%E5%AD%A6%E4%B9%A0/8.png" alt></p><p><strong>systemFrameNumer</strong>- æ— çº¿å¸§å·æŒ‡ç¤ºï¼Œè¿™é‡Œåªæœ‰6æ¯”ç‰¹ï¼Œè¿˜æœ‰4æ¯”ç‰¹åœ¨PBCH payloadä¸­æ·»åŠ ; <strong>6 bit</strong><br><strong>subCarrierSpacingCommon</strong> - æŒ‡ç¤ºSIB1çš„å­è½½æ³¢é—´éš”ï¼ŒFR1ä¸º15KHzæˆ–60KHzï¼ŒFR2ä¸º30KHzæˆ–120KHz; <strong>1 bit</strong><br>**ssb-SubcarrerOffset **<br>æ˜¯è·ç¦»SSBåº•éƒ¨è·ç¦»RBè¾¹ç•Œä½ç½®çš„åç§»$K_{SSB}$, <strong>4 bit</strong><br>å¯¹äºFR2æ¥è¯´, $K_{SSB}$={0,â€¦,11}è¶³å¤Ÿ<br>å¯¹äºFR1æ¥è¯´ï¼Œ$K_{SSB}$={0,â€¦,23}ä¸å¤Ÿï¼Œéœ€è¦åœ¨PBCH payloadä¸­æ·»åŠ ä¸€ä½å…±åŒæŒ‡ç¤ºï¼Œå³$a_(A+5)$<br>**dmrs-TypeA Position **- PUSCH/PDSCH DMRSä½ç½®å‚æ•° <strong>1 bit</strong><br><strong>pdcch-ConfigSIB1</strong>- å…±8æ¯”ç‰¹ï¼Œç¡®å®šSIB1è°ƒåº¦çš„æ—¶é¢‘ä½ç½® <strong>8 bit</strong><br><strong>cellBarred</strong> - å°åŒºæ˜¯å¦è¢«å‡†è®¸æ¥å…¥æŒ‡ç¤º <strong>1 bit</strong><br><strong>intraFreqReselection</strong> - æ˜¯å¦å…è®¸åŒé¢‘é‡é€‰æŒ‡ç¤º <strong>1 bit</strong></p><h3 id="2-3-2-PBCH-payloadä¸­å…¶ä»–å†…å®¹"><a class="header-anchor" href="#2-3-2-PBCH-payloadä¸­å…¶ä»–å†…å®¹">Â¶</a>2.3.2 PBCH payloadä¸­å…¶ä»–å†…å®¹</h3><p>PBCH payloadè¿˜éœ€è¦åŠ ä¸ŠSFNçš„ä½4æ¯”ç‰¹ï¼Œhalf-frameåŠå¸§ä¿¡æ¯ï¼ˆç”±äº5mså†…æ˜ å°„å®Œæ‰€æœ‰SSBï¼Œéœ€è¦1æ¯”ç‰¹æŒ‡ç¤ºæ˜¯åœ¨å‰5 msè¿˜æ˜¯å5 msï¼Œ$n_{hf}$=0æ—¶ï¼Œè¡¨ç¤ºå‰åŠå¸§ï¼›å½“$n_{hf}$=1ï¼Œè¡¨ç¤ºç¬¬äºŒä¸ªåŠå¸§ï¼‰ï¼Œä»¥åŠ3æ¯”ç‰¹ SSB index(SSB indexçš„é«˜3æ¯”ç‰¹)æˆ–è€…$k_{ssb}$ä¿¡æ¯ï¼ˆå–å†³äºSSBæ€»æ•°ï¼Œå³ NR SSBæ—¶åŸŸé¢‘åŸŸåˆ†å¸ƒä¸­æ ¹æ®bandæŒ‡ç¤ºç¡®å®šçš„SSBæ€»æ•°Numï¼Œæˆ–è€…$L_{max}$ï¼‰ï¼Œæœ€ç»ˆPBCH payloadå…±<strong>32æ¯”ç‰¹</strong>ã€‚</p><h3 id="2-3-3-PBCH-payload-æ“ä½œ"><a class="header-anchor" href="#2-3-3-PBCH-payload-æ“ä½œ">Â¶</a>2.3.3 PBCH payload æ“ä½œ</h3><p><strong>step 1</strong> - ç¡®å®šè½½è·ä¸­å†…å®¹ï¼ˆç”±å‰æ–‡å·²çŸ¥ï¼‰<br><strong>step 2</strong> - reorder<br>æ ¹æ®æ¯”ç‰¹ä¿¡æ¯é‡æ–°è¿›è¡Œæ’åºï¼ŒG(j)å³ä¸ºæ’åºåçš„é¡ºåºã€‚æ“ä½œå (<strong>32 æ¯”ç‰¹</strong>) ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/5G_Protocol/5G-NR-SSB%E5%AD%A6%E4%B9%A0/9.png" alt></p><p><strong>step 3</strong> - scrambling<br>å¯¹äºç¡®å®š$v$å€¼çš„æ— çº¿å¸§å·å¯¹åº”çš„$2<sup>{nd}$/$3</sup>{rd}$ LSBï¼ŒåŠå¸§ä¿¡æ¯ä»¥åŠSSB indexä¸è¿›è¡ŒåŠ æ‰°ï¼ŒåŠ æ‰°åºåˆ—æ¯80 msè¿›è¡Œåˆå§‹åŒ–ï¼Œ$L_{max}$ä¹Ÿå³SSBæ€»æ•°ã€‚æ“ä½œå(<strong>32 æ¯”ç‰¹</strong>)ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><br><img src="/5G_Protocol/5G-NR-SSB%E5%AD%A6%E4%B9%A0/10.png" alt></p><p><strong>step 4</strong> - CRC æ·»åŠ å¾ªç¯å†—ä½™ç åè¾“å‡ºæ•°æ®é•¿åº¦ä¸º32+24 = <strong>56 æ¯”ç‰¹</strong><br><strong>step 5</strong> - Polar Coding è¾“å‡ºæ¯”ç‰¹é•¿åº¦ä¸ºN = $2^9$ = <strong>512æ¯”ç‰¹</strong><br><strong>step 6</strong> - Rate Matching è¾“å‡ºæ•°æ®é•¿åº¦ä¸ºE = <strong>864 æ¯”ç‰¹</strong>ï¼ˆE = 864å³æ–‡ç« NR SSBæ—¶åŸŸé¢‘åŸŸåˆ†å¸ƒä¸­çš„PBCHæ‰€å REä¸ªæ•°432ä¹˜ä»¥2ï¼‰</p><h2 id="2-4-PBCHåŠ æ‰°-è°ƒåˆ¶-REæ˜ å°„"><a class="header-anchor" href="#2-4-PBCHåŠ æ‰°-è°ƒåˆ¶-REæ˜ å°„">Â¶</a>2.4 PBCHåŠ æ‰°/è°ƒåˆ¶/REæ˜ å°„</h2><h3 id="2-4-1-åŠ æ‰°"><a class="header-anchor" href="#2-4-1-åŠ æ‰°">Â¶</a>2.4.1 åŠ æ‰°</h3><p>åŠ æ‰°éƒ¨åˆ†ç›¸å…³å‚æ•°å–å†³äºå°åŒºIDä¸SSB indexã€‚[TS 38.211 7.3.3.1] , åŠ æ‰°ç”±ä»¥ä¸‹å…¬å¼å¾—å‡ºï¼š<br>$$<br>\widetilde{b(i)} = (b(i)+c(i+vM_{bit}))mod2<br>$$<br>åŠ æ‰°åºåˆ— $c(i)$ åœ¨[TS 38.211 5.2.1]ç»™å‡ºï¼Œç”±$Gold$ åºåˆ—ç”Ÿæˆï¼Œæ­¤æ—¶åˆå§‹åŒ–ä¸º $c_{init} = N_{ID}^{cell}$ã€‚<br>-å¯¹äº $L_{max} = 4$ï¼Œ$v$ is the 2 LSB of SSB index ;<br>-å¯¹äº $L_{max} = 8\quad or\quad 64 $ï¼Œ$v$ is the 3 LSB of SSB index ;</p><h3 id="2-4-2-è°ƒåˆ¶"><a class="header-anchor" href="#2-4-2-è°ƒåˆ¶">Â¶</a>2.4.2 è°ƒåˆ¶</h3><p>PBCHä½¿ç”¨QPSKè°ƒåˆ¶æ–¹å¼ã€‚</p><h3 id="2-4-3-æ˜ å°„"><a class="header-anchor" href="#2-4-3-æ˜ å°„">Â¶</a>2.4.3 æ˜ å°„</h3><p>å‚ç…§2.1èŠ‚ NR SSBæ—¶åŸŸé¢‘åŸŸåˆ†å¸ƒä¸­çš„PBCHæ•°æ®éƒ¨åˆ†çš„REæ˜ å°„ï¼Œå…ˆæ—¶åŸŸåé¢‘åŸŸã€‚</p><h2 id="2-5-PBCH-DMRS"><a class="header-anchor" href="#2-5-PBCH-DMRS">Â¶</a>2.5 PBCH DMRS</h2><h3 id="2-5-1-åºåˆ—ç”Ÿæˆ"><a class="header-anchor" href="#2-5-1-åºåˆ—ç”Ÿæˆ">Â¶</a>2.5.1 åºåˆ—ç”Ÿæˆ</h3><p>UEåº”è¯¥é‡‡ç”¨å‚è€ƒä¿¡å·åºåˆ—$r(m)$å¯¹PBCH DMRSå®šä¹‰ï¼Œç›¸å…³å‚æ•°å–å†³äºå°åŒºIDï¼ŒSSB indexè¿˜æœ‰åŠå¸§ä¿¡æ¯æ¥è§‰å¾—ã€‚ç”±[TS 38.211 7.4.1.4.1]ç»™å‡ºï¼š<br>$$<br>r(m) = \frac{1}{ \sqrt{2} }(1-2<em>c(2m)) + j\frac{1}{ \sqrt{2} }(1-2</em>c(2m+1))<br>$$</p><p>åŠ æ‰°åºåˆ— $c(i)$ åœ¨[TS 38.211 5.2.1]ç»™å‡ºï¼Œç”±$Gold$ åºåˆ—ç”Ÿæˆï¼Œæ­¤æ—¶åˆå§‹åŒ–ä¸º $c_{init} $ç”±ä»¥ä¸‹å¾—å‡ºï¼š</p><p>$$<br>c_{init} = 2^{11}( \overline{i}<em>{SSB}+1)([N</em>{ID}^{cell}/4]+1) + 2^6( \overline{i}<em>{SSB}+1)) + (N</em>{ID}^{cell}mod4)<br>$$</p><p>-å¯¹äº $L_{max} = 4$ï¼Œ$\overline{i}<em>{SSB}$ æ˜¯SSB index çš„2æ¯”ç‰¹æœ€ä½æœ‰æ•ˆä½å’Œ1æ¯”ç‰¹åŠå¸§ä¿¡æ¯$n</em>{hf}$ (æ„æˆ3æ¯”ç‰¹ï¼Œé«˜ä½æ˜¯åŠå¸§ä¿¡æ¯ï¼Œä¹Ÿå³$\overline{i}<em>{SSB} = {i}</em>{SSB} + 4n_{hf}$ );<br>-å¯¹äº $L_{max} = 8\quad or\quad 64 $ï¼Œ$\overline{i}<em>{SSB}$ æ˜¯SSB index çš„3æ¯”ç‰¹æœ€ä½æœ‰æ•ˆä½(ä¹Ÿå³$\overline{i}</em>{SSB} = {i}<em>{SSB}$ )<br>-ä»¥ä¸Š${i}</em>{SSB}$ä¹Ÿå³åˆ†åˆ«å¯¹åº”2.4.1ä¸­çš„$v$ã€‚</p><h3 id="2-5-2-æ˜ å°„"><a class="header-anchor" href="#2-5-2-æ˜ å°„">Â¶</a>2.5.2 æ˜ å°„</h3><p>å‚ç…§2.1èŠ‚ NR SSBæ—¶åŸŸé¢‘åŸŸåˆ†å¸ƒä¸­çš„PBCH DMRSæ•°æ®éƒ¨åˆ†çš„REæ˜ å°„ï¼Œ$v = N_{ID}^{cell}mod4$(æ­¤æ—¶çš„vä¸åŒäºä¸Šæ–‡)ï¼Œå…ˆæ—¶åŸŸåé¢‘åŸŸã€‚<strong>åŒé¢‘é‚»åŒºè®¾ç½®ä¸åŒçš„åç§»æœ‰åˆ©äºé™ä½å¯¼é¢‘å¹²æ‰°</strong>ã€‚</p><h2 id="2-6-UE-SSBå¤„ç†è¿‡ç¨‹"><a class="header-anchor" href="#2-6-UE-SSBå¤„ç†è¿‡ç¨‹">Â¶</a>2.6 UE SSBå¤„ç†è¿‡ç¨‹</h2><p>UEçš„å¤„ç†è¿‡ç¨‹å³ä¸ºä¸Šè¿°è¿‡ç¨‹çš„ä¸€ä¸ªé€†è¿‡ç¨‹ã€‚</p><ol><li><p>é€šè¿‡PSS/SSSå¯ä»¥è·å¾—SSBçš„ç¬¦å·èµ·å§‹ä½ç½®ï¼Œå°åŒºIDï¼›</p></li><li><p>é€šè¿‡å°åŒºIDï¼Œå¯ä»¥è·å¾—PBCH DMRSçš„é¢‘åŸŸä½ç½®ï¼ŒPBCH DMRSæºå¸¦äº†3æ¯”ç‰¹ä¿¡æ¯ï¼Œå…·ä½“ä»£è¡¨çš„ä¿¡æ¯å–å†³äº$L_{max}$ã€‚PSS/SSSé¢‘ç‚¹ä¿¡æ¯å³ç¡®å®šäº†å…¶æ‰€å±Bandï¼Œä¹Ÿå°±èƒ½å¤Ÿç¡®å®š$L_{max}$çš„å€¼ï¼Œé‚£ä¹ˆ<br>1ï¼‰$L_{max} = 4$ï¼Œç¡®å®šSSB indexä»¥åŠåŠå¸§æŒ‡ç¤ºï¼›<br>2ï¼‰$L_{max} = 8\quad or\quad 64$ï¼Œç¡®å®šSSB indexä½3æ¯”ç‰¹ï¼›</p></li><li><p>PBCH REè§£æ˜ å°„ï¼Œè§£è°ƒåˆ¶ï¼Œ2.4.1èŠ‚å¤„åŠ æ‰°å¯¹åº”çš„ç¬¬ä¸€æ¬¡è§£æ‰°ï¼Œæ­¤å¤„è§£æ‰°é€šè¿‡å°åŒºIDä¸ç”±æ­¥éª¤2ä¸­ç¡®å®šSSB indexçš„æ¯”ç‰¹ä¿¡æ¯å¯ä»¥ç¡®å®šï¼›</p></li><li><p>PBCH è§£é€Ÿç‡åŒ¹é…ï¼ŒPolarè¯‘ç ï¼ŒCRCæ ¡éªŒï¼Œ2.3.3èŠ‚å¤„åŠ æ‰°å¯¹åº”çš„ç¬¬äºŒæ¬¡è§£æ‰°ï¼Œæ³¨æ„åˆ°æ— çº¿å¸§å·å¯¹åº”çš„2nd/3rd LSBæœªè¿›è¡ŒåŠ æ‰°ï¼Œå› æ­¤å¯ä»¥ç¡®å®šåŠ æ‰°åºåˆ—ï¼ŒCinit 80msä½œä¸ºä¸€æ¬¡åˆå§‹åŒ–ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p></li></ol><p><img src="/5G_Protocol/5G-NR-SSB%E5%AD%A6%E4%B9%A0/11.png" alt></p><ol start="5"><li>è§£äº¤ç»‡ï¼Œç¡®å®šPBCH payloadï¼›</li></ol><h2 id="2-7-åŒæ­¥è¿‡ç¨‹ç†è§£"><a class="header-anchor" href="#2-7-åŒæ­¥è¿‡ç¨‹ç†è§£">Â¶</a>2.7 åŒæ­¥è¿‡ç¨‹ç†è§£</h2><p>åŒæ­¥è¿‡ç¨‹æ˜¯ç§»åŠ¨ç»ˆç«¯è·å¾—æ— çº¿ç½‘ç»œçš„æ—¶é—´å’Œé¢‘ç‡çš„è¿‡ç¨‹ï¼Œæ˜¯ç»ˆç«¯æ¥å…¥ç½‘ç»œçš„å‰æã€‚ç»ˆç«¯è¦çŸ¥é“ç½‘ç»œåœ¨å“ªä¸ªæ—¶é—´ï¼Œå“ªä¸ªé¢‘ç‡ä¸Šå‘é€ä»€ä¹ˆæ¶ˆæ¯ï¼Œæ‰èƒ½æ­£ç¡®æ¥æ”¶ç½‘ç»œä¸‹å‘çš„ä¿¡æ¯ï¼Œè€ŒåŒæ­¥è¿‡ç¨‹å°±æ˜¯ä¸ºäº†ä½¿ç»ˆç«¯çŸ¥é“è¿™ä¸ªæ—¶é—´å’Œé¢‘ç‡ä¿¡æ¯è€Œè¿›è¡Œçš„ä¸€ç³»åˆ—æ“ä½œã€‚è¿™äº›æ“ä½œä¸2.6èŠ‚<strong>UE SSBå¤„ç†è¿‡ç¨‹</strong>ç›¸äº’é‡å ã€‚æ›´å½¢è±¡çš„æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/5G_Protocol/5G-NR-SSB%E5%AD%A6%E4%B9%A0/%E6%A6%82%E5%BF%B5.png" alt></p><p>ç¬¬ä¸€æ­¥çš„æ—¶é—´ä¸é¢‘ç‡åŒæ­¥æ‰€æŒ‡çš„æ˜¯ä¸€èˆ¬æ„ä¹‰ä¸Šï¼Œæˆ‘ä»¬åœ¨é€šä¿¡ç³»ç»Ÿè¯¾ç¨‹ä¸­ä¼šå­¦åˆ°çš„ï¼Œæ¥æ”¶ç«¯ä¸å‘å°„ç«¯åœ¨æ—¶é—´åŸŸå’Œé¢‘ç‡åŸŸä¸Šçš„åŒæ­¥ã€‚å®ƒå¹¶ä¸åœ¨5Gåè®®çš„è§„å®šèŒƒå›´ä¹‹å†…ï¼Œä¸€èˆ¬éƒ½æ˜¯ç”±èŠ¯ç‰‡å‚å®¶è‡ªå·±å®ç°çš„ã€‚è¿™ä¸€æ­¥å¸¸ç”¨çš„æ–¹æ³•æœ‰äº’ç›¸å…³æ£€æµ‹å’Œè‡ªç›¸å…³æ£€æµ‹ç­‰ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡å°†æ¥æ”¶ä¿¡å·ä¸å·²çŸ¥ä¿¡å·(PSS)åšäº’ç›¸å…³æ¥æ£€æµ‹å·²çŸ¥ä¿¡å·çš„ä½ç½®ï¼Œæˆ–è€…é€šè¿‡å¯¹æ¥æ”¶ä¿¡å·è‡ªèº«åšè‡ªç›¸å…³æ¥æ£€æµ‹å¾ªç¯å‰ç¼€ï¼ˆCPï¼‰çš„ä½ç½®ã€‚<br>è¿™ä¸€æ­¥æ˜¯ä¸ºäº†è·å¾—OFDMçš„ç¬¦å·åŒæ­¥ï¼ˆæ—¶é—´åŒæ­¥ï¼‰å’Œæ£€æµ‹åŒæ­¥ä¿¡å·æ‰€åœ¨é¢‘ç‡ï¼ˆé¢‘ç‡åŒæ­¥ï¼‰ã€‚</p><p>ä¸€ä¸ªå¯èƒ½çš„è¿‡ç¨‹ï¼š<br>1ã€ç»ˆç«¯å°†å°„é¢‘æ¥æ”¶æœºè°ƒè°åˆ°æŒ‡å®šé¢‘ç‚¹;<br>2ã€åœ¨æ—¶åŸŸå¯¹PSSåš<strong>äº’ç›¸å…³æ£€æµ‹</strong>ä»¥å–å¾—æ—¶åŸŸåŒæ­¥ï¼ŒåŒæ—¶è·å¾—$N_{ID}^{(2)}$; (åœ¨SSBçš„ç¬¬ä¸€ä¸ªsymbolæ—¶é—´å†…ï¼ŒSSBé¢‘åŸŸèŒƒå›´å†…åªæœ‰PSSä¿¡å·ï¼Œå› æ­¤å¯ä»¥å¯¹å®ƒåšç›¸å…³æ£€æµ‹; ç›¸åï¼Œå› ä¸ºSSSæ‰€åœ¨çš„ç¬¬ä¸‰ä¸ªsymbolæ—¶é—´å†…è¿˜æœ‰PBCHï¼Œæ‰€ä»¥æ— æ³•å¯¹å®ƒåšæ—¶åŸŸç›¸å…³æ£€æµ‹ï¼‰<br>3ã€æ ¹æ®PSSçš„ä½ç½®å¯ä»¥è·å¾—SSSçš„ä½ç½®ï¼Œåœ¨é¢‘åŸŸå¯¹SSSåšäº’ç›¸å…³æ£€æµ‹ï¼Œå¯ä»¥è·å¾—é¢‘åŸŸåŒæ­¥å¹¶åŒæ—¶è·å¾—$N_{ID}^{(1)}$;<br>4ã€ç”±$N_{ID}^{(1)}$; å’Œ$N_{ID}^{(2)}$; å¯ä»¥è·å¾—PCIï¼Œç”±PCIåˆå¯ä»¥è¿›ä¸€æ­¥è§£ç PBCH DMRS, ä»è€Œè·å¾—SSB indexå’Œ half frame number $n_{hf}$;<br>5ã€æœ€ååˆ©ç”¨å¯¹DMRSçš„ä¿¡é“ä¼°è®¡ï¼Œç»ˆç«¯è§£ç PBCHå¹¶è·å¾—ç³»ç»Ÿæ¶ˆæ¯MIBã€‚</p><p>è¿™é‡Œæ˜¯ä¸€ä¸ªmatlabå¯¹ä¸Šè¿°è¿‡ç¨‹çš„æ¨¡æ‹Ÿç¨‹åºï¼š</p><blockquote><p><a href="https://www.mathworks.com/help/5g/examples/NR-Synchronization-Procedures.html" target="_blank" rel="noopener">https://www.mathworks.com/help/5g/examples/NR-Synchronization-Procedures.html</a></p></blockquote><p>ç”±ä¸Šä¸€æ­¥å¯çŸ¥ï¼ŒUE SSBå¤„ç†è¿‡ç¨‹ä¸åŒæ­¥è¿‡ç¨‹å¦‚å‡ºä¸€è¾™ï¼Œå°±æ˜¯ä¸ºäº†ä½¿ç»ˆç«¯çŸ¥é“è¿™ä¸ªæ—¶é—´å’Œé¢‘ç‡ä¿¡æ¯è€Œè¿›è¡Œçš„ä¸€ç³»åˆ—æ“ä½œã€‚</p><blockquote><p>ä¸»è¦å‚è€ƒï¼š<br>å¾®ä¿¡å…¬ä¼—å·ï¼š5Gèœé¸Ÿæˆé•¿æ—¥è®°ï¼Œ<br>åšå®¢ï¼š<a href="https://www.cnblogs.com/beilou310/p/11162798.html" target="_blank" rel="noopener">https://www.cnblogs.com/beilou310/p/11162798.html</a><br>åšå®¢ï¼š<a href="https://blog.csdn.net/qq_44113393/article/details/89844595" target="_blank" rel="noopener">https://blog.csdn.net/qq_44113393/article/details/89844595</a><br>åšå®¢ï¼š<a href="https://blog.csdn.net/m0_45416816/article/details/96605980" target="_blank" rel="noopener">https://blog.csdn.net/m0_45416816/article/details/96605980</a></p></blockquote><!-- rebuild by neat -->]]></content>
      <categories>
        <category>5G_Protocol</category>
      </categories>
      <tags>
        <tag>SSB</tag>
      </tags>
  </entry>
</search>
