<!-- build time:Thu May 13 2021 17:35:57 GMT+0800 (GMT+08:00) --><!DOCTYPE html><html class="theme-next muse use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link href="/lib/pace/pace-theme-bounce.min.css?v=1.0.2" rel="stylesheet"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.jpg?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="Database,"><meta property="og:type" content="article"><meta property="og:title" content="MySQL常用命令"><meta property="og:url" content="https://czgitaccount.github.io/Database/MySQL%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/index.html"><meta property="og:site_name" content="CongZ&#39;s Blog"><meta property="article:published_time" content="2021-05-05T01:15:56.000Z"><meta property="article:modified_time" content="2021-05-05T15:35:13.000Z"><meta property="article:author" content="从之丶"><meta property="article:tag" content="Database"><meta name="twitter:card" content="summary"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Muse",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:"ture",onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="https://czGitAccount.github.io/Database/MySQL常用命令/"><title>MySQL常用命令 | CongZ's Blog</title><meta name="generator" content="Hexo 4.2.0"></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">CongZ's Blog</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">择其善者而从之，其不善者而改之 !</p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://czGitAccount.github.io/Database/MySQL%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="从之丶"><meta itemprop="description" content=""><meta itemprop="image" content="/images/logo.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="CongZ's Blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">MySQL常用命令</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-05-05T09:15:56+08:00">2021-05-05 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Database/" itemprop="url" rel="index"><span itemprop="name">Database</span></a></span></span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">5.8k </span><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">27</span></div></div></header><div class="post-body" itemprop="articleBody"><div class="out-img-topic"><img src="/Database/MySQL常用命令/春光明媚.jpg" class="img-topic"></div><div class="post-button text-center"><div>春日阳光</div></div><a id="more"></a><h3 id="1-操作数据库"><a href="#1-操作数据库" class="headerlink" title="1  操作数据库"></a>1 操作数据库</h3><h4 id="1-1-创建数据库"><a href="#1-1-创建数据库" class="headerlink" title="1.1 创建数据库"></a>1.1 创建数据库</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE mydb1;</span><br><span class="line"></span><br><span class="line">CREATE DATABASE mydb2 CHARACTER SET utf8; # 定义编码集</span><br><span class="line"></span><br><span class="line">CREATE DATABASE mydb3 CHARACTER SET utf8 COLLATE utf8_bin; # 定义校对规则</span><br></pre></td></tr></table></figure><h4 id="1-2-查看数据库"><a href="#1-2-查看数据库" class="headerlink" title="1.2 查看数据库"></a>1.2 查看数据库</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SHOW DATABASES # 查看当前数据库服务器中所有数据库</span><br><span class="line"></span><br><span class="line">SHOW CREATE DATABASE mydb1; # 查看前面创建的mydb1数据库的定义信息</span><br></pre></td></tr></table></figure><h4 id="1-3-修改数据库"><a href="#1-3-修改数据库" class="headerlink" title="1.3 修改数据库"></a>1.3 修改数据库</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ALTER DATABASE mydb1 CHARACTER SET utf8; # 修改编码集</span><br><span class="line"></span><br><span class="line">ALTER DATABASE mydb1 COLLATE utf8_bin; # 修改校对规则</span><br></pre></td></tr></table></figure><h4 id="1-4-删除数据库"><a href="#1-4-删除数据库" class="headerlink" title="1.4 删除数据库"></a>1.4 删除数据库</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP DATABASE mydb1; # 删除</span><br></pre></td></tr></table></figure><h4 id="1-5-选择数据库"><a href="#1-5-选择数据库" class="headerlink" title="1.5 选择数据库"></a>1.5 选择数据库</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">use mydb1;  # 进入，没有退出操作</span><br><span class="line"></span><br><span class="line">SELECT DATABASE(); # 查看当前所选的数据库</span><br></pre></td></tr></table></figure><h3 id="2-表"><a href="#2-表" class="headerlink" title="2  表"></a>2 表</h3><h4 id="2-1-增加表"><a href="#2-1-增加表" class="headerlink" title="2.1 增加表"></a>2.1 增加表</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE t1</span><br><span class="line">(</span><br><span class="line">    id INT,</span><br><span class="line">    name VARCHAR(20),</span><br><span class="line">    gender CHAR(1),</span><br><span class="line">    worktime DATE,</span><br><span class="line">    money DOUBLE</span><br><span class="line">) CHARACTER SET utf8 COLLATE utf8_bin;</span><br></pre></td></tr></table></figure><h4 id="2-2-查找表"><a href="#2-2-查找表" class="headerlink" title="2.2 查找表"></a>2.2 查找表</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SHOW TABLES; # 查看表</span><br><span class="line"></span><br><span class="line">SHOW CREATE TABLE mytable； # 查看表的建表语句</span><br><span class="line"></span><br><span class="line">DESC mytable;  # 查看表结构</span><br></pre></td></tr></table></figure><h4 id="2-3-修改表"><a href="#2-3-修改表" class="headerlink" title="2.3 修改表"></a>2.3 修改表</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE mytable1 ADD image BLOB; # 新增列</span><br><span class="line"></span><br><span class="line">ALTER TABLE mytable1 MODIFY name VARCHAR(25); # 修改列的类型</span><br><span class="line"></span><br><span class="line">ALTER TABLE mytable1 DROP gender; # 删除某列</span><br><span class="line"></span><br><span class="line">ALTER TABLE mytable1 CHARACTER SET utf8; # 修改表的字符集</span><br><span class="line"></span><br><span class="line">ALTER TABLE mytable1 CHANGE name username VARCHAR(20); # 修改列名</span><br><span class="line"></span><br><span class="line">RENAME TABLE mytable1 TO mytable2; # 修改表名 mytable1 -&gt; mytable2</span><br></pre></td></tr></table></figure><h4 id="2-4-删除表"><a href="#2-4-删除表" class="headerlink" title="2.4 删除表"></a>2.4 删除表</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP TABLE mytable1;</span><br></pre></td></tr></table></figure><h4 id="2-5-各种约束"><a href="#2-5-各种约束" class="headerlink" title="2.5 各种约束"></a>2.5 各种约束</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE t1</span><br><span class="line">(</span><br><span class="line">    id INT PRIMARY KEY AUTO_INCREMENT, # 主键约束,自动增长</span><br><span class="line">    name VARCHAR(20) UNIQUE,  # 唯一约束   </span><br><span class="line">    gender CHAR(1) NOT NULL,  # 非空约束</span><br><span class="line">    worktime DATE,</span><br><span class="line">    money DOUBLE DEFAULT 10000.0  # 默认值约束</span><br><span class="line">) CHARACTER SET utf8 COLLATE utf8_bin;</span><br><span class="line"></span><br><span class="line">FOREIGN KEY &#x2F;&#x2F; 外键约束</span><br></pre></td></tr></table></figure><h4 id="2-6-索引"><a href="#2-6-索引" class="headerlink" title="2.6 索引"></a>2.6 索引</h4><h5 id="2-6-1-创建索引"><a href="#2-6-1-创建索引" class="headerlink" title="2.6.1 创建索引"></a>2.6.1 创建索引</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">#&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;</span><br><span class="line">#&#x2F;&#x2F; 方式一 ： 建表时候创建索引</span><br><span class="line">#&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;</span><br><span class="line"># 创建普通索引</span><br><span class="line">CREATE TABLE t1</span><br><span class="line">(</span><br><span class="line">    id INT, </span><br><span class="line">    INDEX bieming(id) </span><br><span class="line">)；</span><br><span class="line"></span><br><span class="line"># 创建唯一索引,升序</span><br><span class="line">CREATE TABLE t2</span><br><span class="line">(</span><br><span class="line">    id INT, </span><br><span class="line">    UNIQUE INDEX bieming(id, ASC) </span><br><span class="line">)；</span><br><span class="line"></span><br><span class="line"># 创建全文索引</span><br><span class="line">CREATE TABLE t3</span><br><span class="line">(</span><br><span class="line">    name VARCHAR(20), </span><br><span class="line">    FULLTEXT INDEX bieming(name) </span><br><span class="line">)ENGINE&#x3D;MyISAM; # 必须使用 myisam引擎</span><br><span class="line"></span><br><span class="line"># 创建多列索引</span><br><span class="line">CREATE TABLE t4</span><br><span class="line">(</span><br><span class="line">    id INT, </span><br><span class="line">    name VARCHAR(20),</span><br><span class="line">    INDEX bieming(id,name(20)) </span><br><span class="line">)；</span><br><span class="line"></span><br><span class="line"># 创建空间索引</span><br><span class="line">CREATE TABLE t5</span><br><span class="line">(</span><br><span class="line">    a1 GEOMETRY,</span><br><span class="line">    a2 POINT,</span><br><span class="line">    a3 LINESTRING,</span><br><span class="line">    a4 POLYGON</span><br><span class="line">    SPATIAL INDEX bieming(a1) </span><br><span class="line">)ENGINE&#x3D;MyISAM; # 必须使用 myisam引擎</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;</span><br><span class="line">#&#x2F;&#x2F; 方式二： 在已经存在的表上创建索引</span><br><span class="line">#&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CREATE TABLE t1</span><br><span class="line">(</span><br><span class="line">    id INT, &#x2F;&#x2F; 主键约束,自动增长</span><br><span class="line">    name VARCHAR(20), &#x2F;&#x2F; 唯一约束   </span><br><span class="line">    gender CHAR(1),  &#x2F;&#x2F; 非空约束</span><br><span class="line">    worktime DATE,</span><br><span class="line">    money DOUBLE  &#x2F;&#x2F; 默认值约束</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">CREATE INDEX bieming on t1(id);          	# 创建普通索引</span><br><span class="line">CREATE UNIQUE INDEX bieming on t1(id, ASC); # 创建唯一索引</span><br><span class="line">CREATE FULLTEXT INDEX bieming on t1(id); 	# 创建全文索引</span><br><span class="line">CREATE INDEX bieming on t1(id, gender(1));  # 创建多列索引</span><br><span class="line">CREATE SPATIAL INDEX bieming on t1(id);  	# 创建空间索引</span><br></pre></td></tr></table></figure><h5 id="2-6-2-删除索引"><a href="#2-6-2-删除索引" class="headerlink" title="2.6.2 删除索引"></a>2.6.2 删除索引</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE t1 DROP INDEX bieming;</span><br><span class="line"></span><br><span class="line">DROP INDEX beiming ON t1;</span><br></pre></td></tr></table></figure><h3 id="3-操作表记录"><a href="#3-操作表记录" class="headerlink" title="3 操作表记录"></a>3 操作表记录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; desc test2;</span><br><span class="line">#+--------+----------+------+-----+---------+-------+</span><br><span class="line">#| Field  | Type     | Null | Key | Default | Extra |</span><br><span class="line">#+--------+----------+------+-----+---------+-------+</span><br><span class="line">#| id     | int      | YES  |     | NULL    |       |</span><br><span class="line">#| name   | char(50) | YES  |     | NULL    |       |</span><br><span class="line">#| gender | char(1)  | YES  |     | NULL    |       |</span><br><span class="line">#| salary | double   | YES  |     | NULL    |       |</span><br><span class="line">#+--------+----------+------+-----+---------+-------+</span><br></pre></td></tr></table></figure><h4 id="4-1-insert"><a href="#4-1-insert" class="headerlink" title="4.1 insert"></a>4.1 insert</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO test1(id, name, gender) VALUES(10, &#39;JACK&#39;, &#39;M&#39;); # 可以缺省</span><br><span class="line"></span><br><span class="line">INSERT INTO test1 VALUES(11, &#39;MAC&#39;, &#39;M&#39;, 123.245); # 省去field 必须满足列数相同</span><br><span class="line">												   # 且可以一次性添加多条</span><br><span class="line">INSERT INTO test1 VALUES(11, &#39;MAC&#39;, &#39;M&#39;, 123.245), (12, &#39;MAcC&#39;, &#39;M&#39;, 123.5245);</span><br></pre></td></tr></table></figure><h4 id="4-2-update"><a href="#4-2-update" class="headerlink" title="4.2 update"></a>4.2 update</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">UPDATE test1 SET salary &#x3D; 5000; # 表内所有人工资变成 5000</span><br><span class="line"></span><br><span class="line">UPDATE test1 SET salary &#x3D; 3000 WHERE name &#x3D; &#39;A&#39;; # 表内名为 A 的工资更新为 3000</span><br><span class="line"></span><br><span class="line">UPDATE test1 SET salary &#x3D; 4000, gender &#x3D; &#39;f&#39; WHERE &#x3D; &#39;B&#39;; # B 改为4000， 女</span><br><span class="line"></span><br><span class="line">UPDATE test1 SET salary &#x3D; salary + 1000 WHERE name &#x3D; &#39;C&#39;; # 支持表达式运算</span><br></pre></td></tr></table></figure><h4 id="4-3-delete，truncate"><a href="#4-3-delete，truncate" class="headerlink" title="4.3 delete，truncate"></a>4.3 delete，truncate</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DELETE FROM test1 WHERE name &#x3D; &#39;C&#39;; # 删除 C 的数据</span><br><span class="line"></span><br><span class="line">DELETE FROM test1;  # 删除表中所有数据</span><br><span class="line"></span><br><span class="line">TRUNCATE test1;     # 删除表中所有数据 -&gt; 摧毁表并创建新的表格</span><br></pre></td></tr></table></figure><h3 id="4-单表查询"><a href="#4-单表查询" class="headerlink" title="4 单表查询"></a>4 单表查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#+----+-------+--------+--------+-----------+</span><br><span class="line">#| id | name  | gender | salary | allowance |</span><br><span class="line">#+----+-------+--------+--------+-----------+</span><br><span class="line">#|  1 | Alice | M      |   5000 |       500 |</span><br><span class="line">#|  2 | Bob   | M      |   4500 |       400 |</span><br><span class="line">#|  3 | Cc    | F      |   6000 |       600 |</span><br><span class="line">#+----+-------+--------+--------+-----------+</span><br></pre></td></tr></table></figure><h4 id="4-1-简单查询"><a href="#4-1-简单查询" class="headerlink" title="4.1 简单查询"></a><strong>4.1 简单查询</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM test2;  # 查询所有内容</span><br><span class="line"></span><br><span class="line">SELECT id, name FROM test2;  # 查询 id 和 name , 注意 逗号</span><br><span class="line"></span><br><span class="line">SELECT DISTINCT gender FROM test2;  # 过滤表中重复的数据</span><br><span class="line"></span><br><span class="line">SELECT name, salary + 1200 FROM test2;  # 查询税前薪水（+1200） 数据库底层数据没有改变</span><br><span class="line"></span><br><span class="line">SELECT name, salary + allowance FROM test2;  # 统计薪水 + 津贴</span><br><span class="line"></span><br><span class="line">SELECT name AS 姓名, salary + allowance AS 总工资 FROM test2;  # 使用别名</span><br><span class="line">SELECT name 序号, salary + allowance 总工资 FROM test2; 		  # as 用空格代替</span><br></pre></td></tr></table></figure><h4 id="4-2-带有过滤的查询"><a href="#4-2-带有过滤的查询" class="headerlink" title="4.2 带有过滤的查询"></a><strong>4.2 带有过滤的查询</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM test2 WHERE name &#x3D; &#39;A&#39;;  # 查询 A 的所有数据</span><br><span class="line"></span><br><span class="line">SELECT * FROM test2 WHERE salary &gt; 5000;  # 查询 薪水大于 5000 的用户</span><br><span class="line"></span><br><span class="line">SELECT * FROM test2 WHERE salary + allowance &gt; 4000;  # 查询薪水 + 津贴大于 4000 的用户 </span><br><span class="line"></span><br><span class="line">SELECT * FROM test2 WHERE salary BETWEEN 3500 AND 6500;  # 查询薪水在 3500- 6500 之间</span><br><span class="line"></span><br><span class="line">SELECT * FROM test2 WHERE salary IN (4000, 6000);  # 查询薪水在 4000 和 6000 </span><br><span class="line"></span><br><span class="line">SELECT * FROM test2 WHERE name like &#39;A%&#39;;   # 模糊查找名字有A （% -&gt; 0-n 个， _ -&gt;0-1个）</span><br><span class="line">SELECT * FROM test2 WHERE name like &#39;A____&#39;;  #&#x2F; _ 数量对应</span><br><span class="line"></span><br><span class="line">SELECT * FROM test2 WHERE salary &gt; 4000 and allowance &gt; 500;</span><br></pre></td></tr></table></figure><h4 id="4-3-聚合函数"><a href="#4-3-聚合函数" class="headerlink" title="4.3 聚合函数"></a><strong>4.3 聚合函数</strong></h4><ol><li>count 聚合函数，用来统计行数</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT COUNT(*) FROM test2;</span><br><span class="line"></span><br><span class="line">SELECT COUNT(*) FROM test2 WHERE salary + allowance &gt; 4000; # 查薪水津贴大于4000的用户数</span><br></pre></td></tr></table></figure><ol><li>sum 聚合函数，求符合条件的某列的和值</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT SUM(salary) FROM test1;  # 所有人的总薪水</span><br><span class="line"></span><br><span class="line">SELECT SUM(salary + allowance) FROM test1;  # 所有人的总收入（薪水+津贴）</span><br><span class="line"></span><br><span class="line">SELECT SUM(salary + allowance) &#x2F; COUNT(*) FROM test1;  # 收入的平均水平</span><br></pre></td></tr></table></figure><ol><li>avg 聚合函数，求符合条件的列的平均值</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT AVG(salary) FROM test1;  # 求薪水的平均值</span><br></pre></td></tr></table></figure><ol><li>max / min ，求符合条件的列的最大最小值</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT MAX(salary) FROM test1;  # 最大值</span><br><span class="line">SELECT MIN(salary) FROM test1;  # 最小值</span><br></pre></td></tr></table></figure><h4 id="4-4-排序查询"><a href="#4-4-排序查询" class="headerlink" title="4.4 排序查询"></a><strong>4.4 排序查询</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SELECT name, salary FROM test1 ORDER BY salary;  # 按照薪水大小排序 升序</span><br><span class="line">SELECT name, salary FROM test1 ORDER BY salary DESC; # 降序</span><br><span class="line"></span><br><span class="line">SELECT name 姓名, salary + allowance 总收入 FROM test1 ORDER BY 总收入 DESC;  # 按照总收入降序排序</span><br><span class="line"></span><br><span class="line">SELECT name 姓名, salary + allowance 总收入 FROM test1 WHERE id &lt; 3 ORDER BY 总收入 DESC;  # 按照id&lt;3 总收入降序排序（使用别名）</span><br></pre></td></tr></table></figure><h4 id="4-5-分组查询"><a href="#4-5-分组查询" class="headerlink" title="4.5 分组查询"></a><strong>4.5 分组查询</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE ORDERS(</span><br><span class="line">	id int,</span><br><span class="line">    product varchar(20),</span><br><span class="line">    price float</span><br><span class="line">);</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">SELECT *FROM orders GROUP BY product;  # 按照商品分组查找</span><br><span class="line"></span><br><span class="line">SELECT product, SUM(price) FROM orders GROUP BY product;  # 分组合并价格总数</span><br><span class="line"></span><br><span class="line"># 查询总价大于100的商品名称，含组合</span><br><span class="line"></span><br><span class="line"># WHERE 在分组之前过滤 不满足条件 且不允许使用聚合语句</span><br><span class="line">SELECT product, SUM(price) FROM orders WHERE price &gt; 100 GROUP BY product;  √ 一半</span><br><span class="line">SELECT product, SUM(price) FROM orders WHERE SUM(price) &gt; 100 GROUP BY product;  x</span><br><span class="line"></span><br><span class="line"># HAVING 分组之后</span><br><span class="line">SELECT product, SUM(price) FROM orders GROUP BY product HAVING SUM(price) &gt; 100;</span><br><span class="line"></span><br><span class="line"># 总价大于100，单价小于100</span><br><span class="line">SELECT product, SUM(price) FROM orders WHERE price &lt; 100 GROUP BY product HAVING sum(price) &gt; 100;</span><br></pre></td></tr></table></figure><h4 id="4-6-limit"><a href="#4-6-limit" class="headerlink" title="4.6 limit "></a><strong>4.6 limit</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM cast LIMIT 5;    # 从第1条开始取5条</span><br><span class="line">SELECT * FROM cast LIMIT 5, 5; # 从第6条开始取5条</span><br></pre></td></tr></table></figure><h4 id="4-7-别名"><a href="#4-7-别名" class="headerlink" title="4.7 别名"></a><strong>4.7 别名</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM tableName AS otherName;  # 给表明取别名  AS 可以省略</span><br><span class="line"></span><br><span class="line">SELECT * FROM student AS s WHERE s.gender &#x3D; &#39;F&#39;;</span><br><span class="line"></span><br><span class="line">SELECT name AS 姓名 FROM tablename;  # 字段别名</span><br></pre></td></tr></table></figure><h3 id="5-多表查询"><a href="#5-多表查询" class="headerlink" title="5 多表查询"></a>5 多表查询</h3><h4 id="5-1-添加外键约束"><a href="#5-1-添加外键约束" class="headerlink" title="5.1 添加外键约束"></a><strong>5.1 添加外键约束</strong></h4><h5 id="5-1-1-声明表的时候添加外键"><a href="#5-1-1-声明表的时候添加外键" class="headerlink" title="5.1.1 声明表的时候添加外键"></a><strong>5.1.1 声明表的时候添加外键</strong></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">FOREIGN KEY(dept_id) REFERENCES dept(id) </span><br><span class="line"></span><br><span class="line">CREATE TABLE dept (</span><br><span class="line">	id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">    name VARCHAR(50)</span><br><span class="line">);</span><br><span class="line">INSERT INTO dept VALUES(NULL,&#39;财务部&#39;),(NULL,&#39;人事部&#39;),(NULL,&#39;行政部&#39;),(NULL,&#39;科技部&#39;);</span><br><span class="line">CREATE TABLE emp (</span><br><span class="line">	id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">    name VARCHAR(50),</span><br><span class="line">    dept_id INT,</span><br><span class="line">    FOREIGN KEY(dept_id) REFERENCES dept(id)  # 创建表的时候添加外键约束</span><br><span class="line">);</span><br><span class="line">INSERT INTO emp VALUES(NULL,&#39;奥巴马&#39;,1),(NULL,&#39;拜登&#39;,3),(NULL,&#39;林肯&#39;,4),(NULL,&#39;特朗普&#39;,2);</span><br></pre></td></tr></table></figure><h5 id="5-5-2-表已经存在"><a href="#5-5-2-表已经存在" class="headerlink" title="5.5.2 表已经存在"></a><strong>5.5.2 表已经存在</strong></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ALTER TALBE 表名 ADD CONSTRAINT fk_id FOREIGN KEY (外键字段名) REFERENCES 外表表名（主键字段名）</span><br><span class="line"></span><br><span class="line">ALTER TABLE emp ADD CONSTRAINT aaa_fk FOREIGN KEY (dept_id) REFERENCES dept(id);</span><br></pre></td></tr></table></figure><h5 id="5-5-3-删除外键"><a href="#5-5-3-删除外键" class="headerlink" title="5.5.3 删除外键"></a>5.5.3 删除外键</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE emp DROP FOREIGN KEY aaa_fk;  # 删除外键名</span><br></pre></td></tr></table></figure><h4 id="5-2-操作关联表"><a href="#5-2-操作关联表" class="headerlink" title="5.2 操作关联表"></a>5.2 操作关联表</h4><h5 id="5-2-1-添加数据"><a href="#5-2-1-添加数据" class="headerlink" title="5.2.1 添加数据"></a>5.2.1 添加数据</h5><h5 id="5-2-2-删除数据"><a href="#5-2-2-删除数据" class="headerlink" title="5.2.2 删除数据"></a>5.2.2 删除数据</h5><h4 id="5-3-连接查询"><a href="#5-3-连接查询" class="headerlink" title="5.3 连接查询"></a>5.3 连接查询</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">#+----+--------+</span><br><span class="line">#| id | name   |</span><br><span class="line">#+----+--------+</span><br><span class="line">#|  1 | 财务部 |</span><br><span class="line">#|  2 | 人事部 |</span><br><span class="line">#|  3 | 行政部 |</span><br><span class="line">#|  4 | 科技部 |</span><br><span class="line">#|  5 | 商务部 |</span><br><span class="line">#+----+--------+</span><br><span class="line">#+----+--------+---------+</span><br><span class="line">#| id | name   | dept_id |</span><br><span class="line">#+----+--------+---------+</span><br><span class="line">#|  1 | 奥巴马 |       1 |</span><br><span class="line">#|  2 | 拜登   |       3 |</span><br><span class="line">#|  3 | 林肯   |       4 |</span><br><span class="line">#|  4 | 特朗普 |       4 |</span><br><span class="line">#|  5 | 克林顿 |       6 |</span><br><span class="line">#+----+--------+---------+</span><br><span class="line"></span><br><span class="line"># 笛卡尔积查询  -&gt; 两张表相乘的结果</span><br><span class="line">SELECT * FROM dept, emp;   </span><br><span class="line"></span><br><span class="line"># 内连接查询    -&gt; 查询两张表都有的记录</span><br><span class="line">SELECT * FROM dept, emp WHERE dept.id &#x3D; emp.dept_id;</span><br><span class="line">SELECT * FROM dept INNER JOIN emp ON dept.id &#x3D; emp.dept_id;</span><br><span class="line"></span><br><span class="line"># 左外连接查询  -&gt; 在内连接的基础上增加左有右无的记录</span><br><span class="line">SELECT * FROM dept LEFT JOIN emp ON dept.id &#x3D; emp.dept_id;</span><br><span class="line"></span><br><span class="line"># 左外连接查询  -&gt; 在内连接的基础上增加右有左无的记录</span><br><span class="line">SELECT * FROM dept RIGHT JOIN emp ON dept.id &#x3D; emp.dept_id;</span><br><span class="line"></span><br><span class="line"># 全外连接查询   mysql #不支持#</span><br><span class="line">SELECT * FROM dept FULL JOIN emp ON dept.id &#x3D; emp.dept_id;</span><br><span class="line"></span><br><span class="line"># 全外连接查询  mysql 方式 利用 union 操作</span><br><span class="line">SELECT * FROM dept LEFT JOIN emp ON dept.id &#x3D; emp.dept_id</span><br><span class="line">union</span><br><span class="line">SELECT * FROM dept RIGHT JOIN emp ON dept.id &#x3D; emp.dept_id;</span><br><span class="line"></span><br><span class="line"># 查询 dept_id &#x3D; 4 的部门名称和其中的员工的姓名（包含id）</span><br><span class="line">SELECT * FROM dept INNER JOIN emp ON dept.id &#x3D; emp.dept_id WHERE dept.id &#x3D; 4;</span><br><span class="line"></span><br><span class="line"># 查询 dept_id &#x3D; 4 的部门名称和其中的员工的姓名（不包含id）</span><br><span class="line">SELECT dept.name AS 部门, emp.name AS 姓名 FROM dept INNER JOIN emp ON dept.id &#x3D; emp.dept_id WHERE dept.id &#x3D; 4;</span><br></pre></td></tr></table></figure><h4 id="5-4-子查询"><a href="#5-4-子查询" class="headerlink" title="5.4 子查询"></a>5.4 子查询</h4><h5 id="5-4-1-带-in-关键字的子查询"><a href="#5-4-1-带-in-关键字的子查询" class="headerlink" title="5.4.1 带 in 关键字的子查询"></a>5.4.1 带 in 关键字的子查询</h5><p><em>使用 in 关键字进行子查询时，内层查询语句仅仅返回一个数据列，这个数据列中的值将供外层查询语句进行比较操作。</em></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"># 建立表格</span><br><span class="line">CREATE TABLE department (</span><br><span class="line">	did INT,</span><br><span class="line">    dname VARCHAR(50)</span><br><span class="line">);</span><br><span class="line">INSERT INTO department VALUES(1,&#39;网络部&#39;),(2,&#39;媒体部&#39;),(3,&#39;研发部&#39;),(5,&#39;人事部&#39;);</span><br><span class="line"></span><br><span class="line">#+------+--------+</span><br><span class="line">#| did  | dname  |</span><br><span class="line">#+------+--------+</span><br><span class="line">#|    1 | 网络部 |</span><br><span class="line">#|    2 | 媒体部 |</span><br><span class="line">#|    3 | 研发部 |</span><br><span class="line">#|    5 | 人事部 |</span><br><span class="line">#+------+--------+</span><br><span class="line"></span><br><span class="line">CREATE TABLE employee (</span><br><span class="line">	id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">    name VARCHAR(50),</span><br><span class="line">    age INT,</span><br><span class="line">    did INT</span><br><span class="line">);</span><br><span class="line">INSERT INTO employee VALUES(NULL, &#39;张三&#39;, 20, 1),(NULL, &#39;李四&#39;, 22, 1),(NULL, &#39;王五&#39;, 20, 2),(NULL, &#39;刘六&#39;, 20, 4);</span><br><span class="line"></span><br><span class="line">#+----+------+------+------+</span><br><span class="line">#| id | name | age  | did  |</span><br><span class="line">#+----+------+------+------+</span><br><span class="line">#|  1 | 张三 |   20 |    1 |</span><br><span class="line">#|  2 | 李四 |   22 |    1 |</span><br><span class="line">#|  3 | 王五 |   20 |    2 |</span><br><span class="line">#|  4 | 刘六 |   20 |    4 |</span><br><span class="line">#+----+------+------+------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 查询存在年龄为20的员工的部门</span><br><span class="line"></span><br><span class="line"># 1. 查询年龄为20的员工信息</span><br><span class="line">SELECT did FROM employee WHERE age &#x3D; 20;</span><br><span class="line"># 2. 查询他们的部门,将 1 作为嵌套语句</span><br><span class="line">SELECT dname FROM department WHERE did IN (SELECT did FROM employee WHERE age &#x3D; 20);</span><br></pre></td></tr></table></figure><h5 id="5-4-2-带-not-in-关键字的子查询"><a href="#5-4-2-带-not-in-关键字的子查询" class="headerlink" title="5.4.2 带 not in 关键字的子查询"></a>5.4.2 带 not in 关键字的子查询</h5><p><em>与 in 关键词 相反</em></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 查询存在年龄不是20的员工的部门</span><br><span class="line"></span><br><span class="line"># 1. 查询年龄为20的员工信息</span><br><span class="line">SELECT did FROM employee WHERE age &#x3D; 20;</span><br><span class="line"># 2. 查询他们的部门,将 1 作为嵌套语句</span><br><span class="line">SELECT dname FROM department WHERE did NOT IN (SELECT did FROM employee WHERE age &#x3D; 20);</span><br></pre></td></tr></table></figure><h5 id="5-4-3-带-exists-关键字的子查询"><a href="#5-4-3-带-exists-关键字的子查询" class="headerlink" title="5.4.3 带 exists 关键字的子查询"></a>5.4.3 带 exists 关键字的子查询</h5><p><em>关键词后面的参数可以时任意一个子查询，这个子查询的作用相当于测试，他不产生任何数据，只返回 TRUE , FALSE。</em></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 查询employee中是否有年龄大于20的员工，如果存在，则查询department表中的所有记录</span><br><span class="line"></span><br><span class="line"># 1. 查询年龄大于20的员工</span><br><span class="line">SELECT * FROM employee WHERE age &gt; 20;</span><br><span class="line"># 2. 嵌套</span><br><span class="line">SELECT * FROM department WHERE EXISTS (SELECT * FROM employee WHERE age &gt; 20);</span><br></pre></td></tr></table></figure><h5 id="5-4-4-带-any-关键字的子查询"><a href="#5-4-4-带-any-关键字的子查询" class="headerlink" title="5.4.4 带 any 关键字的子查询"></a>5.4.4 带 any 关键字的子查询</h5><p><em>any 关键字表示满足其中任意一个条件，它允许创建一个表达式对子查询的返回值列表进行比较，只要满足内层子查询中的任意一个比较条件，就返回一个结果作为查询条件。</em></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 查询 department.did &gt; employee.did 的部门名称</span><br><span class="line"># 1. 查询 employee 所有 did</span><br><span class="line">SELECT did FROM employee;</span><br><span class="line"># 2. 嵌套比较</span><br><span class="line">SELECT * FROM department WHERE did &gt; ANY(SELECT did FROM employee);</span><br></pre></td></tr></table></figure><h5 id="5-4-5-带-all-关键字的子查询"><a href="#5-4-5-带-all-关键字的子查询" class="headerlink" title="5.4.5 带 all 关键字的子查询"></a>5.4.5 带 all 关键字的子查询</h5><p><em>相较于 any 需要满足所有条件</em></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 查询 department.did &gt; 所有 employee.did 的部门名称</span><br><span class="line"># 1. 查询 employee 所有 did</span><br><span class="line">SELECT did FROM employee;</span><br><span class="line"># 2. 嵌套比较</span><br><span class="line">SELECT * FROM department WHERE did &gt; ALL(SELECT did FROM employee);</span><br></pre></td></tr></table></figure><h5 id="5-4-6-带比较运算符的子查询"><a href="#5-4-6-带比较运算符的子查询" class="headerlink" title="5.4.6 带比较运算符的子查询"></a>5.4.6 带比较运算符的子查询</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 查询 王五 是哪个部门</span><br><span class="line"># 1. 查询王五的did</span><br><span class="line">SELECT did FROM employee WHERE name &#x3D; &#39;王五&#39;;</span><br><span class="line"># 2. 嵌套比较</span><br><span class="line">SELECT dname FROM department WHERE did &#x3D; (SELECT did FROM employee WHERE name &#x3D; &#39;王五&#39;);</span><br></pre></td></tr></table></figure><h3 id="6-事务"><a href="#6-事务" class="headerlink" title="6 事务"></a>6 事务</h3><h4 id="6-1-事务控制"><a href="#6-1-事务控制" class="headerlink" title="6.1 事务控制"></a>6.1 事务控制</h4><h5 id="6-1-1-基本概念"><a href="#6-1-1-基本概念" class="headerlink" title="6.1.1 基本概念"></a>6.1.1 基本概念</h5><p>事务：逻辑上的一组操作，要么同时完成要么同时不完成</p><p>mysql 默认就自带事务，但是mysql自带的事务是一条语句独占一个事务</p><p>我们也可以自己来通知事务：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">START TRANSACTION;  #开启事务</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">COMMIT;   # 提交事务</span><br><span class="line">ROLLBACK; # 回滚事务，也就是取消上述 (放在事务内部...后面)</span><br><span class="line"></span><br><span class="line">CREATE TABLE account (</span><br><span class="line">	id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">    name VARCHAR(20),</span><br><span class="line">    money DOUBLE</span><br><span class="line">);</span><br><span class="line">INSERT INTO account VALUES(NULL,&#39;A&#39;,1000),(NULL,&#39;B&#39;,1200);</span><br><span class="line"></span><br><span class="line">## 转账 ##</span><br><span class="line"># 方式一</span><br><span class="line">UPDATE account SET money &#x3D; money - 100 WHERE name &#x3D; &#39;A&#39;;</span><br><span class="line"># 如果不在事务里面，第一条运行，第二条失败会导致转账出现问题</span><br><span class="line">UPDATE account SET money &#x3D; money + 100 WHERE name &#x3D; &#39;B&#39;; </span><br><span class="line"></span><br><span class="line"># 方式二</span><br><span class="line"></span><br><span class="line">START TRANSACTION;  #开启事务</span><br><span class="line">UPDATE account SET money &#x3D; money - 100 WHERE name &#x3D; &#39;A&#39;;</span><br><span class="line">UPDATE account SET money &#x3D; money + 100 WHERE name &#x3D; &#39;B&#39;; </span><br><span class="line">COMMIT;   # 提交事务</span><br></pre></td></tr></table></figure><h5 id="6-1-2-事务的特性-ACID"><a href="#6-1-2-事务的特性-ACID" class="headerlink" title="6.1.2 事务的特性 ACID"></a>6.1.2 事务的特性 ACID</h5><p><strong>原子性：</strong>(Atomicity)</p><ul><li>事务是一组不可分割的单位，要么同时成功，要么同时失败。</li></ul><p><strong>一致性：</strong>(Consistency)</p><ul><li>事务前后的数据完整性应该保持一致。（数据库的完整性：如果事务在某个时间点下，所有的数据都符合所有的约束，则称数据库为符合完整性的状态） 也就是说数据库中的数据并不会因为执行了一半而导致不同。</li></ul><p><strong>隔离性：</strong>(Isolation)</p><ul><li>多个用户并发访问数据库时，一个用户的事务不能被其他用户的事物所干扰，多个并发事务之间数据要相互隔离。</li></ul><p><strong>持久性：</strong>(Durability)</p><ul><li>一个事务一旦被提交，他对数据库中数据的改变就是永久性的，接下来即使数据库发生故障也不应该对其有任何影响。（也就是 commit 后 不能 rollback）</li></ul><h5 id="6-1-3-事务的隔离级别"><a href="#6-1-3-事务的隔离级别" class="headerlink" title="6.1.3 事务的隔离级别"></a>6.1.3 事务的隔离级别</h5><p>隔离性：本质就是多个线程操作同一个资源早成的多线程并发安全问题。加锁可以完美保证隔离性，但是影响性能。</p><p><strong>两个事务并发的修改</strong>：<em>必须隔离</em></p><p><strong>两个事务并发的查询</strong>：<em>完全不用隔离</em></p><p><strong>一个事务修改，一个事务查询</strong>：？</p><p>（脏读：一个事务读取到另一个事务<strong>未提交</strong>的数据）</p><p>（不可重复读：一个事务多次读取<strong>同一条记录</strong>，读取的结果不相同）</p><p>（虚读，幻读：一个事务多次查询<strong>整表的数据</strong>，由于其他事务新增（删除）记录造成多次查询出的记录条数不同）</p><p>四大隔离级别：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">READ UNCOMMITTED;   # 不做任何隔离问题</span><br><span class="line"></span><br><span class="line">READ COMMITTED;		# 可以防止脏读</span><br><span class="line"></span><br><span class="line">REPEATABLE READ;    # 可以防止 脏读 不可重复读   mysql 默认</span><br><span class="line"></span><br><span class="line">SERIALIZABLE;       # 数据库运行在串行化为实现 解决所有问题，单性能低</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SET [SESSION &#x2F; GLOBAL] TRANSACTION ISOLATION LEVEL ...; # 修改隔离级别</span><br><span class="line">SELECT @@TRANSACTION_ISOLATION;  # 查询当前数据库的隔离级别</span><br></pre></td></tr></table></figure><h4 id="6-2-存储过程的创建"><a href="#6-2-存储过程的创建" class="headerlink" title="6.2 存储过程的创建"></a>6.2 存储过程的创建</h4><p>存储过程类似于一个函数。</p><p>创建存储过程</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"># 创建表</span><br><span class="line">CREATE DATABASE chapter06；</span><br><span class="line">USE chapter06;</span><br><span class="line">CREATE TABLE student(</span><br><span class="line">	id INT(3) PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">    name VARCHAR(20) NOT NULL,</span><br><span class="line">    grade FLOAT,</span><br><span class="line">    gender CHAR(2)</span><br><span class="line">);</span><br><span class="line">INSERT INTO student(name, grade, gender) VALUES(&#39;tom&#39;, 60, &#39;男&#39;),(&#39;jack&#39;, 70, &#39;男&#39;),(&#39;rose&#39;, 90, &#39;女&#39;),(&#39;lucy&#39;, 100, &#39;女&#39;);</span><br><span class="line"></span><br><span class="line">#+----+------+-------+--------+</span><br><span class="line">#| id | name | grade | gender |</span><br><span class="line">#+----+------+-------+--------+</span><br><span class="line">#|  1 | tom  |    60 | 男     |</span><br><span class="line">#|  2 | jack |    70 | 男     |</span><br><span class="line">#|  3 | rose |    90 | 女     |</span><br><span class="line">#|  4 | lucy |   100 | 女     |</span><br><span class="line">#+----+------+-------+--------+</span><br><span class="line"></span><br><span class="line"># 创建查看student表的存储过程</span><br><span class="line"></span><br><span class="line"># 将 mysql 结束语句改为 &#x2F;&#x2F;</span><br><span class="line">DELIMITER &#x2F;&#x2F; </span><br><span class="line">CREATE PROCEDURE Proc()</span><br><span class="line">BEGIN</span><br><span class="line">	SELECT * FROM student;</span><br><span class="line">END &#x2F;&#x2F;</span><br><span class="line"># 存储过程结束之后将分号改回来</span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line">CALL Proc; # 使用</span><br><span class="line"></span><br><span class="line">DROP PROCEDURE Proc; # 删除</span><br></pre></td></tr></table></figure><h4 id="6-3-存储过程的使用"><a href="#6-3-存储过程的使用" class="headerlink" title="6.3 存储过程的使用"></a>6.3 存储过程的使用</h4><h5 id="6-3-1-定义一个变量"><a href="#6-3-1-定义一个变量" class="headerlink" title="6.3.1 定义一个变量"></a>6.3.1 定义一个变量</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 注意 变量的声明一定要在存储过程中，且作用域为存储过程</span><br><span class="line">DECLARE var_name[, varname]...date_type[DEFAULT value];</span><br><span class="line"></span><br><span class="line"># 定义一个名称为 myvariable 的变量，类型为 INT 类型，默认值为 100</span><br><span class="line">DECLARE my_name INT DEFAULT 100;  # 没有在存储过程中</span><br><span class="line"></span><br><span class="line">DELIMITER &#x2F;&#x2F;</span><br><span class="line">CREATE PROCEDURE proc2() </span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE myvariable INT DEFAULT 100;</span><br><span class="line">	SELECT myvariable;</span><br><span class="line">END &#x2F;&#x2F;</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure><h5 id="6-3-2-修改一个变量的值"><a href="#6-3-2-修改一个变量的值" class="headerlink" title="6.3.2 修改一个变量的值"></a>6.3.2 修改一个变量的值</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># 方式一：</span><br><span class="line">SET var_name &#x3D; expr[, var_name &#x3D; expr]...;</span><br><span class="line"></span><br><span class="line">DELIMITER &#x2F;&#x2F;</span><br><span class="line">CREATE PROCEDURE proc2() </span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE myvariable INT DEFAULT 100;</span><br><span class="line">	SET myvariable &#x3D; myvariavle + 20;</span><br><span class="line">	SELECT myvariable;</span><br><span class="line">END &#x2F;&#x2F;</span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"># 方式二：</span><br><span class="line">SELECT col_name[...] INTO var_name[...] table_expr;</span><br><span class="line"></span><br><span class="line"># 定义变量，保存学生表中查询到的班级信息和性别信息</span><br><span class="line">DELIMITER &#x2F;&#x2F;</span><br><span class="line">CREATE PROCEDURE proc2() </span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE s_grade FLOAT;</span><br><span class="line">	DECLARE s_gender CHAR(2);</span><br><span class="line">	SELECT grade, gender INTO s_grade, s_gender FROM student WHERE id &#x3D; 3;</span><br><span class="line">	SELECT s_grade, s_gender;</span><br><span class="line">END &#x2F;&#x2F;</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure><h5 id="6-3-3-定义条件和处理程序"><a href="#6-3-3-定义条件和处理程序" class="headerlink" title="6.3.3 定义条件和处理程序"></a>6.3.3 定义条件和处理程序</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 定义一个 ERROR1148(42000)错误，名称为 command_not_allowed</span><br><span class="line"></span><br><span class="line">DECLARE command_not_allowed CONDITION FOR SQLSTATE 42000;</span><br><span class="line"></span><br><span class="line">DECLARE command_not_allowed CONDITION FOR 1148;</span><br><span class="line"></span><br><span class="line"># 定义处理程序</span><br><span class="line">DECLARE handler_type HANDLER FRO condition_value[,...] sp_statement</span><br><span class="line"># handler_type:</span><br><span class="line">CONTINUE, EXIT, UNDO</span><br><span class="line">#condition_value:</span><br><span class="line">	SQLSTATE[VALUE]</span><br><span class="line">	condition_name</span><br><span class="line">	SQLWARNING   #匹配所有01开头的SQLSTATE错误代码</span><br><span class="line">	NOT FOUND    #匹配所有02开头的SQLSTATE错误代码</span><br><span class="line">	SQLEXCEPTION #其他</span><br><span class="line">	mysql_error_code</span><br></pre></td></tr></table></figure><h5 id="6-3-4-光标（游标）的使用"><a href="#6-3-4-光标（游标）的使用" class="headerlink" title="6.3.4 光标（游标）的使用"></a>6.3.4 光标（游标）的使用</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">## 光标的声明 ##</span><br><span class="line">DECLARE cursor_name CURSOR FOR select_statement</span><br><span class="line"># 声明一个名为 cursor_student 的光标</span><br><span class="line">DECLARE cursor_student CURSOR FOR SELECT a_name, a_gender FROM student;</span><br><span class="line"></span><br><span class="line">## 光标的使用 ##</span><br><span class="line"># 先打开光标</span><br><span class="line">	 OPEN cursor_name;</span><br><span class="line">	 FETCH cursor_name INTO var_name[...]... # 这里的变量要在游标之前定义好。</span><br><span class="line"></span><br><span class="line"># 使用名称为 cursor_student 的光标。将查询出来的信息存入 s_name, s_grade中</span><br><span class="line">FETCH cursor_student INTO s_name, s_grade;</span><br><span class="line"></span><br><span class="line">## 光标的关闭 ##</span><br><span class="line">CLOSE cursor_name;</span><br><span class="line"># 关闭名称为 cursor_student 的光标。</span><br><span class="line">CLOSE cursor_student;</span><br></pre></td></tr></table></figure><h5 id="6-3-5-流程控制的使用"><a href="#6-3-5-流程控制的使用" class="headerlink" title="6.3.5 流程控制的使用"></a>6.3.5 流程控制的使用</h5><h6 id="6-3-5-1-if-语句"><a href="#6-3-5-1-if-语句" class="headerlink" title="6.3.5.1 if 语句"></a>6.3.5.1 if 语句</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># 1. if 语句</span><br><span class="line">IF expr_condition THEN statemen_list</span><br><span class="line">	[ELSEIF expr_condition THEN statement_list]..</span><br><span class="line">	[ELSE statement_list]</span><br><span class="line">END IF</span><br><span class="line"></span><br><span class="line"># 创建一个存储过程判断变量 v 是否是一个 null,输出对应的提示信息</span><br><span class="line"></span><br><span class="line">DELIMITER &#x2F;&#x2F;</span><br><span class="line">CREATE PROCEDURE proc4()</span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE v VARCHAR(2);</span><br><span class="line">	SET v &#x3D; &#39;a&#39;;</span><br><span class="line">	IF V IS NULL THEN SELECT &#39;IS NULL&#39;;</span><br><span class="line">	ELSE SELECT &#39;NOT NULL&#39;;</span><br><span class="line">	END IF;</span><br><span class="line">END &#x2F;&#x2F;</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure><h6 id="6-3-5-2-case-语句"><a href="#6-3-5-2-case-语句" class="headerlink" title="6.3.5.2 case 语句"></a>6.3.5.2 case 语句</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 2. case 语句</span><br><span class="line">CASE case_expr</span><br><span class="line">	WHEN when_value THEN statement_list</span><br><span class="line">	[WHEN when_value THEN statemen_list]...</span><br><span class="line">	[ELSE statement_list]</span><br><span class="line">END CASE;</span><br><span class="line"></span><br><span class="line"># 创建存储过程</span><br><span class="line">DELIMITER &#x2F;&#x2F;</span><br><span class="line">CREATE PROCEDURE proc5()</span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE v INT;</span><br><span class="line">	SET v &#x3D; 1;</span><br><span class="line">	CASE v</span><br><span class="line">		WHEN 1 THEN SELECT &#39;VALUE IS 1&#39;;</span><br><span class="line">		WHEN 2 THEN SELECT &#39;VALUE IS 1&#39;;</span><br><span class="line">		ELSE SELECT &#39;IS NOT 1 OR 2&#39;;</span><br><span class="line">	END CASE;</span><br><span class="line">END &#x2F;&#x2F;</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure><h6 id="6-3-5-3-loop-语句"><a href="#6-3-5-3-loop-语句" class="headerlink" title="6.3.5.3 loop 语句"></a>6.3.5.3 loop 语句</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"># 3. loop 语句</span><br><span class="line">[loop_lable:] LOOP STATEMENT_LIST END [loop_lable]</span><br><span class="line"></span><br><span class="line">DELIMITER &#x2F;&#x2F;</span><br><span class="line">CREATE PROCEDURE proc6()</span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE id INT DEFAULT 0;</span><br><span class="line">	add_loop : LOOP</span><br><span class="line">		SET id &#x3D; id + 1;</span><br><span class="line">		IF id &gt;&#x3D; 10 THEN LEAVE add_loop; &#x2F;&#x2F; 跳出循环</span><br><span class="line">		END IF;</span><br><span class="line">		SELECT id;</span><br><span class="line">	END LOOP add_loop;</span><br><span class="line">END &#x2F;&#x2F;</span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line">LEAVE # 跳出循环  break</span><br><span class="line">ITERATE # 再次循环 contionue</span><br><span class="line"></span><br><span class="line"># 案例</span><br><span class="line">DELIMITER &#x2F;&#x2F;</span><br><span class="line">CREATE PROCEDURE doiterate()</span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE p1 INT DEFAULT 0;</span><br><span class="line">	my_loop : LOOP</span><br><span class="line">		SET p1 &#x3D; p1 + 1;</span><br><span class="line">		IF p1 &lt; 10 THEN ITERATE my_loop;</span><br><span class="line">		ELSE IF p1 &gt; 20 THEN LEAVE my_loop;</span><br><span class="line">		END IF;</span><br><span class="line">		SELECT &#39;p1 is between 10 and 20&#39;;</span><br><span class="line">	END LOOP my_loop;</span><br><span class="line">END &#x2F;&#x2F;</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure><h6 id="6-3-5-4-repeat-语句-while-语句"><a href="#6-3-5-4-repeat-语句-while-语句" class="headerlink" title="6.3.5.4 repeat 语句 while 语句"></a>6.3.5.4 repeat 语句 while 语句</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># 案例 repeat</span><br><span class="line">DELIMITER &#x2F;&#x2F;</span><br><span class="line">CREATE PROCEDURE proc7()</span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE p1 INT DEFAULT 0;</span><br><span class="line">	REPEAT</span><br><span class="line">		SET p1 &#x3D; p1 + 1;</span><br><span class="line">		UNTIL p1 &gt;&#x3D; 10;</span><br><span class="line">	END REPEAT;</span><br><span class="line">END &#x2F;&#x2F;</span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 案例 while</span><br><span class="line">DELIMITER &#x2F;&#x2F;</span><br><span class="line">CREATE PROCEDURE proc8()</span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE p1 INT DEFAULT 0;</span><br><span class="line">	WHILE P1 &lt; 10 DO</span><br><span class="line">		SET p1 &#x3D; p1 + 1;</span><br><span class="line">		SELECT p1;</span><br><span class="line">	END WHILE;</span><br><span class="line">END &#x2F;&#x2F;</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure><h4 id="6-4-操作存储过程"><a href="#6-4-操作存储过程" class="headerlink" title="6.4 操作存储过程"></a>6.4 操作存储过程</h4><h5 id="6-4-1-执行存储过程"><a href="#6-4-1-执行存储过程" class="headerlink" title="6.4.1 执行存储过程"></a>6.4.1 执行存储过程</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">CALL SP_NAME(parameter...);</span><br><span class="line"></span><br><span class="line"># 案例</span><br><span class="line">DELIMITER &#x2F;&#x2F;</span><br><span class="line">CREATE PROCEDURE proc01(IN s_gender VARCHAR(50), OUT num INT)</span><br><span class="line">BEGIN</span><br><span class="line">	SELECT COUNT(*) INTO num FROM student WHERE gender &#x3D; s_gender;</span><br><span class="line">END &#x2F;&#x2F;</span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"># 执行存储过程</span><br><span class="line">CALL proc01(&quot;f&quot;,@num);</span><br><span class="line"># 查看 num</span><br><span class="line">SELECT @num</span><br></pre></td></tr></table></figure><h5 id="6-4-2-查看存储过程"><a href="#6-4-2-查看存储过程" class="headerlink" title="6.4.2 查看存储过程"></a>6.4.2 查看存储过程</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SHOW PROCEDURE STATUS;</span><br><span class="line">SHOW PROCEDURE STATUS LIKE &#39;%2&#39;;</span><br><span class="line">SHOW CREATE PROCEDURE PROC4;</span><br><span class="line"># 查询 information_schema.routines 表中查看存储过程的信息</span><br><span class="line">SELECT * FROM information_schema.Routines；</span><br></pre></td></tr></table></figure><h4 id="6-5-修改存储过程"><a href="#6-5-修改存储过程" class="headerlink" title="6.5 修改存储过程"></a>6.5 修改存储过程</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 可以修改存储过程的特性，但是不能修改存储过程的内容</span><br><span class="line"># 如果要修改内容，先删除在重新创建</span><br></pre></td></tr></table></figure><h4 id="6-6-删除存储过程"><a href="#6-6-删除存储过程" class="headerlink" title="6.6 删除存储过程"></a>6.6 删除存储过程</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP PROCEDURE sp_name;</span><br></pre></td></tr></table></figure><h3 id="7-视图"><a href="#7-视图" class="headerlink" title="7 视图"></a>7 视图</h3><h4 id="7-1-创建视图"><a href="#7-1-创建视图" class="headerlink" title="7.1 创建视图"></a>7.1 创建视图</h4><h5 id="7-1-1-在单表上创建视图"><a href="#7-1-1-在单表上创建视图" class="headerlink" title="7.1.1 在单表上创建视图"></a>7.1.1 在单表上创建视图</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># 创建单表 in chapter07 数据库</span><br><span class="line"></span><br><span class="line">CREATE TABLE student(</span><br><span class="line">	s_id INT(3),</span><br><span class="line">    name VARCHAR(20),</span><br><span class="line">    math FLOAT,</span><br><span class="line">    chinese FLOAT</span><br><span class="line">);</span><br><span class="line">INSERT INTO student VALUES(1, &#39;TOM&#39;, 80, 78),(2, &#39;JACK&#39;, 70, 80),(3, &#39;LUCY&#39;, 97, 95);</span><br><span class="line">#+------+------+------+---------+</span><br><span class="line">#| s_id | name | math | chinese |</span><br><span class="line">#+------+------+------+---------+</span><br><span class="line">#|    1 | TOM  |   80 |      78 |</span><br><span class="line">#|    2 | JACK |   70 |      80 |</span><br><span class="line">#|    3 | LUCY |   97 |      95 |</span><br><span class="line">#+------+------+------+---------+</span><br><span class="line"></span><br><span class="line"># 创建 student 表的视图，保存数学成绩，语文成绩，总成绩</span><br><span class="line">CREATE VIEW view_stu AS SELECT math, chinese FROM student;</span><br><span class="line"># 可替代</span><br><span class="line">CREATE (OR REPLEASE) VIEW view_stu AS SELECT math, chinese, math + chinese FROM student;</span><br><span class="line">SELECT * FORM view_stu;</span><br><span class="line"></span><br><span class="line"># 添加别名 (可选列名)</span><br><span class="line">CREATE VIEW view_stu2 (数学,语文,总分) AS SELECT math, chinese, math + chinese FROM student;</span><br><span class="line">SELECT * FroM view_stu2;</span><br></pre></td></tr></table></figure><p><strong>7.1.2 在多表上创建视图</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># 在创建一张表格</span><br><span class="line">CREATE TABLE stu_info(</span><br><span class="line">	s_id INT(3),</span><br><span class="line">    class VARCHAR(50),</span><br><span class="line">	addr VARCHAR(50)</span><br><span class="line">);</span><br><span class="line">INSERT INTO stu_info VALUES(1, &#39;#2&#39;, &#39;202&#39;),(2, &#39;#3&#39;, &#39;203&#39;),(3, &#39;#1&#39;, &#39;201&#39;);</span><br><span class="line"></span><br><span class="line">#+------+-------+------+</span><br><span class="line">#| s_id | class | addr |</span><br><span class="line">#+------+-------+------+</span><br><span class="line">#|    1 | #2    | 202  |</span><br><span class="line">#|    2 | #3    | 203  |</span><br><span class="line">#|    3 | #1    | 201  |</span><br><span class="line">#+------+-------+------+</span><br><span class="line"></span><br><span class="line"># 创建视图包含 学生的编号 学生的姓名 班级名称</span><br><span class="line"></span><br><span class="line">CREATE VIEW stu_class (编号, 学生, 班级) </span><br><span class="line">AS </span><br><span class="line">SELECT student.s_id,student.name,stu_info.class FROM student,stu_info WHERE student.s_id &#x3D; stu_info.s_id;</span><br></pre></td></tr></table></figure><h4 id="7-2-查看视图"><a href="#7-2-查看视图" class="headerlink" title="7.2 查看视图"></a>7.2 查看视图</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 使用 describe   --- 查看视图结构</span><br><span class="line">DESCRIBE stu_class;</span><br><span class="line">DESC stu_class;</span><br><span class="line"></span><br><span class="line"># 使用 SHOW TABLE STATUS LIKE &#39;视图名&#39;  --- 查看视图信息</span><br><span class="line">SHOW TABLE STATUS LIKE &#39;stu_class&#39;;</span><br><span class="line"></span><br><span class="line"># 查看视图的创建语句    --- 查看视图的创建语句</span><br><span class="line">SHOW CREATE VIEW stu_class;</span><br></pre></td></tr></table></figure><h4 id="7-3-修改视图"><a href="#7-3-修改视图" class="headerlink" title="7.3 修改视图"></a>7.3 修改视图</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 1. OR REPLACE 覆盖</span><br><span class="line"># 修改 view_stu</span><br><span class="line">CREATE OR REPLACE VIEW view_stu AS SELECT * FROM student;</span><br><span class="line"></span><br><span class="line"># 2. 使用alter语句</span><br><span class="line">ALTER VIEW view_stu AS SELECT Chinese FROM student;</span><br></pre></td></tr></table></figure><h4 id="7-4-更新视图"><a href="#7-4-更新视图" class="headerlink" title="7.4 更新视图"></a>7.4 更新视图</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 更新视图会导致基本表中的数据也会修改</span><br><span class="line"># 使用 update</span><br><span class="line">UPDATE view_stu SET chinese &#x3D; 100;</span><br><span class="line"></span><br><span class="line"># 变化基本表中的数据同样也会改变视图中的数据</span><br><span class="line"># 使用 insert 语句</span><br><span class="line">INSERT INTO student VALUES(4, &#39;LILY&#39;, 98, 99);</span><br><span class="line"></span><br><span class="line"># 使用 delete</span><br><span class="line">DELETE FROM view_stu WHERE chinese &#x3D;  99;</span><br></pre></td></tr></table></figure><h4 id="7-5-删除视图"><a href="#7-5-删除视图" class="headerlink" title="7.5 删除视图"></a>7.5 删除视图</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP VIEW view_name;</span><br></pre></td></tr></table></figure><h3 id="8-数据库的高级操作"><a href="#8-数据库的高级操作" class="headerlink" title="8 数据库的高级操作"></a>8 数据库的高级操作</h3><h4 id="8-1-数据备份与还原"><a href="#8-1-数据备份与还原" class="headerlink" title="8.1 数据备份与还原"></a>8.1 数据备份与还原</h4><h5 id="8-1-1-数据的备份"><a href="#8-1-1-数据的备份" class="headerlink" title="8.1.1 数据的备份"></a>8.1.1 数据的备份</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 命令行内</span><br><span class="line">mysqldump -u root -p mydb1 &gt; d:\1.sql</span><br></pre></td></tr></table></figure><h5 id="8-1-2-数据的还原"><a href="#8-1-2-数据的还原" class="headerlink" title="8.1.2 数据的还原"></a>8.1.2 数据的还原</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 方法一   --- 命令行内</span><br><span class="line">mysql -u root -p mydb1 &lt; d:\1.sql  # 前提是先创建空数据库 mydb1</span><br><span class="line"></span><br><span class="line"># 方法二   --- mysql内</span><br><span class="line">CREATE DATABASE mydb1;</span><br><span class="line">USE mydb1;</span><br><span class="line">SOURCE D:\1.sql  # 载入数据</span><br></pre></td></tr></table></figure><h4 id="8-2-用户管理"><a href="#8-2-用户管理" class="headerlink" title="8.2 用户管理"></a>8.2 用户管理</h4><h5 id="8-2-1-user-表"><a href="#8-2-1-user-表" class="headerlink" title="8.2.1 user 表"></a>8.2.1 user 表</h5><h5 id="8-2-1-创建普通用户"><a href="#8-2-1-创建普通用户" class="headerlink" title="8.2.1 创建普通用户"></a>8.2.1 创建普通用户</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># grant 语句</span><br><span class="line"># 对于 localhost 主机，创建用户 USER01，选择 mydb1内的所有所有数据，密码为123456</span><br><span class="line">GRANT SELECT ON mydb1.* TO &#39;USER01&#39;@localhost IDENTIFIED BY &#39;abc123&#39;;</span><br><span class="line"></span><br><span class="line"># create 语句</span><br><span class="line">CREATE USER &#39;USER02&#39;@localhost IDENTIFIED BY &#39;abc123&#39;;</span><br><span class="line"></span><br><span class="line"># insert 语句</span><br><span class="line">INSERT INTO mysql.user(Host, User, Password, ssl_cipher, x509issuer, x509_subject)</span><br><span class="line">VALUES(local, &#39;USER03&#39;, PASSWORD(&#39;abc123&#39;),&#39;&#39;,&#39;&#39;,&#39;&#39;);</span><br><span class="line">FLUSH PRIVILEGES;  # 刷新权限</span><br></pre></td></tr></table></figure><h5 id="8-2-1-删除普通用户"><a href="#8-2-1-删除普通用户" class="headerlink" title="8.2.1 删除普通用户"></a>8.2.1 删除普通用户</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># drop 语句</span><br><span class="line">DROP USER &#39;USER02&#39;@localhost;</span><br><span class="line"></span><br><span class="line"># delete 语句</span><br><span class="line">DELETE FROM mysql.user WHERE Host &#x3D; &#39;localhost&#39; AND User &#x3D; &#39;USER02&#39;;</span><br><span class="line">FLUSH PRIVILEGES;  # 刷新权限</span><br></pre></td></tr></table></figure><h5 id="8-2-1-修改用户密码"><a href="#8-2-1-修改用户密码" class="headerlink" title="8.2.1 修改用户密码"></a>8.2.1 修改用户密码</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 1. 修改root用户密码</span><br><span class="line"># 命令行</span><br><span class="line">mysqladmin -u root -p password rootroot;</span><br><span class="line"></span><br><span class="line"># update 语句</span><br><span class="line">UPDATE mysql.user SET PASSWORD &#x3D; PASSWORD(&#39;rootroot&#39;)</span><br><span class="line">WHERE User &#x3D; &#39;username&#39; AND Host &#x3D; &#39;hostname&#39;;</span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line"></span><br><span class="line"># SET 语句 必须 root 用户本身</span><br><span class="line">SET PASSWORD &#x3D; PASSWORD(&#39;rootroot&#39;);</span><br><span class="line"></span><br><span class="line"># 2. root 用户修改普通用户密码</span><br><span class="line"># grant 语句</span><br><span class="line"># update 语句</span><br><span class="line"># set 语句</span><br><span class="line"></span><br><span class="line">#3. 普通用户修改自己密码</span><br><span class="line"># set 语句</span><br><span class="line">SET PASSWORD &#x3D; PASSWORD(&#39;password&#39;);</span><br></pre></td></tr></table></figure><h4 id="8-3-权限管理"><a href="#8-3-权限管理" class="headerlink" title="8.3 权限管理"></a>8.3 权限管理</h4><h5 id="8-3-1-Mysql-的权限"><a href="#8-3-1-Mysql-的权限" class="headerlink" title="8.3.1 Mysql 的权限"></a>8.3.1 Mysql 的权限</h5><h5 id="8-3-2-授予权限"><a href="#8-3-2-授予权限" class="headerlink" title="8.3.2 授予权限"></a>8.3.2 授予权限</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 赋予 insert select 权限 给 user04 ，密码为 123</span><br><span class="line">GRANT INSERT,SELECT ON *.* TO &#39;USER04&#39;@localhost IDENTIFIED BY &#39;123&#39; WITH GRANT OPTION;</span><br></pre></td></tr></table></figure><h5 id="8-3-3-查看权限"><a href="#8-3-3-查看权限" class="headerlink" title="8.3.3 查看权限"></a>8.3.3 查看权限</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW GRANTS FOR &#39;root&#39;@localhost;</span><br></pre></td></tr></table></figure><h5 id="8-3-4-收回权限"><a href="#8-3-4-收回权限" class="headerlink" title="8.3.4 收回权限"></a>8.3.4 收回权限</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">REVOKE insert on *.* FROM &#39;USER04&#39;@localhost; # 回收 user04 的 insert 权限</span><br><span class="line">REVOKE ALL PRIVILEGES, GRANT OPTION FROM &#39;USER04&#39;@localhost; # 回收 user04 的所有权限</span><br></pre></td></tr></table></figure></div><div><div><br><br><div style="text-align:center;color:#ccc;font-size:14px">----------- 本文结束 -----------</div><br><br><br><br></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Database/" rel="tag"><i class="fa fa-tag">Database</i></a></div><div class="post-widgets"><div id="needsharebutton-postbottom"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/Complie_and_Debug/cpp_vscode/" rel="next" title="C++ vscode 编译环境"><i class="fa fa-chevron-left"></i> C++ vscode 编译环境</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/Network_Communications/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/" rel="prev" title="Linux 进程间通信">Linux 进程间通信 <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"></div></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/"><img class="site-author-image" itemprop="image" src="/images/logo.jpg" alt="从之丶"></a><p class="site-author-name" itemprop="name">从之丶</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/%7C%7C%20archive"><span class="site-state-item-count">26</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">6</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">27</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/czGitAccount" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:caoz326@163.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-block"><div class="links-of-blogroll-title"><i class="fa fa-history fa-" aria-hidden="true"></i> 近期文章</div><ul class="links-of-blogroll-list"><li class="recent_posts_li"><a href="/Data_Structure_and_Algorithm/%E5%89%91%E6%8C%87offer/%E6%9F%A5%E6%89%BE%E7%AE%97%E6%B3%95/" title="剑指offer -- 查找算法" target="_blank">剑指offer -- 查找算法</a></li><li class="recent_posts_li"><a href="/Data_Structure_and_Algorithm/%E5%89%91%E6%8C%87offer/%E5%8F%8C%E6%8C%87%E9%92%88/" title="剑指offer -- 双指针" target="_blank">剑指offer -- 双指针</a></li><li class="recent_posts_li"><a href="/Data_Structure_and_Algorithm/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/" title="排序算法" target="_blank">排序算法</a></li><li class="recent_posts_li"><a href="/Data_Structure_and_Algorithm/%E5%89%91%E6%8C%87offer/%E6%95%B0%E5%AD%A6/" title="剑指offer -- 数学" target="_blank">剑指offer -- 数学</a></li><li class="recent_posts_li"><a href="/Data_Structure_and_Algorithm/%E5%89%91%E6%8C%87offer/%E6%8E%92%E5%BA%8F/" title="剑指offer -- 排序" target="_blank">剑指offer -- 排序</a></li></ul></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-操作数据库"><span class="nav-text">1 操作数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-创建数据库"><span class="nav-text">1.1 创建数据库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-查看数据库"><span class="nav-text">1.2 查看数据库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-修改数据库"><span class="nav-text">1.3 修改数据库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-删除数据库"><span class="nav-text">1.4 删除数据库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-5-选择数据库"><span class="nav-text">1.5 选择数据库</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-表"><span class="nav-text">2 表</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-增加表"><span class="nav-text">2.1 增加表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-查找表"><span class="nav-text">2.2 查找表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-修改表"><span class="nav-text">2.3 修改表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4-删除表"><span class="nav-text">2.4 删除表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-5-各种约束"><span class="nav-text">2.5 各种约束</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-6-索引"><span class="nav-text">2.6 索引</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#2-6-1-创建索引"><span class="nav-text">2.6.1 创建索引</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-6-2-删除索引"><span class="nav-text">2.6.2 删除索引</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-操作表记录"><span class="nav-text">3 操作表记录</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-insert"><span class="nav-text">4.1 insert</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-update"><span class="nav-text">4.2 update</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-delete，truncate"><span class="nav-text">4.3 delete，truncate</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-单表查询"><span class="nav-text">4 单表查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-简单查询"><span class="nav-text">4.1 简单查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-带有过滤的查询"><span class="nav-text">4.2 带有过滤的查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-聚合函数"><span class="nav-text">4.3 聚合函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4-排序查询"><span class="nav-text">4.4 排序查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-5-分组查询"><span class="nav-text">4.5 分组查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-6-limit"><span class="nav-text">4.6 limit</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-7-别名"><span class="nav-text">4.7 别名</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-多表查询"><span class="nav-text">5 多表查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-添加外键约束"><span class="nav-text">5.1 添加外键约束</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-1-声明表的时候添加外键"><span class="nav-text">5.1.1 声明表的时候添加外键</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-5-2-表已经存在"><span class="nav-text">5.5.2 表已经存在</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-5-3-删除外键"><span class="nav-text">5.5.3 删除外键</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-操作关联表"><span class="nav-text">5.2 操作关联表</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-1-添加数据"><span class="nav-text">5.2.1 添加数据</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-2-删除数据"><span class="nav-text">5.2.2 删除数据</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-3-连接查询"><span class="nav-text">5.3 连接查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-4-子查询"><span class="nav-text">5.4 子查询</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#5-4-1-带-in-关键字的子查询"><span class="nav-text">5.4.1 带 in 关键字的子查询</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-4-2-带-not-in-关键字的子查询"><span class="nav-text">5.4.2 带 not in 关键字的子查询</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-4-3-带-exists-关键字的子查询"><span class="nav-text">5.4.3 带 exists 关键字的子查询</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-4-4-带-any-关键字的子查询"><span class="nav-text">5.4.4 带 any 关键字的子查询</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-4-5-带-all-关键字的子查询"><span class="nav-text">5.4.5 带 all 关键字的子查询</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-4-6-带比较运算符的子查询"><span class="nav-text">5.4.6 带比较运算符的子查询</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-事务"><span class="nav-text">6 事务</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#6-1-事务控制"><span class="nav-text">6.1 事务控制</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#6-1-1-基本概念"><span class="nav-text">6.1.1 基本概念</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-1-2-事务的特性-ACID"><span class="nav-text">6.1.2 事务的特性 ACID</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-1-3-事务的隔离级别"><span class="nav-text">6.1.3 事务的隔离级别</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-存储过程的创建"><span class="nav-text">6.2 存储过程的创建</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-3-存储过程的使用"><span class="nav-text">6.3 存储过程的使用</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#6-3-1-定义一个变量"><span class="nav-text">6.3.1 定义一个变量</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-3-2-修改一个变量的值"><span class="nav-text">6.3.2 修改一个变量的值</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-3-3-定义条件和处理程序"><span class="nav-text">6.3.3 定义条件和处理程序</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-3-4-光标（游标）的使用"><span class="nav-text">6.3.4 光标（游标）的使用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-3-5-流程控制的使用"><span class="nav-text">6.3.5 流程控制的使用</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#6-3-5-1-if-语句"><span class="nav-text">6.3.5.1 if 语句</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#6-3-5-2-case-语句"><span class="nav-text">6.3.5.2 case 语句</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#6-3-5-3-loop-语句"><span class="nav-text">6.3.5.3 loop 语句</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#6-3-5-4-repeat-语句-while-语句"><span class="nav-text">6.3.5.4 repeat 语句 while 语句</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-4-操作存储过程"><span class="nav-text">6.4 操作存储过程</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#6-4-1-执行存储过程"><span class="nav-text">6.4.1 执行存储过程</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-4-2-查看存储过程"><span class="nav-text">6.4.2 查看存储过程</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-5-修改存储过程"><span class="nav-text">6.5 修改存储过程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-6-删除存储过程"><span class="nav-text">6.6 删除存储过程</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-视图"><span class="nav-text">7 视图</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#7-1-创建视图"><span class="nav-text">7.1 创建视图</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#7-1-1-在单表上创建视图"><span class="nav-text">7.1.1 在单表上创建视图</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-2-查看视图"><span class="nav-text">7.2 查看视图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-3-修改视图"><span class="nav-text">7.3 修改视图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-4-更新视图"><span class="nav-text">7.4 更新视图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-5-删除视图"><span class="nav-text">7.5 删除视图</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-数据库的高级操作"><span class="nav-text">8 数据库的高级操作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#8-1-数据备份与还原"><span class="nav-text">8.1 数据备份与还原</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#8-1-1-数据的备份"><span class="nav-text">8.1.1 数据的备份</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#8-1-2-数据的还原"><span class="nav-text">8.1.2 数据的还原</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-2-用户管理"><span class="nav-text">8.2 用户管理</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#8-2-1-user-表"><span class="nav-text">8.2.1 user 表</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#8-2-1-创建普通用户"><span class="nav-text">8.2.1 创建普通用户</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#8-2-1-删除普通用户"><span class="nav-text">8.2.1 删除普通用户</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#8-2-1-修改用户密码"><span class="nav-text">8.2.1 修改用户密码</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-3-权限管理"><span class="nav-text">8.3 权限管理</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#8-3-1-Mysql-的权限"><span class="nav-text">8.3.1 Mysql 的权限</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#8-3-2-授予权限"><span class="nav-text">8.3.2 授予权限</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#8-3-3-查看权限"><span class="nav-text">8.3.3 查看权限</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#8-3-4-收回权限"><span class="nav-text">8.3.4 收回权限</span></a></li></ol></li></ol></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">从之丶</span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script><i id="darkmode" class="fa fa-lightbulb-o" aria-hidden="true"></i><script>var body=$("body"),darkmode=$("#darkmode");(matchMedia("(prefers-color-scheme: dark)").matches||"1"===localStorage.getItem("darkmode"))&&"1"!==localStorage.getItem("noDark")&&body.addClass("dark"),body.hasClass("dark")?darkmode.removeClass("fa-moon-o").addClass("fa-lightbulb-o"):darkmode.removeClass("fa-lightbulb-o").addClass("fa-moon-o"),darkmode.click(function(){body.hasClass("dark")?(darkmode.removeClass("fa-lightbulb-o").addClass("fa-moon-o"),body.removeClass("dark"),localStorage.setItem("darkmode","0"),localStorage.setItem("noDark","1")):(darkmode.removeClass("fa-moon-o").addClass("fa-lightbulb-o"),body.addClass("dark"),localStorage.setItem("darkmode","1"),localStorage.setItem("noDark","0"))})</script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/clipboard.min.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/highlight-wrap.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")},searchFunc=function(t,e,o){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var n=isXml?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,r=document.getElementById(e),s=document.getElementById(o),a=function(){var t=r.value.trim().toLowerCase(),e=t.split(/[\s\-]+/);e.length>1&&e.push(t);var o=[];if(t.length>0&&n.forEach(function(n){function r(e,o,n,r){for(var s=r[r.length-1],a=s.position,i=s.word,l=[],h=0;a+i.length<=n&&0!=r.length;){i===t&&h++,l.push({position:a,length:i.length});var p=a+i.length;for(r.pop();0!=r.length&&(s=r[r.length-1],a=s.position,i=s.word,p>a);)r.pop()}return c+=h,{hits:l,start:o,end:n,searchTextCount:h}}function s(t,e){var o="",n=e.start;return e.hits.forEach(function(e){o+=t.substring(n,e.position);var r=e.position+e.length;o+='<b class="search-keyword">'+t.substring(e.position,r)+"</b>",n=r}),o+=t.substring(n,e.end)}var a=!1,i=0,c=0,l=n.title.trim(),h=l.toLowerCase(),p=n.content.trim().replace(/<[^>]+>/g,""),u=p.toLowerCase(),f=decodeURIComponent(n.url),d=[],g=[];if(""!=l&&(e.forEach(function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());(s=e.indexOf(t,r))>-1;)a.push({position:s,word:t}),r=s+n;return a}d=d.concat(e(t,h,!1)),g=g.concat(e(t,u,!1))}),(d.length>0||g.length>0)&&(a=!0,i=d.length+g.length)),a){[d,g].forEach(function(t){t.sort(function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length})});var v=[];0!=d.length&&v.push(r(l,0,l.length,d));for(var $=[];0!=g.length;){var C=g[g.length-1],m=C.position,x=C.word,w=m-20,y=m+80;0>w&&(w=0),y<m+x.length&&(y=m+x.length),y>p.length&&(y=p.length),$.push(r(p,w,y,g))}$.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start});var T=parseInt("1");T>=0&&($=$.slice(0,T));var b="";b+=0!=v.length?"<li><a href='"+f+"' class='search-result-title'>"+s(l,v[0])+"</a>":"<li><a href='"+f+"' class='search-result-title'>"+l+"</a>",$.forEach(function(t){b+="<a href='"+f+'\'><p class="search-result">'+s(p,t)+"...</p></a>"}),b+="</li>",o.push({item:b,searchTextCount:c,hitCount:i,id:o.length})}}),1===e.length&&""===e[0])s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>';else if(0===o.length)s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>';else{o.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id});var a='<ul class="search-result-list">';o.forEach(function(t){a+=t.item}),a+="</ul>",s.innerHTML=a}};r.addEventListener("input",a),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(t){t.stopPropagation(),isfetched===!1?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(t){t.stopPropagation()}),$(document).on("keyup",function(t){var e=27===t.which&&$(".search-popup").is(":visible");e&&onPopupClose()})</script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={},pbOptions.iconStyle="box",pbOptions.boxForm="horizontal",pbOptions.position="bottomCenter",pbOptions.networks="Weibo,Wechat,Douban,QQZone,Twitter,Facebook",new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={},flOptions.iconStyle="box",flOptions.boxForm="horizontal",flOptions.position="middleRight",flOptions.networks="Weibo,Wechat,Douban,QQZone,Twitter,Facebook",new needShareButton("#needsharebutton-float",flOptions)</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/wanko.model.json"},display:{position:"left",width:200,height:270},mobile:{show:!1},log:!1})</script></body></html><!-- rebuild by neat -->