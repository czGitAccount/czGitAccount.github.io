<!-- build time:Sat May 08 2021 16:56:11 GMT+0800 (GMT+08:00) --><!DOCTYPE html><html class="theme-next muse use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link href="/lib/pace/pace-theme-bounce.min.css?v=1.0.2" rel="stylesheet"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.jpg?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="PRACH,随机接入,"><meta property="og:type" content="article"><meta property="og:title" content="5G-NR-PRACH学习"><meta property="og:url" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/index.html"><meta property="og:site_name" content="CongZ&#39;s Blog"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p1-preamble%E7%94%9F%E6%88%90.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T4-38.211-6.3.3.1-3(4"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/Inked38.211-6.3.3.1-5_LI.jpg"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T1-38.211-6.3.3.1-1.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T2-38.211-6.3.3.1-2.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p2-Format%200.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p3-format%201.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/format2.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p5-format%203.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p6-format%20A1.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p7-format%20A2.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p8-format%20A3.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p9-format%20B1.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p10-format%20B2.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p11-format%20B3.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p12-format%20B4.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p-13format%20C0.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p14-format%20C2.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p15-%E6%97%B6%E5%9F%9F%E4%B8%BE%E4%BE%8B1-1%20(1"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p16-%E6%97%B6%E5%9F%9F%E4%B8%BE%E4%BE%8B1-2.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p17-%E6%97%B6%E5%9F%9F%E4%B8%BE%E4%BE%8B1-3.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p18-%E6%97%B6%E5%9F%9F%E4%B8%BE%E4%BE%8B1-4.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T3-38.211-6.3.3.2-1.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p19-%E9%A2%91%E5%9F%9F%E6%98%A0%E5%B0%84.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p20-SSB-PRACH%E4%BE%8B%E5%AD%901.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p21-SSB-PRACH%E4%BE%8B%E5%AD%902.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p22-SSB-PRACH%E4%BE%8B%E5%AD%903.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p23-SSB-PRACH%E4%BE%8B%E5%AD%904.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p24-SSB%E5%91%A8%E6%9C%9F.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p26-contention-Based.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p27-contention-free.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T13-213%207.3-1.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T14-213%207.3.1-2.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p28-Figure6.1.5-3.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p31-MAC-PDU.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p30-7.2-1.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p29-Figure%206.2.3-1.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T-15-8.2-1.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T15-213-8.2-2.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p32-K2.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T20-214-6.4-1.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T21-214-6.4-2.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p33-%E6%97%B6%E5%BA%8F%E5%9B%BE.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p34-RACH%E5%9C%BA%E6%99%AF.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p35-%E5%9C%BA%E6%99%AF1.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p36-%E5%9C%BA%E6%99%AF2.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p37-%E5%9C%BA%E6%99%AF3.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T1-38.211-6.3.3.1-1.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T2-38.211-6.3.3.1-2.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T3-38.211-6.3.3.2-1.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T5-38.211-6.3.3.1-3(4"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T6-38.211-6.3.3.1-5.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T7-38.211-6.3.3.1-6.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T8-38.211-6.3.3.1-7.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T9-38.211-6.3.3.2-2.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T10-38.211-6.3.3.2-3.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T11-38.211-6.3.3.2-4.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/C1-RACH-Configuration.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/C2-RACH-Configuration2.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/C3-RACH-ConfigDedicated1.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/C4-RACH-ConfigDedicated2.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/C5-RACH-ConfigGeneric.png"><meta property="article:published_time" content="2020-03-24T07:36:32.000Z"><meta property="article:modified_time" content="2021-05-05T14:52:27.000Z"><meta property="article:author" content="从之丶"><meta property="article:tag" content="PRACH"><meta property="article:tag" content="随机接入"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p1-preamble%E7%94%9F%E6%88%90.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Muse",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:"ture",onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="https://czGitAccount.github.io/5G协议/5G-NR-PRACH学习/"><title>5G-NR-PRACH学习 | CongZ's Blog</title><meta name="generator" content="Hexo 4.2.0"></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">CongZ's Blog</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">择其善者而从之，其不善者而改之 !</p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://czGitAccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="从之丶"><meta itemprop="description" content=""><meta itemprop="image" content="/images/logo.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="CongZ's Blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">5G-NR-PRACH学习</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-03-24T15:36:32+08:00">2020-03-24 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/5G%E5%8D%8F%E8%AE%AE/" itemprop="url" rel="index"><span itemprop="name">5G协议</span></a></span></span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">6.5k </span><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">27</span></div></div></header><div class="post-body" itemprop="articleBody"><div class="out-img-topic"><img src="/5G协议/5G-NR-PRACH学习/咒术回战01.jpg" class="img-topic"></div><div class="post-button text-center"><div>《咒术回战》 - 三人组</div></div><a id="more"></a><h1 id="1-PRACH-信道"><a href="#1-PRACH-信道" class="headerlink" title="1 PRACH 信道"></a>1 PRACH 信道</h1><h2 id="1-1-PRACH-preamble-生成"><a href="#1-1-PRACH-preamble-生成" class="headerlink" title="1.1 PRACH preamble 生成"></a>1.1 PRACH preamble 生成</h2><p>LTE系统中使用Zaddof-Chu (ZC) 序列作为PRACH信道的上行同步序列，因为其具有良好的<strong>自相关</strong>和<strong>互相关性</strong>，<strong>恒幅低峰均比</strong>等特性。</p><p>①<strong>自相关</strong>：对于任意ZC原始序列与其循环移位n位后所得到的序列互不相关；<br>②<strong>互相关</strong>：互相关和部分相关值接近零，便于接收端准确地把所需的信号检测出来；<br>③<strong>恒幅低峰均比</strong>：保证相应带宽内的每个频点经理相同的激励，便于实现想干检测中的无偏估计；<br>在PRACH信道上发送的ZC序列，也被称为PRACH Preamble，前导码。LTE支持两种长度的ZC序列，根据根索引序列，通过循环移位生成多个序列</p><script type="math/tex;mode=display">N_{ZC} = 839\\N_{ZC} = 139</script><p>NR 中的PRACH信道沿用了LTE的ZC序列设计，支持两种长度ZC序列，和LTE一致，也通过循环移位生成多个序列，只是符号名称不同，含义都是相同的。</p><script type="math/tex;mode=display">L_{RA} = 839\\L_{RA} = 139</script><p>ZC 序列定义：$x_u(i) = e^{-j \frac{\pi u(i+1)}{L_{RA}}},i = 0,1,…,L_{RA}-1$</p><p>经过循环移位后，ZC序列集合为：$x_{u,v}(n)=x_u((n+C_v)modL_{RA})$</p><p>具体的生成流程如下图所示:<br><br><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p1-preamble生成.png" alt></p><p>举例说明，参数如下：<br><em>prach-ConfigurationIndex</em> 2<br><em>zeroCorrelationZoneConfig</em> = 6<br><em>restrictedSetConfig</em> <em>unrestrictedSet</em><br><em>prach-RootSequenceIndex</em> l839 : 20</p><p>首先根据 <em>prach-ConfigurationIndex 2</em> ，查表[TS 38.211 Table 6.3.3.2-2] 可知 Format 0 即long symbol 类型，也就是$L_{RA} = 839$, 之后查表[TS 38.211 Table 6.3.3.1-3]<br>根据 <em>prach-RootSequenceIndex</em> l839 : 20 可知：$u = 2$ , 并通过ZC序列定义公式生成$x_2(n)$序列。</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T4-38.211-6.3.3.1-3(4" alt>副本.png)</p><p>由 <em>zeroCorrelationZoneConfig</em> = 6；<em>restrictedSetConfig unrestrictedSet</em>。<br>查表[TS 38.211 Table 6.3.3.1-1]可知$\Delta f_{RA} = 1.25$KHz<br>再查表[TS 38.211 6.3.3.1-5]可知$N_{CS} = 32$。</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/Inked38.211-6.3.3.1-5_LI.jpg" alt></p><p>根据公式可知$v = 0,1,…,\lfloor L_{RA}/N_{CS} \rfloor - 1 = 0,1,…,\lfloor 839/32 \rfloor -1 = 0,1,…,25$，所以$C_v = v \cdot N_{CS} = v \cdot 32 = [0,32,64,…,800]$，这样可以获得 $x_2(n)$ 的26种循环移位后的序列，也就是获得了26个preamble 序列。</p><p>因为 26 &lt; 64，所以根索引会递增为 <em>prach-RootSequenceIndex</em> l839 : 21，对应的$u = 837$，操作与上文相同，又可以生成26个preamble序列。<br>因为 52 &lt; 64，所以根索引会递增为 <em>prach-RootSequenceIndex</em> l839 : 22，对应的$u = 1$，操作与上文相同，这次只用生成12个preamble序列即可。</p><p>经过以上步骤，就获得了64个preamble序列，对其做DFT就是其频域表达。</p><h2 id="1-2-PRACH-preamble-格式"><a href="#1-2-PRACH-preamble-格式" class="headerlink" title="1.2 PRACH preamble 格式"></a>1.2 PRACH preamble 格式</h2><p>Preamble总体上分为两大类，long preamble和short preamble，分别对应$L_{RA} = 839,L_{RA} = 139$。其中long preamble分为四种Format,分别为Format 0/1/2/3，short preamble分为九种A1/A2/A3/B1/B2/B3/B4/C0/C2。配置如下表所示:</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T1-38.211-6.3.3.1-1.png" alt></p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T2-38.211-6.3.3.1-2.png" alt></p><p>需要的一些基础参数如下：</p><script type="math/tex;mode=display">T_c = 1/(\Delta f_{max}\cdot N_f) = 1/(480\times 10^3\cdot 4096) = 0.509ns = 0.509\times10^{-6}ms\\T_s = 1/(\Delta f_{ref}\cdot N_{f,ref}) = 1/(15\times 10^3\cdot 2048) = 32.552ns = 32.552\times10^{-6}ms\\K = \frac{T_s}{T_c} = 64</script><p>Preamble结构一般由三部分组成：Cyclic Prefix(CP) + Preamble Sequence (重复) + Guard Period(GP)，其中核心部分preamble sequence可能重复多次，取决于不同的Format。</p><table><tr><td><center></center></td><td><center>PRACH preamble 格式</center></td><td><center>特点</center></td></tr><tr><th rowspan="4"><center>long preamble</center></th><td><center>Format 0</center></td><td><center>时长1ms; 用于普通场景</center></td></tr><tr><td><center>Format 1</center></td><td><center>时长3ms; 用于超远距离覆盖场景</center></td></tr><tr><td><center>Format 2</center></td><td><center>时长3.5ms; 其中sequence重复发送4次,用于需要覆盖增强场景(如室内)</center></td></tr><tr><td><center>Format 3</center></td><td><center>时长1ms; 用于高速移动场景</center></td></tr><tr><th rowspan="3"><center>short preamble</center></th><td><center>Format A1/A2/A3</center></td><td><center>时长和2,4,6个OFDM符号对齐; 没有GAP; 用于覆盖距离较近,UE位置集中的场景</center></td></tr><tr><td><center>Format B1/B2/B3/B4</center></td><td><center>时长和2,4,6,12个OFDM符号对齐; 有GAP</center></td></tr><tr><td><center>Format C0/C2</center></td><td><center>时长和2,6个OFDM符号对齐; 有GAP,且相对于其他类型较长; 用于较远距离场景</center></td></tr></table><p>以下为各种格式的细节:<strong>图片摘自ShareTechnote</strong></p><p><strong>long preamble 分为四种 Format , 分别为 Format 0/1/2/3</strong></p><p>Format 0:</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p2-Format 0.png" alt></p><p>Format 1:</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p3-format 1.png" alt></p><p>Format 2:</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/format2.png" alt></p><p>Format 3:</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p5-format 3.png" alt></p><p><strong>short preamble 分为九种 Format A1/A2/A3/B1/B2/B3/B4/C0/C2</strong></p><p>格式 A 没有定义GAP，适用于覆盖距离较近，UE位置集中的场景</p><p>Format A1: PRACH时长和 <strong>2 OFDM symbol</strong> 对齐</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p6-format A1.png" alt></p><p>Format A2: PRACH时长和 <strong>4 OFDM symbol</strong> 对齐</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p7-format A2.png" alt></p><p>Format A3: PRACH时长和 <strong>6 OFDM symbol</strong> 对齐</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p8-format A3.png" alt></p><p>格式B 定义了GAP</p><p>Format B1: PRACH时长和 <strong>2 OFDM symbol </strong>对齐</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p9-format B1.png" alt></p><p>Format B2: PRACH时长和 <strong>4 OFDM symbol </strong>对齐</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p10-format B2.png" alt></p><p>Format B3: PRACH时长和 <strong>6 OFDM symbol</strong> 对齐</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p11-format B3.png" alt></p><p>Format B4: PRACH时长和 <strong>12 OFDM symbol</strong> 对齐</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p12-format B4.png" alt></p><p>格式C 定义了GAP，且GAP保护时长较大，适用于覆盖距离较远的场景</p><p>Format C0: PRACH时长和 <strong>2 OFDM symbol</strong> 对齐</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p-13format C0.png" alt></p><p>Format C2: PRACH时长和 <strong>6 OFDM symbol</strong> 对齐</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p14-format C2.png" alt></p><p>补充： 如果PRACH Format指示为 A1/B1，A2/B2，A3/B3（混合格式）时，则一个PRACH时隙中最后一个PRACH Occasion 为Format B1/B2/B3，一个PRACH时隙中，前面位置的PRACH Occasion为Format A1/A2/A3。（Format A1/2/3，B1/2/3时长一致(2/4/6 OFDM 符号)，差别在于CP和GAP长度，Format A 无GAP）</p><h2 id="1-3-映射到物理资源"><a href="#1-3-映射到物理资源" class="headerlink" title="1.3 映射到物理资源"></a>1.3 映射到物理资源</h2><p>PRACH信道时域信号定义如下：</p><script type="math/tex;mode=display">s_l^{(p,\mu)}(t)=\sum_{k=0}^{L_{RA}-1}{a_k}^{(p,RA)}\cdot e^{j2\pi(k+Kk_1+\overline k)\Delta f_{RA}(t-N_{CP,l}^{RA}T_c-t_{start}^{RA})}\\K = \Delta f/\Delta f_{RA}\\k_1 = k_0^\mu+N_{BWP,i}^{start}N_{sc}^{RB}+n_{RA}N_{RB}^{RA}N_{sc}^{RB}-N_{grid}^{size,\mu}N_{sc}^{RB}/2\\k_0^\mu = (N_{grid}^{start,\mu}+N_{grid}^{size,\mu}/2)N_{sc}^{RB}-(N_{grid}^{start,\mu_0}+N_{grid}^{size,\mu_0}/2)N_{sc}^{RB}2^{\mu_0-\mu}</script><p>其中 $t_{start}^{RA}\leq t &lt;t_{start}^{RA}+(N_u+N_{CP,l}^{RA})T_c$<br>$\alpha_k^{(p,RA)} = \beta_{PRACH}\cdot y_{u,v}(k)$</p><p>$t_{start}^{RA}$ 表示PRACH preamble</p><ul><li>在一个子帧中的开始位置 —- （ $\Delta f_{RA} \in \{1.25,5,15,30\}$KHz ）</li><li>或者在一个60 KHz的时隙中的位置 —- （ $\Delta f_{RA} \in \{60，120\}$KHz ）</li></ul><h3 id="1-3-1-时域资源映射"><a href="#1-3-1-时域资源映射" class="headerlink" title="1.3.1 时域资源映射"></a>1.3.1 时域资源映射</h3><p>从公式着手：</p><script type="math/tex;mode=display">t_{start}^{RA} = t_{start,l}^\mu \\t_{start,l}^{\mu} = \begin {cases} 0 \quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad l = 0\\ t_{start,l-1}^\mu +(N_u^\mu + N_{CP,l-1}^{\mu})T_c \quad \quad otherwise \end{cases}</script><p>符号位置$l$ , $l = l_0+n_t^{RA}N_{dur}^{RA}+14n_{slot}^{RA}$</p><p>其中：</p><ul><li>$l_0$ 为起始符号位置，根据配置表格获得</li><li>$n_t^{RA}$ 为一个PRACH时隙内的PRACH发送时刻，$n_t^{RA} \in \{0,…,N_t^{RA,slot}-1\}$, $L_{RA}= 839$ 时固定为1, $L_{RA} = 139$ 时根据配置表格得到</li><li>$N_{dur}^{RA}$ 根据PRACH配置索引表格得到，和各自格式对应</li><li>$\Delta f_{RA} \in \{1.25,5\}$KHz $\mu = 0$ , 其他情况下，$\mu$按照子载波间隔配置</li><li>$n_{slot}^{RA}$ : ① $\Delta f_{RA} \in \{1.25,5,15,60\}$KHz 时，$n_{slot}^{RA} = 0$ 。② $\Delta f_{RA} \in \{30,120\}$KHz 时，根据配置表格得到(倒数第三列)，如果配置为1，则$n_{slot}^{RA} = 1$ 。③ 其他情况，$n_{slot}^{RA}\in \{0,1\}$</li></ul><p>以上配置表格参考协议中的表格，见附录</p><blockquote><p>[TS 38.211 Table 6.3.3.2-2]<br>[TS 38.211 Table 6.3.3.2-3]<br>[TS 38.211 Table 6.3.3.2-4]</p></blockquote><p>对于时域资源的映射，只需要知道初始符号位置即可，应为特定的Format对应的preamble时域时长时确定的。</p><p>示例说明：<em>prach-ConfigurationIndex</em> = 103，查表可知参数如下：</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p15-时域举例1-1 (1" alt>.png)<br><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p16-时域举例1-2.png" alt></p><p>利用上文公式可知，时域资源映射位置，如下图所示：</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p17-时域举例1-3.png" alt><br><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p18-时域举例1-4.png" alt></p><h3 id="1-3-2-频域资源映射"><a href="#1-3-2-频域资源映射" class="headerlink" title="1.3.2 频域资源映射"></a>1.3.2 频域资源映射</h3><p>PRACH的频域资源主要由两个参数“<strong><em>msg1-FrequencyStart</em></strong>”和“<strong><em>msg1-FDM</em></strong>”决定。频域资源映射主要要确定PRACH频域资源的起始位置，以及PRACH频域占多少个RB。</p><ul><li>PRACH子载波间隔，1.25 5 15 30 60 120 KHz</li><li>PRACH资源在频域上的个数，即频域上的PRACH transmission Occasions, 也称为FDM个数，配置范围(1/2/4/8)个，对应高层参数为 <strong><em>msg1-FDM</em></strong></li><li>PRACH 第一个频域资源，在频域的起始位置，相对于上行激活BWP（上行初始BWP）中PRB 0的偏移位置，对应高层参数为 <strong><em>msg1-FrequencyStart</em></strong></li></ul><p>多个PRACH transmission occasions 在频域上连续放置。</p><p>PRACH频域资源具体情况，在[TS 38.211 Table 6.3.3.2-1]描述</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T3-38.211-6.3.3.2-1.png" alt></p><p>其中$\overline k $ 为下边缘子载波保护个数。分析表格可知，$(\Delta f/\Delta f^{RA}) \cdot N_{RB}^{RA} \cdot N_{sc}^{RB} $ 为 PRACH 占用的子载波数，实际发送使用$L_{RA}$ 个子载波。举个例子，对于第一行：PRACH占用的子载波数 = $(15/1.25)<em>6</em>12 = 864$ 个子载波，实际发送使用 <strong><em>839</em></strong> 个子载波。</p><p>根据1.3节上PRACH信道时域信号</p><p>其中：</p><ul><li>$\mu_0$ 为UE配置的子载波中最大的 $\mu$ 值</li><li>$N_{BWP,i}^{start}$ 为配置的上行初始BWP（或者激活上行BWP）的最低RB索引</li><li>$n_{RA}^{start}$ 为配置的PRACH频域资源在BWP（初始或激活）中的最低RB索引，对应高层参数<em>msg1-FrequencyStar</em></li><li>$n_{RA} \in \{0,1,…,M-1\}$ 表示PRACH transmission occasion 的索引，从0到M，M为配置的PRACH频域资源的PRACH频域资源个数对应的高层参数 <em>msg1-FDM</em> 其取值范围是1，2，4，8</li></ul><p>频域资源位置参考如下图所示：</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p19-频域映射.png" alt></p><h2 id="1-4-SSB和RACH信道配置"><a href="#1-4-SSB和RACH信道配置" class="headerlink" title="1.4 SSB和RACH信道配置"></a>1.4 SSB和RACH信道配置</h2><h3 id="1-4-1-概述"><a href="#1-4-1-概述" class="headerlink" title="1.4.1 概述"></a>1.4.1 概述</h3><p>基站按照前文步骤生成了 preamble，并通过广播发送给UE，UE也知道了PRACH的时频域资源位置，在把preamble放在某个PRACH上发出去之前，还差最关键的一步，那就是基站要确定PRACH与SSB的映射关系。<br>5G里面凡事都会涉及到Beam这个概念，RACH流程也不例外。一个5G小区会发射多个SSB，也就是说有很多个下行的beam。终端会monitor和测量这些beam，挑选一个信号最好的SSB或者beam进行驻留。很明显，终端要获得比较好的上下行传输性能，需要与基站建立一个beam pair(发送beam和接收beam)。这里要强调一点，beam是分发送和接收的，并不是只有发送有beam，接收也有。另外，说到发送beam和接收beam，这里要区分上下行。</p><ul><li>上行（UE -&gt; gNB）: beam pair指基站接收beam，终端发送beam</li><li>下行（gNB -&gt; UE）: beam pair指终端接收beam，基站发送beam</li></ul><p><strong>大致的流程</strong>如下：</p><ol><li>基站：根据逻辑根索引配置生成64个preamble，通过多组beam广播生成信息给UE。</li><li>UE：接收，并测量出最佳的波束方向，随机选取preamble index，选择一个CB preamble，然后以最佳的波束方向反向发送PRACH给基站。</li><li>基站：接收到UE的PRACH，并通过SSB与PRACH之间的关联（SSB仅与CB preamble相关联）确定基站与UE之间的最佳波束方向，以后通过该波束方向向UE发送后续数据。</li></ol><p>简而言之，就是PRACH的发送时刻（RO，RACH occasion，PRACH occasion）需要和SSB发送的时刻（SSB index）建立映射关系。基站根据UE上行PRACH的资源位置，决定下行RAR（RA response）发送的波束。</p><h3 id="1-4-2-SSB与RO映射顺序"><a href="#1-4-2-SSB与RO映射顺序" class="headerlink" title="1.4.2 SSB与RO映射顺序"></a>1.4.2 SSB与RO映射顺序</h3><p>RACH参数配置中<strong><em>ssb-perRACH-OccasionAndCB-PreamblesPerSSB</em></strong>用于配置：</p><ul><li>每个RACH时刻对应的SSB个数 N ，取值可以为 1/8 1/4 1/2 1 2 4 8 16</li><li>每个SSB在一个RO内所能使用的基于竞争的Preamble个数，R（其实就是按SSB数平分CB-preambles）</li></ul><p>① <strong><em>ssb-perRACH-Occasion</em></strong> &gt;=1,即 N &gt; = 1时，表示一个RACH Occasion 对应多个SSB<br>② <strong><em>ssb-perRACH-Occasion</em></strong> &lt;1 , 表示一个SSB对应多个RACH Occasion</p><p>SSB和RO的映射遵循以下原则：</p><ul><li>首先，在一个RO内按照preamble index的升序映射</li><li>其次，按照频域RO升序映射</li><li>然后，按照一个PRACH slot内时域RO升序映射</li><li>最后，按照PRACH slot升序映射</li></ul><p>以下举4个例子说明一下:<br>(1) <em>ssb-perRACH-Occasion</em> = 1/4 , <em>msg1-FDM</em> = 4 $L_{max} = 4$ (也即 SSB个数), SSB 与PRACH occasion映射示意图如下：</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p20-SSB-PRACH例子1.png" alt></p><p>(2) <em>ssb-perRACH-Occasion</em> = 1/2 , <em>msg1-FDM</em> = 4 $L_{max} = 8$ , SSB 与PRACH occasion映射示意图如下：</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p21-SSB-PRACH例子2.png" alt></p><p>(3) <em>ssb-perRACH-Occasion</em> = 1 , <em>msg1-FDM</em> = 4 $L_{max} = 8$ , SSB 与PRACH occasion映射示意图如下：</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p22-SSB-PRACH例子3.png" alt></p><p>(4) <em>ssb-perRACH-Occasion</em> = 2 , <em>msg1-FDM</em> = 2 $L_{max} = 16$ , SSB 与PRACH occasion映射示意图如下：</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p23-SSB-PRACH例子4.png" alt></p><h3 id="1-4-3-SSB-和-RACH-映射周期"><a href="#1-4-3-SSB-和-RACH-映射周期" class="headerlink" title="1.4.3 SSB 和 RACH 映射周期"></a>1.4.3 SSB 和 RACH 映射周期</h3><p>PRACH在时域和频域上有多个发送时刻，每个SSB块要和PRACH发送时刻建立映射关系。同时引入一个<strong><em>association period</em></strong> 映射周期的概念，即表示所有的SSB块全部映射到RO后，需要在时域上多少个PRACH周期。<br>映射周期从帧号0开始。所有SSB至少映射一次后，“多余”的RO，没有SSB映射的话，这些RO不用。<br><strong><em>Association pattern period</em></strong> — 映射图样周期，包含1个或者多个映射周期<strong><em>association periods</em></strong>，为160 ms ,每隔160 ms 重复进行PRACH和SSB的映射。</p><p>举例说明:<br>若<strong><em>ssb-perRACH-Occasion</em></strong> = 1/2 , <strong><em>msg1-FDM</em></strong> = 4 $L_{max} = 4$ , PRACH 周期为 1 Frame = 10 ms，每一个 Frame 中只有一个subFrame 有时域 Occasion ,每一个 subFrame 中 只有一个 时域 occasion 。</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p24-SSB周期.png" alt></p><h1 id="2-随机接入过程"><a href="#2-随机接入过程" class="headerlink" title="2 随机接入过程"></a>2 随机接入过程</h1><h2 id="2-1-概述"><a href="#2-1-概述" class="headerlink" title="2.1 概述"></a>2.1 概述</h2><p>终端成功解出SSB后便获得了NR系统的下行同步，要想完成上行同步以并与NR网络建立RRC连接，那么随机接入RACH流程必不可少。</p><h3 id="2-1-1-随机接入触发场景"><a href="#2-1-1-随机接入触发场景" class="headerlink" title="2.1.1 随机接入触发场景"></a>2.1.1 随机接入触发场景</h3><p>下面这10条RACH触发原因摘自协议38.300。其中第7、9和10条是NR系统新出现的，也是在以往LTE中没有的。其中第7条是指由RRC_Inactive状态向RRC_Connected状态转换，RRC_Inactive状态是NR中新引入的一种RRC状态；第9条是指对于NR系统中一些不广播的系统消息Other SI，UE采用随机接入流程“按需索要”这些不广播的系统消息；第10条是指beam failure后的恢复流程。</p><blockquote><p>1）Initial access from RRC_IDLE;<br>2）RRC Connection Re-establishment procedure;<br>3）DL or UL data arrival during RRC_CONNECTED when UL synchronisation status is “non-synchronised”;<br>4）UL data arrival during RRC_CONNECTED when there are no PUCCH resources for SR available;<br>5）SR failure;<br>6）Request by RRC upon synchronous reconfiguration (e.g. handover);<br>7）Transition from RRC_INACTIVE;<br>8）To establish time alignment for a secondary TAG;<br>9）Request for Other SI;<br>10）Beam failure recovery.</p></blockquote><h3 id="2-1-2-随机接入流程"><a href="#2-1-2-随机接入流程" class="headerlink" title="2.1.2 随机接入流程　　"></a>2.1.2 随机接入流程</h3><p>随机接入过程可以分为竞争性随机接入过程（CBRA）和非竞争性随机接入（CFRA）。非竞争性随机接入是网络将特定的随机接入资源是分配给UE的，通过Random Access Preamble网络就能识别特定的UE。具体的流程如下图所示（摘自ShareTechnote）：</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p26-contention-Based.png" alt></p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p27-contention-free.png" alt></p><p>以CBRA的4步(上图CDEF步骤)为例：</p><ul><li>Msg1: UE在合适的PRACH上向gNB发送Preamble；</li><li>Msg2: gNB向UE发送RAR，并包含TC-RNTI、UL timing和对Msg3的调度等信息；</li><li>Msg3/4: 用于竞争冲突解决（多个UE恰巧在同一PRACH时频资源上采用了同一个preamble做RACH）。</li></ul><h2 id="2-2-Msg1"><a href="#2-2-Msg1" class="headerlink" title="2.2 Msg1"></a>2.2 Msg1</h2><p>前文描述的内容也就是Msg1的大部分内容。在发送Msg1给基站之前, ① 要确定多大的功率发送Msg1的preamble；②要确定RAR是发给自己的，即需要一个身份认证，因此用到了RA-RNTI可以唯一标识Msg1发送的时频资源这一特性。</p><h3 id="2-2-1-Msg1的发射功率"><a href="#2-2-1-Msg1的发射功率" class="headerlink" title="2.2.1 Msg1的发射功率"></a>2.2.1 Msg1的发射功率</h3><p>根据[TS 38.213 7.4]，UE配置PRACH信道的发送功率为 $P_{PRACH,b,f,c}(i) $，其意义是基于服务小区C 的 DL RS 在上行激活带宽 b 载波 f上，在发送时刻 为 i 时的发射功率。</p><script type="math/tex;mode=display">P_{PRACH,b,f,c}(i) = min\{P_{CMAX,f,c}(i),P_{PRACH,target,f,c}+PL_{b,f,c}\}[dBm]</script><p>其中：</p><ul><li>$P_{CMAX,f,c}(i)$ 是UE配置的最大输出功率，由 [8-1. TS 38.101-1]和 [8-2. TS 38.101-2]给出。</li><li>$P_{PRACH,target,f,c}$ 为PRACH 目标接收功率 <em>PREAMBLE_RECEIVED_TARGET_POWER</em> 由[11. TS 38.321] 给出计算公式：<em>PREAMBLE_RECEIVED_TARGET_POWER</em> = <em>preambleReceivedTargetPower</em> + <em>DELTA_PREAMBLE</em> + <em>(PREAMBLE_POWER_RAMPING_COUNTER -1)</em> <em></em>PREAMBLE_POWER_RAMPING_STEP*<ul><li><em>preambleReceivedTargetPower</em> 由参数 <em>preambleReceivedTargetPower</em> 给出</li><li><em>DELTA_PREAMBLE</em>可由[TS 38.321 Table 7.3-1~2] 获得</li><li><em>PREAMBLE_POWER_RAMPING_COUNTER</em> 对初始传输为1，依据重传次数自增一</li><li><em>PREAMBLE_POWER_RAMPING_STEP</em> 由参数 <em>powerRampingStep</em> 给出<br>（以上两条是为了功率攀升而设定的参数）</li></ul></li></ul><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T13-213 7.3-1.png" alt></p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T14-213 7.3.1-2.png" alt></p><ul><li>$PL_{b,f,c}$ 为路径损耗。由参数 <em>referenceSignalPower</em> – <em>higher layer filtered RSRP</em> (in dBm) 获得。<ul><li><em>referenceSignalPower</em> 根据PRACH 关联的SSB或者CSI-RS，由参数 <em>ss-PBCH_BlockPowe</em>r 和 <em>powerControlOffsetSS</em> 决定。</li><li><em>higher layer filtered RSRP</em> 是发送PRACH时测得的 RSRP (Reference Signal Receiving Power)。</li></ul></li></ul><p>示例：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">rach-ConfigGeneric</span><br><span class="line">&#123;</span><br><span class="line">prach-ConfigurationIndex 2,			\\ 可以确定format 0</span><br><span class="line">msg1-FDM one,</span><br><span class="line">msg1-FrequencyStart 2,</span><br><span class="line">zeroCorrelationZoneConfig 6,</span><br><span class="line">preambleReceivedTargetPower -100,	\\ -100</span><br><span class="line">preambleTransMax n10,				\\ 最大重传次数</span><br><span class="line">powerRampingStep dB4,				\\ 4</span><br><span class="line">ra-ResponseWindow sl20</span><br><span class="line">&#125;,</span><br><span class="line">ss-PBCH-BlockPower -8				\\ referenceSignalPower&#x3D;-8</span><br><span class="line">假设此时的RSRP为-94dBm</span><br></pre></td></tr></table></figure><p></p><p>则此时的Msg1的初始发射功率为：</p><script type="math/tex;mode=display">P = -100 + 0 + (1-1)*4 + [-8-(-94)] = -14dBm</script><p>如果发生Msg2或者Msg4失败，则会触发Msg1重传，Msg1的最大重传次数由参数<em>preambleTransMax</em>定义。如果发生Msg1的重传，每次重传功率会以<em>powerRampingStep</em>这个步长增大(功率攀升，Ramping)，直到最后达到UE的最大功率或者重传达到最大次数为止。<br>注意：</p><ul><li>当UE<strong>继续使用</strong>上次发送SSB波束重发Msg1时，需要功率攀升。</li><li>当UE<strong>更换</strong>SSB波束发送Msg1时，不需要进行功率攀升。</li></ul><h3 id="2-2-2-RA-RNTI的计算和使用"><a href="#2-2-2-RA-RNTI的计算和使用" class="headerlink" title="2.2.2 RA-RNTI的计算和使用"></a>2.2.2 RA-RNTI的计算和使用</h3><p>RA-RNTI可以表征Msg1发送时使用的时频资源，UE发送Msg1时会计算RA-RNTI并保存；gNB收到该Msg1后，同样会计算RA-RNTI，并使用该RA-RNTI对Msg2的PDCCH DCI format 1_0的CRC进行扰码。</p><p>RA-RNTI=1 + s_id + 14 $\times$ t_id +14$\times80\times$ f_id + $14\times80\times8\times$ ul_carrier_id</p><p>其中：</p><ul><li>s_id 是PRACH的起始符号索引 (0$\leq$ s_id &lt;14)</li><li>t_id 是系统帧内PRACH的起始时隙索引 (0$\leq$ t_id &lt;50)</li><li>f_id 是PRACH 频域位置索引 (0$\leq$ f_id &lt;8)</li><li>ul_carrier_id 是Msg1发送上行载波指示 (0 for NUL carrier, and 1 for SUL carrier)</li></ul><h2 id="2-2-Msg2"><a href="#2-2-Msg2" class="headerlink" title="2.2 Msg2"></a>2.2 Msg2</h2><h3 id="2-2-1-UE接收Msg2"><a href="#2-2-1-UE接收Msg2" class="headerlink" title="2.2.1 UE接收Msg2"></a>2.2.1 UE接收Msg2</h3><ol><li>UE首先需要去解析出用于Msg2的下行调度的PDCCH DCI。定义了一个window的概念，UE在这个窗口内去监听PDCCH。window的长度由参数 <em>ra-ResponseWindow</em> 规定（不能超过10ms），单位是slot。window的起点是距离PRACH发送之后至少间隔1个symbol的用于Typ1-PDCCH CSS的CORESET的首个symbol。一般情况都是PRACH发送完之后的那个下行slot作为起点。</li><li>要监听的DCI的格式是format 1_0。这个DCI需要去Type 1 PDCCH Common Search Space去找，由参数 <em>ra-SearchSpace</em> 定义。</li><li>基站对这个PDCCH DCI的CRC使用了RA-RNTI进行了扰码，所以终端需要在 <em>ra-searchspace</em>上面尝试使用RA-RNTI去解析PDCCH DCI。</li><li>如果UE成功的使用RA-RNTI解调了DCI（知道这个消息是发送给自己的）。接着它会去解PDSCH payload。</li><li>如果UE继续成功的解出了PDSCH，UE会检查其中 RAPID（random access preamble identity）是否与自己当时发送Msg1时使用的RACH preamble ID相同。如果相同，UE认为Msg2解调成功。</li><li>如果UE在<em>ra-ResponseWindow</em> 内没有使用RA-RNTI解出DCI，或者没有成功解出PDSCH payload，或者解出了PDSCH但是RAPID不匹配，UE都会认为Msg2接收失败，会触发Msg1重发。</li></ol><h3 id="2-2-2-Msg2内容"><a href="#2-2-2-Msg2内容" class="headerlink" title="2.2.2 Msg2内容"></a>2.2.2 Msg2内容</h3><blockquote><p><strong>6.1.5 MAC PDU (Random Access Response)</strong><br>A MAC PDU consists of one or more MAC subPDUs and optionally padding. Each MAC subPDU consists one of the following:</p><ul><li>a MAC subheader with Backoff Indicator only;</li><li>a MAC subheader with RAPID only (i.e. acknowledgment for SI request);</li><li>a MAC subheader with RAPID and MAC RAR.</li></ul></blockquote><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p28-Figure6.1.5-3.png" alt></p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p31-MAC-PDU.png" alt></p><p>上面的描述及图片摘自 [TS 38.213]，结构图摘自ShareTechnote，说明Msg2这个MAC PDU 肯能包含BI，RAPID 和 MAC RAR三部分。</p><ul><li>BI（Backoff Indicator）用于当Msg1重发的时候产生一个随机退避时间（0 - PREAMBLE_BACKOFF），当这个退避时间结束后，终端才能重发Msg1。Msg2里面的BI field对应的退避时间如下表[TS 38.321 Table 7.2-1]。如果不包含用于BI的MAC subPDU，那么重发Msg1时退避时间为0ms。</li></ul><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p30-7.2-1.png" alt></p><ul><li>RAPID，用于携带random access preamble ID，如上描述。</li><li>RAR，这个subPDU是Msg2里面最重要的部分。主要包括TA，UL GRANT信息和TC-RNTI，其中UL GRANT是用于后面的Msg3，包括PUSCH的时域，频域的资源分配，是否跳频，MCS，Msg3的功控(参考[TS 38.213 Table 8.2-2])和CSI request。具体结构如下图[TS 38.321 6.2.2-3]，UL_GRANT中的内容如下表[TS 38.213 Table 8.2-1]。</li></ul><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p29-Figure 6.2.3-1.png" alt></p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T-15-8.2-1.png" alt></p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T15-213-8.2-2.png" alt></p><h2 id="2-3-Msg3"><a href="#2-3-Msg3" class="headerlink" title="2.3 Msg3"></a>2.3 Msg3</h2><p>根据前文描述UE在Msg2中解析到MAC RAR，MAC RAR中包含着27 bit 的UL Grant，该UL Grant指示了PUSCH的时域，频域的资源分配，是否跳频，MCS，Msg3的功控和CSI request 等消息。</p><h3 id="2-3-1-Msg3的传输内容"><a href="#2-3-1-Msg3的传输内容" class="headerlink" title="2.3.1 Msg3的传输内容"></a>2.3.1 Msg3的传输内容</h3><p>Msg3传输的内容取决于随机接入的场景。</p><ul><li>UE已经拥有了合法的C-RNTI：UE在Mdg3上发送C-RNTI MAC CE (由LCID index 58)。</li><li>UE没有合法的C-RNTI：UE在Msg3上发送CCCH SDU (由LCID指示)，这些CCCH SDU里面包含竞争解决身份identity。<h3 id="2-3-2-Msg3的发送时刻"><a href="#2-3-2-Msg3的发送时刻" class="headerlink" title="2.3.2 Msg3的发送时刻"></a>2.3.2 Msg3的发送时刻</h3>假设接收Msg2末尾消息在slot $n$ , 则UE发送Msg3的 solt $n+k_2+\Delta$ , 其中的 $k_2, \Delta$ 由 [6. TS 38.214] 给出，如下图所示。</li></ul><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p32-K2.png" alt></p><p>Msg3的发送时刻与Msg2的最后一个symbol至少相隔 $N_{T,1}+N_{T,2}+0.5$ msec，其中 $N_{T,1}，N_{T,2}$ 是N个符号的持续时间，该时间与当配置 additional PDSCH DMRS时用于UE处理能力1,2 的PDSCH处理时间相对应。N 的对应取值由下表给出：</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T20-214-6.4-1.png" alt></p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T21-214-6.4-2.png" alt></p><h2 id="2-4-Msg4"><a href="#2-4-Msg4" class="headerlink" title="2.4 Msg4"></a>2.4 Msg4</h2><p>Msg4 是 Contention Resolution 环节。竞争解决的方式取决于 Msg3 中是传输了CCCH SDU 还是 C-RNTI MAC CE。</p><ul><li><p>Msg3 中传输CCCH SDU</p><p>在这种情况下，Msg3发送对应PUSCH符号结束之后，则开启 <em>re-ContentionResolutionTimer</em> ，在TImer为未超时之前，在<em>ra-SearchSpace</em> 上检测 Temporay C-RNTI 的DCI format 1_0，在调度的PDSCH译码正确的情况下，如果解析到UE Contention Resolution Identity MAC CE，且其内容与发送的CCCH SDU 两者内容一致，则认为随机过程接入成功，之后停止 <em>ra-ContentionResolutionTimer</em>，并将TC-RNTI正式转化为C-RNTI。</p></li><li><p>Msg3 中传输 C-RNTI MAC CE</p><p>此种情况下，冲突解决的原理与传输CCCH SDU时相同，只是通过接收C-RNTI调度的DCI来判断竞争解决是否成功。</p></li></ul><h2 id="2-5-HARQ-ACK-for-Msg4"><a href="#2-5-HARQ-ACK-for-Msg4" class="headerlink" title="2.5 HARQ ACK for Msg4"></a>2.5 HARQ ACK for Msg4</h2><p>一旦UE成功解析出Msg4，UE在PUCCH中发送HARQ-ACK信息。反馈时间距离Msg4的最后一个symbol至少相隔$N_{T,1}+0.5$ msec (参考Msg3的准备时间)。</p><h2 id="2-6-流程时序图总结"><a href="#2-6-流程时序图总结" class="headerlink" title="2.6 流程时序图总结"></a>2.6 流程时序图总结</h2><p>流程时序如下图所示：</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p33-时序图.png" alt></p><p>其中：</p><ul><li><ol><li>gNB → UE：System information。</li></ol><ul><li>Configuration of PRACH transmission Parameters<ul><li>PRACH Preamble Format</li><li>Time Resources</li><li>Frequency Resources</li></ul></li><li>Parameters for determining the root sequences and their cyclic shifts in the PRACH Preamble sequence set<ul><li>index to logical root sequence table</li><li>Cyclic Shift(Ncs)</li><li>Set Type (unrestricted, restricted set A or restricted set B)</li></ul></li></ul></li><li><ol><li>UE → gNB：Msg1- PRACH Preamble。PRACH Preamble 频域资源由参数 <em>msg1-FDM</em> 和 <em>msg1-FrequencyStart</em> 决定；PRACH Preamble 时域资源由参数 <em>prach-ConfigurationIndex</em> 决定；</li></ol></li><li><ol><li>gNB → UE：Msg2。Msg2需要在ra-ResponseWindow内被UE接收。</li></ol></li><li><ol><li>UE → gNB：Msg3。Msg3发送时隙，与Msg2最后时隙相差 $k_2+\Delta$ ; 时间上至少相隔 $N_{T,1}+N_{T,2}+0.5$ ms 。</li></ol></li><li><ol><li>gNB → UE：Msg4。冲突解决环节，对应Msg3所传输的不同内容做出回应。Msg4需要在<em>ra-ContentionResolutionTimer</em> 内被UE接收。</li></ol></li><li><ol><li>UE → gNB：HARQ ACK。反馈时间距离Msg4的最后一个symbol至少相隔$N_{T,1}+0.5$ ms 。</li></ol></li></ul><h1 id="3-扩展"><a href="#3-扩展" class="headerlink" title="3 扩展"></a>3 扩展</h1><blockquote><p>主要参考：<a href="https://blog.csdn.net/GiveMe5G/article/details/103847118" target="_blank" rel="noopener">https://blog.csdn.net/GiveMe5G/article/details/103847118</a></p></blockquote><p>主要是分析随机接入过程中的消息如何组合起来应用到实际的场景中去。参考中主要是归纳总结了随机接入的触发场景，并对三个重要场景下的RACH流程进行进一步的分析。</p><h2 id="3-1-RACH触发类型-场景-分类"><a href="#3-1-RACH触发类型-场景-分类" class="headerlink" title="3.1 RACH触发类型(场景)分类"></a>3.1 RACH触发类型(场景)分类</h2><p>RACH流程主要由三种触发类型：</p><ul><li>PDCCH order触发</li><li>MAC层触发</li><li>RRC层触发</li></ul><blockquote><p>The Random Access procedure described in this clause is initiated by a PDCCH order, by the MAC entity itself, or by RRC for the events in accordance with TS 38.300</p></blockquote><p>以下是参考文章作者根据 TS 38.300 系列整理的表格，归纳了各个场景以及其对应的触发类型：</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p34-RACH场景.png" alt></p><h2 id="3-2-PDCCH-Order-RACH"><a href="#3-2-PDCCH-Order-RACH" class="headerlink" title="3.2 PDCCH Order RACH"></a>3.2 PDCCH Order RACH</h2><p>PDCCH Order 发起的随机接入主要用于上行失步后，当gNB有下行数据要发送时，会使用PDCCH Order 强制UE发起 RACH 以重新完成上行时间同步。PDCCH Order使用PDCCH DCI 1_0配置给UE。其字段的设置如下：</p><ul><li>Random Access Preamble index – 6 bits</li><li>UL/SUL indicator – 1 bit</li><li>SS/PBCH index – 6 bits</li><li>PRACH Mask index – 4 bits</li><li>Reserved bits – 10 bits</li></ul><p>从上述描述中可以看出，DCI 1_0中会告诉UE 用于RACH的preamble index 以便UE发起非竞争的随机接入，但是要注意这是有条件的，要求DCI 1_0中指示的preamble index非0，否则需要使用基于竞争的随机接入。</p><p>基于竞争和非竞争的PDCCH Order触发的RACH流程图如下所示：</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p35-场景1.png" alt></p><h2 id="3-3-Beam-Failure-Recovery-RACH"><a href="#3-3-Beam-Failure-Recovery-RACH" class="headerlink" title="3.3 Beam Failure Recovery RACH"></a>3.3 Beam Failure Recovery RACH</h2><p>在5G当中引入了一个beam 级别的链路恢复机制，Beam failure recovery，后面简称为BFR。BFR分为基于竞争和基于非竞争两种。按照38321中的描述，如果RRC配置了用于BFR的RACH资源并且用于beam恢复的candidate beam（SSB/CSI-RS）中至少有一个beam的RSRP高于一定的门限，而且beamFailureRecoveryTimer没有超时，这时才能使用基于非竞争的BFR；否则需要使用基于竞争的BFR。<br>下面的两幅图是基于竞争和非竞争的BFR RACH流程。需要注意的是，对于基于非竞争的BFR流程的Msg2，其PDCCH是使用C-RNTI扰码的，而不是RA-RNTI。</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p36-场景2.png" alt></p><h2 id="3-4-OSI-Other-System-Information-Request-RACH"><a href="#3-4-OSI-Other-System-Information-Request-RACH" class="headerlink" title="3.4 OSI (Other System Information) Request RACH"></a>3.4 OSI (Other System Information) Request RACH</h2><p>5G SA组网当中MIB和SIB1这两个系统消息一定是通过广播的方式通知UE的，但是其他的系统消息（OSI-Other System Information）可以采用像LTE的广播方式，也可以采用5G当中新引入的按需索要的方式（On Demond Request）。<br>对于按需索要的系统消息，会用到RACH 流程，具体分为Msg1 based和Msg3 based的两种RACH流程。注意，Msg1 based的请求需要基站在SIB1里面的SI-SchedulingInfo中配置专门用于OSI请求的RACH资源和Preamble，而且它的Msg2是一个只含有RAPID的MAC subPDU；而Msg3 based的其实是一种普通的基于竞争的RACH方式，只是这里面的Msg3引入了一个新的UL-CCCH消息，RRCSystemInfoRequest，用于请求UE想要的OSI。</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/p37-场景3.png" alt></p><h1 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h1><h2 id="附录A-相关表格"><a href="#附录A-相关表格" class="headerlink" title="附录A 相关表格"></a>附录A 相关表格</h2><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T1-38.211-6.3.3.1-1.png" alt></p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T2-38.211-6.3.3.1-2.png" alt></p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T3-38.211-6.3.3.2-1.png" alt></p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T5-38.211-6.3.3.1-3(4" alt>.png)</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T6-38.211-6.3.3.1-5.png" alt></p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T7-38.211-6.3.3.1-6.png" alt></p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T8-38.211-6.3.3.1-7.png" alt></p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T9-38.211-6.3.3.2-2.png" alt></p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T10-38.211-6.3.3.2-3.png" alt></p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/T11-38.211-6.3.3.2-4.png" alt></p><h2 id="附录B-相关配置"><a href="#附录B-相关配置" class="headerlink" title="附录B 相关配置"></a>附录B 相关配置</h2><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/C1-RACH-Configuration.png" alt><br><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/C2-RACH-Configuration2.png" alt></p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/C3-RACH-ConfigDedicated1.png" alt><br><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/C4-RACH-ConfigDedicated2.png" alt></p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/C5-RACH-ConfigGeneric.png" alt></p><blockquote><p>参考文献<br>公众号：5G菜鸟成长日记，春天工作室<br>网页：<a href="https://mp.weixin.qq.com/s/LRpnHwaAmYmpUlhF6wcmZg" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/LRpnHwaAmYmpUlhF6wcmZg</a><br>网页：<a href="http://www.sharetechnote.com/html/5G/5G_RACH.html" target="_blank" rel="noopener">http://www.sharetechnote.com/html/5G/5G_RACH.html</a><br>博客：<a href="https://blog.csdn.net/qq_33206497/article/details/89980529" target="_blank" rel="noopener">https://blog.csdn.net/qq_33206497/article/details/89980529</a><br>博客：<a href="https://blog.csdn.net/GiveMe5G/article/details/102634057" target="_blank" rel="noopener">https://blog.csdn.net/GiveMe5G/article/details/102634057</a><br>博客：<a href="https://blog.csdn.net/GiveMe5G/article/details/102633678" target="_blank" rel="noopener">https://blog.csdn.net/GiveMe5G/article/details/102633678</a><br>博客：<a href="https://blog.csdn.net/GiveMe5G/article/details/102633541" target="_blank" rel="noopener">https://blog.csdn.net/GiveMe5G/article/details/102633541</a><br>博客：<a href="https://blog.csdn.net/GiveMe5G/article/details/103219499" target="_blank" rel="noopener">https://blog.csdn.net/GiveMe5G/article/details/103219499</a><br>博客：<a href="https://blog.csdn.net/GiveMe5G/article/details/103413805" target="_blank" rel="noopener">https://blog.csdn.net/GiveMe5G/article/details/103413805</a><br>博客：<a href="https://blog.csdn.net/GiveMe5G/article/details/103606304" target="_blank" rel="noopener">https://blog.csdn.net/GiveMe5G/article/details/103606304</a><br>博客：<a href="https://blog.csdn.net/GiveMe5G/article/details/103847118" target="_blank" rel="noopener">https://blog.csdn.net/GiveMe5G/article/details/103847118</a></p></blockquote></div><div><div><br><br><div style="text-align:center;color:#ccc;font-size:14px">----------- 本文结束 -----------</div><br><br><br><br></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/PRACH/" rel="tag"><i class="fa fa-tag">PRACH</i></a> <a href="/tags/%E9%9A%8F%E6%9C%BA%E6%8E%A5%E5%85%A5/" rel="tag"><i class="fa fa-tag">随机接入</i></a></div><div class="post-widgets"><div id="needsharebutton-postbottom"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/" rel="next" title="5G-NR-PDSCH学习"><i class="fa fa-chevron-left"></i> 5G-NR-PDSCH学习</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PUCCH%E5%AD%A6%E4%B9%A0/" rel="prev" title="5G-NR-PUCCH学习">5G-NR-PUCCH学习 <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"></div></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/"><img class="site-author-image" itemprop="image" src="/images/logo.jpg" alt="从之丶"></a><p class="site-author-name" itemprop="name">从之丶</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/%7C%7C%20archive"><span class="site-state-item-count">23</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">6</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">24</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/czGitAccount" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:caoz326@163.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-block"><div class="links-of-blogroll-title"><i class="fa fa-history fa-" aria-hidden="true"></i> 近期文章</div><ul class="links-of-blogroll-list"><li class="recent_posts_li"><a href="/Data_Structure_and_Algorithm/%E5%89%91%E6%8C%87offer/%E6%90%9C%E7%B4%A2%E4%B8%8E%E5%9B%9E%E6%BA%AF%E7%AE%97%E6%B3%95/" title="剑指offer -- 搜索与回溯算法" target="_blank">剑指offer -- 搜索与回溯算法</a></li><li class="recent_posts_li"><a href="/Data_Structure_and_Algorithm/%E5%89%91%E6%8C%87offer/%E6%8E%92%E5%BA%8F/" title="剑指offer -- 排序" target="_blank">剑指offer -- 排序</a></li><li class="recent_posts_li"><a href="/Data_Structure_and_Algorithm/%E5%89%91%E6%8C%87offer/%E4%BD%8D%E8%BF%90%E7%AE%97/" title="剑指offer -- 位运算" target="_blank">剑指offer -- 位运算</a></li><li class="recent_posts_li"><a href="/Data_Structure_and_Algorithm/%E5%89%91%E6%8C%87offer/%E6%A8%A1%E6%8B%9F/" title="剑指offer -- 模拟" target="_blank">剑指offer -- 模拟</a></li><li class="recent_posts_li"><a href="/Complie_and_Debug/GDB%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" title="GDB 常用命令" target="_blank">GDB 常用命令</a></li></ul></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-PRACH-信道"><span class="nav-text">1 PRACH 信道</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-PRACH-preamble-生成"><span class="nav-text">1.1 PRACH preamble 生成</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-PRACH-preamble-格式"><span class="nav-text">1.2 PRACH preamble 格式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-映射到物理资源"><span class="nav-text">1.3 映射到物理资源</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-1-时域资源映射"><span class="nav-text">1.3.1 时域资源映射</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-2-频域资源映射"><span class="nav-text">1.3.2 频域资源映射</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-4-SSB和RACH信道配置"><span class="nav-text">1.4 SSB和RACH信道配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-1-概述"><span class="nav-text">1.4.1 概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-2-SSB与RO映射顺序"><span class="nav-text">1.4.2 SSB与RO映射顺序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-3-SSB-和-RACH-映射周期"><span class="nav-text">1.4.3 SSB 和 RACH 映射周期</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-随机接入过程"><span class="nav-text">2 随机接入过程</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-概述"><span class="nav-text">2.1 概述</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-1-随机接入触发场景"><span class="nav-text">2.1.1 随机接入触发场景</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-2-随机接入流程"><span class="nav-text">2.1.2 随机接入流程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-Msg1"><span class="nav-text">2.2 Msg1</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-1-Msg1的发射功率"><span class="nav-text">2.2.1 Msg1的发射功率</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-2-RA-RNTI的计算和使用"><span class="nav-text">2.2.2 RA-RNTI的计算和使用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-Msg2"><span class="nav-text">2.2 Msg2</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-1-UE接收Msg2"><span class="nav-text">2.2.1 UE接收Msg2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-2-Msg2内容"><span class="nav-text">2.2.2 Msg2内容</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-Msg3"><span class="nav-text">2.3 Msg3</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-1-Msg3的传输内容"><span class="nav-text">2.3.1 Msg3的传输内容</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-2-Msg3的发送时刻"><span class="nav-text">2.3.2 Msg3的发送时刻</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-4-Msg4"><span class="nav-text">2.4 Msg4</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-5-HARQ-ACK-for-Msg4"><span class="nav-text">2.5 HARQ ACK for Msg4</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-6-流程时序图总结"><span class="nav-text">2.6 流程时序图总结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-扩展"><span class="nav-text">3 扩展</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-RACH触发类型-场景-分类"><span class="nav-text">3.1 RACH触发类型(场景)分类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-PDCCH-Order-RACH"><span class="nav-text">3.2 PDCCH Order RACH</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-Beam-Failure-Recovery-RACH"><span class="nav-text">3.3 Beam Failure Recovery RACH</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-4-OSI-Other-System-Information-Request-RACH"><span class="nav-text">3.4 OSI (Other System Information) Request RACH</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#附录"><span class="nav-text">附录</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#附录A-相关表格"><span class="nav-text">附录A 相关表格</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#附录B-相关配置"><span class="nav-text">附录B 相关配置</span></a></li></ol></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">从之丶</span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script><i id="darkmode" class="fa fa-lightbulb-o" aria-hidden="true"></i><script>var body=$("body"),darkmode=$("#darkmode");(matchMedia("(prefers-color-scheme: dark)").matches||"1"===localStorage.getItem("darkmode"))&&"1"!==localStorage.getItem("noDark")&&body.addClass("dark"),body.hasClass("dark")?darkmode.removeClass("fa-moon-o").addClass("fa-lightbulb-o"):darkmode.removeClass("fa-lightbulb-o").addClass("fa-moon-o"),darkmode.click(function(){body.hasClass("dark")?(darkmode.removeClass("fa-lightbulb-o").addClass("fa-moon-o"),body.removeClass("dark"),localStorage.setItem("darkmode","0"),localStorage.setItem("noDark","1")):(darkmode.removeClass("fa-moon-o").addClass("fa-lightbulb-o"),body.addClass("dark"),localStorage.setItem("darkmode","1"),localStorage.setItem("noDark","0"))})</script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/clipboard.min.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/highlight-wrap.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")},searchFunc=function(t,e,o){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var n=isXml?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,r=document.getElementById(e),s=document.getElementById(o),a=function(){var t=r.value.trim().toLowerCase(),e=t.split(/[\s\-]+/);e.length>1&&e.push(t);var o=[];if(t.length>0&&n.forEach(function(n){function r(e,o,n,r){for(var s=r[r.length-1],a=s.position,i=s.word,l=[],h=0;a+i.length<=n&&0!=r.length;){i===t&&h++,l.push({position:a,length:i.length});var p=a+i.length;for(r.pop();0!=r.length&&(s=r[r.length-1],a=s.position,i=s.word,p>a);)r.pop()}return c+=h,{hits:l,start:o,end:n,searchTextCount:h}}function s(t,e){var o="",n=e.start;return e.hits.forEach(function(e){o+=t.substring(n,e.position);var r=e.position+e.length;o+='<b class="search-keyword">'+t.substring(e.position,r)+"</b>",n=r}),o+=t.substring(n,e.end)}var a=!1,i=0,c=0,l=n.title.trim(),h=l.toLowerCase(),p=n.content.trim().replace(/<[^>]+>/g,""),u=p.toLowerCase(),f=decodeURIComponent(n.url),d=[],g=[];if(""!=l&&(e.forEach(function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());(s=e.indexOf(t,r))>-1;)a.push({position:s,word:t}),r=s+n;return a}d=d.concat(e(t,h,!1)),g=g.concat(e(t,u,!1))}),(d.length>0||g.length>0)&&(a=!0,i=d.length+g.length)),a){[d,g].forEach(function(t){t.sort(function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length})});var v=[];0!=d.length&&v.push(r(l,0,l.length,d));for(var $=[];0!=g.length;){var C=g[g.length-1],m=C.position,x=C.word,w=m-20,y=m+80;0>w&&(w=0),y<m+x.length&&(y=m+x.length),y>p.length&&(y=p.length),$.push(r(p,w,y,g))}$.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start});var T=parseInt("1");T>=0&&($=$.slice(0,T));var b="";b+=0!=v.length?"<li><a href='"+f+"' class='search-result-title'>"+s(l,v[0])+"</a>":"<li><a href='"+f+"' class='search-result-title'>"+l+"</a>",$.forEach(function(t){b+="<a href='"+f+'\'><p class="search-result">'+s(p,t)+"...</p></a>"}),b+="</li>",o.push({item:b,searchTextCount:c,hitCount:i,id:o.length})}}),1===e.length&&""===e[0])s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>';else if(0===o.length)s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>';else{o.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id});var a='<ul class="search-result-list">';o.forEach(function(t){a+=t.item}),a+="</ul>",s.innerHTML=a}};r.addEventListener("input",a),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(t){t.stopPropagation(),isfetched===!1?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(t){t.stopPropagation()}),$(document).on("keyup",function(t){var e=27===t.which&&$(".search-popup").is(":visible");e&&onPopupClose()})</script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={},pbOptions.iconStyle="box",pbOptions.boxForm="horizontal",pbOptions.position="bottomCenter",pbOptions.networks="Weibo,Wechat,Douban,QQZone,Twitter,Facebook",new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={},flOptions.iconStyle="box",flOptions.boxForm="horizontal",flOptions.position="middleRight",flOptions.networks="Weibo,Wechat,Douban,QQZone,Twitter,Facebook",new needShareButton("#needsharebutton-float",flOptions)</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });</script><script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"left","width":200,"height":270},"mobile":{"show":false},"log":false});</script></body></html><!-- rebuild by neat -->