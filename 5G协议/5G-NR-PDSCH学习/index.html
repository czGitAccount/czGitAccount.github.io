<!-- build time:Fri May 14 2021 16:14:01 GMT+0800 (GMT+08:00) --><!DOCTYPE html><html class="theme-next muse use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link href="/lib/pace/pace-theme-bounce.min.css?v=1.0.2" rel="stylesheet"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.jpg?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="PDSCH,"><meta property="og:type" content="article"><meta property="og:title" content="5G-NR-PDSCH学习"><meta property="og:url" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/index.html"><meta property="og:site_name" content="CongZ&#39;s Blog"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/non-interleave.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/interleaver1.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/interleave2.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/interleave3.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/case1.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/case2.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/case31.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/case32.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/DMRS-DLconfig.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/DMRS%E9%A2%91%E5%9F%9F%E5%88%86%E6%9E%901.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/DMRS%E9%A2%91%E5%9F%9F%E5%88%86%E6%9E%902.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/Table5.1.2.1-1.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/DMRS%E6%97%B6%E5%9F%9F1.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/DMRS%E6%97%B6%E5%9F%9F2.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/%E6%B7%BB%E5%8A%A0%E5%AF%BC%E9%A2%91%E5%8D%95%E7%AC%A6%E5%8F%B7.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/%E6%B7%BB%E5%8A%A0%E5%AF%BC%E9%A2%91%E5%8F%8C%E7%AC%A6%E5%8F%B7.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/%E6%B7%BB%E5%8A%A0%E5%AF%BC%E9%A2%91%E4%BE%8B%E5%AD%90.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/Table7.4.1.1.2-12.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/Table7.4.1.1.2-5.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/PTRS.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/PTRS%E5%8F%82%E6%95%B0.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/PTRS%E6%97%B6%E5%9F%9F%E5%9B%BE.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/%E9%A2%91%E5%9F%9F%E7%B4%A2%E5%BC%95.png"><meta property="og:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/PTRS%E9%A2%91%E5%9F%9F%E5%9B%BE.png"><meta property="article:published_time" content="2020-03-15T08:09:28.000Z"><meta property="article:modified_time" content="2021-05-05T14:39:47.000Z"><meta property="article:author" content="从之丶"><meta property="article:tag" content="PDSCH"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://czgitaccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/non-interleave.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Muse",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:"ture",onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="https://czGitAccount.github.io/5G协议/5G-NR-PDSCH学习/"><title>5G-NR-PDSCH学习 | CongZ's Blog</title><meta name="generator" content="Hexo 4.2.0"></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">CongZ's Blog</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">择其善者而从之，其不善者而改之 !</p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://czGitAccount.github.io/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="从之丶"><meta itemprop="description" content=""><meta itemprop="image" content="/images/logo.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="CongZ's Blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">5G-NR-PDSCH学习</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-03-15T16:09:28+08:00">2020-03-15 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/5G%E5%8D%8F%E8%AE%AE/" itemprop="url" rel="index"><span itemprop="name">5G协议</span></a></span></span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">4.7k </span><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">21</span></div></div></header><div class="post-body" itemprop="articleBody"><div class="out-img-topic"><img src="/5G协议/5G-NR-PDSCH学习/你的名字01.png" class="img-topic"></div><div class="post-button text-center"><div>《你的名字》</div></div><a id="more"></a><h1 id="1-PDSCH-物理流程"><a href="#1-PDSCH-物理流程" class="headerlink" title="1 PDSCH 物理流程"></a>1 PDSCH 物理流程</h1><h2 id="1-1-加扰"><a href="#1-1-加扰" class="headerlink" title="1.1 加扰"></a>1.1 加扰</h2><p>双码字传输时，$q \in \{0,1\}$；单码字传输时，$q = 0$。[TS 38.211 7.3.1.1]<br>每一个码字对应的原始数据 $b^{(q)}(0),…,b^{(q)}(M_{bit}^{(q)}-1)$ ,经过加扰处理生成加扰后的数据为 $\widetilde b^{(q)}(0),…,\widetilde b^{(q)}(M_{bit}^{(q)}-1)$ 。加扰处理如下所示：</p><script type="math/tex;mode=display">\widetilde b^{(q)}(i) = (b^{(q)}(i) + c^{(q)}(i))mod2</script><p>加扰序列是一个伪随机序列，由[TS 38.211 5.2.1]给出，加扰序列的初始为：</p><script type="math/tex;mode=display">C_{init} = n_{RNTI}\cdot2^{15}+q\cdot2^{14}+n_{ID}</script><p>其中：</p><ul><li>$n_{ID}$ = dataScramblingIdentityPDSCH(如果配置)，并且RNTI = C-RNTI or CS-RNTI，在公共搜索空间中不使用DCI格式1_0调度传输。</li><li>除此之外 $n_{ID} = N_{ID}^{cell}$</li><li>$n_{RNTI}$ 就是PDSCH当前传输时相关联的RNTI</li></ul><h2 id="1-2-调制"><a href="#1-2-调制" class="headerlink" title="1.2 调制"></a>1.2 调制</h2><p>每一个码字加扰后的比特块 $\widetilde b^{(q)}(0),…,\widetilde b^{(q)}(M_{bit}^{(q)}-1)$ 采用下表中的一种调制方式进行调制，得到一个复值调制符号块$d^{(q)}(0),…,d^{(q)}(M_{symb}^{(q)}-1)$。[TS 38.211 7.3.1.2]</p><table><tr><td><center>Modulation scheme</center></td><td><center>Modulation order</center></td></tr><tr><td><center>QPSK</center></td><td><center>2</center></td></tr><tr><td><center>16QAM</center></td><td><center>4</center></td></tr><tr><td><center>64QAM</center></td><td><center>6</center></td></tr><tr><td><center>256QAM</center></td><td><center>8</center></td></tr></table><h2 id="1-3-层映射"><a href="#1-3-层映射" class="headerlink" title="1.3 层映射"></a>1.3 层映射</h2><p>每一个码字生成的调制信号 $d^{(q)}(0),…,d^{(q)}(M_{symb}^{(q)}-1)$ 根据下表映射到多个层$x(i)=[x^0{i} \cdots x^{v-1}(i)]^T$，$i = 0,1,…,M_{symb}^{layer}-1$，其中$v$表示层数，$M_{symb}^{layer}$ 表示每层调制符号的数量。[TS 38.211 7.3.1.3]</p><div class="table-container"><table><thead><tr><th style="text-align:center">层数</th><th style="text-align:center">码字数</th><th>码字到层映射<br>$i = 0,1,…,M_{symb}^{layer}-1$</th></tr></thead><tbody><tr><td style="text-align:center">1</td><td style="text-align:center">1</td><td>$x^{(0)}(i) = d^{(0)}(i)$ $M_{symb}^{layer} = M_{symb}^{(0)}$</td></tr><tr><td style="text-align:center">2</td><td style="text-align:center">1</td><td>$x^{(0)}(i) = d^{(0)}(2i)$<br>$x^{(1)}(i) = d^{(0)}(2i+1)$ $M_{symb}^{layer} = M_{symb}^{(0)}/2$</td></tr><tr><td style="text-align:center">3</td><td style="text-align:center">1</td><td>$x^{(0)}(i) = d^{(0)}(3i)$<br>$x^{(1)}(i) = d^{(0)}(3i+1)$ $M_{symb}^{layer} = M_{symb}^{(0)}/3$<br>$x^{(2)}(i) = d^{(0)}(3i+2)$</td></tr><tr><td style="text-align:center">4</td><td style="text-align:center">1</td><td>$x^{(0)}(i) = d^{(0)}(4i)$<br>$x^{(1)}(i) = d^{(0)}(4i+1)$<br>$x^{(2)}(i) = d^{(0)}(4i+2)$ $M_{symb}^{layer} = M_{symb}^{(0)}/4$<br>$x^{(3)}(i) = d^{(0)}(4i+3)$</td></tr><tr><td style="text-align:center">5</td><td style="text-align:center">2</td><td>$x^{(0)}(i) = d^{(0)}(2i)$<br>$x^{(1)}(i) = d^{(0)}(2i+1)$<br>$x^{(2)}(i) = d^{(1)}(3i)$ $M_{symb}^{layer} = M_{symb}^{(0)}/2 = M_{symb}^{(1)}/3$<br>$x^{(3)}(i) = d^{(1)}(3i+1)$<br>$x^{(4)}(i) = d^{(1)}(3i+2)$</td></tr><tr><td style="text-align:center">6</td><td style="text-align:center">2</td><td>$x^{(0)}(i) = d^{(0)}(3i)$<br>$x^{(1)}(i) = d^{(0)}(3i+1)$<br>$x^{(2)}(i) = d^{(0)}(3i+2)$<br>$x^{(3)}(i) = d^{(1)}(3i)$ $M_{symb}^{layer} = M_{symb}^{(0)}/3 = M_{symb}^{(1)}/3$<br>$x^{(4)}(i) = d^{(1)}(3i+1)$<br>$x^{(5)}(i) = d^{(1)}(3i+2)$</td></tr><tr><td style="text-align:center">7</td><td style="text-align:center">2</td><td>$x^{(0)}(i) = d^{(0)}(3i)$<br>$x^{(1)}(i) = d^{(0)}(3i+1)$<br>$x^{(2)}(i) = d^{(0)}(3i+2)$<br>$x^{(3)}(i) = d^{(1)}(4i)$ $M_{symb}^{layer} = M_{symb}^{(0)}/3 = M_{symb}^{(1)}/4$<br>$x^{(4)}(i) = d^{(1)}(4i+1)$<br>$x^{(5)}(i) = d^{(1)}(4i+2)$<br>$x^{(6)}(i)=d^{(1)}(4i+3)$</td></tr><tr><td style="text-align:center">8</td><td style="text-align:center">2</td><td>$x^{(0)}(i) = d^{(0)}(4i)$<br>$x^{(1)}(i) = d^{(0)}(4i+1)$<br>$x^{(2)}(i) = d^{(0)}(4i+2)$<br>$x^{(3)}(i)=d^{(0)}(4i+3)$<br>$x^{(4)}(i) = d^{(1)}(4i)$ $M_{symb}^{layer} = M_{symb}^{(0)}/4 = M_{symb}^{(1)}/4$<br>$x^{(5)}(i) = d^{(1)}(4i+1)$<br>$x^{(6)}(i) = d^{(1)}(4i+2)$<br>$x^{(7)}(i)=d^{(1)}(4i+3)$</td></tr></tbody></table></div><p>可以看到，单码字映射到1-4层，双码字映射到5-8层。</p><h2 id="1-4-天线端口映射"><a href="#1-4-天线端口映射" class="headerlink" title="1.4 天线端口映射"></a>1.4 天线端口映射</h2><p>经过层映射之后的数据按照如下方式映射到天线端口。[TS 38.211 7.3.1.4]</p><script type="math/tex;mode=display">\left[
\begin{matrix}
y^{(p_0)}(i)\\
\vdots\\
y^{(p_{v-1})}(i)\\
\end{matrix}
\right]= \left[
\begin{matrix}
x^{(0)}(i)\\
\vdots\\
x^{(v-1)}(i)
\end{matrix}
\right]</script><p>其中 $i=0,1,…,M_{symb}^{ap}-1$，$M_{symb}^{ap}=M_{symb}^{layer}$</p><h2 id="1-5-映射到虚拟资源快"><a href="#1-5-映射到虚拟资源快" class="headerlink" title="1.5 映射到虚拟资源快"></a>1.5 映射到虚拟资源快</h2><p>对于每个天线步骤，都会创建一个虚拟资源网格。在资源网格内，从RE的最低频率到较高频率的来自来填充PDSCH数据到每个RE中。一旦它以分配的PDSCH资源块的最高频率到达RE，则移至下一个OFDM符号的最低频率的RE。[TS 38.211 7.3.1.5]<br>但不应使用为以下目的而分配的RE：</p><ul><li>分配给与要发送的PDSCH相关的DMRS的RE</li><li>为DMRS分配给用于其他共同调度UE的RE</li><li>非零功率CSI-RS的RE，由MeasObjectNR IE中较高层参数CSI-RS-Resource-Mobility配置的非零功率CSI-RS除外。</li><li>PTRS的RE</li><li>声明为“不适用于PDSCH的RE”</li></ul><h2 id="1-6-从虚拟资源块映射到物理资源块"><a href="#1-6-从虚拟资源块映射到物理资源块" class="headerlink" title="1.6 从虚拟资源块映射到物理资源块"></a>1.6 从虚拟资源块映射到物理资源块</h2><p>从VRB到PRB的映射有交织和非交织两种。[TS 38.211 7.3.1.6]</p><h3 id="1-6-1-非交织"><a href="#1-6-1-非交织" class="headerlink" title="1.6.1 非交织"></a>1.6.1 非交织</h3><p>在公共搜索空间用DCI Format 1_0调度的PDSCH传输这种情况下,虚拟资源块$n$映射到物理资源块 $n + N_{start}^{CORESET}$ 上，其中$N_{start}^{CORESET}$是接受相应DCI的控制资源集中编号最小的物理资源块；<br>除此情况之外，虚拟资源块$n$就映射到物理资源块$n$上。<br>如下图所示：</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/non-interleave.png" alt></p><h3 id="1-6-2-交织"><a href="#1-6-2-交织" class="headerlink" title="1.6.2 交织"></a>1.6.2 交织</h3><p>交织映射模式，以资源块束(RB bundle)来定义，与PDCCH的RB bundle 相比PDSCH的资源块束有些不同，主要分三种情况：<br><strong>类型一</strong>：<br>在CORESET#0的Type0-PDCCH公共搜索空间，由SI-RNTI加扰，用DCI Format 1_0 调度的PDSCH传输。<br>下行初始激活的BWP，大小$N_{BWP,init}^{size}$，分为$N_{bundle} = \lceil N_{BWP,init}^{size}/L \rceil$ 个RB bundle，按照RB编号和束编号升序排序。其中$L$是bundle的大小，取值为２。如果$N_{BWP,init}^{size}$不能整数L，最后一个RB bundle包含 $N_{BWP,init}^{size}modL$个RB，其实由于$L = 2$所以最后一个不能整数的话那就剩下一个RB，能整数除最后一个RB bundle就是2个RB。<br>如下图所示：<br><br><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/interleaver1.png" alt></p><p><strong>类型二</strong>：<br>除上述情况外，在公共搜索空间由DCI Format 1_0调度的PDSCH传输。<br>BWP起始位置$N_{BWP,i}^{start}$，大小为$N_{BWP,init}^{size}$ 的VRB集合$\{0,1,…,N_{BWP,init}^{size}-1\}$ 分为$N_{bundle}$ 个虚拟RB bundle，相应的$N_{BWP,init}^{size}$ 个PRB集合$\{N_{start}^{CORESET},N_{start}^{CORESET}+1,…,N_{start}^{CORESET}+N_{BWP,init}^{size}\}$ 分为$N_{bundle}$ 个物理RB bundle，其中$N_{bundle}=\lceil (N_{BWP,init}^{size}+(N_{BWP.i}^{start}+N_{start}^{CORESET})modL)/L \rceil$ ，L是bundle的大小，取值为2，$N_{start}^{CORESET}$是接受相应DCI的控制资源集中编号最小的物理资源块。</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/interleave2.png" alt></p><p>其RB bundle 包含的RB数如下描述：</p><ul><li>0号RB bundle 包含了$L-((N_{BWP,i}^{start}+N_{start}^{CONRESET})modL)$个RB；</li><li>如果$(N_{BWP,init}^{size}+N_{BWP,i}^{start}+N_{start}^{CONRESET})modL&gt;0$，则最后一个RB bundle包含了$(N_{BWP,init}^{size}+N_{BWP,i}^{start}+N_{start}^{CONRESET})modL$ 个RB，否则包含$L$个RB；</li><li>其余RB bundle 包含$L$ 个RB；<br>之所以要考虑进$N_{start}^{CONRESET}$，是因为38.214中规定，对于任何在PDCCH公共搜索空间中以DCI format 1_0调度的PDSCH传输，其RB编号从接受DCI的CORESET的最低RB开始。</li></ul><p><strong>类型三</strong>：<br>其他PDSCH传输。<br>BWP，i的起始位置$N_{BWP,i}^{start}$，大小$N_{BWP,i}^{size}$，分为$N_{bundle}$ 个RB bundle 且按照RB编号和束编号的升序排列，其中$N_bundle = \lceil(N_{BWP,init}^{size}+(N_{BWP,i}^{start}modL_i))/L_i \rceil$，$L_i$ 是bundle的大小，由高层参数vrb- ToPRB-Interleaver配置。<br><br><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/interleave3.png" alt></p><p>其RB bundle 包含的RB数如下描述：</p><ul><li>0号RB bundle包含了$L_i-(N_{BWP,i}^{start}modL_i)$个RB，目的是为了从下一个bundle开始，每个bundle的起始位置都是$L_i $的整数倍；</li><li>如果$(N_{BWP,i}^{start}+N_{BWP,i}^{size})modL_i&gt;0$，最后一个RB bundle包含了$(N_{BWP,i}^{start}+N_{BWP,i}^{size})modL_i$ 个RB，否则包含$L_i$ 个RB；</li><li>其余RB bundle 包含$L_i$ 个RB。</li></ul><p>举个例子来描述类型三：<br>例子：假设$N_{BWP,i}^{start} = 5,N_{BWP,i}^{size} = 21$<br>1) $L_i=5$<br>$N_{bundle} = \lceil(N_{BWP,init}^{size}+(N_{BWP,i}^{start}modL_i))/L_i \rceil = \lceil(21+(5mod5))/5 \rceil = 5$<br>$N_{bundle,0} = L_i-(N_{BWP,i}^{start}modL_i) = 5-(5mod5) =5$<br>$N_{bundle,end} = (N_{BWP,i}^{start}+N_{BWP,i}^{size})modL_i = (5+21)mod5 = 1$<br>$N_{bundle,other} = L_i = 5$<br>如下图所示：</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/case1.png" alt></p><p>2) $L_i=4$<br>$N_bundle = \lceil(N_{BWP,init}^{size}+(N_{BWP,i}^{start}modL_i))/L_i \rceil = \lceil(21+(5mod4))/4 \rceil = 6$<br>$N_{bundle,0} = L_i-(N_{BWP,i}^{start}modL_i) = 4-(5mod4) =3$<br>$N_{bundle,end} = (N_{BWP,i}^{start}+N_{BWP,i}^{size})modL_i = (5+21)mod4 = 2$<br>$N_{bundle,other} = L_i = 4$<br>如下图所示：</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/case2.png" alt></p><h3 id="1-6-3-VRB-bundle-到-PRB-bundle-的映射"><a href="#1-6-3-VRB-bundle-到-PRB-bundle-的映射" class="headerlink" title="1.6.3 VRB bundle 到 PRB bundle 的映射"></a>1.6.3 VRB bundle 到 PRB bundle 的映射</h3><p>本节来看属于$j\in \{0,1,…,N_{bundle}-1\}$ 区间内的虚拟RB向物理RB的映射：</p><ul><li>$N_bundle - 1$号虚拟RB bundle映射到$N_{bundle}-1$号物理RB bundle；</li><li>其余$j\in \{0,1,…,N_{bundle}-2\}$ 的虚拟RB bundle 遵循$f(j)$ 函数映射到物理RB bundle<script type="math/tex;mode=display">f(j) = rC+c\\j = cR+r\\r = 0,1,...,R-1\\c = 0,1,...,C-1\\R = 2\\C = \lfloor N_{bundle}/R \rfloor</script></li></ul><p>举个例子说明，运用上面的例子数据:<br>1) $R = 2; \quad C = \lfloor N_{bundle}/R \rfloor = \lfloor 5/2 \rfloor = 2;\quad r = 0,1,2;\quad c = 0,1,2$。</p><div class="table-container"><table><thead><tr><th>c</th><th>r</th><th>j: VRB bundle</th><th>$f(j)$: PRB bundle</th></tr></thead><tbody><tr><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><td>0</td><td>1</td><td>1</td><td>2</td></tr><tr><td>1</td><td>0</td><td>2</td><td>1</td></tr><tr><td>1</td><td>1</td><td>3</td><td>3</td></tr></tbody></table></div><p>映射结果如图所示：</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/case31.png" alt></p><p>2) $R = 2; \quad C = \lfloor N_{bundle}/R \rfloor = \lfloor 6/2 \rfloor = 3;\quad r = 0,1;\quad c = 0,1,2$。</p><div class="table-container"><table><thead><tr><th>c</th><th>r</th><th>j: VRB bundle</th><th>$f(j)$: PRB bundle</th></tr></thead><tbody><tr><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><td>0</td><td>1</td><td>1</td><td>3</td></tr><tr><td>1</td><td>0</td><td>2</td><td>1</td></tr><tr><td>1</td><td>1</td><td>3</td><td>4</td></tr><tr><td>2</td><td>0</td><td>4</td><td>2</td></tr><tr><td>2</td><td>1</td><td>5</td><td>5</td></tr></tbody></table></div><p>映射结果如下图所示：</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/case32.png" alt></p><h1 id="2-PDSCH-DMRS"><a href="#2-PDSCH-DMRS" class="headerlink" title="2 PDSCH DMRS"></a>2 PDSCH DMRS</h1><h2 id="2-1-序列生成"><a href="#2-1-序列生成" class="headerlink" title="2.1 序列生成"></a>2.1 序列生成</h2><p>PDSCH DMRS序列有如下公式生成：</p><script type="math/tex;mode=display">r(n) = \frac{1}{\sqrt{2}}(1-2\cdot c(2n))+j\frac{1}{\sqrt{2}}(1-2\cdot c(2n+1))</script><p>加扰序列采用31阶Gold序列生成，加扰序列的初始序列$c_{init}$如下式所示:</p><script type="math/tex;mode=display">c_{init} = (2^{17}(N_{symb}^{slot}n_{s,f}^{\mu}+l+1)(2N_{ID}^{n_{SCID}}+1)+2N_{ID}^{n_{SCID}}+n_{SCID})mod2^{31}</script><p>其中：</p><ul><li>$l$ 为时隙中的符号索引</li><li>$n_{s,f}$ 为时隙索引</li><li>$N_{symb}^{slot}$ 为一个时隙内的符号数量</li><li>$n_{SCID},N_{ID}^{n_{SCID}}$ :<br><strong>1) 对于C-RNTI/MCS-C-RNTI/CS-RNTI</strong><br>① DCI format 1_1 , $n_{SCID}$ 可由DMRS-DownlinkConfig IE中scramblingID0,scramblingID1配置,可以在$N_{ID}^0,N_{ID}^1$之间选择,$N_{ID}^{0},N_{ID}^{1}\in \{0,1,…,65535\}$。<br>② DCI format 1_1 , $n_{SCID}$ 可由DMRS-DownlinkConfig IE中scramblingID0配置,可以在$N_{ID}^0$之间选择,$N_{ID}^{0}\in \{0,1,…,65535\}$。<br>③ 如果①DMRS-DownlinkConfig IE中scramblingID0,scramblingID1都未配置,则$n_{SCID}=0,N_{ID}^{n_{SCID}}=N_{ID}^{cell}$。<br>④ 如果②DMRS-DownlinkConfig IE中scramblingID0未配置，则$n_{SCID}=0,N_{ID}^{n_{SCID}}=N_{ID}^{cell}$。<br><strong>２) 对于SI-RNTI/P-RNTI/RA-RNTI</strong><br>$n_{SCID}=0,N_{ID}^{n_{SCID}}=N_{ID}^{cell}$。</li></ul><p>高层配置参数DMRS-DownlinkConfig内容如下：</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/DMRS-DLconfig.png" alt></p><h2 id="2-2-PDSCH-DMRS-频域位置"><a href="#2-2-PDSCH-DMRS-频域位置" class="headerlink" title="2.2 PDSCH DMRS 频域位置"></a>2.2 PDSCH DMRS 频域位置</h2><p>DMRS映射方式分为Configuration type 1 和configuration type 2 两种，有DMRS-DownlinkConfig中的drms-type指示，如果未配置，则默认为Configuration type 1。<br>序列映射到RE的公式如下所示：</p><script type="math/tex;mode=display">\alpha_{k,l}^{p,\mu}=\beta_{PDSCH}^{DMRS}w_f(k')w_t(l')r(2n+k')\\k = \begin{cases}4n+2k'+\Delta \quad \quad Configuration\quad type\quad1\\6n+k'+\Delta\quad \quad Configuration\quad type\quad 2 \end{cases}\\k'=0,1\\l=\overline{l}+l'\\n = 0,1,...</script><p>$k$为频域指示，$l$为时域指示。Configuration type 1 和configuration type 2，分别用于支持单用户MIMO和多用户MIMO。除此之外，由于类型1和类型2平均每个端口占用的RE数量不同，即每个端口的RE密度不同，所以各自有不同的适用场景。类型1更适合低信噪比、频域选择性较高的场景，类型2更适合高信噪比、时延扩展较小的场景。</p><p>频域指示$k$的参考点分两种情况：</p><ul><li>承载SIB1的PDSCH的DMRS，$k$的参考点为CORESET#0的RE0；</li><li>其余情况参考点为CRB#0的RE0即point A。</li></ul><p>以下图示分别展示了Configuration type 1 和configuration type 2两种情况下的DMRS频域位置，为了方便只选取了1RB左右大小，都是single symbol。<br>Configuration type 1：</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/DMRS频域分析1.png" alt></p><p></p><p>Configuration type 2:</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/DMRS频域分析2.png" alt></p><h2 id="2-3-PDSCH-DMRS-的符号位置"><a href="#2-3-PDSCH-DMRS-的符号位置" class="headerlink" title="2.3 PDSCH DMRS 的符号位置"></a>2.3 PDSCH DMRS 的符号位置</h2><p>DMRS的符号位置取决于PDSCH的mapping type，分为mapping type A和mapping type B，参考表格或者配置可以获得PDSCH的mapping type，以及对应的$k_0,S,L$。[TS 38.214 5.1.2.1]<br><br><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/Table5.1.2.1-1.png" alt><br><br>时域指示$l$的参考点分两种情况：</p><ul><li>PDSCH mapping type A：时域指示$l$的参考点为时隙的起始symbol，且DM-RS的第一个符号位置为3或4(表中S = 2，3)，由MIB中参数dmrs-TypeA-Position指示，主要考虑PDCCH的具体配置。</li><li>PDSCH mapping type B时，$l$的参考点为PDSCH的起始symbol，DM-RS从PDSCH调度区域的第一个符号开始传输。<br>两种情况如下图所示：<br>例子一：type A，$S = 3 , L = 7$, $l_0$ 的大小是与参考点的差值，表示DMRS的初始符号。</li></ul><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/DMRS时域1.png" alt></p><p>例子二：type B，$S = 6 , L = 4$, $l_0$ 的大小是与参考点的差值，表示DMRS的初始符号。</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/DMRS时域2.png" alt></p><h2 id="2-4-DMRS-符号类型"><a href="#2-4-DMRS-符号类型" class="headerlink" title="2.4 DMRS 符号类型"></a>2.4 DMRS 符号类型</h2><p>DMRS两个symbol类型，single symbol 和 double symbol。取决于DMRS-DownlinkConfig中的maxLength参数的配置，maxLength配置为len1，则取值为len1（single-symbol）；如果配置为len2（double-symbol）。如果高层参数maxLength没有配置，则为single类型。</p><h2 id="2-5-添加导频"><a href="#2-5-添加导频" class="headerlink" title="2.5 添加导频"></a>2.5 添加导频</h2><p>在NR中的中/高速场景中，为了保证估计精度，除了前置导频(前文所描述的DMRS)外，加入了与前置导频TDM的附加导频，附加DM-RS结构与前置DM-RS的图样相同，在double symbol DM-RS情况下，最多可以配置1组附加导频，在single symbol前置DM-RS情况下最多可以配置3组附加导频。附加导频的数量与调度时长有关，时域位置由高层参数dmrs-AdditionalPosition指示,如下表所示：</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/添加导频单符号.png" alt></p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/添加导频双符号.png" alt></p><p>当PDSCH mapping type B时，如果PDSCH的资源和CORESET相重叠，则PDSCH DM-RS要往后顺延到紧挨CORESET的后面，此时，如果PDSCH的duration为2时，DM-RS的起始位置不能超过PDSCH的第二个symbol，当PDSCH的duration为4时，DM-RS的起始位置不能超过PDSCH的第3个symbol，当PDSCH的duration为7时，DM-RS的第一个symbol不能超过PDSCH的第4个symbol。<br>(Note: 以上所说的PDSCH的duration，也就是$L$，同时也是$l_d$ ，都是一个意思)<br><br>举个例子来说明上面两个表的意思：<br>$S = 2,L=11$,maxLength配置为len1，即为single symbol ,按照第一个 表格，如果此时$l_d = 11$ PDSCH mapping type A , dmrs-AdditionalPosition指示为2，则代表在DMRS导频位置分别在DMRS初始位置$l_0$(若为$l_0=2$),#6,#9符号上。如下图所示：</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/添加导频例子.png" alt></p><h2 id="2-6-端口映射"><a href="#2-6-端口映射" class="headerlink" title="2.6 端口映射"></a>2.6 端口映射</h2><p>结合PDSCH DMRS序列生成及映射公式，以及下表可知：</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/Table7.4.1.1.2-12.png" alt></p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/Table7.4.1.1.2-5.png" alt></p><ul><li>type 1，single symbol情况下，最多支持4个端口，端口0，1和2，3分别在不同的CDM group，每个CDM group内，比如端口0和1，又通过频域的OCC来实现正交，从而实现4个端口的正交。</li><li>type 1，double symbol情况下，最多支持8个端口，除了频域OCC外，还可以时域OCC来实现正交，所以可以支持更多的端口。</li><li>type 2，single symbol情况下，最多支持6个端口，共三个CDM group，每个group内又通过频域OCC实现正交。</li><li>type 2，double symbol情况下，最多支持12个端口，与类型1双符号情况同理，除了频域OCC外，还可以时域OCC，从而支持更多的端口。</li></ul><p>问题：端口，层方面</p><h1 id="3-PDSCH-PTRS"><a href="#3-PDSCH-PTRS" class="headerlink" title="3 PDSCH PTRS"></a>3 PDSCH PTRS</h1><h2 id="3-1-相位噪声"><a href="#3-1-相位噪声" class="headerlink" title="3.1 相位噪声"></a>3.1 相位噪声</h2><p>相位噪声指射频器件在各种噪声（如随机性白噪声、闪烁噪声）的作用下引起的系统输出信号相位的随机变化。相位噪声会恶化接收端的SNR（Signal-Noise Ratio信噪比）或EVM（Error Vector Magnitude误差向量幅度），造成大量的误码，这样就限制了高阶调制的使用，会严重影响系统的容量。<br>相对来说，相位噪声对低频段，也就是sub6G频段的影响较小一些。而高频段（毫米波）下，由于参考时钟源的倍频次数大幅增加以及器件的工艺水平和功耗等各方面的原因，相位噪声的影响也是大幅增加。<br>为了应对高频段下的相位噪声，除了增大子载波间隔、提高器件质量之外，5G NR引入了PT-RS（Phase Tracking Reference Signal）信号以及相位估计补偿算法。</p><h2 id="3-2-序列生成"><a href="#3-2-序列生成" class="headerlink" title="3.2 序列生成"></a>3.2 序列生成</h2><p>生成序列方式与PDSCH DMRS相同。</p><h2 id="3-3-高层配置"><a href="#3-3-高层配置" class="headerlink" title="3.3 高层配置"></a>3.3 高层配置</h2><p>下行是否配置了PT-RS，由DMRS-DownlinkConfig中的字段phaseTrackingRS来决定，如果该字段缺省或配置为released，则表示下行没有PT-RS信号。PT-RS的具体配置在PTRS-DownlinkConfig中：</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/PTRS.png" alt></p><p><strong>frequencyDensity</strong><br>frequencyDensity提供了两个值，这两个值都在（1,276）的范围内，分别对应了[TS 38.214-Table5.1.6.3-2]中的$N_{RB0},N_{RB1}$，UE再通过DCI中的调度RB数查询该表，就可以确定PT-RS的频域密度$K_{PT−RSK}$ 。如果调度RB数过少，即$N_{RB}&lt;N_{RB0}$ 时，PT-RS的系统开销相对来说就太大了，这个时候下行没有PT-RS信号。</p><div class="table-container"><table><thead><tr><th style="text-align:center">scheduled bandwidth</th><th style="text-align:center">Frequency density ($K_{PT-RS}$)</th></tr></thead><tbody><tr><td style="text-align:center">$N_{RB}&lt;N_{RB0}$</td><td style="text-align:center">PT-RS is not present</td></tr><tr><td style="text-align:center">$N_{RB0}&lt;N_{RB}&lt;N_{RB1}$</td><td style="text-align:center">2</td></tr><tr><td style="text-align:center">$N_{RB1}&lt;N_{RB}$</td><td style="text-align:center">4</td></tr></tbody></table></div><p><strong>timeDensity</strong><br>timeDensity提供了三个范围在（0,29）的值，分别对应[TS 38.214-Table5.1.6.3-1]中的ptrs-MCS1、ptrs-MCS2、ptrs-MCS3，UE再通过DCI中的调度MCS信息就可以确定PT-RS的时域密度(间隔)$L_{PT−RS}$，表中的ptrs-MCS4没有在高层参数中明确配置，UE可以假定该值为当前可使用的最大MCS+1。</p><div class="table-container"><table><thead><tr><th style="text-align:center">scheduled MCS</th><th style="text-align:center">Time density ($L_{PT-RS}$)</th></tr></thead><tbody><tr><td style="text-align:center">$ptrs-MCS1\leq l_{MCS}&lt;ptrs-MCS2$</td><td style="text-align:center">4</td></tr><tr><td style="text-align:center">$ptrs-MCS2\leq l_{MCS}&lt;ptrs-MCS3$</td><td style="text-align:center">2</td></tr><tr><td style="text-align:center">$ptrs-MCS3\leq l_{MCS}&lt;ptrs-MCS4$</td><td style="text-align:center">1</td></tr></tbody></table></div><p><strong>epre-Ratio</strong><br>epre-Ratio通过[TS 38.214-Table4.1-2] 确定了PT-RS端口每层每个RE上PT-RS EPRE与PDSCH EPRE的比例，这个比例叫$\rho _{PTRS}$, 它与$\beta_{PTRS}$ 的关系为：$\beta_{PTRS}=10^{\frac {\rho_{PTRS}}{20}}$。</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/PTRS参数.png" alt></p><p><strong>resourceElementOffset</strong> 见下文表格中参数，取值为{00,01,10,11}。</p><h2 id="3-4-资源映射"><a href="#3-4-资源映射" class="headerlink" title="3.4 资源映射"></a>3.4 资源映射</h2><p>如果PTRS存在，UE将按照按$\beta_{PT_RS}$缩放，并映射到资源单元中：</p><script type="math/tex;mode=display">\alpha_{k,l}^{p,\mu} = \beta_{PT-RS}\cdot r_k</script><h3 id="3-4-1-时域索引"><a href="#3-4-1-时域索引" class="headerlink" title="3.4.1 时域索引"></a>3.4.1 时域索引</h3><p>确定时域索引$l$的步骤如下：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">set i &#x3D; 0 and l_&#123;ref&#125;&#x3D;0  </span><br><span class="line">if l_&#123;ref&#125;+iL_&#123;PTRS&#125;  overlaps with a symbol used for DM-RS according to clause 7.4.1.1.2</span><br><span class="line">- set i &#x3D; 1 </span><br><span class="line">- set l_&#123;ref&#125; to the number of the last DM-RS symbol in a sequence of time-contiguous DM-RS occasions</span><br><span class="line">add l_&#123;ref&#125; + iL_&#123;PTRS&#125; to the set of time indices for PT-RS</span><br><span class="line">increment  i by one</span><br><span class="line">repeat from step 2 above as long as l_&#123;ref&#125;+iL_&#123;PTRS&#125; is inside the PDSCH allocation</span><br></pre></td></tr></table></figure><p></p><p>简而言之，PT-RS时域的的范围，从调度的PDSCH的第一个符号开始，避开DMRS所在的位置，以$L_{PT−RS}$为间隔，一直到PDSCH结束。$L_{PT-RS}$不仅是PT-RS之间的间隔，还是与DMRS最后一个符号之间的间隔。如下图所示：<br>图中 仅选取了$1 RB*14 symbol$ 资源单元 ， $l_0 = 2 , L_{PT-RS} = 2$ , single symbol类型。</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/PTRS时域图.png" alt></p><h3 id="3-4-2-频域索引"><a href="#3-4-2-频域索引" class="headerlink" title="3.4.2 频域索引"></a>3.4.2 频域索引</h3><p>首先，假定分配给PDSCH的RB为从0到$N_{RB}-1$，那么分配给PDSCH的子载波范围就是0-$N_{sc}^{RB}N_{RB}-1$。最终PTRS频域索引$k$，由下面公式得到：</p><script type="math/tex;mode=display">k=k_{ref}^{RE}+(iK_{PT-RS}+k_{ref}^{RB})N_{sc}^{RB}\\k_{ref}^{RB}= \begin{cases}n_{RNTI}modK_{PT-RS} \quad \quad \quad if N_{RB}modK_{PT-RS} = 0 \\n_{RNTI}mod(N_{RB}modK_{PT-RS})\quad \quad otherwise\end{cases}</script><p>$k_{ref}^{RE}$ 由下表获得[TS 38.311-Table 7.4.1.2.2-1]：</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/频域索引.png" alt></p><p>由上可知，$K_{PT-RS}$为相邻 PTRS之间间隔的RB数，即相邻 PTRS之间相差$K_{PT-RS}\cdot N_{sc}^{RB}$ 个子载波，第一个PTRS 子载波定位是 $k_{ref}^{RE}+（0K_{PT-RS}+k_{ref}^{RB}）N_{sc}^{RB}$ 。大概的图样如下图所示：</p><p><img src="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDSCH%E5%AD%A6%E4%B9%A0/PTRS频域图.png" alt></p><blockquote><p>主要参考：<br>博客：<a href="https://blog.csdn.net/littleBird_2/article/details/89408575" target="_blank" rel="noopener">https://blog.csdn.net/littleBird_2/article/details/89408575</a> (PDSCH)<br>博客：<a href="https://blog.csdn.net/kakamilan/article/details/104535554" target="_blank" rel="noopener">https://blog.csdn.net/kakamilan/article/details/104535554</a> (PDSCH-DMRS)<br>博客：<a href="https://blog.csdn.net/m0_45416816/article/details/103807853" target="_blank" rel="noopener">https://blog.csdn.net/m0_45416816/article/details/103807853</a> (PDSCH-DMRS)<br>博客：<a href="https://blog.csdn.net/littleBird_2/article/details/89683712" target="_blank" rel="noopener">https://blog.csdn.net/littleBird_2/article/details/89683712</a> (PDSCH-PTRS)<br>网页：<a href="http://www.sharetechnote.com" target="_blank" rel="noopener">http://www.sharetechnote.com</a></p></blockquote></div><div><div><br><br><div style="text-align:center;color:#ccc;font-size:14px">----------- 本文结束 -----------</div><br><br><br><br></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/PDSCH/" rel="tag"><i class="fa fa-tag">PDSCH</i></a></div><div class="post-widgets"><div id="needsharebutton-postbottom"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PDCCH%E5%AD%A6%E4%B9%A0/" rel="next" title="5G-NR-PDCCH学习"><i class="fa fa-chevron-left"></i> 5G-NR-PDCCH学习</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/5G%E5%8D%8F%E8%AE%AE/5G-NR-PRACH%E5%AD%A6%E4%B9%A0/" rel="prev" title="5G-NR-PRACH学习">5G-NR-PRACH学习 <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"></div></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/"><img class="site-author-image" itemprop="image" src="/images/logo.jpg" alt="从之丶"></a><p class="site-author-name" itemprop="name">从之丶</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/%7C%7C%20archive"><span class="site-state-item-count">29</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">6</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">29</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/czGitAccount" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:caoz326@163.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-block"><div class="links-of-blogroll-title"><i class="fa fa-history fa-" aria-hidden="true"></i> 近期文章</div><ul class="links-of-blogroll-list"><li class="recent_posts_li"><a href="/Data_Structure_and_Algorithm/%E5%89%91%E6%8C%87offer/%E5%88%86%E6%B2%BB%E7%AE%97%E6%B3%95/" title="剑指offer -- 分治算法" target="_blank">剑指offer -- 分治算法</a></li><li class="recent_posts_li"><a href="/Data_Structure_and_Algorithm/%E5%89%91%E6%8C%87offer/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/" title="剑指offer -- 动态规划" target="_blank">剑指offer -- 动态规划</a></li><li class="recent_posts_li"><a href="/Data_Structure_and_Algorithm/%E5%89%91%E6%8C%87offer/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" title="剑指offer -- 查找算法" target="_blank">剑指offer -- 查找算法</a></li><li class="recent_posts_li"><a href="/Data_Structure_and_Algorithm/%E5%89%91%E6%8C%87offer/%E6%9F%A5%E6%89%BE%E7%AE%97%E6%B3%95/" title="剑指offer -- 查找算法" target="_blank">剑指offer -- 查找算法</a></li><li class="recent_posts_li"><a href="/Data_Structure_and_Algorithm/%E5%89%91%E6%8C%87offer/%E5%8F%8C%E6%8C%87%E9%92%88/" title="剑指offer -- 双指针" target="_blank">剑指offer -- 双指针</a></li></ul></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-PDSCH-物理流程"><span class="nav-text">1 PDSCH 物理流程</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-加扰"><span class="nav-text">1.1 加扰</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-调制"><span class="nav-text">1.2 调制</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-层映射"><span class="nav-text">1.3 层映射</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-4-天线端口映射"><span class="nav-text">1.4 天线端口映射</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-5-映射到虚拟资源快"><span class="nav-text">1.5 映射到虚拟资源快</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-6-从虚拟资源块映射到物理资源块"><span class="nav-text">1.6 从虚拟资源块映射到物理资源块</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-6-1-非交织"><span class="nav-text">1.6.1 非交织</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-6-2-交织"><span class="nav-text">1.6.2 交织</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-6-3-VRB-bundle-到-PRB-bundle-的映射"><span class="nav-text">1.6.3 VRB bundle 到 PRB bundle 的映射</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-PDSCH-DMRS"><span class="nav-text">2 PDSCH DMRS</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-序列生成"><span class="nav-text">2.1 序列生成</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-PDSCH-DMRS-频域位置"><span class="nav-text">2.2 PDSCH DMRS 频域位置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-PDSCH-DMRS-的符号位置"><span class="nav-text">2.3 PDSCH DMRS 的符号位置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-4-DMRS-符号类型"><span class="nav-text">2.4 DMRS 符号类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-5-添加导频"><span class="nav-text">2.5 添加导频</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-6-端口映射"><span class="nav-text">2.6 端口映射</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-PDSCH-PTRS"><span class="nav-text">3 PDSCH PTRS</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-相位噪声"><span class="nav-text">3.1 相位噪声</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-序列生成"><span class="nav-text">3.2 序列生成</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-高层配置"><span class="nav-text">3.3 高层配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-4-资源映射"><span class="nav-text">3.4 资源映射</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-1-时域索引"><span class="nav-text">3.4.1 时域索引</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-2-频域索引"><span class="nav-text">3.4.2 频域索引</span></a></li></ol></li></ol></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">从之丶</span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script><i id="darkmode" class="fa fa-lightbulb-o" aria-hidden="true"></i><script>var body=$("body"),darkmode=$("#darkmode");(matchMedia("(prefers-color-scheme: dark)").matches||"1"===localStorage.getItem("darkmode"))&&"1"!==localStorage.getItem("noDark")&&body.addClass("dark"),body.hasClass("dark")?darkmode.removeClass("fa-moon-o").addClass("fa-lightbulb-o"):darkmode.removeClass("fa-lightbulb-o").addClass("fa-moon-o"),darkmode.click(function(){body.hasClass("dark")?(darkmode.removeClass("fa-lightbulb-o").addClass("fa-moon-o"),body.removeClass("dark"),localStorage.setItem("darkmode","0"),localStorage.setItem("noDark","1")):(darkmode.removeClass("fa-moon-o").addClass("fa-lightbulb-o"),body.addClass("dark"),localStorage.setItem("darkmode","1"),localStorage.setItem("noDark","0"))})</script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/clipboard.min.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/highlight-wrap.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")},searchFunc=function(t,e,o){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var n=isXml?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,r=document.getElementById(e),s=document.getElementById(o),a=function(){var t=r.value.trim().toLowerCase(),e=t.split(/[\s\-]+/);e.length>1&&e.push(t);var o=[];if(t.length>0&&n.forEach(function(n){function r(e,o,n,r){for(var s=r[r.length-1],a=s.position,i=s.word,l=[],h=0;a+i.length<=n&&0!=r.length;){i===t&&h++,l.push({position:a,length:i.length});var p=a+i.length;for(r.pop();0!=r.length&&(s=r[r.length-1],a=s.position,i=s.word,p>a);)r.pop()}return c+=h,{hits:l,start:o,end:n,searchTextCount:h}}function s(t,e){var o="",n=e.start;return e.hits.forEach(function(e){o+=t.substring(n,e.position);var r=e.position+e.length;o+='<b class="search-keyword">'+t.substring(e.position,r)+"</b>",n=r}),o+=t.substring(n,e.end)}var a=!1,i=0,c=0,l=n.title.trim(),h=l.toLowerCase(),p=n.content.trim().replace(/<[^>]+>/g,""),u=p.toLowerCase(),f=decodeURIComponent(n.url),d=[],g=[];if(""!=l&&(e.forEach(function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());(s=e.indexOf(t,r))>-1;)a.push({position:s,word:t}),r=s+n;return a}d=d.concat(e(t,h,!1)),g=g.concat(e(t,u,!1))}),(d.length>0||g.length>0)&&(a=!0,i=d.length+g.length)),a){[d,g].forEach(function(t){t.sort(function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length})});var v=[];0!=d.length&&v.push(r(l,0,l.length,d));for(var $=[];0!=g.length;){var C=g[g.length-1],m=C.position,x=C.word,w=m-20,y=m+80;0>w&&(w=0),y<m+x.length&&(y=m+x.length),y>p.length&&(y=p.length),$.push(r(p,w,y,g))}$.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start});var T=parseInt("1");T>=0&&($=$.slice(0,T));var b="";b+=0!=v.length?"<li><a href='"+f+"' class='search-result-title'>"+s(l,v[0])+"</a>":"<li><a href='"+f+"' class='search-result-title'>"+l+"</a>",$.forEach(function(t){b+="<a href='"+f+'\'><p class="search-result">'+s(p,t)+"...</p></a>"}),b+="</li>",o.push({item:b,searchTextCount:c,hitCount:i,id:o.length})}}),1===e.length&&""===e[0])s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>';else if(0===o.length)s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>';else{o.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id});var a='<ul class="search-result-list">';o.forEach(function(t){a+=t.item}),a+="</ul>",s.innerHTML=a}};r.addEventListener("input",a),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(t){t.stopPropagation(),isfetched===!1?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(t){t.stopPropagation()}),$(document).on("keyup",function(t){var e=27===t.which&&$(".search-popup").is(":visible");e&&onPopupClose()})</script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={},pbOptions.iconStyle="box",pbOptions.boxForm="horizontal",pbOptions.position="bottomCenter",pbOptions.networks="Weibo,Wechat,Douban,QQZone,Twitter,Facebook",new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={},flOptions.iconStyle="box",flOptions.boxForm="horizontal",flOptions.position="middleRight",flOptions.networks="Weibo,Wechat,Douban,QQZone,Twitter,Facebook",new needShareButton("#needsharebutton-float",flOptions)</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });</script><script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/wanko.model.json"},display:{position:"left",width:200,height:270},mobile:{show:!1},log:!1})</script></body></html><!-- rebuild by neat -->